<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.controls/src/test/java/test/javafx/scene/control/TextInputControlTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import javafx.beans.InvalidationListener;
  29 import javafx.beans.Observable;
  30 import javafx.beans.property.BooleanProperty;
  31 import javafx.beans.property.SimpleBooleanProperty;
  32 import javafx.beans.property.SimpleStringProperty;
  33 import javafx.beans.property.StringProperty;
  34 import javafx.beans.value.ChangeListener;
  35 import javafx.beans.value.ObservableValue;
  36 import javafx.css.CssMetaData;
  37 import javafx.css.StyleableProperty;
  38 import javafx.event.EventHandler;
  39 import javafx.scene.Scene;
  40 import javafx.scene.input.KeyCode;
  41 import javafx.scene.input.KeyEvent;
  42 import javafx.scene.input.Clipboard;
  43 import javafx.scene.input.ClipboardContent;
  44 import javafx.scene.text.Font;
  45 import javafx.scene.layout.StackPane;
  46 import javafx.stage.Stage;
  47 import java.util.Arrays;
  48 import java.util.Collection;
  49 import javafx.scene.control.IndexRange;
  50 import javafx.scene.control.PasswordField;
  51 import javafx.scene.control.TextArea;
  52 import javafx.scene.control.TextField;
  53 import javafx.scene.control.TextInputControl;
  54 import com.sun.javafx.tk.Toolkit;
  55 import org.junit.Before;
  56 import org.junit.Test;
  57 import org.junit.runner.RunWith;
  58 import org.junit.runners.Parameterized;
  59 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  60 import test.com.sun.javafx.pgstub.StubToolkit;
  61 import static org.junit.Assert.assertEquals;
  62 import static org.junit.Assert.assertFalse;
  63 import static org.junit.Assert.assertNull;
  64 import static org.junit.Assert.assertTrue;
  65 import static org.junit.Assert.fail;
  66 /**
  67  */
  68 @RunWith(Parameterized.class)
  69 public class TextInputControlTest {
  70     @SuppressWarnings(&quot;rawtypes&quot;)
  71     @Parameterized.Parameters public static Collection implementations() {
  72         return Arrays.asList(new Object[][]{
  73                 {TextField.class},
  74                 {PasswordField.class},
  75                 {TextArea.class}
  76         });
  77     }
  78 
  79     private TextInputControl textInput;
  80     private Class type;
  81 
  82     public TextInputControlTest(Class type) {
  83         this.type = type;
  84     }
  85 
  86     @Before public void setup() throws Exception {
  87         textInput = (TextInputControl) type.newInstance();
  88     }
  89 
  90     /******************************************************
  91      * Test the default states                            *
  92      *****************************************************/
  93 
  94     @Test public void textDefaultsToEmptyString() {
  95         assertEquals(&quot;&quot;, textInput.getText());
  96     }
  97 
  98     @Test public void editableDefaultsToTrue() {
  99         assertTrue(textInput.isEditable());
 100     }
 101 
 102     @Test public void anchorDefaultsToZero() {
 103         assertEquals(0, textInput.getAnchor());
 104     }
 105 
 106     @Test public void caretPositionDefaultsToZero() {
 107         assertEquals(0, textInput.getCaretPosition());
 108     }
 109 
 110     @Test public void lengthDefaultsToZero() {
 111         assertEquals(0, textInput.getLength());
 112     }
 113 
 114     @Test public void selectedTextDefaultsToEmptyString() {
 115         assertEquals(&quot;&quot;, textInput.getSelectedText());
 116     }
 117 
 118     @Test public void selectionDefaultsToEmpty() {
 119         assertEquals(0, textInput.getSelection().getLength());
 120     }
 121 
 122     @Test public void selectionStartDefaultsToZero() {
 123         assertEquals(0, textInput.getSelection().getStart());
 124     }
 125 
 126     @Test public void selectionEndDefaultsToZero() {
 127         assertEquals(0, textInput.getSelection().getEnd());
 128     }
 129 
 130     /*********************************************************************
 131      * Tests for CSS                                                     *
 132      ********************************************************************/
 133 
 134     @Test public void fontSetFromCSS() {
 135         textInput.setStyle(&quot;-fx-font: 24 Helvetica&quot;);
 136         Scene s = new Scene(textInput);
 137         textInput.applyCss();
 138         assertEquals(Font.font(&quot;Helvetica&quot;, 24), textInput.getFont());
 139     }
 140 
 141     /******************************************************
 142      * Test for text                                      *
 143      *****************************************************/
 144 
 145     @Test public void settingTextUpdatesTheText() {
 146         textInput.setText(&quot;This is a test&quot;);
 147         assertEquals(&quot;This is a test&quot;, textInput.getText());
 148         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 149     }
 150 
 151     @Test public void textCanBeNull() {
 152         textInput.setText(null);
 153         assertNull(textInput.getText());
 154     }
 155 
 156     @Test public void textCanBeSwitchedBetweenNullAndAValue() {
 157         textInput.setText(null);
 158         textInput.setText(&quot;Test&quot;);
 159         assertEquals(&quot;Test&quot;, textInput.getText());
 160     }
 161 
 162     @Test public void textCanBeSwitchedFromAValueToNull() {
 163         textInput.setText(&quot;Test&quot;);
 164         textInput.setText(null);
 165         assertNull(textInput.getText());
 166     }
 167 
 168     @Test public void textIsNullThenBoundThenUnboundAndShouldReturnTheValueWhenBound() {
 169         textInput.setText(null);
 170         StringProperty other = new SimpleStringProperty(&quot;Peppers&quot;);
 171         textInput.textProperty().bind(other);
 172         textInput.textProperty().unbind();
 173         assertEquals(&quot;Peppers&quot;, textInput.getText());
 174     }
 175 
 176     @Test public void textHasValueThenIsBoundToNullShouldReturnNullFromGet() {
 177         textInput.setText(&quot;Value&quot;);
 178         StringProperty other = new SimpleStringProperty(null);
 179         textInput.textProperty().bind(other);
 180         assertNull(textInput.getText());
 181     }
 182 
 183     @Test public void textHasValueThenIsBoundToNullAndUnboundShouldReturnNullFromGet() {
 184         textInput.setText(&quot;Value&quot;);
 185         StringProperty other = new SimpleStringProperty(null);
 186         textInput.textProperty().bind(other);
 187         textInput.textProperty().unbind();
 188         assertNull(textInput.getText());
 189     }
 190 
 191     @Test public void textHasValueThenIsBoundToNullAndUnboundThenSetShouldReturnNewValueFromGet() {
 192         textInput.setText(&quot;Value&quot;);
 193         StringProperty other = new SimpleStringProperty(null);
 194         textInput.textProperty().bind(other);
 195         textInput.textProperty().unbind();
 196         textInput.setText(&quot;New Value&quot;);
 197         assertEquals(&quot;New Value&quot;, textInput.getText());
 198     }
 199 
 200     @Test public void textCanBeBound() {
 201         StringProperty other = new SimpleStringProperty(&quot;Apples&quot;);
 202         textInput.textProperty().bind(other);
 203         assertEquals(&quot;Apples&quot;, textInput.getText());
 204         other.set(&quot;Oranges&quot;);
 205         assertEquals(&quot;Oranges&quot;, textInput.getText());
 206     }
 207 
 208     @Test public void cannotSpecifyTextViaCSS() {
 209         try {
 210             CssMetaData styleable = ((StyleableProperty)textInput.textProperty()).getCssMetaData();
 211             assertNull(styleable);
 212         } catch (ClassCastException ignored) {
 213             // pass!
 214         } catch (Exception e) {
 215             org.junit.Assert.fail(e.toString());
 216         }
 217     }
 218 
 219     @Test public void settingTextNotifiesOfChange() {
 220         final boolean[] passed = new boolean[] { false };
 221         textInput.textProperty().addListener((observable, oldValue, newValue) -&gt; {
 222             passed[0] = true;
 223         });
 224         textInput.setText(&quot;Apples&quot;);
 225         assertTrue(passed[0]);
 226     }
 227 
 228     // Test for JDK-8212102
 229     @Test public void testControlCharacters() {
 230         try {
 231             String cc = &quot;\r\n\n&quot;;
 232             String str = &quot;123456&quot;;
 233 
 234             textInput.setText(cc);
 235 
 236             textInput.setText(str);
 237             textInput.replaceText(0, 6, cc);
 238 
 239             textInput.setText(str);
 240             textInput.replaceText(new IndexRange(0, 6), cc);
 241 
 242             textInput.setText(str);
 243             textInput.selectAll();
 244             textInput.replaceSelection(cc);
 245 
 246             textInput.setText(str);
 247             textInput.selectRange(0, 6);
 248             textInput.replaceSelection(cc);
 249 
 250         } catch (Exception e) {
 251             fail(&quot;Control characters(\\r\\n) caused Exception: &quot; + e);
 252         }
 253     }
 254 
 255     @Test public void controlCharactersAreOmitted_setText_getText() {
 256         String s = &quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;;
 257         textInput.setText(s);
 258         assertEquals(&quot;This is a test&quot;, textInput.getText());
 259     }
 260 
 261     @Test public void controlCharactersAreOmitted_setText_textProperty_get() {
 262         String s = &quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;;
 263         textInput.setText(s);
 264         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 265     }
 266 
 267     @Test public void controlCharactersAreOmitted_bound_getText() {
 268         StringProperty other = new SimpleStringProperty(&quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;);
 269         textInput.textProperty().bind(other);
 270         assertEquals(&quot;This is a test&quot;, textInput.getText());
 271         other.set(&quot;Bro&quot; + &#39;\5&#39; + &quot;ken&quot;);
 272         assertEquals(&quot;Broken&quot;, textInput.getText());
 273     }
 274 
 275     @Test public void controlCharactersAreOmitted_bound_textProperty_get() {
 276         StringProperty other = new SimpleStringProperty(&quot;This is &quot; + &#39;\0&#39; + &quot;a test&quot;);
 277         textInput.textProperty().bind(other);
 278         assertEquals(&quot;This is a test&quot;, textInput.textProperty().get());
 279         other.set(&quot;Bro&quot; + &#39;\5&#39; + &quot;ken&quot;);
 280         assertEquals(&quot;Broken&quot;, textInput.textProperty().get());
 281     }
 282 
 283     // selection is changed when text is changed??
 284     // anchor and caret position updated when selection is changed due to text change??
 285     // selected text is updated when selection changes due to a text change??
 286     // length is updated when text changes
 287 
 288     /******************************************************
 289      * Test for editable                                  *
 290      *****************************************************/
 291 
 292     @Test public void settingEditableValueShouldWork() {
 293         textInput.setEditable(false);
 294         assertFalse(textInput.isEditable());
 295     }
 296 
 297     @Test public void settingEditableAndThenCreatingAModelAndReadingTheValueStillWorks() {
 298         textInput.setEditable(false);
 299         assertFalse(textInput.editableProperty().get());
 300     }
 301 
 302     @Test public void editableCanBeBound() {
 303         BooleanProperty other = new SimpleBooleanProperty(false);
 304         textInput.editableProperty().bind(other);
 305         assertFalse(textInput.isEditable());
 306         other.set(true);
 307         assertTrue(textInput.isEditable());
 308     }
 309 
 310     @Test public void cannotSpecifyEditableViaCSS() {
 311         try {
 312             CssMetaData styleable = ((StyleableProperty)textInput.editableProperty()).getCssMetaData();
 313             assertNull(styleable);
 314         } catch (ClassCastException ignored) {
 315             // pass!
 316         } catch (Exception e) {
 317             org.junit.Assert.fail(e.toString());
 318         }
 319     }
 320 
 321     @Test public void settingEditableNotifiesOfChange() {
 322         final boolean[] passed = new boolean[] { false };
 323         textInput.editableProperty().addListener((observable, oldValue, newValue) -&gt; {
 324             passed[0] = true;
 325         });
 326         textInput.setEditable(false);
 327         assertTrue(passed[0]);
 328     }
 329 
 330     /******************************************************
 331      * Test for anchor                                    *
 332      *****************************************************/
 333 
 334     @Test public void anchorIsSetWhenSelectionChanges() {
 335         textInput.setText(&quot;The quick brown fox&quot;);
 336         textInput.selectRange(4, 9);
 337         assertEquals(4, textInput.getAnchor());
 338     }
 339 
 340     @Test public void anchorIsSetWhenSelectionChanges2() {
 341         textInput.setText(&quot;The quick brown fox&quot;);
 342         textInput.selectRange(9, 4);
 343         assertEquals(9, textInput.getAnchor());
 344     }
 345 
 346     // updated when text changes
 347     @Test public void anchorIsSetToCaretPositionWhenTextChanges() {
 348         textInput.setText(&quot;The quick brown fox&quot;);
 349         textInput.selectRange(4, 9);
 350         textInput.setText(&quot;Gone&quot;);
 351         assertEquals(textInput.getCaretPosition(), textInput.getAnchor());
 352     }
 353 
 354     /******************************************************
 355      * Test for caretPosition                             *
 356      *****************************************************/
 357 
 358     @Test public void caretPositionIsSetWhenSelectionChanges() {
 359         textInput.setText(&quot;The quick brown fox&quot;);
 360         textInput.selectRange(4, 9);
 361         assertEquals(9, textInput.getCaretPosition());
 362     }
 363 
 364     @Test public void caretPositionIsSetWhenSelectionChanges2() {
 365         textInput.setText(&quot;The quick brown fox&quot;);
 366         textInput.selectRange(9, 4);
 367         assertEquals(4, textInput.getCaretPosition());
 368     }
 369 
 370     @Test
 371     public void caretAndAnchorPositionAfterSettingText() {
 372         textInput.setText(&quot;The quick brown fox&quot;);
 373         assertEquals(0, textInput.getCaretPosition());
 374         assertEquals(0, textInput.getAnchor());
 375     }
 376 
 377     // Test for JDK-8178417
 378     @Test public void caretPositionUndo() {
 379         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
 380         StackPane root = new StackPane();
 381         Scene scene = new Scene(root);
 382         Stage stage = new Stage();
 383         String text = &quot;01234&quot;;
 384 
 385         textInput.setText(text);
 386         stage.setScene(scene);
 387         root.getChildren().removeAll();
 388         root.getChildren().add(textInput);
 389         stage.show();
 390         tk.firePulse();
 391 
 392         KeyEventFirer keyboard = new KeyEventFirer(textInput);
 393         keyboard.doKeyPress(KeyCode.HOME);
 394 
 395         for(int i = 1; i &lt; text.length() + 1; ++i) {
 396             keyboard.doKeyPress(KeyCode.RIGHT);
 397             tk.firePulse();
 398         }
 399         for(int i = 1; i &lt; text.length() + 1; ++i) {
 400             textInput.undo();
 401         }
 402         assertEquals(text.length(), textInput.getCaretPosition());
 403         root.getChildren().removeAll();
 404         stage.hide();
 405         tk.firePulse();
 406     }
 407 
 408     /******************************************************
 409      * Test for length                                    *
 410      *****************************************************/
 411 
 412     // TODO null text results in 0 length
 413 
 414     @Test public void emptyTextResultsInZeroLength() {
 415         textInput.setText(&quot;Hello&quot;);
 416         textInput.setText(&quot;&quot;);
 417         assertEquals(0, textInput.getLength());
 418     }
 419 
 420     @Test public void lengthMatchesStringLength() {
 421         final String string = &quot;Hello&quot;;
 422         textInput.setText(string);
 423         assertEquals(string.length(), textInput.getLength());
 424     }
 425 
 426     @Test public void lengthChangeNotificationWhenTextIsUpdatedToNonEmptyResult() {
 427         final boolean[] passed = new boolean[] { false };
 428         textInput.lengthProperty().addListener((observable, oldValue, newValue) -&gt; {
 429             passed[0] = true;
 430         });
 431         textInput.setText(&quot;Hello&quot;);
 432         assertTrue(passed[0]);
 433     }
 434 
 435     @Test public void lengthChangeNotificationWhenTextIsSetToEmptyResult() {
 436         textInput.setText(&quot;Goodbye&quot;);
 437         final boolean[] passed = new boolean[] { false };
 438         textInput.lengthProperty().addListener((observable, oldValue, newValue) -&gt; {
 439             passed[0] = true;
 440         });
 441         textInput.setText(&quot;&quot;);
 442         assertTrue(passed[0]);
 443     }
 444 
 445     /******************************************************
 446      * Test for maximumLength                             *
 447      *****************************************************/
 448 
 449     // set maximum length to less than current length
 450 
 451     /******************************************************
 452      * Test for selected text                             *
 453      *****************************************************/
 454 
 455     // TODO test null text and some random range
 456 
 457     @Test public void selectedTextMatchesTextAndSelection() {
 458         textInput.setText(&quot;The quick brown fox&quot;);
 459         textInput.selectRange(0, 3);
 460         assertEquals(&quot;The&quot;, textInput.getSelectedText());
 461     }
 462 
 463     @Test public void selectedTextMatchesTextAndSelection2() {
 464         textInput.setText(&quot;The quick brown fox&quot;);
 465         textInput.selectRange(4, 9);
 466         assertEquals(&quot;quick&quot;, textInput.getSelectedText());
 467     }
 468 
 469     @Test public void selectedTextMatchesTextAndSelection3() {
 470         textInput.setText(&quot;The quick brown fox&quot;);
 471         textInput.selectRange(10, 19);
 472         assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 473     }
 474 
 475     @Test public void selectedTextIsClearedWhenTextChanges() {
 476         textInput.setText(&quot;The quick brown fox&quot;);
 477         textInput.selectRange(4, 9);
 478         textInput.setText(&quot;&quot;);
 479         assertEquals(&quot;&quot;, textInput.getSelectedText());
 480     }
 481 
 482     @Test public void selectedTextWorksWhenSelectionExceedsPossibleRange() {
 483         textInput.setText(&quot;The quick brown fox&quot;);
 484         textInput.selectRange(10, 180);
 485         assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 486     }
 487 
 488     @Test public void selectedTextWorksWhenSelectionExceedsPossibleRange2() {
 489         textInput.setText(&quot;The quick brown fox&quot;);
 490         textInput.selectRange(100, 180);
 491         assertEquals(&quot;&quot;, textInput.getSelectedText());
 492     }
 493 
 494 //    @Test public void selectedTextWorksWhenSelectionIsBound() {
 495 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(4, 9));
 496 //        textInput.setText(&quot;The quick brown fox&quot;);
 497 //        textInput.selectionProperty().bind(other);
 498 //        assertEquals(&quot;quick&quot;, textInput.getSelectedText());
 499 //        other.set(new IndexRange(10, 19));
 500 //        assertEquals(&quot;brown fox&quot;, textInput.getSelectedText());
 501 //    }
 502 
 503     @Test public void selectedTextWorksWhenTextIsBound() {
 504         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 505         textInput.textProperty().bind(other);
 506         textInput.selectRange(0, 5);
 507         assertEquals(&quot;There&quot;, textInput.getSelectedText());
 508         other.set(&quot;Cleared!&quot;);
 509         assertEquals(&quot;&quot;, textInput.getSelectedText());
 510     }
 511 
 512     @Test public void selectedTextChangeEvents() {
 513         final boolean[] passed = new boolean[] { false };
 514         textInput.setText(&quot;The quick brown fox&quot;);
 515         textInput.selectedTextProperty().addListener(observable -&gt; {
 516             passed[0] = true;
 517         });
 518         textInput.selectRange(0, 3);
 519         assertTrue(passed[0]);
 520     }
 521 
 522     @Test public void selectedTextChangeEvents2() {
 523         final boolean[] passed = new boolean[] { false };
 524         textInput.setText(&quot;The quick brown fox&quot;);
 525         textInput.selectRange(0, 3);
 526         textInput.selectedTextProperty().addListener(observable -&gt; {
 527             passed[0] = true;
 528         });
 529         textInput.selectRange(10, 180);
 530         assertTrue(passed[0]);
 531     }
 532 
 533     @Test public void selectedTextChangeEvents3() {
 534         final boolean[] passed = new boolean[] { false };
 535         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 536         textInput.textProperty().bind(other);
 537         textInput.selectRange(0, 5);
 538         textInput.selectedTextProperty().addListener(observable -&gt; {
 539             passed[0] = true;
 540         });
 541         other.set(&quot;Cleared!&quot;);
 542         assertTrue(passed[0]);
 543     }
 544 
 545     /******************************************************
 546      * Test for selection                                 *
 547      *****************************************************/
 548 
 549     @Test public void selectionIsClearedWhenTextChanges() {
 550         textInput.setText(&quot;The quick brown fox&quot;);
 551         textInput.selectRange(4, 9);
 552         textInput.setText(&quot;&quot;);
 553         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 554     }
 555 
 556     @Test public void selectionCannotBeSetToBeOutOfRange() {
 557         textInput.setText(&quot;The quick brown fox&quot;);
 558         textInput.selectRange(4, 99);
 559         assertEquals(new IndexRange(4, 19), textInput.getSelection());
 560     }
 561 
 562     @Test public void selectionCannotBeSetToBeOutOfRange2() {
 563         textInput.setText(&quot;The quick brown fox&quot;);
 564         textInput.selectRange(44, 99);
 565         assertEquals(new IndexRange(19, 19), textInput.getSelection());
 566     }
 567 
 568 //    @Test public void selectionCanBeBound() {
 569 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(4, 9));
 570 //        textInput.selectionProperty().bind(other);
 571 //        assertEquals(new IndexRange(4, 9), textInput.getSelection());
 572 //        other.set(new IndexRange(10, 19));
 573 //        assertEquals(new IndexRange(10, 19), textInput.getSelection());
 574 //    }
 575 
 576     @Test public void selectionChangeEventsHappen() {
 577         final boolean[] passed = new boolean[] { false };
 578         textInput.selectionProperty().addListener(observable -&gt; {
 579             passed[0] = true;
 580         });
 581         textInput.selectRange(0, 3);
 582         assertTrue(passed[0]);
 583     }
 584 
 585 //    @Test public void selectionChangeEventsHappenWhenBound() {
 586 //        final boolean[] passed = new boolean[] { false };
 587 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(0, 5));
 588 //        textInput.selectionProperty().addListener(new InvalidationListener() {
 589 //            @Override public void invalidated(Observable observable) {
 590 //                passed[0] = true;
 591 //            }
 592 //        });
 593 //        textInput.selectionProperty().bind(other);
 594 //        assertTrue(passed[0]);
 595 //    }
 596 
 597 //    @Test public void selectionChangeEventsHappenWhenBound2() {
 598 //        final boolean[] passed = new boolean[] { false };
 599 //        ObjectProperty&lt;IndexRange&gt; other = new SimpleObjectProperty&lt;IndexRange&gt;(new IndexRange(0, 5));
 600 //        textInput.selectionProperty().bind(other);
 601 //        textInput.selectionProperty().addListener(new InvalidationListener() {
 602 //            @Override public void invalidated(Observable observable) {
 603 //                passed[0] = true;
 604 //            }
 605 //        });
 606 //        assertFalse(passed[0]);
 607 //        other.set(new IndexRange(1, 2));
 608 //        assertTrue(passed[0]);
 609 //    }
 610 
 611     @Test public void selectionChangeEventsHappenWhenTextIsChanged() {
 612         final boolean[] passed = new boolean[] { false };
 613         StringProperty other = new SimpleStringProperty(&quot;There and back again&quot;);
 614         textInput.textProperty().bind(other);
 615         textInput.selectRange(0, 5);
 616         textInput.selectionProperty().addListener(observable -&gt; {
 617             passed[0] = true;
 618         });
 619         other.set(&quot;Cleared!&quot;);
 620         assertTrue(passed[0]);
 621     }
 622 
 623     /******************************************************
 624      * Test for cut/copy/paste                            *
 625      *****************************************************/
 626 
 627     @Test public void cutRemovesSelection() {
 628         // Skip for PasswordField
 629         if (textInput instanceof PasswordField) return;
 630         textInput.setText(&quot;The quick brown fox&quot;);
 631         textInput.selectRange(4, 9);
 632         textInput.cut();
 633         assertEquals(&quot;The  brown fox&quot;, textInput.getText());
 634     }
 635 
 636     @Test public void pasteReplacesSelection() {
 637         textInput.setText(&quot;The quick brown fox&quot;);
 638         textInput.selectRange(4, 9);
 639         copy(&quot;slow&quot;);
 640         textInput.paste();
 641         assertEquals(&quot;The slow brown fox&quot;, textInput.getText());
 642     }
 643 
 644     @Test public void pasteIllegalCharacters() {
 645         textInput.setText(&quot;The quick brown fox&quot;);
 646         textInput.selectRange(19, 19);
 647         copy(&quot;&quot; + &#39;\0&#39;);
 648         textInput.paste();
 649         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
 650     }
 651 
 652     @Test public void pasteIllegalCharactersCaretNotAtZero() {
 653         textInput.setText(&quot;The quick brown fox&quot;);
 654         textInput.selectRange(4, 4);
 655         copy(&quot;slow&quot; + &#39;\0&#39;);
 656         textInput.paste();
 657         assertEquals(8, textInput.getCaretPosition());
 658         assertEquals(8, textInput.getAnchor());
 659     }
 660 
 661     @Test public void pasteIllegalCharactersSelection() {
 662         textInput.setText(&quot;The quick brown fox&quot;);
 663         textInput.selectRange(4, 9);
 664         copy(&quot;slow&quot; + &#39;\0&#39;);
 665         textInput.paste();
 666         assertEquals(&quot;The slow brown fox&quot;, textInput.getText());
 667     }
 668 
 669     @Test public void pasteIllegalCharactersIntoSelectionPositionsCaretCorrectly() {
 670         textInput.setText(&quot;The quick brown fox&quot;);
 671         textInput.selectRange(4, 9);
 672         copy(&quot;slow&quot; + &#39;\0&#39;);
 673         textInput.paste();
 674         assertEquals(8, textInput.getCaretPosition());
 675         assertEquals(8, textInput.getAnchor());
 676     }
 677 
 678     /******************************************************
 679      * Test for manipulating selection via methods        *
 680      *****************************************************/
 681 
 682     // cut ends up removing the selection, and setting anchor / caretPosition to match index
 683     @Test public void cutRemovesSelectionAndResetsAnchorAndCaretPositionToIndex() {
 684         // Skip for PasswordField
 685         if (textInput instanceof PasswordField) return;
 686         textInput.setText(&quot;The quick brown fox&quot;);
 687         textInput.selectRange(4, 9);
 688         textInput.cut();
 689         assertEquals(4, textInput.getAnchor());
 690         assertEquals(4, textInput.getCaretPosition());
 691         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 692         assertEquals(&quot;&quot;, textInput.getSelectedText());
 693     }
 694 
 695     @Test public void pasteWithEmptySelection() {
 696         textInput.setText(&quot;quick brown fox&quot;);
 697         textInput.selectRange(0,0);
 698         copy(&quot;The &quot;);
 699         textInput.paste();
 700         assertEquals(4, textInput.getAnchor());
 701         assertEquals(4, textInput.getCaretPosition());
 702         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 703         assertEquals(&quot;&quot;, textInput.getSelectedText());
 704     }
 705 
 706     @Test public void pasteWithSelection() {
 707         textInput.setText(&quot;The quick brown fox&quot;);
 708         textInput.selectRange(4, 9);
 709         copy(&quot;slow&quot;);
 710         textInput.paste();
 711         assertEquals(8, textInput.getAnchor());
 712         assertEquals(8, textInput.getCaretPosition());
 713         assertEquals(new IndexRange(8, 8), textInput.getSelection());
 714         assertEquals(&quot;&quot;, textInput.getSelectedText());
 715     }
 716 
 717     @Test public void pasteAll() {
 718         textInput.setText(&quot;The quick brown fox&quot;);
 719         textInput.selectAll();
 720         copy(&quot;Gone&quot;);
 721         textInput.paste();
 722         assertEquals(4, textInput.getAnchor());
 723         assertEquals(4, textInput.getCaretPosition());
 724         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 725         assertEquals(&quot;&quot;, textInput.getSelectedText());
 726     }
 727 
 728     @Test public void selectBackwardHasNoEffectWhenCaretPositionIsAlreadyZero() {
 729         textInput.setText(&quot;The quick brown fox&quot;);
 730         textInput.selectRange(3, 0);
 731         textInput.selectBackward();
 732         assertEquals(0, textInput.getCaretPosition());
 733         assertEquals(new IndexRange(0, 3), textInput.getSelection());
 734     }
 735 
 736     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionRightOfAnchor() {
 737         textInput.setText(&quot;The quick brown fox&quot;);
 738         textInput.selectRange(0, 3);
 739         textInput.selectBackward();
 740         assertEquals(2, textInput.getCaretPosition());
 741         assertEquals(new IndexRange(0, 2), textInput.getSelection());
 742     }
 743 
 744     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionEqualsAnchor() {
 745         textInput.setText(&quot;The quick brown fox&quot;);
 746         textInput.selectRange(3, 3);
 747         textInput.selectBackward();
 748         assertEquals(2, textInput.getCaretPosition());
 749         assertEquals(new IndexRange(2, 3), textInput.getSelection());
 750     }
 751 
 752     @Test public void selectBackwardMovesCaretPositionOnePlaceLeft_CaretPositionLeftOfAnchor() {
 753         textInput.setText(&quot;The quick brown fox&quot;);
 754         textInput.selectRange(6, 3);
 755         textInput.selectBackward();
 756         assertEquals(2, textInput.getCaretPosition());
 757         assertEquals(new IndexRange(2, 6), textInput.getSelection());
 758     }
 759 
 760     @Test public void selectForwardHasNoEffectWhenCaretPositionIsAtLength() {
 761         textInput.setText(&quot;The quick brown fox&quot;);
 762         textInput.selectRange(3, 19);
 763         textInput.selectForward();
 764         assertEquals(19, textInput.getCaretPosition());
 765         assertEquals(new IndexRange(3, 19), textInput.getSelection());
 766     }
 767 
 768     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionRightOfAnchor() {
 769         textInput.setText(&quot;The quick brown fox&quot;);
 770         textInput.selectRange(0, 3);
 771         textInput.selectForward();
 772         assertEquals(4, textInput.getCaretPosition());
 773         assertEquals(new IndexRange(0, 4), textInput.getSelection());
 774     }
 775 
 776     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionEqualsAnchor() {
 777         textInput.setText(&quot;The quick brown fox&quot;);
 778         textInput.selectRange(3, 3);
 779         textInput.selectForward();
 780         assertEquals(4, textInput.getCaretPosition());
 781         assertEquals(new IndexRange(3, 4), textInput.getSelection());
 782     }
 783 
 784     @Test public void selectForwardMovesCaretPositionOnePlaceRight_CaretPositionLeftOfAnchor() {
 785         textInput.setText(&quot;The quick brown fox&quot;);
 786         textInput.selectRange(6, 3);
 787         textInput.selectForward();
 788         assertEquals(4, textInput.getCaretPosition());
 789         assertEquals(new IndexRange(4, 6), textInput.getSelection());
 790     }
 791 
 792     @Test public void previousWordWithNoText() {
 793         textInput.previousWord();
 794         assertEquals(0, textInput.getCaretPosition());
 795         assertEquals(0, textInput.getAnchor());
 796         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 797     }
 798 
 799     @Test public void previousWordWithSelection_caretPositionBeforeAnchor() {
 800         textInput.setText(&quot;The quick brown fox&quot;);
 801         textInput.selectRange(15, 10);
 802         textInput.previousWord();
 803         assertEquals(4, textInput.getCaretPosition());
 804         assertEquals(4, textInput.getAnchor());
 805         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 806     }
 807 
 808     @Test public void previousWordWithSelection_caretPositionBeforeAnchor2() {
 809         textInput.setText(&quot;The quick brown fox&quot;);
 810         textInput.selectRange(12, 6);
 811         textInput.previousWord();
 812         assertEquals(4, textInput.getCaretPosition());
 813         assertEquals(4, textInput.getAnchor());
 814         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 815     }
 816 
 817     @Test public void previousWordWithSelection_caretPositionAfterAnchor() {
 818         textInput.setText(&quot;The quick brown fox&quot;);
 819         textInput.selectRange(10, 15);
 820         textInput.previousWord();
 821         assertEquals(10, textInput.getCaretPosition());
 822         assertEquals(10, textInput.getAnchor());
 823         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 824     }
 825 
 826     @Test public void previousWordWithSelection_caretPositionAfterAnchor2() {
 827         textInput.setText(&quot;The quick brown fox&quot;);
 828         textInput.selectRange(6, 12);
 829         textInput.previousWord();
 830         assertEquals(10, textInput.getCaretPosition());
 831         assertEquals(10, textInput.getAnchor());
 832         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 833     }
 834 
 835     @Test public void previousWord_caretWithinAWord() {
 836         textInput.setText(&quot;The quick brown fox&quot;);
 837         textInput.positionCaret(12);
 838         textInput.previousWord();
 839         assertEquals(10, textInput.getCaretPosition());
 840         assertEquals(10, textInput.getAnchor());
 841         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 842     }
 843 
 844     @Test public void previousWord_caretAfterWord() {
 845         textInput.setText(&quot;The quick brown fox&quot;);
 846         textInput.positionCaret(15);
 847         textInput.previousWord();
 848         assertEquals(10, textInput.getCaretPosition());
 849         assertEquals(10, textInput.getAnchor());
 850         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 851     }
 852 
 853     @Test public void previousWord_caretBeforeWord() {
 854         textInput.setText(&quot;The quick brown fox&quot;);
 855         textInput.positionCaret(10);
 856         textInput.previousWord();
 857         assertEquals(4, textInput.getCaretPosition());
 858         assertEquals(4, textInput.getAnchor());
 859         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 860     }
 861 
 862     @Test public void previousWord_caretWithinWhitespace() {
 863         textInput.setText(&quot;The quick  brown fox&quot;);
 864         textInput.positionCaret(10);
 865         textInput.previousWord();
 866         assertEquals(4, textInput.getCaretPosition());
 867         assertEquals(4, textInput.getAnchor());
 868         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 869     }
 870 
 871     @Test public void previousWord_multipleWhitespaceInARow() {
 872         textInput.setText(&quot;The quick  brown fox&quot;);
 873         textInput.positionCaret(11);
 874         textInput.previousWord();
 875         assertEquals(4, textInput.getCaretPosition());
 876         assertEquals(4, textInput.getAnchor());
 877         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 878     }
 879 
 880     @Test public void previousWord_withANumber() {
 881         textInput.setText(&quot;There are 5 cards in the hand&quot;);
 882         textInput.positionCaret(12);
 883         textInput.previousWord();
 884         assertEquals(10, textInput.getCaretPosition());
 885         assertEquals(10, textInput.getAnchor());
 886         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 887     }
 888 
 889     @Test public void previousWord_withALongNumber() {
 890         textInput.setText(&quot;There are 52 cards in the deck&quot;);
 891         textInput.positionCaret(13);
 892         textInput.previousWord();
 893         assertEquals(10, textInput.getCaretPosition());
 894         assertEquals(10, textInput.getAnchor());
 895         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 896     }
 897 
 898     @Test public void nextWordWithNoText() {
 899         textInput.nextWord();
 900         assertEquals(0, textInput.getCaretPosition());
 901         assertEquals(0, textInput.getAnchor());
 902         assertEquals(new IndexRange(0, 0), textInput.getSelection());
 903     }
 904 
 905     @Test public void nextWordWithSelection_caretPositionBeforeAnchor() {
 906         textInput.setText(&quot;The quick brown fox&quot;);
 907         textInput.selectRange(9, 4);
 908         textInput.nextWord();
 909         assertEquals(10, textInput.getCaretPosition());
 910         assertEquals(10, textInput.getAnchor());
 911         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 912     }
 913 
 914     @Test public void nextWordWithSelection_caretPositionBeforeAnchor2() {
 915         textInput.setText(&quot;The quick brown fox&quot;);
 916         textInput.selectRange(9, 2);
 917         textInput.nextWord();
 918         assertEquals(4, textInput.getCaretPosition());
 919         assertEquals(4, textInput.getAnchor());
 920         assertEquals(new IndexRange(4, 4), textInput.getSelection());
 921     }
 922 
 923     @Test public void nextWordWithSelection_caretPositionAfterAnchor() {
 924         textInput.setText(&quot;The quick brown fox&quot;);
 925         textInput.selectRange(4, 9);
 926         textInput.nextWord();
 927         assertEquals(10, textInput.getCaretPosition());
 928         assertEquals(10, textInput.getAnchor());
 929         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 930     }
 931 
 932     @Test public void nextWordWithSelection_caretPositionAfterAnchor2() {
 933         textInput.setText(&quot;The quick brown fox&quot;);
 934         textInput.selectRange(5, 11);
 935         textInput.nextWord();
 936         assertEquals(16, textInput.getCaretPosition());
 937         assertEquals(16, textInput.getAnchor());
 938         assertEquals(new IndexRange(16, 16), textInput.getSelection());
 939     }
 940 
 941     @Test public void nextWord_caretWithinAWord() {
 942         textInput.setText(&quot;The quick brown fox&quot;);
 943         textInput.positionCaret(6);
 944         textInput.nextWord();
 945         assertEquals(10, textInput.getCaretPosition());
 946         assertEquals(10, textInput.getAnchor());
 947         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 948     }
 949 
 950     @Test public void nextWord_caretAfterWord() {
 951         textInput.setText(&quot;The quick brown fox&quot;);
 952         textInput.positionCaret(9);
 953         textInput.nextWord();
 954         assertEquals(10, textInput.getCaretPosition());
 955         assertEquals(10, textInput.getAnchor());
 956         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 957     }
 958 
 959     @Test public void nextWord_caretBeforeWord() {
 960         textInput.setText(&quot;The quick brown fox&quot;);
 961         textInput.positionCaret(4);
 962         textInput.nextWord();
 963         assertEquals(10, textInput.getCaretPosition());
 964         assertEquals(10, textInput.getAnchor());
 965         assertEquals(new IndexRange(10, 10), textInput.getSelection());
 966     }
 967 
 968     @Test public void nextWord_caretWithinWhitespace() {
 969         textInput.setText(&quot;The quick  brown fox&quot;);
 970         textInput.positionCaret(10);
 971         textInput.nextWord();
 972         assertEquals(11, textInput.getCaretPosition());
 973         assertEquals(11, textInput.getAnchor());
 974         assertEquals(new IndexRange(11, 11), textInput.getSelection());
 975     }
 976 
 977     @Test public void nextWord_multipleWhitespaceInARow() {
 978         textInput.setText(&quot;The quick  brown fox&quot;);
 979         textInput.positionCaret(9);
 980         textInput.nextWord();
 981         assertEquals(11, textInput.getCaretPosition());
 982         assertEquals(11, textInput.getAnchor());
 983         assertEquals(new IndexRange(11, 11), textInput.getSelection());
 984     }
 985 
 986     @Test public void nextWord_toTheEnd() {
 987         textInput.setText(&quot;The quick brown fox&quot;);
 988         textInput.positionCaret(16);
 989         textInput.nextWord();
 990         assertEquals(19, textInput.getCaretPosition());
 991         assertEquals(19, textInput.getAnchor());
 992         assertEquals(new IndexRange(19, 19), textInput.getSelection());
 993     }
 994 
 995     @Test public void nextWord_withANumber() {
 996         textInput.setText(&quot;There are 5 cards in the hand&quot;);
 997         textInput.positionCaret(6);
 998         textInput.nextWord();
 999         assertEquals(10, textInput.getCaretPosition());
1000         assertEquals(10, textInput.getAnchor());
1001         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1002     }
1003 
1004     @Test public void nextWord_withALongNumber() {
1005         textInput.setText(&quot;There are 52 cards in the deck&quot;);
1006         textInput.positionCaret(10);
1007         textInput.nextWord();
1008         assertEquals(13, textInput.getCaretPosition());
1009         assertEquals(13, textInput.getAnchor());
1010         assertEquals(new IndexRange(13, 13), textInput.getSelection());
1011     }
1012 
1013     @Test public void endOfNextWordWithNoText() {
1014         textInput.endOfNextWord();
1015         assertEquals(0, textInput.getCaretPosition());
1016         assertEquals(0, textInput.getAnchor());
1017         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1018     }
1019 
1020     @Test public void endOfNextWordWithSelection_caretPositionBeforeAnchor() {
1021         textInput.setText(&quot;The quick brown fox&quot;);
1022         textInput.selectRange(9, 4);
1023         textInput.endOfNextWord();
1024         assertEquals(9, textInput.getCaretPosition());
1025         assertEquals(9, textInput.getAnchor());
1026         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1027     }
1028 
1029     @Test public void endOfNextWordWithSelection_caretPositionBeforeAnchor2() {
1030         textInput.setText(&quot;The quick brown fox&quot;);
1031         textInput.selectRange(9, 2);
1032         textInput.endOfNextWord();
1033         assertEquals(3, textInput.getCaretPosition());
1034         assertEquals(3, textInput.getAnchor());
1035         assertEquals(new IndexRange(3, 3), textInput.getSelection());
1036     }
1037 
1038     @Test public void endOfNextWordWithSelection_caretPositionAfterAnchor() {
1039         textInput.setText(&quot;The quick brown fox&quot;);
1040         textInput.selectRange(4, 9);
1041         textInput.endOfNextWord();
1042         assertEquals(15, textInput.getCaretPosition());
1043         assertEquals(15, textInput.getAnchor());
1044         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1045     }
1046 
1047     @Test public void endOfNextWordWithSelection_caretPositionAfterAnchor2() {
1048         textInput.setText(&quot;The quick brown fox&quot;);
1049         textInput.selectRange(5, 11);
1050         textInput.endOfNextWord();
1051         assertEquals(15, textInput.getCaretPosition());
1052         assertEquals(15, textInput.getAnchor());
1053         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1054     }
1055 
1056     @Test public void endOfNextWord_caretWithinAWord() {
1057         textInput.setText(&quot;The quick brown fox&quot;);
1058         textInput.positionCaret(6);
1059         textInput.endOfNextWord();
1060         assertEquals(9, textInput.getCaretPosition());
1061         assertEquals(9, textInput.getAnchor());
1062         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1063     }
1064 
1065     @Test public void endOfNextWord_caretAfterWord() {
1066         textInput.setText(&quot;The quick brown fox&quot;);
1067         textInput.positionCaret(9);
1068         textInput.endOfNextWord();
1069         assertEquals(15, textInput.getCaretPosition());
1070         assertEquals(15, textInput.getAnchor());
1071         assertEquals(new IndexRange(15, 15), textInput.getSelection());
1072     }
1073 
1074     @Test public void endOfNextWord_caretBeforeWord() {
1075         textInput.setText(&quot;The quick brown fox&quot;);
1076         textInput.positionCaret(4);
1077         textInput.endOfNextWord();
1078         assertEquals(9, textInput.getCaretPosition());
1079         assertEquals(9, textInput.getAnchor());
1080         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1081     }
1082 
1083     @Test public void endOfNextWord_caretWithinWhitespace() {
1084         textInput.setText(&quot;The quick  brown fox&quot;);
1085         textInput.positionCaret(10);
1086         textInput.endOfNextWord();
1087         assertEquals(16, textInput.getCaretPosition());
1088         assertEquals(16, textInput.getAnchor());
1089         assertEquals(new IndexRange(16, 16), textInput.getSelection());
1090     }
1091 
1092     @Test public void endOfNextWord_multipleWhitespaceInARow() {
1093         textInput.setText(&quot;The quick  brown fox&quot;);
1094         textInput.positionCaret(9);
1095         textInput.endOfNextWord();
1096         assertEquals(16, textInput.getCaretPosition());
1097         assertEquals(16, textInput.getAnchor());
1098         assertEquals(new IndexRange(16, 16), textInput.getSelection());
1099     }
1100 
1101     @Test public void endOfNextWord_withANumber() {
1102         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1103         textInput.positionCaret(6);
1104         textInput.endOfNextWord();
1105         assertEquals(9, textInput.getCaretPosition());
1106         assertEquals(9, textInput.getAnchor());
1107         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1108     }
1109 
1110     @Test public void endOfNextWord_withANumber_CaretOnANumber() {
1111         textInput.setText(&quot;There are 5 cards in the hand&quot;);
1112         textInput.positionCaret(10);
1113         textInput.endOfNextWord();
1114         assertEquals(11, textInput.getCaretPosition());
1115         assertEquals(11, textInput.getAnchor());
1116         assertEquals(new IndexRange(11, 11), textInput.getSelection());
1117     }
1118 
1119     @Test public void endOfNextWord_withALongNumber_CaretOnANumber() {
1120         textInput.setText(&quot;There are 52 cards in the deck&quot;);
1121         textInput.positionCaret(10);
1122         textInput.endOfNextWord();
1123         assertEquals(12, textInput.getCaretPosition());
1124         assertEquals(12, textInput.getAnchor());
1125         assertEquals(new IndexRange(12, 12), textInput.getSelection());
1126     }
1127 
1128     @Test public void selectPreviousWordWithNoText() {
1129         textInput.selectPreviousWord();
1130         assertEquals(0, textInput.getCaretPosition());
1131         assertEquals(0, textInput.getAnchor());
1132         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1133     }
1134 
1135     @Test public void selectPreviousWordWithSelection_caretPositionBeforeAnchor() {
1136         textInput.setText(&quot;The quick brown fox&quot;);
1137         textInput.selectRange(15, 10);
1138         textInput.selectPreviousWord();
1139         assertEquals(4, textInput.getCaretPosition());
1140         assertEquals(15, textInput.getAnchor());
1141         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1142     }
1143 
1144     @Test public void selectPreviousWordWithSelection_caretPositionAfterAnchor() {
1145         textInput.setText(&quot;The quick brown fox&quot;);
1146         textInput.selectRange(10, 15);
1147         textInput.selectPreviousWord();
1148         assertEquals(10, textInput.getCaretPosition());
1149         assertEquals(10, textInput.getAnchor());
1150         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1151     }
1152 
1153     @Test public void selectPreviousWordWithSelection_caretPositionAfterAnchor2() {
1154         textInput.setText(&quot;The quick brown fox&quot;);
1155         textInput.selectRange(11, 15);
1156         textInput.selectPreviousWord();
1157         assertEquals(10, textInput.getCaretPosition());
1158         assertEquals(11, textInput.getAnchor());
1159         assertEquals(new IndexRange(10, 11), textInput.getSelection());
1160     }
1161 
1162     @Test public void selectPreviousWord_caretWithinAWord() {
1163         textInput.setText(&quot;The quick brown fox&quot;);
1164         textInput.positionCaret(12);
1165         textInput.selectPreviousWord();
1166         assertEquals(10, textInput.getCaretPosition());
1167         assertEquals(12, textInput.getAnchor());
1168         assertEquals(new IndexRange(10, 12), textInput.getSelection());
1169     }
1170 
1171     @Test public void selectPreviousWord_caretAfterWord() {
1172         textInput.setText(&quot;The quick brown fox&quot;);
1173         textInput.positionCaret(15);
1174         textInput.selectPreviousWord();
1175         assertEquals(10, textInput.getCaretPosition());
1176         assertEquals(15, textInput.getAnchor());
1177         assertEquals(new IndexRange(10, 15), textInput.getSelection());
1178     }
1179 
1180     @Test public void selectPreviousWord_caretBeforeWord() {
1181         textInput.setText(&quot;The quick brown fox&quot;);
1182         textInput.positionCaret(10);
1183         textInput.selectPreviousWord();
1184         assertEquals(4, textInput.getCaretPosition());
1185         assertEquals(10, textInput.getAnchor());
1186         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1187     }
1188 
1189     @Test public void selectPreviousWord_caretWithinWhitespace() {
1190         textInput.setText(&quot;The quick  brown fox&quot;);
1191         textInput.positionCaret(10);
1192         textInput.selectPreviousWord();
1193         assertEquals(4, textInput.getCaretPosition());
1194         assertEquals(10, textInput.getAnchor());
1195         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1196     }
1197 
1198     @Test public void selectPreviousWord_multipleWhitespaceInARow() {
1199         textInput.setText(&quot;The quick  brown fox&quot;);
1200         textInput.positionCaret(11);
1201         textInput.selectPreviousWord();
1202         assertEquals(4, textInput.getCaretPosition());
1203         assertEquals(11, textInput.getAnchor());
1204         assertEquals(new IndexRange(4, 11), textInput.getSelection());
1205     }
1206 
1207     @Test public void selectNextWordWithNoText() {
1208         textInput.selectNextWord();
1209         assertEquals(0, textInput.getCaretPosition());
1210         assertEquals(0, textInput.getAnchor());
1211         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1212     }
1213 
1214     @Test public void selectNextWordWithSelection_caretPositionBeforeAnchor() {
1215         textInput.setText(&quot;The quick brown fox&quot;);
1216         textInput.selectRange(9, 4);
1217         textInput.selectNextWord();
1218         assertEquals(10, textInput.getCaretPosition());
1219         assertEquals(9, textInput.getAnchor());
1220         assertEquals(new IndexRange(9, 10), textInput.getSelection());
1221     }
1222 
1223     @Test public void selectNextWordWithSelection_caretPositionBeforeAnchor2() {
1224         textInput.setText(&quot;The quick brown fox&quot;);
1225         textInput.selectRange(9, 2);
1226         textInput.selectNextWord();
1227         assertEquals(4, textInput.getCaretPosition());
1228         assertEquals(9, textInput.getAnchor());
1229         assertEquals(new IndexRange(4, 9), textInput.getSelection());
1230     }
1231 
1232     @Test public void selectNextWordWithSelection_caretPositionAfterAnchor() {
1233         textInput.setText(&quot;The quick brown fox&quot;);
1234         textInput.selectRange(4, 9);
1235         textInput.selectNextWord();
1236         assertEquals(10, textInput.getCaretPosition());
1237         assertEquals(4, textInput.getAnchor());
1238         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1239     }
1240 
1241     @Test public void selectNextWordWithSelection_caretPositionAfterAnchor2() {
1242         textInput.setText(&quot;The quick brown fox&quot;);
1243         textInput.selectRange(5, 11);
1244         textInput.selectNextWord();
1245         assertEquals(16, textInput.getCaretPosition());
1246         assertEquals(5, textInput.getAnchor());
1247         assertEquals(new IndexRange(5, 16), textInput.getSelection());
1248     }
1249 
1250     @Test public void selectNextWord_caretWithinAWord() {
1251         textInput.setText(&quot;The quick brown fox&quot;);
1252         textInput.positionCaret(6);
1253         textInput.selectNextWord();
1254         assertEquals(10, textInput.getCaretPosition());
1255         assertEquals(6, textInput.getAnchor());
1256         assertEquals(new IndexRange(6, 10), textInput.getSelection());
1257     }
1258 
1259     @Test public void selectNextWord_caretAfterWord() {
1260         textInput.setText(&quot;The quick brown fox&quot;);
1261         textInput.positionCaret(9);
1262         textInput.selectNextWord();
1263         assertEquals(10, textInput.getCaretPosition());
1264         assertEquals(9, textInput.getAnchor());
1265         assertEquals(new IndexRange(9, 10), textInput.getSelection());
1266     }
1267 
1268     @Test public void selectNextWord_caretBeforeWord() {
1269         textInput.setText(&quot;The quick brown fox&quot;);
1270         textInput.positionCaret(4);
1271         textInput.selectNextWord();
1272         assertEquals(10, textInput.getCaretPosition());
1273         assertEquals(4, textInput.getAnchor());
1274         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1275     }
1276 
1277     @Test public void selectNextWord_caretWithinWhitespace() {
1278         textInput.setText(&quot;The quick  brown fox&quot;);
1279         textInput.positionCaret(10);
1280         textInput.selectNextWord();
1281         assertEquals(11, textInput.getCaretPosition());
1282         assertEquals(10, textInput.getAnchor());
1283         assertEquals(new IndexRange(10, 11), textInput.getSelection());
1284     }
1285 
1286     @Test public void selectNextWord_multipleWhitespaceInARow() {
1287         textInput.setText(&quot;The quick  brown fox&quot;);
1288         textInput.positionCaret(9);
1289         textInput.selectNextWord();
1290         assertEquals(11, textInput.getCaretPosition());
1291         assertEquals(9, textInput.getAnchor());
1292         assertEquals(new IndexRange(9, 11), textInput.getSelection());
1293     }
1294 
1295     @Test public void selectNextWord_toTheEnd() {
1296         textInput.setText(&quot;The quick brown fox&quot;);
1297         textInput.positionCaret(16);
1298         textInput.selectNextWord();
1299         assertEquals(19, textInput.getCaretPosition());
1300         assertEquals(16, textInput.getAnchor());
1301         assertEquals(new IndexRange(16, 19), textInput.getSelection());
1302     }
1303 
1304     @Test public void selectEndOfNextWordWithNoText() {
1305         textInput.selectEndOfNextWord();
1306         assertEquals(0, textInput.getCaretPosition());
1307         assertEquals(0, textInput.getAnchor());
1308         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1309     }
1310 
1311     @Test public void selectEndOfNextWordWithSelection_caretPositionBeforeAnchor() {
1312         textInput.setText(&quot;The quick brown fox&quot;);
1313         textInput.selectRange(9, 4);
1314         textInput.selectEndOfNextWord();
1315         assertEquals(9, textInput.getCaretPosition());
1316         assertEquals(9, textInput.getAnchor());
1317         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1318     }
1319 
1320     @Test public void selectEndOfNextWordWithSelection_caretPositionBeforeAnchor2() {
1321         textInput.setText(&quot;The quick brown fox&quot;);
1322         textInput.selectRange(9, 2);
1323         textInput.selectEndOfNextWord();
1324         assertEquals(3, textInput.getCaretPosition());
1325         assertEquals(9, textInput.getAnchor());
1326         assertEquals(new IndexRange(3, 9), textInput.getSelection());
1327     }
1328 
1329     @Test public void selectEndOfNextWordWithSelection_caretPositionAfterAnchor() {
1330         textInput.setText(&quot;The quick brown fox&quot;);
1331         textInput.selectRange(4, 9);
1332         textInput.selectEndOfNextWord();
1333         assertEquals(15, textInput.getCaretPosition());
1334         assertEquals(4, textInput.getAnchor());
1335         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1336     }
1337 
1338     @Test public void selectEndOfNextWordWithSelection_caretPositionAfterAnchor2() {
1339         textInput.setText(&quot;The quick brown fox&quot;);
1340         textInput.selectRange(5, 11);
1341         textInput.selectEndOfNextWord();
1342         assertEquals(15, textInput.getCaretPosition());
1343         assertEquals(5, textInput.getAnchor());
1344         assertEquals(new IndexRange(5, 15), textInput.getSelection());
1345     }
1346 
1347     @Test public void selectEndOfNextWord_caretWithinAWord() {
1348         textInput.setText(&quot;The quick brown fox&quot;);
1349         textInput.positionCaret(6);
1350         textInput.selectEndOfNextWord();
1351         assertEquals(9, textInput.getCaretPosition());
1352         assertEquals(6, textInput.getAnchor());
1353         assertEquals(new IndexRange(6, 9), textInput.getSelection());
1354     }
1355 
1356     @Test public void selectEndOfNextWord_caretAfterWord() {
1357         textInput.setText(&quot;The quick brown fox&quot;);
1358         textInput.positionCaret(9);
1359         textInput.selectEndOfNextWord();
1360         assertEquals(15, textInput.getCaretPosition());
1361         assertEquals(9, textInput.getAnchor());
1362         assertEquals(new IndexRange(9, 15), textInput.getSelection());
1363     }
1364 
1365     @Test public void selectEndOfNextWord_caretBeforeWord() {
1366         textInput.setText(&quot;The quick brown fox&quot;);
1367         textInput.positionCaret(4);
1368         textInput.selectEndOfNextWord();
1369         assertEquals(9, textInput.getCaretPosition());
1370         assertEquals(4, textInput.getAnchor());
1371         assertEquals(new IndexRange(4, 9), textInput.getSelection());
1372     }
1373 
1374     @Test public void selectEndOfNextWord_caretWithinWhitespace() {
1375         textInput.setText(&quot;The quick  brown fox&quot;);
1376         textInput.positionCaret(10);
1377         textInput.selectEndOfNextWord();
1378         assertEquals(16, textInput.getCaretPosition());
1379         assertEquals(10, textInput.getAnchor());
1380         assertEquals(new IndexRange(10, 16), textInput.getSelection());
1381     }
1382 
1383     @Test public void selectEndOfNextWord_multipleWhitespaceInARow() {
1384         textInput.setText(&quot;The quick  brown fox&quot;);
1385         textInput.positionCaret(9);
1386         textInput.selectEndOfNextWord();
1387         assertEquals(16, textInput.getCaretPosition());
1388         assertEquals(9, textInput.getAnchor());
1389         assertEquals(new IndexRange(9, 16), textInput.getSelection());
1390     }
1391 
1392     @Test public void selectAllWithNoText() {
1393         textInput.setText(&quot;&quot;);
1394         textInput.selectAll();
1395         assertEquals(0, textInput.getCaretPosition());
1396         assertEquals(0, textInput.getAnchor());
1397         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1398     }
1399 
1400     @Test public void selectAllWithText_caretPositionIsAlwaysAtTheEnd() {
1401         textInput.setText(&quot;The quick brown fox&quot;);
1402         textInput.selectAll();
1403         assertEquals(19, textInput.getCaretPosition());
1404         assertEquals(0, textInput.getAnchor());
1405         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1406     }
1407 
1408     @Test public void homeClearsSelection() {
1409         textInput.setText(&quot;The quick brown fox&quot;);
1410         textInput.selectRange(4, 9);
1411         textInput.home();
1412         assertEquals(0, textInput.getCaretPosition());
1413         assertEquals(0, textInput.getAnchor());
1414         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1415     }
1416 
1417     @Test public void endClearsSelection() {
1418         textInput.setText(&quot;The quick brown fox&quot;);
1419         textInput.selectRange(4, 9);
1420         textInput.end();
1421         assertEquals(19, textInput.getCaretPosition());
1422         assertEquals(19, textInput.getAnchor());
1423         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1424     }
1425 
1426     @Test public void selectHomeHasNoEffectWhenCaretPositionIsAtZero() {
1427         textInput.setText(&quot;The quick brown fox&quot;);
1428         textInput.selectRange(3, 0);
1429         textInput.selectHome();
1430         assertEquals(0, textInput.getCaretPosition());
1431         assertEquals(3, textInput.getAnchor());
1432         assertEquals(new IndexRange(0, 3), textInput.getSelection());
1433     }
1434 
1435     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionRightOfAnchor() {
1436         textInput.setText(&quot;The quick brown fox&quot;);
1437         textInput.selectRange(4, 9);
1438         textInput.selectHome();
1439         assertEquals(0, textInput.getCaretPosition());
1440         assertEquals(4, textInput.getAnchor());
1441         assertEquals(new IndexRange(0, 4), textInput.getSelection());
1442     }
1443 
1444     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionEqualsAnchor() {
1445         textInput.setText(&quot;The quick brown fox&quot;);
1446         textInput.selectRange(3, 3);
1447         textInput.selectHome();
1448         assertEquals(0, textInput.getCaretPosition());
1449         assertEquals(3, textInput.getAnchor());
1450         assertEquals(new IndexRange(0, 3), textInput.getSelection());
1451     }
1452 
1453     @Test public void selectHomeMovesCaretPositionToZero_CaretPositionLeftOfAnchor() {
1454         textInput.setText(&quot;The quick brown fox&quot;);
1455         textInput.selectRange(6, 3);
1456         textInput.selectHome();
1457         assertEquals(0, textInput.getCaretPosition());
1458         assertEquals(6, textInput.getAnchor());
1459         assertEquals(new IndexRange(0, 6), textInput.getSelection());
1460     }
1461 
1462     @Test public void selectEndHasNoEffectWhenCaretPositionIsAtLength() {
1463         textInput.setText(&quot;The quick brown fox&quot;);
1464         textInput.selectRange(3, 19);
1465         textInput.selectEnd();
1466         assertEquals(19, textInput.getCaretPosition());
1467         assertEquals(3, textInput.getAnchor());
1468         assertEquals(new IndexRange(3, 19), textInput.getSelection());
1469     }
1470 
1471     @Test public void selectEndMovesCaretPositionToLength_CaretPositionRightOfAnchor() {
1472         textInput.setText(&quot;The quick brown fox&quot;);
1473         textInput.selectRange(0, 3);
1474         textInput.selectEnd();
1475         assertEquals(19, textInput.getCaretPosition());
1476         assertEquals(0, textInput.getAnchor());
1477         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1478     }
1479 
1480     @Test public void selectEndMovesCaretPositionToLength_CaretPositionEqualsAnchor() {
1481         textInput.setText(&quot;The quick brown fox&quot;);
1482         textInput.selectRange(3, 3);
1483         textInput.selectEnd();
1484         assertEquals(19, textInput.getCaretPosition());
1485         assertEquals(3, textInput.getAnchor());
1486         assertEquals(new IndexRange(3, 19), textInput.getSelection());
1487     }
1488 
1489     @Test public void selectEndMovesCaretPositionToLength_CaretPositionLeftOfAnchor() {
1490         textInput.setText(&quot;The quick brown fox&quot;);
1491         textInput.selectRange(6, 3);
1492         textInput.selectEnd();
1493         assertEquals(19, textInput.getCaretPosition());
1494         assertEquals(6, textInput.getAnchor());
1495         assertEquals(new IndexRange(6, 19), textInput.getSelection());
1496     }
1497 
1498     @Test public void deletePreviousCharDeletesOnlySelectedText_anchorLessThanCaretPosition() {
1499         textInput.setText(&quot;The quick brown fox&quot;);
1500         textInput.selectRange(4, 10);
1501         textInput.deletePreviousChar();
1502         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1503         assertEquals(4, textInput.getCaretPosition());
1504         assertEquals(4, textInput.getAnchor());
1505         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1506     }
1507 
1508     @Test public void deletePreviousCharDeletesOnlySelectedText_caretPositionLessThanAnchor() {
1509         textInput.setText(&quot;The quick brown fox&quot;);
1510         textInput.selectRange(10, 4);
1511         textInput.deletePreviousChar();
1512         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1513         assertEquals(4, textInput.getCaretPosition());
1514         assertEquals(4, textInput.getAnchor());
1515         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1516     }
1517 
1518     @Test public void deletePreviousCharDeletesPreviousCharWhenCaretPositionEqualsAnchor() {
1519         textInput.setText(&quot;The quick brown fox&quot;);
1520         textInput.selectRange(10, 10);
1521         textInput.deletePreviousChar();
1522         assertEquals(&quot;The quickbrown fox&quot;, textInput.getText());
1523         assertEquals(9, textInput.getCaretPosition());
1524         assertEquals(9, textInput.getAnchor());
1525         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1526     }
1527 
1528     @Test public void deletePreviousCharDoesNothingWhenSelectionIs0_0() {
1529         textInput.setText(&quot;The quick brown fox&quot;);
1530         textInput.selectRange(0, 0);
1531         textInput.deletePreviousChar();
1532         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
1533         assertEquals(0, textInput.getCaretPosition());
1534         assertEquals(0, textInput.getAnchor());
1535         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1536     }
1537 
1538     @Test public void deleteNextCharDeletesOnlySelectedText_anchorLessThanCaretPosition() {
1539         textInput.setText(&quot;The quick brown fox&quot;);
1540         textInput.selectRange(4, 10);
1541         textInput.deleteNextChar();
1542         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1543         assertEquals(4, textInput.getCaretPosition());
1544         assertEquals(4, textInput.getAnchor());
1545         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1546     }
1547 
1548     @Test public void deleteNextCharDeletesOnlySelectedText_caretPositionLessThanAnchor() {
1549         textInput.setText(&quot;The quick brown fox&quot;);
1550         textInput.selectRange(10, 4);
1551         textInput.deleteNextChar();
1552         assertEquals(&quot;The brown fox&quot;, textInput.getText());
1553         assertEquals(4, textInput.getCaretPosition());
1554         assertEquals(4, textInput.getAnchor());
1555         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1556     }
1557 
1558     @Test public void deleteNextCharDeletesNextCharWhenCaretPositionEqualsAnchor() {
1559         textInput.setText(&quot;The quick brown fox&quot;);
1560         textInput.selectRange(10, 10);
1561         textInput.deleteNextChar();
1562         assertEquals(&quot;The quick rown fox&quot;, textInput.getText());
1563         assertEquals(10, textInput.getCaretPosition());
1564         assertEquals(10, textInput.getAnchor());
1565         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1566     }
1567 
1568     @Test public void deleteNextCharDoesNothingWhenSelectionIsEmptyAtEnd() {
1569         textInput.setText(&quot;The quick brown fox&quot;);
1570         textInput.selectRange(19, 19);
1571         textInput.deleteNextChar();
1572         assertEquals(&quot;The quick brown fox&quot;, textInput.getText());
1573         assertEquals(19, textInput.getCaretPosition());
1574         assertEquals(19, textInput.getAnchor());
1575         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1576     }
1577 
1578     @Test public void forwardSkipsSelection() {
1579         textInput.setText(&quot;The quick brown fox&quot;);
1580         textInput.selectRange(4, 9);
1581         textInput.forward();
1582         assertEquals(9, textInput.getCaretPosition());
1583         assertEquals(9, textInput.getAnchor());
1584         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1585     }
1586 
1587     @Test public void forwardSkipsSelection2() {
1588         textInput.setText(&quot;The quick brown fox&quot;);
1589         textInput.selectRange(9, 4);
1590         textInput.forward();
1591         assertEquals(9, textInput.getCaretPosition());
1592         assertEquals(9, textInput.getAnchor());
1593         assertEquals(new IndexRange(9, 9), textInput.getSelection());
1594     }
1595 
1596     @Test public void forwardMovesForwardWhenNotAtEnd() {
1597         textInput.setText(&quot;The quick brown fox&quot;);
1598         textInput.selectRange(0, 0);
1599         textInput.forward();
1600         assertEquals(1, textInput.getCaretPosition());
1601         assertEquals(1, textInput.getAnchor());
1602         assertEquals(new IndexRange(1, 1), textInput.getSelection());
1603     }
1604 
1605     @Test public void forwardDoesNothingWhenAtEnd() {
1606         textInput.setText(&quot;The quick brown fox&quot;);
1607         textInput.selectRange(19, 19);
1608         textInput.forward();
1609         assertEquals(19, textInput.getCaretPosition());
1610         assertEquals(19, textInput.getAnchor());
1611         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1612     }
1613 
1614     @Test public void backwardSkipsSelection() {
1615         textInput.setText(&quot;The quick brown fox&quot;);
1616         textInput.selectRange(4, 9);
1617         textInput.backward();
1618         assertEquals(4, textInput.getCaretPosition());
1619         assertEquals(4, textInput.getAnchor());
1620         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1621     }
1622 
1623     @Test public void backwardSkipsSelection2() {
1624         textInput.setText(&quot;The quick brown fox&quot;);
1625         textInput.selectRange(9, 4);
1626         textInput.backward();
1627         assertEquals(4, textInput.getCaretPosition());
1628         assertEquals(4, textInput.getAnchor());
1629         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1630     }
1631 
1632     @Test public void backwardMovesBackwardWhenNotAtStart() {
1633         textInput.setText(&quot;The quick brown fox&quot;);
1634         textInput.positionCaret(14);
1635         textInput.backward();
1636         assertEquals(13, textInput.getCaretPosition());
1637         assertEquals(13, textInput.getAnchor());
1638         assertEquals(new IndexRange(13, 13), textInput.getSelection());
1639     }
1640 
1641     @Test public void backwardDoesNothingWhenAtStart() {
1642         textInput.setText(&quot;The quick brown fox&quot;);
1643         textInput.selectRange(0, 0);
1644         textInput.backward();
1645         assertEquals(0, textInput.getCaretPosition());
1646         assertEquals(0, textInput.getAnchor());
1647         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1648     }
1649 
1650     @Test public void positionCaretAtStart() {
1651         textInput.setText(&quot;The quick brown fox&quot;);
1652         textInput.positionCaret(0);
1653         assertEquals(0, textInput.getCaretPosition());
1654         assertEquals(0, textInput.getAnchor());
1655         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1656     }
1657 
1658     @Test public void positionCaretInMiddle() {
1659         textInput.setText(&quot;The quick brown fox&quot;);
1660         textInput.positionCaret(10);
1661         assertEquals(10, textInput.getCaretPosition());
1662         assertEquals(10, textInput.getAnchor());
1663         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1664     }
1665 
1666     @Test public void positionCaretAtEnd() {
1667         textInput.setText(&quot;The quick brown fox&quot;);
1668         textInput.positionCaret(19);
1669         assertEquals(19, textInput.getCaretPosition());
1670         assertEquals(19, textInput.getAnchor());
1671         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1672     }
1673 
1674     @Test public void positionCaretBeyondStartClamps() {
1675         textInput.setText(&quot;The quick brown fox&quot;);
1676         textInput.positionCaret(-10);
1677         assertEquals(0, textInput.getCaretPosition());
1678         assertEquals(0, textInput.getAnchor());
1679         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1680     }
1681 
1682     @Test public void positionCaretBeyondEndClamps() {
1683         textInput.setText(&quot;The quick brown fox&quot;);
1684         textInput.positionCaret(1000);
1685         assertEquals(19, textInput.getCaretPosition());
1686         assertEquals(19, textInput.getAnchor());
1687         assertEquals(new IndexRange(19, 19), textInput.getSelection());
1688     }
1689 
1690     @Test public void selectPositionCaretWhenAnchorAndCaretAreBothZero() {
1691         textInput.setText(&quot;The quick brown fox&quot;);
1692         textInput.selectRange(0, 0);
1693         textInput.selectPositionCaret(10);
1694         assertEquals(10, textInput.getCaretPosition());
1695         assertEquals(0, textInput.getAnchor());
1696         assertEquals(new IndexRange(0, 10), textInput.getSelection());
1697     }
1698 
1699     @Test public void selectPositionCaret_anchorLessThanCaretPosition() {
1700         textInput.setText(&quot;The quick brown fox&quot;);
1701         textInput.selectRange(4, 10);
1702         textInput.selectPositionCaret(1);
1703         assertEquals(1, textInput.getCaretPosition());
1704         assertEquals(4, textInput.getAnchor());
1705         assertEquals(new IndexRange(1, 4), textInput.getSelection());
1706     }
1707 
1708     @Test public void selectPositionCaret_anchorLessThanCaretPosition2() {
1709         textInput.setText(&quot;The quick brown fox&quot;);
1710         textInput.selectRange(4, 10);
1711         textInput.selectPositionCaret(15);
1712         assertEquals(15, textInput.getCaretPosition());
1713         assertEquals(4, textInput.getAnchor());
1714         assertEquals(new IndexRange(4, 15), textInput.getSelection());
1715     }
1716 
1717     @Test public void selectPositionCaret_anchorLessThanCaretPosition3() {
1718         textInput.setText(&quot;The quick brown fox&quot;);
1719         textInput.selectRange(4, 10);
1720         textInput.selectPositionCaret(4);
1721         assertEquals(4, textInput.getCaretPosition());
1722         assertEquals(4, textInput.getAnchor());
1723         assertEquals(new IndexRange(4, 4), textInput.getSelection());
1724     }
1725 
1726     @Test public void selectPositionCaret_caretPositionLessThanAnchor() {
1727         textInput.setText(&quot;The quick brown fox&quot;);
1728         textInput.selectRange(10, 4);
1729         textInput.selectPositionCaret(1);
1730         assertEquals(1, textInput.getCaretPosition());
1731         assertEquals(10, textInput.getAnchor());
1732         assertEquals(new IndexRange(1, 10), textInput.getSelection());
1733     }
1734 
1735     @Test public void selectPositionCaret_caretPositionLessThanAnchor2() {
1736         textInput.setText(&quot;The quick brown fox&quot;);
1737         textInput.selectRange(10, 4);
1738         textInput.selectPositionCaret(14);
1739         assertEquals(14, textInput.getCaretPosition());
1740         assertEquals(10, textInput.getAnchor());
1741         assertEquals(new IndexRange(10, 14), textInput.getSelection());
1742     }
1743 
1744     @Test public void selectPositionCaret_caretPositionLessThanAnchor3() {
1745         textInput.setText(&quot;The quick brown fox&quot;);
1746         textInput.selectRange(10, 4);
1747         textInput.selectPositionCaret(10);
1748         assertEquals(10, textInput.getCaretPosition());
1749         assertEquals(10, textInput.getAnchor());
1750         assertEquals(new IndexRange(10, 10), textInput.getSelection());
1751     }
1752 
1753     @Test public void selectPositionCaretWhenCaretPositionEqualsAnchor() {
1754         textInput.setText(&quot;The quick brown fox&quot;);
1755         textInput.selectRange(10, 10);
1756         textInput.selectPositionCaret(4);
1757         assertEquals(4, textInput.getCaretPosition());
1758         assertEquals(10, textInput.getAnchor());
1759         assertEquals(new IndexRange(4, 10), textInput.getSelection());
1760     }
1761 
1762     @Test public void selectPositionCaretWhenCaretPositionEqualsAnchor2() {
1763         textInput.setText(&quot;The quick brown fox&quot;);
1764         textInput.selectRange(10, 10);
1765         textInput.selectPositionCaret(14);
1766         assertEquals(14, textInput.getCaretPosition());
1767         assertEquals(10, textInput.getAnchor());
1768         assertEquals(new IndexRange(10, 14), textInput.getSelection());
1769     }
1770 
1771     @Test public void extendSelectionWithNoText() {
1772         textInput.extendSelection(0);
1773         assertEquals(0, textInput.getCaretPosition());
1774         assertEquals(0, textInput.getAnchor());
1775         assertEquals(new IndexRange(0, 0), textInput.getSelection());
1776     }
1777 
1778     @Test public void extendSelectionWithOutOfRangePos() {
1779         textInput.setText(&quot;The quick brown fox&quot;);
1780         textInput.selectRange(0, 0);
1781         textInput.extendSelection(1000);
1782         assertEquals(19, textInput.getCaretPosition());
1783         assertEquals(0, textInput.getAnchor());
1784         assertEquals(new IndexRange(0, 19), textInput.getSelection());
1785     }
1786 
1787     @Test public void extendSelectionWithOutOfRangePos2() {
1788         textInput.setText(&quot;The quick brown fox&quot;);
1789         textInput.positionCaret(4);
1790         textInput.extendSelection(-19);
1791         assertEquals(0, textInput.getCaretPosition());
1792         assertEquals(4, textInput.getAnchor());
1793         assertEquals(new IndexRange(0, 4), textInput.getSelection());
1794     }
1795 
1796     @Test public void test_rt26250_caret_issue_for_thai_characters() {
1797         // Thai string containing two characters, consisting of three
1798         // codepoints each.
1799         String thaiStr = &quot;\u0E17\u0E35\u0E48\u0E17\u0E35\u0E48&quot;;
1800         textInput.setText(thaiStr);
1801         textInput.positionCaret(0);
1802 
1803         // Step past one character
1804         textInput.forward();
1805         assertEquals(3, textInput.getCaretPosition());
1806 
1807         // Goto beginning
1808         textInput.backward();
1809         assertEquals(0, textInput.getCaretPosition());
1810 
1811         // Delete entire first character forwards
1812         textInput.deleteNextChar();
1813         assertEquals(&quot;\u0E17\u0E35\u0E48&quot;, textInput.getText());
1814 
1815         // Break up and delete remaining character backwards in three steps
1816         textInput.forward();
1817         textInput.deletePreviousChar();
1818         assertEquals(&quot;\u0E17\u0E35&quot;, textInput.getText());
1819         textInput.deletePreviousChar();
1820         assertEquals(&quot;\u0E17&quot;, textInput.getText());
1821         textInput.deletePreviousChar();
1822         assertEquals(&quot;&quot;, textInput.getText());
1823     }
1824 
1825     @Test public void test_rt40376_delete_next_when_text_is_null() {
1826         textInput.setText(null);
1827         textInput.deleteNextChar();
1828     }
1829 
1830     @Test public void test_jdk_8171229_replaceText() {
1831         textInput.setText(&quot;&quot;);
1832         assertEquals(&quot;&quot;, textInput.getText());
1833 
1834         textInput.replaceText(0, 0, &quot;a&quot;);
1835         assertEquals(&quot;a&quot;, textInput.getText());
1836 
1837         textInput.replaceText(1, 1, &quot;b&quot;);
1838         assertEquals(&quot;ab&quot;, textInput.getText());
1839 
1840         textInput.replaceText(2, 2, &quot;c&quot;);
1841         assertEquals(&quot;abc&quot;, textInput.getText());
1842 
1843         textInput.replaceText(3, 3, &quot;d&quot;);
1844         assertEquals(&quot;abcd&quot;, textInput.getText());
1845 
1846         textInput.replaceText(3, 4, &quot;efg&quot;);
1847         assertEquals(&quot;abcefg&quot;, textInput.getText());
1848 
1849         textInput.replaceText(3, 6, &quot;d&quot;);
1850         assertEquals(&quot;abcd&quot;, textInput.getText());
1851 
1852         textInput.replaceText(0, 4, &quot;&quot;);
1853         assertEquals(&quot;&quot;, textInput.getText());
1854 
1855         textInput.undo();
1856         assertEquals(&quot;abcd&quot;, textInput.getText());
1857 
1858         textInput.undo();
1859         assertEquals(&quot;abcefg&quot;, textInput.getText());
1860 
1861         textInput.undo();
1862         assertEquals(&quot;abcd&quot;, textInput.getText());
1863 
1864         textInput.undo();
1865         assertEquals(&quot;&quot;, textInput.getText());
1866     }
1867 
1868     // Test for JDK-8178418
1869     @Test public void UndoRedoSpaceSequence() {
1870         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1871         StackPane root = new StackPane();
1872         Scene scene = new Scene(root);
1873         Stage stage = new Stage();
1874         String text = &quot;123456789&quot;;
1875         String tempText = &quot;&quot;;
1876 
1877         textInput.setText(text);
1878         stage.setScene(scene);
1879         root.getChildren().removeAll();
1880         root.getChildren().add(textInput);
1881         stage.show();
1882         tk.firePulse();
1883 
1884         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1885 
1886         // Test sequence of spaces
1887         keyboard.doKeyPress(KeyCode.HOME);
1888         tk.firePulse();
1889         for (int i = 0; i &lt; 10; ++i) {
1890             keyboard.doKeyTyped(KeyCode.SPACE);
1891             tk.firePulse();
1892             tempText += &quot; &quot;;
1893         }
1894         assertTrue(textInput.getText().equals(tempText + text));
1895 
1896         textInput.undo();
1897         assertTrue(textInput.getText().equals(text));
1898 
1899         textInput.redo();
1900         assertTrue(textInput.getText().equals(tempText + text));
1901 
1902         root.getChildren().removeAll();
1903         stage.hide();
1904         tk.firePulse();
1905     }
1906 
1907     // Test for JDK-8178418
1908     @Test public void UndoRedoReverseSpaceSequence() {
1909         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1910         StackPane root = new StackPane();
1911         Scene scene = new Scene(root);
1912         Stage stage = new Stage();
1913         String text = &quot;123456789&quot;;
1914         String tempText = &quot;&quot;;
1915 
1916         textInput.setText(text);
1917         stage.setScene(scene);
1918         root.getChildren().removeAll();
1919         root.getChildren().add(textInput);
1920         stage.show();
1921         tk.firePulse();
1922 
1923         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1924         // Test reverse sequence of spaces
1925         keyboard.doKeyPress(KeyCode.HOME);
1926         tk.firePulse();
1927         for (int i = 0; i &lt; 10; ++i) {
1928             keyboard.doKeyTyped(KeyCode.SPACE);
1929             keyboard.doKeyPress(KeyCode.LEFT);
1930             tk.firePulse();
1931             tempText += &quot; &quot;;
1932             assertTrue(textInput.getText().equals(tempText + text));
1933         }
1934 
1935         for (int i = 0; i &lt; 10; ++i) {
1936             textInput.undo();
1937             tk.firePulse();
1938         }
1939         assertTrue(textInput.getText().equals(text));
1940 
1941         tempText = &quot;&quot;;
1942         for (int i = 0; i &lt; 10; ++i) {
1943             textInput.redo();
1944             tk.firePulse();
1945             tempText += &quot; &quot;;
1946             assertTrue(textInput.getText().equals(tempText + text));
1947         }
1948 
1949         root.getChildren().removeAll();
1950         stage.hide();
1951         tk.firePulse();
1952     }
1953 
1954     // Test for JDK-8178418
1955     @Test public void UndoRedoWords() {
1956         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
1957         StackPane root = new StackPane();
1958         Scene scene = new Scene(root);
1959         Stage stage = new Stage();
1960         String text = &quot;123456789&quot;;
1961         String tempText = &quot;&quot;;
1962 
1963         textInput.setText(text);
1964         stage.setScene(scene);
1965         root.getChildren().removeAll();
1966         root.getChildren().add(textInput);
1967         stage.show();
1968         tk.firePulse();
1969 
1970         KeyEventFirer keyboard = new KeyEventFirer(textInput);
1971 
1972         // Test words separated by space
1973         keyboard.doKeyPress(KeyCode.HOME);
1974         tk.firePulse();
1975         for (int i = 0; i &lt; 10; ++i) {
1976             keyboard.doKeyTyped(KeyCode.SPACE);
1977             keyboard.doKeyTyped(KeyCode.A);
1978             keyboard.doKeyTyped(KeyCode.B);
1979             tk.firePulse();
1980             tempText += &quot; AB&quot;;
1981             assertTrue(textInput.getText().equals(tempText + text));
1982         }
1983 
1984         for (int i = 0; i &lt; 10; ++i) {
1985             textInput.undo();
1986             tk.firePulse();
1987         }
1988         assertTrue(textInput.getText().equals(text));
1989 
1990         tempText = &quot;&quot;;
1991         for (int i = 0; i &lt; 10; ++i) {
1992             textInput.redo();
1993             tk.firePulse();
1994             tempText += &quot; AB&quot;;
1995             assertTrue(textInput.getText().equals(tempText + text));
1996         }
1997 
1998         root.getChildren().removeAll();
1999         stage.hide();
2000         tk.firePulse();
2001     }
2002 
2003     // Test for JDK-8178418
2004     @Test public void UndoRedoTimestampBased() {
2005         Toolkit tk = (StubToolkit)Toolkit.getToolkit();
2006         StackPane root = new StackPane();
2007         Scene scene = new Scene(root);
2008         Stage stage = new Stage();
2009         String text = &quot;123456789&quot;;
2010         String tempText = &quot;&quot;;
2011 
2012         textInput.setText(text);
2013         stage.setScene(scene);
2014         root.getChildren().removeAll();
2015         root.getChildren().add(textInput);
2016         stage.show();
2017         tk.firePulse();
2018 
2019         KeyEventFirer keyboard = new KeyEventFirer(textInput);
2020 
2021         // Test continuos sequence of characters.
2022         // In this case an undo-redo record is added after 2500 milliseconds.
2023         keyboard.doKeyPress(KeyCode.HOME);
2024         tk.firePulse();
2025 
2026         long startTime = System.currentTimeMillis();
2027         while (System.currentTimeMillis() - startTime &lt; 4000) {
2028 
2029             keyboard.doKeyTyped(KeyCode.A);
2030             tk.firePulse();
2031             tempText += &quot;A&quot;;
2032             assertTrue(textInput.getText().equals(tempText + text));
2033         }
2034 
2035         textInput.undo();
2036         assertFalse(textInput.getText().equals(text));
2037         textInput.undo();
2038         tk.firePulse();
2039         assertTrue(textInput.getText().equals(text));
2040 
2041         root.getChildren().removeAll();
2042         stage.hide();
2043         tk.firePulse();
2044     }
2045 
2046     // TODO tests for Content firing event notification properly
2047 
2048     // TODO tests for Content not allowing illegal characters
2049 
2050     private void copy(String string) {
2051         ClipboardContent content = new ClipboardContent();
2052         content.putString(string);
2053         Clipboard.getSystemClipboard().setContent(content);
2054     }
2055 }
    </pre>
  </body>
</html>