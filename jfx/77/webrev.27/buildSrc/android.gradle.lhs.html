<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames buildSrc/android.gradle</title>
    <link rel="stylesheet" href="../style.css" />
    <script type="text/javascript" src="../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (c) 2013, 2018, Oracle and/or its affiliates. All rights reserved.</span>
  3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
  4  *
  5  * This code is free software; you can redistribute it and/or modify it
  6  * under the terms of the GNU General Public License version 2 only, as
  7  * published by the Free Software Foundation.  Oracle designates this
  8  * particular file as subject to the &quot;Classpath&quot; exception as provided
  9  * by Oracle in the LICENSE file that accompanied this code.
 10  *
 11  * This code is distributed in the hope that it will be useful, but WITHOUT
 12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
 14  * version 2 for more details (a copy is included in the LICENSE file that
 15  * accompanied this code).
 16  *
 17  * You should have received a copy of the GNU General Public License version
 18  * 2 along with this work; if not, write to the Free Software Foundation,
 19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
 20  *
 21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
 22  * or visit www.oracle.com if you need additional information or have any
 23  * questions.
 24  */
 25 
<a name="2" id="anc2"></a><span class="line-removed"> 26 /**</span>
<span class="line-removed"> 27  * Gets the most recent android platform installed, relative to the given path.</span>
<span class="line-removed"> 28  * The path will either be ANDROID_SDK or ANDROID_NDK</span>
<span class="line-removed"> 29  * TODO Shouldn&#39;t we instead just ask people to point to the one they want to use?</span>
<span class="line-removed"> 30  *</span>
<span class="line-removed"> 31  * @param path The path to the Android SDK or NDK</span>
<span class="line-removed"> 32  * @return The name of the most recent platform</span>
<span class="line-removed"> 33  */</span>
<span class="line-removed"> 34 String getLatestPlatform(String path) {</span>
<span class="line-removed"> 35     def max = 0</span>
<span class="line-removed"> 36     file(cygpath(&quot;$path/platforms&quot;)).eachFile() {file-&gt;</span>
<span class="line-removed"> 37         def pname = file.getName() - &quot;android-&quot;</span>
<span class="line-removed"> 38         def ptf = pname?.isInteger() ? pname.toInteger() : 0</span>
<span class="line-removed"> 39         if (max &lt; ptf) {</span>
<span class="line-removed"> 40             max = ptf</span>
<span class="line-removed"> 41         }</span>
<span class="line-removed"> 42     }</span>
<span class="line-removed"> 43     if (max == 0) {</span>
<span class="line-removed"> 44         return null;</span>
<span class="line-removed"> 45     }</span>
<span class="line-removed"> 46     return &quot;android-&quot; + max</span>
<span class="line-removed"> 47 }</span>
<span class="line-removed"> 48 </span>
<span class="line-removed"> 49 int compareVersions(String s1, String s2) {</span>
<span class="line-removed"> 50     def v1t = s1.tokenize(&quot;.&quot;)</span>
<span class="line-removed"> 51     def v2t = s2.tokenize(&quot;.&quot;)</span>
<span class="line-removed"> 52     for(int i = 0; i &lt; v1t.size(); i++) {</span>
<span class="line-removed"> 53         if (i == v2t.size()) {</span>
<span class="line-removed"> 54             return 1</span>
<span class="line-removed"> 55         }</span>
<span class="line-removed"> 56         int n1 = v1t[i].isInteger() ? v1t[i].toInteger() : 0</span>
<span class="line-removed"> 57         int n2 = v2t[i].isInteger() ? v2t[i].toInteger() : 0</span>
<span class="line-removed"> 58         if (n1 == n2) {</span>
<span class="line-removed"> 59             continue</span>
<span class="line-removed"> 60         } else if (n1 &gt; n2) {</span>
<span class="line-removed"> 61             return 1;</span>
<span class="line-removed"> 62         } else {</span>
<span class="line-removed"> 63             return -1</span>
<span class="line-removed"> 64         }</span>
<span class="line-removed"> 65     }</span>
<span class="line-removed"> 66     return (v2t.size() &gt; v1t.size()) ? -1 : 0</span>
<span class="line-removed"> 67 }</span>
<span class="line-removed"> 68 </span>
<span class="line-removed"> 69 String getLatestToolchain(String ndk, String tch) {</span>
<span class="line-removed"> 70     def max = &quot;0.0&quot;</span>
<span class="line-removed"> 71     def matchFile = null</span>
<span class="line-removed"> 72     file(cygpath(&quot;$ndk/toolchains&quot;)).eachFile() {file-&gt;</span>
<span class="line-removed"> 73         def filename = file.getName()</span>
<span class="line-removed"> 74         if (filename.startsWith(tch)) {</span>
<span class="line-removed"> 75             def p = filename - &quot;$tch-&quot;</span>
<span class="line-removed"> 76             if (compareVersions(p, max) &gt; 0) {</span>
<span class="line-removed"> 77                 max = p</span>
<span class="line-removed"> 78                 matchFile = file</span>
<span class="line-removed"> 79             }</span>
<span class="line-removed"> 80         }</span>
<span class="line-removed"> 81     }</span>
<span class="line-removed"> 82     return matchFile.getAbsolutePath()</span>
<span class="line-removed"> 83 }</span>
<span class="line-removed"> 84 </span>
<span class="line-removed"> 85 boolean assertDir(File dir) {</span>
<span class="line-removed"> 86     return dir != null &amp;&amp; dir.exists() &amp;&amp; dir.isDirectory() &amp;&amp; dir.canRead();</span>
<span class="line-removed"> 87 }</span>
<span class="line-removed"> 88 </span>
<span class="line-removed"> 89 boolean assertDir(String dir) {</span>
<span class="line-removed"> 90     return assertDir(file(dir))</span>
<span class="line-removed"> 91 }</span>
 92 
 93 def closedDir = file(&quot;$projectDir/../rt-closed&quot;)
<a name="3" id="anc3"></a>




 94 
<a name="4" id="anc4"></a><span class="line-removed"> 95 def toolchainArchs = [&quot;arm-linux-androideabi&quot;, &quot;mipsel-linux-android&quot;, &quot;x86&quot;]</span>
<span class="line-removed"> 96 def armArchs = [&quot;armeabi&quot;, &quot;armeabiv-7a&quot;]</span>
 97 
<a name="5" id="anc5"></a><span class="line-modified"> 98 ANDROID = [:]</span>
 99 ANDROID.compileSwing = false;
100 ANDROID.compileSWT = false;
<a name="6" id="anc6"></a>
101 ANDROID.glassPlatform = &quot;android&quot;
<a name="7" id="anc7"></a><span class="line-modified">102 ANDROID.armArch = armArchs[0]</span>
103 ANDROID.libDest = &quot;lib&quot;
104 ANDROID.jfxdvklib = &quot;jfxdvk.jar&quot;
<a name="8" id="anc8"></a><span class="line-modified">105 ANDROID.library = { name -&gt; return &quot;lib${name}.so&quot; as String }</span>
<span class="line-modified">106 </span>
<span class="line-modified">107 def sdk = project.hasProperty(&quot;ANDROID_SDK&quot;) ? &quot;${ANDROID_SDK}&quot; : null;</span>
<span class="line-modified">108 def ndk = project.hasProperty(&quot;ANDROID_NDK&quot;) ? &quot;${ANDROID_NDK}&quot; : null;</span>
<span class="line-removed">109 ANDROID.canBuild = sdk != null &amp;&amp; ndk != null</span>
<span class="line-removed">110 if (!ANDROID.canBuild) {</span>
<span class="line-removed">111     fail(&quot;Can&#39;t build Android. Path to SDK or NDK was not set or is invalid!&quot;)</span>
<span class="line-removed">112 }</span>
<span class="line-removed">113 </span>
<span class="line-removed">114 ANDROID.canBuild = assertDir(sdk) &amp;&amp; assertDir(ndk)</span>
<span class="line-removed">115 if (!ANDROID.canBuild) {</span>
<span class="line-removed">116     if (!assertDir(sdk)) {</span>
<span class="line-removed">117         logger.error(&quot;Path to ANDROID_SDK is invalid! [$sdk]&quot;)</span>
<span class="line-removed">118     }</span>
<span class="line-removed">119     if (!assertDir(ndk)) {</span>
<span class="line-removed">120         logger.error(&quot;Path to ANDROID_NDK is invalid! [$ndk]&quot;)</span>
<span class="line-removed">121     }</span>
<span class="line-removed">122     fail(&quot;Cannot build, missing android tools&quot;)</span>
<span class="line-removed">123 }</span>
<span class="line-removed">124 </span>
<span class="line-removed">125 def sdk_target = project.hasProperty(&quot;ANDROID_SDK_TARGET&quot;) ?  &quot;${ANDROID_SDK_TARGET}&quot; : getLatestPlatform(sdk);</span>
<span class="line-removed">126 if (!assertDir(file(&quot;$sdk/platforms/$sdk_target&quot;))) {</span>
<span class="line-removed">127     sdk_target = getLatestPlatform(sdk);</span>
<span class="line-removed">128     logger.warn(&quot;Redefine ANDROID_SDK_TARGET to: [$sdk_target]&quot;)</span>
<span class="line-removed">129 }</span>
<span class="line-removed">130 </span>
<span class="line-removed">131 def ndk_target = project.hasProperty(&quot;ANDROID_NDK_TARGET&quot;) ? &quot;${ANDROID_NDK_TARGET}&quot; : getLatestPlatform(ndk);</span>
<span class="line-removed">132 if (!assertDir(file(&quot;$ndk/platforms/$ndk_target&quot;))) {</span>
<span class="line-removed">133     ndk_target = getLatestPlatform(ndk);</span>
<span class="line-removed">134     logger.warn(&quot;Redefine ANDROID_NDK_TARGET to: [$ndk_target]&quot;)</span>
<span class="line-removed">135 }</span>
<span class="line-removed">136 </span>
<span class="line-removed">137 ANDROID.canBuild = sdk_target != null &amp;&amp; ndk_target != null</span>
<span class="line-removed">138 if (!ANDROID.canBuild) {</span>
<span class="line-removed">139     fail(&quot;Can&#39;t determine sdk or ndk target platform!&quot;)</span>
<span class="line-removed">140 }</span>
<span class="line-removed">141 </span>
<span class="line-removed">142 def toolchainHome = project.hasProperty(&quot;ANDROID_CROSS_TOOLS_VER&quot;) ?</span>
<span class="line-removed">143     &quot;$ndk/toolchains/${ANDROID_CROSS_TOOLS_VER}&quot; : getLatestToolchain(ndk, toolchainArchs[0])</span>
<span class="line-removed">144 if (!assertDir(toolchainHome)) {</span>
<span class="line-removed">145     toolchainHome = getLatestToolchain(ndk, toolchainArchs[0])</span>
<span class="line-removed">146     logger.warn(&quot;Redefine toolchain to [$toolchainHome]&quot;)</span>
<span class="line-removed">147 }</span>
<span class="line-removed">148 </span>
<span class="line-removed">149 // Look for the the Android SDK &amp; NDK to use, as well as the compiler stuff</span>
<span class="line-removed">150 def compilerHome = null</span>
<span class="line-removed">151 file(&quot;$toolchainHome/prebuilt&quot;).eachDir() {subdir -&gt;</span>
<span class="line-removed">152     compilerHome = subdir.getAbsolutePath()</span>
<span class="line-removed">153     return</span>
<span class="line-removed">154 }</span>
<span class="line-removed">155 </span>
<span class="line-removed">156 ANDROID.canBuild = compilerHome != null</span>
<span class="line-removed">157 if (!ANDROID.canBuild) {</span>
<span class="line-removed">158     fail(&quot;Failed to access toolchain [$toolchainHome/prebuilt/$toolsPlatform]!&quot;)</span>
<span class="line-removed">159 }</span>
160 
<a name="9" id="anc9"></a>

161 def freetypeDir = project.hasProperty(&quot;FREETYPE_DIR&quot;) ? &quot;${FREETYPE_DIR}&quot; : null
<a name="10" id="anc10"></a><span class="line-removed">162 if (!assertDir(freetypeDir)) {</span>
<span class="line-removed">163     logger.warn(&quot;FREETYPE_DIR $freetypeDir doesn&#39;t exists! Build continues without native text support.&quot;)</span>
<span class="line-removed">164     freetypeDir = null</span>
<span class="line-removed">165 }</span>
166 def compileNativeText = freetypeDir != null
167 
<a name="11" id="anc11"></a><span class="line-modified">168 def compiler = file(&quot;$compilerHome/bin/${toolchainArchs[0]}-gcc&quot;).getAbsolutePath()</span>
<span class="line-modified">169 def linker = file(&quot;$compilerHome/bin/${toolchainArchs[0]}-g++&quot;).getAbsolutePath()</span>
170 
171 // Log the settings we&#39;re building with
172 logger.quiet(&quot;ANDROID_SDK: $sdk&quot;)
173 logger.quiet(&quot;ANDROID_SDK_TARGET: $sdk_target&quot;)
174 logger.quiet(&quot;ANDROID_NDK: $ndk&quot;)
175 logger.quiet(&quot;ANDROID_NDK_TARGET: $ndk_target&quot;)
176 logger.quiet(&quot;FREETYPE_DIR: $freetypeDir&quot;)
177 logger.quiet(&quot;Compile native text: $compileNativeText&quot;)
178 logger.quiet(&quot;Android Compiler: $compiler&quot;)
179 logger.quiet(&quot;Android Linker: $linker&quot;)
180 
<a name="12" id="anc12"></a><span class="line-modified">181 project(&quot;:graphics&quot;) {</span>
<span class="line-modified">182 </span>
<span class="line-modified">183     task compileDalvikLibs(type: JavaCompile, group: &quot;Build&quot;) {</span>
<span class="line-removed">184         description = &quot;Task compiles dalvik vm based libraries.&quot;</span>
<span class="line-removed">185         sourceCompatibility = JavaVersion.VERSION_1_6</span>
<span class="line-removed">186         targetCompatibility = JavaVersion.VERSION_1_6</span>
<span class="line-removed">187         options.bootClasspath = &quot;$sdk/platforms/$sdk_target/android.jar&quot;</span>
<span class="line-removed">188         classpath = files(&quot;build/classes/android&quot;)</span>
<span class="line-removed">189         destinationDir = file(&quot;build/classes/android&quot;)</span>
<span class="line-removed">190         dependencyCacheDir = file(&quot;build/dependency-cache&quot;)</span>
<span class="line-removed">191         source fileTree(dir: &#39;src/android/java&#39;).matching { include &#39;com/oracle/dalvik/**&#39; }</span>
<span class="line-removed">192     }</span>
193 
<a name="13" id="anc13"></a><span class="line-modified">194     task jarDalvikLibs(type: Jar, group: &quot;Build&quot;, dependsOn: compileDalvikLibs) {</span>
<span class="line-modified">195         description = &quot;Creates jfxdvk.jar with all dalvik based classes.&quot;</span>
<span class="line-removed">196         archiveName = &quot;jfxdvk.jar&quot;</span>
<span class="line-removed">197         includeEmptyDirs = false</span>
<span class="line-removed">198         from(&quot;build/classes/android&quot;)</span>
<span class="line-removed">199         include(&quot;com/oracle/dalvik/**/*&quot;)</span>
<span class="line-removed">200         dependsOn(compileDalvikLibs)</span>
201     }
<a name="14" id="anc14"></a>
202 
<a name="15" id="anc15"></a><span class="line-modified">203     afterEvaluate {</span>
<span class="line-modified">204         addNative(project, &quot;surface&quot;, [&quot;android&quot;])</span>
<span class="line-removed">205         addNative(project, &quot;vmlauncher&quot;, [&quot;android&quot;])</span>
<span class="line-removed">206         if (compileNativeText) {</span>
<span class="line-removed">207             addNative(project, &quot;fontNativeFreetype&quot;, [&quot;android&quot;])</span>
<span class="line-removed">208         }</span>
<span class="line-removed">209         tasks[&quot;javahAndroidVmlauncher&quot;].dependsOn(compileDalvikLibs)</span>
<span class="line-removed">210         tasks[&quot;native&quot;].dependsOn(&quot;nativeSurface&quot;, &quot;nativeVmlauncher&quot;)</span>
<span class="line-removed">211         if (compileNativeText) {</span>
<span class="line-removed">212             tasks[&quot;native&quot;].dependsOn(&quot;nativeFontNativeFreetype&quot;)</span>
<span class="line-removed">213         }</span>
214 
<a name="16" id="anc16"></a><span class="line-modified">215         sdkAndroid  {</span>
<span class="line-modified">216             dependsOn(jarDalvikLibs)</span>
<span class="line-removed">217             doLast {</span>
<span class="line-removed">218                 def props = project.ext[&quot;ANDROID&quot;]</span>
<span class="line-removed">219                 copy {</span>
<span class="line-removed">220                     from(</span>
<span class="line-removed">221                          &quot;${project(&quot;graphics&quot;).buildDir}/libs/vmlauncher/android/${props.library(props.vmlauncher.lib)}&quot;,</span>
<span class="line-removed">222                          &quot;${project(&quot;graphics&quot;).buildDir}/libs/surface/android/${props.library(props.surface.lib)}&quot;</span>
<span class="line-removed">223                     )</span>
<span class="line-removed">224                     into (&quot;build/android-sdk/dalvik/${props.libDest}&quot;)</span>
<span class="line-removed">225                 }</span>
<span class="line-removed">226                 copy {</span>
<span class="line-removed">227                     from (&quot;${project(&quot;graphics&quot;).buildDir}/libs/${props.jfxdvklib}&quot;)</span>
<span class="line-removed">228                     into (&quot;build/android-sdk/dalvik/lib&quot;)</span>
<span class="line-removed">229                 }</span>
<span class="line-removed">230                 if (compileNativeText) {</span>
<span class="line-removed">231                     copy {</span>
<span class="line-removed">232                         from (&quot;${project(&quot;graphics&quot;).buildDir}/libs/fontNativeFreetype/android&quot;)</span>
<span class="line-removed">233                         into (&quot;build/android-sdk/$ANDROID.libDest&quot;)</span>
<span class="line-removed">234                     }</span>
<span class="line-removed">235                 }</span>
<span class="line-removed">236             }</span>
<span class="line-removed">237         }</span>
238     }
239 }
240 
<a name="17" id="anc17"></a><span class="line-modified">241 project(&quot;:controls&quot;) {</span>
<span class="line-modified">242     afterEvaluate {</span>
<span class="line-modified">243         task compileControlsJavaAndroid(type: JavaCompile, group: &quot;Build&quot;, dependsOn: [&quot;:graphics:compileJava&quot;, &quot;:controls:compileJava&quot;]) {</span>
<span class="line-modified">244             description = &quot;Task compiles controls for Android&quot;</span>
<span class="line-modified">245             classpath = files(&quot;${project(&quot;base&quot;).buildDir}/classes/main&quot;,</span>
<span class="line-removed">246                 &quot;${project(&quot;graphics&quot;).buildDir}/classes/main&quot;,</span>
<span class="line-removed">247                 &quot;${project(&quot;controls&quot;).buildDir}/classes/main&quot;</span>
<span class="line-removed">248             )</span>
<span class="line-removed">249             destinationDir = file(&quot;${project(&quot;controls&quot;).buildDir}/classes/android&quot;)</span>
<span class="line-removed">250             dependencyCacheDir = file(&quot;${project(&quot;controls&quot;).buildDir}/dependency-cache&quot;)</span>
<span class="line-removed">251             source file(&quot;${project(&quot;controls&quot;).projectDir}/src/android/java&quot;)</span>
<span class="line-removed">252         }</span>
253 
<a name="18" id="anc18"></a><span class="line-removed">254        task processControlsResourcesAndroid() {</span>
<span class="line-removed">255            copy {</span>
<span class="line-removed">256                from (&quot;${project(&quot;controls&quot;).projectDir}/src/android/resources&quot;)</span>
<span class="line-removed">257                into (&quot;${project(&quot;controls&quot;).buildDir}/resources/android&quot;)</span>
<span class="line-removed">258            }</span>
<span class="line-removed">259         }</span>
260 
<a name="19" id="anc19"></a><span class="line-modified">261         sdkAndroid {</span>
<span class="line-modified">262             dependsOn(compileControlsJavaAndroid, processControlsResourcesAndroid)</span>
<span class="line-removed">263         }</span>
<span class="line-removed">264     }</span>
265 }
266 
267 project(&quot;:web&quot;) {
<a name="20" id="anc20"></a>




268     apply plugin: &#39;java&#39;
269 
<a name="21" id="anc21"></a><span class="line-modified">270     compileJava {</span>
<span class="line-modified">271         enabled = false</span>
272     }
273 
274     afterEvaluate {
<a name="22" id="anc22"></a><span class="line-modified">275         if (!BUILD_CLOSED) {</span>
<span class="line-modified">276             logger.warn(&quot;OpenJFX build. Skipping webkit build on Android.&quot;)</span>
<span class="line-removed">277             return</span>
278         }
<a name="23" id="anc23"></a><span class="line-modified">279         def compileWebJavaAndroid = task(&quot;compileWebJavaAndroid&quot;,</span>
<span class="line-modified">280             type: JavaCompile, group: &quot;Build&quot;) {</span>
<span class="line-removed">281 </span>
<span class="line-removed">282             dependsOn(project(&quot;:graphics&quot;).classes, project(&quot;:base&quot;).classes)</span>
<span class="line-removed">283             description = &quot;Task compiles web component for Android.&quot;</span>
<span class="line-removed">284             classpath = files(</span>
<span class="line-removed">285                 project(&quot;:controls&quot;).sourceSets.main.java.outputDir,</span>
<span class="line-removed">286                 project(&quot;:graphics&quot;).sourceSets.main.java.outputDir,</span>
<span class="line-removed">287                 project(&quot;:base&quot;).sourceSets.main.java.outputDir</span>
<span class="line-removed">288             )</span>
<span class="line-removed">289             destinationDir = file(&quot;${project(&quot;web&quot;).buildDir}/classes/android&quot;)</span>
<span class="line-removed">290             dependencyCacheDir = file(&quot;${project(&quot;web&quot;).buildDir}/dependency-cache&quot;)</span>
<span class="line-removed">291             source file(&quot;${project(&quot;web&quot;).projectDir}/src/android/java&quot;)</span>
292         }
<a name="24" id="anc24"></a>

293 
<a name="25" id="anc25"></a><span class="line-modified">294         def jarWebJavaAndroid = task(&quot;jarWebJavaAndroid&quot;,</span>
<span class="line-modified">295             type: Jar, group: &quot;Build&quot;) {</span>
<span class="line-removed">296             description = &quot;Creates web.jar for Android.&quot;</span>
<span class="line-removed">297             dependsOn(compileWebJavaAndroid)</span>
<span class="line-removed">298             archiveName = &quot;web.jar&quot;</span>
<span class="line-removed">299             includeEmptyDirs = false</span>
<span class="line-removed">300             destinationDir = project.file(&quot;build/libs/android&quot;)</span>
<span class="line-removed">301             from(&quot;build/classes/android&quot;)</span>
<span class="line-removed">302         }</span>
303 
<a name="26" id="anc26"></a><span class="line-modified">304         addNative(project, &quot;webview&quot;, [&quot;android&quot;])</span>
<span class="line-removed">305         addNative(project, &quot;dvkwebview&quot;, [&quot;android&quot;])</span>
<span class="line-removed">306         javahAndroidWebview.dependsOn(compileWebJavaAndroid)</span>
<span class="line-removed">307         javahAndroidDvkwebview.dependsOn(compileWebJavaAndroid)</span>
308 
<a name="27" id="anc27"></a><span class="line-modified">309         jfxrtAndroid {</span>
<span class="line-removed">310             from &quot;${project(&quot;web&quot;).buildDir}/classes/android&quot;</span>
<span class="line-removed">311         }</span>
312 
<a name="28" id="anc28"></a><span class="line-modified">313         sdkAndroid  {</span>
<span class="line-modified">314             dependsOn(jarWebJavaAndroid)</span>
<span class="line-modified">315             doLast {</span>
<span class="line-modified">316                 def props = project.ext[&quot;ANDROID&quot;]</span>
<span class="line-removed">317                 copy {</span>
<span class="line-removed">318                     from(</span>
<span class="line-removed">319                          &quot;${project(&quot;web&quot;).buildDir}/libs/dvkwebview/android/${props.library(props.dvkwebview.lib)}&quot;</span>
<span class="line-removed">320                     )</span>
<span class="line-removed">321                     into (&quot;build/android-sdk/dalvik/${props.libDest}&quot;)</span>
<span class="line-removed">322                 }</span>
<span class="line-removed">323                 copy {</span>
<span class="line-removed">324                     from (&quot;${project(&quot;web&quot;).buildDir}/libs/webview/android/${props.library(props.webview.lib)}&quot;)</span>
<span class="line-removed">325                     into (&quot;build/android-sdk/${props.libDest}&quot;)</span>
<span class="line-removed">326                 }</span>
<span class="line-removed">327             }</span>
328         }
329     }
<a name="29" id="anc29"></a><span class="line-removed">330 }</span>
331 
<a name="30" id="anc30"></a>


332 
333 ANDROID.jfxrtJarExcludes = [
334     &quot;**/*.hlsl&quot;,
335     &quot;com/sun/glass/ui/win&quot;,
<a name="31" id="anc31"></a><span class="line-modified">336     &quot;com/sun/prism/d3d&quot;,</span>
<span class="line-modified">337     &quot;com/sun/prism/es2/gl/win&quot;,</span>
<span class="line-modified">338     &quot;com/sun/prism/null3d&quot;,</span>
<span class="line-modified">339     &quot;com/sun/scenario/effect/impl/hw/d3d&quot;,</span>
<span class="line-removed">340     &quot;com/sun/glass/events/mac&quot;,</span>
<span class="line-removed">341     &quot;com/sun/glass/ui/mac&quot;,</span>
<span class="line-removed">342     &quot;com/sun/prism/es2/gl/mac&quot;,</span>
<span class="line-removed">343     &quot;com/sun/glass/ui/gtk&quot;,</span>
344     &quot;com/sun/glass/ui/ios&quot;,
<a name="32" id="anc32"></a><span class="line-removed">345     &quot;com/sun/prism/es2/gl/eglx11&quot;,</span>
<span class="line-removed">346     &quot;com/sun/prism/es2/gl/x11&quot;,</span>
347     &quot;com/sun/glass/ui/swt&quot;, // SWT glass
<a name="33" id="anc33"></a><span class="line-modified">348     &quot;javafx/embed/swing&quot;, // Swing Interop</span>
<span class="line-modified">349     &quot;javafx/embed/swt&quot;, // SWT Interop</span>
<span class="line-modified">350     &quot;com/oracle/dalvik&quot;</span>














351 ]
352 
353 def text = (compileNativeText) ? &quot;native&quot; : &quot;&quot;
354 
355 ANDROID.javafxPlatformProperties = &quot;&quot;&quot;
356 javafx.platform=android
<a name="34" id="anc34"></a><span class="line-modified">357 android.glass.platform=Lens</span>
<span class="line-modified">358 android.glass.lens=eglfb</span>




359 android.prism.glDepthSize=16
360 android.prism.lcdtext=false
361 android.prism.debugfonts=true
362 android.prism.text=$text
<a name="35" id="anc35"></a><span class="line-modified">363 android.embedded=eglfb</span>
<span class="line-modified">364 android.prism.allowhidpi=false</span>
365 android.prism.maxTextureSize=2048
366 android.prism.dirtyopts=true
367 android.prism.vsync=false
<a name="36" id="anc36"></a><span class="line-removed">368 android.log.lens=FINE</span>
369 android.use.egl=true
370 android.com.sun.javafx.isEmbedded=true
<a name="37" id="anc37"></a>


371 &quot;&quot;&quot;
372 def sysroot = &quot;$ndk/platforms/$ndk_target/arch-arm&quot;
373 
<a name="38" id="anc38"></a><span class="line-modified">374 def ccFlags = [&quot;--sysroot=$sysroot&quot;,&quot;-std=c99&quot;, &quot;-DANDROID&quot;, &quot;-c&quot;, &quot;-nostdlib&quot;,</span>
<span class="line-modified">375                &quot;-DANDROID_NDK&quot;]</span>
<span class="line-modified">376 </span>
<span class="line-removed">377 if (project.hasProperty(&quot;DALVIK_VM&quot;)) {</span>
<span class="line-removed">378     ccFlags += [&quot;-DDALVIK_VM&quot;]</span>
379 }
380 
<a name="39" id="anc39"></a><span class="line-modified">381 def ccOptFlags = [&quot;-fpic&quot;, &quot;-ffunction-sections&quot;, &quot;-funwind-tables&quot;,&quot;-fstack-protector&quot;,</span>
<span class="line-modified">382                   &quot;-Os&quot;, &quot;-O2&quot;, &quot;-fno-strict-aliasing&quot;, &quot;-finline-limit=64&quot;, &quot;-fomit-frame-pointer&quot;]</span>
<span class="line-modified">383 def ccWarnFlags = [&quot;-Wa,--noexecstack&quot;, &quot;-Wno-psabi&quot;]</span>
<span class="line-modified">384 def ccArchFlags = [&quot;-mthumb&quot;, &quot;-msoft-float&quot;, &quot;-D__ARM_ARCH_5__&quot;, &quot;-D__ARM_ARCH_5T__&quot;, &quot;-D__ARM_ARCH_5E__&quot;,</span>
<span class="line-modified">385                    &quot;-D__ARM_ARCH_5TE__&quot;, &quot;-march=armv5te&quot; , &quot;-mtune=xscale&quot;]</span>
386 def ccDebugFlags = [IS_DEBUG_NATIVE ? &quot;-DDEBUG&quot; : &quot;-DNDEBUG&quot;]
387 def ccDefaultIncludeFlags = [&quot;-I$ndk/platforms/$ndk_target/arch-arm/usr/include&quot;]
388 
<a name="40" id="anc40"></a><span class="line-modified">389 def linkFlags = [&quot;--sysroot=$sysroot&quot;,</span>
390                  &quot;-Wl,--no-undefined&quot;, &quot;-Wl,-z,noexecstack&quot;, &quot;-lc&quot;, &quot;-lm&quot;, &quot;-shared&quot;,
<a name="41" id="anc41"></a><span class="line-modified">391                  &quot;-L$ndk/platforms/$ndk_target/arch-arm/usr/lib&quot;]</span>
<span class="line-removed">392 </span>
<span class="line-removed">393 </span>
<span class="line-removed">394 ANDROID.vmlauncher = [:]</span>
<span class="line-removed">395 ANDROID.vmlauncher.classpath = files(&quot;$sdk/platforms/$sdk_target/android.jar&quot;,</span>
<span class="line-removed">396                                      &quot;${project(&quot;graphics&quot;).buildDir}/classes/android&quot;)</span>
<span class="line-removed">397 </span>
<span class="line-removed">398 ANDROID.vmlauncher.javahSource = files(&quot;${project(&quot;graphics&quot;).buildDir}/classes/android&quot;)</span>
<span class="line-removed">399 ANDROID.vmlauncher.javahClasspath = files(&quot;${project(&quot;graphics&quot;).buildDir}/classes/android&quot;,</span>
<span class="line-removed">400                                           &quot;$sdk/platforms/$sdk_target/android.jar&quot;)</span>
<span class="line-removed">401 ANDROID.vmlauncher.javahInclude = [</span>
<span class="line-removed">402     &quot;com/oracle/dalvik/*&quot;</span>
<span class="line-removed">403 ]</span>
<span class="line-removed">404 ANDROID.vmlauncher.nativeSource = [</span>
<span class="line-removed">405     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/android/native/VMLauncher.c&quot;),</span>
<span class="line-removed">406     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/android/native/NativePipeReader.c&quot;),</span>
<span class="line-removed">407     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/android/native/DalvikProxySelector.c&quot;)</span>
<span class="line-removed">408 ]</span>
<span class="line-removed">409 ANDROID.vmlauncher.compiler = compiler</span>
<span class="line-removed">410 ANDROID.vmlauncher.linker = linker</span>
<span class="line-removed">411 ANDROID.vmlauncher.lib = &quot;vmlauncher&quot;</span>
<span class="line-removed">412 ANDROID.vmlauncher.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,</span>
<span class="line-removed">413     ccDebugFlags, ccDefaultIncludeFlags].flatten()</span>
<span class="line-removed">414 ANDROID.vmlauncher.linkFlags = [linkFlags, &quot;-llog&quot;].flatten()</span>
<span class="line-removed">415 </span>
<span class="line-removed">416 ANDROID.surface = [:]</span>
<span class="line-removed">417 ANDROID.surface.javahInclude = [</span>
<span class="line-removed">418     &quot;com/sun/glass/events/*&quot;,</span>
<span class="line-removed">419     &quot;com/sun/glass/ui/android/*&quot;</span>
<span class="line-removed">420 ]</span>
<span class="line-removed">421 ANDROID.surface.nativeSource = [</span>
<span class="line-removed">422     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/android&quot;)</span>
<span class="line-removed">423 ]</span>
<span class="line-removed">424 ANDROID.surface.compiler = compiler</span>
<span class="line-removed">425 ANDROID.surface.linker = linker</span>
<span class="line-removed">426 ANDROID.surface.lib = &quot;glass_lens_android&quot;</span>
<span class="line-removed">427 ANDROID.surface.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,</span>
<span class="line-removed">428     ccDebugFlags, ccDefaultIncludeFlags, &quot;-Isrc/main/native-glass/lens&quot;].flatten()</span>
<span class="line-removed">429 ANDROID.surface.linkFlags = [linkFlags, &quot;-ldl&quot;, &quot;-landroid&quot;, &quot;-llog&quot;].flatten()</span>
430 
431 ANDROID.webview = [:]
432 ANDROID.webview.javahSource = files(&quot;${project(&quot;web&quot;).buildDir}/classes/android&quot;)
433 ANDROID.webview.javahClasspath = files(&quot;${project(&quot;web&quot;).buildDir}/classes/android&quot;)
434 ANDROID.webview.javahInclude = [
435     &quot;com/sun/webkit/NativeWebView.class&quot;
436 ]
437 ANDROID.webview.nativeSource = [
<a name="42" id="anc42"></a><span class="line-modified">438     file(&quot;${project(&quot;web&quot;).projectDir}/src/android/native/native_webview.c&quot;)</span>

439 ]
440 ANDROID.webview.compiler = compiler
441 ANDROID.webview.linker = linker
442 ANDROID.webview.lib = &quot;webview&quot;
443 ANDROID.webview.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
444     ccDebugFlags, ccDefaultIncludeFlags].flatten()
<a name="43" id="anc43"></a><span class="line-modified">445 ANDROID.webview.linkFlags = [linkFlags, &quot;-ldl&quot;, &quot;-llog&quot;].flatten()</span>
446 
447 ANDROID.dvkwebview = [:]
448 ANDROID.dvkwebview.javahSource = files(&quot;${project(&quot;web&quot;).buildDir}/classes/android&quot;)
449 ANDROID.dvkwebview.javahClasspath = files(&quot;${project(&quot;web&quot;).buildDir}/classes/android&quot;)
450 ANDROID.dvkwebview.javahInclude = [
451     &quot;com/sun/webkit/NativeWebView.class&quot;
452 ]
453 ANDROID.dvkwebview.nativeSource = [
454     file(&quot;${project(&quot;web&quot;).projectDir}/src/android/native/android_webview.c&quot;)
455 ]
456 ANDROID.dvkwebview.compiler = compiler
457 ANDROID.dvkwebview.linker = linker
458 ANDROID.dvkwebview.lib = &quot;android_webview&quot;
459 ANDROID.dvkwebview.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
460     ccDebugFlags, ccDefaultIncludeFlags].flatten()
<a name="44" id="anc44"></a><span class="line-modified">461 ANDROID.dvkwebview.linkFlags = [linkFlags, &quot;-ldl&quot;, &quot;-llog&quot;].flatten()</span>
462 
463 ANDROID.glass = [:]
<a name="45" id="anc45"></a><span class="line-modified">464 ANDROID.glass.variants = [&quot;eglfb&quot;, &quot;lensport&quot;]</span>







465 ANDROID.glass.javahInclude = [
<a name="46" id="anc46"></a>


466     &quot;com/sun/glass/events/**&quot;,
467     &quot;com/sun/glass/ui/*&quot;,
468     &quot;com/sun/glass/ui/android/*&quot;,
469     &quot;com/sun/glass/ui/lens/*&quot;]
470 
<a name="47" id="anc47"></a><span class="line-modified">471 ANDROID.glass.lensport = [:]</span>
<span class="line-modified">472 ANDROID.glass.lensport.nativeSource = [</span>
<span class="line-modified">473     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/lensport&quot;),</span>
<span class="line-modified">474     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/lensport/initPlatform.c&quot;),</span>
<span class="line-modified">475     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/lensport/wrapped_functions.c&quot;)</span>
<span class="line-modified">476 ]</span>
<span class="line-modified">477 ANDROID.glass.lensport.compiler = compiler</span>
<span class="line-modified">478 ANDROID.glass.lensport.linker = linker</span>
<span class="line-modified">479 ANDROID.glass.lensport.lib = &quot;lens_porting&quot;</span>
<span class="line-modified">480 ANDROID.glass.lensport.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,</span>
<span class="line-modified">481     ccDebugFlags, ccDefaultIncludeFlags, &quot;-DISEGLFB&quot;, &quot;-DLENSPORT&quot;,</span>
<span class="line-modified">482     &quot;-I&quot;, file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens&quot;)].flatten()</span>
<span class="line-modified">483 ANDROID.glass.lensport.linkFlags = [linkFlags, &quot;-ldl&quot;, &quot;-llog&quot;].flatten()</span>
<span class="line-modified">484 </span>
<span class="line-modified">485 ANDROID.glass.eglfb = [:]</span>
<span class="line-modified">486 ANDROID.glass.eglfb.nativeSource = [</span>
<span class="line-modified">487     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens&quot;),</span>
<span class="line-modified">488     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/wm&quot;),</span>
<span class="line-modified">489     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/cursor/nullCursor&quot;),</span>
<span class="line-modified">490     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/input/android&quot;),</span>
<span class="line-modified">491     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-glass/lens/wm/screen/androidScreen.c&quot;)</span>
<span class="line-modified">492 ]</span>
<span class="line-modified">493 ANDROID.glass.eglfb.compiler = compiler</span>
<span class="line-modified">494 ANDROID.glass.eglfb.linker = linker</span>
<span class="line-modified">495 ANDROID.glass.eglfb.lib = &quot;glass_lens_eglfb&quot;</span>
<span class="line-modified">496 ANDROID.glass.eglfb.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,</span>
<span class="line-modified">497     ccDebugFlags, ccDefaultIncludeFlags].flatten()</span>
<span class="line-modified">498 ANDROID.glass.eglfb.linkFlags = [linkFlags, &quot;-ldl&quot;, &quot;-landroid&quot;, &quot;-llog&quot;].flatten()</span>









499 
500 ANDROID.prism = [:]
501 ANDROID.prism.javahInclude = [&quot;com/sun/prism/impl/**/*&quot;, &quot;com/sun/prism/PresentableState*&quot;]
502 ANDROID.prism.nativeSource = file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-prism&quot;)
503 ANDROID.prism.compiler = compiler
504 ANDROID.prism.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
505     ccDebugFlags, ccDefaultIncludeFlags].flatten()
506 ANDROID.prism.linker = linker
507 ANDROID.prism.linkFlags = [linkFlags].flatten()
508 ANDROID.prism.lib = &quot;prism_common&quot;
509 
510 ANDROID.prismSW = [:]
511 ANDROID.prismSW.javahInclude = [&quot;com/sun/pisces/**/*&quot;]
512 ANDROID.prismSW.nativeSource = file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-prism-sw&quot;)
513 ANDROID.prismSW.compiler = compiler
514 ANDROID.prismSW.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
515     ccDebugFlags, ccDefaultIncludeFlags].flatten()
516 ANDROID.prismSW.linker = linker
517 ANDROID.prismSW.linkFlags = [linkFlags].flatten()
518 ANDROID.prismSW.lib = &quot;prism_sw&quot;
519 
520 ANDROID.decora = [:]
521 ANDROID.decora.compiler = compiler
522 ANDROID.decora.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
523     ccDebugFlags, ccDefaultIncludeFlags].flatten()
524 ANDROID.decora.linker = linker
525 ANDROID.decora.linkFlags = [linkFlags].flatten()
526 ANDROID.decora.lib = &quot;decora_sse&quot;
527 
528 ANDROID.iio = [:]
529 ANDROID.iio.javahInclude = [&quot;com/sun/javafx/iio/**/*&quot;]
530 ANDROID.iio.nativeSource = [
531     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-iio&quot;),
532     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-iio/libjpeg&quot;)]
533 ANDROID.iio.compiler = compiler
534 ANDROID.iio.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
535     ccDebugFlags, ccDefaultIncludeFlags].flatten()
536 ANDROID.iio.linker = linker
537 ANDROID.iio.linkFlags = [linkFlags].flatten()
538 ANDROID.iio.lib = &quot;javafx_iio&quot;
539 
540 ANDROID.prismES2 = [:]
<a name="48" id="anc48"></a><span class="line-modified">541 ANDROID.prismES2.variants = [&quot;eglfb&quot;]</span>
542 ANDROID.prismES2.javahInclude = [&quot;com/sun/prism/es2/**/*&quot;]
543 
<a name="49" id="anc49"></a><span class="line-modified">544 ANDROID.prismES2.eglfb = [:]</span>
<span class="line-modified">545 ANDROID.prismES2.eglfb.nativeSource = [</span>
546     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-prism-es2&quot;),
547     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-prism-es2/GL&quot;),
<a name="50" id="anc50"></a><span class="line-modified">548     file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-prism-es2/eglfb&quot;)]</span>
<span class="line-modified">549 ANDROID.prismES2.eglfb.compiler = compiler</span>
<span class="line-modified">550 ANDROID.prismES2.eglfb.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,</span>


551     ccDebugFlags, ccDefaultIncludeFlags, &quot;-DIS_EGLFB&quot;].flatten()
<a name="51" id="anc51"></a><span class="line-modified">552 ANDROID.prismES2.eglfb.linker = linker</span>
<span class="line-modified">553 ANDROID.prismES2.eglfb.linkFlags = [linkFlags, &quot;-ldl&quot;, &quot;-llog&quot;, &quot;-lGLESv2&quot;, &quot;-lEGL&quot;].flatten()</span>
<span class="line-modified">554 ANDROID.prismES2.eglfb.lib = &quot;prism_es2_eglfb&quot;</span>
555 
556 ANDROID.font = [:]
557 ANDROID.font.javahInclude = [
558         &quot;com/sun/javafx/font/**/*&quot;,
559         &quot;com/sun/javafx/text/**/*&quot;]
560 ANDROID.font.nativeSource = [file(&quot;$closedDir/javafx-font-native/src&quot;)]
561 ANDROID.font.compiler = compiler
562 ANDROID.font.ccFlags = [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
563     ccDebugFlags, ccDefaultIncludeFlags].flatten()
564 ANDROID.font.linker = linker
565 ANDROID.font.linkFlags = [linkFlags].flatten()
566 ANDROID.font.lib = &quot;javafx_font&quot;
567 
568 if (compileNativeText) {
569     ANDROID.fontNativeFreetype = [:]
570     ANDROID.fontNativeFreetype.javahInclude = [
571         &quot;com/sun/javafx/font/freetype/OSFreetype.class&quot;
572     ]
573     ANDROID.fontNativeFreetype.nativeSource = [
574         file(&quot;${project(&quot;graphics&quot;).projectDir}/src/main/native-font/freetype.c&quot;)
575     ]
576     ANDROID.fontNativeFreetype.compiler = compiler
577     ANDROID.fontNativeFreetype.linker = linker
578     ANDROID.fontNativeFreetype.lib = &quot;javafx_font_freetype&quot;
579 
580     ccFlags += [&quot;-D_ENABLE_HARFBUZZ&quot;]
581 
582     ANDROID.fontNativeFreetype.ccFlags =
583         [ccFlags, ccWarnFlags, ccArchFlags, ccOptFlags,
584         ccDebugFlags, ccDefaultIncludeFlags,
585         &quot;-I$freetypeDir/include&quot;, &quot;-I$freetypeDir/include/freetype2&quot;].flatten()
586 
587     ANDROID.fontNativeFreetype.linkFlags =
<a name="52" id="anc52"></a>
588         [linkFlags, &quot;-llog&quot;,
589          &quot;-L$freetypeDir/lib&quot;, &quot;$freetypeDir/lib/libfreetype.a&quot;].flatten()
590 }
591 
592 ANDROID.media = [:]
<a name="53" id="anc53"></a><span class="line-modified">593 ANDROID.media.compiler = compiler</span>
<span class="line-removed">594 ANDROID.media.linker = linker</span>
<span class="line-removed">595 ANDROID.media.lib = file(&quot;$compilerHome/bin/${toolchainArchs[0]}-ar&quot;).getAbsolutePath()</span>
<a name="54" id="anc54"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="54" type="hidden" />
</body>
</html>