<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.controls/src/test/java/test/javafx/scene/control/TabPaneTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
<a name="1" id="anc1"></a><span class="line-modified">   2  * Copyright (c) 2010, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import com.sun.javafx.scene.SceneHelper;
  29 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertPseudoClassDoesNotExist;
  30 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertPseudoClassExists;
  31 import static test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils.assertStyleClassContains;
  32 import static org.junit.Assert.assertEquals;
  33 import static org.junit.Assert.assertFalse;
  34 import static org.junit.Assert.assertNotNull;
  35 import static org.junit.Assert.assertNull;
  36 import static org.junit.Assert.assertSame;
  37 import static org.junit.Assert.assertTrue;
  38 import static org.junit.Assert.fail;
  39 
  40 import test.com.sun.javafx.scene.control.infrastructure.StageLoader;
  41 import javafx.application.Platform;
  42 import javafx.beans.property.BooleanProperty;
  43 import javafx.beans.property.DoubleProperty;
  44 import javafx.beans.property.ObjectProperty;
  45 import javafx.beans.property.SimpleBooleanProperty;
  46 import javafx.beans.property.SimpleDoubleProperty;
  47 import javafx.beans.property.SimpleObjectProperty;
  48 import javafx.beans.value.ChangeListener;
  49 import javafx.css.CssMetaData;
  50 import javafx.css.StyleableProperty;
  51 import javafx.event.Event;
  52 import javafx.geometry.Bounds;
  53 import javafx.geometry.Side;
  54 import javafx.scene.Group;
  55 import javafx.scene.Scene;
  56 import javafx.scene.input.KeyEvent;
  57 import javafx.scene.input.MouseEvent;
  58 import javafx.scene.layout.StackPane;
  59 import javafx.scene.layout.VBox;
  60 import javafx.stage.Stage;
  61 
  62 import org.junit.Before;
  63 import org.junit.Ignore;
  64 import org.junit.Test;
  65 
  66 import test.com.sun.javafx.pgstub.StubToolkit;
  67 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  68 import test.com.sun.javafx.scene.control.infrastructure.MouseEventGenerator;
  69 import com.sun.javafx.scene.input.KeyCodeMap;
  70 import com.sun.javafx.tk.Toolkit;
  71 
  72 import java.util.Arrays;
  73 import java.util.HashMap;
  74 import java.util.LinkedList;
  75 import java.util.List;
  76 import java.util.Map;
  77 import javafx.scene.control.Button;
  78 import javafx.scene.control.ContextMenu;
  79 import javafx.scene.control.ScrollPane;
  80 import javafx.scene.control.SingleSelectionModel;
  81 import javafx.scene.control.SingleSelectionModelShim;
  82 import javafx.scene.control.skin.TabPaneSkin;
  83 import javafx.scene.control.skin.TabPaneSkinShim;
  84 import javafx.scene.control.SplitPane;
  85 import javafx.scene.control.Tab;
  86 import javafx.scene.control.TabPane;
  87 import javafx.scene.control.TabPaneShim;
  88 
  89 import java.lang.ref.WeakReference;
  90 
  91 public class TabPaneTest {
  92     private TabPane tabPane;//Empty string
  93     private Toolkit tk;
  94     private SingleSelectionModel&lt;Tab&gt; sm;
  95     private Tab tab1;
  96     private Tab tab2;
  97     private Tab tab3;
  98     private Scene scene;
  99     private Stage stage;
 100     private StackPane root;
 101 
 102     @Before public void setup() {
 103         tk = (StubToolkit)Toolkit.getToolkit();//This step is not needed (Just to make sure StubToolkit is loaded into VM)
 104         tabPane = new TabPane();
 105         tab1 = new Tab(&quot;one&quot;);
 106         tab2 = new Tab(&quot;two&quot;);
 107         tab3 = new Tab(&quot;three&quot;);
 108         sm = TabPaneShim.getTabPaneSelectionModel(tabPane);
 109         root = new StackPane();
 110         scene = new Scene(root);
 111         stage = new Stage();
 112         stage.setScene(scene);
 113     }
 114 
 115     /*********************************************************************
 116      * Helper methods                                                    *
 117      ********************************************************************/
 118 
 119     private void show() {
 120         stage.show();
 121         stage.requestFocus();
 122     }
 123 
 124     /*********************************************************************
 125      * Tests for default values                                         *
 126      ********************************************************************/
 127 
 128     @Test public void defaultConstructorShouldSetStyleClassTo_tabpane() {
 129         assertStyleClassContains(tabPane, &quot;tab-pane&quot;);
 130     }
 131 
 132     @Test public void defaultConstructorSelectionModelNotNull() {
 133         assertNotNull(tabPane.getSelectionModel());
 134     }
 135 
 136     @Test public void defaultConstructorInitialTabsEmpty() {
 137         assertNotNull(tabPane.getTabs());
 138         assertEquals(tabPane.getTabs().size(), 0.0, 0.0);
 139     }
 140 
 141     @Test public void defaultSideIsTop() {
 142         assertSame(tabPane.getSide(), Side.TOP);
 143     }
 144 
 145     @Test public void defaultConstructorTabClosingPolicy() {
 146         assertNotNull(tabPane.getTabClosingPolicy());
 147         assertSame(tabPane.getTabClosingPolicy(), TabPane.TabClosingPolicy.SELECTED_TAB);
 148     }
 149 
 150     @Test public void defaultConstructorRotateGraphic() {
 151         assertFalse(tabPane.isRotateGraphic());
 152     }
 153 
 154     @Test public void defaultTabMinWidth() {
 155         assertEquals(tabPane.getTabMinWidth(), 0.0, 0.0);
 156     }
 157 
 158     @Test public void defaultTabMaxWidth() {
 159         assertEquals(tabPane.getTabMaxWidth(), Double.MAX_VALUE, 0.0);
 160     }
 161 
 162     @Test public void defaultTabMinHeight() {
 163         assertEquals(tabPane.getTabMinHeight(), 0.0, 0.0);
 164     }
 165 
 166     @Test public void defaultTabMaxHeight() {
 167         assertEquals(tabPane.getTabMaxHeight(), Double.MAX_VALUE, 0.0);
 168     }
 169 
 170     @Test public void defaultSelectionModelEmpty() {
 171         assertTrue(tabPane.getSelectionModel().isEmpty());
 172     }
 173 
 174     @Test public void initialBoundsInParentMatchesWidthAndHeight() {
 175         TabPane testPane = new TabPane();
 176         testPane.resize(400, 400);
 177         testPane.setSkin(new TabPaneSkin(testPane));
 178         Bounds boundsInParent = testPane.getBoundsInParent();
 179         assertEquals(testPane.getWidth(), boundsInParent.getWidth(), 0.0);
 180         assertEquals(testPane.getHeight(), boundsInParent.getHeight(), 0.0);
 181     }
 182 
 183     /*********************************************************************
 184      * Tests for property binding                                        *
 185      ********************************************************************/
 186 
 187     @Test public void checkSelectionModelPropertyBind() {
 188         ObjectProperty objPr = new SimpleObjectProperty&lt;SingleSelectionModel&lt;Tab&gt;&gt;(null);
 189         tabPane.selectionModelProperty().bind(objPr);
 190         assertNull(&quot;selectionModel cannot be bound&quot;, tabPane.selectionModelProperty().getValue());
 191         objPr.setValue(sm);
 192         assertSame(&quot;selectionModel cannot be bound&quot;, tabPane.selectionModelProperty().getValue(), sm);
 193     }
 194 
 195     @Test public void checkSidePropertyBind() {
 196         ObjectProperty objPr = new SimpleObjectProperty&lt;Side&gt;(Side.BOTTOM);
 197         tabPane.sideProperty().bind(objPr);
 198         assertSame(&quot;side cannot be bound&quot;, tabPane.sideProperty().getValue(), Side.BOTTOM);
 199         objPr.setValue(Side.RIGHT);
 200         assertSame(&quot;side cannot be bound&quot;, tabPane.sideProperty().getValue(), Side.RIGHT);
 201     }
 202 
 203     @Test public void checkTabClosingPropertyBind() {
 204         ObjectProperty objPr = new SimpleObjectProperty&lt;TabPane.TabClosingPolicy&gt;(TabPane.TabClosingPolicy.UNAVAILABLE);
 205         tabPane.tabClosingPolicyProperty().bind(objPr);
 206         assertSame(&quot;side cannot be bound&quot;, tabPane.tabClosingPolicyProperty().getValue(), TabPane.TabClosingPolicy.UNAVAILABLE);
 207         objPr.setValue(TabPane.TabClosingPolicy.ALL_TABS);
 208         assertSame(&quot;side cannot be bound&quot;, tabPane.tabClosingPolicyProperty().getValue(), TabPane.TabClosingPolicy.ALL_TABS);
 209     }
 210 
 211     @Test public void checkRotateGraphicsPropertyBind() {
 212         BooleanProperty objPr = new SimpleBooleanProperty(false);
 213         tabPane.rotateGraphicProperty().bind(objPr);
 214         assertFalse(&quot;rotateGraphic cannot be bound&quot;, tabPane.rotateGraphicProperty().getValue());
 215         objPr.setValue(true);
 216         assertTrue(&quot;rotateGraphic cannot be bound&quot;, tabPane.rotateGraphicProperty().getValue());
 217     }
 218 
 219     @Test public void checkTabMinWidthPropertyBind() {
 220         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 221         tabPane.tabMinWidthProperty().bind(objPr);
 222         assertEquals(&quot;tabMinWidthProperty cannot be bound&quot;, tabPane.tabMinWidthProperty().getValue(), 2.0, 0.0);
 223         objPr.setValue(5.0);
 224         assertEquals(&quot;tabMinWidthProperty cannot be bound&quot;, tabPane.tabMinWidthProperty().getValue(), 5.0, 0.0);
 225     }
 226 
 227     @Test public void checkTabMaxWidthPropertyBind() {
 228         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 229         tabPane.tabMaxWidthProperty().bind(objPr);
 230         assertEquals(&quot;tabMaxWidthProperty cannot be bound&quot;, tabPane.tabMaxWidthProperty().getValue(), 2.0, 0.0);
 231         objPr.setValue(5.0);
 232         assertEquals(&quot;tabMaxWidthProperty cannot be bound&quot;, tabPane.tabMaxWidthProperty().getValue(), 5.0, 0.0);
 233     }
 234 
 235 
 236     @Test public void checkTabMinHeightPropertyBind() {
 237         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 238         tabPane.tabMinHeightProperty().bind(objPr);
 239         assertEquals(&quot;tabMinHeightProperty cannot be bound&quot;, tabPane.tabMinHeightProperty().getValue(), 2.0, 0.0);
 240         objPr.setValue(5.0);
 241         assertEquals(&quot;tabMinHeightProperty cannot be bound&quot;, tabPane.tabMinHeightProperty().getValue(), 5.0, 0.0);
 242     }
 243 
 244     @Test public void checkTabMaxHeightPropertyBind() {
 245         DoubleProperty objPr = new SimpleDoubleProperty(2.0);
 246         tabPane.tabMaxHeightProperty().bind(objPr);
 247         assertEquals(&quot;tabMaxHeightProperty cannot be bound&quot;, tabPane.tabMaxHeightProperty().getValue(), 2.0, 0.0);
 248         objPr.setValue(5.0);
 249         assertEquals(&quot;tabMaxHeightProperty cannot be bound&quot;, tabPane.tabMaxHeightProperty().getValue(), 5.0, 0.0);
 250     }
 251 
 252     @Test public void selectionModelPropertyHasBeanReference() {
 253         assertSame(tabPane, tabPane.selectionModelProperty().getBean());
 254     }
 255 
 256     @Test public void selectionModelPropertyHasName() {
 257         assertEquals(&quot;selectionModel&quot;, tabPane.selectionModelProperty().getName());
 258     }
 259 
 260     @Test public void sidePropertyHasBeanReference() {
 261         assertSame(tabPane, tabPane.sideProperty().getBean());
 262     }
 263 
 264     @Test public void sidePropertyHasName() {
 265         assertEquals(&quot;side&quot;, tabPane.sideProperty().getName());
 266     }
 267 
 268     @Test public void tabClosingPolicyPropertyHasBeanReference() {
 269         assertSame(tabPane, tabPane.tabClosingPolicyProperty().getBean());
 270     }
 271 
 272     @Test public void tabClosingPolicyPropertyHasName() {
 273         assertEquals(&quot;tabClosingPolicy&quot;, tabPane.tabClosingPolicyProperty().getName());
 274     }
 275 
 276     @Test public void rotateGraphicPropertyHasBeanReference() {
 277         assertSame(tabPane, tabPane.rotateGraphicProperty().getBean());
 278     }
 279 
 280     @Test public void rotateGraphicPropertyHasName() {
 281         assertEquals(&quot;rotateGraphic&quot;, tabPane.rotateGraphicProperty().getName());
 282     }
 283 
 284     @Test public void tabMinWidthPropertyHasBeanReference() {
 285         assertSame(tabPane, tabPane.tabMinWidthProperty().getBean());
 286     }
 287 
 288     @Test public void tabMinWidthPropertyHasName() {
 289         assertEquals(&quot;tabMinWidth&quot;, tabPane.tabMinWidthProperty().getName());
 290     }
 291 
 292     @Test public void tabMaxWidthPropertyHasBeanReference() {
 293         assertSame(tabPane, tabPane.tabMaxWidthProperty().getBean());
 294     }
 295 
 296     @Test public void tabMaxWidthPropertyHasName() {
 297         assertEquals(&quot;tabMaxWidth&quot;, tabPane.tabMaxWidthProperty().getName());
 298     }
 299 
 300     @Test public void tabMinHeightPropertyHasBeanReference() {
 301         assertSame(tabPane, tabPane.tabMinHeightProperty().getBean());
 302     }
 303 
 304     @Test public void tabMinHeightPropertyHasName() {
 305         assertEquals(&quot;tabMinHeight&quot;, tabPane.tabMinHeightProperty().getName());
 306     }
 307 
 308     @Test public void tabMaxHeightPropertyHasBeanReference() {
 309         assertSame(tabPane, tabPane.tabMaxHeightProperty().getBean());
 310     }
 311 
 312     @Test public void tabMaxHeightPropertyHasName() {
 313         assertEquals(&quot;tabMaxHeight&quot;, tabPane.tabMaxHeightProperty().getName());
 314     }
 315 
 316 
 317     /*********************************************************************
 318      * Check for Pseudo classes                                          *
 319      ********************************************************************/
 320 
 321     @Test public void settingSideSetsPseudoClass() {
 322         tabPane.setSide(Side.BOTTOM);
 323         assertPseudoClassExists(tabPane, &quot;bottom&quot;);
 324         assertPseudoClassDoesNotExist(tabPane, &quot;top&quot;);
 325         assertPseudoClassDoesNotExist(tabPane, &quot;left&quot;);
 326         assertPseudoClassDoesNotExist(tabPane, &quot;right&quot;);
 327     }
 328 
 329     @Test public void clearingSideClearsPseudoClass() {
 330         tabPane.setSide(Side.BOTTOM);
 331         tabPane.setSide(Side.LEFT);
 332         assertPseudoClassExists(tabPane, &quot;left&quot;);
 333         assertPseudoClassDoesNotExist(tabPane, &quot;bottom&quot;);
 334         assertPseudoClassDoesNotExist(tabPane, &quot;top&quot;);
 335         assertPseudoClassDoesNotExist(tabPane, &quot;right&quot;);
 336     }
 337 
 338 
 339     /*********************************************************************
 340      * CSS related Tests                                                 *
 341      ********************************************************************/
 342 
 343     @Test public void whenTabMinWidthIsBound_impl_cssSettable_ReturnsFalse() {
 344         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinWidthProperty()).getCssMetaData();
 345         assertTrue(styleable.isSettable(tabPane));
 346         DoubleProperty other = new SimpleDoubleProperty(30.0);
 347         tabPane.tabMinWidthProperty().bind(other);
 348         assertFalse(styleable.isSettable(tabPane));
 349     }
 350 
 351     @Test public void whenTabMinWidthIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 352         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinWidthProperty()).getCssMetaData();
 353         assertTrue(styleable.isSettable(tabPane));
 354     }
 355 
 356     @Test public void canSpecifyTabMinWidthViaCSS() {
 357         ((StyleableProperty)tabPane.tabMinWidthProperty()).applyStyle(null, 34.0);
 358         assertEquals(34.0, tabPane.getTabMinWidth(), 0.0);
 359     }
 360 
 361     @Test public void whenTabMaxWidthIsBound_impl_cssSettable_ReturnsFalse() {
 362         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxWidthProperty()).getCssMetaData();
 363         assertTrue(styleable.isSettable(tabPane));
 364         DoubleProperty other = new SimpleDoubleProperty(30.0);
 365         tabPane.tabMaxWidthProperty().bind(other);
 366         assertFalse(styleable.isSettable(tabPane));
 367     }
 368 
 369     @Test public void whenTabMaxWidthIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 370         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxWidthProperty()).getCssMetaData();
 371         assertTrue(styleable.isSettable(tabPane));
 372     }
 373 
 374     @Test public void canSpecifyTabMaxWidthViaCSS() {
 375         ((StyleableProperty)tabPane.tabMaxWidthProperty()).applyStyle(null, 34.0);
 376         assertEquals(34.0, tabPane.getTabMaxWidth(), 0.0);
 377     }
 378 
 379     @Test public void whenTabMinHeightIsBound_impl_cssSettable_ReturnsFalse() {
 380         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinHeightProperty()).getCssMetaData();
 381         assertTrue(styleable.isSettable(tabPane));
 382         DoubleProperty other = new SimpleDoubleProperty(30.0);
 383         tabPane.tabMinHeightProperty().bind(other);
 384         assertFalse(styleable.isSettable(tabPane));
 385     }
 386 
 387     @Test public void whenTabMinHeightIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 388         CssMetaData styleable = ((StyleableProperty)tabPane.tabMinHeightProperty()).getCssMetaData();
 389         assertTrue(styleable.isSettable(tabPane));
 390     }
 391 
 392     @Test public void canSpecifyTabMinHeightViaCSS() {
 393         ((StyleableProperty)tabPane.tabMinHeightProperty()).applyStyle(null, 34.0);
 394         assertEquals(34.0, tabPane.getTabMinHeight(), 0.0);
 395     }
 396 
 397     @Test public void whenTabMaxHeightIsBound_impl_cssSettable_ReturnsFalse() {
 398         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxHeightProperty()).getCssMetaData();
 399         assertTrue(styleable.isSettable(tabPane));
 400         DoubleProperty other = new SimpleDoubleProperty(30.0);
 401         tabPane.tabMaxHeightProperty().bind(other);
 402         assertFalse(styleable.isSettable(tabPane));
 403     }
 404 
 405     @Test public void whenTabMaxHeightIsSpecifiedViaCSSAndIsNotBound_impl_cssSettable_ReturnsTrue() {
 406         CssMetaData styleable = ((StyleableProperty)tabPane.tabMaxHeightProperty()).getCssMetaData();
 407         assertTrue(styleable.isSettable(tabPane));
 408     }
 409 
 410     @Test public void canSpecifyTabMaxHeightViaCSS() {
 411         ((StyleableProperty)tabPane.tabMaxHeightProperty()).applyStyle(null, 34.0);
 412         assertEquals(34.0, tabPane.getTabMaxHeight(), 0.0);
 413     }
 414 
 415 
 416     /*********************************************************************
 417      * Miscellaneous Tests                                               *
 418      ********************************************************************/
 419 
 420     @Test public void setSelectionModelAndSeeValueIsReflectedInModel() {
 421         tabPane.setSelectionModel(sm);
 422         assertSame(tabPane.selectionModelProperty().getValue(), sm);
 423     }
 424 
 425     @Test public void setselectionModelAndSeeValue() {
 426         tabPane.setSelectionModel(sm);
 427         assertSame(tabPane.getSelectionModel(), sm);
 428     }
 429 
 430     @Test public void setSideAndSeeValueIsReflectedInModel() {
 431         tabPane.setSide(Side.BOTTOM);
 432         assertSame(tabPane.sideProperty().getValue(), Side.BOTTOM);
 433     }
 434 
 435     @Test public void setSideAndSeeValue() {
 436         tabPane.setSide(Side.LEFT);
 437         assertSame(tabPane.getSide(), Side.LEFT);
 438     }
 439 
 440     @Test public void setTabClosingPolicyAndSeeValueIsReflectedInModel() {
 441         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.ALL_TABS);
 442         assertSame(tabPane.tabClosingPolicyProperty().getValue(), TabPane.TabClosingPolicy.ALL_TABS);
 443     }
 444 
 445     @Test public void setTabClosingPolicyAndSeeValue() {
 446         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.UNAVAILABLE);
 447         assertSame(tabPane.getTabClosingPolicy(), TabPane.TabClosingPolicy.UNAVAILABLE);
 448     }
 449 
 450     @Test public void setTabDragPolicyAndSeeValueIsReflectedInModel() {
 451         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.REORDER);
 452         assertSame(TabPane.TabDragPolicy.REORDER, tabPane.tabDragPolicyProperty().getValue());
 453 
 454         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.FIXED);
 455         assertSame(TabPane.TabDragPolicy.FIXED, tabPane.tabDragPolicyProperty().getValue());
 456     }
 457 
 458     @Test public void setTabDragPolicyAndSeeValue() {
 459         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.REORDER);
 460         assertSame(TabPane.TabDragPolicy.REORDER, tabPane.getTabDragPolicy());
 461 
 462         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.FIXED);
 463         assertSame(TabPane.TabDragPolicy.FIXED, tabPane.getTabDragPolicy());
 464     }
 465 
<a name="2" id="anc2"></a><span class="line-added"> 466     @Test public void tabDragPolicyReorderAndAsymmetricMouseEvent() {</span>
<span class="line-added"> 467         tabPane.setTabDragPolicy(TabPane.TabDragPolicy.REORDER);</span>
<span class="line-added"> 468         tabPane.getTabs().add(tab1);</span>
<span class="line-added"> 469         tabPane.getTabs().add(tab2);</span>
<span class="line-added"> 470         root.getChildren().add(tabPane);</span>
<span class="line-added"> 471         show();</span>
<span class="line-added"> 472 </span>
<span class="line-added"> 473         root.layout();</span>
<span class="line-added"> 474 </span>
<span class="line-added"> 475         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();</span>
<span class="line-added"> 476         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();</span>
<span class="line-added"> 477 </span>
<span class="line-added"> 478         SceneHelper.processMouseEvent(scene,</span>
<span class="line-added"> 479             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_RELEASED, xval+75, yval+20));</span>
<span class="line-added"> 480         tk.firePulse();</span>
<span class="line-added"> 481     }</span>
<span class="line-added"> 482 </span>
 483     @Test public void setRotateGraphicAndSeeValueIsReflectedInModel() {
 484         tabPane.setRotateGraphic(true);
 485         assertTrue(tabPane.rotateGraphicProperty().getValue());
 486     }
 487 
 488     @Test public void setRotateGraphicAndSeeValue() {
 489         tabPane.setRotateGraphic(true);
 490         assertTrue(tabPane.isRotateGraphic());
 491     }
 492 
 493     @Test public void setTabMinWidthAndSeeValueIsReflectedInModel() {
 494         tabPane.setTabMinWidth(30.0);
 495         assertEquals(tabPane.tabMinWidthProperty().getValue(), 30.0, 0.0);
 496     }
 497 
 498     @Test public void setTabMinWidthAndSeeValue() {
 499         tabPane.setTabMinWidth(30.0);
 500         assertEquals(tabPane.getTabMinWidth(), 30.0, 0.0);
 501     }
 502 
 503     @Test public void setTabMaxWidthAndSeeValueIsReflectedInModel() {
 504         tabPane.setTabMaxWidth(30.0);
 505         assertEquals(tabPane.tabMaxWidthProperty().getValue(), 30.0, 0.0);
 506     }
 507 
 508     @Test public void setTabMaxWidthAndSeeValue() {
 509         tabPane.setTabMaxWidth(30.0);
 510         assertEquals(tabPane.getTabMaxWidth(), 30.0, 0.0);
 511     }
 512 
 513     @Test public void setTabMinHeightAndSeeValueIsReflectedInModel() {
 514         tabPane.setTabMinHeight(30.0);
 515         assertEquals(tabPane.tabMinHeightProperty().getValue(), 30.0, 0.0);
 516     }
 517 
 518     @Test public void setTabMinHeightAndSeeValue() {
 519         tabPane.setTabMinHeight(30.0);
 520         assertEquals(tabPane.getTabMinHeight(), 30.0, 0.0);
 521     }
 522 
 523     @Test public void setTabMaxHeightAndSeeValueIsReflectedInModel() {
 524         tabPane.setTabMaxHeight(30.0);
 525         assertEquals(tabPane.tabMaxHeightProperty().getValue(), 30.0, 0.0);
 526     }
 527 
 528     @Test public void setTabMaxHeightAndSeeValue() {
 529         tabPane.setTabMaxHeight(30.0);
 530         assertEquals(tabPane.getTabMaxHeight(), 30.0, 0.0);
 531     }
 532 
 533     @Test public void addTabsCheckItemCountInSelectionModel() {
 534         tabPane.getTabs().add(tab1);
 535         tabPane.getTabs().add(tab2);
 536         assertEquals(SingleSelectionModelShim.getItemCount(tabPane.getSelectionModel()), 2.0, 0.0);
 537     }
 538 
 539     @Test public void addTabsCheckItemInSelectionModel() {
 540         tabPane.getTabs().add(tab1);
 541         tabPane.getTabs().add(tab2);
 542         assertSame(SingleSelectionModelShim.getModelItem(tabPane.getSelectionModel(), 0), tab1);
 543         assertSame(SingleSelectionModelShim.getModelItem(tabPane.getSelectionModel(), 1), tab2);
 544     }
 545 
 546     @Test public void addTabsCheckSelectUsingObjInSelectionModel() {
 547         tabPane.getTabs().add(tab1);
 548         tabPane.getTabs().add(tab2);
 549         tabPane.getSelectionModel().select(tab1);
 550         assertTrue(tabPane.getSelectionModel().isSelected(0));
 551     }
 552 
 553     @Test public void addTabsCheckSelectUsingIndexInSelectionModel() {
 554         tabPane.getTabs().add(tab1);
 555         tabPane.getTabs().add(tab2);
 556         tabPane.getSelectionModel().select(1);
 557         assertTrue(tabPane.getSelectionModel().isSelected(1));
 558     }
 559 
 560     @Test public void addTabsCheckClearAndSelectUsingIndexInSelectionModel() {
 561         tabPane.getTabs().add(tab1);
 562         tabPane.getTabs().add(tab2);
 563         tabPane.getSelectionModel().clearAndSelect(1);
 564         assertTrue(tabPane.getSelectionModel().isSelected(1));
 565     }
 566 
 567     @Test public void addTabsCheckSelectMultipleItemsAndClearOneItemInSelectionModel() {
 568         tabPane.getTabs().add(tab1);
 569         tabPane.getTabs().add(tab2);
 570         tabPane.getSelectionModel().select(0);
 571         tabPane.getSelectionModel().select(1);
 572         tabPane.getSelectionModel().clearSelection(0);
 573         assertFalse(tabPane.getSelectionModel().isSelected(0));
 574         assertTrue(tabPane.getSelectionModel().isSelected(1));
 575     }
 576 
 577     @Test public void addTabsCheckSelectMultipleItemsAndClearAllSelectionInSelectionModel() {
 578         tabPane.getTabs().add(tab1);
 579         tabPane.getTabs().add(tab2);
 580         tabPane.getSelectionModel().select(0);
 581         tabPane.getSelectionModel().select(1);
 582         tabPane.getSelectionModel().clearSelection();
 583         assertFalse(tabPane.getSelectionModel().isSelected(0));
 584         assertFalse(tabPane.getSelectionModel().isSelected(1));
 585         assertTrue(tabPane.getSelectionModel().isEmpty());
 586     }
 587 
 588     @Test public void addTabsCheckSelectUsingIteratorKindOfMethodsInSelectionModel() {
 589         tabPane.getTabs().add(tab1);
 590         tabPane.getTabs().add(tab2);
 591         tabPane.getSelectionModel().selectFirst();
 592         assertTrue(tabPane.getSelectionModel().isSelected(0));
 593         assertFalse(tabPane.getSelectionModel().isSelected(1));
 594         tabPane.getSelectionModel().selectNext();
 595         assertFalse(tabPane.getSelectionModel().isSelected(0));
 596         assertTrue(tabPane.getSelectionModel().isSelected(1));
 597         tabPane.getSelectionModel().clearSelection();
 598         tabPane.getSelectionModel().selectLast();
 599         assertFalse(tabPane.getSelectionModel().isSelected(0));
 600         assertTrue(tabPane.getSelectionModel().isSelected(1));
 601         tabPane.getSelectionModel().selectPrevious();
 602         assertTrue(tabPane.getSelectionModel().isSelected(0));
 603         assertFalse(tabPane.getSelectionModel().isSelected(1));
 604     }
 605 
 606     @Test public void flipTabOrder_RT20156() {
 607         tabPane.setSkin(new TabPaneSkin(tabPane));
 608         tabPane.getTabs().add(tab1);
 609         tabPane.getTabs().add(tab2);
 610         tabPane.getTabs().add(tab3);
 611 
 612         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 613         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 614         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 615 
 616         final int lastTabIndex = tabPane.getTabs().size()-1;
 617         final Tab lastTab = tabPane.getTabs().get(lastTabIndex);
 618         tabPane.getTabs().remove(lastTabIndex);
 619         tabPane.getTabs().add(0, lastTab);
 620 
 621         assertEquals(&quot;three&quot;, tabPane.getTabs().get(0).getText());
 622         assertEquals(&quot;one&quot;, tabPane.getTabs().get(1).getText());
 623         assertEquals(&quot;two&quot;, tabPane.getTabs().get(2).getText());
 624         assertTrue(tabPane.getSelectionModel().isSelected(1));
 625     }
 626 
 627     @Test public void disableAllTabs() {
 628         tabPane.setSkin(new TabPaneSkin(tabPane));
 629         tabPane.getTabs().add(tab1);
 630         tabPane.getTabs().add(tab2);
 631         tabPane.getTabs().add(tab3);
 632 
 633         tab1.setDisable(true);
 634         tab2.setDisable(true);
 635         tab3.setDisable(true);
 636 
 637         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 638         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 639     }
 640 
 641     @Test public void disableFirstTabs() {
 642         tabPane.setSkin(new TabPaneSkin(tabPane));
 643         tabPane.getTabs().add(tab1);
 644         tabPane.getTabs().add(tab2);
 645         tabPane.getTabs().add(tab3);
 646 
 647         tab1.setDisable(true);
 648         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 649         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 650     }
 651 
 652     @Test public void disableATabAndSelectItByIndex() {
 653         tabPane.setSkin(new TabPaneSkin(tabPane));
 654         tabPane.getTabs().add(tab1);
 655         tabPane.getTabs().add(tab2);
 656         tabPane.getTabs().add(tab3);
 657 
 658         tab2.setDisable(true);
 659         tabPane.getSelectionModel().select(1);
 660         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 661         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 662     }
 663 
 664     @Test public void selectByIndexADisableTab() {
 665         tabPane.setSkin(new TabPaneSkin(tabPane));
 666         tabPane.getTabs().add(tab1);
 667         tabPane.getTabs().add(tab2);
 668         tabPane.getTabs().add(tab3);
 669 
 670         tabPane.getSelectionModel().select(1);
 671         tab2.setDisable(true);
 672         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 673         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 674         assertTrue(tab2.isDisable());
 675     }
 676 
 677     @Test public void disableATabAndSelectItByTab() {
 678         tabPane.setSkin(new TabPaneSkin(tabPane));
 679         tabPane.getTabs().add(tab1);
 680         tabPane.getTabs().add(tab2);
 681         tabPane.getTabs().add(tab3);
 682 
 683         tab2.setDisable(true);
 684         tabPane.getSelectionModel().select(tab2);
 685         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 686         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 687     }
 688 
 689     @Test public void selectByTabADisableTab() {
 690         tabPane.setSkin(new TabPaneSkin(tabPane));
 691         tabPane.getTabs().add(tab1);
 692         tabPane.getTabs().add(tab2);
 693         tabPane.getTabs().add(tab3);
 694 
 695         tabPane.getSelectionModel().select(tab2);
 696         tab2.setDisable(true);
 697         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 698         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 699         assertTrue(tab2.isDisable());
 700     }
 701 
 702     @Test public void navigateOverDisableTab() {
 703         tabPane.getTabs().add(tab1);
 704         tabPane.getTabs().add(tab2);
 705         tabPane.getTabs().add(tab3);
 706 
 707         root.getChildren().add(tabPane);
 708         show();
 709         tabPane.requestFocus();
 710 
 711         assertTrue(tabPane.isFocused());
 712 
 713         tab2.setDisable(true);
 714         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 715         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 716         assertTrue(tab2.isDisable());
 717 
 718         KeyEventFirer keyboard = new KeyEventFirer(tabPane);
 719         keyboard.doRightArrowPress();
 720 
 721         assertEquals(2, tabPane.getSelectionModel().getSelectedIndex());
 722         assertEquals(tab3, tabPane.getSelectionModel().getSelectedItem());
 723 
 724         keyboard.doLeftArrowPress();
 725 
 726         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 727         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 728     }
 729 
 730     @Ignore
 731     @Test public void mousePressSelectsATab_RT20476() {
 732         tabPane.getTabs().add(tab1);
 733         tabPane.getTabs().add(tab2);
 734         tabPane.getTabs().add(tab3);
 735 
 736         tab1.setContent(new Button(&quot;TAB1&quot;));
 737         tab2.setContent(new Button(&quot;TAB2&quot;));
 738         tab3.setContent(new Button(&quot;TAB3&quot;));
 739 
 740         root.getChildren().add(tabPane);
 741         show();
 742 
 743         root.applyCss();
 744         root.resize(300, 300);
 745         root.layout();
 746 
 747         tk.firePulse();
 748         assertTrue(tabPane.isFocused());
 749 
 750         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
 751         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
 752 
 753         SceneHelper.processMouseEvent(scene,
 754             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval+75, yval+20));
 755         tk.firePulse();
 756 
 757         assertEquals(1, tabPane.getSelectionModel().getSelectedIndex());
 758         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 759     }
 760 
 761     private int counter = 0;
 762     @Ignore
 763     @Test public void setOnSelectionChangedFiresTwice_RT21089() {
 764         tabPane.getTabs().add(tab1);
 765         tabPane.getTabs().add(tab2);
 766 
 767         tab1.setContent(new Button(&quot;TAB1&quot;));
 768         tab2.setContent(new Button(&quot;TAB2&quot;));
 769 
 770         root.getChildren().add(tabPane);
 771         show();
 772 
 773         root.applyCss();
 774         root.resize(300, 300);
 775         root.layout();
 776 
 777         tk.firePulse();
 778         assertTrue(tabPane.isFocused());
 779 
 780         tab2.setOnSelectionChanged(event -&gt; {
 781             assertEquals(0, counter++);
 782         });
 783 
 784         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
 785         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
 786 
 787         SceneHelper.processMouseEvent(scene,
 788             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval+75, yval+20));
 789         tk.firePulse();
 790 
 791         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 792 
 793         SceneHelper.processMouseEvent(scene,
 794             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval+75, yval+20));
 795         tk.firePulse();
 796         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 797     }
 798 
 799     @Test public void unableToSelectNextTabWhenFirstTabIsClosed_RT22326() {
 800         tabPane.getTabs().add(tab1);
 801         tabPane.getTabs().add(tab2);
 802         tabPane.getTabs().add(tab3);
 803 
 804         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 805         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 806         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 807 
 808         tabPane.getTabs().remove(tab1);
 809 
 810         assertEquals(2, tabPane.getTabs().size());
 811         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 812         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 813         tabPane.getSelectionModel().selectNext();
 814         assertEquals(tab3, tabPane.getSelectionModel().getSelectedItem());
 815     }
 816 
 817     @Test public void removeFirstTabNextTabShouldBeSelected() {
 818         tabPane.getTabs().add(tab1);
 819         tabPane.getTabs().add(tab2);
 820         tabPane.getTabs().add(tab3);
 821 
 822         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 823         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 824         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 825 
 826         tabPane.getTabs().remove(tab1);
 827 
 828         assertEquals(2, tabPane.getTabs().size());
 829         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 830         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 831     }
 832 
 833     @Test public void selectionModelShouldNotBeNullWhenClosingFirstTab_RT22925() {
 834         tabPane.getTabs().add(tab1);
 835         tabPane.getTabs().add(tab2);
 836         tabPane.getTabs().add(tab3);
 837 
 838         tabPane.getSelectionModel().selectedItemProperty().addListener((ov, t, t1) -&gt; {
 839             assertEquals(t.getText(), &quot;one&quot;);
 840             assertEquals(t1.getText(), &quot;two&quot;);
 841         });
 842 
 843         assertEquals(&quot;one&quot;, tabPane.getTabs().get(0).getText());
 844         assertEquals(&quot;two&quot;, tabPane.getTabs().get(1).getText());
 845         assertEquals(&quot;three&quot;, tabPane.getTabs().get(2).getText());
 846 
 847         tabPane.getTabs().remove(tab1);
 848 
 849         assertEquals(2, tabPane.getTabs().size());
 850         assertEquals(0, tabPane.getSelectionModel().getSelectedIndex());
 851         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 852     }
 853 
 854 
 855     boolean button1Focused = false;
 856     @Test public void focusTraversalShouldLookInsideEmbeddedEngines() {
 857 
 858         Button b1 = new Button(&quot;Button1&quot;);
 859         final ChangeListener&lt;Boolean&gt; focusListener = (observable, oldVal, newVal) -&gt; {
 860             button1Focused = true;
 861         };
 862         b1.focusedProperty().addListener(focusListener);
 863 
 864         final ScrollPane sp = new ScrollPane();
 865         final VBox vbox1 = new VBox();
 866         vbox1.setSpacing(10);
 867         vbox1.setTranslateX(10);
 868         vbox1.setTranslateY(10);
 869         vbox1.getChildren().addAll(b1);
 870         tab1.setContent(vbox1);
 871         sp.setContent(vbox1);
 872         tab1.setContent(sp);
 873         tabPane.getTabs().add(tab1);
 874 
 875         tabPane.getTabs().add(tab2);
 876 
 877         final Scene scene1 = new Scene(new Group(), 400, 400);
 878         ((Group)scene1.getRoot()).getChildren().add(tabPane);
 879 
 880         stage.setScene(scene1);
 881         stage.show();
 882         stage.requestFocus();
 883 
 884         final KeyEvent tabEvent = new KeyEvent(KeyEvent.KEY_PRESSED, &quot;&quot;, &quot;&quot;, KeyCodeMap.valueOf(0x09),
 885                                                          false, false, false, false);
 886         Platform.runLater(() -&gt; {
 887             tabPane.requestFocus();
 888             Event.fireEvent(tabPane, tabEvent);
 889 
 890         });
 891 
 892         assertTrue(button1Focused);
 893 
 894     }
 895 
 896     @Test public void test_rt_35013() {
 897         SplitPane splitPane = new SplitPane();
 898         splitPane.getItems().addAll(new Button(&quot;Button1&quot;), new Button(&quot;Button2&quot;));
 899 
 900         TabPane tabPane = new TabPane();
 901         Tab emptyTab;
 902         Tab splitTab = new Tab(&quot;SplitPane Tab&quot;);
 903         splitTab.setContent(splitPane);
 904         tabPane.getTabs().addAll(emptyTab = new Tab(&quot;Empty Tab&quot;), splitTab);
 905 
 906         StageLoader sl = new StageLoader(tabPane);
 907 
 908         tabPane.getSelectionModel().select(emptyTab);
 909         Toolkit.getToolkit().firePulse();
 910         assertFalse(splitPane.getParent().isVisible());
 911 
 912         tabPane.getSelectionModel().select(splitTab);
 913         Toolkit.getToolkit().firePulse();
 914         assertTrue(splitPane.getParent().isVisible());
 915 
 916         sl.dispose();
 917     }
 918 
 919     @Test public void test_rt_36456_default_selectionMovesBackwardOne() {
 920         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 921         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 922         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 923 
 924         TabPane tabPane = new TabPane();
 925         tabPane.getTabs().addAll(tab0, tab1, tab2);
 926         tabPane.getSelectionModel().select(tab1);
 927 
 928         StageLoader sl = new StageLoader(tabPane);
 929 
 930         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 931         tabPane.getTabs().remove(tab1);
 932         assertEquals(tab0, tabPane.getSelectionModel().getSelectedItem());
 933 
 934         sl.dispose();
 935     }
 936 
 937     @Test public void test_rt_36456_selectionMovesBackwardTwoSkippingDisabledTab() {
 938         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 939         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 940         tab1.setDisable(true);
 941         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 942 
 943         TabPane tabPane = new TabPane();
 944         tabPane.getTabs().addAll(tab0, tab1, tab2);
 945         tabPane.getSelectionModel().select(tab2);
 946 
 947         StageLoader sl = new StageLoader(tabPane);
 948 
 949         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 950         tabPane.getTabs().remove(tab2);
 951 
 952         // selection should jump from tab2 to tab0, as tab1 is disabled
 953         assertEquals(tab0, tabPane.getSelectionModel().getSelectedItem());
 954 
 955         sl.dispose();
 956     }
 957 
 958     @Test public void test_rt_36456_selectionMovesForwardOne() {
 959         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 960         tab0.setDisable(true);
 961         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 962         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 963 
 964         TabPane tabPane = new TabPane();
 965         tabPane.getTabs().addAll(tab0, tab1, tab2);
 966         tabPane.getSelectionModel().select(tab1);
 967 
 968         StageLoader sl = new StageLoader(tabPane);
 969 
 970         assertEquals(tab1, tabPane.getSelectionModel().getSelectedItem());
 971         tabPane.getTabs().remove(tab1);
 972 
 973         // selection should move to the next non-disabled tab - in this case tab2
 974         assertEquals(tab2, tabPane.getSelectionModel().getSelectedItem());
 975 
 976         sl.dispose();
 977     }
 978 
 979     @Test public void test_rt_36456_selectionMovesForwardTwoSkippingDisabledTab() {
 980         Tab tab0 = new Tab(&quot;Tab 0&quot;);
 981         Tab tab1 = new Tab(&quot;Tab 1&quot;);
 982         tab1.setDisable(true);
 983         Tab tab2 = new Tab(&quot;Tab 2&quot;);
 984 
 985         TabPane tabPane = new TabPane();
 986         tabPane.getTabs().addAll(tab0, tab1, tab2);
 987         tabPane.getSelectionModel().select(tab0);
 988 
 989         StageLoader sl = new StageLoader(tabPane);
 990 
 991         Tab selectedTab = tabPane.getSelectionModel().getSelectedItem();
 992         assertEquals(tab0, selectedTab);
 993         tabPane.getTabs().remove(tab0);
 994 
 995         // selection should move to the next non-disabled tab - in this case tab2
 996         selectedTab = tabPane.getSelectionModel().getSelectedItem();
 997         assertEquals(tab2.getText() + &quot; != &quot; +  tab2.getText(), tab2, selectedTab);
 998 
 999         sl.dispose();
1000     }
1001 
1002     @Test public void test_rt_36908() {
1003         TabPane pane = new TabPane();
1004         final Tab disabled = new Tab(&quot;Disabled&quot;);
1005         disabled.setDisable(true);
1006 
1007         Tab tab1 = new Tab(&quot;Tab 1&quot;);
1008         Tab tab2 = new Tab(&quot;Tab 2&quot;);
1009         pane.getTabs().addAll(disabled, tab1, tab2);
1010 
1011         assertEquals(1, pane.getSelectionModel().getSelectedIndex());
1012         assertEquals(tab1, pane.getSelectionModel().getSelectedItem());
1013     }
1014 
1015     @Test public void test_rt_24658() {
1016         Button btn = new Button(&quot;Button&quot;);
1017         final Tab disabled = new Tab(&quot;Disabled&quot;);
1018         disabled.setContent(btn);
1019 
1020         TabPane pane = new TabPane();
1021         pane.getTabs().addAll(disabled);
1022 
1023         assertEquals(0, pane.getSelectionModel().getSelectedIndex());
1024         assertEquals(disabled, pane.getSelectionModel().getSelectedItem());
1025         assertFalse(btn.isDisabled());
1026 
1027         disabled.setDisable(true);
1028         assertTrue(btn.isDisabled());
1029 
1030         disabled.setDisable(false);
1031         assertFalse(btn.isDisabled());
1032     }
1033 
1034     @Test public void test_rt_38382_noAddToTabPane() {
1035         test_rt_38382(false);
1036     }
1037 
1038     @Test public void test_rt_38382_addToTabPane() {
1039         test_rt_38382(true);
1040     }
1041 
1042     public void test_rt_38382(boolean addToTabPane) {
1043         final List&lt;String&gt; names = Arrays.asList(
1044                 &quot;Biomass&quot;,
1045                 &quot;Exploitable Population Biomass&quot;,
1046                 &quot;MSY&quot;,
1047                 &quot;Yield&quot;,
1048                 &quot;Recruitment&quot;,
1049                 &quot;Catch&quot;,
1050                 &quot;Effort&quot;);
1051         final Map&lt;Tab, List&lt;String&gt;&gt; fooMap = new HashMap&lt;&gt;();
1052         final List&lt;Tab&gt; tabList = new LinkedList&lt;&gt;();
1053         for (String name : names) {
1054             final Tab tab = new Tab();
1055             tab.setText(name);
1056             fooMap.put(tab, new LinkedList&lt;&gt;());
1057             tabList.add(tab);
1058         }
1059         TabPane tabPane = new TabPane();
1060 
1061         if (addToTabPane) {
1062             tabPane.getTabs().setAll(tabList);
1063         }
1064 
1065         fooMap.entrySet().forEach(entry -&gt; {
1066             final Tab tab = entry.getKey();
1067             assertTrue(tabList.contains(tab));
1068             assertTrue(fooMap.containsKey(tab));
1069         });
1070     }
1071 
1072     // Test for JDK-8189424
1073     int selectionChangeCount = 0;
1074     @Test public void testTabClosingEventAndSelectionChange() {
1075         Tab t1 = new Tab(&quot;&quot;);
1076         Tab t2 = new Tab(&quot;&quot;);
1077         tabPane.getTabs().add(t1);
1078         tabPane.getTabs().add(t2);
1079         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.ALL_TABS);
1080 
1081         tabPane.getSelectionModel().selectedItemProperty().addListener((ov, oldTab, newTab) -&gt; {
1082             selectionChangeCount++;
1083         });
1084         t1.setOnCloseRequest((event) -&gt; {
1085             event.consume();
1086             tabPane.getTabs().remove(t1);
1087         });
1088 
1089         root.getChildren().add(tabPane);
1090         show();
1091 
1092         root.applyCss();
1093         root.resize(300, 300);
1094         root.layout();
1095 
1096         tk.firePulse();
1097         assertTrue(tabPane.isFocused());
1098 
1099         tabPane.getSelectionModel().select(t1);
1100 
1101         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
1102         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
1103 
1104         SceneHelper.processMouseEvent(scene,
1105             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval + 19, yval + 17));
1106         tk.firePulse();
1107         SceneHelper.processMouseEvent(scene,
1108             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_RELEASED, xval + 19, yval + 17));
1109         tk.firePulse();
1110 
1111         assertEquals(1, tabPane.getTabs().size());
1112         assertEquals(t2, tabPane.getSelectionModel().getSelectedItem());
1113         assertEquals(1, selectionChangeCount);
1114 
1115         tabPane.getTabs().remove(t2);
1116     }
1117 
1118     // Test for JDK-8193495
1119     @Test public void testQuickRemoveAddTab() {
1120         int tabHeaderMinWidth = 200;
1121         int tabHeaderMinHeight = 50;
1122         tabPane.setMaxSize(400, 200);
1123         tabPane.setTabMinWidth(tabHeaderMinWidth);
1124         tabPane.setTabMinHeight(tabHeaderMinHeight);
1125         tabPane.getTabs().addAll(tab1, tab2, tab3);
1126         tabPane.setTabClosingPolicy(TabPane.TabClosingPolicy.UNAVAILABLE);
1127 
1128         root.getChildren().add(tabPane);
1129         show();
1130         tabPane.requestFocus();
1131         tk.firePulse();
1132         assertTrue(tabPane.isFocused());
1133 
1134         tabPane.getTabs().add(1, tabPane.getTabs().remove(0));
1135         tk.firePulse();
1136         tabPane.getSelectionModel().select(tab1);
1137         tk.firePulse();
1138 
1139         double xval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinX();
1140         double yval = (tabPane.localToScene(tabPane.getLayoutBounds())).getMinY();
1141 
1142         SceneHelper.processMouseEvent(scene,
1143             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval + 19, yval + 17));
1144         tk.firePulse();
1145         SceneHelper.processMouseEvent(scene,
1146             MouseEventGenerator.generateMouseEvent(MouseEvent.MOUSE_PRESSED, xval + 19, yval + 17));
1147         tk.firePulse();
1148 
1149         assertEquals(&quot;Tabpane should have 3 tabs.&quot;, 3, tabPane.getTabs().size());
1150         assertEquals(&quot;tab2 should be at index 0.&quot;, tab2, tabPane.getSelectionModel().getSelectedItem());
1151     }
1152 
1153     // Test for JDK-8154039
1154     WeakReference&lt;Tab&gt; weakTab;
1155     @Test public void testSelectNonChildTab() {
1156         tabPane.getTabs().addAll(tab1);
1157         root.getChildren().add(tabPane);
1158         show();
1159         tk.firePulse();
1160         weakTab = new WeakReference&lt;&gt;(new Tab(&quot;NonChildTab&quot;));
1161         tabPane.getSelectionModel().select(weakTab.get());
1162         tk.firePulse();
1163         attemptGC(10);
1164         tk.firePulse();
1165         assertNull(weakTab.get());
1166     }
1167 
1168     private void attemptGC(int n) {
1169         // Attempt gc n times
1170         for (int i = 0; i &lt; n; i++) {
1171             System.gc();
1172             System.runFinalization();
1173 
1174             if (weakTab.get() == null) {
1175                 break;
1176             }
1177             try {
1178                 Thread.sleep(500);
1179             } catch (InterruptedException e) {
1180                 fail(&quot;InterruptedException occurred during Thread.sleep()&quot;);
1181             }
1182         }
1183     }
1184 
1185     // Test for JDK-8157690
1186     @Test public void testPopupItemsOnSortingTabs() {
1187         tabPane.setMaxSize(20, 20);
1188         root.getChildren().add(tabPane);
1189         tabPane.getTabs().addAll(tab1, tab2, tab3);
1190         show();
1191         tk.firePulse();
1192         TabPaneSkin tbSkin = (TabPaneSkin) tabPane.getSkin();
1193         assertNotNull(tbSkin);
1194         ContextMenu tabsMenu = TabPaneSkinShim.getTabsMenu(tbSkin);
1195         assertNotNull(tabsMenu);
1196         assertEquals(&quot;ContextMenu should contain 3 items.&quot;, 3, tabsMenu.getItems().size());
1197 
1198         tabPane.getTabs().sort((o1, o2) -&gt; sortCompare(o1, o2));
1199         tk.firePulse();
1200         assertEquals(&quot;ContextMenu should contain 3 items.&quot;, 3, tabsMenu.getItems().size());
1201     }
1202 
1203     private int sortCompare(Tab t1, Tab t2) {
1204         return t2.getText().compareTo(t1.getText());
1205     }
1206 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>