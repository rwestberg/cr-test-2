<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/WHLSLLexer.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
   1 /*
   2  * Copyright (C) 2018 Apple Inc. All rights reserved.
   3  *
   4  * Redistribution and use in source and binary forms, with or without
   5  * modification, are permitted provided that the following conditions
   6  * are met:
   7  * 1. Redistributions of source code must retain the above copyright
   8  *    notice, this list of conditions and the following disclaimer.
   9  * 2. Redistributions in binary form must reproduce the above copyright
  10  *    notice, this list of conditions and the following disclaimer in the
  11  *    documentation and/or other materials provided with the distribution.
  12  *
  13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
  14  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
  15  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
  16  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
  17  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  18  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  19  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  20  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  21  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  22  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
  23  * THE POSSIBILITY OF SUCH DAMAGE.
  24  */
  25 
  26 #include &quot;config.h&quot;
  27 #include &quot;WHLSLLexer.h&quot;
  28 
  29 #if ENABLE(WEBGPU)
  30 
  31 namespace WebCore {
  32 
  33 namespace WHLSL {
  34 
  35 const char* Token::typeName(Type type)
  36 {
  37     switch (type) {
  38     case Type::IntLiteral:
  39         return &quot;int literal&quot;;
  40     case Type::UintLiteral:
  41         return &quot;uint literal&quot;;
  42     case Type::FloatLiteral:
  43         return &quot;float literal&quot;;
  44     case Type::Struct:
  45         return &quot;struct&quot;;
  46     case Type::Typedef:
  47         return &quot;typedef&quot;;
  48     case Type::Enum:
  49         return &quot;enum&quot;;
  50     case Type::Operator:
  51         return &quot;operator&quot;;
  52     case Type::If:
  53         return &quot;if&quot;;
  54     case Type::Else:
  55         return &quot;else&quot;;
  56     case Type::Continue:
  57         return &quot;continue&quot;;
  58     case Type::Break:
  59         return &quot;break&quot;;
  60     case Type::Switch:
  61         return &quot;switch&quot;;
  62     case Type::Case:
  63         return &quot;case&quot;;
  64     case Type::Default:
  65         return &quot;default&quot;;
  66     case Type::Fallthrough:
  67         return &quot;fallthrough&quot;;
  68     case Type::For:
  69         return &quot;for&quot;;
  70     case Type::While:
  71         return &quot;while&quot;;
  72     case Type::Do:
  73         return &quot;do&quot;;
  74     case Type::Return:
  75         return &quot;return&quot;;
  76     case Type::Null:
  77         return &quot;null&quot;;
  78     case Type::True:
  79         return &quot;true&quot;;
  80     case Type::False:
  81         return &quot;false&quot;;
  82     case Type::Constant:
  83         return &quot;constant&quot;;
  84     case Type::Device:
  85         return &quot;device&quot;;
  86     case Type::Threadgroup:
  87         return &quot;threadgroup&quot;;
  88     case Type::Thread:
  89         return &quot;thread&quot;;
  90     case Type::Space:
  91         return &quot;space&quot;;
  92     case Type::Vertex:
  93         return &quot;vertex&quot;;
  94     case Type::Fragment:
  95         return &quot;fragment&quot;;
  96     case Type::Compute:
  97         return &quot;compute&quot;;
  98     case Type::NumThreads:
  99         return &quot;numthreads&quot;;
 100     case Type::SVInstanceID:
 101         return &quot;SV_InstanceID&quot;;
 102     case Type::SVVertexID:
 103         return &quot;SV_VertexID&quot;;
 104     case Type::PSize:
 105         return &quot;PSIZE&quot;;
 106     case Type::SVPosition:
 107         return &quot;SV_Position&quot;;
 108     case Type::SVIsFrontFace:
 109         return &quot;SV_IsFrontFace&quot;;
 110     case Type::SVSampleIndex:
 111         return &quot;SV_SampleIndex&quot;;
 112     case Type::SVInnerCoverage:
 113         return &quot;SV_InnerCoverage&quot;;
 114     case Type::SVTarget:
 115         return &quot;SV_Target&quot;;
 116     case Type::SVDepth:
 117         return &quot;SV_Depth&quot;;
 118     case Type::SVCoverage:
 119         return &quot;SV_Coverage&quot;;
 120     case Type::SVDispatchThreadID:
 121         return &quot;SV_DispatchThreadID&quot;;
 122     case Type::SVGroupID:
 123         return &quot;SV_GroupID&quot;;
 124     case Type::SVGroupIndex:
 125         return &quot;SV_GroupIndex&quot;;
 126     case Type::SVGroupThreadID:
 127         return &quot;SV_GroupThreadID&quot;;
 128     case Type::Attribute:
 129         return &quot;SV_Attribute&quot;;
 130     case Type::Register:
 131         return &quot;register&quot;;
 132     case Type::Specialized:
 133         return &quot;specialized&quot;;
 134     case Type::Native:
 135         return &quot;native&quot;;
 136     case Type::Restricted:
 137         return &quot;restricted&quot;;
 138     case Type::Underscore:
 139         return &quot;_&quot;;
 140     case Type::Auto:
 141         return &quot;auto&quot;;
 142     case Type::Protocol:
 143         return &quot;protocol&quot;;
 144     case Type::Const:
 145         return &quot;const&quot;;
 146     case Type::Static:
 147         return &quot;static&quot;;
 148     case Type::Qualifier:
 149         return &quot;qualifier&quot;;
 150     case Type::Identifier:
 151         return &quot;identifier&quot;;
 152     case Type::OperatorName:
 153         return &quot;operator name&quot;;
 154     case Type::EqualsSign:
 155         return &quot;=&quot;;
 156     case Type::Semicolon:
 157         return &quot;;&quot;;
 158     case Type::LeftCurlyBracket:
 159         return &quot;{&quot;;
 160     case Type::RightCurlyBracket:
 161         return &quot;}&quot;;
 162     case Type::Colon:
 163         return &quot;:&quot;;
 164     case Type::Comma:
 165         return &quot;,&quot;;
 166     case Type::LeftParenthesis:
 167         return &quot;(&quot;;
 168     case Type::RightParenthesis:
 169         return &quot;)&quot;;
 170     case Type::SquareBracketPair:
 171         return &quot;[]&quot;;
 172     case Type::LeftSquareBracket:
 173         return &quot;[&quot;;
 174     case Type::RightSquareBracket:
 175         return &quot;]&quot;;
 176     case Type::Star:
 177         return &quot;*&quot;;
 178     case Type::LessThanSign:
 179         return &quot;&lt;&quot;;
 180     case Type::GreaterThanSign:
 181         return &quot;&gt;&quot;;
 182     case Type::FullStop:
 183         return &quot;.&quot;;
 184     case Type::PlusEquals:
 185         return &quot;+=&quot;;
 186     case Type::MinusEquals:
 187         return &quot;-=&quot;;
 188     case Type::TimesEquals:
 189         return &quot;*=&quot;;
 190     case Type::DivideEquals:
 191         return &quot;/=&quot;;
 192     case Type::ModEquals:
 193         return &quot;%=&quot;;
 194     case Type::XorEquals:
 195         return &quot;^=&quot;;
 196     case Type::AndEquals:
 197         return &quot;&amp;=&quot;;
 198     case Type::OrEquals:
 199         return &quot;|=&quot;;
 200     case Type::RightShiftEquals:
 201         return &quot;&gt;&gt;=&quot;;
 202     case Type::LeftShiftEquals:
 203         return &quot;&lt;&lt;=&quot;;
 204     case Type::PlusPlus:
 205         return &quot;++&quot;;
 206     case Type::MinusMinus:
 207         return &quot;--&quot;;
 208     case Type::Arrow:
 209         return &quot;-&gt;&quot;;
 210     case Type::QuestionMark:
 211         return &quot;?&quot;;
 212     case Type::OrOr:
 213         return &quot;||&quot;;
 214     case Type::AndAnd:
 215         return &quot;&amp;&amp;&quot;;
 216     case Type::Or:
 217         return &quot;|&quot;;
 218     case Type::Xor:
 219         return &quot;^&quot;;
 220     case Type::And:
 221         return &quot;&amp;&quot;;
 222     case Type::LessThanOrEqualTo:
 223         return &quot;&lt;=&quot;;
 224     case Type::GreaterThanOrEqualTo:
 225         return &quot;&gt;=&quot;;
 226     case Type::EqualComparison:
 227         return &quot;==&quot;;
 228     case Type::NotEqual:
 229         return &quot;!=&quot;;
 230     case Type::RightShift:
 231         return &quot;&gt;&gt;&quot;;
 232     case Type::LeftShift:
 233         return &quot;&lt;&lt;&quot;;
 234     case Type::Plus:
 235         return &quot;+&quot;;
 236     case Type::Minus:
 237         return &quot;-&quot;;
 238     case Type::Divide:
 239         return &quot;/&quot;;
 240     case Type::Mod:
 241         return &quot;%&quot;;
 242     case Type::Tilde:
 243         return &quot;~&quot;;
 244     case Type::ExclamationPoint:
 245         return &quot;!&quot;;
 246     case Type::At:
 247         return &quot;@&quot;;
 248     case Type::EndOfFile:
 249         return &quot;EOF&quot;;
 250     case Type::Invalid:
 251         return &quot;LEXING_ERROR&quot;;
 252     }
 253 }
 254 
 255 static ALWAYS_INLINE bool isValidIdentifierStart(UChar theChar)
 256 {
 257     return (theChar &gt;= &#39;a&#39; &amp;&amp; theChar &lt;= &#39;z&#39;)
 258         || (theChar &gt;= &#39;A&#39; &amp;&amp; theChar &lt;= &#39;Z&#39;)
 259         || (theChar == &#39;_&#39;);
 260 }
 261 
 262 static ALWAYS_INLINE bool isValidNonStartingIdentifierChar(UChar theChar)
 263 {
 264     return (theChar &gt;= &#39;a&#39; &amp;&amp; theChar &lt;= &#39;z&#39;)
 265         || (theChar &gt;= &#39;A&#39; &amp;&amp; theChar &lt;= &#39;Z&#39;)
 266         || (theChar &gt;= &#39;0&#39; &amp;&amp; theChar &lt;= &#39;9&#39;)
 267         || (theChar == &#39;_&#39;);
 268 }
 269 
 270 static ALWAYS_INLINE bool isHexadecimalCharacter(UChar character)
 271 {
 272     return (character &gt;= &#39;0&#39; &amp;&amp; character &lt;= &#39;9&#39;)
 273         || (character &gt;= &#39;a&#39; &amp;&amp; character &lt;= &#39;f&#39;)
 274         || (character &gt;= &#39;A&#39; &amp;&amp; character &lt;= &#39;F&#39;);
 275 }
 276 
 277 static ALWAYS_INLINE bool isDigit(UChar theChar)
 278 {
 279     return theChar &gt;= &#39;0&#39; &amp;&amp; theChar &lt;= &#39;9&#39;;
 280 }
 281 
 282 auto Lexer::consumeTokenFromStream() -&gt; Token
 283 {
 284     UChar current = 0;
 285     unsigned offset = m_offset;
 286 
 287     auto peek = [&amp;] () -&gt; UChar {
 288         if (offset &lt; m_stringView.length())
 289             return m_stringView[offset];
 290         return 0;
 291     };
 292 
 293     auto shift = [&amp;] {
 294         if (offset &lt; m_stringView.length()) {
 295             current = m_stringView[offset];
 296             ++offset;
 297             return current;
 298         }
 299         current = 0;
 300         return current;
 301     };
 302 
 303     auto consume = [&amp;] (UChar theChar) {
 304         if (peek() == theChar) {
 305             shift();
 306             return true;
 307         }
 308         return false;
 309     };
 310 
 311     auto nextIsIdentifier = [&amp;] {
 312         return isValidNonStartingIdentifierChar(peek());
 313     };
 314 
 315     auto token = [&amp;] (Token::Type type) -&gt; Token {
 316         auto oldOffset = m_offset;
 317         m_offset = offset;
 318         skipWhitespaceAndComments();
 319         return { { oldOffset, offset, m_nameSpace }, type };
 320     };
 321 
 322     switch (shift()) {
 323     case &#39;A&#39;:
 324     case &#39;B&#39;:
 325     case &#39;C&#39;:
 326     case &#39;D&#39;:
 327     case &#39;E&#39;:
 328     case &#39;F&#39;:
 329     case &#39;G&#39;:
 330     case &#39;H&#39;:
 331     case &#39;I&#39;:
 332     case &#39;J&#39;:
 333     case &#39;K&#39;:
 334     case &#39;L&#39;:
 335     case &#39;M&#39;:
 336     case &#39;N&#39;:
 337     case &#39;O&#39;:
 338     case &#39;Q&#39;:
 339     case &#39;R&#39;:
 340     case &#39;T&#39;:
 341     case &#39;U&#39;:
 342     case &#39;V&#39;:
 343     case &#39;W&#39;:
 344     case &#39;X&#39;:
 345     case &#39;Y&#39;:
 346     case &#39;Z&#39;:
 347     case &#39;g&#39;:
 348     case &#39;h&#39;:
 349     case &#39;j&#39;:
 350     case &#39;k&#39;:
 351     case &#39;l&#39;:
 352     case &#39;m&#39;:
 353     case &#39;q&#39;:
 354     case &#39;x&#39;:
 355     case &#39;y&#39;:
 356     case &#39;z&#39;:
 357 parseIdentifier:
 358         while (isValidNonStartingIdentifierChar(peek()))
 359             shift();
 360         return token(Token::Type::Identifier);
 361 
 362     case &#39;s&#39;:
 363         switch (peek()) {
 364         case &#39;a&#39;:
 365             shift();
 366             if (!consume(&#39;m&#39;))
 367                 goto parseIdentifier;
 368             if (!consume(&#39;p&#39;))
 369                 goto parseIdentifier;
 370             if (!consume(&#39;l&#39;))
 371                 goto parseIdentifier;
 372             if (!consume(&#39;e&#39;))
 373                 goto parseIdentifier;
 374             if (nextIsIdentifier())
 375                 goto parseIdentifier;
 376             return token(Token::Type::Qualifier);
 377 
 378         case &#39;w&#39;:
 379             shift();
 380             if (!consume(&#39;i&#39;))
 381                 goto parseIdentifier;
 382             if (!consume(&#39;t&#39;))
 383                 goto parseIdentifier;
 384             if (!consume(&#39;c&#39;))
 385                 goto parseIdentifier;
 386             if (!consume(&#39;h&#39;))
 387                 goto parseIdentifier;
 388             if (nextIsIdentifier())
 389                 goto parseIdentifier;
 390             return token(Token::Type::Switch);
 391 
 392         case &#39;t&#39;:
 393             shift();
 394             switch (peek()) {
 395             case &#39;r&#39;:
 396                 shift();
 397                 if (!consume(&#39;u&#39;))
 398                     goto parseIdentifier;
 399                 if (!consume(&#39;c&#39;))
 400                     goto parseIdentifier;
 401                 if (!consume(&#39;t&#39;))
 402                     goto parseIdentifier;
 403                 if (nextIsIdentifier())
 404                     goto parseIdentifier;
 405                 return token(Token::Type::Struct);
 406             case &#39;a&#39;:
 407                 shift();
 408                 if (!consume(&#39;t&#39;))
 409                     goto parseIdentifier;
 410                 if (!consume(&#39;i&#39;))
 411                     goto parseIdentifier;
 412                 if (!consume(&#39;c&#39;))
 413                     goto parseIdentifier;
 414                 if (nextIsIdentifier())
 415                     goto parseIdentifier;
 416                 return token(Token::Type::Static);
 417             default:
 418                 goto parseIdentifier;
 419             }
 420             break;
 421 
 422         case &#39;p&#39;:
 423             shift();
 424             switch (peek()) {
 425             case &#39;a&#39;:
 426                 shift();
 427                 if (!consume(&#39;c&#39;))
 428                     goto parseIdentifier;
 429                 if (!consume(&#39;e&#39;))
 430                     goto parseIdentifier;
 431                 if (nextIsIdentifier())
 432                     goto parseIdentifier;
 433                 return token(Token::Type::Space);
 434             case &#39;e&#39;:
 435                 shift();
 436                 if (!consume(&#39;c&#39;))
 437                     goto parseIdentifier;
 438                 if (!consume(&#39;i&#39;))
 439                     goto parseIdentifier;
 440                 if (!consume(&#39;a&#39;))
 441                     goto parseIdentifier;
 442                 if (!consume(&#39;l&#39;))
 443                     goto parseIdentifier;
 444                 if (!consume(&#39;i&#39;))
 445                     goto parseIdentifier;
 446                 if (!consume(&#39;z&#39;))
 447                     goto parseIdentifier;
 448                 if (!consume(&#39;e&#39;))
 449                     goto parseIdentifier;
 450                 if (!consume(&#39;d&#39;))
 451                     goto parseIdentifier;
 452                 if (nextIsIdentifier())
 453                     goto parseIdentifier;
 454                 return token(Token::Type::Specialized);
 455             default:
 456                 goto parseIdentifier;
 457             }
 458         default:
 459             goto parseIdentifier;
 460         }
 461 
 462     case &#39;S&#39;:
 463         if (!consume(&#39;V&#39;))
 464             goto parseIdentifier;
 465         if (!consume(&#39;_&#39;))
 466             goto parseIdentifier;
 467 
 468         switch (peek()) {
 469         case &#39;G&#39;:
 470             shift();
 471             if (!consume(&#39;r&#39;))
 472                 goto parseIdentifier;
 473             if (!consume(&#39;o&#39;))
 474                 goto parseIdentifier;
 475             if (!consume(&#39;u&#39;))
 476                 goto parseIdentifier;
 477             if (!consume(&#39;p&#39;))
 478                 goto parseIdentifier;
 479 
 480             switch (peek()) {
 481             case &#39;I&#39;:
 482                 shift();
 483                 switch (peek()) {
 484                 case &#39;D&#39;:
 485                     shift();
 486                     if (nextIsIdentifier())
 487                         goto parseIdentifier;
 488                     return token(Token::Type::SVGroupID);
 489                 case &#39;n&#39;:
 490                     shift();
 491                     if (!consume(&#39;d&#39;))
 492                         goto parseIdentifier;
 493                     if (!consume(&#39;e&#39;))
 494                         goto parseIdentifier;
 495                     if (!consume(&#39;x&#39;))
 496                         goto parseIdentifier;
 497                     if (nextIsIdentifier())
 498                         goto parseIdentifier;
 499                     return token(Token::Type::SVGroupIndex);
 500 
 501                 default:
 502                     goto parseIdentifier;
 503                 }
 504 
 505             case &#39;T&#39;:
 506                 shift();
 507                 if (!consume(&#39;h&#39;))
 508                     goto parseIdentifier;
 509                 if (!consume(&#39;r&#39;))
 510                     goto parseIdentifier;
 511                 if (!consume(&#39;e&#39;))
 512                     goto parseIdentifier;
 513                 if (!consume(&#39;a&#39;))
 514                     goto parseIdentifier;
 515                 if (!consume(&#39;d&#39;))
 516                     goto parseIdentifier;
 517                 if (!consume(&#39;I&#39;))
 518                     goto parseIdentifier;
 519                 if (!consume(&#39;D&#39;))
 520                     goto parseIdentifier;
 521                 if (nextIsIdentifier())
 522                     goto parseIdentifier;
 523                 return token(Token::Type::SVGroupThreadID);
 524 
 525             default:
 526                 goto parseIdentifier;
 527             }
 528         case &#39;D&#39;:
 529             shift();
 530             switch (peek()) {
 531             case &#39;e&#39;:
 532                 shift();
 533                 if (!consume(&#39;p&#39;))
 534                     goto parseIdentifier;
 535                 if (!consume(&#39;t&#39;))
 536                     goto parseIdentifier;
 537                 if (!consume(&#39;h&#39;))
 538                     goto parseIdentifier;
 539                 if (nextIsIdentifier())
 540                     goto parseIdentifier;
 541                 return token(Token::Type::SVDepth);
 542             case &#39;i&#39;:
 543                 shift();
 544                 if (!consume(&#39;s&#39;))
 545                     goto parseIdentifier;
 546                 if (!consume(&#39;p&#39;))
 547                     goto parseIdentifier;
 548                 if (!consume(&#39;a&#39;))
 549                     goto parseIdentifier;
 550                 if (!consume(&#39;t&#39;))
 551                     goto parseIdentifier;
 552                 if (!consume(&#39;c&#39;))
 553                     goto parseIdentifier;
 554                 if (!consume(&#39;h&#39;))
 555                     goto parseIdentifier;
 556                 if (!consume(&#39;T&#39;))
 557                     goto parseIdentifier;
 558                 if (!consume(&#39;h&#39;))
 559                     goto parseIdentifier;
 560                 if (!consume(&#39;r&#39;))
 561                     goto parseIdentifier;
 562                 if (!consume(&#39;e&#39;))
 563                     goto parseIdentifier;
 564                 if (!consume(&#39;a&#39;))
 565                     goto parseIdentifier;
 566                 if (!consume(&#39;d&#39;))
 567                     goto parseIdentifier;
 568                 if (!consume(&#39;I&#39;))
 569                     goto parseIdentifier;
 570                 if (!consume(&#39;D&#39;))
 571                     goto parseIdentifier;
 572                 if (nextIsIdentifier())
 573                     goto parseIdentifier;
 574                 return token(Token::Type::SVDispatchThreadID);
 575             default:
 576                 goto parseIdentifier;
 577             }
 578         case &#39;C&#39;:
 579             shift();
 580             if (!consume(&#39;o&#39;))
 581                 goto parseIdentifier;
 582             if (!consume(&#39;v&#39;))
 583                 goto parseIdentifier;
 584             if (!consume(&#39;e&#39;))
 585                 goto parseIdentifier;
 586             if (!consume(&#39;r&#39;))
 587                 goto parseIdentifier;
 588             if (!consume(&#39;a&#39;))
 589                 goto parseIdentifier;
 590             if (!consume(&#39;g&#39;))
 591                 goto parseIdentifier;
 592             if (!consume(&#39;e&#39;))
 593                 goto parseIdentifier;
 594             if (nextIsIdentifier())
 595                 goto parseIdentifier;
 596             return token(Token::Type::SVCoverage);
 597         case &#39;T&#39;:
 598             shift();
 599             if (!consume(&#39;a&#39;))
 600                 goto parseIdentifier;
 601             if (!consume(&#39;r&#39;))
 602                 goto parseIdentifier;
 603             if (!consume(&#39;g&#39;))
 604                 goto parseIdentifier;
 605             if (!consume(&#39;e&#39;))
 606                 goto parseIdentifier;
 607             if (!consume(&#39;t&#39;))
 608                 goto parseIdentifier;
 609             if (nextIsIdentifier())
 610                 goto parseIdentifier;
 611             return token(Token::Type::SVTarget);
 612         case &#39;S&#39;:
 613             shift();
 614             if (!consume(&#39;a&#39;))
 615                 goto parseIdentifier;
 616             if (!consume(&#39;m&#39;))
 617                 goto parseIdentifier;
 618             if (!consume(&#39;p&#39;))
 619                 goto parseIdentifier;
 620             if (!consume(&#39;l&#39;))
 621                 goto parseIdentifier;
 622             if (!consume(&#39;e&#39;))
 623                 goto parseIdentifier;
 624             if (!consume(&#39;I&#39;))
 625                 goto parseIdentifier;
 626             if (!consume(&#39;n&#39;))
 627                 goto parseIdentifier;
 628             if (!consume(&#39;d&#39;))
 629                 goto parseIdentifier;
 630             if (!consume(&#39;e&#39;))
 631                 goto parseIdentifier;
 632             if (!consume(&#39;x&#39;))
 633                 goto parseIdentifier;
 634             if (nextIsIdentifier())
 635                 goto parseIdentifier;
 636             return token(Token::Type::SVSampleIndex);
 637         case &#39;P&#39;:
 638             shift();
 639             if (!consume(&#39;o&#39;))
 640                 goto parseIdentifier;
 641             if (!consume(&#39;s&#39;))
 642                 goto parseIdentifier;
 643             if (!consume(&#39;i&#39;))
 644                 goto parseIdentifier;
 645             if (!consume(&#39;t&#39;))
 646                 goto parseIdentifier;
 647             if (!consume(&#39;i&#39;))
 648                 goto parseIdentifier;
 649             if (!consume(&#39;o&#39;))
 650                 goto parseIdentifier;
 651             if (!consume(&#39;n&#39;))
 652                 goto parseIdentifier;
 653             if (nextIsIdentifier())
 654                 goto parseIdentifier;
 655             return token(Token::Type::SVPosition);
 656         case &#39;V&#39;:
 657             shift();
 658             if (!consume(&#39;e&#39;))
 659                 goto parseIdentifier;
 660             if (!consume(&#39;r&#39;))
 661                 goto parseIdentifier;
 662             if (!consume(&#39;t&#39;))
 663                 goto parseIdentifier;
 664             if (!consume(&#39;e&#39;))
 665                 goto parseIdentifier;
 666             if (!consume(&#39;x&#39;))
 667                 goto parseIdentifier;
 668             if (!consume(&#39;I&#39;))
 669                 goto parseIdentifier;
 670             if (!consume(&#39;D&#39;))
 671                 goto parseIdentifier;
 672             if (nextIsIdentifier())
 673                 goto parseIdentifier;
 674             return token(Token::Type::SVVertexID);
 675         case &#39;I&#39;:
 676             shift();
 677             switch (peek()) {
 678             case &#39;s&#39;:
 679                 shift();
 680                 if (!consume(&#39;F&#39;))
 681                     goto parseIdentifier;
 682                 if (!consume(&#39;r&#39;))
 683                     goto parseIdentifier;
 684                 if (!consume(&#39;o&#39;))
 685                     goto parseIdentifier;
 686                 if (!consume(&#39;n&#39;))
 687                     goto parseIdentifier;
 688                 if (!consume(&#39;t&#39;))
 689                     goto parseIdentifier;
 690                 if (!consume(&#39;F&#39;))
 691                     goto parseIdentifier;
 692                 if (!consume(&#39;a&#39;))
 693                     goto parseIdentifier;
 694                 if (!consume(&#39;c&#39;))
 695                     goto parseIdentifier;
 696                 if (!consume(&#39;e&#39;))
 697                     goto parseIdentifier;
 698                 if (nextIsIdentifier())
 699                     goto parseIdentifier;
 700                 return token(Token::Type::SVIsFrontFace);
 701             case &#39;n&#39;:
 702                 shift();
 703                 switch (peek()) {
 704                 case &#39;n&#39;:
 705                     shift();
 706                     if (!consume(&#39;e&#39;))
 707                         goto parseIdentifier;
 708                     if (!consume(&#39;r&#39;))
 709                         goto parseIdentifier;
 710                     if (!consume(&#39;C&#39;))
 711                         goto parseIdentifier;
 712                     if (!consume(&#39;o&#39;))
 713                         goto parseIdentifier;
 714                     if (!consume(&#39;v&#39;))
 715                         goto parseIdentifier;
 716                     if (!consume(&#39;e&#39;))
 717                         goto parseIdentifier;
 718                     if (!consume(&#39;r&#39;))
 719                         goto parseIdentifier;
 720                     if (!consume(&#39;a&#39;))
 721                         goto parseIdentifier;
 722                     if (!consume(&#39;g&#39;))
 723                         goto parseIdentifier;
 724                     if (!consume(&#39;e&#39;))
 725                         goto parseIdentifier;
 726                     if (nextIsIdentifier())
 727                         goto parseIdentifier;
 728                     return token(Token::Type::SVInnerCoverage);
 729                 case &#39;s&#39;:
 730                     shift();
 731                     if (!consume(&#39;t&#39;))
 732                         goto parseIdentifier;
 733                     if (!consume(&#39;a&#39;))
 734                         goto parseIdentifier;
 735                     if (!consume(&#39;n&#39;))
 736                         goto parseIdentifier;
 737                     if (!consume(&#39;c&#39;))
 738                         goto parseIdentifier;
 739                     if (!consume(&#39;e&#39;))
 740                         goto parseIdentifier;
 741                     if (!consume(&#39;I&#39;))
 742                         goto parseIdentifier;
 743                     if (!consume(&#39;D&#39;))
 744                         goto parseIdentifier;
 745                     if (nextIsIdentifier())
 746                         goto parseIdentifier;
 747                     return token(Token::Type::SVInstanceID);
 748                 default:
 749                     goto parseIdentifier;
 750                 }
 751 
 752             default:
 753                 goto parseIdentifier;
 754             }
 755         default:
 756             goto parseIdentifier;
 757         }
 758 
 759     case &#39;t&#39;:
 760         switch (peek()) {
 761         case &#39;r&#39;:
 762             shift();
 763             if (!consume(&#39;u&#39;))
 764                 goto parseIdentifier;
 765             if (!consume(&#39;e&#39;))
 766                 goto parseIdentifier;
 767             if (nextIsIdentifier())
 768                 goto parseIdentifier;
 769             return token(Token::Type::True);
 770         case &#39;y&#39;:
 771             shift();
 772             if (!consume(&#39;p&#39;))
 773                 goto parseIdentifier;
 774             if (!consume(&#39;e&#39;))
 775                 goto parseIdentifier;
 776             if (!consume(&#39;d&#39;))
 777                 goto parseIdentifier;
 778             if (!consume(&#39;e&#39;))
 779                 goto parseIdentifier;
 780             if (!consume(&#39;f&#39;))
 781                 goto parseIdentifier;
 782             if (nextIsIdentifier())
 783                 goto parseIdentifier;
 784             return token(Token::Type::Typedef);
 785         case &#39;h&#39;:
 786             shift();
 787             if (!consume(&#39;r&#39;))
 788                 goto parseIdentifier;
 789             if (!consume(&#39;e&#39;))
 790                 goto parseIdentifier;
 791             if (!consume(&#39;a&#39;))
 792                 goto parseIdentifier;
 793             if (!consume(&#39;d&#39;))
 794                 goto parseIdentifier;
 795 
 796             if (!nextIsIdentifier())
 797                 return token(Token::Type::Thread);
 798 
 799             if (peek() != &#39;g&#39;)
 800                 goto parseIdentifier;
 801 
 802             shift();
 803             RELEASE_ASSERT(current == &#39;g&#39;);
 804             if (!consume(&#39;r&#39;))
 805                 goto parseIdentifier;
 806             if (!consume(&#39;o&#39;))
 807                 goto parseIdentifier;
 808             if (!consume(&#39;u&#39;))
 809                 goto parseIdentifier;
 810             if (!consume(&#39;p&#39;))
 811                 goto parseIdentifier;
 812             if (nextIsIdentifier())
 813                 goto parseIdentifier;
 814             return token(Token::Type::Threadgroup);
 815 
 816         default:
 817             goto parseIdentifier;
 818         }
 819 
 820     case &#39;e&#39;:
 821         switch (peek()) {
 822         case &#39;n&#39;:
 823             shift();
 824             if (!consume(&#39;u&#39;))
 825                 goto parseIdentifier;
 826             if (!consume(&#39;m&#39;))
 827                 goto parseIdentifier;
 828             if (nextIsIdentifier())
 829                 goto parseIdentifier;
 830             return token(Token::Type::Enum);
 831         case &#39;l&#39;:
 832             shift();
 833             if (!consume(&#39;s&#39;))
 834                 goto parseIdentifier;
 835             if (!consume(&#39;e&#39;))
 836                 goto parseIdentifier;
 837             if (nextIsIdentifier())
 838                 goto parseIdentifier;
 839             return token(Token::Type::Else);
 840         default:
 841             goto parseIdentifier;
 842         }
 843 
 844     case &#39;o&#39;:
 845         if (!consume(&#39;p&#39;))
 846             goto parseIdentifier;
 847         if (!consume(&#39;e&#39;))
 848             goto parseIdentifier;
 849         if (!consume(&#39;r&#39;))
 850             goto parseIdentifier;
 851         if (!consume(&#39;a&#39;))
 852             goto parseIdentifier;
 853         if (!consume(&#39;t&#39;))
 854             goto parseIdentifier;
 855         if (!consume(&#39;o&#39;))
 856             goto parseIdentifier;
 857         if (!consume(&#39;r&#39;))
 858             goto parseIdentifier;
 859         if (nextIsIdentifier())
 860             goto parseIdentifier;
 861 
 862         switch (peek()) {
 863         case &#39;&amp;&#39;:
 864             shift();
 865             switch (peek()) {
 866             case &#39;[&#39;:
 867                 shift();
 868                 if (consume(&#39;]&#39;))
 869                     return token(Token::Type::OperatorName);
 870                 return token(Token::Type::Invalid);
 871             case &#39;.&#39;:
 872                 shift();
 873                 if (!isValidIdentifierStart(peek()))
 874                     return token(Token::Type::Invalid);
 875                 shift();
 876                 while (isValidNonStartingIdentifierChar(peek()))
 877                     shift();
 878                 return token(Token::Type::OperatorName);
 879             default:
 880                 return token(Token::Type::OperatorName);
 881             }
 882 
 883         case &#39;[&#39;:
 884             shift();
 885             if (!consume(&#39;]&#39;))
 886                 return token(Token::Type::Invalid);
 887             consume(&#39;=&#39;);
 888             return token(Token::Type::OperatorName);
 889 
 890         case &#39;&gt;&#39;:
 891             shift();
 892             if (consume(&#39;&gt;&#39;))
 893                 return token(Token::Type::OperatorName);
 894             if (consume(&#39;=&#39;))
 895                 return token(Token::Type::OperatorName);
 896             return token(Token::Type::OperatorName);
 897 
 898         case &#39;&lt;&#39;:
 899             shift();
 900             if (consume(&#39;&lt;&#39;))
 901                 return token(Token::Type::OperatorName);
 902             if (consume(&#39;=&#39;))
 903                 return token(Token::Type::OperatorName);
 904             return token(Token::Type::OperatorName);
 905 
 906         case &#39;+&#39;:
 907             shift();
 908             consume(&#39;+&#39;);
 909             return token(Token::Type::OperatorName);
 910 
 911         case &#39;-&#39;:
 912             shift();
 913             consume(&#39;-&#39;);
 914             return token(Token::Type::OperatorName);
 915 
 916         case &#39;|&#39;:
 917             shift();
 918             return token(Token::Type::OperatorName);
 919 
 920         case &#39;=&#39;:
 921             shift();
 922             if (!consume(&#39;=&#39;))
 923                 return token(Token::Type::Invalid);
 924             return token(Token::Type::OperatorName);
 925 
 926         case &#39;*&#39;:
 927             shift();
 928             return token(Token::Type::OperatorName);
 929 
 930         case &#39;/&#39;:
 931             shift();
 932             return token(Token::Type::OperatorName);
 933 
 934         case &#39;%&#39;:
 935             shift();
 936             return token(Token::Type::OperatorName);
 937 
 938         case &#39;!&#39;:
 939             shift();
 940             return token(Token::Type::OperatorName);
 941 
 942         case &#39;~&#39;:
 943             shift();
 944             return token(Token::Type::OperatorName);
 945 
 946         case &#39;^&#39;:
 947             shift();
 948             return token(Token::Type::OperatorName);
 949 
 950         case &#39;.&#39;:
 951             shift();
 952             if (!isValidIdentifierStart(peek()))
 953                 return token(Token::Type::Invalid);
 954             shift();
 955             while (isValidNonStartingIdentifierChar(peek()))
 956                 shift();
 957             consume(&#39;=&#39;);
 958             return token(Token::Type::OperatorName);
 959         default:
 960             break;
 961         }
 962 
 963         return token(Token::Type::Operator);
 964 
 965     case &#39;i&#39;:
 966         if (!consume(&#39;f&#39;))
 967             goto parseIdentifier;
 968         if (nextIsIdentifier())
 969             goto parseIdentifier;
 970         return token(Token::Type::If);
 971 
 972     case &#39;c&#39;:
 973         switch (peek()) {
 974         case &#39;a&#39;:
 975             shift();
 976             if (!consume(&#39;s&#39;))
 977                 goto parseIdentifier;
 978             if (!consume(&#39;e&#39;))
 979                 goto parseIdentifier;
 980             if (nextIsIdentifier())
 981                 goto parseIdentifier;
 982             return token(Token::Type::Case);
 983 
 984         case &#39;e&#39;:
 985             shift();
 986             if (!consume(&#39;n&#39;))
 987                 goto parseIdentifier;
 988             if (!consume(&#39;t&#39;))
 989                 goto parseIdentifier;
 990             if (!consume(&#39;r&#39;))
 991                 goto parseIdentifier;
 992             if (!consume(&#39;o&#39;))
 993                 goto parseIdentifier;
 994             if (!consume(&#39;i&#39;))
 995                 goto parseIdentifier;
 996             if (!consume(&#39;d&#39;))
 997                 goto parseIdentifier;
 998             if (nextIsIdentifier())
 999                 goto parseIdentifier;
1000             return token(Token::Type::Qualifier);
1001         case &#39;o&#39;:
1002             shift();
1003             switch (peek()) {
1004             case &#39;m&#39;:
1005                 shift();
1006                 if (!consume(&#39;p&#39;))
1007                     goto parseIdentifier;
1008                 if (!consume(&#39;u&#39;))
1009                     goto parseIdentifier;
1010                 if (!consume(&#39;t&#39;))
1011                     goto parseIdentifier;
1012                 if (!consume(&#39;e&#39;))
1013                     goto parseIdentifier;
1014                 if (nextIsIdentifier())
1015                     goto parseIdentifier;
1016                 return token(Token::Type::Compute);
1017             case &#39;n&#39;:
1018                 shift();
1019                 switch (peek()) {
1020                 case &#39;t&#39;:
1021                     shift();
1022                     if (!consume(&#39;i&#39;))
1023                         goto parseIdentifier;
1024                     if (!consume(&#39;n&#39;))
1025                         goto parseIdentifier;
1026                     if (!consume(&#39;u&#39;))
1027                         goto parseIdentifier;
1028                     if (!consume(&#39;e&#39;))
1029                         goto parseIdentifier;
1030                     if (nextIsIdentifier())
1031                         goto parseIdentifier;
1032                     return token(Token::Type::Continue);
1033                 case &#39;s&#39;:
1034                     shift();
1035                     if (!consume(&#39;t&#39;))
1036                         goto parseIdentifier;
1037 
1038                     if (!nextIsIdentifier())
1039                         return token(Token::Type::Const);
1040 
1041                     if (!consume(&#39;a&#39;))
1042                         goto parseIdentifier;
1043                     if (!consume(&#39;n&#39;))
1044                         goto parseIdentifier;
1045                     if (!consume(&#39;t&#39;))
1046                         goto parseIdentifier;
1047                     if (nextIsIdentifier())
1048                         goto parseIdentifier;
1049                     return token(Token::Type::Constant);
1050 
1051                 default:
1052                     goto parseIdentifier;
1053                 }
1054 
1055             default:
1056                 goto parseIdentifier;
1057             }
1058 
1059         default:
1060             goto parseIdentifier;
1061         }
1062 
1063     case &#39;b&#39;:
1064         if (!consume(&#39;r&#39;))
1065             goto parseIdentifier;
1066         if (!consume(&#39;e&#39;))
1067             goto parseIdentifier;
1068         if (!consume(&#39;a&#39;))
1069             goto parseIdentifier;
1070         if (!consume(&#39;k&#39;))
1071             goto parseIdentifier;
1072         if (nextIsIdentifier())
1073             goto parseIdentifier;
1074         return token(Token::Type::Break);
1075 
1076     case &#39;d&#39;:
1077         switch (peek()) {
1078         case &#39;o&#39;:
1079             shift();
1080             if (nextIsIdentifier())
1081                 goto parseIdentifier;
1082             return token(Token::Type::Do);
1083         case &#39;e&#39;:
1084             shift();
1085             switch (peek()) {
1086             case &#39;f&#39;:
1087                 shift();
1088                 if (!consume(&#39;a&#39;))
1089                     goto parseIdentifier;
1090                 if (!consume(&#39;u&#39;))
1091                     goto parseIdentifier;
1092                 if (!consume(&#39;l&#39;))
1093                     goto parseIdentifier;
1094                 if (!consume(&#39;t&#39;))
1095                     goto parseIdentifier;
1096                 if (nextIsIdentifier())
1097                     goto parseIdentifier;
1098                 return token(Token::Type::Default);
1099             case &#39;v&#39;:
1100                 shift();
1101                 if (!consume(&#39;i&#39;))
1102                     goto parseIdentifier;
1103                 if (!consume(&#39;c&#39;))
1104                     goto parseIdentifier;
1105                 if (!consume(&#39;e&#39;))
1106                     goto parseIdentifier;
1107                 if (nextIsIdentifier())
1108                     goto parseIdentifier;
1109                 return token(Token::Type::Device);
1110             default:
1111                 goto parseIdentifier;
1112             }
1113 
1114         default:
1115             goto parseIdentifier;
1116         }
1117 
1118 
1119     case &#39;f&#39;:
1120         switch (peek()) {
1121         case &#39;o&#39;:
1122             shift();
1123             if (!consume(&#39;r&#39;))
1124                 goto parseIdentifier;
1125             if (nextIsIdentifier())
1126                 goto parseIdentifier;
1127             return token(Token::Type::For);
1128         case &#39;r&#39;:
1129             shift();
1130             if (!consume(&#39;a&#39;))
1131                 goto parseIdentifier;
1132             if (!consume(&#39;g&#39;))
1133                 goto parseIdentifier;
1134             if (!consume(&#39;m&#39;))
1135                 goto parseIdentifier;
1136             if (!consume(&#39;e&#39;))
1137                 goto parseIdentifier;
1138             if (!consume(&#39;n&#39;))
1139                 goto parseIdentifier;
1140             if (!consume(&#39;t&#39;))
1141                 goto parseIdentifier;
1142             if (nextIsIdentifier())
1143                 goto parseIdentifier;
1144             return token(Token::Type::Fragment);
1145         case &#39;a&#39;:
1146             shift();
1147             if (!consume(&#39;l&#39;))
1148                 goto parseIdentifier;
1149 
1150             switch (peek()) {
1151             case &#39;l&#39;:
1152                 shift();
1153                 if (!consume(&#39;t&#39;))
1154                     goto parseIdentifier;
1155                 if (!consume(&#39;h&#39;))
1156                     goto parseIdentifier;
1157                 if (!consume(&#39;r&#39;))
1158                     goto parseIdentifier;
1159                 if (!consume(&#39;o&#39;))
1160                     goto parseIdentifier;
1161                 if (!consume(&#39;u&#39;))
1162                     goto parseIdentifier;
1163                 if (!consume(&#39;g&#39;))
1164                     goto parseIdentifier;
1165                 if (!consume(&#39;h&#39;))
1166                     goto parseIdentifier;
1167                 if (nextIsIdentifier())
1168                     goto parseIdentifier;
1169                 return token(Token::Type::Fallthrough);
1170 
1171             case &#39;s&#39;:
1172                 shift();
1173                 if (!consume(&#39;e&#39;))
1174                     goto parseIdentifier;
1175                 if (nextIsIdentifier())
1176                     goto parseIdentifier;
1177                 return token(Token::Type::False);
1178             default:
1179                 goto parseIdentifier;
1180             }
1181         case &#39;e&#39;:
1182             shift();
1183             switch (peek()) {
1184             case &#39;f&#39;:
1185                 shift();
1186                 if (!consume(&#39;a&#39;))
1187                     goto parseIdentifier;
1188                 if (!consume(&#39;u&#39;))
1189                     goto parseIdentifier;
1190                 if (!consume(&#39;l&#39;))
1191                     goto parseIdentifier;
1192                 if (!consume(&#39;t&#39;))
1193                     goto parseIdentifier;
1194                 if (nextIsIdentifier())
1195                     goto parseIdentifier;
1196                 return token(Token::Type::Default);
1197             case &#39;v&#39;:
1198                 shift();
1199                 if (!consume(&#39;i&#39;))
1200                     goto parseIdentifier;
1201                 if (!consume(&#39;c&#39;))
1202                     goto parseIdentifier;
1203                 if (!consume(&#39;e&#39;))
1204                     goto parseIdentifier;
1205                 if (nextIsIdentifier())
1206                     goto parseIdentifier;
1207                 return token(Token::Type::Device);
1208             default:
1209                 goto parseIdentifier;
1210             }
1211 
1212         default:
1213             goto parseIdentifier;
1214         }
1215 
1216     case &#39;w&#39;:
1217         if (!consume(&#39;h&#39;))
1218             goto parseIdentifier;
1219         if (!consume(&#39;i&#39;))
1220             goto parseIdentifier;
1221         if (!consume(&#39;l&#39;))
1222             goto parseIdentifier;
1223         if (!consume(&#39;e&#39;))
1224             goto parseIdentifier;
1225         if (nextIsIdentifier())
1226             goto parseIdentifier;
1227         return token(Token::Type::While);
1228 
1229     case &#39;r&#39;:
1230         if (!consume(&#39;e&#39;))
1231             goto parseIdentifier;
1232         switch (peek()) {
1233         case &#39;t&#39;:
1234             shift();
1235             if (!consume(&#39;u&#39;))
1236                 goto parseIdentifier;
1237             if (!consume(&#39;r&#39;))
1238                 goto parseIdentifier;
1239             if (!consume(&#39;n&#39;))
1240                 goto parseIdentifier;
1241             if (nextIsIdentifier())
1242                 goto parseIdentifier;
1243             return token(Token::Type::Return);
1244         case &#39;g&#39;:
1245             shift();
1246             if (!consume(&#39;i&#39;))
1247                 goto parseIdentifier;
1248             if (!consume(&#39;s&#39;))
1249                 goto parseIdentifier;
1250             if (!consume(&#39;t&#39;))
1251                 goto parseIdentifier;
1252             if (!consume(&#39;e&#39;))
1253                 goto parseIdentifier;
1254             if (!consume(&#39;r&#39;))
1255                 goto parseIdentifier;
1256             if (nextIsIdentifier())
1257                 goto parseIdentifier;
1258             return token(Token::Type::Register);
1259         case &#39;s&#39;:
1260             shift();
1261             if (!consume(&#39;t&#39;))
1262                 goto parseIdentifier;
1263             if (!consume(&#39;r&#39;))
1264                 goto parseIdentifier;
1265             if (!consume(&#39;i&#39;))
1266                 goto parseIdentifier;
1267             if (!consume(&#39;c&#39;))
1268                 goto parseIdentifier;
1269             if (!consume(&#39;t&#39;))
1270                 goto parseIdentifier;
1271             if (!consume(&#39;e&#39;))
1272                 goto parseIdentifier;
1273             if (!consume(&#39;d&#39;))
1274                 goto parseIdentifier;
1275             if (nextIsIdentifier())
1276                 goto parseIdentifier;
1277             return token(Token::Type::Restricted);
1278         default:
1279             goto parseIdentifier;
1280         }
1281 
1282     case &#39;n&#39;:
1283         switch (peek()) {
1284         case &#39;a&#39;:
1285             shift();
1286             if (!consume(&#39;t&#39;))
1287                 goto parseIdentifier;
1288             if (!consume(&#39;i&#39;))
1289                 goto parseIdentifier;
1290             if (!consume(&#39;v&#39;))
1291                 goto parseIdentifier;
1292             if (!consume(&#39;e&#39;))
1293                 goto parseIdentifier;
1294             if (nextIsIdentifier())
1295                 goto parseIdentifier;
1296             return token(Token::Type::Native);
1297         case &#39;u&#39;:
1298             shift();
1299             switch (peek()) {
1300             case &#39;l&#39;:
1301                 shift();
1302                 if (!consume(&#39;l&#39;))
1303                     goto parseIdentifier;
1304                 if (nextIsIdentifier())
1305                     goto parseIdentifier;
1306                 return token(Token::Type::Null);
1307             case &#39;m&#39;:
1308                 shift();
1309                 if (!consume(&#39;t&#39;))
1310                     goto parseIdentifier;
1311                 if (!consume(&#39;h&#39;))
1312                     goto parseIdentifier;
1313                 if (!consume(&#39;r&#39;))
1314                     goto parseIdentifier;
1315                 if (!consume(&#39;e&#39;))
1316                     goto parseIdentifier;
1317                 if (!consume(&#39;a&#39;))
1318                     goto parseIdentifier;
1319                 if (!consume(&#39;d&#39;))
1320                     goto parseIdentifier;
1321                 if (!consume(&#39;s&#39;))
1322                     goto parseIdentifier;
1323                 if (nextIsIdentifier())
1324                     goto parseIdentifier;
1325                 return token(Token::Type::NumThreads);
1326             default:
1327                 goto parseIdentifier;
1328             }
1329 
1330         case &#39;o&#39;:
1331             shift();
1332             switch (peek()) {
1333             case &#39;i&#39;:
1334                 shift();
1335                 if (!consume(&#39;n&#39;))
1336                     goto parseIdentifier;
1337                 if (!consume(&#39;t&#39;))
1338                     goto parseIdentifier;
1339                 if (!consume(&#39;e&#39;))
1340                     goto parseIdentifier;
1341                 if (!consume(&#39;r&#39;))
1342                     goto parseIdentifier;
1343                 if (!consume(&#39;p&#39;))
1344                     goto parseIdentifier;
1345                 if (!consume(&#39;o&#39;))
1346                     goto parseIdentifier;
1347                 if (!consume(&#39;l&#39;))
1348                     goto parseIdentifier;
1349                 if (!consume(&#39;a&#39;))
1350                     goto parseIdentifier;
1351                 if (!consume(&#39;t&#39;))
1352                     goto parseIdentifier;
1353                 if (!consume(&#39;i&#39;))
1354                     goto parseIdentifier;
1355                 if (!consume(&#39;o&#39;))
1356                     goto parseIdentifier;
1357                 if (!consume(&#39;n&#39;))
1358                     goto parseIdentifier;
1359                 if (nextIsIdentifier())
1360                     goto parseIdentifier;
1361                 return token(Token::Type::Qualifier);
1362             case &#39;p&#39;:
1363                 shift();
1364                 if (!consume(&#39;e&#39;))
1365                     goto parseIdentifier;
1366                 if (!consume(&#39;r&#39;))
1367                     goto parseIdentifier;
1368                 if (!consume(&#39;s&#39;))
1369                     goto parseIdentifier;
1370                 if (!consume(&#39;p&#39;))
1371                     goto parseIdentifier;
1372                 if (!consume(&#39;e&#39;))
1373                     goto parseIdentifier;
1374                 if (!consume(&#39;c&#39;))
1375                     goto parseIdentifier;
1376                 if (!consume(&#39;t&#39;))
1377                     goto parseIdentifier;
1378                 if (!consume(&#39;i&#39;))
1379                     goto parseIdentifier;
1380                 if (!consume(&#39;v&#39;))
1381                     goto parseIdentifier;
1382                 if (!consume(&#39;e&#39;))
1383                     goto parseIdentifier;
1384                 if (nextIsIdentifier())
1385                     goto parseIdentifier;
1386                 return token(Token::Type::Qualifier);
1387             default:
1388                 goto parseIdentifier;
1389             }
1390 
1391         default:
1392             goto parseIdentifier;
1393         }
1394 
1395     case &#39;v&#39;:
1396         if (!consume(&#39;e&#39;))
1397             goto parseIdentifier;
1398         if (!consume(&#39;r&#39;))
1399             goto parseIdentifier;
1400         if (!consume(&#39;t&#39;))
1401             goto parseIdentifier;
1402         if (!consume(&#39;e&#39;))
1403             goto parseIdentifier;
1404         if (!consume(&#39;x&#39;))
1405             goto parseIdentifier;
1406         if (nextIsIdentifier())
1407             goto parseIdentifier;
1408         return token(Token::Type::Vertex);
1409 
1410     case &#39;P&#39;:
1411         if (!consume(&#39;S&#39;))
1412             goto parseIdentifier;
1413         if (!consume(&#39;I&#39;))
1414             goto parseIdentifier;
1415         if (!consume(&#39;Z&#39;))
1416             goto parseIdentifier;
1417         if (!consume(&#39;E&#39;))
1418             goto parseIdentifier;
1419         if (nextIsIdentifier())
1420             goto parseIdentifier;
1421         return token(Token::Type::PSize);
1422 
1423     case &#39;u&#39;:
1424         if (!consume(&#39;n&#39;))
1425             goto parseIdentifier;
1426         if (!consume(&#39;i&#39;))
1427             goto parseIdentifier;
1428         if (!consume(&#39;f&#39;))
1429             goto parseIdentifier;
1430         if (!consume(&#39;o&#39;))
1431             goto parseIdentifier;
1432         if (!consume(&#39;r&#39;))
1433             goto parseIdentifier;
1434         if (!consume(&#39;m&#39;))
1435             goto parseIdentifier;
1436         if (nextIsIdentifier())
1437             goto parseIdentifier;
1438         return token(Token::Type::Qualifier);
1439 
1440     case &#39;p&#39;:
1441         if (!consume(&#39;r&#39;))
1442             goto parseIdentifier;
1443         if (!consume(&#39;o&#39;))
1444             goto parseIdentifier;
1445         if (!consume(&#39;t&#39;))
1446             goto parseIdentifier;
1447         if (!consume(&#39;o&#39;))
1448             goto parseIdentifier;
1449         if (!consume(&#39;c&#39;))
1450             goto parseIdentifier;
1451         if (!consume(&#39;o&#39;))
1452             goto parseIdentifier;
1453         if (!consume(&#39;l&#39;))
1454             goto parseIdentifier;
1455         if (nextIsIdentifier())
1456             goto parseIdentifier;
1457         return token(Token::Type::Protocol);
1458 
1459     case &#39;_&#39;:
1460         if (nextIsIdentifier())
1461             goto parseIdentifier;
1462         return token(Token::Type::Underscore);
1463 
1464     case &#39;a&#39;:
1465         switch (peek()) {
1466         case &#39;t&#39;:
1467             shift();
1468             if (!consume(&#39;t&#39;))
1469                 goto parseIdentifier;
1470             if (!consume(&#39;r&#39;))
1471                 goto parseIdentifier;
1472             if (!consume(&#39;i&#39;))
1473                 goto parseIdentifier;
1474             if (!consume(&#39;b&#39;))
1475                 goto parseIdentifier;
1476             if (!consume(&#39;u&#39;))
1477                 goto parseIdentifier;
1478             if (!consume(&#39;t&#39;))
1479                 goto parseIdentifier;
1480             if (!consume(&#39;e&#39;))
1481                 goto parseIdentifier;
1482             if (nextIsIdentifier())
1483                 goto parseIdentifier;
1484             return token(Token::Type::Attribute);
1485         case &#39;u&#39;:
1486             shift();
1487             if (!consume(&#39;t&#39;))
1488                 goto parseIdentifier;
1489             if (!consume(&#39;o&#39;))
1490                 goto parseIdentifier;
1491             if (nextIsIdentifier())
1492                 goto parseIdentifier;
1493             return token(Token::Type::Auto);
1494         default:
1495             goto parseIdentifier;
1496         }
1497 
1498     case &#39;&gt;&#39;:
1499         if (consume(&#39;&gt;&#39;)) {
1500             if (consume(&#39;=&#39;))
1501                 return token(Token::Type::RightShiftEquals);
1502             return token(Token::Type::RightShift);
1503         }
1504         if (consume(&#39;=&#39;))
1505             return token(Token::Type::GreaterThanOrEqualTo);
1506         return token(Token::Type::GreaterThanSign);
1507     case &#39;&lt;&#39;:
1508         if (consume(&#39;&lt;&#39;)) {
1509             if (consume(&#39;=&#39;))
1510                 return token(Token::Type::LeftShiftEquals);
1511             return token(Token::Type::LeftShift);
1512         }
1513         if (consume(&#39;=&#39;))
1514             return token(Token::Type::LessThanOrEqualTo);
1515         return token(Token::Type::LessThanSign);
1516 
1517     case &#39;+&#39;:
1518         if (consume(&#39;=&#39;))
1519             return token(Token::Type::PlusEquals);
1520         if (consume(&#39;+&#39;))
1521             return token(Token::Type::PlusPlus);
1522         return token(Token::Type::Plus);
1523 
1524     case &#39;-&#39;:
1525         if (consume(&#39;=&#39;))
1526             return token(Token::Type::MinusEquals);
1527         if (consume(&#39;-&#39;))
1528             return token(Token::Type::MinusMinus);
1529         if (consume(&#39;&gt;&#39;))
1530             return token(Token::Type::Arrow);
1531         if (isDigit(peek())) {
1532             shift();
1533             goto parseNumber;
1534         }
1535         if (consume(&#39;.&#39;))
1536             goto parseFloatAfterDot;
1537         return token(Token::Type::Minus);
1538 
1539     case &#39;*&#39;:
1540         if (consume(&#39;=&#39;))
1541             return token(Token::Type::TimesEquals);
1542         return token(Token::Type::Star);
1543 
1544     case &#39;/&#39;:
1545         if (consume(&#39;=&#39;))
1546             return token(Token::Type::DivideEquals);
1547         return token(Token::Type::Divide);
1548 
1549     case &#39;%&#39;:
1550         if (consume(&#39;=&#39;))
1551             return token(Token::Type::ModEquals);
1552         return token(Token::Type::Mod);
1553 
1554     case &#39;^&#39;:
1555         if (consume(&#39;=&#39;))
1556             return token(Token::Type::XorEquals);
1557         return token(Token::Type::Xor);
1558 
1559     case &#39;&amp;&#39;:
1560         if (consume(&#39;=&#39;))
1561             return token(Token::Type::AndEquals);
1562         if (consume(&#39;&amp;&#39;))
1563             return token(Token::Type::AndAnd);
1564         return token(Token::Type::And);
1565 
1566     case &#39;|&#39;:
1567         if (consume(&#39;=&#39;))
1568             return token(Token::Type::OrEquals);
1569         if (consume(&#39;|&#39;))
1570             return token(Token::Type::OrOr);
1571         return token(Token::Type::Or);
1572 
1573     case &#39;[&#39;:
1574         if (consume(&#39;]&#39;))
1575             return token(Token::Type::SquareBracketPair);
1576         return token(Token::Type::LeftSquareBracket);
1577 
1578     case &#39;=&#39;:
1579         if (consume(&#39;=&#39;))
1580             return token(Token::Type::EqualComparison);
1581         return token(Token::Type::EqualsSign);
1582 
1583     case &#39;!&#39;:
1584         if (consume(&#39;=&#39;))
1585             return token(Token::Type::NotEqual);
1586         return token(Token::Type::ExclamationPoint);
1587 
1588     case &#39;;&#39;:
1589         return token(Token::Type::Semicolon);
1590 
1591     case &#39;{&#39;:
1592         return token(Token::Type::LeftCurlyBracket);
1593 
1594     case &#39;}&#39;:
1595         return token(Token::Type::RightCurlyBracket);
1596 
1597     case &#39;:&#39;:
1598         return token(Token::Type::Colon);
1599 
1600     case &#39;,&#39;:
1601         return token(Token::Type::Comma);
1602 
1603     case &#39;(&#39;:
1604         return token(Token::Type::LeftParenthesis);
1605 
1606     case &#39;)&#39;:
1607         return token(Token::Type::RightParenthesis);
1608 
1609     case &#39;]&#39;:
1610         return token(Token::Type::RightSquareBracket);
1611 
1612     case &#39;.&#39;:
1613         if (isDigit(peek()))
1614             goto parseFloatAfterDot;
1615         return token(Token::Type::FullStop);
1616 
1617     case &#39;?&#39;:
1618         return token(Token::Type::QuestionMark);
1619 
1620     case &#39;~&#39;:
1621         return token(Token::Type::Tilde);
1622 
1623     case &#39;@&#39;:
1624         return token(Token::Type::At);
1625 
1626     case &#39;0&#39;:
1627     case &#39;1&#39;:
1628     case &#39;2&#39;:
1629     case &#39;3&#39;:
1630     case &#39;4&#39;:
1631     case &#39;5&#39;:
1632     case &#39;6&#39;:
1633     case &#39;7&#39;:
1634     case &#39;8&#39;:
1635     case &#39;9&#39;: {
1636 parseNumber:
1637         if (current == &#39;0&#39; &amp;&amp; consume(&#39;x&#39;)) {
1638             while (isHexadecimalCharacter(peek()))
1639                 shift();
1640             if (consume(&#39;u&#39;))
1641                 return token(Token::Type::UintLiteral);
1642             return token(Token::Type::IntLiteral);
1643         }
1644 
1645         while (isDigit(peek()))
1646             shift();
1647 
1648         if (consume(&#39;.&#39;)) {
1649 parseFloatAfterDot:
1650             while (isDigit(peek()))
1651                 shift();
1652             consume(&#39;f&#39;);
1653             return token(Token::Type::FloatLiteral);
1654         }
1655 
1656         if (consume(&#39;f&#39;))
1657             return token(Token::Type::FloatLiteral);
1658 
1659         if (consume(&#39;u&#39;))
1660             return token(Token::Type::UintLiteral);
1661 
1662         return token(Token::Type::IntLiteral);
1663     }
1664 
1665     default:
1666         break;
1667     }
1668 
1669     if (m_offset == m_stringView.length())
1670         return token(Token::Type::EndOfFile);
1671     return token(Token::Type::Invalid);
1672 }
1673 
1674 
1675 // We can take advantage of two properties of Unicode:
1676 // 1. The consitutent UTF-16 code units for all non-BMP code points are surrogates,
1677 // which means we&#39;ll never see a false match. If we see a BMP code unit, we
1678 // really have a BMP code point.
1679 // 2. Everything we&#39;re looking for is in BMP
1680 
1681 static inline bool isWhitespace(UChar codeUnit)
1682 {
1683     switch (codeUnit) {
1684     case &#39; &#39;:
1685     case &#39;\t&#39;:
1686     case &#39;\r&#39;:
1687     case &#39;\n&#39;:
1688         return true;
1689     default:
1690         return false;
1691     }
1692 }
1693 
1694 static inline bool isNewline(UChar codeUnit)
1695 {
1696     switch (codeUnit) {
1697     case &#39;\r&#39;:
1698     case &#39;\n&#39;:
1699         return true;
1700     default:
1701         return false;
1702     }
1703 }
1704 
1705 auto Lexer::lineAndColumnNumberFromOffset(const StringView&amp; stringView, unsigned targetOffset) -&gt; LineAndColumn
1706 {
1707     // Counting from 1 to match most text editors.
1708     unsigned lineNumber = 1;
1709     unsigned columnNumber = 1;
1710     for (unsigned offset = 0; offset &lt; std::min(stringView.length(), targetOffset); ++offset) {
1711         ++columnNumber;
1712         if (isNewline(stringView[offset])) {
1713             ++lineNumber;
1714             columnNumber = 1;
1715         }
1716     }
1717     return { lineNumber, columnNumber };
1718 }
1719 
1720 static Optional&lt;StringView&gt; sourceFromNameSpace(AST::NameSpace nameSpace, const String&amp; source1, const String* source2)
1721 {
1722     switch (nameSpace) {
1723     case AST::NameSpace::StandardLibrary:
1724         return WTF::nullopt;
1725     case AST::NameSpace::NameSpace1:
1726         return StringView(source1);
1727     case AST::NameSpace::NameSpace2:
1728         ASSERT(source2);
1729         return StringView(*source2);
1730     }
1731 }
1732 
1733 String Lexer::errorString(Error error, const String&amp; source1, const String* source2)
1734 {
1735     if (auto codeLocation = error.codeLocation()) {
1736         if (auto source = sourceFromNameSpace(codeLocation.nameSpace(), source1, source2)) {
1737             auto lineAndColumn = lineAndColumnNumberFromOffset(*source, error.codeLocation().startOffset());
1738             return makeString(lineAndColumn.line, &#39;:&#39;, lineAndColumn.column, &quot;: &quot;, error.message());
1739         }
1740     }
1741     return error.message();
1742 }
1743 
1744 void Lexer::skipWhitespaceAndComments()
1745 {
1746     while (m_offset &lt; m_stringView.length()) {
1747         if (isWhitespace(m_stringView[m_offset]))
1748             ++m_offset;
1749         else if (m_stringView[m_offset] == &#39;/&#39; &amp;&amp; m_offset + 1 &lt; m_stringView.length()) {
1750             if (m_stringView[m_offset + 1] == &#39;/&#39;) {
1751                 // Line comment
1752                 m_offset += 2;
1753                 // Note that in the case of \r\n this makes the comment end on the \r. It is fine, as the \n after that is simple whitespace.
1754                 for ( ; m_offset &lt; m_stringView.length() &amp;&amp; !isNewline(m_stringView[m_offset]); ++m_offset) { }
1755             } else if (m_stringView[m_offset + 1] == &#39;*&#39;) {
1756                 // Long comment
1757                 for ( ; m_offset &lt; m_stringView.length() ; ++m_offset) {
1758                     if (m_stringView[m_offset] == &#39;*&#39; &amp;&amp; m_offset + 1 &lt; m_stringView.length() &amp;&amp; m_stringView[m_offset + 1] == &#39;/&#39;) {
1759                         m_offset += 2;
1760                         break;
1761                     }
1762                 }
1763             } else
1764                 break;
1765         } else
1766             break;
1767     }
1768 }
1769 
1770 } // namespace WHLSL
1771 
1772 } // namespace WebCore
1773 
1774 #endif // ENABLE(WEBGPU)
    </pre>
  </body>
</html>