<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/cv/VideoTextureCopierCV.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="TextureCacheCV.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="VideoTextureCopierCV.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/cv/VideoTextureCopierCV.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -59,22 +59,10 @@</span>
      kDCI_P3,
      kP3_D65,
      kITU_R_2020,
  };
  
<span class="udiff-line-removed">- #if PLATFORM(MAC) &amp;&amp; __MAC_OS_X_VERSION_MIN_REQUIRED &lt; 101300</span>
<span class="udiff-line-removed">- enum {</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_ARGB2101010LEPacked = &#39;l10r&#39;,</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_420YpCbCr10BiPlanarVideoRange = &#39;x420&#39;,</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_422YpCbCr10BiPlanarVideoRange = &#39;x422&#39;,</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_444YpCbCr10BiPlanarVideoRange = &#39;x444&#39;,</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_420YpCbCr10BiPlanarFullRange  = &#39;xf20&#39;,</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_422YpCbCr10BiPlanarFullRange  = &#39;xf22&#39;,</span>
<span class="udiff-line-removed">-     kCVPixelFormatType_444YpCbCr10BiPlanarFullRange  = &#39;xf44&#39;,</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">- </span>
  static PixelRange pixelRangeFromPixelFormat(OSType pixelFormat)
  {
      switch (pixelFormat) {
      case kCVPixelFormatType_4444AYpCbCr8:
      case kCVPixelFormatType_4444AYpCbCr16:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -97,10 +85,12 @@</span>
      }
  }
  
  static TransferFunction transferFunctionFromString(CFStringRef string)
  {
<span class="udiff-line-added">+     if (!string || CFGetTypeID(string) != CFStringGetTypeID())</span>
<span class="udiff-line-added">+         return TransferFunction::Unknown;</span>
      if (CFEqual(string, kCVImageBufferYCbCrMatrix_ITU_R_709_2))
          return TransferFunction::kITU_R_709_2;
      if (CFEqual(string, kCVImageBufferYCbCrMatrix_ITU_R_601_4))
          return TransferFunction::kITU_R_601_4;
      if (CFEqual(string, kCVImageBufferYCbCrMatrix_SMPTE_240M_1995))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -399,66 +389,66 @@</span>
  static StringMap&amp; enumToStringMap()
  {
      static NeverDestroyed&lt;StringMap&gt; map;
      if (map.get().empty()) {
          StringMap stringMap;
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGB));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGBA));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_LUMINANCE_ALPHA));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_LUMINANCE));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_ALPHA));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R16F));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R32F));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R8UI));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R8I));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R16UI));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R16I));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R32UI));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_R32I));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG16F));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG32F));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG8UI));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG8I));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG16UI));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG16I));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG32UI));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG32I));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGB8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_SRGB8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGBA8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_SRGB8_ALPHA8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGBA4));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGB10_A2));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_DEPTH_COMPONENT16));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_DEPTH_COMPONENT24));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_DEPTH_COMPONENT32F));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_DEPTH24_STENCIL8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_DEPTH32F_STENCIL8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGB));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RGBA));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_LUMINANCE_ALPHA));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_LUMINANCE));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_ALPHA));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RED));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_RG_INTEGER));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_DEPTH_STENCIL));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_BYTE));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_SHORT_5_6_5));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_SHORT_4_4_4_4));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_SHORT_5_5_5_1));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_BYTE));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_HALF_FLOAT));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_FLOAT));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_SHORT));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_SHORT));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_INT));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_INT));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_INT_2_10_10_10_REV));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_UNSIGNED_INT_24_8));</span>
<span class="udiff-line-modified-removed">-         map.get().emplace(STRINGIFY_PAIR(GL_FLOAT_32_UNSIGNED_INT_24_8_REV));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGB));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGBA));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::LUMINANCE_ALPHA));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::LUMINANCE));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::ALPHA));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R16F));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R32F));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R8UI));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R8I));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R16UI));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R16I));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R32UI));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::R32I));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG16F));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG32F));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG8UI));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG8I));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG16UI));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG16I));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG32UI));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG32I));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGB8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::SRGB8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGBA8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::SRGB8_ALPHA8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGBA4));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGB10_A2));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::DEPTH_COMPONENT16));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::DEPTH_COMPONENT24));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::DEPTH_COMPONENT32F));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::DEPTH24_STENCIL8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::DEPTH32F_STENCIL8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGB));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RGBA));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::LUMINANCE_ALPHA));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::LUMINANCE));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::ALPHA));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RED));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::RG_INTEGER));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::DEPTH_STENCIL));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_BYTE));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_SHORT_5_6_5));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_SHORT_4_4_4_4));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_SHORT_5_5_5_1));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::BYTE));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::HALF_FLOAT));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::FLOAT));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_SHORT));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::SHORT));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_INT));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::INT));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_INT_2_10_10_10_REV));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::UNSIGNED_INT_24_8));</span>
<span class="udiff-line-modified-added">+         map.get().emplace(STRINGIFY_PAIR(GraphicsContext3D::FLOAT_32_UNSIGNED_INT_24_8_REV));</span>
  
  #if USE(OPENGL_ES)
          map.get().emplace(STRINGIFY_PAIR(GL_RED_INTEGER));
          map.get().emplace(STRINGIFY_PAIR(GL_RGB_INTEGER));
          map.get().emplace(STRINGIFY_PAIR(GL_RG8_SNORM));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -526,23 +516,33 @@</span>
      StringBuilder fragmentShaderSource;
  
  #if USE(OPENGL_ES)
      fragmentShaderSource.appendLiteral(&quot;precision mediump float;\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;uniform sampler2D u_texture;\n&quot;);
<span class="udiff-line-modified-removed">- #else</span>
<span class="udiff-line-modified-added">+ #elif USE(OPENGL)</span>
      fragmentShaderSource.appendLiteral(&quot;uniform sampler2DRect u_texture;\n&quot;);
<span class="udiff-line-added">+ #elif USE(ANGLE)</span>
<span class="udiff-line-added">+     // FIXME: determine how to access rectangular textures via ANGLE.</span>
<span class="udiff-line-added">+     ASSERT_NOT_REACHED();</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+ #error Unsupported configuration</span>
  #endif
      fragmentShaderSource.appendLiteral(&quot;varying vec2 v_texturePosition;\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;uniform int u_premultiply;\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;uniform vec2 u_textureDimensions;\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;uniform int u_swapColorChannels;\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;void main() {\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;    vec2 texPos = vec2(v_texturePosition.x * u_textureDimensions.x, v_texturePosition.y * u_textureDimensions.y);\n&quot;);
  #if USE(OPENGL_ES)
      fragmentShaderSource.appendLiteral(&quot;    vec4 color = texture2D(u_texture, texPos);\n&quot;);
<span class="udiff-line-modified-removed">- #else</span>
<span class="udiff-line-modified-added">+ #elif USE(OPENGL)</span>
      fragmentShaderSource.appendLiteral(&quot;    vec4 color = texture2DRect(u_texture, texPos);\n&quot;);
<span class="udiff-line-added">+ #elif USE(ANGLE)</span>
<span class="udiff-line-added">+     // FIXME: determine how to access rectangular textures via ANGLE.</span>
<span class="udiff-line-added">+     ASSERT_NOT_REACHED();</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+ #error Unsupported configuration</span>
  #endif
      fragmentShaderSource.appendLiteral(&quot;    if (u_swapColorChannels == 1) {\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;        color.rgba = color.bgra;\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;    }\n&quot;);
      fragmentShaderSource.appendLiteral(&quot;    if (u_premultiply == 1) {\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -619,13 +619,17 @@</span>
          &quot;       normalizedPosition.y = 1.0 - normalizedPosition.y;\n&quot;
          &quot;   }\n&quot;
  #if USE(OPENGL_ES)
          &quot;   v_yTextureCoordinate = normalizedPosition;\n&quot;
          &quot;   v_uvTextureCoordinate = normalizedPosition;\n&quot;
<span class="udiff-line-modified-removed">- #else</span>
<span class="udiff-line-modified-added">+ #elif USE(OPENGL)</span>
          &quot;   v_yTextureCoordinate = normalizedPosition * u_yTextureSize;\n&quot;
          &quot;   v_uvTextureCoordinate = normalizedPosition * u_uvTextureSize;\n&quot;
<span class="udiff-line-added">+ #elif USE(ANGLE)</span>
<span class="udiff-line-added">+         // FIXME: determine how to access rectangular textures via ANGLE.</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+ #error Unsupported configuration</span>
  #endif
          &quot;}\n&quot;_s
      };
  
      Platform3DObject vertexShader = m_context-&gt;createShader(GraphicsContext3D::VERTEX_SHADER);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -643,13 +647,17 @@</span>
      String fragmentShaderSource {
  #if USE(OPENGL_ES)
          &quot;precision mediump float;\n&quot;
          &quot;#define SAMPLERTYPE sampler2D\n&quot;
          &quot;#define TEXTUREFUNC texture2D\n&quot;
<span class="udiff-line-modified-removed">- #else</span>
<span class="udiff-line-modified-added">+ #elif USE(OPENGL)</span>
          &quot;#define SAMPLERTYPE sampler2DRect\n&quot;
          &quot;#define TEXTUREFUNC texture2DRect\n&quot;
<span class="udiff-line-added">+ #elif USE(ANGLE)</span>
<span class="udiff-line-added">+         // FIXME: determine how to access rectangular textures via ANGLE.</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+ #error Unsupported configuration</span>
  #endif
          &quot;uniform SAMPLERTYPE u_yTexture;\n&quot;
          &quot;uniform SAMPLERTYPE u_uvTexture;\n&quot;
          &quot;uniform mat4 u_colorMatrix;\n&quot;
          &quot;varying vec2 v_yTextureCoordinate;\n&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -786,21 +794,26 @@</span>
      auto uvPlaneWidth = IOSurfaceGetWidthOfPlane(surface, 1);
      auto uvPlaneHeight = IOSurfaceGetHeightOfPlane(surface, 1);
  
  #if USE(OPENGL_ES)
      GC3Denum videoTextureTarget = GraphicsContext3D::TEXTURE_2D;
<span class="udiff-line-modified-removed">- #else</span>
<span class="udiff-line-modified-added">+ #elif USE(OPENGL)</span>
      GC3Denum videoTextureTarget = GL_TEXTURE_RECTANGLE_ARB;
<span class="udiff-line-added">+ #elif USE(ANGLE)</span>
<span class="udiff-line-added">+     // FIXME: determine how to access rectangular textures via ANGLE.</span>
<span class="udiff-line-added">+     GC3Denum videoTextureTarget = GraphicsContext3D::TEXTURE_2D;</span>
<span class="udiff-line-added">+ #else</span>
<span class="udiff-line-added">+ #error Unsupported configuration</span>
  #endif
      auto uvTexture = m_context-&gt;createTexture();
      m_context-&gt;activeTexture(GraphicsContext3D::TEXTURE1);
      m_context-&gt;bindTexture(videoTextureTarget, uvTexture);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_MAG_FILTER, GraphicsContext3D::LINEAR);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_MIN_FILTER, GraphicsContext3D::LINEAR);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_WRAP_S, GraphicsContext3D::CLAMP_TO_EDGE);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_WRAP_T, GraphicsContext3D::CLAMP_TO_EDGE);
<span class="udiff-line-modified-removed">-     if (!m_context-&gt;texImageIOSurface2D(videoTextureTarget, GL_RG, uvPlaneWidth, uvPlaneHeight, GL_RG, GL_UNSIGNED_BYTE, surface, 1)) {</span>
<span class="udiff-line-modified-added">+     if (!m_context-&gt;texImageIOSurface2D(videoTextureTarget, GraphicsContext3D::RG, uvPlaneWidth, uvPlaneHeight, GraphicsContext3D::RG, GraphicsContext3D::UNSIGNED_BYTE, surface, 1)) {</span>
          m_context-&gt;deleteTexture(uvTexture);
          return false;
      }
  
      auto yTexture = m_context-&gt;createTexture();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -808,11 +821,11 @@</span>
      m_context-&gt;bindTexture(videoTextureTarget, yTexture);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_MAG_FILTER, GraphicsContext3D::LINEAR);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_MIN_FILTER, GraphicsContext3D::LINEAR);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_WRAP_S, GraphicsContext3D::CLAMP_TO_EDGE);
      m_context-&gt;texParameteri(videoTextureTarget, GraphicsContext3D::TEXTURE_WRAP_T, GraphicsContext3D::CLAMP_TO_EDGE);
<span class="udiff-line-modified-removed">-     if (!m_context-&gt;texImageIOSurface2D(videoTextureTarget, GL_LUMINANCE, yPlaneWidth, yPlaneHeight, GL_LUMINANCE, GL_UNSIGNED_BYTE, surface, 0)) {</span>
<span class="udiff-line-modified-added">+     if (!m_context-&gt;texImageIOSurface2D(videoTextureTarget, GraphicsContext3D::LUMINANCE, yPlaneWidth, yPlaneHeight, GraphicsContext3D::LUMINANCE, GraphicsContext3D::UNSIGNED_BYTE, surface, 0)) {</span>
          m_context-&gt;deleteTexture(yTexture);
          m_context-&gt;deleteTexture(uvTexture);
          return false;
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -863,14 +876,20 @@</span>
      GLfloat upperLeft[2] = { 0, 0 };
  #if USE(OPENGL_ES)
      Platform3DObject videoTextureName = CVOpenGLESTextureGetName(inputVideoTexture);
      GC3Denum videoTextureTarget = CVOpenGLESTextureGetTarget(inputVideoTexture);
      CVOpenGLESTextureGetCleanTexCoords(inputVideoTexture, lowerLeft, lowerRight, upperRight, upperLeft);
<span class="udiff-line-modified-removed">- #else</span>
<span class="udiff-line-modified-added">+ #elif USE(OPENGL)</span>
<span class="udiff-line-added">+     Platform3DObject videoTextureName = CVOpenGLTextureGetName(inputVideoTexture);</span>
<span class="udiff-line-added">+     GC3Denum videoTextureTarget = CVOpenGLTextureGetTarget(inputVideoTexture);</span>
<span class="udiff-line-added">+     CVOpenGLTextureGetCleanTexCoords(inputVideoTexture, lowerLeft, lowerRight, upperRight, upperLeft);</span>
<span class="udiff-line-added">+ #elif USE(ANGLE)</span>
      Platform3DObject videoTextureName = CVOpenGLTextureGetName(inputVideoTexture);
      GC3Denum videoTextureTarget = CVOpenGLTextureGetTarget(inputVideoTexture);
      CVOpenGLTextureGetCleanTexCoords(inputVideoTexture, lowerLeft, lowerRight, upperRight, upperLeft);
<span class="udiff-line-added">+     // FIXME: determine how to access rectangular textures via ANGLE.</span>
<span class="udiff-line-added">+     ASSERT_NOT_REACHED();</span>
  #endif
  
      if (lowerLeft[1] &lt; upperRight[1])
          flipY = !flipY;
  
</pre>
<center><a href="TextureCacheCV.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="VideoTextureCopierCV.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>