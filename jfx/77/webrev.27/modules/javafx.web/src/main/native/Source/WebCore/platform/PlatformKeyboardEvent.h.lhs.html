<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/WebCore/platform/PlatformKeyboardEvent.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
  2  * Copyright (C) 2004, 2005, 2006 Apple Inc.  All rights reserved.
  3  * Copyright (C) 2008 Collabora, Ltd.  All rights reserved.
  4  *
  5  * Redistribution and use in source and binary forms, with or without
  6  * modification, are permitted provided that the following conditions
  7  * are met:
  8  * 1. Redistributions of source code must retain the above copyright
  9  *    notice, this list of conditions and the following disclaimer.
 10  * 2. Redistributions in binary form must reproduce the above copyright
 11  *    notice, this list of conditions and the following disclaimer in the
 12  *    documentation and/or other materials provided with the distribution.
 13  *
 14  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 15  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 16  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 18  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 19  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 20  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 21  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 22  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 24  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 25  */
 26 
 27 #pragma once
 28 
 29 #include &quot;KeypressCommand.h&quot;
 30 #include &quot;PlatformEvent.h&quot;
 31 #include &lt;wtf/WindowsExtras.h&gt;
 32 #include &lt;wtf/text/WTFString.h&gt;
 33 
 34 #if PLATFORM(COCOA)
 35 #include &lt;wtf/RetainPtr.h&gt;
 36 OBJC_CLASS NSEvent;
 37 #endif
 38 
 39 #if PLATFORM(IOS_FAMILY)
 40 OBJC_CLASS WebEvent;
 41 #endif
 42 
 43 #if PLATFORM(GTK)
 44 typedef struct _GdkEventKey GdkEventKey;
 45 #include &quot;CompositionResults.h&quot;
 46 #endif
 47 
 48 #if PLATFORM(JAVA)
 49 #include &lt;jni.h&gt;
 50 #endif
 51 
 52 namespace WebCore {
 53 
 54     class PlatformKeyboardEvent : public PlatformEvent {
 55         WTF_MAKE_FAST_ALLOCATED;
 56     public:
 57         PlatformKeyboardEvent()
 58             : PlatformEvent(PlatformEvent::KeyDown)
 59             , m_windowsVirtualKeyCode(0)
<a name="1" id="anc1"></a><span class="line-removed"> 60 #if USE(APPKIT) || PLATFORM(GTK)</span>
<span class="line-removed"> 61             , m_handledByInputMethod(false)</span>
<span class="line-removed"> 62 #endif</span>
 63             , m_autoRepeat(false)
 64             , m_isKeypad(false)
 65             , m_isSystemKey(false)
 66 #if PLATFORM(GTK)
 67             , m_gdkEventKey(0)
 68 #endif
 69         {
 70         }
 71 
 72         PlatformKeyboardEvent(Type type, const String&amp; text, const String&amp; unmodifiedText,
 73 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)
 74         const String&amp; key,
 75 #endif
 76 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)
 77         const String&amp; code,
 78 #endif
 79         const String&amp; keyIdentifier, int windowsVirtualKeyCode, bool isAutoRepeat, bool isKeypad, bool isSystemKey, OptionSet&lt;Modifier&gt; modifiers, WallTime timestamp)
 80             : PlatformEvent(type, modifiers, timestamp)
 81             , m_text(text)
 82             , m_unmodifiedText(unmodifiedText)
 83 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)
 84             , m_key(key)
 85 #endif
 86 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)
 87             , m_code(code)
 88 #endif
 89             , m_keyIdentifier(keyIdentifier)
 90             , m_windowsVirtualKeyCode(windowsVirtualKeyCode)
<a name="2" id="anc2"></a><span class="line-removed"> 91 #if USE(APPKIT) || PLATFORM(GTK)</span>
<span class="line-removed"> 92             , m_handledByInputMethod(false)</span>
<span class="line-removed"> 93 #endif</span>
 94             , m_autoRepeat(isAutoRepeat)
 95             , m_isKeypad(isKeypad)
 96             , m_isSystemKey(isSystemKey)
 97         {
 98         }
 99 
100         WEBCORE_EXPORT void disambiguateKeyDownEvent(Type, bool backwardCompatibilityMode = false); // Only used on platforms that need it, i.e. those that generate KeyDown events.
101 
102         // Text as as generated by processing a virtual key code with a keyboard layout
103         // (in most cases, just a character code, but the layout can emit several
104         // characters in a single keypress event on some platforms).
105         // This may bear no resemblance to the ultimately inserted text if an input method
106         // processes the input.
107         // Will be null for KeyUp and RawKeyDown events.
108         String text() const { return m_text; }
109 
110         // Text that would have been generated by the keyboard if no modifiers were pressed
111         // (except for Shift); useful for shortcut (accelerator) key handling.
112         // Otherwise, same as text().
113         String unmodifiedText() const { return m_unmodifiedText; }
114 
115         String keyIdentifier() const { return m_keyIdentifier; }
116 
117 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)
118         const String&amp; key() const { return m_key; }
119 #endif
120 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)
121         const String&amp; code() const { return m_code; }
122 #endif
123 
124         // Most compatible Windows virtual key code associated with the event.
125         // Zero for Char events.
126         int windowsVirtualKeyCode() const { return m_windowsVirtualKeyCode; }
127         void setWindowsVirtualKeyCode(int code) { m_windowsVirtualKeyCode = code; }
128 
<a name="3" id="anc3"></a><span class="line-modified">129 #if USE(APPKIT) || PLATFORM(GTK)</span>
130         bool handledByInputMethod() const { return m_handledByInputMethod; }
131 #endif
132 #if USE(APPKIT)
133         const Vector&lt;KeypressCommand&gt;&amp; commands() const { return m_commands; }
134 #elif PLATFORM(GTK)
135         const Vector&lt;String&gt;&amp; commands() const { return m_commands; }
136 #endif
137 
138         bool isAutoRepeat() const { return m_autoRepeat; }
139         bool isKeypad() const { return m_isKeypad; }
140         bool isSystemKey() const { return m_isSystemKey; }
141 
<a name="4" id="anc4"></a>


142         WEBCORE_EXPORT static bool currentCapsLockState();
143         WEBCORE_EXPORT static void getCurrentModifierState(bool&amp; shiftKey, bool&amp; ctrlKey, bool&amp; altKey, bool&amp; metaKey);
144         WEBCORE_EXPORT static void setCurrentModifierState(OptionSet&lt;Modifier&gt;);
145         WEBCORE_EXPORT static OptionSet&lt;Modifier&gt; currentStateOfModifierKeys();
146 
147 #if PLATFORM(COCOA)
148 #if !PLATFORM(IOS_FAMILY)
149         NSEvent* macEvent() const { return m_macEvent.get(); }
150 #else
151         ::WebEvent *event() const { return m_Event.get(); }
152 #endif
153 #endif
154 
155 #if PLATFORM(WIN)
156         PlatformKeyboardEvent(HWND, WPARAM, LPARAM, Type, bool);
157 #endif
158 
159 #if PLATFORM(GTK)
160         PlatformKeyboardEvent(GdkEventKey*, const CompositionResults&amp;);
161         GdkEventKey* gdkEventKey() const { return m_gdkEventKey; }
162         const CompositionResults&amp; compositionResults() const { return m_compositionResults; }
163 
164         // Used by WebKit2
165         static String keyValueForGdkKeyCode(unsigned);
166         static String keyCodeForHardwareKeyCode(unsigned);
167         static String keyIdentifierForGdkKeyCode(unsigned);
168         static int windowsKeyCodeForGdkKeyCode(unsigned);
169         static String singleCharacterString(unsigned);
170         static bool modifiersContainCapsLock(unsigned);
171 #endif
172 
173 #if PLATFORM(JAVA)
174         PlatformKeyboardEvent(jint type, jstring text, jstring keyIdentifier,
175                               jint windowsVirtualKeyCode, jboolean shift,
176                               jboolean ctrl, jboolean alt, jboolean meta, jdouble timestamp);
177 #endif
178 
179 #if USE(LIBWPE)
180         static String keyValueForWPEKeyCode(unsigned);
181         static String keyCodeForHardwareKeyCode(unsigned);
182         static String keyIdentifierForWPEKeyCode(unsigned);
183         static int windowsKeyCodeForWPEKeyCode(unsigned);
184         static String singleCharacterString(unsigned);
185 #endif
186 
187     protected:
188         String m_text;
189         String m_unmodifiedText;
190 #if ENABLE(KEYBOARD_KEY_ATTRIBUTE)
191         String m_key;
192 #endif
193 #if ENABLE(KEYBOARD_CODE_ATTRIBUTE)
194         String m_code;
195 #endif
196         String m_keyIdentifier;
197         int m_windowsVirtualKeyCode;
<a name="5" id="anc5"></a><span class="line-modified">198 #if USE(APPKIT) || PLATFORM(GTK)</span>
<span class="line-modified">199         bool m_handledByInputMethod;</span>
200 #endif
201 #if USE(APPKIT)
202         Vector&lt;KeypressCommand&gt; m_commands;
203 #elif PLATFORM(GTK)
204         Vector&lt;String&gt; m_commands;
205 #endif
206         bool m_autoRepeat;
207         bool m_isKeypad;
208         bool m_isSystemKey;
209 
<a name="6" id="anc6"></a>

210 #if PLATFORM(COCOA)
211 #if !PLATFORM(IOS_FAMILY)
212         RetainPtr&lt;NSEvent&gt; m_macEvent;
213 #else
214         RetainPtr&lt;::WebEvent&gt; m_Event;
215 #endif
216 #endif
217 #if PLATFORM(GTK)
218         GdkEventKey* m_gdkEventKey;
219         CompositionResults m_compositionResults;
220 #endif
221 
222         // The modifier state is optional, since it is not needed in the UI process or in legacy WebKit.
223         static Optional&lt;OptionSet&lt;Modifier&gt;&gt; s_currentModifiers;
224     };
225 
226 } // namespace WebCore
<a name="7" id="anc7"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="7" type="hidden" />
</body>
</html>