<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderThemeGtk.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="RenderTheme.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderThemeGtk.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/rendering/RenderThemeGtk.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 31,11 ***</span>
  #include &quot;FontDescription.h&quot;
  #include &quot;GRefPtrGtk.h&quot;
  #include &quot;GUniquePtrGtk.h&quot;
  #include &quot;Gradient.h&quot;
  #include &quot;GraphicsContext.h&quot;
<span class="line-removed">- #include &quot;GtkVersioning.h&quot;</span>
  #include &quot;HTMLInputElement.h&quot;
  #include &quot;HTMLMediaElement.h&quot;
  #include &quot;LocalizedStrings.h&quot;
  #include &quot;MediaControlElements.h&quot;
  #include &quot;Page.h&quot;
<span class="line-new-header">--- 31,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 123,28 ***</span>
      // FIXME: We need to set this to the position of the tick marks.
      return 0;
  }
  #endif
  
<span class="line-removed">- #ifndef GTK_API_VERSION_2</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void themeChangedCallback()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     Page::updateStyleForAllPagesAfterGlobalChangeInEnvironment();</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- RenderThemeGtk::RenderThemeGtk()</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     static bool themeMonitorInitialized = false;</span>
<span class="line-removed">-     if (!themeMonitorInitialized) {</span>
<span class="line-removed">-         GtkSettings* settings = gtk_settings_get_default();</span>
<span class="line-removed">-         g_signal_connect(settings, &quot;notify::gtk-theme-name&quot;, G_CALLBACK(themeChangedCallback), nullptr);</span>
<span class="line-removed">-         g_signal_connect(settings, &quot;notify::gtk-color-scheme&quot;, G_CALLBACK(themeChangedCallback), nullptr);</span>
<span class="line-removed">-         themeMonitorInitialized = true;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
  enum RenderThemePart {
      Entry,
      EntrySelection,
      EntryIconLeft,
      EntryIconRight,
<span class="line-new-header">--- 122,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 165,138 ***</span>
      SpinButtonUpButton,
      SpinButtonDownButton,
  #if ENABLE(VIDEO)
      MediaButton,
  #endif
  };
  
<span class="line-removed">- #if !GTK_CHECK_VERSION(3, 20, 0)</span>
<span class="line-removed">- // This is the default value defined by GTK+, where it was defined as MIN_ARROW_SIZE in gtkarrow.c.</span>
<span class="line-removed">- static const int minArrowSize = 15;</span>
<span class="line-removed">- // This is the default value defined by GTK+, where it was defined as MIN_ARROW_WIDTH in gtkspinbutton.c.</span>
<span class="line-removed">- static const int minSpinButtonArrowSize = 6;</span>
<span class="line-removed">- </span>
<span class="line-removed">- static GRefPtr&lt;GtkStyleContext&gt; createStyleContext(RenderThemePart themePart, GtkStyleContext* parent = nullptr)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkWidgetPath&gt; path = adoptGRef(parent ? gtk_widget_path_copy(gtk_style_context_get_path(parent)) : gtk_widget_path_new());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     switch (themePart) {</span>
<span class="line-removed">-     case Entry:</span>
<span class="line-removed">-     case EntrySelection:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_ENTRY);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_ENTRY);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case EntryIconLeft:</span>
<span class="line-removed">-     case EntryIconRight:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_ENTRY);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case Button:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, &quot;text-button&quot;);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case CheckButton:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_CHECK_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_CHECK);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case RadioButton:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_RADIO_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_RADIO);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ComboBox:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_COMBO_BOX);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ComboBoxButton:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, &quot;text-button&quot;);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, &quot;combo&quot;);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ComboBoxArrow:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_ARROW);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, &quot;arrow&quot;);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case Scale:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_SCALE);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_SCALE);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ScaleTrough:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_SCALE);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_SCALE);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_TROUGH);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ScaleSlider:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_SCALE);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_SCALE);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_SLIDER);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ProgressBar:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_PROGRESS_BAR);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_PROGRESSBAR);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_HORIZONTAL);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ProgressBarTrough:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_PROGRESS_BAR);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_TROUGH);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ProgressBarProgress:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_PROGRESS_BAR);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_PROGRESSBAR);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ListBox:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_TREE_VIEW);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_VIEW);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case SpinButton:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_SPIN_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_SPINBUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_HORIZONTAL);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case SpinButtonUpButton:</span>
<span class="line-removed">-     case SpinButtonDownButton:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_SPIN_BUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_SPINBUTTON);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_BUTTON);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">- #if ENABLE(VIDEO)</span>
<span class="line-removed">-     case MediaButton:</span>
<span class="line-removed">-         gtk_widget_path_append_type(path.get(), GTK_TYPE_IMAGE);</span>
<span class="line-removed">-         gtk_widget_path_iter_add_class(path.get(), -1, GTK_STYLE_CLASS_IMAGE);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">- #endif // ENABLE(VIDEO)</span>
<span class="line-removed">-     default:</span>
<span class="line-removed">-         ASSERT_NOT_REACHED();</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = adoptGRef(gtk_style_context_new());</span>
<span class="line-removed">-     gtk_style_context_set_path(context.get(), path.get());</span>
<span class="line-removed">-     gtk_style_context_set_parent(context.get(), parent);</span>
<span class="line-removed">-     return context;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static GRefPtr&lt;GdkPixbuf&gt; loadThemedIcon(GtkStyleContext* context, const char* iconName, GtkIconSize iconSize)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GIcon&gt; icon = adoptGRef(g_themed_icon_new(iconName));</span>
<span class="line-removed">-     unsigned lookupFlags = GTK_ICON_LOOKUP_USE_BUILTIN | GTK_ICON_LOOKUP_FORCE_SIZE | GTK_ICON_LOOKUP_FORCE_SVG;</span>
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 14, 0)</span>
<span class="line-removed">-     GtkTextDirection direction = gtk_style_context_get_direction(context);</span>
<span class="line-removed">-     if (direction &amp; GTK_TEXT_DIR_LTR)</span>
<span class="line-removed">-         lookupFlags |= GTK_ICON_LOOKUP_DIR_LTR;</span>
<span class="line-removed">-     else if (direction &amp; GTK_TEXT_DIR_RTL)</span>
<span class="line-removed">-         lookupFlags |= GTK_ICON_LOOKUP_DIR_RTL;</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     int width, height;</span>
<span class="line-removed">-     gtk_icon_size_lookup(iconSize, &amp;width, &amp;height);</span>
<span class="line-removed">-     GRefPtr&lt;GtkIconInfo&gt; iconInfo = adoptGRef(gtk_icon_theme_lookup_by_gicon(gtk_icon_theme_get_default(), icon.get(), std::min(width, height), static_cast&lt;GtkIconLookupFlags&gt;(lookupFlags)));</span>
<span class="line-removed">-     if (!iconInfo)</span>
<span class="line-removed">-         return nullptr;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return adoptGRef(gtk_icon_info_load_symbolic_for_context(iconInfo.get(), context, nullptr, nullptr));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // !GTK_CHECK_VERSION(3, 20, 0)</span>
<span class="line-removed">- </span>
  #if ENABLE(VIDEO)
  static bool nodeHasPseudo(Node&amp; node, const char* pseudo)
  {
      return is&lt;Element&gt;(node) &amp;&amp; downcast&lt;Element&gt;(node).pseudo() == pseudo;
  }
<span class="line-new-header">--- 146,13 ---</span>
      SpinButtonUpButton,
      SpinButtonDownButton,
  #if ENABLE(VIDEO)
      MediaButton,
  #endif
<span class="line-added">+     Window,</span>
  };
  
  #if ENABLE(VIDEO)
  static bool nodeHasPseudo(Node&amp; node, const char* pseudo)
  {
      return is&lt;Element&gt;(node) &amp;&amp; downcast&lt;Element&gt;(node).pseudo() == pseudo;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 352,11 ***</span>
      if (box.style().appearance() == CheckboxPart || box.style().appearance() == RadioPart)
          return box.marginTop() + box.height() - 2;
      return RenderTheme::baselinePosition(box);
  }
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  void RenderThemeGtk::adjustRepaintRect(const RenderObject&amp;, FloatRect&amp;)
  {
  }
  static GtkStateFlags themePartStateFlags(const RenderThemeGtk&amp; theme, RenderThemePart themePart, const RenderObject&amp; renderObject)
  {
<span class="line-new-header">--- 208,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 416,86 ***</span>
          break;
      }
  
      return static_cast&lt;GtkStateFlags&gt;(stateFlags);
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- static GtkTextDirection gtkTextDirection(TextDirection direction)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     switch (direction) {</span>
<span class="line-removed">-     case TextDirection::RTL:</span>
<span class="line-removed">-         return GTK_TEXT_DIR_RTL;</span>
<span class="line-removed">-     case TextDirection::LTR:</span>
<span class="line-removed">-         return GTK_TEXT_DIR_LTR;</span>
<span class="line-removed">-     default:</span>
<span class="line-removed">-         return GTK_TEXT_DIR_NONE;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static GtkStateFlags gtkIconStateFlags(RenderTheme* theme, const RenderObject&amp; renderObject)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     if (!theme-&gt;isEnabled(renderObject))</span>
<span class="line-removed">-         return GTK_STATE_FLAG_INSENSITIVE;</span>
<span class="line-removed">-     if (theme-&gt;isPressed(renderObject))</span>
<span class="line-removed">-         return GTK_STATE_FLAG_ACTIVE;</span>
<span class="line-removed">-     if (theme-&gt;isHovered(renderObject))</span>
<span class="line-removed">-         return GTK_STATE_FLAG_PRELIGHT;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return GTK_STATE_FLAG_NORMAL;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void adjustRectForFocus(GtkStyleContext* context, FloatRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     gint focusWidth, focusPad;</span>
<span class="line-removed">-     gtk_style_context_get_style(context, &quot;focus-line-width&quot;, &amp;focusWidth, &quot;focus-padding&quot;, &amp;focusPad, nullptr);</span>
<span class="line-removed">-     rect.inflate(focusWidth + focusPad);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void RenderThemeGtk::adjustRepaintRect(const RenderObject&amp; renderObject, FloatRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context;</span>
<span class="line-removed">-     bool checkInteriorFocus = false;</span>
<span class="line-removed">-     ControlPart part = renderObject.style().appearance();</span>
<span class="line-removed">-     switch (part) {</span>
<span class="line-removed">-     case CheckboxPart:</span>
<span class="line-removed">-     case RadioPart:</span>
<span class="line-removed">-         context = createStyleContext(part == CheckboxPart ? CheckButton : RadioButton);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         gint indicatorSpacing;</span>
<span class="line-removed">-         gtk_style_context_get_style(context.get(), &quot;indicator-spacing&quot;, &amp;indicatorSpacing, nullptr);</span>
<span class="line-removed">-         rect.inflate(indicatorSpacing);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         return;</span>
<span class="line-removed">-     case SliderVerticalPart:</span>
<span class="line-removed">-     case SliderHorizontalPart:</span>
<span class="line-removed">-         context = createStyleContext(ScaleSlider);</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case ButtonPart:</span>
<span class="line-removed">-     case MenulistButtonPart:</span>
<span class="line-removed">-     case MenulistPart:</span>
<span class="line-removed">-         context = createStyleContext(Button);</span>
<span class="line-removed">-         checkInteriorFocus = true;</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     case TextFieldPart:</span>
<span class="line-removed">-     case TextAreaPart:</span>
<span class="line-removed">-         context = createStyleContext(Entry);</span>
<span class="line-removed">-         checkInteriorFocus = true;</span>
<span class="line-removed">-         break;</span>
<span class="line-removed">-     default:</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     ASSERT(context);</span>
<span class="line-removed">-     if (checkInteriorFocus) {</span>
<span class="line-removed">-         gboolean interiorFocus;</span>
<span class="line-removed">-         gtk_style_context_get_style(context.get(), &quot;interior-focus&quot;, &amp;interiorFocus, nullptr);</span>
<span class="line-removed">-         if (interiorFocus)</span>
<span class="line-removed">-             return;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     adjustRectForFocus(context.get(), rect);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  void RenderThemeGtk::adjustButtonStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const
  {
      // Some layout tests check explicitly that buttons ignore line-height.
      if (style.appearance() == PushButtonPart)
<span class="line-new-header">--- 271,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 513,11 ***</span>
          rect.inflateY(-(rect.height() - minSize.height()) / 2);
          rect.setHeight(minSize.height()); // In case rect.height() was equal to minSize.height() + 1.
      }
  }
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  static void setToggleSize(RenderThemePart themePart, RenderStyle&amp; style)
  {
      ASSERT(themePart == CheckButton || themePart == RadioButton);
  
      // The width and height are both specified, so we shouldn&#39;t change them.
<span class="line-new-header">--- 292,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 558,79 ***</span>
      toggleWidget.toggle().render(paintInfo.context().platformContext()-&gt;cr(), rect);
  
      if (theme-&gt;isFocused(renderObject))
          toggleWidget.button().renderFocus(paintInfo.context().platformContext()-&gt;cr(), rect);
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- static void setToggleSize(RenderThemePart themePart, RenderStyle&amp; style)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // The width and height are both specified, so we shouldn&#39;t change them.</span>
<span class="line-removed">-     if (!style.width().isIntrinsicOrAuto() &amp;&amp; !style.height().isAuto())</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(themePart);</span>
<span class="line-removed">-     // Other ports hard-code this to 13. GTK+ users tend to demand the native look.</span>
<span class="line-removed">-     gint indicatorSize;</span>
<span class="line-removed">-     gtk_style_context_get_style(context.get(), &quot;indicator-size&quot;, &amp;indicatorSize, nullptr);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (style.width().isIntrinsicOrAuto())</span>
<span class="line-removed">-         style.setWidth(Length(indicatorSize, Fixed));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (style.height().isAuto())</span>
<span class="line-removed">-         style.setHeight(Length(indicatorSize, Fixed));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void paintToggle(const RenderThemeGtk* theme, RenderThemePart themePart, const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; fullRect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(themePart);</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), static_cast&lt;GtkTextDirection&gt;(gtkTextDirection(renderObject.style().direction())));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     unsigned flags = 0;</span>
<span class="line-removed">-     if (!theme-&gt;isEnabled(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_INSENSITIVE;</span>
<span class="line-removed">-     else if (theme-&gt;isHovered(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_PRELIGHT;</span>
<span class="line-removed">-     if (theme-&gt;isIndeterminate(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_INCONSISTENT;</span>
<span class="line-removed">-     else if (theme-&gt;isChecked(renderObject))</span>
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 13, 7)</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_CHECKED;</span>
<span class="line-removed">- #else</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_ACTIVE;</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     if (theme-&gt;isPressed(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_SELECTED;</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(flags));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Some themes do not render large toggle buttons properly, so we simply</span>
<span class="line-removed">-     // shrink the rectangle back down to the default size and then center it</span>
<span class="line-removed">-     // in the full toggle button region. The reason for not simply forcing toggle</span>
<span class="line-removed">-     // buttons to be a smaller size is that we don&#39;t want to break site layouts.</span>
<span class="line-removed">-     FloatRect rect(fullRect);</span>
<span class="line-removed">-     gint indicatorSize;</span>
<span class="line-removed">-     gtk_style_context_get_style(context.get(), &quot;indicator-size&quot;, &amp;indicatorSize, nullptr);</span>
<span class="line-removed">-     IntSize minSize(indicatorSize, indicatorSize);</span>
<span class="line-removed">-     shrinkToMinimumSizeAndCenterRectangle(rect, minSize);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_background(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">-     gtk_render_frame(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (themePart == CheckButton)</span>
<span class="line-removed">-         gtk_render_check(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">-     else</span>
<span class="line-removed">-         gtk_render_option(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (theme-&gt;isFocused(renderObject)) {</span>
<span class="line-removed">-         IntRect indicatorRect(rect);</span>
<span class="line-removed">-         gint indicatorSpacing;</span>
<span class="line-removed">-         gtk_style_context_get_style(context.get(), &quot;indicator-spacing&quot;, &amp;indicatorSpacing, nullptr);</span>
<span class="line-removed">-         indicatorRect.inflate(indicatorSpacing);</span>
<span class="line-removed">-         gtk_render_focus(context.get(), paintInfo.context().platformContext()-&gt;cr(), indicatorRect.x(), indicatorRect.y(),</span>
<span class="line-removed">-             indicatorRect.width(), indicatorRect.height());</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  void RenderThemeGtk::setCheckboxSize(RenderStyle&amp; style) const
  {
      setToggleSize(CheckButton, style);
  }
<span class="line-new-header">--- 336,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 650,113 ***</span>
  {
      paintToggle(this, RadioButton, renderObject, paintInfo, rect);
      return false;
  }
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  bool RenderThemeGtk::paintButton(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)
  {
      auto&amp; buttonWidget = static_cast&lt;RenderThemeButton&amp;&gt;(RenderThemeWidget::getOrCreate(isDefault(renderObject) ? RenderThemeWidget::Type::ButtonDefault : RenderThemeWidget::Type::Button));
      buttonWidget.button().setState(themePartStateFlags(*this, Button, renderObject));
      buttonWidget.button().render(paintInfo.context().platformContext()-&gt;cr(), rect);
      if (isFocused(renderObject))
          buttonWidget.button().renderFocus(paintInfo.context().platformContext()-&gt;cr(), rect);
      return false;
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- static void renderButton(RenderTheme* theme, GtkStyleContext* context, const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     IntRect buttonRect(rect);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     guint flags = 0;</span>
<span class="line-removed">-     if (!theme-&gt;isEnabled(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_INSENSITIVE;</span>
<span class="line-removed">-     else if (theme-&gt;isHovered(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_PRELIGHT;</span>
<span class="line-removed">-     if (theme-&gt;isPressed(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_ACTIVE;</span>
<span class="line-removed">-     gtk_style_context_set_state(context, static_cast&lt;GtkStateFlags&gt;(flags));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (theme-&gt;isDefault(renderObject)) {</span>
<span class="line-removed">-         GtkBorder* borderPtr = 0;</span>
<span class="line-removed">-         GtkBorder border = { 1, 1, 1, 1 };</span>
<span class="line-removed">- </span>
<span class="line-removed">-         gtk_style_context_get_style(context, &quot;default-border&quot;, &amp;borderPtr, nullptr);</span>
<span class="line-removed">-         if (borderPtr) {</span>
<span class="line-removed">-             border = *borderPtr;</span>
<span class="line-removed">-             gtk_border_free(borderPtr);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         buttonRect.move(border.left, border.top);</span>
<span class="line-removed">-         buttonRect.setWidth(buttonRect.width() - (border.left + border.right));</span>
<span class="line-removed">-         buttonRect.setHeight(buttonRect.height() - (border.top + border.bottom));</span>
<span class="line-removed">- </span>
<span class="line-removed">-         gtk_style_context_add_class(context, GTK_STYLE_CLASS_DEFAULT);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_background(context, paintInfo.context().platformContext()-&gt;cr(), buttonRect.x(), buttonRect.y(), buttonRect.width(), buttonRect.height());</span>
<span class="line-removed">-     gtk_render_frame(context, paintInfo.context().platformContext()-&gt;cr(), buttonRect.x(), buttonRect.y(), buttonRect.width(), buttonRect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (theme-&gt;isFocused(renderObject)) {</span>
<span class="line-removed">-         gint focusWidth, focusPad;</span>
<span class="line-removed">-         gboolean displaceFocus, interiorFocus;</span>
<span class="line-removed">-         gtk_style_context_get_style(</span>
<span class="line-removed">-             context,</span>
<span class="line-removed">-             &quot;focus-line-width&quot;, &amp;focusWidth,</span>
<span class="line-removed">-             &quot;focus-padding&quot;, &amp;focusPad,</span>
<span class="line-removed">-             &quot;interior-focus&quot;, &amp;interiorFocus,</span>
<span class="line-removed">-             &quot;displace-focus&quot;, &amp;displaceFocus,</span>
<span class="line-removed">-             nullptr);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         if (interiorFocus) {</span>
<span class="line-removed">-             GtkBorder borderWidth;</span>
<span class="line-removed">-             gtk_style_context_get_border(context, gtk_style_context_get_state(context), &amp;borderWidth);</span>
<span class="line-removed">- </span>
<span class="line-removed">-             buttonRect = IntRect(</span>
<span class="line-removed">-                 buttonRect.x() + borderWidth.left + focusPad,</span>
<span class="line-removed">-                 buttonRect.y() + borderWidth.top + focusPad,</span>
<span class="line-removed">-                 buttonRect.width() - (2 * focusPad + borderWidth.left + borderWidth.right),</span>
<span class="line-removed">-                 buttonRect.height() - (2 * focusPad + borderWidth.top + borderWidth.bottom));</span>
<span class="line-removed">-         } else</span>
<span class="line-removed">-             buttonRect.inflate(focusWidth + focusPad);</span>
<span class="line-removed">- </span>
<span class="line-removed">-         if (displaceFocus &amp;&amp; theme-&gt;isPressed(renderObject)) {</span>
<span class="line-removed">-             gint childDisplacementX;</span>
<span class="line-removed">-             gint childDisplacementY;</span>
<span class="line-removed">-             gtk_style_context_get_style(context, &quot;child-displacement-x&quot;, &amp;childDisplacementX, &quot;child-displacement-y&quot;, &amp;childDisplacementY, nullptr);</span>
<span class="line-removed">-             buttonRect.move(childDisplacementX, childDisplacementY);</span>
<span class="line-removed">-         }</span>
<span class="line-removed">- </span>
<span class="line-removed">-         gtk_render_focus(context, paintInfo.context().platformContext()-&gt;cr(), buttonRect.x(), buttonRect.y(), buttonRect.width(), buttonRect.height());</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- }</span>
<span class="line-removed">- bool RenderThemeGtk::paintButton(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(Button);</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), static_cast&lt;GtkTextDirection&gt;(gtkTextDirection(renderObject.style().direction())));</span>
<span class="line-removed">-     renderButton(this, context.get(), renderObject, paintInfo, rect);</span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  static Color menuListColor(const Element* element)
  {
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
      auto&amp; comboWidget = static_cast&lt;RenderThemeComboBox&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::ComboBox));
      GtkStateFlags state = element-&gt;isDisabledFormControl() ? GTK_STATE_FLAG_INSENSITIVE : GTK_STATE_FLAG_NORMAL;
      comboWidget.comboBox().setState(state);
      comboWidget.button().setState(state);
      return comboWidget.button().color();
<span class="line-removed">- #else</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentStyleContext = createStyleContext(ComboBox);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; buttonStyleContext = createStyleContext(ComboBoxButton, parentStyleContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_state(buttonStyleContext.get(), element-&gt;isDisabledFormControl() ? GTK_STATE_FLAG_INSENSITIVE : GTK_STATE_FLAG_NORMAL);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GdkRGBA gdkRGBAColor;</span>
<span class="line-removed">-     gtk_style_context_get_color(buttonStyleContext.get(), gtk_style_context_get_state(buttonStyleContext.get()), &amp;gdkRGBAColor);</span>
<span class="line-removed">-     return gdkRGBAColor;</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  }
  
  void RenderThemeGtk::adjustMenuListStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element* element) const
  {
      // The tests check explicitly that select menu buttons ignore line height.
<span class="line-new-header">--- 359,27 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 772,11 ***</span>
  void RenderThemeGtk::adjustMenuListButtonStyle(StyleResolver&amp; styleResolver, RenderStyle&amp; style, const Element* e) const
  {
      adjustMenuListStyle(styleResolver, style, e);
  }
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  /*
   * GtkComboBox gadgets tree
   *
   * combobox
   * ├── box.linked
<span class="line-new-header">--- 395,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 828,117 ***</span>
      if (isFocused(renderObject))
          comboWidget.button().renderFocus(cr, rect);
  
      return false;
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- LengthBox RenderThemeGtk::popupInternalPaddingBox(const RenderStyle&amp; style) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     if (style.appearance() == NoControlPart)</span>
<span class="line-removed">-         return { 0, 0, 0, 0 };</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentContext = createStyleContext(ComboBox);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(ComboBoxButton, parentContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), static_cast&lt;GtkTextDirection&gt;(gtkTextDirection(style.direction())));</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(0));</span>
<span class="line-removed">-     GtkBorder borderWidth = { 0, 0, 0, 0 };</span>
<span class="line-removed">-     gtk_style_context_get_border(context.get(), gtk_style_context_get_state(context.get()), &amp;borderWidth);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gboolean interiorFocus;</span>
<span class="line-removed">-     gint focusWidth, focusPad;</span>
<span class="line-removed">-     gtk_style_context_get_style(context.get(), &quot;interior-focus&quot;, &amp;interiorFocus, &quot;focus-line-width&quot;, &amp;focusWidth, &quot;focus-padding&quot;, &amp;focusPad, nullptr);</span>
<span class="line-removed">-     focusWidth = interiorFocus ? focusWidth + focusPad : 0;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return { borderWidth.top + focusWidth, borderWidth.right + focusWidth + (style.direction() == TextDirection::LTR ? minArrowSize : 0),</span>
<span class="line-removed">-         borderWidth.bottom + focusWidth, borderWidth.left + focusWidth + (style.direction() == TextDirection::RTL ? minArrowSize : 0) };</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool RenderThemeGtk::paintMenuList(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const FloatRect&amp; r)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // FIXME: adopt subpixel themes.</span>
<span class="line-removed">-     IntRect rect = IntRect(r);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     cairo_t* cairoContext = paintInfo.context().platformContext()-&gt;cr();</span>
<span class="line-removed">-     GtkTextDirection direction = static_cast&lt;GtkTextDirection&gt;(gtkTextDirection(renderObject.style().direction()));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentStyleContext = createStyleContext(ComboBox);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Paint the button.</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; buttonStyleContext = createStyleContext(ComboBoxButton, parentStyleContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_direction(buttonStyleContext.get(), direction);</span>
<span class="line-removed">-     renderButton(this, buttonStyleContext.get(), renderObject, paintInfo, rect);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Get the inner rectangle.</span>
<span class="line-removed">-     gint focusWidth, focusPad;</span>
<span class="line-removed">-     GtkBorder* innerBorderPtr = 0;</span>
<span class="line-removed">-     GtkBorder innerBorder = { 1, 1, 1, 1 };</span>
<span class="line-removed">-     gtk_style_context_get_style(buttonStyleContext.get(), &quot;inner-border&quot;, &amp;innerBorderPtr, &quot;focus-line-width&quot;, &amp;focusWidth, &quot;focus-padding&quot;, &amp;focusPad, nullptr);</span>
<span class="line-removed">-     if (innerBorderPtr) {</span>
<span class="line-removed">-         innerBorder = *innerBorderPtr;</span>
<span class="line-removed">-         gtk_border_free(innerBorderPtr);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GtkBorder borderWidth;</span>
<span class="line-removed">-     GtkStateFlags state = gtk_style_context_get_state(buttonStyleContext.get());</span>
<span class="line-removed">-     gtk_style_context_get_border(buttonStyleContext.get(), state, &amp;borderWidth);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     focusWidth += focusPad;</span>
<span class="line-removed">-     IntRect innerRect(</span>
<span class="line-removed">-         rect.x() + innerBorder.left + borderWidth.left + focusWidth,</span>
<span class="line-removed">-         rect.y() + innerBorder.top + borderWidth.top + focusWidth,</span>
<span class="line-removed">-         rect.width() - borderWidth.left - borderWidth.right - innerBorder.left - innerBorder.right - (2 * focusWidth),</span>
<span class="line-removed">-         rect.height() - borderWidth.top - borderWidth.bottom - innerBorder.top - innerBorder.bottom - (2 * focusWidth));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (isPressed(renderObject)) {</span>
<span class="line-removed">-         gint childDisplacementX;</span>
<span class="line-removed">-         gint childDisplacementY;</span>
<span class="line-removed">-         gtk_style_context_get_style(buttonStyleContext.get(), &quot;child-displacement-x&quot;, &amp;childDisplacementX, &quot;child-displacement-y&quot;, &amp;childDisplacementY, nullptr);</span>
<span class="line-removed">-         innerRect.move(childDisplacementX, childDisplacementY);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     innerRect.setWidth(std::max(1, innerRect.width()));</span>
<span class="line-removed">-     innerRect.setHeight(std::max(1, innerRect.height()));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Paint the arrow.</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; arrowStyleContext = createStyleContext(ComboBoxArrow, buttonStyleContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_direction(arrowStyleContext.get(), direction);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gfloat arrowScaling;</span>
<span class="line-removed">-     gtk_style_context_get_style(parentStyleContext.get(), &quot;arrow-scaling&quot;, &amp;arrowScaling, nullptr);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     IntSize arrowSize(minArrowSize, innerRect.height());</span>
<span class="line-removed">-     FloatPoint arrowPosition(innerRect.location());</span>
<span class="line-removed">-     if (direction == GTK_TEXT_DIR_LTR)</span>
<span class="line-removed">-         arrowPosition.move(innerRect.width() - arrowSize.width(), 0);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // GTK+ actually fetches the xalign and valign values from the widget, but since we</span>
<span class="line-removed">-     // don&#39;t have a widget here, we are just using the default xalign and valign values of 0.5.</span>
<span class="line-removed">-     gint extent = std::min(arrowSize.width(), arrowSize.height()) * arrowScaling;</span>
<span class="line-removed">-     arrowPosition.move((arrowSize.width() - extent) / 2, (arrowSize.height() - extent) / 2);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_style_context_set_state(arrowStyleContext.get(), state);</span>
<span class="line-removed">-     gtk_render_arrow(arrowStyleContext.get(), cairoContext, G_PI, arrowPosition.x(), arrowPosition.y(), extent);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  bool RenderThemeGtk::paintMenuListButtonDecorations(const RenderBox&amp; object, const PaintInfo&amp; info, const FloatRect&amp; rect)
  {
      return paintMenuList(object, info, rect);
  }
  
<span class="line-removed">- bool RenderThemeGtk::isControlStyled(const RenderStyle&amp; style, const BorderData&amp; border, const FillLayer&amp; background, const Color&amp; backgroundColor) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     // To avoid rendering issues with dark themes, if text input elements have color styling, we don&#39;t style them with GTK.</span>
<span class="line-removed">-     if ((style.appearance() == TextFieldPart || style.appearance() == TextAreaPart || style.appearance() == SearchFieldPart) &amp;&amp; style.color() != RenderStyle::initialColor())</span>
<span class="line-removed">-         return true;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return RenderTheme::isControlStyled(style, border, background, backgroundColor);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
<span class="line-removed">- </span>
  static IntSize spinButtonSize()
  {
      auto&amp; spinButtonWidget = static_cast&lt;RenderThemeSpinButton&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::SpinButton));
      spinButtonWidget.spinButton().setState(GTK_STATE_FLAG_NORMAL);
      spinButtonWidget.entry().setState(GTK_STATE_FLAG_NORMAL);
<span class="line-new-header">--- 450,16 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 961,11 ***</span>
  
      style.setMinHeight(Length(spinButtonSize().height(), Fixed));
  
      // The default theme for the GTK+ port uses very wide spin buttons (66px) compared to what other
      // browsers use (~13 px). And unfortunately, most of the web developers won&#39;t test how their site
<span class="line-modified">!     // renders on WebKitGTK+. To ensure that spin buttons don&#39;t end up covering the values of the input</span>
      // field, we override the width of the input element and always increment it with the width needed
      // for the spinbutton (when drawing the spinbutton).
      int minimumWidth = style.width().intValue() + spinButtonSize().width();
      style.setMinWidth(Length(minimumWidth, Fixed));
  }
<span class="line-new-header">--- 482,11 ---</span>
  
      style.setMinHeight(Length(spinButtonSize().height(), Fixed));
  
      // The default theme for the GTK+ port uses very wide spin buttons (66px) compared to what other
      // browsers use (~13 px). And unfortunately, most of the web developers won&#39;t test how their site
<span class="line-modified">!     // renders on WebKitGTK. To ensure that spin buttons don&#39;t end up covering the values of the input</span>
      // field, we override the width of the input element and always increment it with the width needed
      // for the spinbutton (when drawing the spinbutton).
      int minimumWidth = style.width().intValue() + spinButtonSize().width();
      style.setMinWidth(Length(minimumWidth, Fixed));
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 981,49 ***</span>
          spinButtonWidget.entry().render(paintInfo.context().platformContext()-&gt;cr(), rect);
      } else {
          auto&amp; entryWidget = static_cast&lt;RenderThemeEntry&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::Entry));
          entryWidget.entry().setState(themePartStateFlags(*this, Entry, renderObject));
          entryWidget.entry().render(paintInfo.context().platformContext()-&gt;cr(), rect);
<span class="line-removed">-     }</span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #else</span>
<span class="line-removed">- void RenderThemeGtk::adjustTextFieldStyle(StyleResolver&amp;, RenderStyle&amp;, const Element*) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">- }</span>
  
<span class="line-modified">! bool RenderThemeGtk::paintTextField(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const FloatRect&amp; rect)</span>
<span class="line-modified">! {</span>
<span class="line-modified">!     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(Entry);</span>
<span class="line-modified">!     gtk_style_context_set_direction(context.get(), static_cast&lt;GtkTextDirection&gt;(gtkTextDirection(renderObject.style().direction())));</span>
<span class="line-modified">! </span>
<span class="line-removed">-     guint flags = 0;</span>
<span class="line-removed">-     if (!isEnabled(renderObject) || isReadOnlyControl(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_INSENSITIVE;</span>
<span class="line-removed">-     else if (isFocused(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_FOCUSED;</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(flags));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_background(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">-     gtk_render_frame(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (isFocused(renderObject) &amp;&amp; isEnabled(renderObject)) {</span>
<span class="line-removed">-         gboolean interiorFocus;</span>
<span class="line-removed">-         gint focusWidth, focusPad;</span>
<span class="line-removed">-         gtk_style_context_get_style(context.get(), &quot;interior-focus&quot;, &amp;interiorFocus, &quot;focus-line-width&quot;, &amp;focusWidth, &quot;focus-padding&quot;, &amp;focusPad, nullptr);</span>
<span class="line-removed">-         if (!interiorFocus) {</span>
<span class="line-removed">-             IntRect focusRect(rect);</span>
<span class="line-removed">-             focusRect.inflate(focusWidth + focusPad);</span>
<span class="line-removed">-             gtk_render_focus(context.get(), paintInfo.context().platformContext()-&gt;cr(), focusRect.x(), focusRect.y(), focusRect.width(), focusRect.height());</span>
          }
      }
<span class="line-removed">- </span>
      return false;
  }
<span class="line-removed">- #endif</span>
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  static void adjustSearchFieldIconStyle(RenderThemePart themePart, RenderStyle&amp; style)
  {
      ASSERT(themePart == EntryIconLeft || themePart == EntryIconRight);
      auto&amp; searchEntryWidget = static_cast&lt;RenderThemeSearchEntry&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::SearchEntry));
      searchEntryWidget.entry().setState(GTK_STATE_FLAG_NORMAL);
<span class="line-new-header">--- 502,22 ---</span>
          spinButtonWidget.entry().render(paintInfo.context().platformContext()-&gt;cr(), rect);
      } else {
          auto&amp; entryWidget = static_cast&lt;RenderThemeEntry&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::Entry));
          entryWidget.entry().setState(themePartStateFlags(*this, Entry, renderObject));
          entryWidget.entry().render(paintInfo.context().platformContext()-&gt;cr(), rect);
  
<span class="line-modified">! #if ENABLE(DATALIST_ELEMENT)</span>
<span class="line-modified">!         if (is&lt;HTMLInputElement&gt;(renderObject.generatingNode())) {</span>
<span class="line-modified">!             const auto&amp; input = downcast&lt;HTMLInputElement&gt;(*(renderObject.generatingNode()));</span>
<span class="line-modified">!             if (input.list())</span>
<span class="line-modified">!                 paintListButtonForInput(renderObject, paintInfo, rect);</span>
          }
<span class="line-added">+ #endif</span>
      }
      return false;
  }
  
  static void adjustSearchFieldIconStyle(RenderThemePart themePart, RenderStyle&amp; style)
  {
      ASSERT(themePart == EntryIconLeft || themePart == EntryIconRight);
      auto&amp; searchEntryWidget = static_cast&lt;RenderThemeSearchEntry&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::SearchEntry));
      searchEntryWidget.entry().setState(GTK_STATE_FLAG_NORMAL);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1040,59 ***</span>
      else
          preferredSize.expand(contentsBox.right, contentsBox.top + contentsBox.bottom);
      style.setWidth(Length(preferredSize.width(), Fixed));
      style.setHeight(Length(preferredSize.height(), Fixed));
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- // Defined in GTK+ (gtk/gtkiconfactory.c)</span>
<span class="line-removed">- static const gint gtkIconSizeMenu = 16;</span>
<span class="line-removed">- static const gint gtkIconSizeSmallToolbar = 18;</span>
<span class="line-removed">- static const gint gtkIconSizeButton = 20;</span>
<span class="line-removed">- static const gint gtkIconSizeLargeToolbar = 24;</span>
<span class="line-removed">- static const gint gtkIconSizeDnd = 32;</span>
<span class="line-removed">- static const gint gtkIconSizeDialog = 48;</span>
<span class="line-removed">- </span>
<span class="line-removed">- static GtkIconSize getIconSizeForPixelSize(gint pixelSize)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     if (pixelSize &lt; gtkIconSizeSmallToolbar)</span>
<span class="line-removed">-         return GTK_ICON_SIZE_MENU;</span>
<span class="line-removed">-     if (pixelSize &gt;= gtkIconSizeSmallToolbar &amp;&amp; pixelSize &lt; gtkIconSizeButton)</span>
<span class="line-removed">-         return GTK_ICON_SIZE_SMALL_TOOLBAR;</span>
<span class="line-removed">-     if (pixelSize &gt;= gtkIconSizeButton &amp;&amp; pixelSize &lt; gtkIconSizeLargeToolbar)</span>
<span class="line-removed">-         return GTK_ICON_SIZE_BUTTON;</span>
<span class="line-removed">-     if (pixelSize &gt;= gtkIconSizeLargeToolbar &amp;&amp; pixelSize &lt; gtkIconSizeDnd)</span>
<span class="line-removed">-         return GTK_ICON_SIZE_LARGE_TOOLBAR;</span>
<span class="line-removed">-     if (pixelSize &gt;= gtkIconSizeDnd &amp;&amp; pixelSize &lt; gtkIconSizeDialog)</span>
<span class="line-removed">-         return GTK_ICON_SIZE_DND;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return GTK_ICON_SIZE_DIALOG;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void adjustSearchFieldIconStyle(RenderThemePart themePart, RenderStyle&amp; style)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     style.resetBorder();</span>
<span class="line-removed">-     style.resetPadding();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentContext = createStyleContext(Entry);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(themePart, parentContext.get());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GtkBorder padding;</span>
<span class="line-removed">-     gtk_style_context_get_padding(context.get(), gtk_style_context_get_state(context.get()), &amp;padding);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Get the icon size based on the font size.</span>
<span class="line-removed">-     int fontSize = style.computedFontPixelSize();</span>
<span class="line-removed">-     if (fontSize &lt; gtkIconSizeMenu) {</span>
<span class="line-removed">-         style.setWidth(Length(fontSize + (padding.left + padding.right), Fixed));</span>
<span class="line-removed">-         style.setHeight(Length(fontSize + (padding.top + padding.bottom), Fixed));</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     gint width = 0, height = 0;</span>
<span class="line-removed">-     gtk_icon_size_lookup(getIconSizeForPixelSize(fontSize), &amp;width, &amp;height);</span>
<span class="line-removed">-     style.setWidth(Length(width + (padding.left + padding.right), Fixed));</span>
<span class="line-removed">-     style.setHeight(Length(height + (padding.top + padding.bottom), Fixed));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif</span>
  
  bool RenderThemeGtk::paintTextArea(const RenderObject&amp; o, const PaintInfo&amp; i, const FloatRect&amp; r)
  {
      return paintTextField(o, i, r);
  }
<span class="line-new-header">--- 534,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1115,11 ***</span>
  void RenderThemeGtk::adjustSearchFieldCancelButtonStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const
  {
      adjustSearchFieldIconStyle(EntryIconRight, style);
  }
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  static bool paintSearchFieldIcon(RenderThemeGtk* theme, RenderThemePart themePart, const RenderBox&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)
  {
      ASSERT(themePart == EntryIconLeft || themePart == EntryIconRight);
      auto&amp; searchEntryWidget = static_cast&lt;RenderThemeSearchEntry&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::SearchEntry));
      searchEntryWidget.entry().setState(themePartStateFlags(*theme, Entry, renderObject));
<span class="line-new-header">--- 560,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1142,76 ***</span>
  
  bool RenderThemeGtk::paintSearchFieldCancelButton(const RenderBox&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)
  {
      return paintSearchFieldIcon(this, EntryIconRight, renderObject, paintInfo, rect);
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- static bool paintIcon(GtkStyleContext* context, GraphicsContext&amp; graphicsContext, const IntRect&amp; rect, const char* iconName)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GdkPixbuf&gt; icon = loadThemedIcon(context, iconName, getIconSizeForPixelSize(rect.height()));</span>
<span class="line-removed">-     if (!icon)</span>
<span class="line-removed">-         return false;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (gdk_pixbuf_get_width(icon.get()) &gt; rect.width() || gdk_pixbuf_get_height(icon.get()) &gt; rect.height())</span>
<span class="line-removed">-         icon = adoptGRef(gdk_pixbuf_scale_simple(icon.get(), rect.width(), rect.height(), GDK_INTERP_BILINEAR));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_icon(context, graphicsContext.platformContext()-&gt;cr(), icon.get(), rect.x(), rect.y());</span>
<span class="line-removed">-     return true;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static bool paintEntryIcon(RenderThemePart themePart, const char* iconName, GraphicsContext&amp; graphicsContext, const IntRect&amp; rect, GtkTextDirection direction, GtkStateFlags state)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentContext = createStyleContext(Entry);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(themePart, parentContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), direction);</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), state);</span>
<span class="line-removed">-     return paintIcon(context.get(), graphicsContext, rect, iconName);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static IntRect centerRectVerticallyInParentInputElement(const RenderObject&amp; renderObject, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     if (!renderObject.node())</span>
<span class="line-removed">-         return IntRect();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Get the renderer of &lt;input&gt; element.</span>
<span class="line-removed">-     Node* input = renderObject.node()-&gt;shadowHost();</span>
<span class="line-removed">-     if (!input)</span>
<span class="line-removed">-         input = renderObject.node();</span>
<span class="line-removed">-     if (!is&lt;RenderBox&gt;(*input-&gt;renderer()))</span>
<span class="line-removed">-         return IntRect();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // If possible center the y-coordinate of the rect vertically in the parent input element.</span>
<span class="line-removed">-     // We also add one pixel here to ensure that the y coordinate is rounded up for box heights</span>
<span class="line-removed">-     // that are even, which looks in relation to the box text.</span>
<span class="line-removed">-     IntRect inputContentBox = downcast&lt;RenderBox&gt;(*input-&gt;renderer()).absoluteContentBox();</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Make sure the scaled decoration stays square and will fit in its parent&#39;s box.</span>
<span class="line-removed">-     int iconSize = std::min(inputContentBox.width(), std::min(inputContentBox.height(), rect.height()));</span>
<span class="line-removed">-     IntRect scaledRect(rect.x(), inputContentBox.y() + (inputContentBox.height() - iconSize + 1) / 2, iconSize, iconSize);</span>
<span class="line-removed">-     return scaledRect;</span>
<span class="line-removed">- }</span>
  
<span class="line-modified">! bool RenderThemeGtk::paintSearchFieldResultsDecorationPart(const RenderBox&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
  {
<span class="line-modified">!     IntRect iconRect = centerRectVerticallyInParentInputElement(renderObject, rect);</span>
<span class="line-modified">!     if (iconRect.isEmpty())</span>
<span class="line-modified">!         return true;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     return !paintEntryIcon(EntryIconLeft, &quot;edit-find-symbolic&quot;, paintInfo.context(), iconRect, gtkTextDirection(renderObject.style().direction()),</span>
<span class="line-removed">-         gtkIconStateFlags(this, renderObject));</span>
  }
  
<span class="line-modified">! bool RenderThemeGtk::paintSearchFieldCancelButton(const RenderBox&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
  {
<span class="line-modified">!     IntRect iconRect = centerRectVerticallyInParentInputElement(renderObject, rect);</span>
<span class="line-modified">!     if (iconRect.isEmpty())</span>
<span class="line-modified">!         return true;</span>
  
<span class="line-modified">!     return !paintEntryIcon(EntryIconRight, &quot;edit-clear-symbolic&quot;, paintInfo.context(), iconRect, gtkTextDirection(renderObject.style().direction()),</span>
<span class="line-modified">!         gtkIconStateFlags(this, renderObject));</span>
  }
<span class="line-modified">! #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  void RenderThemeGtk::adjustSearchFieldStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const
  {
      // We cannot give a proper rendering when border radius is active, unfortunately.
      style.resetBorderRadius();
<span class="line-new-header">--- 586,38 ---</span>
  
  bool RenderThemeGtk::paintSearchFieldCancelButton(const RenderBox&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)
  {
      return paintSearchFieldIcon(this, EntryIconRight, renderObject, paintInfo, rect);
  }
  
<span class="line-modified">! #if ENABLE(DATALIST_ELEMENT)</span>
<span class="line-added">+ void RenderThemeGtk::adjustListButtonStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const</span>
  {
<span class="line-modified">!     // Add a margin to place the button at end of the input field.</span>
<span class="line-modified">!     if (style.isLeftToRightDirection())</span>
<span class="line-modified">!         style.setMarginRight(Length(-4, Fixed));</span>
<span class="line-modified">!     else</span>
<span class="line-modified">!         style.setMarginLeft(Length(-4, Fixed));</span>
  }
  
<span class="line-modified">! void RenderThemeGtk::paintListButtonForInput(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const FloatRect&amp; rect)</span>
  {
<span class="line-modified">!     // Use a combo box widget to render its arrow.</span>
<span class="line-modified">!     auto&amp; comboWidget = static_cast&lt;RenderThemeComboBox&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::ComboBox));</span>
<span class="line-modified">!     comboWidget.arrow().setState(themePartStateFlags(*this, ComboBoxButton, renderObject));</span>
  
<span class="line-modified">!     // But a search entry widget to get the contents rect, since this is a text input field.</span>
<span class="line-modified">!     auto&amp; searchEntryWidget = static_cast&lt;RenderThemeSearchEntry&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::SearchEntry));</span>
<span class="line-added">+     auto&amp; icon = static_cast&lt;RenderThemeIconGadget&amp;&gt;(searchEntryWidget.rightIcon());</span>
<span class="line-added">+     icon.setIconSize(comboWidget.arrow().preferredSize().width());</span>
<span class="line-added">+     GtkBorder contentsBox = searchEntryWidget.entry().contentsBox();</span>
<span class="line-added">+     FloatRect adjustedRect(rect);</span>
<span class="line-added">+     adjustedRect.move(contentsBox.left, contentsBox.top);</span>
<span class="line-added">+     adjustedRect.contract(contentsBox.right + 1, contentsBox.top + contentsBox.bottom);</span>
<span class="line-added">+     comboWidget.arrow().render(paintInfo.context().platformContext()-&gt;cr(), adjustedRect);</span>
  }
<span class="line-modified">! #endif</span>
  
  void RenderThemeGtk::adjustSearchFieldStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const
  {
      // We cannot give a proper rendering when border radius is active, unfortunately.
      style.resetBorderRadius();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1237,11 ***</span>
  {
      RenderTheme::adjustSliderThumbStyle(styleResolver, style, element);
      style.setBoxShadow(nullptr);
  }
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  /*
   * GtkScale
   *
   * scale
   * ╰── contents
<span class="line-new-header">--- 643,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1365,102 ***</span>
      sliderRect.move(padding.left, padding.top);
      sliderRect.contract(padding.left + padding.right, padding.top + padding.bottom);
      slider.render(paintInfo.context().platformContext()-&gt;cr(), sliderRect);
      return false;
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- bool RenderThemeGtk::paintSliderTrack(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     ControlPart part = renderObject.style().appearance();</span>
<span class="line-removed">-     ASSERT(part == SliderHorizontalPart || part == SliderVerticalPart);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentContext = createStyleContext(Scale);</span>
<span class="line-removed">-     gtk_style_context_add_class(parentContext.get(), part == SliderHorizontalPart ? GTK_STYLE_CLASS_HORIZONTAL : GTK_STYLE_CLASS_VERTICAL);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(ScaleTrough, parentContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), gtkTextDirection(renderObject.style().direction()));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (!isEnabled(renderObject))</span>
<span class="line-removed">-         gtk_style_context_set_state(context.get(), GTK_STATE_FLAG_INSENSITIVE);</span>
  
<span class="line-removed">-     IntRect sliderRect = rect;</span>
<span class="line-removed">-     // GTK+ uses the slider thumb size and margins to calculate the trough size, but in WebKit we render the thumb and</span>
<span class="line-removed">-     // the slider track separately and the track rectangle we receive here can&#39;t be used to apply the GTK+ CSS sizes</span>
<span class="line-removed">-     // and margins. So we use a maximum fixed size for the trough to match at least Adwaita, but that should look</span>
<span class="line-removed">-     // good in other themes as well.</span>
<span class="line-removed">-     static const int sliderSize = 4;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (part == SliderHorizontalPart) {</span>
<span class="line-removed">-         sliderRect.setHeight(std::min(rect.height(), sliderSize));</span>
<span class="line-removed">-         sliderRect.move(0, (rect.height() - sliderRect.height()) / 2);</span>
<span class="line-removed">-     } else {</span>
<span class="line-removed">-         sliderRect.setWidth(std::min(rect.width(), sliderSize));</span>
<span class="line-removed">-         sliderRect.move((rect.width() - sliderRect.width()) / 2, 0);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_background(context.get(), paintInfo.context().platformContext()-&gt;cr(), sliderRect.x(), sliderRect.y(), sliderRect.width(), sliderRect.height());</span>
<span class="line-removed">-     gtk_render_frame(context.get(), paintInfo.context().platformContext()-&gt;cr(), sliderRect.x(), sliderRect.y(), sliderRect.width(), sliderRect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (isFocused(renderObject)) {</span>
<span class="line-removed">-         gint focusWidth, focusPad;</span>
<span class="line-removed">-         gtk_style_context_get_style(context.get(), &quot;focus-line-width&quot;, &amp;focusWidth, &quot;focus-padding&quot;, &amp;focusPad, nullptr);</span>
<span class="line-removed">-         IntRect focusRect(sliderRect);</span>
<span class="line-removed">-         focusRect.inflate(focusWidth + focusPad);</span>
<span class="line-removed">-         gtk_render_focus(context.get(), paintInfo.context().platformContext()-&gt;cr(), focusRect.x(), focusRect.y(), focusRect.width(), focusRect.height());</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void RenderThemeGtk::adjustSliderThumbSize(RenderStyle&amp; style, const Element*) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     ControlPart part = style.appearance();</span>
<span class="line-removed">-     if (part != SliderThumbHorizontalPart &amp;&amp; part != SliderThumbVerticalPart)</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(Scale);</span>
<span class="line-removed">-     gint sliderWidth, sliderLength;</span>
<span class="line-removed">-     gtk_style_context_get_style(context.get(), &quot;slider-width&quot;, &amp;sliderWidth, &quot;slider-length&quot;, &amp;sliderLength, nullptr);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (part == SliderThumbHorizontalPart) {</span>
<span class="line-removed">-         style.setWidth(Length(sliderLength, Fixed));</span>
<span class="line-removed">-         style.setHeight(Length(sliderWidth, Fixed));</span>
<span class="line-removed">-         return;</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     ASSERT(part == SliderThumbVerticalPart);</span>
<span class="line-removed">-     style.setWidth(Length(sliderWidth, Fixed));</span>
<span class="line-removed">-     style.setHeight(Length(sliderLength, Fixed));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool RenderThemeGtk::paintSliderThumb(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     ControlPart part = renderObject.style().appearance();</span>
<span class="line-removed">-     ASSERT(part == SliderThumbHorizontalPart || part == SliderThumbVerticalPart);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // FIXME: The entire slider is too wide, stretching the thumb into an oval rather than a circle.</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentContext = createStyleContext(Scale);</span>
<span class="line-removed">-     gtk_style_context_add_class(parentContext.get(), part == SliderThumbHorizontalPart ? GTK_STYLE_CLASS_HORIZONTAL : GTK_STYLE_CLASS_VERTICAL);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; troughContext = createStyleContext(ScaleTrough, parentContext.get());</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(ScaleSlider, troughContext.get());</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), gtkTextDirection(renderObject.style().direction()));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     guint flags = 0;</span>
<span class="line-removed">-     if (!isEnabled(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_INSENSITIVE;</span>
<span class="line-removed">-     else if (isHovered(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_PRELIGHT;</span>
<span class="line-removed">-     if (isPressed(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_ACTIVE;</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(flags));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_slider(context.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height(),</span>
<span class="line-removed">-         part == SliderThumbHorizontalPart ? GTK_ORIENTATION_HORIZONTAL : GTK_ORIENTATION_VERTICAL);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">- </span>
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  IntRect RenderThemeGtk::progressBarRectForBounds(const RenderObject&amp; renderObject, const IntRect&amp; bounds) const
  {
      const auto&amp; renderProgress = downcast&lt;RenderProgress&gt;(renderObject);
      auto&amp; progressBarWidget = static_cast&lt;RenderThemeProgressBar&amp;&gt;(RenderThemeWidget::getOrCreate(renderProgress.isDeterminate() ? RenderThemeProgressBar::Type::ProgressBar : RenderThemeProgressBar::Type::IndeterminateProgressBar));
      IntSize preferredSize = progressBarWidget.progressBar().preferredSize();
<span class="line-new-header">--- 770,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1479,53 ***</span>
      progressBarWidget.progressBar().render(paintInfo.context().platformContext()-&gt;cr(), rect);
      progressBarWidget.trough().render(paintInfo.context().platformContext()-&gt;cr(), rect);
      progressBarWidget.progress().render(paintInfo.context().platformContext()-&gt;cr(), calculateProgressRect(renderObject, rect));
      return false;
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- IntRect RenderThemeGtk::progressBarRectForBounds(const RenderObject&amp;, const IntRect&amp; bounds) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return bounds;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool RenderThemeGtk::paintProgressBar(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     if (!renderObject.isProgress())</span>
<span class="line-removed">-         return true;</span>
  
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; parentContext = createStyleContext(ProgressBar);</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; troughContext = createStyleContext(ProgressBarTrough, parentContext.get());</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(ProgressBarProgress, troughContext.get());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_background(troughContext.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">-     gtk_render_frame(troughContext.get(), paintInfo.context().platformContext()-&gt;cr(), rect.x(), rect.y(), rect.width(), rect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(0));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GtkBorder padding;</span>
<span class="line-removed">-     gtk_style_context_get_padding(context.get(), gtk_style_context_get_state(context.get()), &amp;padding);</span>
<span class="line-removed">-     IntRect progressRect(</span>
<span class="line-removed">-         rect.x() + padding.left,</span>
<span class="line-removed">-         rect.y() + padding.top,</span>
<span class="line-removed">-         rect.width() - (padding.left + padding.right),</span>
<span class="line-removed">-         rect.height() - (padding.top + padding.bottom));</span>
<span class="line-removed">-     progressRect = RenderThemeGtk::calculateProgressRect(renderObject, progressRect);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     if (!progressRect.isEmpty()) {</span>
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 13, 7)</span>
<span class="line-removed">-         gtk_render_background(context.get(), paintInfo.context().platformContext()-&gt;cr(), progressRect.x(), progressRect.y(), progressRect.width(), progressRect.height());</span>
<span class="line-removed">-         gtk_render_frame(context.get(), paintInfo.context().platformContext()-&gt;cr(), progressRect.x(), progressRect.y(), progressRect.width(), progressRect.height());</span>
<span class="line-removed">- #else</span>
<span class="line-removed">-         gtk_render_activity(context.get(), paintInfo.context().platformContext()-&gt;cr(), progressRect.x(), progressRect.y(), progressRect.width(), progressRect.height());</span>
<span class="line-removed">- #endif</span>
<span class="line-removed">-     }</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
<span class="line-removed">- </span>
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  RenderTheme::InnerSpinButtonLayout RenderThemeGtk::innerSpinButtonLayout(const RenderObject&amp; renderObject) const
  {
      return renderObject.style().direction() == TextDirection::RTL ? InnerSpinButtonLayout::HorizontalUpLeft : InnerSpinButtonLayout::HorizontalUpRight;
  }
  
<span class="line-new-header">--- 793,11 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1558,118 ***</span>
      else
          up.render(paintInfo.context().platformContext()-&gt;cr(), iconRect);
  
      return false;
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- RenderTheme::InnerSpinButtonLayout RenderThemeGtk::innerSpinButtonLayout(const RenderObject&amp;) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     return InnerSpinButtonLayout::Vertical;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- static gint spinButtonArrowSize(GtkStyleContext* context)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     PangoFontDescription* fontDescription;</span>
<span class="line-removed">-     gtk_style_context_get(context, gtk_style_context_get_state(context), &quot;font&quot;, &amp;fontDescription, nullptr);</span>
<span class="line-removed">-     gint fontSize = pango_font_description_get_size(fontDescription);</span>
<span class="line-removed">-     gint arrowSize = std::max(PANGO_PIXELS(fontSize), minSpinButtonArrowSize);</span>
<span class="line-removed">-     pango_font_description_free(fontDescription);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return arrowSize - arrowSize % 2; // Force even.</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- void RenderThemeGtk::adjustInnerSpinButtonStyle(StyleResolver&amp;, RenderStyle&amp; style, const Element*) const</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(SpinButton);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GtkBorder padding;</span>
<span class="line-removed">-     gtk_style_context_get_padding(context.get(), gtk_style_context_get_state(context.get()), &amp;padding);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     int width = spinButtonArrowSize(context.get()) + padding.left + padding.right;</span>
<span class="line-removed">-     style.setWidth(Length(width, Fixed));</span>
<span class="line-removed">-     style.setMinWidth(Length(width, Fixed));</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- static void paintSpinArrowButton(RenderTheme* theme, GtkStyleContext* parentContext, const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect, GtkArrowType arrowType)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     ASSERT(arrowType == GTK_ARROW_UP || arrowType == GTK_ARROW_DOWN);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(arrowType == GTK_ARROW_UP ? SpinButtonUpButton : SpinButtonDownButton, parentContext);</span>
<span class="line-removed">-     GtkTextDirection direction = gtk_style_context_get_direction(context.get());</span>
<span class="line-removed">-     guint state = static_cast&lt;guint&gt;(gtk_style_context_get_state(context.get()));</span>
<span class="line-removed">-     if (!(state &amp; GTK_STATE_FLAG_INSENSITIVE)) {</span>
<span class="line-removed">-         if (theme-&gt;isPressed(renderObject)) {</span>
<span class="line-removed">-             if ((arrowType == GTK_ARROW_UP &amp;&amp; theme-&gt;isSpinUpButtonPartPressed(renderObject))</span>
<span class="line-removed">-                 || (arrowType == GTK_ARROW_DOWN &amp;&amp; !theme-&gt;isSpinUpButtonPartPressed(renderObject)))</span>
<span class="line-removed">-                 state |= GTK_STATE_FLAG_ACTIVE;</span>
<span class="line-removed">-         } else if (theme-&gt;isHovered(renderObject)) {</span>
<span class="line-removed">-             if ((arrowType == GTK_ARROW_UP &amp;&amp; theme-&gt;isSpinUpButtonPartHovered(renderObject))</span>
<span class="line-removed">-                 || (arrowType == GTK_ARROW_DOWN &amp;&amp; !theme-&gt;isSpinUpButtonPartHovered(renderObject)))</span>
<span class="line-removed">-                 state |= GTK_STATE_FLAG_PRELIGHT;</span>
<span class="line-removed">-         }</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(state));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Paint button.</span>
<span class="line-removed">-     IntRect buttonRect(rect);</span>
<span class="line-removed">-     guint junction = gtk_style_context_get_junction_sides(context.get());</span>
<span class="line-removed">-     if (arrowType == GTK_ARROW_UP)</span>
<span class="line-removed">-         junction |= GTK_JUNCTION_BOTTOM;</span>
<span class="line-removed">-     else {</span>
<span class="line-removed">-         junction |= GTK_JUNCTION_TOP;</span>
<span class="line-removed">-         buttonRect.move(0, rect.height() / 2);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     buttonRect.setHeight(rect.height() / 2);</span>
<span class="line-removed">-     gtk_style_context_set_junction_sides(context.get(), static_cast&lt;GtkJunctionSides&gt;(junction));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gtk_render_background(context.get(), paintInfo.context().platformContext()-&gt;cr(), buttonRect.x(), buttonRect.y(), buttonRect.width(), buttonRect.height());</span>
<span class="line-removed">-     gtk_render_frame(context.get(), paintInfo.context().platformContext()-&gt;cr(), buttonRect.x(), buttonRect.y(), buttonRect.width(), buttonRect.height());</span>
<span class="line-removed">- </span>
<span class="line-removed">-     // Paint arrow centered inside button.</span>
<span class="line-removed">-     // This code is based on gtkspinbutton.c code.</span>
<span class="line-removed">-     IntRect arrowRect;</span>
<span class="line-removed">-     gdouble angle;</span>
<span class="line-removed">-     if (arrowType == GTK_ARROW_UP) {</span>
<span class="line-removed">-         angle = 0;</span>
<span class="line-removed">-         arrowRect.setY(rect.y());</span>
<span class="line-removed">-         arrowRect.setHeight(rect.height() / 2 - 2);</span>
<span class="line-removed">-     } else {</span>
<span class="line-removed">-         angle = G_PI;</span>
<span class="line-removed">-         arrowRect.setY(rect.y() + buttonRect.y());</span>
<span class="line-removed">-         arrowRect.setHeight(rect.height() - arrowRect.y() - 2);</span>
<span class="line-removed">-     }</span>
<span class="line-removed">-     arrowRect.setWidth(rect.width() - 3);</span>
<span class="line-removed">-     if (direction == GTK_TEXT_DIR_LTR)</span>
<span class="line-removed">-         arrowRect.setX(rect.x() + 1);</span>
<span class="line-removed">-     else</span>
<span class="line-removed">-         arrowRect.setX(rect.x() + 2);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     gint width = arrowRect.width() / 2;</span>
<span class="line-removed">-     width -= width % 2 - 1; // Force odd.</span>
<span class="line-removed">-     gint height = (width + 1) / 2;</span>
<span class="line-removed">- </span>
<span class="line-removed">-     arrowRect.move((arrowRect.width() - width) / 2, (arrowRect.height() - height) / 2);</span>
<span class="line-removed">-     gtk_render_arrow(context.get(), paintInfo.context().platformContext()-&gt;cr(), angle, arrowRect.x(), arrowRect.y(), width);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- </span>
<span class="line-removed">- bool RenderThemeGtk::paintInnerSpinButton(const RenderObject&amp; renderObject, const PaintInfo&amp; paintInfo, const IntRect&amp; rect)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(SpinButton);</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), gtkTextDirection(renderObject.style().direction()));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     guint flags = 0;</span>
<span class="line-removed">-     if (!isEnabled(renderObject) || isReadOnlyControl(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_INSENSITIVE;</span>
<span class="line-removed">-     else if (isFocused(renderObject))</span>
<span class="line-removed">-         flags |= GTK_STATE_FLAG_FOCUSED;</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), static_cast&lt;GtkStateFlags&gt;(flags));</span>
<span class="line-removed">- </span>
<span class="line-removed">-     paintSpinArrowButton(this, context.get(), renderObject, paintInfo, rect, GTK_ARROW_UP);</span>
<span class="line-removed">-     paintSpinArrowButton(this, context.get(), renderObject, paintInfo, rect, GTK_ARROW_DOWN);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     return false;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  Seconds RenderThemeGtk::caretBlinkInterval() const
  {
      GtkSettings* settings = gtk_settings_get_default();
  
<span class="line-new-header">--- 830,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1684,11 ***</span>
      return 500_us * time;
  }
  
  enum StyleColorType { StyleColorBackground, StyleColorForeground };
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  static Color styleColor(RenderThemePart themePart, GtkStateFlags state, StyleColorType colorType)
  {
      RenderThemeGadget* gadget = nullptr;
      switch (themePart) {
      default:
<span class="line-new-header">--- 848,10 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1704,30 ***</span>
          gadget = &amp;static_cast&lt;RenderThemeListView&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::ListView)).treeview();
          break;
      case Button:
          gadget = &amp;static_cast&lt;RenderThemeButton&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::Button)).button();
          break;
      }
  
      ASSERT(gadget);
      gadget-&gt;setState(state);
      return colorType == StyleColorBackground ? gadget-&gt;backgroundColor() : gadget-&gt;color();
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- static Color styleColor(RenderThemePart themePart, GtkStateFlags state, StyleColorType colorType)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(themePart);</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), state);</span>
<span class="line-removed">- </span>
<span class="line-removed">-     GdkRGBA gdkRGBAColor;</span>
<span class="line-removed">-     if (colorType == StyleColorBackground)</span>
<span class="line-removed">-         gtk_style_context_get_background_color(context.get(), state, &amp;gdkRGBAColor);</span>
<span class="line-removed">-     else</span>
<span class="line-removed">-         gtk_style_context_get_color(context.get(), state, &amp;gdkRGBAColor);</span>
<span class="line-removed">-     return gdkRGBAColor;</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  Color RenderThemeGtk::platformActiveSelectionBackgroundColor(OptionSet&lt;StyleColor::Options&gt;) const
  {
      return styleColor(EntrySelection, static_cast&lt;GtkStateFlags&gt;(GTK_STATE_FLAG_SELECTED | GTK_STATE_FLAG_FOCUSED), StyleColorBackground);
  }
<span class="line-new-header">--- 867,19 ---</span>
          gadget = &amp;static_cast&lt;RenderThemeListView&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::ListView)).treeview();
          break;
      case Button:
          gadget = &amp;static_cast&lt;RenderThemeButton&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::Button)).button();
          break;
<span class="line-added">+     case Window:</span>
<span class="line-added">+         gadget = &amp;static_cast&lt;RenderThemeWindow&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::Window)).window();</span>
<span class="line-added">+         break;</span>
      }
  
      ASSERT(gadget);
      gadget-&gt;setState(state);
      return colorType == StyleColorBackground ? gadget-&gt;backgroundColor() : gadget-&gt;color();
  }
  
  Color RenderThemeGtk::platformActiveSelectionBackgroundColor(OptionSet&lt;StyleColor::Options&gt;) const
  {
      return styleColor(EntrySelection, static_cast&lt;GtkStateFlags&gt;(GTK_STATE_FLAG_SELECTED | GTK_STATE_FLAG_FOCUSED), StyleColorBackground);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1765,20 ***</span>
  Color RenderThemeGtk::platformInactiveListBoxSelectionForegroundColor(OptionSet&lt;StyleColor::Options&gt;) const
  {
      return styleColor(ListBox, GTK_STATE_FLAG_SELECTED, StyleColorForeground);
  }
  
  Color RenderThemeGtk::systemColor(CSSValueID cssValueId, OptionSet&lt;StyleColor::Options&gt; options) const
  {
      switch (cssValueId) {
      case CSSValueButtontext:
          return styleColor(Button, GTK_STATE_FLAG_ACTIVE, StyleColorForeground);
      case CSSValueCaptiontext:
          return styleColor(Entry, GTK_STATE_FLAG_ACTIVE, StyleColorForeground);
      default:
<span class="line-modified">!         return RenderTheme::systemColor(cssValueId, options);</span>
      }
  }
  
  void RenderThemeGtk::platformColorsDidChange()
  {
      RenderTheme::platformColorsDidChange();
<span class="line-new-header">--- 917,31 ---</span>
  Color RenderThemeGtk::platformInactiveListBoxSelectionForegroundColor(OptionSet&lt;StyleColor::Options&gt;) const
  {
      return styleColor(ListBox, GTK_STATE_FLAG_SELECTED, StyleColorForeground);
  }
  
<span class="line-added">+ Color RenderThemeGtk::disabledTextColor(const Color&amp;, const Color&amp;) const</span>
<span class="line-added">+ {</span>
<span class="line-added">+     return styleColor(Entry, GTK_STATE_FLAG_INSENSITIVE, StyleColorForeground);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
  Color RenderThemeGtk::systemColor(CSSValueID cssValueId, OptionSet&lt;StyleColor::Options&gt; options) const
  {
      switch (cssValueId) {
      case CSSValueButtontext:
          return styleColor(Button, GTK_STATE_FLAG_ACTIVE, StyleColorForeground);
      case CSSValueCaptiontext:
          return styleColor(Entry, GTK_STATE_FLAG_ACTIVE, StyleColorForeground);
<span class="line-added">+     case CSSValueText:</span>
<span class="line-added">+         return styleColor(Entry, GTK_STATE_FLAG_ACTIVE, StyleColorForeground);</span>
<span class="line-added">+     case CSSValueGraytext:</span>
<span class="line-added">+         return styleColor(Entry, GTK_STATE_FLAG_INSENSITIVE, StyleColorForeground);</span>
      default:
<span class="line-modified">!         break;</span>
      }
<span class="line-added">+ </span>
<span class="line-added">+     return RenderTheme::systemColor(cssValueId, options);</span>
  }
  
  void RenderThemeGtk::platformColorsDidChange()
  {
      RenderTheme::platformColorsDidChange();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1795,31 ***</span>
  {
      return String();
  }
  #endif
  
<span class="line-removed">- #if GTK_CHECK_VERSION(3, 20, 0)</span>
  bool RenderThemeGtk::paintMediaButton(const RenderObject&amp; renderObject, GraphicsContext&amp; graphicsContext, const IntRect&amp; rect, const char* iconName)
  {
      auto&amp; iconWidget = static_cast&lt;RenderThemeIcon&amp;&gt;(RenderThemeWidget::getOrCreate(RenderThemeWidget::Type::Icon));
      auto&amp; icon = static_cast&lt;RenderThemeIconGadget&amp;&gt;(iconWidget.icon());
      icon.setState(themePartStateFlags(*this, MediaButton, renderObject));
      icon.setIconSize(RenderThemeIconGadget::IconSizeGtk::Menu);
      icon.setIconName(iconName);
      return !icon.render(graphicsContext.platformContext()-&gt;cr(), rect);
  }
<span class="line-removed">- #else</span>
<span class="line-removed">- bool RenderThemeGtk::paintMediaButton(const RenderObject&amp; renderObject, GraphicsContext&amp; graphicsContext, const IntRect&amp; rect, const char* iconName)</span>
<span class="line-removed">- {</span>
<span class="line-removed">-     GRefPtr&lt;GtkStyleContext&gt; context = createStyleContext(MediaButton);</span>
<span class="line-removed">-     gtk_style_context_set_direction(context.get(), gtkTextDirection(renderObject.style().direction()));</span>
<span class="line-removed">-     gtk_style_context_set_state(context.get(), gtkIconStateFlags(this, renderObject));</span>
<span class="line-removed">-     static const unsigned mediaIconSize = 16;</span>
<span class="line-removed">-     IntRect iconRect(rect.x() + (rect.width() - mediaIconSize) / 2, rect.y() + (rect.height() - mediaIconSize) / 2, mediaIconSize, mediaIconSize);</span>
<span class="line-removed">-     return !paintIcon(context.get(), graphicsContext, iconRect, iconName);</span>
<span class="line-removed">- }</span>
<span class="line-removed">- #endif // GTK_CHECK_VERSION(3, 20, 0)</span>
  
  bool RenderThemeGtk::hasOwnDisabledStateHandlingFor(ControlPart part) const
  {
      return (part != MediaMuteButtonPart);
  }
<span class="line-new-header">--- 958,19 ---</span>
</pre>
<hr />
<pre>
<span class="line-old-header">*** 2032,14 ***</span>
  
  #if ENABLE(VIDEO)
  String RenderThemeGtk::mediaControlsScript()
  {
      StringBuilder scriptBuilder;
<span class="line-modified">!     scriptBuilder.append(mediaControlsLocalizedStringsJavaScript, sizeof(mediaControlsLocalizedStringsJavaScript));</span>
<span class="line-modified">!     scriptBuilder.append(mediaControlsBaseJavaScript, sizeof(mediaControlsBaseJavaScript));</span>
<span class="line-modified">!     scriptBuilder.append(mediaControlsGtkJavaScript, sizeof(mediaControlsGtkJavaScript));</span>
      return scriptBuilder.toString();
  }
  #endif // ENABLE(VIDEO)
<span class="line-removed">- </span>
<span class="line-removed">- #endif // GTK_API_VERSION_2</span>
  }
<span class="line-new-header">--- 1183,12 ---</span>
  
  #if ENABLE(VIDEO)
  String RenderThemeGtk::mediaControlsScript()
  {
      StringBuilder scriptBuilder;
<span class="line-modified">!     scriptBuilder.appendCharacters(mediaControlsLocalizedStringsJavaScript, sizeof(mediaControlsLocalizedStringsJavaScript));</span>
<span class="line-modified">!     scriptBuilder.appendCharacters(mediaControlsBaseJavaScript, sizeof(mediaControlsBaseJavaScript));</span>
<span class="line-modified">!     scriptBuilder.appendCharacters(mediaControlsGtkJavaScript, sizeof(mediaControlsGtkJavaScript));</span>
      return scriptBuilder.toString();
  }
  #endif // ENABLE(VIDEO)
  }
</pre>
<center><a href="RenderTheme.h.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="RenderThemeGtk.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>