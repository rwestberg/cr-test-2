<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/accessibility/AccessibilityRenderObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AccessibilityProgressIndicator.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AccessibilityRenderObject.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/accessibility/AccessibilityRenderObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -36,10 +36,11 @@</span>
  #include &quot;AccessibilitySVGRoot.h&quot;
  #include &quot;AccessibilitySpinButton.h&quot;
  #include &quot;AccessibilityTable.h&quot;
  #include &quot;CachedImage.h&quot;
  #include &quot;Editing.h&quot;
<span class="udiff-line-added">+ #include &quot;Editor.h&quot;</span>
  #include &quot;ElementIterator.h&quot;
  #include &quot;FloatRect.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;FrameLoader.h&quot;
  #include &quot;FrameSelection.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -54,10 +55,11 @@</span>
  #include &quot;HTMLMapElement.h&quot;
  #include &quot;HTMLMeterElement.h&quot;
  #include &quot;HTMLNames.h&quot;
  #include &quot;HTMLOptionElement.h&quot;
  #include &quot;HTMLOptionsCollection.h&quot;
<span class="udiff-line-added">+ #include &quot;HTMLParserIdioms.h&quot;</span>
  #include &quot;HTMLSelectElement.h&quot;
  #include &quot;HTMLSummaryElement.h&quot;
  #include &quot;HTMLTableElement.h&quot;
  #include &quot;HTMLTextAreaElement.h&quot;
  #include &quot;HTMLVideoElement.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -575,11 +577,11 @@</span>
  String AccessibilityRenderObject::helpText() const
  {
      if (!m_renderer)
          return String();
  
<span class="udiff-line-modified-removed">-     const AtomicString&amp; ariaHelp = getAttribute(aria_helpAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; ariaHelp = getAttribute(aria_helpAttr);</span>
      if (!ariaHelp.isEmpty())
          return ariaHelp;
  
      String describedBy = ariaDescribedByAttribute();
      if (!describedBy.isEmpty())
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -587,16 +589,16 @@</span>
  
      String description = accessibilityDescription();
      for (RenderObject* ancestor = renderer(); ancestor; ancestor = ancestor-&gt;parent()) {
          if (is&lt;HTMLElement&gt;(ancestor-&gt;node())) {
              HTMLElement&amp; element = downcast&lt;HTMLElement&gt;(*ancestor-&gt;node());
<span class="udiff-line-modified-removed">-             const AtomicString&amp; summary = element.getAttribute(summaryAttr);</span>
<span class="udiff-line-modified-added">+             const AtomString&amp; summary = element.getAttribute(summaryAttr);</span>
              if (!summary.isEmpty())
                  return summary;
  
              // The title attribute should be used as help text unless it is already being used as descriptive text.
<span class="udiff-line-modified-removed">-             const AtomicString&amp; title = element.getAttribute(titleAttr);</span>
<span class="udiff-line-modified-added">+             const AtomString&amp; title = element.getAttribute(titleAttr);</span>
              if (!title.isEmpty() &amp;&amp; description != title)
                  return title;
          }
  
          // Only take help text from an ancestor element if its a group or an unknown role. If help was
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -745,11 +747,11 @@</span>
          // This has to be overridden in the case where the selected item has an ARIA label.
          HTMLSelectElement&amp; selectElement = downcast&lt;HTMLSelectElement&gt;(*m_renderer-&gt;node());
          int selectedIndex = selectElement.selectedIndex();
          const Vector&lt;HTMLElement*&gt;&amp; listItems = selectElement.listItems();
          if (selectedIndex &gt;= 0 &amp;&amp; static_cast&lt;size_t&gt;(selectedIndex) &lt; listItems.size()) {
<span class="udiff-line-modified-removed">-             const AtomicString&amp; overriddenDescription = listItems[selectedIndex]-&gt;attributeWithoutSynchronization(aria_labelAttr);</span>
<span class="udiff-line-modified-added">+             const AtomString&amp; overriddenDescription = listItems[selectedIndex]-&gt;attributeWithoutSynchronization(aria_labelAttr);</span>
              if (!overriddenDescription.isNull())
                  return overriddenDescription;
          }
          return downcast&lt;RenderMenuList&gt;(*m_renderer).text();
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -895,27 +897,51 @@</span>
      }
  
      return Path();
  }
  
<span class="udiff-line-added">+ IntPoint AccessibilityRenderObject::linkClickPoint()</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     ASSERT(isLink());</span>
<span class="udiff-line-added">+     /* A link bounding rect can contain points that are not part of the link.</span>
<span class="udiff-line-added">+      For instance, a link that starts at the end of a line and finishes at the</span>
<span class="udiff-line-added">+      beginning of the next line will have a bounding rect that includes the</span>
<span class="udiff-line-added">+      entire two lines. In such a case, the middle point of the bounding rect</span>
<span class="udiff-line-added">+      may not belong to the link element and thus may not activate the link.</span>
<span class="udiff-line-added">+      Hence, return the middle point of the first character in the link if exists.</span>
<span class="udiff-line-added">+      */</span>
<span class="udiff-line-added">+     if (RefPtr&lt;Range&gt; range = elementRange()) {</span>
<span class="udiff-line-added">+         VisiblePosition start = range-&gt;startPosition();</span>
<span class="udiff-line-added">+         VisiblePosition end = nextVisiblePosition(start);</span>
<span class="udiff-line-added">+         if (start.isNull() || !range-&gt;contains(end))</span>
<span class="udiff-line-added">+             return AccessibilityObject::clickPoint();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         RefPtr&lt;Range&gt; charRange = makeRange(start, end);</span>
<span class="udiff-line-added">+         IntRect rect = boundsForRange(charRange);</span>
<span class="udiff-line-added">+         return { rect.x() + rect.width() / 2, rect.y() + rect.height() / 2 };</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return AccessibilityObject::clickPoint();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  IntPoint AccessibilityRenderObject::clickPoint()
  {
      // Headings are usually much wider than their textual content. If the mid point is used, often it can be wrong.
<span class="udiff-line-modified-removed">-     if (isHeading() &amp;&amp; children().size() == 1)</span>
<span class="udiff-line-modified-removed">-         return children()[0]-&gt;clickPoint();</span>
<span class="udiff-line-modified-added">+     AccessibilityChildrenVector children = this-&gt;children();</span>
<span class="udiff-line-modified-added">+     if (isHeading() &amp;&amp; children.size() == 1)</span>
<span class="udiff-line-added">+         return children[0]-&gt;clickPoint();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (isLink())</span>
<span class="udiff-line-added">+         return linkClickPoint();</span>
  
      // use the default position unless this is an editable web area, in which case we use the selection bounds.
      if (!isWebArea() || !canSetValueAttribute())
          return AccessibilityObject::clickPoint();
  
      VisibleSelection visSelection = selection();
      VisiblePositionRange range = VisiblePositionRange(visSelection.visibleStart(), visSelection.visibleEnd());
      IntRect bounds = boundsForVisiblePositionRange(range);
<span class="udiff-line-modified-removed">- #if PLATFORM(COCOA)</span>
<span class="udiff-line-removed">-     bounds.setLocation(m_renderer-&gt;view().frameView().screenToContents(bounds.location()));</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     return IntPoint(bounds.x() + (bounds.width() / 2), bounds.y() - (bounds.height() / 2));</span>
<span class="udiff-line-modified-added">+     return { bounds.x() + (bounds.width() / 2), bounds.y() + (bounds.height() / 2) };</span>
  }
  
  AccessibilityObject* AccessibilityRenderObject::internalLinkElement() const
  {
      Element* element = anchorElement();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1004,33 +1030,37 @@</span>
      return ariaAccessibilityDescription().length();
  }
  
  bool AccessibilityRenderObject::hasPopup() const
  {
<span class="udiff-line-modified-removed">-     return !equalLettersIgnoringASCIICase(hasPopupValue(), &quot;false&quot;);</span>
<span class="udiff-line-modified-added">+     // Return true if this has the aria-haspopup attribute, or if it has an ancestor of type link with the aria-haspopup attribute.</span>
<span class="udiff-line-added">+     return AccessibilityObject::matchedParent(*this, true, [this] (const AccessibilityObject&amp; object) {</span>
<span class="udiff-line-added">+         return (this == &amp;object) ? !equalLettersIgnoringASCIICase(object.popupValue(), &quot;false&quot;)</span>
<span class="udiff-line-added">+             : object.isLink() &amp;&amp; !equalLettersIgnoringASCIICase(object.popupValue(), &quot;false&quot;);</span>
<span class="udiff-line-added">+     });</span>
  }
  
  bool AccessibilityRenderObject::supportsARIADropping() const
  {
<span class="udiff-line-modified-removed">-     const AtomicString&amp; dropEffect = getAttribute(aria_dropeffectAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; dropEffect = getAttribute(aria_dropeffectAttr);</span>
      return !dropEffect.isEmpty();
  }
  
  bool AccessibilityRenderObject::supportsARIADragging() const
  {
<span class="udiff-line-modified-removed">-     const AtomicString&amp; grabbed = getAttribute(aria_grabbedAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; grabbed = getAttribute(aria_grabbedAttr);</span>
      return equalLettersIgnoringASCIICase(grabbed, &quot;true&quot;) || equalLettersIgnoringASCIICase(grabbed, &quot;false&quot;);
  }
  
  bool AccessibilityRenderObject::isARIAGrabbed()
  {
      return elementAttributeValue(aria_grabbedAttr);
  }
  
  Vector&lt;String&gt; AccessibilityRenderObject::determineARIADropEffects()
  {
<span class="udiff-line-modified-removed">-     const AtomicString&amp; dropEffects = getAttribute(aria_dropeffectAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; dropEffects = getAttribute(aria_dropeffectAttr);</span>
      if (dropEffects.isEmpty()) {
          return { };
      }
  
      String dropEffectsString = dropEffects.string();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1071,10 +1101,46 @@</span>
      }
  
      return true;
  }
  
<span class="udiff-line-added">+ #if ENABLE(APPLE_PAY)</span>
<span class="udiff-line-added">+ String AccessibilityRenderObject::applePayButtonDescription() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     switch (applePayButtonType()) {</span>
<span class="udiff-line-added">+     case ApplePayButtonType::Plain:</span>
<span class="udiff-line-added">+         return AXApplePayPlainLabel();</span>
<span class="udiff-line-added">+     case ApplePayButtonType::Buy:</span>
<span class="udiff-line-added">+         return AXApplePayBuyLabel();</span>
<span class="udiff-line-added">+     case ApplePayButtonType::SetUp:</span>
<span class="udiff-line-added">+         return AXApplePaySetupLabel();</span>
<span class="udiff-line-added">+     case ApplePayButtonType::Donate:</span>
<span class="udiff-line-added">+         return AXApplePayDonateLabel();</span>
<span class="udiff-line-added">+ #if ENABLE(APPLE_PAY_SESSION_V4)</span>
<span class="udiff-line-added">+     case ApplePayButtonType::CheckOut:</span>
<span class="udiff-line-added">+         return AXApplePayCheckOutLabel();</span>
<span class="udiff-line-added">+     case ApplePayButtonType::Book:</span>
<span class="udiff-line-added">+         return AXApplePayBookLabel();</span>
<span class="udiff-line-added">+     case ApplePayButtonType::Subscribe:</span>
<span class="udiff-line-added">+         return AXApplePaySubscribeLabel();</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ void AccessibilityRenderObject::titleElementText(Vector&lt;AccessibilityText&gt;&amp; textOrder) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+ #if ENABLE(APPLE_PAY)</span>
<span class="udiff-line-added">+     if (isApplePayButton()) {</span>
<span class="udiff-line-added">+         textOrder.append(AccessibilityText(applePayButtonDescription(), AccessibilityTextSource::Alternative));</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     AccessibilityNodeObject::titleElementText(textOrder);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  AccessibilityObject* AccessibilityRenderObject::titleUIElement() const
  {
      if (!m_renderer)
          return nullptr;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1151,11 +1217,11 @@</span>
      return AccessibilityObject::defaultObjectInclusion();
  }
  
  static bool webAreaIsPresentational(RenderObject* renderer)
  {
<span class="udiff-line-modified-removed">-     if (!is&lt;RenderView&gt;(*renderer))</span>
<span class="udiff-line-modified-added">+     if (!renderer || !is&lt;RenderView&gt;(*renderer))</span>
          return false;
  
      if (auto ownerElement = renderer-&gt;document().ownerElement())
          return nodeHasPresentationRole(ownerElement);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1268,10 +1334,11 @@</span>
      case AccessibilityRole::Audio:
      case AccessibilityRole::DescriptionListTerm:
      case AccessibilityRole::DescriptionListDetail:
      case AccessibilityRole::Details:
      case AccessibilityRole::DocumentArticle:
<span class="udiff-line-added">+     case AccessibilityRole::Footer:</span>
      case AccessibilityRole::LandmarkRegion:
      case AccessibilityRole::ListItem:
      case AccessibilityRole::Time:
      case AccessibilityRole::Video:
          return false;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1439,11 +1506,11 @@</span>
      return m_renderer-&gt;page().progress().estimatedProgress();
  }
  
  int AccessibilityRenderObject::layoutCount() const
  {
<span class="udiff-line-modified-removed">-     if (!is&lt;RenderView&gt;(*m_renderer))</span>
<span class="udiff-line-modified-added">+     if (!m_renderer || !is&lt;RenderView&gt;(*m_renderer))</span>
          return 0;
      return downcast&lt;RenderView&gt;(*m_renderer).frameView().layoutContext().layoutCount();
  }
  
  String AccessibilityRenderObject::text() const
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1501,11 +1568,11 @@</span>
      }
  
      return doAXStringForRange(documentBasedSelectedTextRange());
  }
  
<span class="udiff-line-modified-removed">- const AtomicString&amp; AccessibilityRenderObject::accessKey() const</span>
<span class="udiff-line-modified-added">+ const AtomString&amp; AccessibilityRenderObject::accessKey() const</span>
  {
      Node* node = m_renderer-&gt;node();
      if (!is&lt;Element&gt;(node))
          return nullAtom();
      return downcast&lt;Element&gt;(*node).attributeWithoutSynchronization(accesskeyAttr);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1656,11 +1723,11 @@</span>
          return false;
  
      // The ARIA spec says a tab item can also be selected if it is aria-labeled by a tabpanel
      // that has keyboard focus inside of it, or if a tabpanel in its aria-controls list has KB
      // focus inside of it.
<span class="udiff-line-modified-removed">-     AccessibilityObject* focusedElement = focusedUIElement();</span>
<span class="udiff-line-modified-added">+     AccessibilityObject* focusedElement = static_cast&lt;AccessibilityObject*&gt;(focusedUIElement());</span>
      if (!focusedElement)
          return false;
  
      Vector&lt;Element*&gt; elements;
      elementsFromAttribute(elements, aria_controlsAttr);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1708,13 +1775,10 @@</span>
      return false;
  }
  
  void AccessibilityRenderObject::setFocused(bool on)
  {
<span class="udiff-line-removed">-     if (on &amp;&amp; dispatchAccessibilityEventWithType(AccessibilityEventType::Focus))</span>
<span class="udiff-line-removed">-         return;</span>
<span class="udiff-line-removed">- </span>
      if (!canSetFocusAttribute())
          return;
  
      Document* document = this-&gt;document();
      Node* node = this-&gt;node();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1761,12 +1825,10 @@</span>
  
  void AccessibilityRenderObject::setValue(const String&amp; string)
  {
      if (!m_renderer || !is&lt;Element&gt;(m_renderer-&gt;node()))
          return;
<span class="udiff-line-removed">-     if (dispatchAccessibleSetValueEvent(string))</span>
<span class="udiff-line-removed">-         return;</span>
  
      Element&amp; element = downcast&lt;Element&gt;(*m_renderer-&gt;node());
      RenderObject&amp; renderer = *m_renderer;
  
      // We should use the editor&#39;s insertText to mimic typing into the field.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1788,11 +1850,11 @@</span>
  
  bool AccessibilityRenderObject::supportsARIAOwns() const
  {
      if (!m_renderer)
          return false;
<span class="udiff-line-modified-removed">-     const AtomicString&amp; ariaOwns = getAttribute(aria_ownsAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; ariaOwns = getAttribute(aria_ownsAttr);</span>
  
      return !ariaOwns.isEmpty();
  }
  
  RenderView* AccessibilityRenderObject::topRenderer() const
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1811,11 +1873,11 @@</span>
      return &amp;m_renderer-&gt;document();
  }
  
  Widget* AccessibilityRenderObject::widget() const
  {
<span class="udiff-line-modified-removed">-     if (!is&lt;RenderWidget&gt;(*m_renderer))</span>
<span class="udiff-line-modified-added">+     if (!m_renderer || !is&lt;RenderWidget&gt;(*m_renderer))</span>
          return nullptr;
      return downcast&lt;RenderWidget&gt;(*m_renderer).widget();
  }
  
  AccessibilityObject* AccessibilityRenderObject::accessibilityParentForImageMap(HTMLMapElement* map) const
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1914,11 +1976,13 @@</span>
      VisiblePosition visiblePos = m_renderer-&gt;view().positionForPoint(IntPoint(), nullptr);
      VisiblePosition savedVisiblePos;
      while (--lineCount) {
          savedVisiblePos = visiblePos;
          visiblePos = nextLinePosition(visiblePos, 0);
<span class="udiff-line-modified-removed">-         if (visiblePos.isNull() || visiblePos == savedVisiblePos)</span>
<span class="udiff-line-modified-added">+         if (visiblePos.isNull()</span>
<span class="udiff-line-added">+             || visiblePos == savedVisiblePos</span>
<span class="udiff-line-added">+             || visiblePos.equals(savedVisiblePos))</span>
              return VisiblePositionRange();
      }
  
      // make a caret selection for the marker position, then extend it to the line
      // NOTE: ignores results of sel.modify because it returns false when
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1963,11 +2027,11 @@</span>
  
      Position indexPosition = position.deepEquivalent();
      if (indexPosition.isNull() || highestEditableRoot(indexPosition, HasEditableAXRole) != node)
          return 0;
  
<span class="udiff-line-modified-removed">- #if PLATFORM(GTK)</span>
<span class="udiff-line-modified-added">+ #if USE(ATK)</span>
      // We need to consider replaced elements for GTK, as they will be
      // presented with the &#39;object replacement character&#39; (0xFFFC).
      bool forSelectionPreservation = true;
  #else
      bool forSelectionPreservation = false;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2007,11 +2071,11 @@</span>
      }
  
      return false;
  }
  
<span class="udiff-line-modified-removed">- IntRect AccessibilityRenderObject::boundsForRects(LayoutRect&amp; rect1, LayoutRect&amp; rect2, RefPtr&lt;Range&gt; dataRange) const</span>
<span class="udiff-line-modified-added">+ IntRect AccessibilityRenderObject::boundsForRects(LayoutRect const&amp; rect1, LayoutRect const&amp; rect2, RefPtr&lt;Range&gt; const&amp; dataRange)</span>
  {
      LayoutRect ourRect = rect1;
      ourRect.unite(rect2);
  
      // if the rectangle spans lines and contains multiple text chars, use the range&#39;s bounding box intead
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2020,15 +2084,11 @@</span>
          String rangeString = plainText(dataRange.get());
          if (rangeString.length() &gt; 1 &amp;&amp; !boundingBox.isEmpty())
              ourRect = boundingBox;
      }
  
<span class="udiff-line-removed">- #if PLATFORM(MAC)</span>
<span class="udiff-line-removed">-     return m_renderer-&gt;view().frameView().contentsToScreen(snappedIntRect(ourRect));</span>
<span class="udiff-line-removed">- #else</span>
      return snappedIntRect(ourRect);
<span class="udiff-line-removed">- #endif</span>
  }
  
  IntRect AccessibilityRenderObject::boundsForVisiblePositionRange(const VisiblePositionRange&amp; visiblePositionRange) const
  {
      if (visiblePositionRange.isNull())
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2331,21 +2391,21 @@</span>
      }
  
      return nullptr;
  }
  
<span class="udiff-line-modified-removed">- AccessibilityObject* AccessibilityRenderObject::remoteSVGElementHitTest(const IntPoint&amp; point) const</span>
<span class="udiff-line-modified-added">+ AccessibilityObjectInterface* AccessibilityRenderObject::remoteSVGElementHitTest(const IntPoint&amp; point) const</span>
  {
      AccessibilityObject* remote = remoteSVGRootElement(Create);
      if (!remote)
          return nullptr;
  
      IntSize offset = point - roundedIntPoint(boundingBoxRect().location());
      return remote-&gt;accessibilityHitTest(IntPoint(offset));
  }
  
<span class="udiff-line-modified-removed">- AccessibilityObject* AccessibilityRenderObject::elementAccessibilityHitTest(const IntPoint&amp; point) const</span>
<span class="udiff-line-modified-added">+ AccessibilityObjectInterface* AccessibilityRenderObject::elementAccessibilityHitTest(const IntPoint&amp; point) const</span>
  {
      if (isSVGImage())
          return remoteSVGElementHitTest(point);
  
      return AccessibilityObject::elementAccessibilityHitTest(point);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2355,11 +2415,11 @@</span>
  {
      // We need to allow automation of mouse events on video tags.
      return shadowHost &amp;&amp; !shadowHost-&gt;hasTagName(videoTag);
  }
  
<span class="udiff-line-modified-removed">- AccessibilityObject* AccessibilityRenderObject::accessibilityHitTest(const IntPoint&amp; point) const</span>
<span class="udiff-line-modified-added">+ AccessibilityObjectInterface* AccessibilityRenderObject::accessibilityHitTest(const IntPoint&amp; point) const</span>
  {
      if (!m_renderer || !m_renderer-&gt;hasLayer())
          return nullptr;
  
      m_renderer-&gt;document().updateLayout();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2392,11 +2452,11 @@</span>
  
      AccessibilityObject* result = obj-&gt;document().axObjectCache()-&gt;getOrCreate(obj);
      result-&gt;updateChildrenIfNecessary();
  
      // Allow the element to perform any hit-testing it might need to do to reach non-render children.
<span class="udiff-line-modified-removed">-     result = result-&gt;elementAccessibilityHitTest(point);</span>
<span class="udiff-line-modified-added">+     result = static_cast&lt;AccessibilityObject*&gt;(result-&gt;elementAccessibilityHitTest(point));</span>
  
      if (result &amp;&amp; result-&gt;accessibilityIsIgnored()) {
          // If this element is the label of a control, a hit test should return the control.
          AccessibilityObject* controlObject = result-&gt;correspondingControlForLabelElement();
          if (controlObject &amp;&amp; !controlObject-&gt;exposesTitleUIElement())
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2408,11 +2468,11 @@</span>
      return result;
  }
  
  bool AccessibilityRenderObject::shouldNotifyActiveDescendant() const
  {
<span class="udiff-line-modified-removed">- #if PLATFORM(GTK)</span>
<span class="udiff-line-modified-added">+ #if USE(ATK)</span>
      // According to the Core AAM spec, ATK expects object:state-changed:focused notifications
      // whenever the active descendant changes.
      return true;
  #endif
      // We want to notify that the combo box has changed its active descendant,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2431,10 +2491,11 @@</span>
      case AccessibilityRole::Menu:
      case AccessibilityRole::MenuBar:
      case AccessibilityRole::RadioGroup:
      case AccessibilityRole::Row:
      case AccessibilityRole::PopUpButton:
<span class="udiff-line-added">+     case AccessibilityRole::Meter:</span>
      case AccessibilityRole::ProgressIndicator:
      case AccessibilityRole::Toolbar:
      case AccessibilityRole::Outline:
      case AccessibilityRole::Tree:
      case AccessibilityRole::Grid:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2454,11 +2515,11 @@</span>
  AccessibilityObject* AccessibilityRenderObject::activeDescendant() const
  {
      if (!m_renderer)
          return nullptr;
  
<span class="udiff-line-modified-removed">-     const AtomicString&amp; activeDescendantAttrStr = getAttribute(aria_activedescendantAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; activeDescendantAttrStr = getAttribute(aria_activedescendantAttr);</span>
      if (activeDescendantAttrStr.isNull() || activeDescendantAttrStr.isEmpty())
          return nullptr;
      Element* element = this-&gt;element();
      if (!element)
          return nullptr;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2626,10 +2687,19 @@</span>
      }
  
      return nullptr;
  }
  
<span class="udiff-line-added">+ bool AccessibilityRenderObject::isDescendantOfElementType(const HashSet&lt;QualifiedName&gt;&amp; tagNames) const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     for (auto&amp; ancestor : ancestorsOfType&lt;RenderElement&gt;(*m_renderer)) {</span>
<span class="udiff-line-added">+         if (ancestor.element() &amp;&amp; tagNames.contains(ancestor.element()-&gt;tagQName()))</span>
<span class="udiff-line-added">+             return true;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+     return false;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  bool AccessibilityRenderObject::isDescendantOfElementType(const QualifiedName&amp; tagName) const
  {
      for (auto&amp; ancestor : ancestorsOfType&lt;RenderElement&gt;(*m_renderer)) {
          if (ancestor.element() &amp;&amp; ancestor.element()-&gt;hasTagName(tagName))
              return true;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2660,10 +2730,15 @@</span>
  AccessibilityRole AccessibilityRenderObject::determineAccessibilityRole()
  {
      if (!m_renderer)
          return AccessibilityRole::Unknown;
  
<span class="udiff-line-added">+ #if ENABLE(APPLE_PAY)</span>
<span class="udiff-line-added">+     if (isApplePayButton())</span>
<span class="udiff-line-added">+         return AccessibilityRole::Button;</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
      // Sometimes we need to ignore the attribute role. Like if a tree is malformed,
      // we want to ignore the treeitem&#39;s attribute role.
      if ((m_ariaRole = determineAriaRoleAttribute()) != AccessibilityRole::Unknown &amp;&amp; !shouldIgnoreAttributeRole())
          return m_ariaRole;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2738,12 +2813,21 @@</span>
          return AccessibilityRole::Heading;
  
      if (m_renderer-&gt;isSVGRoot())
          return AccessibilityRole::SVGRoot;
  
<span class="udiff-line-modified-removed">-     if (isStyleFormatGroup())</span>
<span class="udiff-line-modified-added">+     if (isStyleFormatGroup()) {</span>
<span class="udiff-line-added">+         if (node-&gt;hasTagName(delTag))</span>
<span class="udiff-line-added">+             return AccessibilityRole::Deletion;</span>
<span class="udiff-line-added">+         if (node-&gt;hasTagName(insTag))</span>
<span class="udiff-line-added">+             return AccessibilityRole::Insertion;</span>
<span class="udiff-line-added">+         if (node-&gt;hasTagName(subTag))</span>
<span class="udiff-line-added">+             return AccessibilityRole::Subscript;</span>
<span class="udiff-line-added">+         if (node-&gt;hasTagName(supTag))</span>
<span class="udiff-line-added">+             return AccessibilityRole::Superscript;</span>
          return is&lt;RenderInline&gt;(*m_renderer) ? AccessibilityRole::Inline : AccessibilityRole::TextGroup;
<span class="udiff-line-added">+     }</span>
  
      if (node &amp;&amp; node-&gt;hasTagName(ddTag))
          return AccessibilityRole::DescriptionListDetail;
  
      if (node &amp;&amp; node-&gt;hasTagName(dtTag))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2851,14 +2935,20 @@</span>
      if (node &amp;&amp; node-&gt;hasTagName(htmlTag))
          return AccessibilityRole::Ignored;
  
      // There should only be one banner/contentInfo per page. If header/footer are being used within an article or section
      // then it should not be exposed as whole page&#39;s banner/contentInfo
<span class="udiff-line-modified-removed">-     if (node &amp;&amp; node-&gt;hasTagName(headerTag) &amp;&amp; !isDescendantOfElementType(articleTag) &amp;&amp; !isDescendantOfElementType(sectionTag))</span>
<span class="udiff-line-modified-added">+     if (node &amp;&amp; node-&gt;hasTagName(headerTag) &amp;&amp; !isDescendantOfElementType({ articleTag, sectionTag }))</span>
          return AccessibilityRole::LandmarkBanner;
<span class="udiff-line-modified-removed">-     if (node &amp;&amp; node-&gt;hasTagName(footerTag) &amp;&amp; !isDescendantOfElementType(articleTag) &amp;&amp; !isDescendantOfElementType(sectionTag))</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+     // http://webkit.org/b/190138 Footers should become contentInfo&#39;s if scoped to body (and consequently become a landmark).</span>
<span class="udiff-line-added">+     // It should remain a footer if scoped to main, sectioning elements (article, section) or root sectioning element (blockquote, details, dialog, fieldset, figure, td).</span>
<span class="udiff-line-added">+     if (node &amp;&amp; node-&gt;hasTagName(footerTag)) {</span>
<span class="udiff-line-added">+         if (!isDescendantOfElementType({ articleTag, sectionTag, mainTag, blockquoteTag, detailsTag, fieldsetTag, figureTag, tdTag }))</span>
<span class="udiff-line-added">+             return AccessibilityRole::LandmarkContentInfo;</span>
          return AccessibilityRole::Footer;
<span class="udiff-line-added">+     }</span>
  
      // menu tags with toolbar type should have Toolbar role.
      if (node &amp;&amp; node-&gt;hasTagName(menuTag) &amp;&amp; equalLettersIgnoringASCIICase(getAttribute(typeAttr), &quot;toolbar&quot;))
          return AccessibilityRole::Toolbar;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2884,11 +2974,11 @@</span>
      return AccessibilityRole::Unknown;
  }
  
  AccessibilityOrientation AccessibilityRenderObject::orientation() const
  {
<span class="udiff-line-modified-removed">-     const AtomicString&amp; ariaOrientation = getAttribute(aria_orientationAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; ariaOrientation = getAttribute(aria_orientationAttr);</span>
      if (equalLettersIgnoringASCIICase(ariaOrientation, &quot;horizontal&quot;))
          return AccessibilityOrientation::Horizontal;
      if (equalLettersIgnoringASCIICase(ariaOrientation, &quot;vertical&quot;))
          return AccessibilityOrientation::Vertical;
      if (equalLettersIgnoringASCIICase(ariaOrientation, &quot;undefined&quot;))
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2985,11 +3075,11 @@</span>
  {
      if (roleValue() == AccessibilityRole::Details)
          return true;
  
      // An object can be expanded if it aria-expanded is true or false.
<span class="udiff-line-modified-removed">-     const AtomicString&amp; expanded = getAttribute(aria_expandedAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; expanded = getAttribute(aria_expandedAttr);</span>
      if (equalLettersIgnoringASCIICase(expanded, &quot;true&quot;) || equalLettersIgnoringASCIICase(expanded, &quot;false&quot;))
          return true;
      return false;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3245,11 +3335,12 @@</span>
  }
  
  void AccessibilityRenderObject::updateRoleAfterChildrenCreation()
  {
      // If a menu does not have valid menuitem children, it should not be exposed as a menu.
<span class="udiff-line-modified-removed">-     if (roleValue() == AccessibilityRole::Menu) {</span>
<span class="udiff-line-modified-added">+     auto role = roleValue();</span>
<span class="udiff-line-added">+     if (role == AccessibilityRole::Menu) {</span>
          // Elements marked as menus must have at least one menu item child.
          size_t menuItemCount = 0;
          for (const auto&amp; child : children()) {
              if (child-&gt;isMenuItem()) {
                  menuItemCount++;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3258,10 +3349,12 @@</span>
          }
  
          if (!menuItemCount)
              m_role = AccessibilityRole::Group;
      }
<span class="udiff-line-added">+     if (role == AccessibilityRole::SVGRoot &amp;&amp; !hasChildren())</span>
<span class="udiff-line-added">+         m_role = AccessibilityRole::Image;</span>
  }
  
  void AccessibilityRenderObject::addChildren()
  {
      // If the need to add more children in addition to existing children arises,
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3300,33 +3393,33 @@</span>
      return AccessibilityNodeObject::canHaveChildren();
  }
  
  const String AccessibilityRenderObject::liveRegionStatus() const
  {
<span class="udiff-line-modified-removed">-     const AtomicString&amp; liveRegionStatus = getAttribute(aria_liveAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; liveRegionStatus = getAttribute(aria_liveAttr);</span>
      // These roles have implicit live region status.
      if (liveRegionStatus.isEmpty())
          return defaultLiveRegionStatusForRole(roleValue());
  
      return liveRegionStatus;
  }
  
  const String AccessibilityRenderObject::liveRegionRelevant() const
  {
<span class="udiff-line-modified-removed">-     static NeverDestroyed&lt;const AtomicString&gt; defaultLiveRegionRelevant(&quot;additions text&quot;, AtomicString::ConstructFromLiteral);</span>
<span class="udiff-line-modified-removed">-     const AtomicString&amp; relevant = getAttribute(aria_relevantAttr);</span>
<span class="udiff-line-modified-added">+     static NeverDestroyed&lt;const AtomString&gt; defaultLiveRegionRelevant(&quot;additions text&quot;, AtomString::ConstructFromLiteral);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; relevant = getAttribute(aria_relevantAttr);</span>
  
      // Default aria-relevant = &quot;additions text&quot;.
      if (relevant.isEmpty())
          return &quot;additions text&quot;;
  
      return relevant;
  }
  
  bool AccessibilityRenderObject::liveRegionAtomic() const
  {
<span class="udiff-line-modified-removed">-     const AtomicString&amp; atomic = getAttribute(aria_atomicAttr);</span>
<span class="udiff-line-modified-added">+     const AtomString&amp; atomic = getAttribute(aria_atomicAttr);</span>
      if (equalLettersIgnoringASCIICase(atomic, &quot;true&quot;))
          return true;
      if (equalLettersIgnoringASCIICase(atomic, &quot;false&quot;))
          return false;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3443,11 +3536,11 @@</span>
      case AccessibilityRole::MenuBar:
          if (AccessibilityObject* descendant = activeDescendant()) {
              result.append(descendant);
              return;
          }
<span class="udiff-line-modified-removed">-         if (AccessibilityObject* focusedElement = focusedUIElement()) {</span>
<span class="udiff-line-modified-added">+         if (AccessibilityObject* focusedElement = static_cast&lt;AccessibilityObject*&gt;(focusedUIElement())) {</span>
              result.append(focusedElement);
              return;
          }
          return;
      default:
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3520,11 +3613,11 @@</span>
  #else
      return nullAtom();
  #endif
  }
  
<span class="udiff-line-modified-removed">- void AccessibilityRenderObject::setAccessibleName(const AtomicString&amp; name)</span>
<span class="udiff-line-modified-added">+ void AccessibilityRenderObject::setAccessibleName(const AtomString&amp; name)</span>
  {
      // Setting the accessible name can store the value in the DOM
      if (!m_renderer)
          return;
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3608,10 +3701,26 @@</span>
          return false;
  
      return m_renderer-&gt;style().fontDescription().families() == renderer-&gt;style().fontDescription().families();
  }
  
<span class="udiff-line-added">+ #if ENABLE(APPLE_PAY)</span>
<span class="udiff-line-added">+ bool AccessibilityRenderObject::isApplePayButton() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (!m_renderer)</span>
<span class="udiff-line-added">+         return false;</span>
<span class="udiff-line-added">+     return m_renderer-&gt;style().appearance() == ApplePayButtonPart;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ ApplePayButtonType AccessibilityRenderObject::applePayButtonType() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (!m_renderer)</span>
<span class="udiff-line-added">+         return ApplePayButtonType::Plain;</span>
<span class="udiff-line-added">+     return m_renderer-&gt;style().applePayButtonType();</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ #endif</span>
<span class="udiff-line-added">+ </span>
  bool AccessibilityRenderObject::hasSameFontColor(RenderObject* renderer) const
  {
      if (!m_renderer || !renderer)
          return false;
  
</pre>
<center><a href="AccessibilityProgressIndicator.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AccessibilityRenderObject.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>