<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WTF/wtf/dtoa/bignum.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="bignum.cc.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="cached-powers.cc.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/dtoa/bignum.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -32,115 +32,115 @@</span>
  
  namespace WTF {
  namespace double_conversion {
  
  class Bignum {
<span class="udiff-line-modified-removed">-     public:</span>
<span class="udiff-line-modified-removed">-         // 3584 = 128 * 28. We can represent 2^3584 &gt; 10^1000 accurately.</span>
<span class="udiff-line-modified-removed">-         // This bignum can encode much bigger numbers, since it contains an</span>
<span class="udiff-line-modified-removed">-         // exponent.</span>
<span class="udiff-line-modified-removed">-         static const int kMaxSignificantBits = 3584;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         Bignum();</span>
<span class="udiff-line-modified-removed">-         void AssignUInt16(uint16_t value);</span>
<span class="udiff-line-modified-removed">-         void AssignUInt64(uint64_t value);</span>
<span class="udiff-line-modified-removed">-         void AssignBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void AssignDecimalString(BufferReference&lt;const char&gt; value);</span>
<span class="udiff-line-modified-removed">-         void AssignHexString(BufferReference&lt;const char&gt; value);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void AssignPowerUInt16(uint16_t base, int exponent);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void AddUInt64(uint64_t operand);</span>
<span class="udiff-line-modified-removed">-         void AddBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-removed">-         // Precondition: this &gt;= other.</span>
<span class="udiff-line-modified-removed">-         void SubtractBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void Square();</span>
<span class="udiff-line-modified-removed">-         void ShiftLeft(int shift_amount);</span>
<span class="udiff-line-modified-removed">-         void MultiplyByUInt32(uint32_t factor);</span>
<span class="udiff-line-modified-removed">-         void MultiplyByUInt64(uint64_t factor);</span>
<span class="udiff-line-modified-removed">-         void MultiplyByPowerOfTen(int exponent);</span>
<span class="udiff-line-modified-removed">-         void Times10() { return MultiplyByUInt32(10); }</span>
<span class="udiff-line-modified-removed">-         // Pseudocode:</span>
<span class="udiff-line-modified-removed">-         //  int result = this / other;</span>
<span class="udiff-line-modified-removed">-         //  this = this % other;</span>
<span class="udiff-line-modified-removed">-         // In the worst case this function is in O(this/other).</span>
<span class="udiff-line-modified-removed">-         uint16_t DivideModuloIntBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         bool ToHexString(char* buffer, int buffer_size) const;</span>
<span class="udiff-line-modified-added">+  public:</span>
<span class="udiff-line-modified-added">+   // 3584 = 128 * 28. We can represent 2^3584 &gt; 10^1000 accurately.</span>
<span class="udiff-line-modified-added">+   // This bignum can encode much bigger numbers, since it contains an</span>
<span class="udiff-line-modified-added">+   // exponent.</span>
<span class="udiff-line-modified-added">+   static const int kMaxSignificantBits = 3584;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   Bignum();</span>
<span class="udiff-line-modified-added">+   void AssignUInt16(uint16_t value);</span>
<span class="udiff-line-modified-added">+   void AssignUInt64(uint64_t value);</span>
<span class="udiff-line-modified-added">+   void AssignBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void AssignDecimalString(BufferReference&lt;const char&gt; value);</span>
<span class="udiff-line-modified-added">+   void AssignHexString(BufferReference&lt;const char&gt; value);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void AssignPowerUInt16(uint16_t base, int exponent);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void AddUInt64(uint64_t operand);</span>
<span class="udiff-line-modified-added">+   void AddBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-added">+   // Precondition: this &gt;= other.</span>
<span class="udiff-line-modified-added">+   void SubtractBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void Square();</span>
<span class="udiff-line-modified-added">+   void ShiftLeft(int shift_amount);</span>
<span class="udiff-line-modified-added">+   void MultiplyByUInt32(uint32_t factor);</span>
<span class="udiff-line-modified-added">+   void MultiplyByUInt64(uint64_t factor);</span>
<span class="udiff-line-modified-added">+   void MultiplyByPowerOfTen(int exponent);</span>
<span class="udiff-line-modified-added">+   void Times10() { return MultiplyByUInt32(10); }</span>
<span class="udiff-line-modified-added">+   // Pseudocode:</span>
<span class="udiff-line-modified-added">+   //  int result = this / other;</span>
<span class="udiff-line-modified-added">+   //  this = this % other;</span>
<span class="udiff-line-modified-added">+   // In the worst case this function is in O(this/other).</span>
<span class="udiff-line-modified-added">+   uint16_t DivideModuloIntBignum(const Bignum&amp; other);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   bool ToHexString(char* buffer, int buffer_size) const;</span>
  
    // Returns
    //  -1 if a &lt; b,
    //   0 if a == b, and
    //  +1 if a &gt; b.
<span class="udiff-line-modified-removed">-         static int Compare(const Bignum&amp; a, const Bignum&amp; b);</span>
<span class="udiff-line-modified-removed">-         static bool Equal(const Bignum&amp; a, const Bignum&amp; b) {</span>
<span class="udiff-line-modified-removed">-             return Compare(a, b) == 0;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         static bool LessEqual(const Bignum&amp; a, const Bignum&amp; b) {</span>
<span class="udiff-line-modified-removed">-             return Compare(a, b) &lt;= 0;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         static bool Less(const Bignum&amp; a, const Bignum&amp; b) {</span>
<span class="udiff-line-modified-removed">-             return Compare(a, b) &lt; 0;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         // Returns Compare(a + b, c);</span>
<span class="udiff-line-modified-removed">-         static int PlusCompare(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c);</span>
<span class="udiff-line-modified-removed">-         // Returns a + b == c</span>
<span class="udiff-line-modified-removed">-         static bool PlusEqual(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c) {</span>
<span class="udiff-line-modified-removed">-             return PlusCompare(a, b, c) == 0;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         // Returns a + b &lt;= c</span>
<span class="udiff-line-modified-removed">-         static bool PlusLessEqual(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c) {</span>
<span class="udiff-line-modified-removed">-             return PlusCompare(a, b, c) &lt;= 0;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         // Returns a + b &lt; c</span>
<span class="udiff-line-modified-removed">-         static bool PlusLess(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c) {</span>
<span class="udiff-line-modified-removed">-             return PlusCompare(a, b, c) &lt; 0;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-     private:</span>
<span class="udiff-line-modified-removed">-         typedef uint32_t Chunk;</span>
<span class="udiff-line-modified-removed">-         typedef uint64_t DoubleChunk;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         static const int kChunkSize = sizeof(Chunk) * 8;</span>
<span class="udiff-line-modified-removed">-         static const int kDoubleChunkSize = sizeof(DoubleChunk) * 8;</span>
<span class="udiff-line-modified-removed">-         // With bigit size of 28 we loose some bits, but a double still fits easily</span>
<span class="udiff-line-modified-removed">-         // into two chunks, and more importantly we can use the Comba multiplication.</span>
<span class="udiff-line-modified-removed">-         static const int kBigitSize = 28;</span>
<span class="udiff-line-modified-removed">-         static const Chunk kBigitMask = (1 &lt;&lt; kBigitSize) - 1;</span>
<span class="udiff-line-modified-removed">-         // Every instance allocates kBigitLength chunks on the stack. Bignums cannot</span>
<span class="udiff-line-modified-removed">-         // grow. There are no checks if the stack-allocated space is sufficient.</span>
<span class="udiff-line-modified-removed">-         static const int kBigitCapacity = kMaxSignificantBits / kBigitSize;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         void EnsureCapacity(int size) {</span>
<span class="udiff-line-modified-removed">-             if (size &gt; kBigitCapacity) {</span>
<span class="udiff-line-modified-removed">-                 UNREACHABLE();</span>
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">-         void Align(const Bignum&amp; other);</span>
<span class="udiff-line-modified-removed">-         void Clamp();</span>
<span class="udiff-line-modified-removed">-         bool IsClamped() const;</span>
<span class="udiff-line-modified-removed">-         void Zero();</span>
<span class="udiff-line-modified-removed">-         // Requires this to have enough capacity (no tests done).</span>
<span class="udiff-line-modified-removed">-         // Updates used_digits_ if necessary.</span>
<span class="udiff-line-modified-removed">-         // shift_amount must be &lt; kBigitSize.</span>
<span class="udiff-line-modified-removed">-         void BigitsShiftLeft(int shift_amount);</span>
<span class="udiff-line-modified-removed">-         // BigitLength includes the &quot;hidden&quot; digits encoded in the exponent.</span>
<span class="udiff-line-modified-removed">-         int BigitLength() const { return used_digits_ + exponent_; }</span>
<span class="udiff-line-modified-removed">-         Chunk BigitAt(int index) const;</span>
<span class="udiff-line-modified-removed">-         void SubtractTimes(const Bignum&amp; other, int factor);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         Chunk bigits_buffer_[kBigitCapacity];</span>
<span class="udiff-line-modified-added">+   static int Compare(const Bignum&amp; a, const Bignum&amp; b);</span>
<span class="udiff-line-modified-added">+   static bool Equal(const Bignum&amp; a, const Bignum&amp; b) {</span>
<span class="udiff-line-modified-added">+     return Compare(a, b) == 0;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+   static bool LessEqual(const Bignum&amp; a, const Bignum&amp; b) {</span>
<span class="udiff-line-modified-added">+     return Compare(a, b) &lt;= 0;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+   static bool Less(const Bignum&amp; a, const Bignum&amp; b) {</span>
<span class="udiff-line-modified-added">+     return Compare(a, b) &lt; 0;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+   // Returns Compare(a + b, c);</span>
<span class="udiff-line-modified-added">+   static int PlusCompare(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c);</span>
<span class="udiff-line-modified-added">+   // Returns a + b == c</span>
<span class="udiff-line-modified-added">+   static bool PlusEqual(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c) {</span>
<span class="udiff-line-modified-added">+     return PlusCompare(a, b, c) == 0;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+   // Returns a + b &lt;= c</span>
<span class="udiff-line-modified-added">+   static bool PlusLessEqual(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c) {</span>
<span class="udiff-line-modified-added">+     return PlusCompare(a, b, c) &lt;= 0;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+   // Returns a + b &lt; c</span>
<span class="udiff-line-modified-added">+   static bool PlusLess(const Bignum&amp; a, const Bignum&amp; b, const Bignum&amp; c) {</span>
<span class="udiff-line-modified-added">+     return PlusCompare(a, b, c) &lt; 0;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+  private:</span>
<span class="udiff-line-modified-added">+   typedef uint32_t Chunk;</span>
<span class="udiff-line-modified-added">+   typedef uint64_t DoubleChunk;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   static const int kChunkSize = sizeof(Chunk) * 8;</span>
<span class="udiff-line-modified-added">+   static const int kDoubleChunkSize = sizeof(DoubleChunk) * 8;</span>
<span class="udiff-line-modified-added">+   // With bigit size of 28 we loose some bits, but a double still fits easily</span>
<span class="udiff-line-modified-added">+   // into two chunks, and more importantly we can use the Comba multiplication.</span>
<span class="udiff-line-modified-added">+   static const int kBigitSize = 28;</span>
<span class="udiff-line-modified-added">+   static const Chunk kBigitMask = (1 &lt;&lt; kBigitSize) - 1;</span>
<span class="udiff-line-modified-added">+   // Every instance allocates kBigitLength chunks on the stack. Bignums cannot</span>
<span class="udiff-line-modified-added">+   // grow. There are no checks if the stack-allocated space is sufficient.</span>
<span class="udiff-line-modified-added">+   static const int kBigitCapacity = kMaxSignificantBits / kBigitSize;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   void EnsureCapacity(int size) {</span>
<span class="udiff-line-modified-added">+     if (size &gt; kBigitCapacity) {</span>
<span class="udiff-line-modified-added">+       UNREACHABLE();</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+   void Align(const Bignum&amp; other);</span>
<span class="udiff-line-modified-added">+   void Clamp();</span>
<span class="udiff-line-modified-added">+   bool IsClamped() const;</span>
<span class="udiff-line-modified-added">+   void Zero();</span>
<span class="udiff-line-modified-added">+   // Requires this to have enough capacity (no tests done).</span>
<span class="udiff-line-modified-added">+   // Updates used_digits_ if necessary.</span>
<span class="udiff-line-modified-added">+   // shift_amount must be &lt; kBigitSize.</span>
<span class="udiff-line-modified-added">+   void BigitsShiftLeft(int shift_amount);</span>
<span class="udiff-line-modified-added">+   // BigitLength includes the &quot;hidden&quot; digits encoded in the exponent.</span>
<span class="udiff-line-modified-added">+   int BigitLength() const { return used_digits_ + exponent_; }</span>
<span class="udiff-line-modified-added">+   Chunk BigitAt(int index) const;</span>
<span class="udiff-line-modified-added">+   void SubtractTimes(const Bignum&amp; other, int factor);</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   Chunk bigits_buffer_[kBigitCapacity];</span>
    // A BufferReference backed by bigits_buffer_. This way accesses to the array are
<span class="udiff-line-modified-removed">-         // checked for out-of-bounds errors.</span>
<span class="udiff-line-modified-removed">-         BufferReference&lt;Chunk&gt; bigits_;</span>
<span class="udiff-line-modified-removed">-         int used_digits_;</span>
<span class="udiff-line-modified-removed">-         // The Bignum&#39;s value equals value(bigits_) * 2^(exponent_ * kBigitSize).</span>
<span class="udiff-line-modified-removed">-         int exponent_;</span>
<span class="udiff-line-modified-added">+   // checked for out-of-bounds errors.</span>
<span class="udiff-line-modified-added">+   BufferReference&lt;Chunk&gt; bigits_;</span>
<span class="udiff-line-modified-added">+   int used_digits_;</span>
<span class="udiff-line-modified-added">+   // The Bignum&#39;s value equals value(bigits_) * 2^(exponent_ * kBigitSize).</span>
<span class="udiff-line-modified-added">+   int exponent_;</span>
  
    DC_DISALLOW_COPY_AND_ASSIGN(Bignum);
  };
  
  }  // namespace double_conversion
<span class="udiff-line-modified-removed">- } // namespace WTF</span>
<span class="udiff-line-modified-added">+ }  // namespace WTF</span>
  
  #endif  // DOUBLE_CONVERSION_BIGNUM_H_
</pre>
<center><a href="bignum.cc.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="cached-powers.cc.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>