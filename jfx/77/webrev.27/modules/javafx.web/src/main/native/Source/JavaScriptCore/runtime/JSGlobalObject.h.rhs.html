<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
   2  *  Copyright (C) 2007 Eric Seidel &lt;eric@webkit.org&gt;
   3  *  Copyright (C) 2007-2019 Apple Inc. All rights reserved.
   4  *
   5  *  This library is free software; you can redistribute it and/or
   6  *  modify it under the terms of the GNU Library General Public
   7  *  License as published by the Free Software Foundation; either
   8  *  version 2 of the License, or (at your option) any later version.
   9  *
  10  *  This library is distributed in the hope that it will be useful,
  11  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
  12  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
  13  *  Library General Public License for more details.
  14  *
  15  *  You should have received a copy of the GNU Library General Public License
  16  *  along with this library; see the file COPYING.LIB.  If not, write to
  17  *  the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor,
  18  *  Boston, MA 02110-1301, USA.
  19  *
  20  */
  21 
  22 #pragma once
  23 
  24 #include &quot;ArrayAllocationProfile.h&quot;
  25 #include &quot;ArrayBufferSharingMode.h&quot;
  26 #include &quot;BigIntPrototype.h&quot;
  27 #include &quot;BooleanPrototype.h&quot;
  28 #include &quot;ErrorType.h&quot;
  29 #include &quot;ExceptionHelpers.h&quot;
  30 #include &quot;InternalFunction.h&quot;
  31 #include &quot;JSArray.h&quot;
  32 #include &quot;JSArrayBufferPrototype.h&quot;
  33 #include &quot;JSClassRef.h&quot;
  34 #include &quot;JSGlobalLexicalEnvironment.h&quot;
  35 #include &quot;JSPromiseDeferred.h&quot;
  36 #include &quot;JSSegmentedVariableObject.h&quot;
  37 #include &quot;JSWeakObjectMapRefInternal.h&quot;
  38 #include &quot;LazyProperty.h&quot;
  39 #include &quot;LazyClassStructure.h&quot;
  40 #include &quot;NumberPrototype.h&quot;
<a name="1" id="anc1"></a><span class="line-added">  41 #include &quot;ParserModes.h&quot;</span>
  42 #include &quot;RegExpGlobalData.h&quot;
  43 #include &quot;RuntimeFlags.h&quot;
  44 #include &quot;SpecialPointer.h&quot;
  45 #include &quot;StringPrototype.h&quot;
  46 #include &quot;SymbolPrototype.h&quot;
  47 #include &quot;VM.h&quot;
  48 #include &quot;Watchpoint.h&quot;
  49 #include &lt;JavaScriptCore/JSBase.h&gt;
  50 #include &lt;array&gt;
  51 #include &lt;wtf/HashSet.h&gt;
  52 #include &lt;wtf/RetainPtr.h&gt;
  53 
  54 struct OpaqueJSClass;
  55 struct OpaqueJSClassContextData;
  56 OBJC_CLASS JSWrapperMap;
  57 
  58 namespace Inspector {
  59 class JSGlobalObjectInspectorController;
  60 }
  61 
  62 namespace JSC {
  63 class ArrayConstructor;
  64 class ArrayPrototype;
  65 class AsyncIteratorPrototype;
  66 class AsyncFunctionPrototype;
  67 class AsyncGeneratorPrototype;
  68 class AsyncGeneratorFunctionPrototype;
  69 class BooleanPrototype;
  70 class ConsoleClient;
  71 class Debugger;
  72 class ErrorConstructor;
  73 class ErrorPrototype;
  74 class EvalCodeBlock;
  75 class EvalExecutable;
  76 class FunctionConstructor;
  77 class FunctionPrototype;
  78 class GeneratorPrototype;
  79 class GeneratorFunctionPrototype;
  80 class GetterSetter;
  81 class GlobalCodeBlock;
  82 class IndirectEvalExecutable;
  83 class InputCursor;
  84 class IntlObject;
  85 class IntlCollator;
  86 class JSArrayBuffer;
  87 class JSArrayBufferPrototype;
  88 class JSCallee;
  89 class JSGlobalObjectDebuggable;
  90 class JSInternalPromise;
  91 class JSModuleLoader;
  92 class JSModuleRecord;
  93 class JSPromise;
  94 class JSPromiseConstructor;
  95 class JSPromisePrototype;
  96 class JSSharedArrayBuffer;
  97 class JSSharedArrayBufferPrototype;
  98 class JSTypedArrayViewConstructor;
  99 class JSTypedArrayViewPrototype;
 100 class DirectEvalExecutable;
 101 class LLIntOffsetsExtractor;
 102 class MapPrototype;
 103 class Microtask;
 104 class ModuleLoader;
 105 class ModuleProgramExecutable;
 106 class NativeErrorConstructorBase;
 107 class NullGetterFunction;
 108 class NullSetterFunction;
 109 class ObjectConstructor;
 110 class ProgramCodeBlock;
 111 class ProgramExecutable;
 112 class RegExpConstructor;
 113 class RegExpPrototype;
 114 class SetPrototype;
 115 class SourceCode;
 116 class SourceOrigin;
 117 class UnlinkedModuleProgramCodeBlock;
 118 class VariableEnvironment;
 119 struct ActivationStackNode;
 120 struct HashTable;
 121 
 122 #ifdef JSC_GLIB_API_ENABLED
 123 class WrapperMap;
 124 #endif
 125 
 126 template&lt;typename Watchpoint&gt; class ObjectPropertyChangeAdaptiveWatchpoint;
 127 
<a name="2" id="anc2"></a><span class="line-modified"> 128 constexpr bool typeExposedByDefault = true;</span>
 129 
<a name="3" id="anc3"></a><span class="line-modified"> 130 #define DEFINE_STANDARD_BUILTIN(macro, upperName, lowerName) macro(upperName, lowerName, lowerName, JS ## upperName, upperName, object, typeExposedByDefault)</span>





 131 
<a name="4" id="anc4"></a><span class="line-modified"> 132 #define FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(macro) \</span>
<span class="line-modified"> 133     macro(String, string, stringObject, StringObject, String, object, typeExposedByDefault) \</span>
<span class="line-added"> 134     macro(Map, map, map, JSMap, Map, object, typeExposedByDefault) \</span>
<span class="line-added"> 135     macro(Set, set, set, JSSet, Set, object, typeExposedByDefault) \</span>
<span class="line-added"> 136     macro(JSPromise, promise, promise, JSPromise, Promise, object, typeExposedByDefault) \</span>
<span class="line-added"> 137     macro(BigInt, bigInt, bigIntObject, BigIntObject, BigInt, object, Options::useBigInt()) \</span>
<span class="line-added"> 138     macro(WeakObjectRef, weakObjectRef, weakObjectRef, JSWeakObjectRef, WeakRef, object, Options::useWeakRefs()) \</span>
 139 
 140 #define FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(macro) \
<a name="5" id="anc5"></a><span class="line-modified"> 141     macro(StringIterator, stringIterator, stringIterator, JSStringIterator, StringIterator, iterator, typeExposedByDefault) \</span>
 142 
 143 #define FOR_EACH_SIMPLE_BUILTIN_TYPE(macro) \
 144     FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(macro) \
<a name="6" id="anc6"></a><span class="line-modified"> 145     macro(JSInternalPromise, internalPromise, internalPromise, JSInternalPromise, InternalPromise, object, typeExposedByDefault) \</span>
<span class="line-modified"> 146 </span>
<span class="line-modified"> 147 #define FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(macro) \</span>
<span class="line-modified"> 148     macro(Boolean, boolean, booleanObject, BooleanObject, Boolean, object, typeExposedByDefault) \</span>
<span class="line-modified"> 149     macro(Date, date, date, DateInstance, Date, object, typeExposedByDefault) \</span>
<span class="line-modified"> 150     macro(Error, error, error, ErrorInstance, Error, object, typeExposedByDefault) \</span>
<span class="line-modified"> 151     macro(Number, number, numberObject, NumberObject, Number, object, typeExposedByDefault) \</span>
<span class="line-added"> 152     macro(Symbol, symbol, symbolObject, SymbolObject, Symbol, object, typeExposedByDefault) \</span>
 153     DEFINE_STANDARD_BUILTIN(macro, WeakMap, weakMap) \
 154     DEFINE_STANDARD_BUILTIN(macro, WeakSet, weakSet) \
 155 
<a name="7" id="anc7"></a><span class="line-added"> 156 #define FOR_EACH_LAZY_BUILTIN_TYPE(macro) \</span>
<span class="line-added"> 157     FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(macro) \</span>
<span class="line-added"> 158     macro(JSArrayBuffer, arrayBuffer, arrayBuffer, JSArrayBuffer, ArrayBuffer, object, typeExposedByDefault) \</span>
<span class="line-added"> 159 </span>
 160 #if ENABLE(WEBASSEMBLY)
 161 #define FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(macro) \
<a name="8" id="anc8"></a><span class="line-modified"> 162     macro(WebAssemblyCompileError, webAssemblyCompileError, webAssemblyCompileError, JSWebAssemblyCompileError, CompileError, error, typeExposedByDefault) \</span>
<span class="line-modified"> 163     macro(WebAssemblyInstance,     webAssemblyInstance,     webAssemblyInstance,     JSWebAssemblyInstance,     Instance,     object, typeExposedByDefault) \</span>
<span class="line-modified"> 164     macro(WebAssemblyLinkError,    webAssemblyLinkError,    webAssemblyLinkError,    JSWebAssemblyLinkError,    LinkError,    error, typeExposedByDefault) \</span>
<span class="line-modified"> 165     macro(WebAssemblyMemory,       webAssemblyMemory,       webAssemblyMemory,       JSWebAssemblyMemory,       Memory,       object, typeExposedByDefault) \</span>
<span class="line-modified"> 166     macro(WebAssemblyModule,       webAssemblyModule,       webAssemblyModule,       JSWebAssemblyModule,       Module,       object, typeExposedByDefault) \</span>
<span class="line-modified"> 167     macro(WebAssemblyRuntimeError, webAssemblyRuntimeError, webAssemblyRuntimeError, JSWebAssemblyRuntimeError, RuntimeError, error, typeExposedByDefault) \</span>
<span class="line-modified"> 168     macro(WebAssemblyTable,        webAssemblyTable,        webAssemblyTable,        JSWebAssemblyTable,        Table,        object, typeExposedByDefault)</span>
 169 #else
 170 #define FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(macro)
 171 #endif // ENABLE(WEBASSEMBLY)
 172 
<a name="9" id="anc9"></a><span class="line-modified"> 173 #define DECLARE_SIMPLE_BUILTIN_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
 174     class JS ## capitalName; \
 175     class capitalName ## Prototype; \
 176     class capitalName ## Constructor;
 177 
 178 class IteratorPrototype;
 179 FOR_EACH_SIMPLE_BUILTIN_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
<a name="10" id="anc10"></a><span class="line-modified"> 180 FOR_EACH_LAZY_BUILTIN_TYPE_WITH_DECLARATION(DECLARE_SIMPLE_BUILTIN_TYPE)</span>

 181 FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
 182 FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DECLARE_SIMPLE_BUILTIN_TYPE)
 183 
 184 #undef DECLARE_SIMPLE_BUILTIN_TYPE
 185 
 186 enum class JSPromiseRejectionOperation : unsigned {
 187     Reject, // When a promise is rejected without any handlers.
 188     Handle, // When a handler is added to a rejected promise for the first time.
 189 };
 190 
 191 struct GlobalObjectMethodTable {
 192     typedef bool (*SupportsRichSourceInfoFunctionPtr)(const JSGlobalObject*);
 193     SupportsRichSourceInfoFunctionPtr supportsRichSourceInfo;
 194 
 195     typedef bool (*ShouldInterruptScriptFunctionPtr)(const JSGlobalObject*);
 196     ShouldInterruptScriptFunctionPtr shouldInterruptScript;
 197 
 198     typedef RuntimeFlags (*JavaScriptRuntimeFlagsFunctionPtr)(const JSGlobalObject*);
 199     JavaScriptRuntimeFlagsFunctionPtr javaScriptRuntimeFlags;
 200 
 201     typedef void (*QueueTaskToEventLoopFunctionPtr)(JSGlobalObject&amp;, Ref&lt;Microtask&gt;&amp;&amp;);
 202     QueueTaskToEventLoopFunctionPtr queueTaskToEventLoop;
 203 
 204     typedef bool (*ShouldInterruptScriptBeforeTimeoutPtr)(const JSGlobalObject*);
 205     ShouldInterruptScriptBeforeTimeoutPtr shouldInterruptScriptBeforeTimeout;
 206 
 207     typedef JSInternalPromise* (*ModuleLoaderImportModulePtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSString*, JSValue, const SourceOrigin&amp;);
 208     ModuleLoaderImportModulePtr moduleLoaderImportModule;
 209 
 210     typedef Identifier (*ModuleLoaderResolvePtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSValue, JSValue);
 211     ModuleLoaderResolvePtr moduleLoaderResolve;
 212 
 213     typedef JSInternalPromise* (*ModuleLoaderFetchPtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSValue, JSValue);
 214     ModuleLoaderFetchPtr moduleLoaderFetch;
 215 
 216     typedef JSObject* (*ModuleLoaderCreateImportMetaPropertiesPtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSModuleRecord*, JSValue);
 217     ModuleLoaderCreateImportMetaPropertiesPtr moduleLoaderCreateImportMetaProperties;
 218 
 219     typedef JSValue (*ModuleLoaderEvaluatePtr)(JSGlobalObject*, ExecState*, JSModuleLoader*, JSValue, JSValue, JSValue);
 220     ModuleLoaderEvaluatePtr moduleLoaderEvaluate;
 221 
 222     typedef void (*PromiseRejectionTrackerPtr)(JSGlobalObject*, ExecState*, JSPromise*, JSPromiseRejectionOperation);
 223     PromiseRejectionTrackerPtr promiseRejectionTracker;
 224 
 225     typedef String (*DefaultLanguageFunctionPtr)();
 226     DefaultLanguageFunctionPtr defaultLanguage;
 227 
 228     typedef void (*CompileStreamingPtr)(JSGlobalObject*, ExecState*, JSPromiseDeferred*, JSValue);
 229     CompileStreamingPtr compileStreaming;
 230 
 231     typedef void (*InstantiateStreamingPtr)(JSGlobalObject*, ExecState*, JSPromiseDeferred*, JSValue, JSObject*);
 232     InstantiateStreamingPtr instantiateStreaming;
 233 };
 234 
 235 class JSGlobalObject : public JSSegmentedVariableObject {
 236 private:
 237     typedef HashSet&lt;RefPtr&lt;OpaqueJSWeakObjectMap&gt;&gt; WeakMapSet;
 238     typedef HashMap&lt;OpaqueJSClass*, std::unique_ptr&lt;OpaqueJSClassContextData&gt;&gt; OpaqueJSClassDataMap;
 239 
 240     struct JSGlobalObjectRareData {
 241         WTF_MAKE_FAST_ALLOCATED;
 242     public:
 243         JSGlobalObjectRareData()
 244             : profileGroup(0)
 245         {
 246         }
 247 
 248         WeakMapSet weakMaps;
 249         unsigned profileGroup;
 250 
 251         OpaqueJSClassDataMap opaqueJSClassData;
 252     };
 253 
 254 // Our hashtable code-generator tries to access these properties, so we make them public.
 255 // However, we&#39;d like it better if they could be protected.
 256 public:
 257     template&lt;typename T&gt; using Initializer = typename LazyProperty&lt;JSGlobalObject, T&gt;::Initializer;
 258 
 259     Register m_globalCallFrame[CallFrame::headerSizeInRegisters];
 260 
 261     WriteBarrier&lt;JSObject&gt; m_globalThis;
 262 
 263     WriteBarrier&lt;JSGlobalLexicalEnvironment&gt; m_globalLexicalEnvironment;
 264     WriteBarrier&lt;JSScope&gt; m_globalScopeExtension;
 265     WriteBarrier&lt;JSCallee&gt; m_globalCallee;
 266     WriteBarrier&lt;JSCallee&gt; m_stackOverflowFrameCallee;
 267 
<a name="11" id="anc11"></a>
 268     LazyClassStructure m_evalErrorStructure;
 269     LazyClassStructure m_rangeErrorStructure;
 270     LazyClassStructure m_referenceErrorStructure;
 271     LazyClassStructure m_syntaxErrorStructure;
 272     LazyClassStructure m_typeErrorStructure;
 273     LazyClassStructure m_URIErrorStructure;
 274 
 275     WriteBarrier&lt;ObjectConstructor&gt; m_objectConstructor;
 276     WriteBarrier&lt;ArrayConstructor&gt; m_arrayConstructor;
 277     WriteBarrier&lt;JSPromiseConstructor&gt; m_promiseConstructor;
 278     WriteBarrier&lt;JSInternalPromiseConstructor&gt; m_internalPromiseConstructor;
 279 
 280 #if ENABLE(INTL)
<a name="12" id="anc12"></a>
 281     WriteBarrier&lt;IntlCollator&gt; m_defaultCollator;
 282     LazyProperty&lt;JSGlobalObject, Structure&gt; m_collatorStructure;
 283     LazyProperty&lt;JSGlobalObject, Structure&gt; m_numberFormatStructure;
 284     LazyProperty&lt;JSGlobalObject, Structure&gt; m_dateTimeFormatStructure;
 285     LazyProperty&lt;JSGlobalObject, Structure&gt; m_pluralRulesStructure;
 286 #endif
 287     WriteBarrier&lt;NullGetterFunction&gt; m_nullGetterFunction;
 288     WriteBarrier&lt;NullSetterFunction&gt; m_nullSetterFunction;
 289 
<a name="13" id="anc13"></a><span class="line-modified"> 290     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_parseIntFunction;</span>
<span class="line-modified"> 291     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_parseFloatFunction;</span>
 292 
<a name="14" id="anc14"></a>
 293     WriteBarrier&lt;JSFunction&gt; m_callFunction;
 294     WriteBarrier&lt;JSFunction&gt; m_applyFunction;
 295     WriteBarrier&lt;JSFunction&gt; m_throwTypeErrorFunction;
 296     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_arrayProtoToStringFunction;
 297     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_arrayProtoValuesFunction;
<a name="15" id="anc15"></a><span class="line-added"> 298     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_evalFunction;</span>
 299     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_initializePromiseFunction;
 300     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_iteratorProtocolFunction;
 301     LazyProperty&lt;JSGlobalObject, JSFunction&gt; m_promiseResolveFunction;
 302     WriteBarrier&lt;JSFunction&gt; m_objectProtoValueOfFunction;
 303     WriteBarrier&lt;JSFunction&gt; m_numberProtoToStringFunction;
 304     WriteBarrier&lt;JSFunction&gt; m_newPromiseCapabilityFunction;
 305     WriteBarrier&lt;JSFunction&gt; m_functionProtoHasInstanceSymbolFunction;
 306     LazyProperty&lt;JSGlobalObject, GetterSetter&gt; m_throwTypeErrorGetterSetter;
 307     WriteBarrier&lt;JSObject&gt; m_regExpProtoExec;
 308     WriteBarrier&lt;JSObject&gt; m_regExpProtoSymbolReplace;
 309     WriteBarrier&lt;JSObject&gt; m_regExpProtoGlobalGetter;
 310     WriteBarrier&lt;JSObject&gt; m_regExpProtoUnicodeGetter;
 311     WriteBarrier&lt;GetterSetter&gt; m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter;
 312 
 313     LazyProperty&lt;JSGlobalObject, JSModuleLoader&gt; m_moduleLoader;
 314 
 315     WriteBarrier&lt;ObjectPrototype&gt; m_objectPrototype;
 316     WriteBarrier&lt;FunctionPrototype&gt; m_functionPrototype;
 317     WriteBarrier&lt;ArrayPrototype&gt; m_arrayPrototype;
 318     WriteBarrier&lt;RegExpPrototype&gt; m_regExpPrototype;
 319     WriteBarrier&lt;IteratorPrototype&gt; m_iteratorPrototype;
 320     WriteBarrier&lt;AsyncIteratorPrototype&gt; m_asyncIteratorPrototype;
 321     WriteBarrier&lt;GeneratorFunctionPrototype&gt; m_generatorFunctionPrototype;
 322     WriteBarrier&lt;GeneratorPrototype&gt; m_generatorPrototype;
 323     WriteBarrier&lt;AsyncGeneratorPrototype&gt; m_asyncGeneratorPrototype;
 324 
 325     LazyProperty&lt;JSGlobalObject, Structure&gt; m_debuggerScopeStructure;
 326     LazyProperty&lt;JSGlobalObject, Structure&gt; m_withScopeStructure;
<a name="16" id="anc16"></a><span class="line-modified"> 327     LazyProperty&lt;JSGlobalObject, Structure&gt; m_strictEvalActivationStructure;</span>
 328     WriteBarrier&lt;Structure&gt; m_lexicalEnvironmentStructure;
 329     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleEnvironmentStructure;
 330     WriteBarrier&lt;Structure&gt; m_directArgumentsStructure;
 331     WriteBarrier&lt;Structure&gt; m_scopedArgumentsStructure;
 332     WriteBarrier&lt;Structure&gt; m_clonedArgumentsStructure;
 333 
 334     WriteBarrier&lt;Structure&gt; m_objectStructureForObjectConstructor;
 335 
 336     // Lists the actual structures used for having these particular indexing shapes.
 337     WriteBarrier&lt;Structure&gt; m_originalArrayStructureForIndexingShape[NumberOfArrayIndexingModes];
 338     // Lists the structures we should use during allocation for these particular indexing shapes.
 339     // These structures will differ from the originals list above when we are having a bad time.
 340     WriteBarrier&lt;Structure&gt; m_arrayStructureForIndexingShapeDuringAllocation[NumberOfArrayIndexingModes];
 341 
 342     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackConstructorStructure;
 343     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackFunctionStructure;
 344     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callbackObjectStructure;
 345 #if JSC_OBJC_API_ENABLED
 346     LazyProperty&lt;JSGlobalObject, Structure&gt; m_objcCallbackFunctionStructure;
 347     LazyProperty&lt;JSGlobalObject, Structure&gt; m_objcWrapperObjectStructure;
 348 #endif
 349 #ifdef JSC_GLIB_API_ENABLED
 350     LazyProperty&lt;JSGlobalObject, Structure&gt; m_glibCallbackFunctionStructure;
 351     LazyProperty&lt;JSGlobalObject, Structure&gt; m_glibWrapperObjectStructure;
 352 #endif
 353     WriteBarrier&lt;Structure&gt; m_nullPrototypeObjectStructure;
 354     WriteBarrier&lt;Structure&gt; m_calleeStructure;
 355 
 356     WriteBarrier&lt;Structure&gt; m_hostFunctionStructure;
 357 
 358     struct FunctionStructures {
 359         WriteBarrier&lt;Structure&gt; arrowFunctionStructure;
 360         WriteBarrier&lt;Structure&gt; sloppyFunctionStructure;
 361         WriteBarrier&lt;Structure&gt; strictFunctionStructure;
 362     };
 363     FunctionStructures m_builtinFunctions;
 364     FunctionStructures m_ordinaryFunctions;
 365 
 366     LazyProperty&lt;JSGlobalObject, Structure&gt; m_boundFunctionStructure;
 367     LazyProperty&lt;JSGlobalObject, Structure&gt; m_customGetterSetterFunctionStructure;
 368     WriteBarrier&lt;Structure&gt; m_getterSetterStructure;
 369     LazyProperty&lt;JSGlobalObject, Structure&gt; m_nativeStdFunctionStructure;
 370     PropertyOffset m_functionNameOffset;
 371     WriteBarrier&lt;Structure&gt; m_regExpStructure;
 372     WriteBarrier&lt;AsyncFunctionPrototype&gt; m_asyncFunctionPrototype;
 373     WriteBarrier&lt;AsyncGeneratorFunctionPrototype&gt; m_asyncGeneratorFunctionPrototype;
 374     WriteBarrier&lt;Structure&gt; m_asyncFunctionStructure;
 375     WriteBarrier&lt;Structure&gt; m_asyncGeneratorFunctionStructure;
 376     WriteBarrier&lt;Structure&gt; m_generatorFunctionStructure;
<a name="17" id="anc17"></a><span class="line-modified"> 377     LazyProperty&lt;JSGlobalObject, Structure&gt; m_iteratorResultObjectStructure;</span>
 378     WriteBarrier&lt;Structure&gt; m_regExpMatchesArrayStructure;
 379     WriteBarrier&lt;Structure&gt; m_regExpMatchesArrayWithGroupsStructure;
<a name="18" id="anc18"></a><span class="line-modified"> 380     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleRecordStructure;</span>
<span class="line-modified"> 381     LazyProperty&lt;JSGlobalObject, Structure&gt; m_moduleNamespaceObjectStructure;</span>
<span class="line-modified"> 382     LazyProperty&lt;JSGlobalObject, Structure&gt; m_proxyObjectStructure;</span>
<span class="line-modified"> 383     LazyProperty&lt;JSGlobalObject, Structure&gt; m_callableProxyObjectStructure;</span>
<span class="line-modified"> 384     LazyProperty&lt;JSGlobalObject, Structure&gt; m_proxyRevokeStructure;</span>


 385 #if ENABLE(SHARED_ARRAY_BUFFER)
 386     WriteBarrier&lt;JSArrayBufferPrototype&gt; m_sharedArrayBufferPrototype;
 387     WriteBarrier&lt;Structure&gt; m_sharedArrayBufferStructure;
 388 #endif
 389 
<a name="19" id="anc19"></a><span class="line-modified"> 390 #define DEFINE_STORAGE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
 391     WriteBarrier&lt;capitalName ## Prototype&gt; m_ ## lowerName ## Prototype; \
 392     WriteBarrier&lt;Structure&gt; m_ ## properName ## Structure;
 393 
<a name="20" id="anc20"></a><span class="line-added"> 394 #define DEFINE_STORAGE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
<span class="line-added"> 395     LazyClassStructure m_ ## properName ## Structure;</span>
<span class="line-added"> 396 </span>
 397     FOR_EACH_SIMPLE_BUILTIN_TYPE(DEFINE_STORAGE_FOR_SIMPLE_TYPE)
<a name="21" id="anc21"></a>
 398     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DEFINE_STORAGE_FOR_SIMPLE_TYPE)
 399 
 400 #if ENABLE(WEBASSEMBLY)
<a name="22" id="anc22"></a><span class="line-modified"> 401     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyModuleRecordStructure;</span>
<span class="line-modified"> 402     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyFunctionStructure;</span>
<span class="line-modified"> 403     LazyProperty&lt;JSGlobalObject, Structure&gt; m_jsToWasmICCalleeStructure;</span>
<span class="line-modified"> 404     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyWrapperFunctionStructure;</span>
<span class="line-modified"> 405     LazyProperty&lt;JSGlobalObject, Structure&gt; m_webAssemblyToJSCalleeStructure;</span>
<span class="line-modified"> 406     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DEFINE_STORAGE_FOR_LAZY_TYPE)</span>
 407 #endif // ENABLE(WEBASSEMBLY)
 408 
<a name="23" id="anc23"></a>



 409     FOR_EACH_LAZY_BUILTIN_TYPE(DEFINE_STORAGE_FOR_LAZY_TYPE)
<a name="24" id="anc24"></a><span class="line-added"> 410 </span>
<span class="line-added"> 411 #undef DEFINE_STORAGE_FOR_SIMPLE_TYPE</span>
 412 #undef DEFINE_STORAGE_FOR_LAZY_TYPE
 413 
 414     WriteBarrier&lt;GetterSetter&gt; m_speciesGetterSetter;
 415 
 416     LazyProperty&lt;JSGlobalObject, JSTypedArrayViewPrototype&gt; m_typedArrayProto;
 417     LazyProperty&lt;JSGlobalObject, JSTypedArrayViewConstructor&gt; m_typedArraySuperConstructor;
 418 
 419 #define DECLARE_TYPED_ARRAY_TYPE_STRUCTURE(name) LazyClassStructure m_typedArray ## name;
 420     FOR_EACH_TYPED_ARRAY_TYPE(DECLARE_TYPED_ARRAY_TYPE_STRUCTURE)
 421 #undef DECLARE_TYPED_ARRAY_TYPE_STRUCTURE
 422 
 423     JSCell* m_specialPointers[Special::TableSize]; // Special pointers used by the LLInt and JIT.
 424     JSCell* m_linkTimeConstants[LinkTimeConstantCount];
 425 
 426     String m_name;
 427 
<a name="25" id="anc25"></a><span class="line-added"> 428     Strong&lt;JSObject&gt; m_unhandledRejectionCallback;</span>
<span class="line-added"> 429 </span>
 430     Debugger* m_debugger;
 431 
 432     VM&amp; m_vm;
 433 
 434 #if ENABLE(REMOTE_INSPECTOR)
 435     std::unique_ptr&lt;Inspector::JSGlobalObjectInspectorController&gt; m_inspectorController;
 436     std::unique_ptr&lt;JSGlobalObjectDebuggable&gt; m_inspectorDebuggable;
 437 #endif
 438 
 439 #if ENABLE(INTL)
 440     HashSet&lt;String&gt; m_intlCollatorAvailableLocales;
 441     HashSet&lt;String&gt; m_intlDateTimeFormatAvailableLocales;
 442     HashSet&lt;String&gt; m_intlNumberFormatAvailableLocales;
 443     HashSet&lt;String&gt; m_intlPluralRulesAvailableLocales;
 444 #endif // ENABLE(INTL)
 445 
 446     RefPtr&lt;WatchpointSet&gt; m_masqueradesAsUndefinedWatchpoint;
 447     RefPtr&lt;WatchpointSet&gt; m_havingABadTimeWatchpoint;
 448     RefPtr&lt;WatchpointSet&gt; m_varInjectionWatchpoint;
 449 
 450     std::unique_ptr&lt;JSGlobalObjectRareData&gt; m_rareData;
 451 
 452     WeakRandom m_weakRandom;
 453     RegExpGlobalData m_regExpGlobalData;
 454 
 455     JSCallee* stackOverflowFrameCallee() const { return m_stackOverflowFrameCallee.get(); }
 456 
<a name="26" id="anc26"></a><span class="line-modified"> 457     InlineWatchpointSet&amp; arrayIteratorProtocolWatchpointSet() { return m_arrayIteratorProtocolWatchpointSet; }</span>
<span class="line-modified"> 458     InlineWatchpointSet&amp; mapIteratorProtocolWatchpointSet() { return m_mapIteratorProtocolWatchpointSet; }</span>
<span class="line-modified"> 459     InlineWatchpointSet&amp; setIteratorProtocolWatchpointSet() { return m_setIteratorProtocolWatchpointSet; }</span>
<span class="line-modified"> 460     InlineWatchpointSet&amp; stringIteratorProtocolWatchpointSet() { return m_stringIteratorProtocolWatchpointSet; }</span>
<span class="line-modified"> 461     InlineWatchpointSet&amp; mapSetWatchpointSet() { return m_mapSetWatchpointSet; }</span>
<span class="line-modified"> 462     InlineWatchpointSet&amp; setAddWatchpointSet() { return m_setAddWatchpointSet; }</span>
<span class="line-modified"> 463     InlineWatchpointSet&amp; arraySpeciesWatchpointSet() { return m_arraySpeciesWatchpointSet; }</span>
<span class="line-modified"> 464     InlineWatchpointSet&amp; arrayJoinWatchpointSet() { return m_arrayJoinWatchpointSet; }</span>
<span class="line-added"> 465     InlineWatchpointSet&amp; numberToStringWatchpointSet()</span>
 466     {
 467         RELEASE_ASSERT(VM::canUseJIT());
<a name="27" id="anc27"></a><span class="line-modified"> 468         return m_numberToStringWatchpointSet;</span>
 469     }
 470     // If this hasn&#39;t been invalidated, it means the array iterator protocol
 471     // is not observable to user code yet.
<a name="28" id="anc28"></a><span class="line-modified"> 472     InlineWatchpointSet m_arrayIteratorProtocolWatchpointSet;</span>
<span class="line-modified"> 473     InlineWatchpointSet m_mapIteratorProtocolWatchpointSet;</span>
<span class="line-modified"> 474     InlineWatchpointSet m_setIteratorProtocolWatchpointSet;</span>
<span class="line-modified"> 475     InlineWatchpointSet m_stringIteratorProtocolWatchpointSet;</span>
<span class="line-modified"> 476     InlineWatchpointSet m_mapSetWatchpointSet;</span>
<span class="line-modified"> 477     InlineWatchpointSet m_setAddWatchpointSet;</span>
<span class="line-modified"> 478     InlineWatchpointSet m_arraySpeciesWatchpointSet;</span>
<span class="line-modified"> 479     InlineWatchpointSet m_arrayJoinWatchpointSet;</span>
<span class="line-added"> 480     InlineWatchpointSet m_numberToStringWatchpointSet;</span>
<span class="line-added"> 481     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_arrayConstructorSpeciesWatchpoint;</span>
<span class="line-added"> 482     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_arrayPrototypeConstructorWatchpoint;</span>
 483     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_arrayPrototypeSymbolIteratorWatchpoint;
<a name="29" id="anc29"></a><span class="line-added"> 484     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_arrayPrototypeJoinWatchpoint;</span>
 485     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_arrayIteratorPrototypeNext;
 486     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_mapPrototypeSymbolIteratorWatchpoint;
 487     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_mapIteratorPrototypeNextWatchpoint;
 488     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_setPrototypeSymbolIteratorWatchpoint;
 489     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_setIteratorPrototypeNextWatchpoint;
 490     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_stringPrototypeSymbolIteratorWatchpoint;
 491     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_stringIteratorPrototypeNextWatchpoint;
 492     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_mapPrototypeSetWatchpoint;
 493     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_setPrototypeAddWatchpoint;
 494     std::unique_ptr&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt; m_numberPrototypeToStringWatchpoint;
 495 
 496     bool isArrayPrototypeIteratorProtocolFastAndNonObservable();
 497     bool isMapPrototypeIteratorProtocolFastAndNonObservable();
 498     bool isSetPrototypeIteratorProtocolFastAndNonObservable();
 499     bool isStringPrototypeIteratorProtocolFastAndNonObservable();
 500     bool isMapPrototypeSetFastAndNonObservable();
 501     bool isSetPrototypeAddFastAndNonObservable();
 502 
 503 #if ENABLE(DFG_JIT)
 504     using ReferencedGlobalPropertyWatchpointSets = HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, Ref&lt;WatchpointSet&gt;, IdentifierRepHash&gt;;
 505     ReferencedGlobalPropertyWatchpointSets m_referencedGlobalPropertyWatchpointSets;
 506     ConcurrentJSLock m_referencedGlobalPropertyWatchpointSetsLock;
 507 #endif
 508 
 509     bool m_evalEnabled { true };
 510     bool m_webAssemblyEnabled { true };
 511     unsigned m_globalLexicalBindingEpoch { 1 };
 512     String m_evalDisabledErrorMessage;
 513     String m_webAssemblyDisabledErrorMessage;
 514     RuntimeFlags m_runtimeFlags;
 515     ConsoleClient* m_consoleClient { nullptr };
 516     Optional&lt;unsigned&gt; m_stackTraceLimit;
 517 
 518 #if !ASSERT_DISABLED
 519     const ExecState* m_callFrameAtDebuggerEntry { nullptr };
 520 #endif
 521 
 522     static JS_EXPORT_PRIVATE const GlobalObjectMethodTable s_globalObjectMethodTable;
 523     const GlobalObjectMethodTable* m_globalObjectMethodTable;
 524 
 525     void createRareDataIfNeeded()
 526     {
 527         if (m_rareData)
 528             return;
<a name="30" id="anc30"></a><span class="line-modified"> 529         m_rareData = makeUnique&lt;JSGlobalObjectRareData&gt;();</span>
 530     }
 531 
 532 public:
 533     typedef JSSegmentedVariableObject Base;
 534     static const unsigned StructureFlags = Base::StructureFlags | HasStaticPropertyTable | OverridesGetOwnPropertySlot | OverridesGetPropertyNames | IsImmutablePrototypeExoticObject;
 535 
 536     JS_EXPORT_PRIVATE static JSGlobalObject* create(VM&amp;, Structure*);
 537 
 538     DECLARE_EXPORT_INFO;
 539 
 540     bool hasDebugger() const;
 541     bool hasInteractiveDebugger() const;
 542     const RuntimeFlags&amp; runtimeFlags() const { return m_runtimeFlags; }
 543 
 544 #if ENABLE(DFG_JIT)
 545     WatchpointSet* getReferencedPropertyWatchpointSet(UniquedStringImpl*);
 546     WatchpointSet&amp; ensureReferencedPropertyWatchpointSet(UniquedStringImpl*);
 547 #endif
 548 
 549     Optional&lt;unsigned&gt; stackTraceLimit() const { return m_stackTraceLimit; }
 550     void setStackTraceLimit(Optional&lt;unsigned&gt; value) { m_stackTraceLimit = value; }
 551 
 552 protected:
 553     JS_EXPORT_PRIVATE explicit JSGlobalObject(VM&amp;, Structure*, const GlobalObjectMethodTable* = nullptr);
 554 
 555     JS_EXPORT_PRIVATE void finishCreation(VM&amp;);
 556 
 557     JS_EXPORT_PRIVATE void finishCreation(VM&amp;, JSObject*);
 558 
 559     void addGlobalVar(const Identifier&amp;);
 560 
 561 public:
 562     JS_EXPORT_PRIVATE ~JSGlobalObject();
 563     JS_EXPORT_PRIVATE static void destroy(JSCell*);
 564 
 565     JS_EXPORT_PRIVATE static void visitChildren(JSCell*, SlotVisitor&amp;);
 566 
 567     JS_EXPORT_PRIVATE static bool getOwnPropertySlot(JSObject*, ExecState*, PropertyName, PropertySlot&amp;);
 568     JS_EXPORT_PRIVATE static bool put(JSCell*, ExecState*, PropertyName, JSValue, PutPropertySlot&amp;);
 569 
 570     JS_EXPORT_PRIVATE static void defineGetter(JSObject*, ExecState*, PropertyName, JSObject* getterFunc, unsigned attributes);
 571     JS_EXPORT_PRIVATE static void defineSetter(JSObject*, ExecState*, PropertyName, JSObject* setterFunc, unsigned attributes);
 572     JS_EXPORT_PRIVATE static bool defineOwnProperty(JSObject*, ExecState*, PropertyName, const PropertyDescriptor&amp;, bool shouldThrow);
 573 
 574     void addVar(ExecState* exec, const Identifier&amp; propertyName)
 575     {
 576         if (!hasOwnProperty(exec, propertyName))
 577             addGlobalVar(propertyName);
 578     }
 579     void addFunction(ExecState*, const Identifier&amp;);
 580 
 581     JSScope* globalScope() { return m_globalLexicalEnvironment.get(); }
 582     JSGlobalLexicalEnvironment* globalLexicalEnvironment() { return m_globalLexicalEnvironment.get(); }
 583 
 584     JSScope* globalScopeExtension() { return m_globalScopeExtension.get(); }
 585     void setGlobalScopeExtension(JSScope*);
 586     void clearGlobalScopeExtension();
 587 
 588     // The following accessors return pristine values, even if a script
 589     // replaces the global object&#39;s associated property.
 590 
 591     GetterSetter* speciesGetterSetter() const { return m_speciesGetterSetter.get(); }
 592 
 593     ArrayConstructor* arrayConstructor() const { return m_arrayConstructor.get(); }
 594     ObjectConstructor* objectConstructor() const { return m_objectConstructor.get(); }
 595     JSPromiseConstructor* promiseConstructor() const { return m_promiseConstructor.get(); }
 596     JSInternalPromiseConstructor* internalPromiseConstructor() const { return m_internalPromiseConstructor.get(); }
 597 
 598 #if ENABLE(INTL)
 599     IntlCollator* defaultCollator(ExecState*);
 600 #endif
 601 
 602     NullGetterFunction* nullGetterFunction() const { return m_nullGetterFunction.get(); }
 603     NullSetterFunction* nullSetterFunction() const { return m_nullSetterFunction.get(); }
 604 
<a name="31" id="anc31"></a><span class="line-modified"> 605     JSFunction* parseIntFunction() const { return m_parseIntFunction.get(this); }</span>
<span class="line-modified"> 606     JSFunction* parseFloatFunction() const { return m_parseFloatFunction.get(this); }</span>
 607 
<a name="32" id="anc32"></a><span class="line-modified"> 608     JSFunction* evalFunction() const { return m_evalFunction.get(this); }</span>
 609     JSFunction* callFunction() const { return m_callFunction.get(); }
 610     JSFunction* applyFunction() const { return m_applyFunction.get(); }
 611     JSFunction* throwTypeErrorFunction() const { return m_throwTypeErrorFunction.get(); }
 612     JSFunction* arrayProtoToStringFunction() const { return m_arrayProtoToStringFunction.get(this); }
 613     JSFunction* arrayProtoValuesFunction() const { return m_arrayProtoValuesFunction.get(this); }
 614     JSFunction* initializePromiseFunction() const { return m_initializePromiseFunction.get(this); }
 615     JSFunction* iteratorProtocolFunction() const { return m_iteratorProtocolFunction.get(this); }
 616     JSFunction* promiseResolveFunction() const { return m_promiseResolveFunction.get(this); }
 617     JSFunction* objectProtoValueOfFunction() const { return m_objectProtoValueOfFunction.get(); }
 618     JSFunction* numberProtoToStringFunction() const { return m_numberProtoToStringFunction.get(); }
 619     JSFunction* newPromiseCapabilityFunction() const { return m_newPromiseCapabilityFunction.get(); }
 620     JSFunction* functionProtoHasInstanceSymbolFunction() const { return m_functionProtoHasInstanceSymbolFunction.get(); }
 621     JSObject* regExpProtoExecFunction() const { return m_regExpProtoExec.get(); }
 622     JSObject* regExpProtoSymbolReplaceFunction() const { return m_regExpProtoSymbolReplace.get(); }
 623     JSObject* regExpProtoGlobalGetter() const { return m_regExpProtoGlobalGetter.get(); }
 624     JSObject* regExpProtoUnicodeGetter() const { return m_regExpProtoUnicodeGetter.get(); }
 625     GetterSetter* throwTypeErrorArgumentsCalleeAndCallerGetterSetter()
 626     {
 627         return m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter.get();
 628     }
 629 
 630     JSModuleLoader* moduleLoader() const { return m_moduleLoader.get(this); }
 631 
 632     ObjectPrototype* objectPrototype() const { return m_objectPrototype.get(); }
 633     FunctionPrototype* functionPrototype() const { return m_functionPrototype.get(); }
 634     ArrayPrototype* arrayPrototype() const { return m_arrayPrototype.get(); }
 635     JSObject* booleanPrototype() const { return m_booleanObjectStructure.prototypeInitializedOnMainThread(this); }
 636     StringPrototype* stringPrototype() const { return m_stringPrototype.get(); }
 637     JSObject* numberPrototype() const { return m_numberObjectStructure.prototypeInitializedOnMainThread(this); }
 638     BigIntPrototype* bigIntPrototype() const { return m_bigIntPrototype.get(); }
 639     JSObject* datePrototype() const { return m_dateStructure.prototype(this); }
 640     JSObject* symbolPrototype() const { return m_symbolObjectStructure.prototypeInitializedOnMainThread(this); }
 641     RegExpPrototype* regExpPrototype() const { return m_regExpPrototype.get(); }
<a name="33" id="anc33"></a><span class="line-modified"> 642     JSObject* errorPrototype() const { return m_errorStructure.prototype(this); }</span>
 643     IteratorPrototype* iteratorPrototype() const { return m_iteratorPrototype.get(); }
 644     AsyncIteratorPrototype* asyncIteratorPrototype() const { return m_asyncIteratorPrototype.get(); }
 645     GeneratorFunctionPrototype* generatorFunctionPrototype() const { return m_generatorFunctionPrototype.get(); }
 646     GeneratorPrototype* generatorPrototype() const { return m_generatorPrototype.get(); }
 647     AsyncFunctionPrototype* asyncFunctionPrototype() const { return m_asyncFunctionPrototype.get(); }
 648     MapPrototype* mapPrototype() const { return m_mapPrototype.get(); }
 649     // Workaround for the name conflict between JSCell::setPrototype.
 650     SetPrototype* jsSetPrototype() const { return m_setPrototype.get(); }
 651     JSPromisePrototype* promisePrototype() const { return m_promisePrototype.get(); }
 652     AsyncGeneratorPrototype* asyncGeneratorPrototype() const { return m_asyncGeneratorPrototype.get(); }
 653     AsyncGeneratorFunctionPrototype* asyncGeneratorFunctionPrototype() const { return m_asyncGeneratorFunctionPrototype.get(); }
 654 
 655     Structure* debuggerScopeStructure() const { return m_debuggerScopeStructure.get(this); }
 656     Structure* withScopeStructure() const { return m_withScopeStructure.get(this); }
<a name="34" id="anc34"></a><span class="line-modified"> 657     Structure* strictEvalActivationStructure() const { return m_strictEvalActivationStructure.get(this); }</span>
 658     Structure* activationStructure() const { return m_lexicalEnvironmentStructure.get(); }
 659     Structure* moduleEnvironmentStructure() const { return m_moduleEnvironmentStructure.get(this); }
 660     Structure* directArgumentsStructure() const { return m_directArgumentsStructure.get(); }
 661     Structure* scopedArgumentsStructure() const { return m_scopedArgumentsStructure.get(); }
 662     Structure* clonedArgumentsStructure() const { return m_clonedArgumentsStructure.get(); }
 663     Structure* objectStructureForObjectConstructor() const { return m_objectStructureForObjectConstructor.get(); }
 664     Structure* originalArrayStructureForIndexingType(IndexingType indexingType) const
 665     {
 666         ASSERT(indexingType &amp; IsArray);
 667         return m_originalArrayStructureForIndexingShape[arrayIndexFromIndexingType(indexingType)].get();
 668     }
 669     Structure* arrayStructureForIndexingTypeDuringAllocation(IndexingType indexingType) const
 670     {
 671         ASSERT(indexingType &amp; IsArray);
 672         return m_arrayStructureForIndexingShapeDuringAllocation[arrayIndexFromIndexingType(indexingType)].get();
 673     }
 674     Structure* arrayStructureForIndexingTypeDuringAllocation(ExecState* exec, IndexingType indexingType, JSValue newTarget) const
 675     {
 676         return InternalFunction::createSubclassStructure(exec, newTarget, arrayStructureForIndexingTypeDuringAllocation(indexingType));
 677     }
 678     Structure* arrayStructureForProfileDuringAllocation(ExecState* exec, ArrayAllocationProfile* profile, JSValue newTarget) const
 679     {
 680         return arrayStructureForIndexingTypeDuringAllocation(exec, ArrayAllocationProfile::selectIndexingTypeFor(profile), newTarget);
 681     }
 682 
 683     bool isOriginalArrayStructure(Structure* structure)
 684     {
 685         return originalArrayStructureForIndexingType(structure-&gt;indexingMode() | IsArray) == structure;
 686     }
 687 
 688     Structure* booleanObjectStructure() const { return m_booleanObjectStructure.get(this); }
 689     Structure* callbackConstructorStructure() const { return m_callbackConstructorStructure.get(this); }
 690     Structure* callbackFunctionStructure() const { return m_callbackFunctionStructure.get(this); }
 691     Structure* callbackObjectStructure() const { return m_callbackObjectStructure.get(this); }
 692 #if JSC_OBJC_API_ENABLED
 693     Structure* objcCallbackFunctionStructure() const { return m_objcCallbackFunctionStructure.get(this); }
 694     Structure* objcWrapperObjectStructure() const { return m_objcWrapperObjectStructure.get(this); }
 695 #endif
 696 #ifdef JSC_GLIB_API_ENABLED
 697     Structure* glibCallbackFunctionStructure() const { return m_glibCallbackFunctionStructure.get(this); }
 698     Structure* glibWrapperObjectStructure() const { return m_glibWrapperObjectStructure.get(this); }
 699 #endif
 700     Structure* dateStructure() const { return m_dateStructure.get(this); }
 701     Structure* symbolObjectStructure() const { return m_symbolObjectStructure.get(this); }
 702     Structure* nullPrototypeObjectStructure() const { return m_nullPrototypeObjectStructure.get(); }
<a name="35" id="anc35"></a><span class="line-modified"> 703     Structure* errorStructure() const { return m_errorStructure.get(this); }</span>
 704     Structure* errorStructure(ErrorType errorType) const
 705     {
 706         switch (errorType) {
 707         case ErrorType::Error:
 708             return errorStructure();
 709         case ErrorType::EvalError:
 710             return m_evalErrorStructure.get(this);
 711         case ErrorType::RangeError:
 712             return m_rangeErrorStructure.get(this);
 713         case ErrorType::ReferenceError:
 714             return m_referenceErrorStructure.get(this);
 715         case ErrorType::SyntaxError:
 716             return m_syntaxErrorStructure.get(this);
 717         case ErrorType::TypeError:
 718             return m_typeErrorStructure.get(this);
 719         case ErrorType::URIError:
 720             return m_URIErrorStructure.get(this);
 721         }
 722         ASSERT_NOT_REACHED();
 723         return nullptr;
 724     }
 725     Structure* calleeStructure() const { return m_calleeStructure.get(); }
 726     Structure* hostFunctionStructure() const { return m_hostFunctionStructure.get(); }
 727 
 728     Structure* arrowFunctionStructure(bool isBuiltin) const
 729     {
 730         if (isBuiltin)
 731             return m_builtinFunctions.arrowFunctionStructure.get();
 732         return m_ordinaryFunctions.arrowFunctionStructure.get();
 733     }
 734     Structure* sloppyFunctionStructure(bool isBuiltin) const
 735     {
 736         if (isBuiltin)
 737             return m_builtinFunctions.sloppyFunctionStructure.get();
 738         return m_ordinaryFunctions.sloppyFunctionStructure.get();
 739     }
 740     Structure* strictFunctionStructure(bool isBuiltin) const
 741     {
 742         if (isBuiltin)
 743             return m_builtinFunctions.strictFunctionStructure.get();
 744         return m_ordinaryFunctions.strictFunctionStructure.get();
 745     }
 746 
 747     Structure* boundFunctionStructure() const { return m_boundFunctionStructure.get(this); }
 748     Structure* customGetterSetterFunctionStructure() const { return m_customGetterSetterFunctionStructure.get(this); }
 749     Structure* getterSetterStructure() const { return m_getterSetterStructure.get(); }
 750     Structure* nativeStdFunctionStructure() const { return m_nativeStdFunctionStructure.get(this); }
 751     PropertyOffset functionNameOffset() const { return m_functionNameOffset; }
 752     Structure* numberObjectStructure() const { return m_numberObjectStructure.get(this); }
 753     Structure* mapStructure() const { return m_mapStructure.get(); }
 754     Structure* regExpStructure() const { return m_regExpStructure.get(); }
 755     Structure* generatorFunctionStructure() const { return m_generatorFunctionStructure.get(); }
 756     Structure* asyncFunctionStructure() const { return m_asyncFunctionStructure.get(); }
 757     Structure* asyncGeneratorFunctionStructure() const { return m_asyncGeneratorFunctionStructure.get(); }
 758     Structure* stringObjectStructure() const { return m_stringObjectStructure.get(); }
<a name="36" id="anc36"></a><span class="line-modified"> 759     Structure* iteratorResultObjectStructure() const { return m_iteratorResultObjectStructure.get(this); }</span>

 760     Structure* regExpMatchesArrayStructure() const { return m_regExpMatchesArrayStructure.get(); }
 761     Structure* regExpMatchesArrayWithGroupsStructure() const { return m_regExpMatchesArrayWithGroupsStructure.get(); }
<a name="37" id="anc37"></a><span class="line-modified"> 762     Structure* moduleRecordStructure() const { return m_moduleRecordStructure.get(this); }</span>
<span class="line-modified"> 763     Structure* moduleNamespaceObjectStructure() const { return m_moduleNamespaceObjectStructure.get(this); }</span>
<span class="line-modified"> 764     Structure* proxyObjectStructure() const { return m_proxyObjectStructure.get(this); }</span>
<span class="line-modified"> 765     Structure* callableProxyObjectStructure() const { return m_callableProxyObjectStructure.get(this); }</span>
<span class="line-modified"> 766     Structure* proxyRevokeStructure() const { return m_proxyRevokeStructure.get(this); }</span>
 767     Structure* restParameterStructure() const { return arrayStructureForIndexingTypeDuringAllocation(ArrayWithContiguous); }
 768     Structure* originalRestParameterStructure() const { return originalArrayStructureForIndexingType(ArrayWithContiguous); }
 769 #if ENABLE(WEBASSEMBLY)
<a name="38" id="anc38"></a><span class="line-modified"> 770     Structure* webAssemblyModuleRecordStructure() const { return m_webAssemblyModuleRecordStructure.get(this); }</span>
<span class="line-modified"> 771     Structure* webAssemblyFunctionStructure() const { return m_webAssemblyFunctionStructure.get(this); }</span>
<span class="line-modified"> 772     Structure* jsToWasmICCalleeStructure() const { return m_jsToWasmICCalleeStructure.get(this); }</span>
<span class="line-modified"> 773     Structure* webAssemblyWrapperFunctionStructure() const { return m_webAssemblyWrapperFunctionStructure.get(this); }</span>
<span class="line-added"> 774     Structure* webAssemblyToJSCalleeStructure() const { return m_webAssemblyToJSCalleeStructure.get(this); }</span>
 775 #endif // ENABLE(WEBASSEMBLY)
 776 #if ENABLE(INTL)
 777     Structure* collatorStructure() { return m_collatorStructure.get(this); }
 778     Structure* numberFormatStructure() { return m_numberFormatStructure.get(this); }
 779     Structure* dateTimeFormatStructure() { return m_dateTimeFormatStructure.get(this); }
 780     Structure* pluralRulesStructure() { return m_pluralRulesStructure.get(this); }
 781 #endif // ENABLE(INTL)
 782 
 783     JS_EXPORT_PRIVATE void setRemoteDebuggingEnabled(bool);
 784     JS_EXPORT_PRIVATE bool remoteDebuggingEnabled() const;
 785 
 786     RegExpGlobalData&amp; regExpGlobalData() { return m_regExpGlobalData; }
 787     static ptrdiff_t regExpGlobalDataOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_regExpGlobalData); }
 788 
 789 #if ENABLE(REMOTE_INSPECTOR)
 790     Inspector::JSGlobalObjectInspectorController&amp; inspectorController() const { return *m_inspectorController.get(); }
 791     JSGlobalObjectDebuggable&amp; inspectorDebuggable() { return *m_inspectorDebuggable.get(); }
 792 #endif
 793 
 794 #if ENABLE(INTL)
 795     const HashSet&lt;String&gt;&amp; intlCollatorAvailableLocales();
 796     const HashSet&lt;String&gt;&amp; intlDateTimeFormatAvailableLocales();
 797     const HashSet&lt;String&gt;&amp; intlNumberFormatAvailableLocales();
 798     const HashSet&lt;String&gt;&amp; intlPluralRulesAvailableLocales();
 799 #endif // ENABLE(INTL)
 800 
 801     void bumpGlobalLexicalBindingEpoch(VM&amp;);
 802     unsigned globalLexicalBindingEpoch() const { return m_globalLexicalBindingEpoch; }
 803     static ptrdiff_t globalLexicalBindingEpochOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_globalLexicalBindingEpoch); }
 804     unsigned* addressOfGlobalLexicalBindingEpoch() { return &amp;m_globalLexicalBindingEpoch; }
 805 
 806     void setConsoleClient(ConsoleClient* consoleClient) { m_consoleClient = consoleClient; }
 807     ConsoleClient* consoleClient() const { return m_consoleClient; }
 808 
 809     void setName(const String&amp;);
 810     const String&amp; name() const { return m_name; }
 811 
<a name="39" id="anc39"></a><span class="line-modified"> 812     void setUnhandledRejectionCallback(VM&amp; vm, JSObject* function) { m_unhandledRejectionCallback.set(vm, function); }</span>
<span class="line-added"> 813     JSObject* unhandledRejectionCallback() const { return m_unhandledRejectionCallback.get(); }</span>
<span class="line-added"> 814 </span>
<span class="line-added"> 815     JSObject* arrayBufferConstructor() const { return m_arrayBufferStructure.constructor(this); }</span>
<span class="line-added"> 816 </span>
<span class="line-added"> 817     JSObject* arrayBufferPrototype(ArrayBufferSharingMode sharingMode) const</span>
 818     {
 819         switch (sharingMode) {
 820         case ArrayBufferSharingMode::Default:
<a name="40" id="anc40"></a><span class="line-modified"> 821             return m_arrayBufferStructure.prototype(this);</span>
 822 #if ENABLE(SHARED_ARRAY_BUFFER)
 823         case ArrayBufferSharingMode::Shared:
 824             return m_sharedArrayBufferPrototype.get();
 825 #else
 826         default:
<a name="41" id="anc41"></a><span class="line-modified"> 827             return m_arrayBufferStructure.prototype(this);</span>
 828 #endif
 829         }
 830     }
 831     Structure* arrayBufferStructure(ArrayBufferSharingMode sharingMode) const
 832     {
 833         switch (sharingMode) {
 834         case ArrayBufferSharingMode::Default:
<a name="42" id="anc42"></a><span class="line-modified"> 835             return m_arrayBufferStructure.get(this);</span>
 836 #if ENABLE(SHARED_ARRAY_BUFFER)
 837         case ArrayBufferSharingMode::Shared:
 838             return m_sharedArrayBufferStructure.get();
 839 #else
 840         default:
<a name="43" id="anc43"></a><span class="line-modified"> 841             return m_arrayBufferStructure.get(this);</span>
 842 #endif
 843         }
 844         RELEASE_ASSERT_NOT_REACHED();
 845         return nullptr;
 846     }
 847 
<a name="44" id="anc44"></a><span class="line-modified"> 848 #define DEFINE_ACCESSORS_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
 849     Structure* properName ## Structure() { return m_ ## properName ## Structure.get(); }
 850 
 851     FOR_EACH_SIMPLE_BUILTIN_TYPE(DEFINE_ACCESSORS_FOR_SIMPLE_TYPE)
<a name="45" id="anc45"></a>

 852     FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(DEFINE_ACCESSORS_FOR_SIMPLE_TYPE)
 853 
 854 #undef DEFINE_ACCESSORS_FOR_SIMPLE_TYPE
 855 
<a name="46" id="anc46"></a><span class="line-modified"> 856 #define DEFINE_ACCESSORS_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
<span class="line-modified"> 857     Structure* properName ## Structure() { return m_ ## properName ## Structure.get(this); } \</span>
<span class="line-added"> 858     JSObject* properName ## Constructor() { return m_ ## properName ## Structure.constructor(this); }</span>
 859 
 860     FOR_EACH_LAZY_BUILTIN_TYPE(DEFINE_ACCESSORS_FOR_LAZY_TYPE)
<a name="47" id="anc47"></a><span class="line-added"> 861     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(DEFINE_ACCESSORS_FOR_LAZY_TYPE)</span>
 862 
 863 #undef DEFINE_ACCESSORS_FOR_LAZY_TYPE
 864 
 865     LazyClassStructure&amp; lazyTypedArrayStructure(TypedArrayType type)
 866     {
 867         switch (type) {
 868         case NotTypedArray:
 869             RELEASE_ASSERT_NOT_REACHED();
 870             return m_typedArrayInt8;
 871 #define TYPED_ARRAY_TYPE_CASE(name) case Type ## name: return m_typedArray ## name;
 872             FOR_EACH_TYPED_ARRAY_TYPE(TYPED_ARRAY_TYPE_CASE)
 873 #undef TYPED_ARRAY_TYPE_CASE
 874         }
 875         RELEASE_ASSERT_NOT_REACHED();
 876         return m_typedArrayInt8;
 877     }
 878     const LazyClassStructure&amp; lazyTypedArrayStructure(TypedArrayType type) const
 879     {
 880         return const_cast&lt;const LazyClassStructure&amp;&gt;(const_cast&lt;JSGlobalObject*&gt;(this)-&gt;lazyTypedArrayStructure(type));
 881     }
 882 
 883     Structure* typedArrayStructure(TypedArrayType type) const
 884     {
 885         return lazyTypedArrayStructure(type).get(this);
 886     }
 887     Structure* typedArrayStructureConcurrently(TypedArrayType type) const
 888     {
 889         return lazyTypedArrayStructure(type).getConcurrently();
 890     }
 891     bool isOriginalTypedArrayStructure(Structure* structure)
 892     {
 893         TypedArrayType type = structure-&gt;classInfo()-&gt;typedArrayStorageType;
 894         if (type == NotTypedArray)
 895             return false;
 896         return typedArrayStructureConcurrently(type) == structure;
 897     }
 898 
 899     JSObject* typedArrayConstructor(TypedArrayType type) const
 900     {
 901         return lazyTypedArrayStructure(type).constructor(this);
 902     }
 903 
 904     JSCell* actualPointerFor(Special::Pointer pointer)
 905     {
 906         ASSERT(pointer &lt; Special::TableSize);
 907         return m_specialPointers[pointer];
 908     }
 909     JSCell* jsCellForLinkTimeConstant(LinkTimeConstant type)
 910     {
 911         unsigned index = static_cast&lt;unsigned&gt;(type);
 912         ASSERT(index &lt; LinkTimeConstantCount);
 913         return m_linkTimeConstants[index];
 914     }
 915 
 916     WatchpointSet* masqueradesAsUndefinedWatchpoint() { return m_masqueradesAsUndefinedWatchpoint.get(); }
 917     WatchpointSet* havingABadTimeWatchpoint() { return m_havingABadTimeWatchpoint.get(); }
 918     WatchpointSet* varInjectionWatchpoint() { return m_varInjectionWatchpoint.get(); }
 919 
 920     bool isHavingABadTime() const
 921     {
 922         return m_havingABadTimeWatchpoint-&gt;hasBeenInvalidated();
 923     }
 924 
 925     void haveABadTime(VM&amp;);
 926 
 927     bool objectPrototypeIsSane();
 928     bool arrayPrototypeChainIsSane();
 929     bool stringPrototypeChainIsSane();
 930 
 931     void setProfileGroup(unsigned value) { createRareDataIfNeeded(); m_rareData-&gt;profileGroup = value; }
 932     unsigned profileGroup() const
 933     {
 934         if (!m_rareData)
 935             return 0;
 936         return m_rareData-&gt;profileGroup;
 937     }
 938 
 939     Debugger* debugger() const { return m_debugger; }
 940     void setDebugger(Debugger*);
 941 
 942     const GlobalObjectMethodTable* globalObjectMethodTable() const { return m_globalObjectMethodTable; }
 943 
 944     static bool supportsRichSourceInfo(const JSGlobalObject*) { return true; }
 945 
 946     JS_EXPORT_PRIVATE ExecState* globalExec();
 947 
 948     static bool shouldInterruptScript(const JSGlobalObject*) { return true; }
 949     static bool shouldInterruptScriptBeforeTimeout(const JSGlobalObject*) { return false; }
 950     static RuntimeFlags javaScriptRuntimeFlags(const JSGlobalObject*) { return RuntimeFlags(); }
 951 
 952     JS_EXPORT_PRIVATE void queueMicrotask(Ref&lt;Microtask&gt;&amp;&amp;);
 953 
 954     bool evalEnabled() const { return m_evalEnabled; }
 955     bool webAssemblyEnabled() const { return m_webAssemblyEnabled; }
 956     const String&amp; evalDisabledErrorMessage() const { return m_evalDisabledErrorMessage; }
 957     const String&amp; webAssemblyDisabledErrorMessage() const { return m_webAssemblyDisabledErrorMessage; }
 958     void setEvalEnabled(bool enabled, const String&amp; errorMessage = String())
 959     {
 960         m_evalEnabled = enabled;
 961         m_evalDisabledErrorMessage = errorMessage;
 962     }
 963     void setWebAssemblyEnabled(bool enabled, const String&amp; errorMessage = String())
 964     {
 965         m_webAssemblyEnabled = enabled;
 966         m_webAssemblyDisabledErrorMessage = errorMessage;
 967     }
 968 
 969 #if !ASSERT_DISABLED
 970     const ExecState* callFrameAtDebuggerEntry() const { return m_callFrameAtDebuggerEntry; }
 971     void setCallFrameAtDebuggerEntry(const ExecState* callFrame) { m_callFrameAtDebuggerEntry = callFrame; }
 972 #endif
 973 
 974     void resetPrototype(VM&amp;, JSValue prototype);
 975 
 976     VM&amp; vm() const { return m_vm; }
 977     JSObject* globalThis() const;
 978     WriteBarrier&lt;JSObject&gt;* addressOfGlobalThis() { return &amp;m_globalThis; }
<a name="48" id="anc48"></a><span class="line-added"> 979     OptionSet&lt;CodeGenerationMode&gt; defaultCodeGenerationMode() const;</span>
 980 
 981     static Structure* createStructure(VM&amp; vm, JSValue prototype)
 982     {
 983         Structure* result = Structure::create(vm, 0, prototype, TypeInfo(GlobalObjectType, StructureFlags), info());
 984         result-&gt;setTransitionWatchpointIsLikelyToBeFired(true);
 985         return result;
 986     }
 987 
 988     void registerWeakMap(OpaqueJSWeakObjectMap* map)
 989     {
 990         createRareDataIfNeeded();
 991         m_rareData-&gt;weakMaps.add(map);
 992     }
 993 
 994     void unregisterWeakMap(OpaqueJSWeakObjectMap* map)
 995     {
 996         if (m_rareData)
 997             m_rareData-&gt;weakMaps.remove(map);
 998     }
 999 
1000     OpaqueJSClassDataMap&amp; opaqueJSClassData()
1001     {
1002         createRareDataIfNeeded();
1003         return m_rareData-&gt;opaqueJSClassData;
1004     }
1005 
1006     static ptrdiff_t weakRandomOffset() { return OBJECT_OFFSETOF(JSGlobalObject, m_weakRandom); }
1007     double weakRandomNumber() { return m_weakRandom.get(); }
1008     unsigned weakRandomInteger() { return m_weakRandom.getUint32(); }
1009     WeakRandom&amp; weakRandom() { return m_weakRandom; }
1010 
1011     bool needsSiteSpecificQuirks() const { return m_needsSiteSpecificQuirks; }
1012     JS_EXPORT_PRIVATE void exposeDollarVM(VM&amp;);
1013 
1014 #if JSC_OBJC_API_ENABLED
1015     JSWrapperMap* wrapperMap() const { return m_wrapperMap.get(); }
1016     void setWrapperMap(JSWrapperMap* map) { m_wrapperMap = map; }
1017 #endif
1018 #ifdef JSC_GLIB_API_ENABLED
1019     WrapperMap* wrapperMap() const { return m_wrapperMap.get(); }
1020     void setWrapperMap(std::unique_ptr&lt;WrapperMap&gt;&amp;&amp;);
1021 #endif
1022 
<a name="49" id="anc49"></a><span class="line-added">1023     void tryInstallArraySpeciesWatchpoint(ExecState*);</span>
<span class="line-added">1024 </span>
1025 protected:
1026     struct GlobalPropertyInfo {
1027         GlobalPropertyInfo(const Identifier&amp; i, JSValue v, unsigned a)
1028             : identifier(i)
1029             , value(v)
1030             , attributes(a)
1031         {
1032         }
1033 
1034         const Identifier identifier;
1035         JSValue value;
1036         unsigned attributes;
1037     };
1038     JS_EXPORT_PRIVATE void addStaticGlobals(GlobalPropertyInfo*, int count);
1039 
1040     void setNeedsSiteSpecificQuirks(bool needQuirks) { m_needsSiteSpecificQuirks = needQuirks; }
1041 
1042 private:
1043     friend class LLIntOffsetsExtractor;
1044 
1045     void fireWatchpointAndMakeAllArrayStructuresSlowPut(VM&amp;);
1046     void setGlobalThis(VM&amp;, JSObject* globalThis);
1047 
1048     template&lt;ErrorType errorType&gt;
1049     void initializeErrorConstructor(LazyClassStructure::Initializer&amp;);
1050 
1051     JS_EXPORT_PRIVATE void init(VM&amp;);
<a name="50" id="anc50"></a><span class="line-added">1052     void fixupPrototypeChainWithObjectPrototype(VM&amp;);</span>
1053 
1054     JS_EXPORT_PRIVATE static void clearRareData(JSCell*);
1055 
1056     bool m_needsSiteSpecificQuirks { false };
1057 #if JSC_OBJC_API_ENABLED
1058     RetainPtr&lt;JSWrapperMap&gt; m_wrapperMap;
1059 #endif
1060 #ifdef JSC_GLIB_API_ENABLED
1061     std::unique_ptr&lt;WrapperMap&gt; m_wrapperMap;
1062 #endif
1063 };
1064 
1065 inline JSArray* constructEmptyArray(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, unsigned initialLength = 0, JSValue newTarget = JSValue())
1066 {
1067     VM&amp; vm = globalObject-&gt;vm();
1068     auto scope = DECLARE_THROW_SCOPE(vm);
1069     Structure* structure;
1070     if (initialLength &gt;= MIN_ARRAY_STORAGE_CONSTRUCTION_LENGTH)
1071         structure = globalObject-&gt;arrayStructureForIndexingTypeDuringAllocation(exec, ArrayWithArrayStorage, newTarget);
1072     else
1073         structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);
1074     RETURN_IF_EXCEPTION(scope, nullptr);
1075 
1076     JSArray* result = JSArray::tryCreate(vm, structure, initialLength);
1077     if (UNLIKELY(!result)) {
1078         throwOutOfMemoryError(exec, scope);
1079         return nullptr;
1080     }
1081     return ArrayAllocationProfile::updateLastAllocationFor(profile, result);
1082 }
1083 
1084 inline JSArray* constructEmptyArray(ExecState* exec, ArrayAllocationProfile* profile, unsigned initialLength = 0, JSValue newTarget = JSValue())
1085 {
1086     return constructEmptyArray(exec, profile, exec-&gt;lexicalGlobalObject(), initialLength, newTarget);
1087 }
1088 
1089 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, const ArgList&amp; values, JSValue newTarget = JSValue())
1090 {
1091     VM&amp; vm = globalObject-&gt;vm();
1092     auto scope = DECLARE_THROW_SCOPE(vm);
1093     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);
1094     RETURN_IF_EXCEPTION(scope, nullptr);
1095     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArray(exec, structure, values));
1096 }
1097 
1098 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, const ArgList&amp; values, JSValue newTarget = JSValue())
1099 {
1100     return constructArray(exec, profile, exec-&gt;lexicalGlobalObject(), values, newTarget);
1101 }
1102 
1103 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, const JSValue* values, unsigned length, JSValue newTarget = JSValue())
1104 {
1105     VM&amp; vm = globalObject-&gt;vm();
1106     auto scope = DECLARE_THROW_SCOPE(vm);
1107     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);
1108     RETURN_IF_EXCEPTION(scope, nullptr);
1109     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArray(exec, structure, values, length));
1110 }
1111 
1112 inline JSArray* constructArray(ExecState* exec, ArrayAllocationProfile* profile, const JSValue* values, unsigned length, JSValue newTarget = JSValue())
1113 {
1114     return constructArray(exec, profile, exec-&gt;lexicalGlobalObject(), values, length, newTarget);
1115 }
1116 
1117 inline JSArray* constructArrayNegativeIndexed(ExecState* exec, ArrayAllocationProfile* profile, JSGlobalObject* globalObject, const JSValue* values, unsigned length, JSValue newTarget = JSValue())
1118 {
1119     VM&amp; vm = globalObject-&gt;vm();
1120     auto scope = DECLARE_THROW_SCOPE(vm);
1121     Structure* structure = globalObject-&gt;arrayStructureForProfileDuringAllocation(exec, profile, newTarget);
1122     RETURN_IF_EXCEPTION(scope, nullptr);
1123     return ArrayAllocationProfile::updateLastAllocationFor(profile, constructArrayNegativeIndexed(exec, structure, values, length));
1124 }
1125 
1126 inline JSArray* constructArrayNegativeIndexed(ExecState* exec, ArrayAllocationProfile* profile, const JSValue* values, unsigned length, JSValue newTarget = JSValue())
1127 {
1128     return constructArrayNegativeIndexed(exec, profile, exec-&gt;lexicalGlobalObject(), values, length, newTarget);
1129 }
1130 
1131 inline JSObject* ExecState::globalThisValue() const
1132 {
1133     return lexicalGlobalObject()-&gt;globalThis();
1134 }
1135 
1136 inline JSObject* JSScope::globalThis()
1137 {
1138     return globalObject()-&gt;globalThis();
1139 }
1140 
1141 inline JSObject* JSGlobalObject::globalThis() const
1142 {
1143     return m_globalThis.get();
1144 }
1145 
<a name="51" id="anc51"></a><span class="line-added">1146 inline OptionSet&lt;CodeGenerationMode&gt; JSGlobalObject::defaultCodeGenerationMode() const</span>
<span class="line-added">1147 {</span>
<span class="line-added">1148     OptionSet&lt;CodeGenerationMode&gt; codeGenerationMode;</span>
<span class="line-added">1149     if (hasInteractiveDebugger() || Options::forceDebuggerBytecodeGeneration())</span>
<span class="line-added">1150         codeGenerationMode.add(CodeGenerationMode::Debugger);</span>
<span class="line-added">1151     if (m_vm.typeProfiler())</span>
<span class="line-added">1152         codeGenerationMode.add(CodeGenerationMode::TypeProfiler);</span>
<span class="line-added">1153     if (m_vm.controlFlowProfiler())</span>
<span class="line-added">1154         codeGenerationMode.add(CodeGenerationMode::ControlFlowProfiler);</span>
<span class="line-added">1155     return codeGenerationMode;</span>
<span class="line-added">1156 }</span>
<span class="line-added">1157 </span>
1158 } // namespace JSC
<a name="52" id="anc52"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="52" type="hidden" />
</body>
</html>