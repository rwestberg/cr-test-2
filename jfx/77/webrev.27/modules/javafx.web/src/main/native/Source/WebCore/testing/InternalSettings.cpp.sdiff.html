<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/testing/InternalSettings.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../svg/properties/SVGPropertyTraits.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InternalSettings.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/testing/InternalSettings.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  19  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  20  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  21  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  22  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  24  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  25  */
  26 
  27 #include &quot;config.h&quot;
  28 #include &quot;InternalSettings.h&quot;
  29 
  30 #include &quot;CaptionUserPreferences.h&quot;
  31 #include &quot;DeprecatedGlobalSettings.h&quot;
  32 #include &quot;Document.h&quot;
  33 #include &quot;FontCache.h&quot;
  34 #include &quot;Frame.h&quot;
  35 #include &quot;FrameView.h&quot;
  36 #include &quot;LocaleToScriptMapping.h&quot;
  37 #include &quot;Page.h&quot;
  38 #include &quot;PageGroup.h&quot;

  39 #include &quot;RenderTheme.h&quot;
  40 #include &quot;RuntimeEnabledFeatures.h&quot;
  41 #include &quot;Settings.h&quot;
  42 #include &quot;Supplementable.h&quot;
  43 #include &lt;wtf/Language.h&gt;
  44 
  45 #if ENABLE(INPUT_TYPE_COLOR)
  46 #include &quot;ColorChooser.h&quot;
  47 #endif
  48 
  49 #if USE(SOUP)
  50 #include &quot;SoupNetworkSession.h&quot;
  51 #endif
  52 
  53 namespace WebCore {
  54 
  55 InternalSettings::Backup::Backup(Settings&amp; settings)
  56     : m_originalEditingBehavior(settings.editingBehaviorType())
  57 #if ENABLE(TEXT_AUTOSIZING)
  58     , m_originalTextAutosizingEnabled(settings.textAutosizingEnabled())
  59     , m_originalTextAutosizingWindowSizeOverride(settings.textAutosizingWindowSizeOverride())

  60 #endif
  61     , m_originalMediaTypeOverride(settings.mediaTypeOverride())
  62     , m_originalCanvasUsesAcceleratedDrawing(settings.canvasUsesAcceleratedDrawing())
  63     , m_originalMockScrollbarsEnabled(DeprecatedGlobalSettings::mockScrollbarsEnabled())
  64     , m_imagesEnabled(settings.areImagesEnabled())
  65     , m_preferMIMETypeForImages(settings.preferMIMETypeForImages())
  66     , m_minimumDOMTimerInterval(settings.minimumDOMTimerInterval())
  67 #if ENABLE(VIDEO_TRACK)
  68     , m_shouldDisplaySubtitles(settings.shouldDisplaySubtitles())
  69     , m_shouldDisplayCaptions(settings.shouldDisplayCaptions())
  70     , m_shouldDisplayTextDescriptions(settings.shouldDisplayTextDescriptions())
  71 #endif
  72     , m_defaultVideoPosterURL(settings.defaultVideoPosterURL())
  73     , m_forcePendingWebGLPolicy(settings.isForcePendingWebGLPolicy())
  74     , m_originalTimeWithoutMouseMovementBeforeHidingControls(settings.timeWithoutMouseMovementBeforeHidingControls())
  75     , m_useLegacyBackgroundSizeShorthandBehavior(settings.useLegacyBackgroundSizeShorthandBehavior())
  76     , m_autoscrollForDragAndDropEnabled(settings.autoscrollForDragAndDropEnabled())
  77     , m_quickTimePluginReplacementEnabled(settings.quickTimePluginReplacementEnabled())
  78     , m_youTubeFlashPluginReplacementEnabled(settings.youTubeFlashPluginReplacementEnabled())
  79     , m_shouldConvertPositionStyleOnCopy(settings.shouldConvertPositionStyleOnCopy())
  80     , m_fontFallbackPrefersPictographs(settings.fontFallbackPrefersPictographs())
  81     , m_shouldIgnoreFontLoadCompletions(settings.shouldIgnoreFontLoadCompletions())
  82     , m_backgroundShouldExtendBeyondPage(settings.backgroundShouldExtendBeyondPage())
  83     , m_storageBlockingPolicy(settings.storageBlockingPolicy())
  84     , m_scrollingTreeIncludesFrames(settings.scrollingTreeIncludesFrames())
  85 #if ENABLE(TOUCH_EVENTS)
  86     , m_touchEventEmulationEnabled(settings.isTouchEventEmulationEnabled())
  87 #endif
  88 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
  89     , m_allowsAirPlayForMediaPlayback(settings.allowsAirPlayForMediaPlayback())
  90 #endif
  91     , m_allowsInlineMediaPlayback(settings.allowsInlineMediaPlayback())
  92     , m_allowsInlineMediaPlaybackAfterFullscreen(settings.allowsInlineMediaPlaybackAfterFullscreen())
  93     , m_inlineMediaPlaybackRequiresPlaysInlineAttribute(settings.inlineMediaPlaybackRequiresPlaysInlineAttribute())
  94     , m_deferredCSSParserEnabled(settings.deferredCSSParserEnabled())
  95     , m_inputEventsEnabled(settings.inputEventsEnabled())
  96     , m_incompleteImageBorderEnabled(settings.incompleteImageBorderEnabled())
<span class="line-modified">  97 #if ENABLE(ACCESSIBILITY_EVENTS)</span>
<span class="line-modified">  98     , m_accessibilityEventsEnabled(settings.accessibilityEventsEnabled())</span>
<span class="line-modified">  99 #endif</span>

 100     , m_userInterfaceDirectionPolicy(settings.userInterfaceDirectionPolicy())
 101     , m_systemLayoutDirection(settings.systemLayoutDirection())
 102     , m_pdfImageCachingPolicy(settings.pdfImageCachingPolicy())
 103     , m_forcedColorsAreInvertedAccessibilityValue(settings.forcedColorsAreInvertedAccessibilityValue())
 104     , m_forcedDisplayIsMonochromeAccessibilityValue(settings.forcedDisplayIsMonochromeAccessibilityValue())
 105     , m_forcedPrefersReducedMotionAccessibilityValue(settings.forcedPrefersReducedMotionAccessibilityValue())
 106     , m_fontLoadTimingOverride(settings.fontLoadTimingOverride())
 107     , m_frameFlattening(settings.frameFlattening())
 108 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 109     , m_indexedDBWorkersEnabled(RuntimeEnabledFeatures::sharedFeatures().indexedDBWorkersEnabled())
 110 #endif
 111 #if ENABLE(WEBGL2)
 112     , m_webGL2Enabled(RuntimeEnabledFeatures::sharedFeatures().webGL2Enabled())
<span class="line-removed"> 113 #endif</span>
<span class="line-removed"> 114 #if ENABLE(WEBMETAL)</span>
<span class="line-removed"> 115     , m_webMetalEnabled(RuntimeEnabledFeatures::sharedFeatures().webMetalEnabled())</span>
 116 #endif
 117     , m_webVREnabled(RuntimeEnabledFeatures::sharedFeatures().webVREnabled())
 118 #if ENABLE(MEDIA_STREAM)
 119     , m_setScreenCaptureEnabled(RuntimeEnabledFeatures::sharedFeatures().screenCaptureEnabled())
 120 #endif
 121     , m_shouldMockBoldSystemFontForAccessibility(RenderTheme::singleton().shouldMockBoldSystemFontForAccessibility())
 122 #if USE(AUDIO_SESSION)
 123     , m_shouldManageAudioSessionCategory(DeprecatedGlobalSettings::shouldManageAudioSessionCategory())
 124 #endif
 125     , m_customPasteboardDataEnabled(RuntimeEnabledFeatures::sharedFeatures().customPasteboardDataEnabled())
<span class="line-removed"> 126     , m_promptForStorageAccessAPIEnabled(RuntimeEnabledFeatures::sharedFeatures().storageAccessPromptsEnabled())</span>
 127 {
 128 }
 129 
 130 void InternalSettings::Backup::restoreTo(Settings&amp; settings)
 131 {
 132     settings.setEditingBehaviorType(m_originalEditingBehavior);
 133 
 134     for (const auto&amp; standardFont : m_standardFontFamilies)
 135         settings.setStandardFontFamily(standardFont.value, static_cast&lt;UScriptCode&gt;(standardFont.key));
 136     m_standardFontFamilies.clear();
 137 
 138     for (const auto&amp; fixedFont : m_fixedFontFamilies)
 139         settings.setFixedFontFamily(fixedFont.value, static_cast&lt;UScriptCode&gt;(fixedFont.key));
 140     m_fixedFontFamilies.clear();
 141 
 142     for (const auto&amp; serifFont : m_serifFontFamilies)
 143         settings.setSerifFontFamily(serifFont.value, static_cast&lt;UScriptCode&gt;(serifFont.key));
 144     m_serifFontFamilies.clear();
 145 
 146     for (const auto&amp; sansSerifFont : m_sansSerifFontFamilies)
 147         settings.setSansSerifFontFamily(sansSerifFont.value, static_cast&lt;UScriptCode&gt;(sansSerifFont.key));
 148     m_sansSerifFontFamilies.clear();
 149 
 150     for (const auto&amp; cursiveFont : m_cursiveFontFamilies)
 151         settings.setCursiveFontFamily(cursiveFont.value, static_cast&lt;UScriptCode&gt;(cursiveFont.key));
 152     m_cursiveFontFamilies.clear();
 153 
 154     for (const auto&amp; fantasyFont : m_fantasyFontFamilies)
 155         settings.setFantasyFontFamily(fantasyFont.value, static_cast&lt;UScriptCode&gt;(fantasyFont.key));
 156     m_fantasyFontFamilies.clear();
 157 
 158     for (const auto&amp; pictographFont : m_pictographFontFamilies)
 159         settings.setPictographFontFamily(pictographFont.value, static_cast&lt;UScriptCode&gt;(pictographFont.key));
 160     m_pictographFontFamilies.clear();
 161 
 162 #if ENABLE(TEXT_AUTOSIZING)
 163     settings.setTextAutosizingEnabled(m_originalTextAutosizingEnabled);
 164     settings.setTextAutosizingWindowSizeOverride(m_originalTextAutosizingWindowSizeOverride);

 165 #endif
 166     settings.setMediaTypeOverride(m_originalMediaTypeOverride);
 167     settings.setCanvasUsesAcceleratedDrawing(m_originalCanvasUsesAcceleratedDrawing);
 168     settings.setImagesEnabled(m_imagesEnabled);
 169     settings.setPreferMIMETypeForImages(m_preferMIMETypeForImages);
 170     settings.setMinimumDOMTimerInterval(m_minimumDOMTimerInterval);
 171 #if ENABLE(VIDEO_TRACK)
 172     settings.setShouldDisplaySubtitles(m_shouldDisplaySubtitles);
 173     settings.setShouldDisplayCaptions(m_shouldDisplayCaptions);
 174     settings.setShouldDisplayTextDescriptions(m_shouldDisplayTextDescriptions);
 175 #endif
 176     settings.setDefaultVideoPosterURL(m_defaultVideoPosterURL);
 177     settings.setForcePendingWebGLPolicy(m_forcePendingWebGLPolicy);
 178     settings.setTimeWithoutMouseMovementBeforeHidingControls(m_originalTimeWithoutMouseMovementBeforeHidingControls);
 179     settings.setUseLegacyBackgroundSizeShorthandBehavior(m_useLegacyBackgroundSizeShorthandBehavior);
 180     settings.setAutoscrollForDragAndDropEnabled(m_autoscrollForDragAndDropEnabled);
 181     settings.setShouldConvertPositionStyleOnCopy(m_shouldConvertPositionStyleOnCopy);
 182     settings.setFontFallbackPrefersPictographs(m_fontFallbackPrefersPictographs);
 183     settings.setShouldIgnoreFontLoadCompletions(m_shouldIgnoreFontLoadCompletions);
 184     settings.setBackgroundShouldExtendBeyondPage(m_backgroundShouldExtendBeyondPage);
</pre>
<hr />
<pre>
 189 #endif
 190     settings.setAllowsInlineMediaPlayback(m_allowsInlineMediaPlayback);
 191     settings.setAllowsInlineMediaPlaybackAfterFullscreen(m_allowsInlineMediaPlaybackAfterFullscreen);
 192     settings.setInlineMediaPlaybackRequiresPlaysInlineAttribute(m_inlineMediaPlaybackRequiresPlaysInlineAttribute);
 193     settings.setQuickTimePluginReplacementEnabled(m_quickTimePluginReplacementEnabled);
 194     settings.setYouTubeFlashPluginReplacementEnabled(m_youTubeFlashPluginReplacementEnabled);
 195     settings.setDeferredCSSParserEnabled(m_deferredCSSParserEnabled);
 196     settings.setInputEventsEnabled(m_inputEventsEnabled);
 197     settings.setUserInterfaceDirectionPolicy(m_userInterfaceDirectionPolicy);
 198     settings.setSystemLayoutDirection(m_systemLayoutDirection);
 199     settings.setPdfImageCachingPolicy(m_pdfImageCachingPolicy);
 200     settings.setForcedColorsAreInvertedAccessibilityValue(m_forcedColorsAreInvertedAccessibilityValue);
 201     settings.setForcedDisplayIsMonochromeAccessibilityValue(m_forcedDisplayIsMonochromeAccessibilityValue);
 202     settings.setForcedPrefersReducedMotionAccessibilityValue(m_forcedPrefersReducedMotionAccessibilityValue);
 203     settings.setFontLoadTimingOverride(m_fontLoadTimingOverride);
 204     DeprecatedGlobalSettings::setAllowsAnySSLCertificate(false);
 205     RenderTheme::singleton().setShouldMockBoldSystemFontForAccessibility(m_shouldMockBoldSystemFontForAccessibility);
 206     FontCache::singleton().setShouldMockBoldSystemFontForAccessibility(m_shouldMockBoldSystemFontForAccessibility);
 207     settings.setFrameFlattening(m_frameFlattening);
 208     settings.setIncompleteImageBorderEnabled(m_incompleteImageBorderEnabled);
<span class="line-modified"> 209 #if ENABLE(ACCESSIBILITY_EVENTS)</span>
<span class="line-modified"> 210     settings.setAccessibilityEventsEnabled(m_accessibilityEventsEnabled);</span>
<span class="line-modified"> 211 #endif</span>

 212 
 213 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 214     RuntimeEnabledFeatures::sharedFeatures().setIndexedDBWorkersEnabled(m_indexedDBWorkersEnabled);
 215 #endif
 216 #if ENABLE(WEBGL2)
 217     RuntimeEnabledFeatures::sharedFeatures().setWebGL2Enabled(m_webGL2Enabled);
<span class="line-removed"> 218 #endif</span>
<span class="line-removed"> 219 #if ENABLE(WEBMETAL)</span>
<span class="line-removed"> 220     RuntimeEnabledFeatures::sharedFeatures().setWebMetalEnabled(m_webMetalEnabled);</span>
 221 #endif
 222     RuntimeEnabledFeatures::sharedFeatures().setWebVREnabled(m_webVREnabled);
 223 #if ENABLE(MEDIA_STREAM)
 224     RuntimeEnabledFeatures::sharedFeatures().setScreenCaptureEnabled(m_setScreenCaptureEnabled);
 225 #endif
 226     RuntimeEnabledFeatures::sharedFeatures().setCustomPasteboardDataEnabled(m_customPasteboardDataEnabled);
 227 
 228 #if USE(AUDIO_SESSION)
 229     DeprecatedGlobalSettings::setShouldManageAudioSessionCategory(m_shouldManageAudioSessionCategory);
 230 #endif
<span class="line-removed"> 231 </span>
<span class="line-removed"> 232     RuntimeEnabledFeatures::sharedFeatures().setStorageAccessPromptsEnabled(m_promptForStorageAccessAPIEnabled);</span>
 233 }
 234 
 235 class InternalSettingsWrapper : public Supplement&lt;Page&gt; {

 236 public:
 237     explicit InternalSettingsWrapper(Page* page)
 238         : m_internalSettings(InternalSettings::create(page)) { }
 239     virtual ~InternalSettingsWrapper() { m_internalSettings-&gt;hostDestroyed(); }
 240 #if !ASSERT_DISABLED
 241     bool isRefCountedWrapper() const override { return true; }
 242 #endif
 243     InternalSettings* internalSettings() const { return m_internalSettings.get(); }
 244 
 245 private:
 246     RefPtr&lt;InternalSettings&gt; m_internalSettings;
 247 };
 248 
 249 const char* InternalSettings::supplementName()
 250 {
 251     return &quot;InternalSettings&quot;;
 252 }
 253 
 254 InternalSettings* InternalSettings::from(Page* page)
 255 {
 256     if (!Supplement&lt;Page&gt;::from(page, supplementName()))
<span class="line-modified"> 257         Supplement&lt;Page&gt;::provideTo(page, supplementName(), std::make_unique&lt;InternalSettingsWrapper&gt;(page));</span>
 258     return static_cast&lt;InternalSettingsWrapper*&gt;(Supplement&lt;Page&gt;::from(page, supplementName()))-&gt;internalSettings();
 259 }
 260 
 261 void InternalSettings::hostDestroyed()
 262 {
 263     m_page = nullptr;
 264 }
 265 
 266 InternalSettings::InternalSettings(Page* page)
 267     : InternalSettingsGenerated(page)
 268     , m_page(page)
 269     , m_backup(page-&gt;settings())
 270 {
 271 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 272     setAllowsAirPlayForMediaPlayback(false);
 273 #endif
 274 #if ENABLE(MEDIA_STREAM)
 275     setMediaCaptureRequiresSecureConnection(false);
 276 #endif
 277 }
 278 
 279 Ref&lt;InternalSettings&gt; InternalSettings::create(Page* page)
 280 {
 281     return adoptRef(*new InternalSettings(page));
 282 }
 283 
 284 void InternalSettings::resetToConsistentState()
 285 {
 286     m_page-&gt;setPageScaleFactor(1, { 0, 0 });
 287     m_page-&gt;mainFrame().setPageAndTextZoomFactors(1, 1);
 288     m_page-&gt;setCanStartMedia(true);
<span class="line-modified"> 289     m_page-&gt;setUseDarkAppearance(false);</span>
 290 
 291     settings().setForcePendingWebGLPolicy(false);
 292 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 293     settings().setAllowsAirPlayForMediaPlayback(false);
 294 #endif
 295 #if ENABLE(MEDIA_STREAM)
 296     setMediaCaptureRequiresSecureConnection(false);
 297 #endif
 298 
 299     m_backup.restoreTo(settings());
 300     m_backup = Backup { settings() };
 301 
 302     InternalSettingsGenerated::resetToConsistentState();
 303 }
 304 
 305 Settings&amp; InternalSettings::settings() const
 306 {
 307     ASSERT(m_page);
 308     return m_page-&gt;settings();
 309 }
</pre>
<hr />
<pre>
 412     settings().setTextAutosizingEnabled(enabled);
 413 #else
 414     UNUSED_PARAM(enabled);
 415 #endif
 416     return { };
 417 }
 418 
 419 ExceptionOr&lt;void&gt; InternalSettings::setTextAutosizingWindowSizeOverride(int width, int height)
 420 {
 421     if (!m_page)
 422         return Exception { InvalidAccessError };
 423 #if ENABLE(TEXT_AUTOSIZING)
 424     settings().setTextAutosizingWindowSizeOverride(IntSize(width, height));
 425 #else
 426     UNUSED_PARAM(width);
 427     UNUSED_PARAM(height);
 428 #endif
 429     return { };
 430 }
 431 












 432 ExceptionOr&lt;void&gt; InternalSettings::setMediaTypeOverride(const String&amp; mediaType)
 433 {
 434     if (!m_page)
 435         return Exception { InvalidAccessError };
 436     settings().setMediaTypeOverride(mediaType);
 437     return { };
 438 }
 439 
 440 ExceptionOr&lt;void&gt; InternalSettings::setCanStartMedia(bool enabled)
 441 {
 442     if (!m_page)
 443         return Exception { InvalidAccessError };
 444     m_page-&gt;setCanStartMedia(enabled);
 445     return { };
 446 }
 447 
 448 ExceptionOr&lt;void&gt; InternalSettings::setAllowsAirPlayForMediaPlayback(bool allows)
 449 {
 450     if (!m_page)
 451         return Exception { InvalidAccessError };
</pre>
<hr />
<pre>
 510 ExceptionOr&lt;bool&gt; InternalSettings::shouldDisplayTrackKind(const String&amp; kind)
 511 {
 512     if (!m_page)
 513         return Exception { InvalidAccessError };
 514 #if ENABLE(VIDEO_TRACK)
 515     auto&amp; captionPreferences = m_page-&gt;group().captionPreferences();
 516     if (equalLettersIgnoringASCIICase(kind, &quot;subtitles&quot;))
 517         return captionPreferences.userPrefersSubtitles();
 518     if (equalLettersIgnoringASCIICase(kind, &quot;captions&quot;))
 519         return captionPreferences.userPrefersCaptions();
 520     if (equalLettersIgnoringASCIICase(kind, &quot;textdescriptions&quot;))
 521         return captionPreferences.userPrefersTextDescriptions();
 522 
 523     return Exception { SyntaxError };
 524 #else
 525     UNUSED_PARAM(kind);
 526     return false;
 527 #endif
 528 }
 529 






 530 ExceptionOr&lt;void&gt; InternalSettings::setUseDarkAppearance(bool useDarkAppearance)
 531 {
 532     if (!m_page)
 533         return Exception { InvalidAccessError };
<span class="line-modified"> 534     m_page-&gt;setUseDarkAppearance(useDarkAppearance);</span>
 535     return { };
 536 }
 537 
 538 ExceptionOr&lt;void&gt; InternalSettings::setStorageBlockingPolicy(const String&amp; mode)
 539 {
 540     if (!m_page)
 541         return Exception { InvalidAccessError };
 542     if (mode == &quot;AllowAll&quot;)
 543         settings().setStorageBlockingPolicy(SecurityOrigin::AllowAllStorage);
 544     else if (mode == &quot;BlockThirdParty&quot;)
 545         settings().setStorageBlockingPolicy(SecurityOrigin::BlockThirdPartyStorage);
 546     else if (mode == &quot;BlockAll&quot;)
 547         settings().setStorageBlockingPolicy(SecurityOrigin::BlockAllStorage);
 548     else
 549         return Exception { SyntaxError };
 550     return { };
 551 }
 552 
 553 ExceptionOr&lt;void&gt; InternalSettings::setPreferMIMETypeForImages(bool preferMIMETypeForImages)
 554 {
</pre>
<hr />
<pre>
 732     return { };
 733 }
 734 
 735 ExceptionOr&lt;void&gt; InternalSettings::setInlineMediaPlaybackRequiresPlaysInlineAttribute(bool requires)
 736 {
 737     if (!m_page)
 738         return Exception { InvalidAccessError };
 739     settings().setInlineMediaPlaybackRequiresPlaysInlineAttribute(requires);
 740     return { };
 741 }
 742 
 743 ExceptionOr&lt;void&gt; InternalSettings::setShouldMockBoldSystemFontForAccessibility(bool requires)
 744 {
 745     if (!m_page)
 746         return Exception { InvalidAccessError };
 747     RenderTheme::singleton().setShouldMockBoldSystemFontForAccessibility(requires);
 748     FontCache::singleton().setShouldMockBoldSystemFontForAccessibility(requires);
 749     return { };
 750 }
 751 








 752 void InternalSettings::setIndexedDBWorkersEnabled(bool enabled)
 753 {
 754 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 755     RuntimeEnabledFeatures::sharedFeatures().setIndexedDBWorkersEnabled(enabled);
 756 #else
 757     UNUSED_PARAM(enabled);
 758 #endif
 759 }
 760 
 761 void InternalSettings::setWebGL2Enabled(bool enabled)
 762 {
 763 #if ENABLE(WEBGL2)
 764     RuntimeEnabledFeatures::sharedFeatures().setWebGL2Enabled(enabled);
 765 #else
 766     UNUSED_PARAM(enabled);
 767 #endif
 768 }
 769 
<span class="line-modified"> 770 void InternalSettings::setWebMetalEnabled(bool enabled)</span>
 771 {
<span class="line-modified"> 772 #if ENABLE(WEBMETAL)</span>
<span class="line-modified"> 773     RuntimeEnabledFeatures::sharedFeatures().setWebMetalEnabled(enabled);</span>
 774 #else
 775     UNUSED_PARAM(enabled);
 776 #endif
 777 }
 778 
 779 void InternalSettings::setWebVREnabled(bool enabled)
 780 {
 781     RuntimeEnabledFeatures::sharedFeatures().setWebVREnabled(enabled);
 782 }
 783 
 784 void InternalSettings::setScreenCaptureEnabled(bool enabled)
 785 {
 786 #if ENABLE(MEDIA_STREAM)
 787     RuntimeEnabledFeatures::sharedFeatures().setScreenCaptureEnabled(enabled);
 788 #else
 789     UNUSED_PARAM(enabled);
 790 #endif
 791 }
 792 
<span class="line-removed"> 793 void InternalSettings::setStorageAccessPromptsEnabled(bool enabled)</span>
<span class="line-removed"> 794 {</span>
<span class="line-removed"> 795     RuntimeEnabledFeatures::sharedFeatures().setStorageAccessPromptsEnabled(enabled);</span>
<span class="line-removed"> 796 }</span>
<span class="line-removed"> 797 </span>
 798 ExceptionOr&lt;String&gt; InternalSettings::userInterfaceDirectionPolicy()
 799 {
 800     if (!m_page)
 801         return Exception { InvalidAccessError };
 802     switch (settings().userInterfaceDirectionPolicy()) {
 803     case UserInterfaceDirectionPolicy::Content:
 804         return &quot;Content&quot;_str;
 805     case UserInterfaceDirectionPolicy::System:
 806         return &quot;View&quot;_str;
 807     }
 808     ASSERT_NOT_REACHED();
 809     return Exception { InvalidAccessError };
 810 }
 811 
 812 ExceptionOr&lt;void&gt; InternalSettings::setUserInterfaceDirectionPolicy(const String&amp; policy)
 813 {
 814     if (!m_page)
 815         return Exception { InvalidAccessError };
 816     if (equalLettersIgnoringASCIICase(policy, &quot;content&quot;)) {
 817         settings().setUserInterfaceDirectionPolicy(UserInterfaceDirectionPolicy::Content);
</pre>
<hr />
<pre>
 884     return { };
 885 }
 886 
 887 ExceptionOr&lt;void&gt; InternalSettings::setShouldManageAudioSessionCategory(bool should)
 888 {
 889 #if USE(AUDIO_SESSION)
 890     DeprecatedGlobalSettings::setShouldManageAudioSessionCategory(should);
 891     return { };
 892 #else
 893     UNUSED_PARAM(should);
 894     return Exception { InvalidAccessError };
 895 #endif
 896 }
 897 
 898 ExceptionOr&lt;void&gt; InternalSettings::setCustomPasteboardDataEnabled(bool enabled)
 899 {
 900     RuntimeEnabledFeatures::sharedFeatures().setCustomPasteboardDataEnabled(enabled);
 901     return { };
 902 }
 903 
<span class="line-modified"> 904 ExceptionOr&lt;void&gt; InternalSettings::setAccessibilityEventsEnabled(bool enabled)</span>
 905 {
 906     if (!m_page)
 907         return Exception { InvalidAccessError };
<span class="line-modified"> 908 #if ENABLE(ACCESSIBILITY_EVENTS)</span>
<span class="line-removed"> 909     settings().setAccessibilityEventsEnabled(enabled);</span>
<span class="line-removed"> 910 #else</span>
<span class="line-removed"> 911     UNUSED_PARAM(enabled);</span>
<span class="line-removed"> 912 #endif</span>
 913     return { };
 914 }
 915 
<span class="line-modified"> 916 ExceptionOr&lt;void&gt; InternalSettings::setIncompleteImageBorderEnabled(bool enabled)</span>
 917 {
 918     if (!m_page)
 919         return Exception { InvalidAccessError };
<span class="line-modified"> 920     settings().setIncompleteImageBorderEnabled(enabled);</span>








 921     return { };
 922 }
 923 
 924 static InternalSettings::ForcedAccessibilityValue settingsToInternalSettingsValue(Settings::ForcedAccessibilityValue value)
 925 {
 926     switch (value) {
 927     case Settings::ForcedAccessibilityValue::System:
 928         return InternalSettings::ForcedAccessibilityValue::System;
 929     case Settings::ForcedAccessibilityValue::On:
 930         return InternalSettings::ForcedAccessibilityValue::On;
 931     case Settings::ForcedAccessibilityValue::Off:
 932         return InternalSettings::ForcedAccessibilityValue::Off;
 933     }
 934 
 935     ASSERT_NOT_REACHED();
 936     return InternalSettings::ForcedAccessibilityValue::Off;
 937 }
 938 
 939 static Settings::ForcedAccessibilityValue internalSettingsToSettingsValue(InternalSettings::ForcedAccessibilityValue value)
 940 {
</pre>
<hr />
<pre>
 969 void InternalSettings::setForcedDisplayIsMonochromeAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
 970 {
 971     settings().setForcedDisplayIsMonochromeAccessibilityValue(internalSettingsToSettingsValue(value));
 972 }
 973 
 974 InternalSettings::ForcedAccessibilityValue InternalSettings::forcedPrefersReducedMotionAccessibilityValue() const
 975 {
 976     return settingsToInternalSettingsValue(settings().forcedPrefersReducedMotionAccessibilityValue());
 977 }
 978 
 979 void InternalSettings::setForcedPrefersReducedMotionAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
 980 {
 981     settings().setForcedPrefersReducedMotionAccessibilityValue(internalSettingsToSettingsValue(value));
 982 }
 983 
 984 bool InternalSettings::webAnimationsCSSIntegrationEnabled()
 985 {
 986     return RuntimeEnabledFeatures::sharedFeatures().webAnimationsCSSIntegrationEnabled();
 987 }
 988 





 989 // If you add to this class, make sure that you update the Backup class for test reproducability!
 990 
 991 }
</pre>
</td>
<td>
<hr />
<pre>
  19  * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
  20  * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
  21  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
  22  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  23  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
  24  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  25  */
  26 
  27 #include &quot;config.h&quot;
  28 #include &quot;InternalSettings.h&quot;
  29 
  30 #include &quot;CaptionUserPreferences.h&quot;
  31 #include &quot;DeprecatedGlobalSettings.h&quot;
  32 #include &quot;Document.h&quot;
  33 #include &quot;FontCache.h&quot;
  34 #include &quot;Frame.h&quot;
  35 #include &quot;FrameView.h&quot;
  36 #include &quot;LocaleToScriptMapping.h&quot;
  37 #include &quot;Page.h&quot;
  38 #include &quot;PageGroup.h&quot;
<span class="line-added">  39 #include &quot;PlatformMediaSessionManager.h&quot;</span>
  40 #include &quot;RenderTheme.h&quot;
  41 #include &quot;RuntimeEnabledFeatures.h&quot;
  42 #include &quot;Settings.h&quot;
  43 #include &quot;Supplementable.h&quot;
  44 #include &lt;wtf/Language.h&gt;
  45 
  46 #if ENABLE(INPUT_TYPE_COLOR)
  47 #include &quot;ColorChooser.h&quot;
  48 #endif
  49 
  50 #if USE(SOUP)
  51 #include &quot;SoupNetworkSession.h&quot;
  52 #endif
  53 
  54 namespace WebCore {
  55 
  56 InternalSettings::Backup::Backup(Settings&amp; settings)
  57     : m_originalEditingBehavior(settings.editingBehaviorType())
  58 #if ENABLE(TEXT_AUTOSIZING)
  59     , m_originalTextAutosizingEnabled(settings.textAutosizingEnabled())
  60     , m_originalTextAutosizingWindowSizeOverride(settings.textAutosizingWindowSizeOverride())
<span class="line-added">  61     , m_originalTextAutosizingUsesIdempotentMode(settings.textAutosizingUsesIdempotentMode())</span>
  62 #endif
  63     , m_originalMediaTypeOverride(settings.mediaTypeOverride())
  64     , m_originalCanvasUsesAcceleratedDrawing(settings.canvasUsesAcceleratedDrawing())
  65     , m_originalMockScrollbarsEnabled(DeprecatedGlobalSettings::mockScrollbarsEnabled())
  66     , m_imagesEnabled(settings.areImagesEnabled())
  67     , m_preferMIMETypeForImages(settings.preferMIMETypeForImages())
  68     , m_minimumDOMTimerInterval(settings.minimumDOMTimerInterval())
  69 #if ENABLE(VIDEO_TRACK)
  70     , m_shouldDisplaySubtitles(settings.shouldDisplaySubtitles())
  71     , m_shouldDisplayCaptions(settings.shouldDisplayCaptions())
  72     , m_shouldDisplayTextDescriptions(settings.shouldDisplayTextDescriptions())
  73 #endif
  74     , m_defaultVideoPosterURL(settings.defaultVideoPosterURL())
  75     , m_forcePendingWebGLPolicy(settings.isForcePendingWebGLPolicy())
  76     , m_originalTimeWithoutMouseMovementBeforeHidingControls(settings.timeWithoutMouseMovementBeforeHidingControls())
  77     , m_useLegacyBackgroundSizeShorthandBehavior(settings.useLegacyBackgroundSizeShorthandBehavior())
  78     , m_autoscrollForDragAndDropEnabled(settings.autoscrollForDragAndDropEnabled())
  79     , m_quickTimePluginReplacementEnabled(settings.quickTimePluginReplacementEnabled())
  80     , m_youTubeFlashPluginReplacementEnabled(settings.youTubeFlashPluginReplacementEnabled())
  81     , m_shouldConvertPositionStyleOnCopy(settings.shouldConvertPositionStyleOnCopy())
  82     , m_fontFallbackPrefersPictographs(settings.fontFallbackPrefersPictographs())
  83     , m_shouldIgnoreFontLoadCompletions(settings.shouldIgnoreFontLoadCompletions())
  84     , m_backgroundShouldExtendBeyondPage(settings.backgroundShouldExtendBeyondPage())
  85     , m_storageBlockingPolicy(settings.storageBlockingPolicy())
  86     , m_scrollingTreeIncludesFrames(settings.scrollingTreeIncludesFrames())
  87 #if ENABLE(TOUCH_EVENTS)
  88     , m_touchEventEmulationEnabled(settings.isTouchEventEmulationEnabled())
  89 #endif
  90 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
  91     , m_allowsAirPlayForMediaPlayback(settings.allowsAirPlayForMediaPlayback())
  92 #endif
  93     , m_allowsInlineMediaPlayback(settings.allowsInlineMediaPlayback())
  94     , m_allowsInlineMediaPlaybackAfterFullscreen(settings.allowsInlineMediaPlaybackAfterFullscreen())
  95     , m_inlineMediaPlaybackRequiresPlaysInlineAttribute(settings.inlineMediaPlaybackRequiresPlaysInlineAttribute())
  96     , m_deferredCSSParserEnabled(settings.deferredCSSParserEnabled())
  97     , m_inputEventsEnabled(settings.inputEventsEnabled())
  98     , m_incompleteImageBorderEnabled(settings.incompleteImageBorderEnabled())
<span class="line-modified">  99     , m_shouldDispatchSyntheticMouseEventsWhenModifyingSelection(settings.shouldDispatchSyntheticMouseEventsWhenModifyingSelection())</span>
<span class="line-modified"> 100     , m_shouldDispatchSyntheticMouseOutAfterSyntheticClick(settings.shouldDispatchSyntheticMouseOutAfterSyntheticClick())</span>
<span class="line-modified"> 101     , m_shouldDeactivateAudioSession(PlatformMediaSessionManager::shouldDeactivateAudioSession())</span>
<span class="line-added"> 102     , m_animatedImageDebugCanvasDrawingEnabled(settings.animatedImageDebugCanvasDrawingEnabled())</span>
 103     , m_userInterfaceDirectionPolicy(settings.userInterfaceDirectionPolicy())
 104     , m_systemLayoutDirection(settings.systemLayoutDirection())
 105     , m_pdfImageCachingPolicy(settings.pdfImageCachingPolicy())
 106     , m_forcedColorsAreInvertedAccessibilityValue(settings.forcedColorsAreInvertedAccessibilityValue())
 107     , m_forcedDisplayIsMonochromeAccessibilityValue(settings.forcedDisplayIsMonochromeAccessibilityValue())
 108     , m_forcedPrefersReducedMotionAccessibilityValue(settings.forcedPrefersReducedMotionAccessibilityValue())
 109     , m_fontLoadTimingOverride(settings.fontLoadTimingOverride())
 110     , m_frameFlattening(settings.frameFlattening())
 111 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 112     , m_indexedDBWorkersEnabled(RuntimeEnabledFeatures::sharedFeatures().indexedDBWorkersEnabled())
 113 #endif
 114 #if ENABLE(WEBGL2)
 115     , m_webGL2Enabled(RuntimeEnabledFeatures::sharedFeatures().webGL2Enabled())



 116 #endif
 117     , m_webVREnabled(RuntimeEnabledFeatures::sharedFeatures().webVREnabled())
 118 #if ENABLE(MEDIA_STREAM)
 119     , m_setScreenCaptureEnabled(RuntimeEnabledFeatures::sharedFeatures().screenCaptureEnabled())
 120 #endif
 121     , m_shouldMockBoldSystemFontForAccessibility(RenderTheme::singleton().shouldMockBoldSystemFontForAccessibility())
 122 #if USE(AUDIO_SESSION)
 123     , m_shouldManageAudioSessionCategory(DeprecatedGlobalSettings::shouldManageAudioSessionCategory())
 124 #endif
 125     , m_customPasteboardDataEnabled(RuntimeEnabledFeatures::sharedFeatures().customPasteboardDataEnabled())

 126 {
 127 }
 128 
 129 void InternalSettings::Backup::restoreTo(Settings&amp; settings)
 130 {
 131     settings.setEditingBehaviorType(m_originalEditingBehavior);
 132 
 133     for (const auto&amp; standardFont : m_standardFontFamilies)
 134         settings.setStandardFontFamily(standardFont.value, static_cast&lt;UScriptCode&gt;(standardFont.key));
 135     m_standardFontFamilies.clear();
 136 
 137     for (const auto&amp; fixedFont : m_fixedFontFamilies)
 138         settings.setFixedFontFamily(fixedFont.value, static_cast&lt;UScriptCode&gt;(fixedFont.key));
 139     m_fixedFontFamilies.clear();
 140 
 141     for (const auto&amp; serifFont : m_serifFontFamilies)
 142         settings.setSerifFontFamily(serifFont.value, static_cast&lt;UScriptCode&gt;(serifFont.key));
 143     m_serifFontFamilies.clear();
 144 
 145     for (const auto&amp; sansSerifFont : m_sansSerifFontFamilies)
 146         settings.setSansSerifFontFamily(sansSerifFont.value, static_cast&lt;UScriptCode&gt;(sansSerifFont.key));
 147     m_sansSerifFontFamilies.clear();
 148 
 149     for (const auto&amp; cursiveFont : m_cursiveFontFamilies)
 150         settings.setCursiveFontFamily(cursiveFont.value, static_cast&lt;UScriptCode&gt;(cursiveFont.key));
 151     m_cursiveFontFamilies.clear();
 152 
 153     for (const auto&amp; fantasyFont : m_fantasyFontFamilies)
 154         settings.setFantasyFontFamily(fantasyFont.value, static_cast&lt;UScriptCode&gt;(fantasyFont.key));
 155     m_fantasyFontFamilies.clear();
 156 
 157     for (const auto&amp; pictographFont : m_pictographFontFamilies)
 158         settings.setPictographFontFamily(pictographFont.value, static_cast&lt;UScriptCode&gt;(pictographFont.key));
 159     m_pictographFontFamilies.clear();
 160 
 161 #if ENABLE(TEXT_AUTOSIZING)
 162     settings.setTextAutosizingEnabled(m_originalTextAutosizingEnabled);
 163     settings.setTextAutosizingWindowSizeOverride(m_originalTextAutosizingWindowSizeOverride);
<span class="line-added"> 164     settings.setTextAutosizingUsesIdempotentMode(m_originalTextAutosizingUsesIdempotentMode);</span>
 165 #endif
 166     settings.setMediaTypeOverride(m_originalMediaTypeOverride);
 167     settings.setCanvasUsesAcceleratedDrawing(m_originalCanvasUsesAcceleratedDrawing);
 168     settings.setImagesEnabled(m_imagesEnabled);
 169     settings.setPreferMIMETypeForImages(m_preferMIMETypeForImages);
 170     settings.setMinimumDOMTimerInterval(m_minimumDOMTimerInterval);
 171 #if ENABLE(VIDEO_TRACK)
 172     settings.setShouldDisplaySubtitles(m_shouldDisplaySubtitles);
 173     settings.setShouldDisplayCaptions(m_shouldDisplayCaptions);
 174     settings.setShouldDisplayTextDescriptions(m_shouldDisplayTextDescriptions);
 175 #endif
 176     settings.setDefaultVideoPosterURL(m_defaultVideoPosterURL);
 177     settings.setForcePendingWebGLPolicy(m_forcePendingWebGLPolicy);
 178     settings.setTimeWithoutMouseMovementBeforeHidingControls(m_originalTimeWithoutMouseMovementBeforeHidingControls);
 179     settings.setUseLegacyBackgroundSizeShorthandBehavior(m_useLegacyBackgroundSizeShorthandBehavior);
 180     settings.setAutoscrollForDragAndDropEnabled(m_autoscrollForDragAndDropEnabled);
 181     settings.setShouldConvertPositionStyleOnCopy(m_shouldConvertPositionStyleOnCopy);
 182     settings.setFontFallbackPrefersPictographs(m_fontFallbackPrefersPictographs);
 183     settings.setShouldIgnoreFontLoadCompletions(m_shouldIgnoreFontLoadCompletions);
 184     settings.setBackgroundShouldExtendBeyondPage(m_backgroundShouldExtendBeyondPage);
</pre>
<hr />
<pre>
 189 #endif
 190     settings.setAllowsInlineMediaPlayback(m_allowsInlineMediaPlayback);
 191     settings.setAllowsInlineMediaPlaybackAfterFullscreen(m_allowsInlineMediaPlaybackAfterFullscreen);
 192     settings.setInlineMediaPlaybackRequiresPlaysInlineAttribute(m_inlineMediaPlaybackRequiresPlaysInlineAttribute);
 193     settings.setQuickTimePluginReplacementEnabled(m_quickTimePluginReplacementEnabled);
 194     settings.setYouTubeFlashPluginReplacementEnabled(m_youTubeFlashPluginReplacementEnabled);
 195     settings.setDeferredCSSParserEnabled(m_deferredCSSParserEnabled);
 196     settings.setInputEventsEnabled(m_inputEventsEnabled);
 197     settings.setUserInterfaceDirectionPolicy(m_userInterfaceDirectionPolicy);
 198     settings.setSystemLayoutDirection(m_systemLayoutDirection);
 199     settings.setPdfImageCachingPolicy(m_pdfImageCachingPolicy);
 200     settings.setForcedColorsAreInvertedAccessibilityValue(m_forcedColorsAreInvertedAccessibilityValue);
 201     settings.setForcedDisplayIsMonochromeAccessibilityValue(m_forcedDisplayIsMonochromeAccessibilityValue);
 202     settings.setForcedPrefersReducedMotionAccessibilityValue(m_forcedPrefersReducedMotionAccessibilityValue);
 203     settings.setFontLoadTimingOverride(m_fontLoadTimingOverride);
 204     DeprecatedGlobalSettings::setAllowsAnySSLCertificate(false);
 205     RenderTheme::singleton().setShouldMockBoldSystemFontForAccessibility(m_shouldMockBoldSystemFontForAccessibility);
 206     FontCache::singleton().setShouldMockBoldSystemFontForAccessibility(m_shouldMockBoldSystemFontForAccessibility);
 207     settings.setFrameFlattening(m_frameFlattening);
 208     settings.setIncompleteImageBorderEnabled(m_incompleteImageBorderEnabled);
<span class="line-modified"> 209     settings.setShouldDispatchSyntheticMouseEventsWhenModifyingSelection(m_shouldDispatchSyntheticMouseEventsWhenModifyingSelection);</span>
<span class="line-modified"> 210     settings.setShouldDispatchSyntheticMouseOutAfterSyntheticClick(m_shouldDispatchSyntheticMouseOutAfterSyntheticClick);</span>
<span class="line-modified"> 211     PlatformMediaSessionManager::setShouldDeactivateAudioSession(m_shouldDeactivateAudioSession);</span>
<span class="line-added"> 212     settings.setAnimatedImageDebugCanvasDrawingEnabled(m_animatedImageDebugCanvasDrawingEnabled);</span>
 213 
 214 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 215     RuntimeEnabledFeatures::sharedFeatures().setIndexedDBWorkersEnabled(m_indexedDBWorkersEnabled);
 216 #endif
 217 #if ENABLE(WEBGL2)
 218     RuntimeEnabledFeatures::sharedFeatures().setWebGL2Enabled(m_webGL2Enabled);



 219 #endif
 220     RuntimeEnabledFeatures::sharedFeatures().setWebVREnabled(m_webVREnabled);
 221 #if ENABLE(MEDIA_STREAM)
 222     RuntimeEnabledFeatures::sharedFeatures().setScreenCaptureEnabled(m_setScreenCaptureEnabled);
 223 #endif
 224     RuntimeEnabledFeatures::sharedFeatures().setCustomPasteboardDataEnabled(m_customPasteboardDataEnabled);
 225 
 226 #if USE(AUDIO_SESSION)
 227     DeprecatedGlobalSettings::setShouldManageAudioSessionCategory(m_shouldManageAudioSessionCategory);
 228 #endif


 229 }
 230 
 231 class InternalSettingsWrapper : public Supplement&lt;Page&gt; {
<span class="line-added"> 232     WTF_MAKE_FAST_ALLOCATED;</span>
 233 public:
 234     explicit InternalSettingsWrapper(Page* page)
 235         : m_internalSettings(InternalSettings::create(page)) { }
 236     virtual ~InternalSettingsWrapper() { m_internalSettings-&gt;hostDestroyed(); }
 237 #if !ASSERT_DISABLED
 238     bool isRefCountedWrapper() const override { return true; }
 239 #endif
 240     InternalSettings* internalSettings() const { return m_internalSettings.get(); }
 241 
 242 private:
 243     RefPtr&lt;InternalSettings&gt; m_internalSettings;
 244 };
 245 
 246 const char* InternalSettings::supplementName()
 247 {
 248     return &quot;InternalSettings&quot;;
 249 }
 250 
 251 InternalSettings* InternalSettings::from(Page* page)
 252 {
 253     if (!Supplement&lt;Page&gt;::from(page, supplementName()))
<span class="line-modified"> 254         Supplement&lt;Page&gt;::provideTo(page, supplementName(), makeUnique&lt;InternalSettingsWrapper&gt;(page));</span>
 255     return static_cast&lt;InternalSettingsWrapper*&gt;(Supplement&lt;Page&gt;::from(page, supplementName()))-&gt;internalSettings();
 256 }
 257 
 258 void InternalSettings::hostDestroyed()
 259 {
 260     m_page = nullptr;
 261 }
 262 
 263 InternalSettings::InternalSettings(Page* page)
 264     : InternalSettingsGenerated(page)
 265     , m_page(page)
 266     , m_backup(page-&gt;settings())
 267 {
 268 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 269     setAllowsAirPlayForMediaPlayback(false);
 270 #endif
 271 #if ENABLE(MEDIA_STREAM)
 272     setMediaCaptureRequiresSecureConnection(false);
 273 #endif
 274 }
 275 
 276 Ref&lt;InternalSettings&gt; InternalSettings::create(Page* page)
 277 {
 278     return adoptRef(*new InternalSettings(page));
 279 }
 280 
 281 void InternalSettings::resetToConsistentState()
 282 {
 283     m_page-&gt;setPageScaleFactor(1, { 0, 0 });
 284     m_page-&gt;mainFrame().setPageAndTextZoomFactors(1, 1);
 285     m_page-&gt;setCanStartMedia(true);
<span class="line-modified"> 286     setUseDarkAppearanceInternal(false);</span>
 287 
 288     settings().setForcePendingWebGLPolicy(false);
 289 #if ENABLE(WIRELESS_PLAYBACK_TARGET)
 290     settings().setAllowsAirPlayForMediaPlayback(false);
 291 #endif
 292 #if ENABLE(MEDIA_STREAM)
 293     setMediaCaptureRequiresSecureConnection(false);
 294 #endif
 295 
 296     m_backup.restoreTo(settings());
 297     m_backup = Backup { settings() };
 298 
 299     InternalSettingsGenerated::resetToConsistentState();
 300 }
 301 
 302 Settings&amp; InternalSettings::settings() const
 303 {
 304     ASSERT(m_page);
 305     return m_page-&gt;settings();
 306 }
</pre>
<hr />
<pre>
 409     settings().setTextAutosizingEnabled(enabled);
 410 #else
 411     UNUSED_PARAM(enabled);
 412 #endif
 413     return { };
 414 }
 415 
 416 ExceptionOr&lt;void&gt; InternalSettings::setTextAutosizingWindowSizeOverride(int width, int height)
 417 {
 418     if (!m_page)
 419         return Exception { InvalidAccessError };
 420 #if ENABLE(TEXT_AUTOSIZING)
 421     settings().setTextAutosizingWindowSizeOverride(IntSize(width, height));
 422 #else
 423     UNUSED_PARAM(width);
 424     UNUSED_PARAM(height);
 425 #endif
 426     return { };
 427 }
 428 
<span class="line-added"> 429 ExceptionOr&lt;void&gt; InternalSettings::setTextAutosizingUsesIdempotentMode(bool enabled)</span>
<span class="line-added"> 430 {</span>
<span class="line-added"> 431     if (!m_page)</span>
<span class="line-added"> 432         return Exception { InvalidAccessError };</span>
<span class="line-added"> 433 #if ENABLE(TEXT_AUTOSIZING)</span>
<span class="line-added"> 434     settings().setTextAutosizingUsesIdempotentMode(enabled);</span>
<span class="line-added"> 435 #else</span>
<span class="line-added"> 436     UNUSED_PARAM(enabled);</span>
<span class="line-added"> 437 #endif</span>
<span class="line-added"> 438     return { };</span>
<span class="line-added"> 439 }</span>
<span class="line-added"> 440 </span>
 441 ExceptionOr&lt;void&gt; InternalSettings::setMediaTypeOverride(const String&amp; mediaType)
 442 {
 443     if (!m_page)
 444         return Exception { InvalidAccessError };
 445     settings().setMediaTypeOverride(mediaType);
 446     return { };
 447 }
 448 
 449 ExceptionOr&lt;void&gt; InternalSettings::setCanStartMedia(bool enabled)
 450 {
 451     if (!m_page)
 452         return Exception { InvalidAccessError };
 453     m_page-&gt;setCanStartMedia(enabled);
 454     return { };
 455 }
 456 
 457 ExceptionOr&lt;void&gt; InternalSettings::setAllowsAirPlayForMediaPlayback(bool allows)
 458 {
 459     if (!m_page)
 460         return Exception { InvalidAccessError };
</pre>
<hr />
<pre>
 519 ExceptionOr&lt;bool&gt; InternalSettings::shouldDisplayTrackKind(const String&amp; kind)
 520 {
 521     if (!m_page)
 522         return Exception { InvalidAccessError };
 523 #if ENABLE(VIDEO_TRACK)
 524     auto&amp; captionPreferences = m_page-&gt;group().captionPreferences();
 525     if (equalLettersIgnoringASCIICase(kind, &quot;subtitles&quot;))
 526         return captionPreferences.userPrefersSubtitles();
 527     if (equalLettersIgnoringASCIICase(kind, &quot;captions&quot;))
 528         return captionPreferences.userPrefersCaptions();
 529     if (equalLettersIgnoringASCIICase(kind, &quot;textdescriptions&quot;))
 530         return captionPreferences.userPrefersTextDescriptions();
 531 
 532     return Exception { SyntaxError };
 533 #else
 534     UNUSED_PARAM(kind);
 535     return false;
 536 #endif
 537 }
 538 
<span class="line-added"> 539 void InternalSettings::setUseDarkAppearanceInternal(bool useDarkAppearance)</span>
<span class="line-added"> 540 {</span>
<span class="line-added"> 541     ASSERT(m_page);</span>
<span class="line-added"> 542     m_page-&gt;effectiveAppearanceDidChange(useDarkAppearance, m_page-&gt;useElevatedUserInterfaceLevel());</span>
<span class="line-added"> 543 }</span>
<span class="line-added"> 544 </span>
 545 ExceptionOr&lt;void&gt; InternalSettings::setUseDarkAppearance(bool useDarkAppearance)
 546 {
 547     if (!m_page)
 548         return Exception { InvalidAccessError };
<span class="line-modified"> 549     setUseDarkAppearanceInternal(useDarkAppearance);</span>
 550     return { };
 551 }
 552 
 553 ExceptionOr&lt;void&gt; InternalSettings::setStorageBlockingPolicy(const String&amp; mode)
 554 {
 555     if (!m_page)
 556         return Exception { InvalidAccessError };
 557     if (mode == &quot;AllowAll&quot;)
 558         settings().setStorageBlockingPolicy(SecurityOrigin::AllowAllStorage);
 559     else if (mode == &quot;BlockThirdParty&quot;)
 560         settings().setStorageBlockingPolicy(SecurityOrigin::BlockThirdPartyStorage);
 561     else if (mode == &quot;BlockAll&quot;)
 562         settings().setStorageBlockingPolicy(SecurityOrigin::BlockAllStorage);
 563     else
 564         return Exception { SyntaxError };
 565     return { };
 566 }
 567 
 568 ExceptionOr&lt;void&gt; InternalSettings::setPreferMIMETypeForImages(bool preferMIMETypeForImages)
 569 {
</pre>
<hr />
<pre>
 747     return { };
 748 }
 749 
 750 ExceptionOr&lt;void&gt; InternalSettings::setInlineMediaPlaybackRequiresPlaysInlineAttribute(bool requires)
 751 {
 752     if (!m_page)
 753         return Exception { InvalidAccessError };
 754     settings().setInlineMediaPlaybackRequiresPlaysInlineAttribute(requires);
 755     return { };
 756 }
 757 
 758 ExceptionOr&lt;void&gt; InternalSettings::setShouldMockBoldSystemFontForAccessibility(bool requires)
 759 {
 760     if (!m_page)
 761         return Exception { InvalidAccessError };
 762     RenderTheme::singleton().setShouldMockBoldSystemFontForAccessibility(requires);
 763     FontCache::singleton().setShouldMockBoldSystemFontForAccessibility(requires);
 764     return { };
 765 }
 766 
<span class="line-added"> 767 ExceptionOr&lt;void&gt; InternalSettings::setAnimatedImageDebugCanvasDrawingEnabled(bool ignore)</span>
<span class="line-added"> 768 {</span>
<span class="line-added"> 769     if (!m_page)</span>
<span class="line-added"> 770         return Exception { InvalidAccessError };</span>
<span class="line-added"> 771     settings().setAnimatedImageDebugCanvasDrawingEnabled(ignore);</span>
<span class="line-added"> 772     return { };</span>
<span class="line-added"> 773 }</span>
<span class="line-added"> 774 </span>
 775 void InternalSettings::setIndexedDBWorkersEnabled(bool enabled)
 776 {
 777 #if ENABLE(INDEXED_DATABASE_IN_WORKERS)
 778     RuntimeEnabledFeatures::sharedFeatures().setIndexedDBWorkersEnabled(enabled);
 779 #else
 780     UNUSED_PARAM(enabled);
 781 #endif
 782 }
 783 
 784 void InternalSettings::setWebGL2Enabled(bool enabled)
 785 {
 786 #if ENABLE(WEBGL2)
 787     RuntimeEnabledFeatures::sharedFeatures().setWebGL2Enabled(enabled);
 788 #else
 789     UNUSED_PARAM(enabled);
 790 #endif
 791 }
 792 
<span class="line-modified"> 793 void InternalSettings::setWebGPUEnabled(bool enabled)</span>
 794 {
<span class="line-modified"> 795 #if ENABLE(WEBGPU)</span>
<span class="line-modified"> 796     RuntimeEnabledFeatures::sharedFeatures().setWebGPUEnabled(enabled);</span>
 797 #else
 798     UNUSED_PARAM(enabled);
 799 #endif
 800 }
 801 
 802 void InternalSettings::setWebVREnabled(bool enabled)
 803 {
 804     RuntimeEnabledFeatures::sharedFeatures().setWebVREnabled(enabled);
 805 }
 806 
 807 void InternalSettings::setScreenCaptureEnabled(bool enabled)
 808 {
 809 #if ENABLE(MEDIA_STREAM)
 810     RuntimeEnabledFeatures::sharedFeatures().setScreenCaptureEnabled(enabled);
 811 #else
 812     UNUSED_PARAM(enabled);
 813 #endif
 814 }
 815 





 816 ExceptionOr&lt;String&gt; InternalSettings::userInterfaceDirectionPolicy()
 817 {
 818     if (!m_page)
 819         return Exception { InvalidAccessError };
 820     switch (settings().userInterfaceDirectionPolicy()) {
 821     case UserInterfaceDirectionPolicy::Content:
 822         return &quot;Content&quot;_str;
 823     case UserInterfaceDirectionPolicy::System:
 824         return &quot;View&quot;_str;
 825     }
 826     ASSERT_NOT_REACHED();
 827     return Exception { InvalidAccessError };
 828 }
 829 
 830 ExceptionOr&lt;void&gt; InternalSettings::setUserInterfaceDirectionPolicy(const String&amp; policy)
 831 {
 832     if (!m_page)
 833         return Exception { InvalidAccessError };
 834     if (equalLettersIgnoringASCIICase(policy, &quot;content&quot;)) {
 835         settings().setUserInterfaceDirectionPolicy(UserInterfaceDirectionPolicy::Content);
</pre>
<hr />
<pre>
 902     return { };
 903 }
 904 
 905 ExceptionOr&lt;void&gt; InternalSettings::setShouldManageAudioSessionCategory(bool should)
 906 {
 907 #if USE(AUDIO_SESSION)
 908     DeprecatedGlobalSettings::setShouldManageAudioSessionCategory(should);
 909     return { };
 910 #else
 911     UNUSED_PARAM(should);
 912     return Exception { InvalidAccessError };
 913 #endif
 914 }
 915 
 916 ExceptionOr&lt;void&gt; InternalSettings::setCustomPasteboardDataEnabled(bool enabled)
 917 {
 918     RuntimeEnabledFeatures::sharedFeatures().setCustomPasteboardDataEnabled(enabled);
 919     return { };
 920 }
 921 
<span class="line-modified"> 922 ExceptionOr&lt;void&gt; InternalSettings::setIncompleteImageBorderEnabled(bool enabled)</span>
 923 {
 924     if (!m_page)
 925         return Exception { InvalidAccessError };
<span class="line-modified"> 926     settings().setIncompleteImageBorderEnabled(enabled);</span>




 927     return { };
 928 }
 929 
<span class="line-modified"> 930 ExceptionOr&lt;void&gt; InternalSettings::setShouldDispatchSyntheticMouseEventsWhenModifyingSelection(bool shouldDispatch)</span>
 931 {
 932     if (!m_page)
 933         return Exception { InvalidAccessError };
<span class="line-modified"> 934     settings().setShouldDispatchSyntheticMouseEventsWhenModifyingSelection(shouldDispatch);</span>
<span class="line-added"> 935     return { };</span>
<span class="line-added"> 936 }</span>
<span class="line-added"> 937 </span>
<span class="line-added"> 938 ExceptionOr&lt;void&gt; InternalSettings::setShouldDispatchSyntheticMouseOutAfterSyntheticClick(bool shouldDispatch)</span>
<span class="line-added"> 939 {</span>
<span class="line-added"> 940     if (!m_page)</span>
<span class="line-added"> 941         return Exception { InvalidAccessError };</span>
<span class="line-added"> 942     settings().setShouldDispatchSyntheticMouseOutAfterSyntheticClick(shouldDispatch);</span>
 943     return { };
 944 }
 945 
 946 static InternalSettings::ForcedAccessibilityValue settingsToInternalSettingsValue(Settings::ForcedAccessibilityValue value)
 947 {
 948     switch (value) {
 949     case Settings::ForcedAccessibilityValue::System:
 950         return InternalSettings::ForcedAccessibilityValue::System;
 951     case Settings::ForcedAccessibilityValue::On:
 952         return InternalSettings::ForcedAccessibilityValue::On;
 953     case Settings::ForcedAccessibilityValue::Off:
 954         return InternalSettings::ForcedAccessibilityValue::Off;
 955     }
 956 
 957     ASSERT_NOT_REACHED();
 958     return InternalSettings::ForcedAccessibilityValue::Off;
 959 }
 960 
 961 static Settings::ForcedAccessibilityValue internalSettingsToSettingsValue(InternalSettings::ForcedAccessibilityValue value)
 962 {
</pre>
<hr />
<pre>
 991 void InternalSettings::setForcedDisplayIsMonochromeAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
 992 {
 993     settings().setForcedDisplayIsMonochromeAccessibilityValue(internalSettingsToSettingsValue(value));
 994 }
 995 
 996 InternalSettings::ForcedAccessibilityValue InternalSettings::forcedPrefersReducedMotionAccessibilityValue() const
 997 {
 998     return settingsToInternalSettingsValue(settings().forcedPrefersReducedMotionAccessibilityValue());
 999 }
1000 
1001 void InternalSettings::setForcedPrefersReducedMotionAccessibilityValue(InternalSettings::ForcedAccessibilityValue value)
1002 {
1003     settings().setForcedPrefersReducedMotionAccessibilityValue(internalSettingsToSettingsValue(value));
1004 }
1005 
1006 bool InternalSettings::webAnimationsCSSIntegrationEnabled()
1007 {
1008     return RuntimeEnabledFeatures::sharedFeatures().webAnimationsCSSIntegrationEnabled();
1009 }
1010 
<span class="line-added">1011 void InternalSettings::setShouldDeactivateAudioSession(bool should)</span>
<span class="line-added">1012 {</span>
<span class="line-added">1013     PlatformMediaSessionManager::setShouldDeactivateAudioSession(should);</span>
<span class="line-added">1014 }</span>
<span class="line-added">1015 </span>
1016 // If you add to this class, make sure that you update the Backup class for test reproducability!
1017 
1018 }
</pre>
</td>
</tr>
</table>
<center><a href="../svg/properties/SVGPropertyTraits.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InternalSettings.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>