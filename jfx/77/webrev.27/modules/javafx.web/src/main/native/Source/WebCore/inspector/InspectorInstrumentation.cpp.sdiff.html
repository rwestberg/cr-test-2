<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorInstrumentation.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorHistory.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorInstrumentation.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorInstrumentation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  16 * contributors may be used to endorse or promote products derived from
  17 * this software without specific prior written permission.
  18 *
  19 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  20 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  21 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  22 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  23 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  24 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  25 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  26 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  27 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  28 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  29 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  30 */
  31 
  32 #include &quot;config.h&quot;
  33 #include &quot;InspectorInstrumentation.h&quot;
  34 
  35 #include &quot;CachedResource.h&quot;

  36 #include &quot;DOMWindow.h&quot;
  37 #include &quot;DOMWrapperWorld.h&quot;
<span class="line-removed">  38 #include &quot;Database.h&quot;</span>
  39 #include &quot;DocumentLoader.h&quot;
  40 #include &quot;Event.h&quot;
  41 #include &quot;Frame.h&quot;
  42 #include &quot;InspectorApplicationCacheAgent.h&quot;
  43 #include &quot;InspectorCSSAgent.h&quot;
  44 #include &quot;InspectorCanvasAgent.h&quot;
  45 #include &quot;InspectorDOMAgent.h&quot;
  46 #include &quot;InspectorDOMDebuggerAgent.h&quot;
  47 #include &quot;InspectorDOMStorageAgent.h&quot;
  48 #include &quot;InspectorDatabaseAgent.h&quot;
  49 #include &quot;InspectorLayerTreeAgent.h&quot;
  50 #include &quot;InspectorMemoryAgent.h&quot;
  51 #include &quot;InspectorNetworkAgent.h&quot;
  52 #include &quot;InspectorPageAgent.h&quot;
  53 #include &quot;InspectorTimelineAgent.h&quot;
  54 #include &quot;InspectorWorkerAgent.h&quot;
  55 #include &quot;InstrumentingAgents.h&quot;
  56 #include &quot;LoaderStrategy.h&quot;
  57 #include &quot;PageDebuggerAgent.h&quot;
  58 #include &quot;PageHeapAgent.h&quot;
</pre>
<hr />
<pre>
  93 }
  94 
  95 static Frame* frameForScriptExecutionContext(ScriptExecutionContext* context)
  96 {
  97     Frame* frame = nullptr;
  98     if (is&lt;Document&gt;(*context))
  99         frame = downcast&lt;Document&gt;(*context).frame();
 100     return frame;
 101 }
 102 
 103 static Frame* frameForScriptExecutionContext(ScriptExecutionContext&amp; context)
 104 {
 105     Frame* frame = nullptr;
 106     if (is&lt;Document&gt;(context))
 107         frame = downcast&lt;Document&gt;(context).frame();
 108     return frame;
 109 }
 110 
 111 void InspectorInstrumentation::didClearWindowObjectInWorldImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DOMWrapperWorld&amp; world)
 112 {
<span class="line-removed"> 113     InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent();</span>
 114     if (PageDebuggerAgent* debuggerAgent = instrumentingAgents.pageDebuggerAgent()) {
<span class="line-modified"> 115         if (pageAgent &amp;&amp; &amp;world == &amp;mainThreadNormalWorld() &amp;&amp; &amp;frame == &amp;pageAgent-&gt;mainFrame())</span>
 116             debuggerAgent-&gt;didClearMainFrameWindowObject();
 117     }

 118     if (PageRuntimeAgent* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent()) {
 119         if (&amp;world == &amp;mainThreadNormalWorld())
 120             pageRuntimeAgent-&gt;didCreateMainWorldContext(frame);
 121     }
 122 }
 123 
 124 bool InspectorInstrumentation::isDebuggerPausedImpl(InstrumentingAgents&amp; instrumentingAgents)
 125 {
 126     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 127         return debuggerAgent-&gt;isPaused();
 128     return false;
 129 }
 130 
 131 int InspectorInstrumentation::identifierForNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 132 {
 133     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 134         return domAgent-&gt;identifierForNode(node);
 135     return 0;
 136 }
 137 
</pre>
<hr />
<pre>
 152     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 153         domAgent-&gt;didInsertDOMNode(node);
 154     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 155         domDebuggerAgent-&gt;didInsertDOMNode(node);
 156 }
 157 
 158 void InspectorInstrumentation::willRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 159 {
 160     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 161         domDebuggerAgent-&gt;willRemoveDOMNode(node);
 162 }
 163 
 164 void InspectorInstrumentation::didRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 165 {
 166     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 167         domDebuggerAgent-&gt;didRemoveDOMNode(node);
 168     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 169         domAgent-&gt;didRemoveDOMNode(node);
 170 }
 171 
<span class="line-modified"> 172 void InspectorInstrumentation::willModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomicString&amp; oldValue, const AtomicString&amp; newValue)</span>
 173 {
 174     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 175         domDebuggerAgent-&gt;willModifyDOMAttr(element);
 176     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 177         domAgent-&gt;willModifyDOMAttr(element, oldValue, newValue);
 178 }
 179 
<span class="line-modified"> 180 void InspectorInstrumentation::didModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomicString&amp; name, const AtomicString&amp; value)</span>
 181 {
 182     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 183         domAgent-&gt;didModifyDOMAttr(element, name, value);
 184 }
 185 
<span class="line-modified"> 186 void InspectorInstrumentation::didRemoveDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomicString&amp; name)</span>
 187 {
 188     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 189         domAgent-&gt;didRemoveDOMAttr(element, name);
 190 }
 191 
<span class="line-modified"> 192 void InspectorInstrumentation::didInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)</span>
 193 {
<span class="line-modified"> 194     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())</span>
<span class="line-modified"> 195         domAgent-&gt;didInvalidateStyleAttr(node);</span>
<span class="line-modified"> 196     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 197         domDebuggerAgent-&gt;didInvalidateStyleAttr(node);</span>




 198 }
 199 
 200 void InspectorInstrumentation::documentDetachedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 201 {
 202     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 203         cssAgent-&gt;documentDetached(document);
 204 }
 205 
 206 void InspectorInstrumentation::frameWindowDiscardedImpl(InstrumentingAgents&amp; instrumentingAgents, DOMWindow* window)
 207 {



 208     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 209         consoleAgent-&gt;frameWindowDiscarded(window);
 210 }
 211 
 212 void InspectorInstrumentation::mediaQueryResultChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
 213 {
 214     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 215         cssAgent-&gt;mediaQueryResultChanged();
 216 }
 217 
 218 void InspectorInstrumentation::activeStyleSheetsUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 219 {
 220     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 221         cssAgent-&gt;activeStyleSheetsUpdated(document);
 222 }
 223 
 224 void InspectorInstrumentation::didPushShadowRootImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; host, ShadowRoot&amp; root)
 225 {
 226     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 227         domAgent-&gt;didPushShadowRoot(host, root);
</pre>
<hr />
<pre>
 292         domAgent-&gt;characterDataModified(characterData);
 293 }
 294 
 295 void InspectorInstrumentation::willSendXMLHttpRequestImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 296 {
 297     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 298         domDebuggerAgent-&gt;willSendXMLHttpRequest(url);
 299 }
 300 
 301 void InspectorInstrumentation::willFetchImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 302 {
 303     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 304         domDebuggerAgent-&gt;willFetch(url);
 305 }
 306 
 307 void InspectorInstrumentation::didInstallTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, Seconds timeout, bool singleShot, ScriptExecutionContext&amp; context)
 308 {
 309     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 310         debuggerAgent-&gt;didScheduleAsyncCall(context.execState(), InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId, singleShot);
 311 
<span class="line-modified"> 312     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 313         timelineAgent-&gt;didInstallTimer(timerId, timeout, singleShot, frameForScriptExecutionContext(context));
 314 }
 315 
 316 void InspectorInstrumentation::didRemoveTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, ScriptExecutionContext&amp; context)
 317 {
 318     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 319         debuggerAgent-&gt;didCancelAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);
<span class="line-modified"> 320     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 321         timelineAgent-&gt;didRemoveTimer(timerId, frameForScriptExecutionContext(context));
 322 }
 323 
<span class="line-modified"> 324 void InspectorInstrumentation::didAddEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomicString&amp; eventType, EventListener&amp; listener, bool capture)</span>
 325 {
 326     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 327         pageDebuggerAgent-&gt;didAddEventListener(target, eventType, listener, capture);
 328     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 329         domAgent-&gt;didAddEventListener(target);
 330 }
 331 
<span class="line-modified"> 332 void InspectorInstrumentation::willRemoveEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomicString&amp; eventType, EventListener&amp; listener, bool capture)</span>
 333 {
 334     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 335         pageDebuggerAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
 336     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 337         domAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
 338 }
 339 
<span class="line-modified"> 340 bool InspectorInstrumentation::isEventListenerDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomicString&amp; eventType, EventListener&amp; listener, bool capture)</span>
 341 {
 342     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 343         return domAgent-&gt;isEventListenerDisabled(target, eventType, listener, capture);
 344     return false;
 345 }
 346 
 347 void InspectorInstrumentation::didPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer, JSC::ExecState&amp; state)
 348 {
 349     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 350         pageDebuggerAgent-&gt;didPostMessage(timer, state);
 351 }
 352 
 353 void InspectorInstrumentation::didFailPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 354 {
 355     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 356         pageDebuggerAgent-&gt;didFailPostMessage(timer);
 357 }
 358 
 359 void InspectorInstrumentation::willDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 360 {
 361     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 362         pageDebuggerAgent-&gt;willDispatchPostMessage(timer);
 363 }
 364 
 365 void InspectorInstrumentation::didDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 366 {
 367     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 368         pageDebuggerAgent-&gt;didDispatchPostMessage(timer);
 369 }
 370 
 371 InspectorInstrumentationCookie InspectorInstrumentation::willCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; scriptName, int scriptLine, int scriptColumn, ScriptExecutionContext* context)
 372 {
 373     int timelineAgentId = 0;
<span class="line-modified"> 374     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
 375         timelineAgent-&gt;willCallFunction(scriptName, scriptLine, scriptColumn, frameForScriptExecutionContext(context));
 376         timelineAgentId = timelineAgent-&gt;id();
 377     }
 378     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 379 }
 380 
 381 void InspectorInstrumentation::didCallFunctionImpl(const InspectorInstrumentationCookie&amp; cookie, ScriptExecutionContext* context)
 382 {
 383     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 384         timelineAgent-&gt;didCallFunction(frameForScriptExecutionContext(context));
 385 }
 386 
 387 InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document, const Event&amp; event, bool hasEventListeners)
 388 {
 389     int timelineAgentId = 0;
<span class="line-modified"> 390     InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent();</span>
 391     if (timelineAgent &amp;&amp; hasEventListeners) {
 392         timelineAgent-&gt;willDispatchEvent(event, document.frame());
 393         timelineAgentId = timelineAgent-&gt;id();
 394     }
 395 
 396     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 397 }
 398 
<span class="line-modified"> 399 void InspectorInstrumentation::willHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, const RegisteredEventListener&amp; listener)</span>
 400 {
 401     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 402         pageDebuggerAgent-&gt;willHandleEvent(listener);
 403 
 404     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 405         domDebuggerAgent-&gt;willHandleEvent(event, listener);
 406 }
 407 
 408 void InspectorInstrumentation::didHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents)
 409 {
 410     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 411         debuggerAgent-&gt;didDispatchAsyncCall();



 412 }
 413 
<span class="line-modified"> 414 void InspectorInstrumentation::didDispatchEventImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
 415 {
 416     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified"> 417         timelineAgent-&gt;didDispatchEvent();</span>
 418 }
 419 
 420 InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, DOMWindow&amp; window)
 421 {
 422     int timelineAgentId = 0;
<span class="line-modified"> 423     InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent();</span>
 424     if (timelineAgent &amp;&amp; window.hasEventListeners(event.type())) {
 425         timelineAgent-&gt;willDispatchEvent(event, window.frame());
 426         timelineAgentId = timelineAgent-&gt;id();
 427     }
 428 
 429     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 430 }
 431 
<span class="line-modified"> 432 void InspectorInstrumentation::didDispatchEventOnWindowImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
 433 {
 434     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified"> 435         timelineAgent-&gt;didDispatchEvent();</span>
 436 }
 437 
 438 void InspectorInstrumentation::eventDidResetAfterDispatchImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)
 439 {
 440     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
 441         domAgent-&gt;eventDidResetAfterDispatch(event);
 442 }
 443 
 444 InspectorInstrumentationCookie InspectorInstrumentation::willEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; url, int lineNumber, int columnNumber)
 445 {
 446     int timelineAgentId = 0;
<span class="line-modified"> 447     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
 448         timelineAgent-&gt;willEvaluateScript(url, lineNumber, columnNumber, frame);
 449         timelineAgentId = timelineAgent-&gt;id();
 450     }
 451     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 452 }
 453 
 454 void InspectorInstrumentation::didEvaluateScriptImpl(const InspectorInstrumentationCookie&amp; cookie, Frame&amp; frame)
 455 {
 456     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 457         timelineAgent-&gt;didEvaluateScript(frame);
 458 }
 459 
 460 InspectorInstrumentationCookie InspectorInstrumentation::willFireTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, bool oneShot, ScriptExecutionContext&amp; context)
 461 {
 462     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 463         debuggerAgent-&gt;willDispatchAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);
 464 
 465     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 466         domDebuggerAgent-&gt;willFireTimer(oneShot);
 467 
 468     int timelineAgentId = 0;
<span class="line-modified"> 469     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
 470         timelineAgent-&gt;willFireTimer(timerId, frameForScriptExecutionContext(context));
 471         timelineAgentId = timelineAgent-&gt;id();
 472     }
 473     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 474 }
 475 
 476 void InspectorInstrumentation::didFireTimerImpl(const InspectorInstrumentationCookie&amp; cookie)
 477 {
 478     if (InspectorDebuggerAgent* debuggerAgent = cookie.instrumentingAgents()-&gt;inspectorDebuggerAgent())
 479         debuggerAgent-&gt;didDispatchAsyncCall();
 480     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 481         timelineAgent-&gt;didFireTimer();
 482 }
 483 
 484 void InspectorInstrumentation::didInvalidateLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 485 {
<span class="line-modified"> 486     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 487         timelineAgent-&gt;didInvalidateLayout(frame);
 488 }
 489 
 490 InspectorInstrumentationCookie InspectorInstrumentation::willLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 491 {
 492     int timelineAgentId = 0;
<span class="line-modified"> 493     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
 494         timelineAgent-&gt;willLayout(frame);
 495         timelineAgentId = timelineAgent-&gt;id();
 496     }
 497     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 498 }
 499 
 500 void InspectorInstrumentation::didLayoutImpl(const InspectorInstrumentationCookie&amp; cookie, RenderObject&amp; root)
 501 {
 502     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 503         timelineAgent-&gt;didLayout(root);
 504 
 505     if (InspectorPageAgent* pageAgent = cookie.instrumentingAgents()-&gt;inspectorPageAgent())
 506         pageAgent-&gt;didLayout();
 507 }
 508 
 509 void InspectorInstrumentation::willCompositeImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 510 {
<span class="line-modified"> 511     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 512         timelineAgent-&gt;willComposite(frame);
 513 }
 514 
 515 void InspectorInstrumentation::didCompositeImpl(InstrumentingAgents&amp; instrumentingAgents)
 516 {
<span class="line-modified"> 517     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 518         timelineAgent-&gt;didComposite();
 519 }
 520 
 521 void InspectorInstrumentation::willPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer)
 522 {
<span class="line-modified"> 523     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 524         timelineAgent-&gt;willPaint(renderer.frame());
 525 }
 526 
 527 void InspectorInstrumentation::didPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer, const LayoutRect&amp; rect)
 528 {
<span class="line-modified"> 529     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 530         timelineAgent-&gt;didPaint(renderer, rect);
 531 
 532     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 533         pageAgent-&gt;didPaint(renderer, rect);
 534 }
 535 
 536 InspectorInstrumentationCookie InspectorInstrumentation::willRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 537 {
 538     int timelineAgentId = 0;
<span class="line-modified"> 539     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
 540         timelineAgent-&gt;willRecalculateStyle(document.frame());
 541         timelineAgentId = timelineAgent-&gt;id();
 542     }
 543     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 544         networkAgent-&gt;willRecalculateStyle();
 545     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 546 }
 547 
 548 void InspectorInstrumentation::didRecalculateStyleImpl(const InspectorInstrumentationCookie&amp; cookie)
 549 {
 550     if (!cookie.isValid())
 551         return;
 552 
 553     InstrumentingAgents&amp; instrumentingAgents = *cookie.instrumentingAgents();
 554 
 555     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 556         timelineAgent-&gt;didRecalculateStyle();
 557     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 558         networkAgent-&gt;didRecalculateStyle();
 559     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 560         pageAgent-&gt;didRecalculateStyle();
 561 }
 562 
 563 void InspectorInstrumentation::didScheduleStyleRecalculationImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 564 {
<span class="line-modified"> 565     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 566         timelineAgent-&gt;didScheduleStyleRecalculation(document.frame());
 567     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 568         networkAgent-&gt;didScheduleStyleRecalculation(document);
 569 }
 570 
 571 void InspectorInstrumentation::applyUserAgentOverrideImpl(InstrumentingAgents&amp; instrumentingAgents, String&amp; userAgent)
 572 {
 573     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 574         pageAgent-&gt;applyUserAgentOverride(userAgent);
 575 }
 576 
 577 void InspectorInstrumentation::applyEmulatedMediaImpl(InstrumentingAgents&amp; instrumentingAgents, String&amp; media)
 578 {
 579     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 580         pageAgent-&gt;applyEmulatedMedia(media);
 581 }
 582 
 583 void InspectorInstrumentation::willSendRequestImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, ResourceRequest&amp; request, const ResourceResponse&amp; redirectResponse)
 584 {
 585     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 586         networkAgent-&gt;willSendRequest(identifier, loader, request, redirectResponse);
 587 }
 588 
 589 void InspectorInstrumentation::willSendRequestOfTypeImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, ResourceRequest&amp; request, LoadType loadType)
 590 {
 591     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 592         networkAgent-&gt;willSendRequestOfType(identifier, loader, request, loadType);
 593 }
 594 
 595 void InspectorInstrumentation::didLoadResourceFromMemoryCacheImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader* loader, CachedResource* cachedResource)
 596 {
 597     if (!loader || !cachedResource)
 598         return;
 599 
 600     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 601         networkAgent-&gt;didLoadResourceFromMemoryCache(loader, *cachedResource);
 602 }
 603 
 604 void InspectorInstrumentation::didReceiveResourceResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceResponse&amp; response, ResourceLoader* resourceLoader)
 605 {



 606     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 607         networkAgent-&gt;didReceiveResponse(identifier, loader, response, resourceLoader);
 608     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 609         consoleAgent-&gt;didReceiveResponse(identifier, response); // This should come AFTER resource notification, front-end relies on this.
 610 }
 611 
 612 void InspectorInstrumentation::didReceiveThreadableLoaderResponseImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentThreadableLoader&amp; documentThreadableLoader, unsigned long identifier)
 613 {
 614     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 615         networkAgent-&gt;didReceiveThreadableLoaderResponse(identifier, documentThreadableLoader);
 616 }
 617 
 618 void InspectorInstrumentation::didReceiveDataImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const char* data, int dataLength, int encodedDataLength)
 619 {
 620     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 621         networkAgent-&gt;didReceiveData(identifier, data, dataLength, encodedDataLength);
 622 }
 623 
 624 void InspectorInstrumentation::didFinishLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const NetworkLoadMetrics&amp; networkLoadMetrics, ResourceLoader* resourceLoader)
 625 {
 626     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 627         networkAgent-&gt;didFinishLoading(identifier, loader, networkLoadMetrics, resourceLoader);
 628 }
 629 
 630 void InspectorInstrumentation::didFailLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceError&amp; error)
 631 {



 632     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 633         networkAgent-&gt;didFailLoading(identifier, loader, error);
 634     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 635         consoleAgent-&gt;didFailLoading(identifier, error); // This should come AFTER resource notification, front-end relies on this.
 636 }
 637 
 638 void InspectorInstrumentation::willLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 639 {
 640     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 641         networkAgent-&gt;willLoadXHRSynchronously();
 642 }
 643 
 644 void InspectorInstrumentation::didLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 645 {
 646     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 647         networkAgent-&gt;didLoadXHRSynchronously();
 648 }
 649 
 650 void InspectorInstrumentation::scriptImportedImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const String&amp; sourceString)
 651 {
</pre>
<hr />
<pre>
 695         return;
 696 
 697     if (!frame.page())
 698         return;
 699 
 700     if (!loader)
 701         return;
 702 
 703     ASSERT(loader-&gt;frame() == &amp;frame);
 704 
 705     if (frame.isMainFrame()) {
 706         if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 707             consoleAgent-&gt;reset();
 708 
 709         if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 710             networkAgent-&gt;mainFrameNavigated(*loader);
 711 
 712         if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 713             cssAgent-&gt;reset();
 714 
<span class="line-modified"> 715         if (InspectorDatabaseAgent* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-modified"> 716             databaseAgent-&gt;clearResources();</span>
 717 
 718         if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 719             domAgent-&gt;setDocument(frame.document());
 720 
 721         if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
 722             layerTreeAgent-&gt;reset();
 723 
 724         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 725             pageDebuggerAgent-&gt;mainFrameNavigated();
 726 
 727         if (PageHeapAgent* pageHeapAgent = instrumentingAgents.pageHeapAgent())
 728             pageHeapAgent-&gt;mainFrameNavigated();
 729     }
 730 
 731     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 732         canvasAgent-&gt;frameNavigated(frame);
 733 
 734     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 735         domAgent-&gt;didCommitLoad(frame.document());
 736 
 737     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 738         pageAgent-&gt;frameNavigated(frame);
 739 
 740     if (frame.isMainFrame()) {
<span class="line-modified"> 741         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 742             timelineAgent-&gt;mainFrameNavigated();
 743     }
 744 }
 745 
 746 void InspectorInstrumentation::frameDocumentUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 747 {
 748     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 749         domAgent-&gt;frameDocumentUpdated(frame);
 750 
 751     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 752         domDebuggerAgent-&gt;frameDocumentUpdated(frame);
 753 }
 754 
 755 void InspectorInstrumentation::loaderDetachedFromFrameImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader&amp; loader)
 756 {
 757     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 758         inspectorPageAgent-&gt;loaderDetachedFromFrame(loader);
 759 }
 760 
 761 void InspectorInstrumentation::frameStartedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 762 {
 763     if (frame.isMainFrame()) {
 764         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 765             pageDebuggerAgent-&gt;mainFrameStartedLoading();
<span class="line-modified"> 766         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.persistentInspectorTimelineAgent())</span>
 767             timelineAgent-&gt;mainFrameStartedLoading();
 768     }
 769 
 770     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 771         inspectorPageAgent-&gt;frameStartedLoading(frame);
 772 }
 773 
 774 void InspectorInstrumentation::frameStoppedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 775 {
 776     if (frame.isMainFrame()) {
 777         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 778             pageDebuggerAgent-&gt;mainFrameStoppedLoading();
 779     }
 780 
 781     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 782         inspectorPageAgent-&gt;frameStoppedLoading(frame);
 783 }
 784 
 785 void InspectorInstrumentation::frameScheduledNavigationImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Seconds delay)
 786 {
</pre>
<hr />
<pre>
 802 
 803 void InspectorInstrumentation::willDestroyCachedResourceImpl(CachedResource&amp; cachedResource)
 804 {
 805     if (!s_instrumentingAgentsSet)
 806         return;
 807 
 808     for (auto* instrumentingAgent : *s_instrumentingAgentsSet) {
 809         if (InspectorNetworkAgent* inspectorNetworkAgent = instrumentingAgent-&gt;inspectorNetworkAgent())
 810             inspectorNetworkAgent-&gt;willDestroyCachedResource(cachedResource);
 811     }
 812 }
 813 
 814 // JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
 815 static bool isConsoleAssertMessage(MessageSource source, MessageType type)
 816 {
 817     return source == MessageSource::ConsoleAPI &amp;&amp; type == MessageType::Assert;
 818 }
 819 
 820 void InspectorInstrumentation::addMessageToConsoleImpl(InstrumentingAgents&amp; instrumentingAgents, std::unique_ptr&lt;ConsoleMessage&gt; message)
 821 {



 822     MessageSource source = message-&gt;source();
 823     MessageType type = message-&gt;type();
 824     String messageText = message-&gt;message();
 825 
 826     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 827         consoleAgent-&gt;addMessageToConsole(WTFMove(message));
 828     // FIXME: This should just pass the message on to the debugger agent. JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
 829     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent()) {
 830         if (isConsoleAssertMessage(source, type))
 831             debuggerAgent-&gt;handleConsoleAssert(messageText);
 832     }
 833 }
 834 
<span class="line-modified"> 835 void InspectorInstrumentation::consoleCountImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
 836 {
<span class="line-modified"> 837     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified"> 838         consoleAgent-&gt;count(state, WTFMove(arguments));</span>






 839 }
 840 
 841 void InspectorInstrumentation::takeHeapSnapshotImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)
 842 {
 843     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 844         consoleAgent-&gt;takeHeapSnapshot(title);
 845 }
 846 
<span class="line-modified"> 847 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; title)</span>
 848 {
<span class="line-modified"> 849     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
<span class="line-modified"> 850         timelineAgent-&gt;time(frame, title);</span>
<span class="line-modified"> 851     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified"> 852         consoleAgent-&gt;startTiming(title);</span>



 853 }
 854 
<span class="line-modified"> 855 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)</span>
 856 {
<span class="line-modified"> 857     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified"> 858         consoleAgent-&gt;startTiming(title);</span>



 859 }
 860 
<span class="line-modified"> 861 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; title, Ref&lt;ScriptCallStack&gt;&amp;&amp; stack)</span>
 862 {
<span class="line-modified"> 863     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified"> 864         consoleAgent-&gt;stopTiming(title, WTFMove(stack));</span>
<span class="line-modified"> 865     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
<span class="line-modified"> 866         timelineAgent-&gt;timeEnd(frame, title);</span>

 867 }
 868 
<span class="line-modified"> 869 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title, Ref&lt;ScriptCallStack&gt;&amp;&amp; stack)</span>
 870 {
<span class="line-modified"> 871     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified"> 872         consoleAgent-&gt;stopTiming(title, WTFMove(stack));</span>














 873 }
 874 
 875 void InspectorInstrumentation::consoleTimeStampImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)
 876 {
<span class="line-modified"> 877     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
 878         String message;
 879         arguments-&gt;getFirstArgumentAsString(message);
 880         timelineAgent-&gt;didTimeStamp(frame, message);
 881      }
 882 }
 883 
 884 void InspectorInstrumentation::startProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
 885 {
<span class="line-modified"> 886     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.persistentInspectorTimelineAgent())</span>
 887         timelineAgent-&gt;startFromConsole(exec, title);
 888 }
 889 
 890 void InspectorInstrumentation::stopProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
 891 {
<span class="line-modified"> 892     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.persistentInspectorTimelineAgent())</span>
 893         timelineAgent-&gt;stopFromConsole(exec, title);
 894 }
 895 
 896 void InspectorInstrumentation::consoleStartRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, JSC::ExecState&amp; exec, JSC::JSObject* options)
 897 {
 898     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 899         canvasAgent-&gt;consoleStartRecordingCanvas(context, exec, options);
 900 }
 901 
<span class="line-modified"> 902 void InspectorInstrumentation::didOpenDatabaseImpl(InstrumentingAgents&amp; instrumentingAgents, RefPtr&lt;Database&gt;&amp;&amp; database, const String&amp; domain, const String&amp; name, const String&amp; version)</span>
 903 {
<span class="line-modified"> 904     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified"> 905         return;</span>
<span class="line-removed"> 906     if (InspectorDatabaseAgent* dbAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-removed"> 907         dbAgent-&gt;didOpenDatabase(WTFMove(database), domain, name, version);</span>
 908 }
 909 
 910 void InspectorInstrumentation::didDispatchDOMStorageEventImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; key, const String&amp; oldValue, const String&amp; newValue, StorageType storageType, SecurityOrigin* securityOrigin)
 911 {
 912     if (InspectorDOMStorageAgent* domStorageAgent = instrumentingAgents.inspectorDOMStorageAgent())
 913         domStorageAgent-&gt;didDispatchDOMStorageEvent(key, oldValue, newValue, storageType, securityOrigin);
 914 }
 915 
 916 bool InspectorInstrumentation::shouldWaitForDebuggerOnStartImpl(InstrumentingAgents&amp; instrumentingAgents)
 917 {
 918     if (InspectorWorkerAgent* workerAgent = instrumentingAgents.inspectorWorkerAgent())
 919         return workerAgent-&gt;shouldWaitForDebuggerOnStart();
 920     return false;
 921 }
 922 
 923 void InspectorInstrumentation::workerStartedImpl(InstrumentingAgents&amp; instrumentingAgents, WorkerInspectorProxy* proxy, const URL&amp; url)
 924 {
 925     if (InspectorWorkerAgent* workerAgent = instrumentingAgents.inspectorWorkerAgent())
 926         workerAgent-&gt;workerStarted(proxy, url);
 927 }
</pre>
<hr />
<pre>
 975 }
 976 
 977 void InspectorInstrumentation::didChangeCSSCanvasClientNodesImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasBase&amp; canvasBase)
 978 {
 979     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 980         canvasAgent-&gt;didChangeCSSCanvasClientNodes(canvasBase);
 981 }
 982 
 983 void InspectorInstrumentation::didCreateCanvasRenderingContextImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context)
 984 {
 985     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 986         canvasAgent-&gt;didCreateCanvasRenderingContext(context);
 987 }
 988 
 989 void InspectorInstrumentation::didChangeCanvasMemoryImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context)
 990 {
 991     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 992         canvasAgent-&gt;didChangeCanvasMemory(context);
 993 }
 994 
<span class="line-modified"> 995 void InspectorInstrumentation::recordCanvasActionImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; canvasRenderingContext, const String&amp; name, Vector&lt;RecordCanvasActionVariant&gt;&amp;&amp; parameters)</span>
 996 {
 997     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 998         canvasAgent-&gt;recordCanvasAction(canvasRenderingContext, name, WTFMove(parameters));
 999 }
1000 
1001 void InspectorInstrumentation::didFinishRecordingCanvasFrameImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, bool forceDispatch)
1002 {
1003     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1004         canvasAgent-&gt;didFinishRecordingCanvasFrame(context, forceDispatch);
1005 }
1006 
1007 #if ENABLE(WEBGL)
1008 void InspectorInstrumentation::didEnableExtensionImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, const String&amp; extension)
1009 {
1010     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1011         canvasAgent-&gt;didEnableExtension(contextWebGLBase, extension);
1012 }
1013 
1014 void InspectorInstrumentation::didCreateProgramImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, WebGLProgram&amp; program)
1015 {
</pre>
<hr />
<pre>
1043 {
1044     if (InspectorMemoryAgent* memoryAgent = instrumentingAgents.inspectorMemoryAgent())
1045         memoryAgent-&gt;didHandleMemoryPressure(critical);
1046 }
1047 #endif
1048 
1049 void InspectorInstrumentation::networkStateChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
1050 {
1051     if (InspectorApplicationCacheAgent* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1052         applicationCacheAgent-&gt;networkStateChanged();
1053 }
1054 
1055 void InspectorInstrumentation::updateApplicationCacheStatusImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
1056 {
1057     if (auto* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1058         applicationCacheAgent-&gt;updateApplicationCacheStatus(&amp;frame);
1059 }
1060 
1061 bool InspectorInstrumentation::consoleAgentEnabled(ScriptExecutionContext* scriptExecutionContext)
1062 {
<span class="line-modified">1063     InstrumentingAgents* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext);</span>
<span class="line-modified">1064     InspectorConsoleAgent* consoleAgent = instrumentingAgents ? instrumentingAgents-&gt;webConsoleAgent() : nullptr;</span>
<span class="line-modified">1065     return consoleAgent &amp;&amp; consoleAgent-&gt;enabled();</span>



1066 }
1067 
<span class="line-modified">1068 bool InspectorInstrumentation::timelineAgentEnabled(ScriptExecutionContext* scriptExecutionContext)</span>
1069 {
<span class="line-modified">1070     InstrumentingAgents* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext);</span>
<span class="line-modified">1071     return instrumentingAgents &amp;&amp; instrumentingAgents-&gt;inspectorTimelineAgent();</span>


1072 }
1073 
1074 void InspectorInstrumentation::didRequestAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1075 {
1076     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
1077         pageDebuggerAgent-&gt;didRequestAnimationFrame(callbackId, document);
<span class="line-modified">1078     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
1079         timelineAgent-&gt;didRequestAnimationFrame(callbackId, document.frame());
1080 }
1081 
1082 void InspectorInstrumentation::didCancelAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1083 {
1084     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
1085         pageDebuggerAgent-&gt;didCancelAnimationFrame(callbackId);
<span class="line-modified">1086     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
1087         timelineAgent-&gt;didCancelAnimationFrame(callbackId, document.frame());
1088 }
1089 
1090 InspectorInstrumentationCookie InspectorInstrumentation::willFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1091 {
1092     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
1093         pageDebuggerAgent-&gt;willFireAnimationFrame(callbackId);
1094 
1095     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
1096         domDebuggerAgent-&gt;willFireAnimationFrame();
1097 
1098     int timelineAgentId = 0;
<span class="line-modified">1099     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
1100         timelineAgent-&gt;willFireAnimationFrame(callbackId, document.frame());
1101         timelineAgentId = timelineAgent-&gt;id();
1102     }
1103     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
1104 }
1105 
1106 void InspectorInstrumentation::didFireAnimationFrameImpl(const InspectorInstrumentationCookie&amp; cookie)
1107 {
1108     if (InspectorDebuggerAgent* debuggerAgent = cookie.instrumentingAgents()-&gt;inspectorDebuggerAgent())
1109         debuggerAgent-&gt;didDispatchAsyncCall();
1110     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
1111         timelineAgent-&gt;didFireAnimationFrame();
1112 }
1113 
1114 InspectorInstrumentationCookie InspectorInstrumentation::willFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; callbackType, ScriptExecutionContext&amp; context)
1115 {
1116     int timelineAgentId = 0;
<span class="line-modified">1117     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
1118         timelineAgent-&gt;willFireObserverCallback(callbackType, frameForScriptExecutionContext(&amp;context));
1119         timelineAgentId = timelineAgent-&gt;id();
1120     }
1121     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
1122 }
1123 
1124 void InspectorInstrumentation::didFireObserverCallbackImpl(const InspectorInstrumentationCookie&amp; cookie)
1125 {
1126     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
1127         timelineAgent-&gt;didFireObserverCallback();
1128 }
1129 
1130 void InspectorInstrumentation::registerInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1131 {
1132     if (!s_instrumentingAgentsSet)
1133         s_instrumentingAgentsSet = new HashSet&lt;InstrumentingAgents*&gt;();
1134 
1135     s_instrumentingAgentsSet-&gt;add(&amp;instrumentingAgents);
1136 }
1137 
1138 void InspectorInstrumentation::unregisterInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1139 {
1140     if (!s_instrumentingAgentsSet)
1141         return;
1142 
1143     s_instrumentingAgentsSet-&gt;remove(&amp;instrumentingAgents);
1144     if (s_instrumentingAgentsSet-&gt;isEmpty()) {
1145         delete s_instrumentingAgentsSet;
1146         s_instrumentingAgentsSet = nullptr;
1147     }
1148 }
1149 
1150 InspectorTimelineAgent* InspectorInstrumentation::retrieveTimelineAgent(const InspectorInstrumentationCookie&amp; cookie)
1151 {
1152     if (!cookie.isValid())
1153         return nullptr;
1154 
<span class="line-modified">1155     InspectorTimelineAgent* timelineAgent = cookie.instrumentingAgents()-&gt;inspectorTimelineAgent();</span>
1156     if (timelineAgent &amp;&amp; cookie.hasMatchingTimelineAgentId(timelineAgent-&gt;id()))
1157         return timelineAgent;
1158     return nullptr;
1159 }
1160 
1161 InstrumentingAgents* InspectorInstrumentation::instrumentingAgentsForRenderer(RenderObject&amp; renderer)
1162 {
1163     return instrumentingAgentsForFrame(renderer.frame());
1164 }
1165 
1166 void InspectorInstrumentation::layerTreeDidChangeImpl(InstrumentingAgents&amp; instrumentingAgents)
1167 {
1168     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1169         layerTreeAgent-&gt;layerTreeDidChange();
1170 }
1171 
1172 void InspectorInstrumentation::renderLayerDestroyedImpl(InstrumentingAgents&amp; instrumentingAgents, const RenderLayer&amp; renderLayer)
1173 {
1174     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1175         layerTreeAgent-&gt;renderLayerDestroyed(renderLayer);
</pre>
</td>
<td>
<hr />
<pre>
  16 * contributors may be used to endorse or promote products derived from
  17 * this software without specific prior written permission.
  18 *
  19 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  20 * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  21 * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  22 * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  23 * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  24 * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  25 * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  26 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  27 * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  28 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  29 * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  30 */
  31 
  32 #include &quot;config.h&quot;
  33 #include &quot;InspectorInstrumentation.h&quot;
  34 
  35 #include &quot;CachedResource.h&quot;
<span class="line-added">  36 #include &quot;CustomHeaderFields.h&quot;</span>
  37 #include &quot;DOMWindow.h&quot;
  38 #include &quot;DOMWrapperWorld.h&quot;

  39 #include &quot;DocumentLoader.h&quot;
  40 #include &quot;Event.h&quot;
  41 #include &quot;Frame.h&quot;
  42 #include &quot;InspectorApplicationCacheAgent.h&quot;
  43 #include &quot;InspectorCSSAgent.h&quot;
  44 #include &quot;InspectorCanvasAgent.h&quot;
  45 #include &quot;InspectorDOMAgent.h&quot;
  46 #include &quot;InspectorDOMDebuggerAgent.h&quot;
  47 #include &quot;InspectorDOMStorageAgent.h&quot;
  48 #include &quot;InspectorDatabaseAgent.h&quot;
  49 #include &quot;InspectorLayerTreeAgent.h&quot;
  50 #include &quot;InspectorMemoryAgent.h&quot;
  51 #include &quot;InspectorNetworkAgent.h&quot;
  52 #include &quot;InspectorPageAgent.h&quot;
  53 #include &quot;InspectorTimelineAgent.h&quot;
  54 #include &quot;InspectorWorkerAgent.h&quot;
  55 #include &quot;InstrumentingAgents.h&quot;
  56 #include &quot;LoaderStrategy.h&quot;
  57 #include &quot;PageDebuggerAgent.h&quot;
  58 #include &quot;PageHeapAgent.h&quot;
</pre>
<hr />
<pre>
  93 }
  94 
  95 static Frame* frameForScriptExecutionContext(ScriptExecutionContext* context)
  96 {
  97     Frame* frame = nullptr;
  98     if (is&lt;Document&gt;(*context))
  99         frame = downcast&lt;Document&gt;(*context).frame();
 100     return frame;
 101 }
 102 
 103 static Frame* frameForScriptExecutionContext(ScriptExecutionContext&amp; context)
 104 {
 105     Frame* frame = nullptr;
 106     if (is&lt;Document&gt;(context))
 107         frame = downcast&lt;Document&gt;(context).frame();
 108     return frame;
 109 }
 110 
 111 void InspectorInstrumentation::didClearWindowObjectInWorldImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DOMWrapperWorld&amp; world)
 112 {

 113     if (PageDebuggerAgent* debuggerAgent = instrumentingAgents.pageDebuggerAgent()) {
<span class="line-modified"> 114         if (&amp;world == &amp;mainThreadNormalWorld() &amp;&amp; frame.isMainFrame())</span>
 115             debuggerAgent-&gt;didClearMainFrameWindowObject();
 116     }
<span class="line-added"> 117 </span>
 118     if (PageRuntimeAgent* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent()) {
 119         if (&amp;world == &amp;mainThreadNormalWorld())
 120             pageRuntimeAgent-&gt;didCreateMainWorldContext(frame);
 121     }
 122 }
 123 
 124 bool InspectorInstrumentation::isDebuggerPausedImpl(InstrumentingAgents&amp; instrumentingAgents)
 125 {
 126     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 127         return debuggerAgent-&gt;isPaused();
 128     return false;
 129 }
 130 
 131 int InspectorInstrumentation::identifierForNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 132 {
 133     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 134         return domAgent-&gt;identifierForNode(node);
 135     return 0;
 136 }
 137 
</pre>
<hr />
<pre>
 152     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 153         domAgent-&gt;didInsertDOMNode(node);
 154     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 155         domDebuggerAgent-&gt;didInsertDOMNode(node);
 156 }
 157 
 158 void InspectorInstrumentation::willRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 159 {
 160     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 161         domDebuggerAgent-&gt;willRemoveDOMNode(node);
 162 }
 163 
 164 void InspectorInstrumentation::didRemoveDOMNodeImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)
 165 {
 166     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 167         domDebuggerAgent-&gt;didRemoveDOMNode(node);
 168     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 169         domAgent-&gt;didRemoveDOMNode(node);
 170 }
 171 
<span class="line-modified"> 172 void InspectorInstrumentation::willModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; oldValue, const AtomString&amp; newValue)</span>
 173 {
 174     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 175         domDebuggerAgent-&gt;willModifyDOMAttr(element);
 176     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 177         domAgent-&gt;willModifyDOMAttr(element, oldValue, newValue);
 178 }
 179 
<span class="line-modified"> 180 void InspectorInstrumentation::didModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name, const AtomString&amp; value)</span>
 181 {
 182     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 183         domAgent-&gt;didModifyDOMAttr(element, name, value);
 184 }
 185 
<span class="line-modified"> 186 void InspectorInstrumentation::didRemoveDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name)</span>
 187 {
 188     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 189         domAgent-&gt;didRemoveDOMAttr(element, name);
 190 }
 191 
<span class="line-modified"> 192 void InspectorInstrumentation::willInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)</span>
 193 {
<span class="line-modified"> 194     if (auto* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified"> 195         domDebuggerAgent-&gt;willInvalidateStyleAttr(element);</span>
<span class="line-modified"> 196 }</span>
<span class="line-modified"> 197 </span>
<span class="line-added"> 198 void InspectorInstrumentation::didInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)</span>
<span class="line-added"> 199 {</span>
<span class="line-added"> 200     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())</span>
<span class="line-added"> 201         domAgent-&gt;didInvalidateStyleAttr(element);</span>
 202 }
 203 
 204 void InspectorInstrumentation::documentDetachedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 205 {
 206     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 207         cssAgent-&gt;documentDetached(document);
 208 }
 209 
 210 void InspectorInstrumentation::frameWindowDiscardedImpl(InstrumentingAgents&amp; instrumentingAgents, DOMWindow* window)
 211 {
<span class="line-added"> 212     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added"> 213         return;</span>
<span class="line-added"> 214 </span>
 215     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 216         consoleAgent-&gt;frameWindowDiscarded(window);
 217 }
 218 
 219 void InspectorInstrumentation::mediaQueryResultChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
 220 {
 221     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 222         cssAgent-&gt;mediaQueryResultChanged();
 223 }
 224 
 225 void InspectorInstrumentation::activeStyleSheetsUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 226 {
 227     if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 228         cssAgent-&gt;activeStyleSheetsUpdated(document);
 229 }
 230 
 231 void InspectorInstrumentation::didPushShadowRootImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; host, ShadowRoot&amp; root)
 232 {
 233     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 234         domAgent-&gt;didPushShadowRoot(host, root);
</pre>
<hr />
<pre>
 299         domAgent-&gt;characterDataModified(characterData);
 300 }
 301 
 302 void InspectorInstrumentation::willSendXMLHttpRequestImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 303 {
 304     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 305         domDebuggerAgent-&gt;willSendXMLHttpRequest(url);
 306 }
 307 
 308 void InspectorInstrumentation::willFetchImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; url)
 309 {
 310     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 311         domDebuggerAgent-&gt;willFetch(url);
 312 }
 313 
 314 void InspectorInstrumentation::didInstallTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, Seconds timeout, bool singleShot, ScriptExecutionContext&amp; context)
 315 {
 316     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 317         debuggerAgent-&gt;didScheduleAsyncCall(context.execState(), InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId, singleShot);
 318 
<span class="line-modified"> 319     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 320         timelineAgent-&gt;didInstallTimer(timerId, timeout, singleShot, frameForScriptExecutionContext(context));
 321 }
 322 
 323 void InspectorInstrumentation::didRemoveTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, ScriptExecutionContext&amp; context)
 324 {
 325     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 326         debuggerAgent-&gt;didCancelAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);
<span class="line-modified"> 327     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 328         timelineAgent-&gt;didRemoveTimer(timerId, frameForScriptExecutionContext(context));
 329 }
 330 
<span class="line-modified"> 331 void InspectorInstrumentation::didAddEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)</span>
 332 {
 333     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 334         pageDebuggerAgent-&gt;didAddEventListener(target, eventType, listener, capture);
 335     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 336         domAgent-&gt;didAddEventListener(target);
 337 }
 338 
<span class="line-modified"> 339 void InspectorInstrumentation::willRemoveEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)</span>
 340 {
 341     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 342         pageDebuggerAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
 343     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 344         domAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
 345 }
 346 
<span class="line-modified"> 347 bool InspectorInstrumentation::isEventListenerDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)</span>
 348 {
 349     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 350         return domAgent-&gt;isEventListenerDisabled(target, eventType, listener, capture);
 351     return false;
 352 }
 353 
 354 void InspectorInstrumentation::didPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer, JSC::ExecState&amp; state)
 355 {
 356     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 357         pageDebuggerAgent-&gt;didPostMessage(timer, state);
 358 }
 359 
 360 void InspectorInstrumentation::didFailPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 361 {
 362     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 363         pageDebuggerAgent-&gt;didFailPostMessage(timer);
 364 }
 365 
 366 void InspectorInstrumentation::willDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 367 {
 368     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 369         pageDebuggerAgent-&gt;willDispatchPostMessage(timer);
 370 }
 371 
 372 void InspectorInstrumentation::didDispatchPostMessageImpl(InstrumentingAgents&amp; instrumentingAgents, const TimerBase&amp; timer)
 373 {
 374     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 375         pageDebuggerAgent-&gt;didDispatchPostMessage(timer);
 376 }
 377 
 378 InspectorInstrumentationCookie InspectorInstrumentation::willCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; scriptName, int scriptLine, int scriptColumn, ScriptExecutionContext* context)
 379 {
 380     int timelineAgentId = 0;
<span class="line-modified"> 381     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 382         timelineAgent-&gt;willCallFunction(scriptName, scriptLine, scriptColumn, frameForScriptExecutionContext(context));
 383         timelineAgentId = timelineAgent-&gt;id();
 384     }
 385     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 386 }
 387 
 388 void InspectorInstrumentation::didCallFunctionImpl(const InspectorInstrumentationCookie&amp; cookie, ScriptExecutionContext* context)
 389 {
 390     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 391         timelineAgent-&gt;didCallFunction(frameForScriptExecutionContext(context));
 392 }
 393 
 394 InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document, const Event&amp; event, bool hasEventListeners)
 395 {
 396     int timelineAgentId = 0;
<span class="line-modified"> 397     InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent();</span>
 398     if (timelineAgent &amp;&amp; hasEventListeners) {
 399         timelineAgent-&gt;willDispatchEvent(event, document.frame());
 400         timelineAgentId = timelineAgent-&gt;id();
 401     }
 402 
 403     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 404 }
 405 
<span class="line-modified"> 406 void InspectorInstrumentation::willHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents, Event&amp; event, const RegisteredEventListener&amp; listener)</span>
 407 {
 408     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 409         pageDebuggerAgent-&gt;willHandleEvent(listener);
 410 
 411     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 412         domDebuggerAgent-&gt;willHandleEvent(event, listener);
 413 }
 414 
 415 void InspectorInstrumentation::didHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents)
 416 {
 417     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 418         debuggerAgent-&gt;didDispatchAsyncCall();
<span class="line-added"> 419 </span>
<span class="line-added"> 420     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-added"> 421         domDebuggerAgent-&gt;didHandleEvent();</span>
 422 }
 423 
<span class="line-modified"> 424 void InspectorInstrumentation::didDispatchEventImpl(const InspectorInstrumentationCookie&amp; cookie, bool defaultPrevented)</span>
 425 {
 426     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified"> 427         timelineAgent-&gt;didDispatchEvent(defaultPrevented);</span>
 428 }
 429 
 430 InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, DOMWindow&amp; window)
 431 {
 432     int timelineAgentId = 0;
<span class="line-modified"> 433     InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent();</span>
 434     if (timelineAgent &amp;&amp; window.hasEventListeners(event.type())) {
 435         timelineAgent-&gt;willDispatchEvent(event, window.frame());
 436         timelineAgentId = timelineAgent-&gt;id();
 437     }
 438 
 439     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 440 }
 441 
<span class="line-modified"> 442 void InspectorInstrumentation::didDispatchEventOnWindowImpl(const InspectorInstrumentationCookie&amp; cookie, bool defaultPrevented)</span>
 443 {
 444     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified"> 445         timelineAgent-&gt;didDispatchEvent(defaultPrevented);</span>
 446 }
 447 
 448 void InspectorInstrumentation::eventDidResetAfterDispatchImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)
 449 {
 450     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
 451         domAgent-&gt;eventDidResetAfterDispatch(event);
 452 }
 453 
 454 InspectorInstrumentationCookie InspectorInstrumentation::willEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; url, int lineNumber, int columnNumber)
 455 {
 456     int timelineAgentId = 0;
<span class="line-modified"> 457     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 458         timelineAgent-&gt;willEvaluateScript(url, lineNumber, columnNumber, frame);
 459         timelineAgentId = timelineAgent-&gt;id();
 460     }
 461     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 462 }
 463 
 464 void InspectorInstrumentation::didEvaluateScriptImpl(const InspectorInstrumentationCookie&amp; cookie, Frame&amp; frame)
 465 {
 466     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 467         timelineAgent-&gt;didEvaluateScript(frame);
 468 }
 469 
 470 InspectorInstrumentationCookie InspectorInstrumentation::willFireTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, bool oneShot, ScriptExecutionContext&amp; context)
 471 {
 472     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
 473         debuggerAgent-&gt;willDispatchAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);
 474 
 475     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 476         domDebuggerAgent-&gt;willFireTimer(oneShot);
 477 
 478     int timelineAgentId = 0;
<span class="line-modified"> 479     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 480         timelineAgent-&gt;willFireTimer(timerId, frameForScriptExecutionContext(context));
 481         timelineAgentId = timelineAgent-&gt;id();
 482     }
 483     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 484 }
 485 
 486 void InspectorInstrumentation::didFireTimerImpl(const InspectorInstrumentationCookie&amp; cookie)
 487 {
 488     if (InspectorDebuggerAgent* debuggerAgent = cookie.instrumentingAgents()-&gt;inspectorDebuggerAgent())
 489         debuggerAgent-&gt;didDispatchAsyncCall();
 490     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 491         timelineAgent-&gt;didFireTimer();
 492 }
 493 
 494 void InspectorInstrumentation::didInvalidateLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 495 {
<span class="line-modified"> 496     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 497         timelineAgent-&gt;didInvalidateLayout(frame);
 498 }
 499 
 500 InspectorInstrumentationCookie InspectorInstrumentation::willLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 501 {
 502     int timelineAgentId = 0;
<span class="line-modified"> 503     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 504         timelineAgent-&gt;willLayout(frame);
 505         timelineAgentId = timelineAgent-&gt;id();
 506     }
 507     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 508 }
 509 
 510 void InspectorInstrumentation::didLayoutImpl(const InspectorInstrumentationCookie&amp; cookie, RenderObject&amp; root)
 511 {
 512     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 513         timelineAgent-&gt;didLayout(root);
 514 
 515     if (InspectorPageAgent* pageAgent = cookie.instrumentingAgents()-&gt;inspectorPageAgent())
 516         pageAgent-&gt;didLayout();
 517 }
 518 
 519 void InspectorInstrumentation::willCompositeImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 520 {
<span class="line-modified"> 521     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 522         timelineAgent-&gt;willComposite(frame);
 523 }
 524 
 525 void InspectorInstrumentation::didCompositeImpl(InstrumentingAgents&amp; instrumentingAgents)
 526 {
<span class="line-modified"> 527     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 528         timelineAgent-&gt;didComposite();
 529 }
 530 
 531 void InspectorInstrumentation::willPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer)
 532 {
<span class="line-modified"> 533     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 534         timelineAgent-&gt;willPaint(renderer.frame());
 535 }
 536 
 537 void InspectorInstrumentation::didPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer, const LayoutRect&amp; rect)
 538 {
<span class="line-modified"> 539     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 540         timelineAgent-&gt;didPaint(renderer, rect);
 541 
 542     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 543         pageAgent-&gt;didPaint(renderer, rect);
 544 }
 545 
 546 InspectorInstrumentationCookie InspectorInstrumentation::willRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 547 {
 548     int timelineAgentId = 0;
<span class="line-modified"> 549     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 550         timelineAgent-&gt;willRecalculateStyle(document.frame());
 551         timelineAgentId = timelineAgent-&gt;id();
 552     }
 553     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 554         networkAgent-&gt;willRecalculateStyle();
 555     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
 556 }
 557 
 558 void InspectorInstrumentation::didRecalculateStyleImpl(const InspectorInstrumentationCookie&amp; cookie)
 559 {
 560     if (!cookie.isValid())
 561         return;
 562 
 563     InstrumentingAgents&amp; instrumentingAgents = *cookie.instrumentingAgents();
 564 
 565     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
 566         timelineAgent-&gt;didRecalculateStyle();
 567     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 568         networkAgent-&gt;didRecalculateStyle();
 569     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 570         pageAgent-&gt;didRecalculateStyle();
 571 }
 572 
 573 void InspectorInstrumentation::didScheduleStyleRecalculationImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
 574 {
<span class="line-modified"> 575     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 576         timelineAgent-&gt;didScheduleStyleRecalculation(document.frame());
 577     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 578         networkAgent-&gt;didScheduleStyleRecalculation(document);
 579 }
 580 
 581 void InspectorInstrumentation::applyUserAgentOverrideImpl(InstrumentingAgents&amp; instrumentingAgents, String&amp; userAgent)
 582 {
 583     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 584         pageAgent-&gt;applyUserAgentOverride(userAgent);
 585 }
 586 
 587 void InspectorInstrumentation::applyEmulatedMediaImpl(InstrumentingAgents&amp; instrumentingAgents, String&amp; media)
 588 {
 589     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 590         pageAgent-&gt;applyEmulatedMedia(media);
 591 }
 592 
 593 void InspectorInstrumentation::willSendRequestImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, ResourceRequest&amp; request, const ResourceResponse&amp; redirectResponse)
 594 {
 595     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 596         networkAgent-&gt;willSendRequest(identifier, loader, request, redirectResponse);
 597 }
 598 
 599 void InspectorInstrumentation::willSendRequestOfTypeImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, ResourceRequest&amp; request, LoadType loadType)
 600 {
 601     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 602         networkAgent-&gt;willSendRequestOfType(identifier, loader, request, loadType);
 603 }
 604 
 605 void InspectorInstrumentation::didLoadResourceFromMemoryCacheImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader* loader, CachedResource* cachedResource)
 606 {
 607     if (!loader || !cachedResource)
 608         return;
 609 
 610     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 611         networkAgent-&gt;didLoadResourceFromMemoryCache(loader, *cachedResource);
 612 }
 613 
 614 void InspectorInstrumentation::didReceiveResourceResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceResponse&amp; response, ResourceLoader* resourceLoader)
 615 {
<span class="line-added"> 616     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added"> 617         return;</span>
<span class="line-added"> 618 </span>
 619     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 620         networkAgent-&gt;didReceiveResponse(identifier, loader, response, resourceLoader);
 621     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 622         consoleAgent-&gt;didReceiveResponse(identifier, response); // This should come AFTER resource notification, front-end relies on this.
 623 }
 624 
 625 void InspectorInstrumentation::didReceiveThreadableLoaderResponseImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentThreadableLoader&amp; documentThreadableLoader, unsigned long identifier)
 626 {
 627     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 628         networkAgent-&gt;didReceiveThreadableLoaderResponse(identifier, documentThreadableLoader);
 629 }
 630 
 631 void InspectorInstrumentation::didReceiveDataImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const char* data, int dataLength, int encodedDataLength)
 632 {
 633     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 634         networkAgent-&gt;didReceiveData(identifier, data, dataLength, encodedDataLength);
 635 }
 636 
 637 void InspectorInstrumentation::didFinishLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const NetworkLoadMetrics&amp; networkLoadMetrics, ResourceLoader* resourceLoader)
 638 {
 639     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 640         networkAgent-&gt;didFinishLoading(identifier, loader, networkLoadMetrics, resourceLoader);
 641 }
 642 
 643 void InspectorInstrumentation::didFailLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceError&amp; error)
 644 {
<span class="line-added"> 645     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added"> 646         return;</span>
<span class="line-added"> 647 </span>
 648     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 649         networkAgent-&gt;didFailLoading(identifier, loader, error);
 650     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 651         consoleAgent-&gt;didFailLoading(identifier, error); // This should come AFTER resource notification, front-end relies on this.
 652 }
 653 
 654 void InspectorInstrumentation::willLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 655 {
 656     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 657         networkAgent-&gt;willLoadXHRSynchronously();
 658 }
 659 
 660 void InspectorInstrumentation::didLoadXHRSynchronouslyImpl(InstrumentingAgents&amp; instrumentingAgents)
 661 {
 662     if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 663         networkAgent-&gt;didLoadXHRSynchronously();
 664 }
 665 
 666 void InspectorInstrumentation::scriptImportedImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, const String&amp; sourceString)
 667 {
</pre>
<hr />
<pre>
 711         return;
 712 
 713     if (!frame.page())
 714         return;
 715 
 716     if (!loader)
 717         return;
 718 
 719     ASSERT(loader-&gt;frame() == &amp;frame);
 720 
 721     if (frame.isMainFrame()) {
 722         if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 723             consoleAgent-&gt;reset();
 724 
 725         if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
 726             networkAgent-&gt;mainFrameNavigated(*loader);
 727 
 728         if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
 729             cssAgent-&gt;reset();
 730 
<span class="line-modified"> 731         if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-modified"> 732             databaseAgent-&gt;didCommitLoad();</span>
 733 
 734         if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 735             domAgent-&gt;setDocument(frame.document());
 736 
 737         if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
 738             layerTreeAgent-&gt;reset();
 739 
 740         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 741             pageDebuggerAgent-&gt;mainFrameNavigated();
 742 
 743         if (PageHeapAgent* pageHeapAgent = instrumentingAgents.pageHeapAgent())
 744             pageHeapAgent-&gt;mainFrameNavigated();
 745     }
 746 
 747     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 748         canvasAgent-&gt;frameNavigated(frame);
 749 
 750     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 751         domAgent-&gt;didCommitLoad(frame.document());
 752 
 753     if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
 754         pageAgent-&gt;frameNavigated(frame);
 755 
 756     if (frame.isMainFrame()) {
<span class="line-modified"> 757         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
 758             timelineAgent-&gt;mainFrameNavigated();
 759     }
 760 }
 761 
 762 void InspectorInstrumentation::frameDocumentUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 763 {
 764     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
 765         domAgent-&gt;frameDocumentUpdated(frame);
 766 
 767     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
 768         domDebuggerAgent-&gt;frameDocumentUpdated(frame);
 769 }
 770 
 771 void InspectorInstrumentation::loaderDetachedFromFrameImpl(InstrumentingAgents&amp; instrumentingAgents, DocumentLoader&amp; loader)
 772 {
 773     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 774         inspectorPageAgent-&gt;loaderDetachedFromFrame(loader);
 775 }
 776 
 777 void InspectorInstrumentation::frameStartedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 778 {
 779     if (frame.isMainFrame()) {
 780         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 781             pageDebuggerAgent-&gt;mainFrameStartedLoading();
<span class="line-modified"> 782         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 783             timelineAgent-&gt;mainFrameStartedLoading();
 784     }
 785 
 786     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 787         inspectorPageAgent-&gt;frameStartedLoading(frame);
 788 }
 789 
 790 void InspectorInstrumentation::frameStoppedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
 791 {
 792     if (frame.isMainFrame()) {
 793         if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
 794             pageDebuggerAgent-&gt;mainFrameStoppedLoading();
 795     }
 796 
 797     if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
 798         inspectorPageAgent-&gt;frameStoppedLoading(frame);
 799 }
 800 
 801 void InspectorInstrumentation::frameScheduledNavigationImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Seconds delay)
 802 {
</pre>
<hr />
<pre>
 818 
 819 void InspectorInstrumentation::willDestroyCachedResourceImpl(CachedResource&amp; cachedResource)
 820 {
 821     if (!s_instrumentingAgentsSet)
 822         return;
 823 
 824     for (auto* instrumentingAgent : *s_instrumentingAgentsSet) {
 825         if (InspectorNetworkAgent* inspectorNetworkAgent = instrumentingAgent-&gt;inspectorNetworkAgent())
 826             inspectorNetworkAgent-&gt;willDestroyCachedResource(cachedResource);
 827     }
 828 }
 829 
 830 // JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
 831 static bool isConsoleAssertMessage(MessageSource source, MessageType type)
 832 {
 833     return source == MessageSource::ConsoleAPI &amp;&amp; type == MessageType::Assert;
 834 }
 835 
 836 void InspectorInstrumentation::addMessageToConsoleImpl(InstrumentingAgents&amp; instrumentingAgents, std::unique_ptr&lt;ConsoleMessage&gt; message)
 837 {
<span class="line-added"> 838     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added"> 839         return;</span>
<span class="line-added"> 840 </span>
 841     MessageSource source = message-&gt;source();
 842     MessageType type = message-&gt;type();
 843     String messageText = message-&gt;message();
 844 
 845     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 846         consoleAgent-&gt;addMessageToConsole(WTFMove(message));
 847     // FIXME: This should just pass the message on to the debugger agent. JavaScriptCore InspectorDebuggerAgent should know Console MessageTypes.
 848     if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent()) {
 849         if (isConsoleAssertMessage(source, type))
 850             debuggerAgent-&gt;handleConsoleAssert(messageText);
 851     }
 852 }
 853 
<span class="line-modified"> 854 void InspectorInstrumentation::consoleCountImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, const String&amp; label)</span>
 855 {
<span class="line-modified"> 856     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified"> 857         consoleAgent-&gt;count(state, label);</span>
<span class="line-added"> 858 }</span>
<span class="line-added"> 859 </span>
<span class="line-added"> 860 void InspectorInstrumentation::consoleCountResetImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, const String&amp; label)</span>
<span class="line-added"> 861 {</span>
<span class="line-added"> 862     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added"> 863         consoleAgent-&gt;countReset(state, label);</span>
 864 }
 865 
 866 void InspectorInstrumentation::takeHeapSnapshotImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)
 867 {
 868     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
 869         consoleAgent-&gt;takeHeapSnapshot(title);
 870 }
 871 
<span class="line-modified"> 872 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::ExecState* exec, const String&amp; label)</span>
 873 {
<span class="line-modified"> 874     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified"> 875         return;</span>
<span class="line-modified"> 876 </span>
<span class="line-modified"> 877     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
<span class="line-added"> 878         timelineAgent-&gt;time(frame, label);</span>
<span class="line-added"> 879     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added"> 880         consoleAgent-&gt;startTiming(exec, label);</span>
 881 }
 882 
<span class="line-modified"> 883 void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label)</span>
 884 {
<span class="line-modified"> 885     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified"> 886         return;</span>
<span class="line-added"> 887 </span>
<span class="line-added"> 888     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added"> 889         consoleAgent-&gt;startTiming(exec, label);</span>
 890 }
 891 
<span class="line-modified"> 892 void InspectorInstrumentation::logConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label, Ref&lt;Inspector::ScriptArguments&gt;&amp;&amp; arguments)</span>
 893 {
<span class="line-modified"> 894     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified"> 895         return;</span>
<span class="line-modified"> 896 </span>
<span class="line-modified"> 897     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added"> 898         consoleAgent-&gt;logTiming(exec, label, WTFMove(arguments));</span>
 899 }
 900 
<span class="line-modified"> 901 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::ExecState* exec, const String&amp; label)</span>
 902 {
<span class="line-modified"> 903     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified"> 904         return;</span>
<span class="line-added"> 905 </span>
<span class="line-added"> 906     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added"> 907         consoleAgent-&gt;stopTiming(exec, label);</span>
<span class="line-added"> 908     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
<span class="line-added"> 909         timelineAgent-&gt;timeEnd(frame, label);</span>
<span class="line-added"> 910 }</span>
<span class="line-added"> 911 </span>
<span class="line-added"> 912 void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label)</span>
<span class="line-added"> 913 {</span>
<span class="line-added"> 914     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added"> 915         return;</span>
<span class="line-added"> 916 </span>
<span class="line-added"> 917     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added"> 918         consoleAgent-&gt;stopTiming(exec, label);</span>
 919 }
 920 
 921 void InspectorInstrumentation::consoleTimeStampImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)
 922 {
<span class="line-modified"> 923     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
 924         String message;
 925         arguments-&gt;getFirstArgumentAsString(message);
 926         timelineAgent-&gt;didTimeStamp(frame, message);
 927      }
 928 }
 929 
 930 void InspectorInstrumentation::startProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
 931 {
<span class="line-modified"> 932     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 933         timelineAgent-&gt;startFromConsole(exec, title);
 934 }
 935 
 936 void InspectorInstrumentation::stopProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
 937 {
<span class="line-modified"> 938     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
 939         timelineAgent-&gt;stopFromConsole(exec, title);
 940 }
 941 
 942 void InspectorInstrumentation::consoleStartRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, JSC::ExecState&amp; exec, JSC::JSObject* options)
 943 {
 944     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
 945         canvasAgent-&gt;consoleStartRecordingCanvas(context, exec, options);
 946 }
 947 
<span class="line-modified"> 948 void InspectorInstrumentation::didOpenDatabaseImpl(InstrumentingAgents&amp; instrumentingAgents, Database&amp; database)</span>
 949 {
<span class="line-modified"> 950     if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-modified"> 951         databaseAgent-&gt;didOpenDatabase(database);</span>


 952 }
 953 
 954 void InspectorInstrumentation::didDispatchDOMStorageEventImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; key, const String&amp; oldValue, const String&amp; newValue, StorageType storageType, SecurityOrigin* securityOrigin)
 955 {
 956     if (InspectorDOMStorageAgent* domStorageAgent = instrumentingAgents.inspectorDOMStorageAgent())
 957         domStorageAgent-&gt;didDispatchDOMStorageEvent(key, oldValue, newValue, storageType, securityOrigin);
 958 }
 959 
 960 bool InspectorInstrumentation::shouldWaitForDebuggerOnStartImpl(InstrumentingAgents&amp; instrumentingAgents)
 961 {
 962     if (InspectorWorkerAgent* workerAgent = instrumentingAgents.inspectorWorkerAgent())
 963         return workerAgent-&gt;shouldWaitForDebuggerOnStart();
 964     return false;
 965 }
 966 
 967 void InspectorInstrumentation::workerStartedImpl(InstrumentingAgents&amp; instrumentingAgents, WorkerInspectorProxy* proxy, const URL&amp; url)
 968 {
 969     if (InspectorWorkerAgent* workerAgent = instrumentingAgents.inspectorWorkerAgent())
 970         workerAgent-&gt;workerStarted(proxy, url);
 971 }
</pre>
<hr />
<pre>
1019 }
1020 
1021 void InspectorInstrumentation::didChangeCSSCanvasClientNodesImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasBase&amp; canvasBase)
1022 {
1023     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1024         canvasAgent-&gt;didChangeCSSCanvasClientNodes(canvasBase);
1025 }
1026 
1027 void InspectorInstrumentation::didCreateCanvasRenderingContextImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context)
1028 {
1029     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1030         canvasAgent-&gt;didCreateCanvasRenderingContext(context);
1031 }
1032 
1033 void InspectorInstrumentation::didChangeCanvasMemoryImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context)
1034 {
1035     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1036         canvasAgent-&gt;didChangeCanvasMemory(context);
1037 }
1038 
<span class="line-modified">1039 void InspectorInstrumentation::recordCanvasActionImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; canvasRenderingContext, const String&amp; name, std::initializer_list&lt;RecordCanvasActionVariant&gt;&amp;&amp; parameters)</span>
1040 {
1041     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1042         canvasAgent-&gt;recordCanvasAction(canvasRenderingContext, name, WTFMove(parameters));
1043 }
1044 
1045 void InspectorInstrumentation::didFinishRecordingCanvasFrameImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, bool forceDispatch)
1046 {
1047     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1048         canvasAgent-&gt;didFinishRecordingCanvasFrame(context, forceDispatch);
1049 }
1050 
1051 #if ENABLE(WEBGL)
1052 void InspectorInstrumentation::didEnableExtensionImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, const String&amp; extension)
1053 {
1054     if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
1055         canvasAgent-&gt;didEnableExtension(contextWebGLBase, extension);
1056 }
1057 
1058 void InspectorInstrumentation::didCreateProgramImpl(InstrumentingAgents&amp; instrumentingAgents, WebGLRenderingContextBase&amp; contextWebGLBase, WebGLProgram&amp; program)
1059 {
</pre>
<hr />
<pre>
1087 {
1088     if (InspectorMemoryAgent* memoryAgent = instrumentingAgents.inspectorMemoryAgent())
1089         memoryAgent-&gt;didHandleMemoryPressure(critical);
1090 }
1091 #endif
1092 
1093 void InspectorInstrumentation::networkStateChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
1094 {
1095     if (InspectorApplicationCacheAgent* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1096         applicationCacheAgent-&gt;networkStateChanged();
1097 }
1098 
1099 void InspectorInstrumentation::updateApplicationCacheStatusImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
1100 {
1101     if (auto* applicationCacheAgent = instrumentingAgents.inspectorApplicationCacheAgent())
1102         applicationCacheAgent-&gt;updateApplicationCacheStatus(&amp;frame);
1103 }
1104 
1105 bool InspectorInstrumentation::consoleAgentEnabled(ScriptExecutionContext* scriptExecutionContext)
1106 {
<span class="line-modified">1107     FAST_RETURN_IF_NO_FRONTENDS(false);</span>
<span class="line-modified">1108     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext)) {</span>
<span class="line-modified">1109         if (auto* webConsoleAgent = instrumentingAgents-&gt;webConsoleAgent())</span>
<span class="line-added">1110             return webConsoleAgent-&gt;enabled();</span>
<span class="line-added">1111     }</span>
<span class="line-added">1112     return false;</span>
1113 }
1114 
<span class="line-modified">1115 bool InspectorInstrumentation::timelineAgentTracking(ScriptExecutionContext* scriptExecutionContext)</span>
1116 {
<span class="line-modified">1117     FAST_RETURN_IF_NO_FRONTENDS(false);</span>
<span class="line-modified">1118     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext))</span>
<span class="line-added">1119         return instrumentingAgents-&gt;trackingInspectorTimelineAgent();</span>
<span class="line-added">1120     return false;</span>
1121 }
1122 
1123 void InspectorInstrumentation::didRequestAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1124 {
1125     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
1126         pageDebuggerAgent-&gt;didRequestAnimationFrame(callbackId, document);
<span class="line-modified">1127     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
1128         timelineAgent-&gt;didRequestAnimationFrame(callbackId, document.frame());
1129 }
1130 
1131 void InspectorInstrumentation::didCancelAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1132 {
1133     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
1134         pageDebuggerAgent-&gt;didCancelAnimationFrame(callbackId);
<span class="line-modified">1135     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
1136         timelineAgent-&gt;didCancelAnimationFrame(callbackId, document.frame());
1137 }
1138 
1139 InspectorInstrumentationCookie InspectorInstrumentation::willFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
1140 {
1141     if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
1142         pageDebuggerAgent-&gt;willFireAnimationFrame(callbackId);
1143 
1144     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
1145         domDebuggerAgent-&gt;willFireAnimationFrame();
1146 
1147     int timelineAgentId = 0;
<span class="line-modified">1148     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
1149         timelineAgent-&gt;willFireAnimationFrame(callbackId, document.frame());
1150         timelineAgentId = timelineAgent-&gt;id();
1151     }
1152     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
1153 }
1154 
1155 void InspectorInstrumentation::didFireAnimationFrameImpl(const InspectorInstrumentationCookie&amp; cookie)
1156 {
1157     if (InspectorDebuggerAgent* debuggerAgent = cookie.instrumentingAgents()-&gt;inspectorDebuggerAgent())
1158         debuggerAgent-&gt;didDispatchAsyncCall();
1159     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
1160         timelineAgent-&gt;didFireAnimationFrame();
1161 }
1162 
1163 InspectorInstrumentationCookie InspectorInstrumentation::willFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; callbackType, ScriptExecutionContext&amp; context)
1164 {
1165     int timelineAgentId = 0;
<span class="line-modified">1166     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
1167         timelineAgent-&gt;willFireObserverCallback(callbackType, frameForScriptExecutionContext(&amp;context));
1168         timelineAgentId = timelineAgent-&gt;id();
1169     }
1170     return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
1171 }
1172 
1173 void InspectorInstrumentation::didFireObserverCallbackImpl(const InspectorInstrumentationCookie&amp; cookie)
1174 {
1175     if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
1176         timelineAgent-&gt;didFireObserverCallback();
1177 }
1178 
1179 void InspectorInstrumentation::registerInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1180 {
1181     if (!s_instrumentingAgentsSet)
1182         s_instrumentingAgentsSet = new HashSet&lt;InstrumentingAgents*&gt;();
1183 
1184     s_instrumentingAgentsSet-&gt;add(&amp;instrumentingAgents);
1185 }
1186 
1187 void InspectorInstrumentation::unregisterInstrumentingAgents(InstrumentingAgents&amp; instrumentingAgents)
1188 {
1189     if (!s_instrumentingAgentsSet)
1190         return;
1191 
1192     s_instrumentingAgentsSet-&gt;remove(&amp;instrumentingAgents);
1193     if (s_instrumentingAgentsSet-&gt;isEmpty()) {
1194         delete s_instrumentingAgentsSet;
1195         s_instrumentingAgentsSet = nullptr;
1196     }
1197 }
1198 
1199 InspectorTimelineAgent* InspectorInstrumentation::retrieveTimelineAgent(const InspectorInstrumentationCookie&amp; cookie)
1200 {
1201     if (!cookie.isValid())
1202         return nullptr;
1203 
<span class="line-modified">1204     InspectorTimelineAgent* timelineAgent = cookie.instrumentingAgents()-&gt;trackingInspectorTimelineAgent();</span>
1205     if (timelineAgent &amp;&amp; cookie.hasMatchingTimelineAgentId(timelineAgent-&gt;id()))
1206         return timelineAgent;
1207     return nullptr;
1208 }
1209 
1210 InstrumentingAgents* InspectorInstrumentation::instrumentingAgentsForRenderer(RenderObject&amp; renderer)
1211 {
1212     return instrumentingAgentsForFrame(renderer.frame());
1213 }
1214 
1215 void InspectorInstrumentation::layerTreeDidChangeImpl(InstrumentingAgents&amp; instrumentingAgents)
1216 {
1217     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1218         layerTreeAgent-&gt;layerTreeDidChange();
1219 }
1220 
1221 void InspectorInstrumentation::renderLayerDestroyedImpl(InstrumentingAgents&amp; instrumentingAgents, const RenderLayer&amp; renderLayer)
1222 {
1223     if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
1224         layerTreeAgent-&gt;renderLayerDestroyed(renderLayer);
</pre>
</td>
</tr>
</table>
<center><a href="InspectorHistory.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorInstrumentation.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>