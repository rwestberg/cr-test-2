<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="JSGenericTypedArrayViewPrototypeFunctions.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSGlobalObject.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/JavaScriptCore/runtime/JSGlobalObject.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -120,12 +120,20 @@</span>
  #include &quot;JSTypedArrayPrototypes.h&quot;
  #include &quot;JSTypedArrayViewConstructor.h&quot;
  #include &quot;JSTypedArrayViewPrototype.h&quot;
  #include &quot;JSTypedArrays.h&quot;
  #include &quot;JSWeakMap.h&quot;
<span class="udiff-line-added">+ #include &quot;JSWeakObjectRef.h&quot;</span>
  #include &quot;JSWeakSet.h&quot;
  #include &quot;JSWebAssembly.h&quot;
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyCompileError.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyInstance.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyLinkError.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyMemory.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyModule.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyRuntimeError.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;JSWebAssemblyTable.h&quot;</span>
  #include &quot;JSWithScope.h&quot;
  #include &quot;LazyClassStructureInlines.h&quot;
  #include &quot;LazyPropertyInlines.h&quot;
  #include &quot;Lookup.h&quot;
  #include &quot;MapConstructor.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -153,10 +161,11 @@</span>
  #include &quot;RegExpCache.h&quot;
  #include &quot;RegExpConstructor.h&quot;
  #include &quot;RegExpMatchesArray.h&quot;
  #include &quot;RegExpObject.h&quot;
  #include &quot;RegExpPrototype.h&quot;
<span class="udiff-line-added">+ #include &quot;RegExpStringIteratorPrototype.h&quot;</span>
  #include &quot;ScopedArguments.h&quot;
  #include &quot;SetConstructor.h&quot;
  #include &quot;SetIteratorPrototype.h&quot;
  #include &quot;SetPrototype.h&quot;
  #include &quot;StrictEvalActivation.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -166,16 +175,34 @@</span>
  #include &quot;Symbol.h&quot;
  #include &quot;SymbolConstructor.h&quot;
  #include &quot;SymbolObject.h&quot;
  #include &quot;SymbolPrototype.h&quot;
  #include &quot;VariableWriteFireDetail.h&quot;
<span class="udiff-line-added">+ #include &quot;WasmCapabilities.h&quot;</span>
  #include &quot;WeakGCMapInlines.h&quot;
  #include &quot;WeakMapConstructor.h&quot;
  #include &quot;WeakMapPrototype.h&quot;
<span class="udiff-line-added">+ #include &quot;WeakObjectRefConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WeakObjectRefPrototype.h&quot;</span>
  #include &quot;WeakSetConstructor.h&quot;
  #include &quot;WeakSetPrototype.h&quot;
<span class="udiff-line-modified-removed">- #include &quot;WebAssemblyPrototype.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;WebAssemblyCompileErrorConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyCompileErrorPrototype.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyFunction.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyInstanceConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyInstancePrototype.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyLinkErrorConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyLinkErrorPrototype.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyMemoryConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyMemoryPrototype.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyModuleConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyModulePrototype.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyModuleRecord.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyRuntimeErrorConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyRuntimeErrorPrototype.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyTableConstructor.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;WebAssemblyTablePrototype.h&quot;</span>
  #include &quot;WebAssemblyToJSCallee.h&quot;
  #include &lt;wtf/RandomNumber.h&gt;
  
  #if ENABLE(INTL)
  #include &quot;IntlCollator.h&quot;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -202,10 +229,17 @@</span>
  #include &quot;JSCWrapperMap.h&quot;
  #endif
  
  namespace JSC {
  
<span class="udiff-line-added">+ #define CHECK_FEATURE_FLAG_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
<span class="udiff-line-added">+ static_assert(std::is_same_v&lt;std::remove_cv_t&lt;decltype(featureFlag)&gt;, bool&gt; || std::is_same_v&lt;std::remove_cv_t&lt;decltype(featureFlag)&gt;, bool&amp;&gt;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+ FOR_EACH_SIMPLE_BUILTIN_TYPE(CHECK_FEATURE_FLAG_TYPE)</span>
<span class="udiff-line-added">+ FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(CHECK_FEATURE_FLAG_TYPE)</span>
<span class="udiff-line-added">+ FOR_EACH_LAZY_BUILTIN_TYPE(CHECK_FEATURE_FLAG_TYPE)</span>
<span class="udiff-line-added">+ </span>
  static JSValue createProxyProperty(VM&amp; vm, JSObject* object)
  {
      JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
      return ProxyConstructor::create(vm, ProxyConstructor::createStructure(vm, global, global-&gt;functionPrototype()));
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -220,29 +254,42 @@</span>
  {
      JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
      return MathObject::create(vm, global, MathObject::createStructure(vm, global, global-&gt;objectPrototype()));
  }
  
<span class="udiff-line-added">+ static JSValue createReflectProperty(VM&amp; vm, JSObject* object)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);</span>
<span class="udiff-line-added">+     return ReflectObject::create(vm, global, ReflectObject::createStructure(vm, global, global-&gt;objectPrototype()));</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  static JSValue createConsoleProperty(VM&amp; vm, JSObject* object)
  {
      JSGlobalObject* global = jsCast&lt;JSGlobalObject*&gt;(object);
      return ConsoleObject::create(vm, global, ConsoleObject::createStructure(vm, global, constructEmptyObject(global-&gt;globalExec())));
  }
  
  static EncodedJSValue JSC_HOST_CALL makeBoundFunction(ExecState* exec)
  {
      VM&amp; vm = exec-&gt;vm();
<span class="udiff-line-added">+     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="udiff-line-added">+ </span>
      JSGlobalObject* globalObject = exec-&gt;lexicalGlobalObject();
  
      JSObject* target = asObject(exec-&gt;uncheckedArgument(0));
      JSValue boundThis = exec-&gt;uncheckedArgument(1);
      JSValue boundArgs = exec-&gt;uncheckedArgument(2);
<span class="udiff-line-modified-removed">-     JSValue length = exec-&gt;uncheckedArgument(3);</span>
<span class="udiff-line-modified-removed">-     JSString* name = asString(exec-&gt;uncheckedArgument(4));</span>
<span class="udiff-line-modified-added">+     JSValue lengthValue = exec-&gt;uncheckedArgument(3);</span>
<span class="udiff-line-modified-added">+     JSString* nameString = asString(exec-&gt;uncheckedArgument(4));</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ASSERT(lengthValue.isInt32AsAnyInt());</span>
<span class="udiff-line-added">+     int32_t length = lengthValue.asInt32AsAnyInt();</span>
  
<span class="udiff-line-modified-removed">-     return JSValue::encode(JSBoundFunction::create(</span>
<span class="udiff-line-modified-removed">-         vm, exec, globalObject, target, boundThis, boundArgs.isCell() ? jsCast&lt;JSArray*&gt;(boundArgs) : nullptr, length.asInt32(), name-&gt;value(exec)));</span>
<span class="udiff-line-modified-added">+     String name = nameString-&gt;value(exec);</span>
<span class="udiff-line-modified-added">+     RETURN_IF_EXCEPTION(scope, { });</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     RELEASE_AND_RETURN(scope, JSValue::encode(JSBoundFunction::create(vm, exec, globalObject, target, boundThis, boundArgs.isCell() ? jsCast&lt;JSArray*&gt;(boundArgs) : nullptr, length, WTFMove(name))));</span>
  }
  
  static EncodedJSValue JSC_HOST_CALL hasOwnLengthProperty(ExecState* exec)
  {
      VM&amp; vm = exec-&gt;vm();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -311,18 +358,23 @@</span>
    unescape              globalFuncUnescape                           DontEnum|Function 1
    decodeURI             globalFuncDecodeURI                          DontEnum|Function 1
    decodeURIComponent    globalFuncDecodeURIComponent                 DontEnum|Function 1
    encodeURI             globalFuncEncodeURI                          DontEnum|Function 1
    encodeURIComponent    globalFuncEncodeURIComponent                 DontEnum|Function 1
<span class="udiff-line-added">+   eval                  JSGlobalObject::m_evalFunction               DontEnum|CellProperty</span>
    globalThis            JSGlobalObject::m_globalThis                 DontEnum|CellProperty
<span class="udiff-line-added">+   parseInt              JSGlobalObject::m_parseIntFunction           DontEnum|CellProperty</span>
<span class="udiff-line-added">+   parseFloat            JSGlobalObject::m_parseFloatFunction         DontEnum|CellProperty</span>
<span class="udiff-line-added">+   ArrayBuffer           JSGlobalObject::m_arrayBufferStructure       DontEnum|ClassStructure</span>
    EvalError             JSGlobalObject::m_evalErrorStructure         DontEnum|ClassStructure
    RangeError            JSGlobalObject::m_rangeErrorStructure        DontEnum|ClassStructure
    ReferenceError        JSGlobalObject::m_referenceErrorStructure    DontEnum|ClassStructure
    SyntaxError           JSGlobalObject::m_syntaxErrorStructure       DontEnum|ClassStructure
    TypeError             JSGlobalObject::m_typeErrorStructure         DontEnum|ClassStructure
    URIError              JSGlobalObject::m_URIErrorStructure          DontEnum|ClassStructure
    Proxy                 createProxyProperty                          DontEnum|PropertyCallback
<span class="udiff-line-added">+   Reflect               createReflectProperty                        DontEnum|PropertyCallback</span>
    JSON                  createJSONProperty                           DontEnum|PropertyCallback
    Math                  createMathProperty                           DontEnum|PropertyCallback
    console               createConsoleProperty                        DontEnum|PropertyCallback
    Int8Array             JSGlobalObject::m_typedArrayInt8             DontEnum|ClassStructure
    Int16Array            JSGlobalObject::m_typedArrayInt16            DontEnum|ClassStructure
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -333,10 +385,11 @@</span>
    Uint32Array           JSGlobalObject::m_typedArrayUint32           DontEnum|ClassStructure
    Float32Array          JSGlobalObject::m_typedArrayFloat32          DontEnum|ClassStructure
    Float64Array          JSGlobalObject::m_typedArrayFloat64          DontEnum|ClassStructure
    DataView              JSGlobalObject::m_typedArrayDataView         DontEnum|ClassStructure
    Date                  JSGlobalObject::m_dateStructure              DontEnum|ClassStructure
<span class="udiff-line-added">+   Error                 JSGlobalObject::m_errorStructure             DontEnum|ClassStructure</span>
    Boolean               JSGlobalObject::m_booleanObjectStructure     DontEnum|ClassStructure
    Number                JSGlobalObject::m_numberObjectStructure      DontEnum|ClassStructure
    Symbol                JSGlobalObject::m_symbolObjectStructure      DontEnum|ClassStructure
    WeakMap               JSGlobalObject::m_weakMapStructure           DontEnum|ClassStructure
    WeakSet               JSGlobalObject::m_weakSetStructure           DontEnum|ClassStructure
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -362,18 +415,19 @@</span>
      , m_vm(vm)
      , m_masqueradesAsUndefinedWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
      , m_havingABadTimeWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
      , m_varInjectionWatchpoint(adoptRef(new WatchpointSet(IsWatched)))
      , m_weakRandom(Options::forceWeakRandomSeed() ? Options::forcedWeakRandomSeed() : static_cast&lt;unsigned&gt;(randomNumber() * (std::numeric_limits&lt;unsigned&gt;::max() + 1.0)))
<span class="udiff-line-modified-removed">-     , m_arrayIteratorProtocolWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-removed">-     , m_mapIteratorProtocolWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-removed">-     , m_setIteratorProtocolWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-removed">-     , m_stringIteratorProtocolWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-removed">-     , m_mapSetWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-removed">-     , m_setAddWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-removed">-     , m_arraySpeciesWatchpoint(ClearWatchpoint)</span>
<span class="udiff-line-modified-removed">-     , m_numberToStringWatchpoint(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_arrayIteratorProtocolWatchpointSet(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_mapIteratorProtocolWatchpointSet(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_setIteratorProtocolWatchpointSet(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_stringIteratorProtocolWatchpointSet(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_mapSetWatchpointSet(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_setAddWatchpointSet(IsWatched)</span>
<span class="udiff-line-modified-added">+     , m_arraySpeciesWatchpointSet(ClearWatchpoint)</span>
<span class="udiff-line-modified-added">+     , m_arrayJoinWatchpointSet(IsWatched)</span>
<span class="udiff-line-added">+     , m_numberToStringWatchpointSet(IsWatched)</span>
      , m_runtimeFlags()
      , m_stackTraceLimit(Options::defaultErrorStackTraceLimit())
      , m_globalObjectMethodTable(globalObjectMethodTable ? globalObjectMethodTable : &amp;s_globalObjectMethodTable)
  {
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -407,13 +461,13 @@</span>
  }
  
  template&lt;ErrorType errorType&gt;
  void JSGlobalObject::initializeErrorConstructor(LazyClassStructure::Initializer&amp; init)
  {
<span class="udiff-line-modified-removed">-     init.setPrototype(NativeErrorPrototype::create(init.vm, NativeErrorPrototype::createStructure(init.vm, this, m_errorPrototype.get()), errorTypeName(errorType)));</span>
<span class="udiff-line-modified-added">+     init.setPrototype(NativeErrorPrototype::create(init.vm, NativeErrorPrototype::createStructure(init.vm, this, m_errorStructure.prototype(this)), errorTypeName(errorType)));</span>
      init.setStructure(ErrorInstance::createStructure(init.vm, this, init.prototype));
<span class="udiff-line-modified-removed">-     init.setConstructor(NativeErrorConstructor&lt;errorType&gt;::create(init.vm, NativeErrorConstructor&lt;errorType&gt;::createStructure(init.vm, this, m_errorConstructor.get()), jsCast&lt;NativeErrorPrototype*&gt;(init.prototype)));</span>
<span class="udiff-line-modified-added">+     init.setConstructor(NativeErrorConstructor&lt;errorType&gt;::create(init.vm, NativeErrorConstructor&lt;errorType&gt;::createStructure(init.vm, this, m_errorStructure.constructor(this)), jsCast&lt;NativeErrorPrototype*&gt;(init.prototype)));</span>
  }
  
  void JSGlobalObject::init(VM&amp; vm)
  {
      ASSERT(vm.currentThreadIsHoldingAPILock());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -422,12 +476,12 @@</span>
      Base::setStructure(vm, Structure::toCacheableDictionaryTransition(vm, structure(vm)));
  
      m_debugger = 0;
  
  #if ENABLE(REMOTE_INSPECTOR)
<span class="udiff-line-modified-removed">-     m_inspectorController = std::make_unique&lt;Inspector::JSGlobalObjectInspectorController&gt;(*this);</span>
<span class="udiff-line-modified-removed">-     m_inspectorDebuggable = std::make_unique&lt;JSGlobalObjectDebuggable&gt;(*this);</span>
<span class="udiff-line-modified-added">+     m_inspectorController = makeUnique&lt;Inspector::JSGlobalObjectInspectorController&gt;(*this);</span>
<span class="udiff-line-modified-added">+     m_inspectorDebuggable = makeUnique&lt;JSGlobalObjectDebuggable&gt;(*this);</span>
      m_inspectorDebuggable-&gt;init();
      m_consoleClient = m_inspectorController-&gt;consoleClient();
  #endif
  
      m_functionPrototype.set(vm, this, FunctionPrototype::create(vm, FunctionPrototype::createStructure(vm, this, jsNull()))); // The real prototype will be set once ObjectPrototype is created.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -445,13 +499,13 @@</span>
      m_stackOverflowFrameCallee.set(vm, this, stackOverflowFrameCallee);
  
      m_hostFunctionStructure.set(vm, this, JSFunction::createStructure(vm, this, m_functionPrototype.get()));
  
      auto initFunctionStructures = [&amp;] (FunctionStructures&amp; structures) {
<span class="udiff-line-modified-removed">-         structures.strictFunctionStructure.set(vm, this, JSFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-removed">-         structures.sloppyFunctionStructure.set(vm, this, JSFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-removed">-         structures.arrowFunctionStructure.set(vm, this, JSFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-added">+         structures.strictFunctionStructure.set(vm, this, JSStrictFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-added">+         structures.sloppyFunctionStructure.set(vm, this, JSSloppyFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-added">+         structures.arrowFunctionStructure.set(vm, this, JSArrowFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
      };
      initFunctionStructures(m_builtinFunctions);
      initFunctionStructures(m_ordinaryFunctions);
  
      m_customGetterSetterFunctionStructure.initLater(
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -468,11 +522,11 @@</span>
              init.set(JSNativeStdFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));
          });
      JSFunction* callFunction = nullptr;
      JSFunction* applyFunction = nullptr;
      JSFunction* hasInstanceSymbolFunction = nullptr;
<span class="udiff-line-modified-removed">-     m_functionPrototype-&gt;addFunctionProperties(exec, this, &amp;callFunction, &amp;applyFunction, &amp;hasInstanceSymbolFunction);</span>
<span class="udiff-line-modified-added">+     m_functionPrototype-&gt;addFunctionProperties(vm, this, &amp;callFunction, &amp;applyFunction, &amp;hasInstanceSymbolFunction);</span>
      m_callFunction.set(vm, this, callFunction);
      m_applyFunction.set(vm, this, applyFunction);
      m_arrayProtoToStringFunction.initLater(
          [] (const Initializer&lt;JSFunction&gt;&amp; init) {
              init.set(JSFunction::create(init.vm, init.owner, 0, init.vm.propertyNames-&gt;toString.string(), arrayProtoFuncToString, NoIntrinsic));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -506,23 +560,25 @@</span>
          });
  
      m_nullGetterFunction.set(vm, this, NullGetterFunction::create(vm, NullGetterFunction::createStructure(vm, this, m_functionPrototype.get())));
      m_nullSetterFunction.set(vm, this, NullSetterFunction::create(vm, NullSetterFunction::createStructure(vm, this, m_functionPrototype.get())));
      m_objectPrototype.set(vm, this, ObjectPrototype::create(vm, this, ObjectPrototype::createStructure(vm, this, jsNull())));
<span class="udiff-line-added">+     // We have to manually set this here because we make it a prototype without transition below.</span>
<span class="udiff-line-added">+     m_objectPrototype.get()-&gt;didBecomePrototype();</span>
      GetterSetter* protoAccessor = GetterSetter::create(vm, this,
          JSFunction::create(vm, this, 0, makeString(&quot;get &quot;, vm.propertyNames-&gt;underscoreProto.string()), globalFuncProtoGetter, UnderscoreProtoIntrinsic),
          JSFunction::create(vm, this, 0, makeString(&quot;set &quot;, vm.propertyNames-&gt;underscoreProto.string()), globalFuncProtoSetter));
<span class="udiff-line-modified-removed">-     m_objectPrototype-&gt;putDirectNonIndexAccessor(vm, vm.propertyNames-&gt;underscoreProto, protoAccessor, PropertyAttribute::Accessor | PropertyAttribute::DontEnum);</span>
<span class="udiff-line-modified-added">+     m_objectPrototype-&gt;putDirectNonIndexAccessorWithoutTransition(vm, vm.propertyNames-&gt;underscoreProto, protoAccessor, PropertyAttribute::Accessor | PropertyAttribute::DontEnum);</span>
      m_functionPrototype-&gt;structure(vm)-&gt;setPrototypeWithoutTransition(vm, m_objectPrototype.get());
      m_objectStructureForObjectConstructor.set(vm, this, vm.structureCache.emptyObjectStructureForPrototype(this, m_objectPrototype.get(), JSFinalObject::defaultInlineCapacity()));
      m_objectProtoValueOfFunction.set(vm, this, jsCast&lt;JSFunction*&gt;(objectPrototype()-&gt;getDirect(vm, vm.propertyNames-&gt;valueOf)));
  
      JSFunction* thrower = JSFunction::create(vm, this, 0, String(), globalFuncThrowTypeErrorArgumentsCalleeAndCaller);
      GetterSetter* getterSetter = GetterSetter::create(vm, this, thrower, thrower);
      m_throwTypeErrorArgumentsCalleeAndCallerGetterSetter.set(vm, this, getterSetter);
  
<span class="udiff-line-modified-removed">-     m_functionPrototype-&gt;initRestrictedProperties(exec, this);</span>
<span class="udiff-line-modified-added">+     m_functionPrototype-&gt;initRestrictedProperties(vm, this);</span>
  
      m_speciesGetterSetter.set(vm, this, GetterSetter::create(vm, this, JSFunction::create(vm, globalOperationsSpeciesGetterCodeGenerator(vm), this), nullptr));
  
      m_typedArrayProto.initLater(
          [] (const Initializer&lt;JSTypedArrayViewPrototype&gt;&amp; init) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -560,11 +616,14 @@</span>
      m_lexicalEnvironmentStructure.set(vm, this, JSLexicalEnvironment::createStructure(vm, this));
      m_moduleEnvironmentStructure.initLater(
          [] (const Initializer&lt;Structure&gt;&amp; init) {
              init.set(JSModuleEnvironment::createStructure(init.vm, init.owner));
          });
<span class="udiff-line-modified-removed">-     m_strictEvalActivationStructure.set(vm, this, StrictEvalActivation::createStructure(vm, this, jsNull()));</span>
<span class="udiff-line-modified-added">+     m_strictEvalActivationStructure.initLater(</span>
<span class="udiff-line-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-added">+             init.set(StrictEvalActivation::createStructure(init.vm, init.owner, jsNull()));</span>
<span class="udiff-line-added">+         });</span>
      m_debuggerScopeStructure.initLater(
          [] (const Initializer&lt;Structure&gt;&amp; init) {
              init.set(DebuggerScope::createStructure(init.vm, init.owner));
          });
      m_withScopeStructure.initLater(
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -627,27 +686,42 @@</span>
      m_regExpPrototype.set(vm, this, RegExpPrototype::create(vm, this, RegExpPrototype::createStructure(vm, this, m_objectPrototype.get())));
      m_regExpStructure.set(vm, this, RegExpObject::createStructure(vm, this, m_regExpPrototype.get()));
      m_regExpMatchesArrayStructure.set(vm, this, createRegExpMatchesArrayStructure(vm, this));
      m_regExpMatchesArrayWithGroupsStructure.set(vm, this, createRegExpMatchesArrayWithGroupsStructure(vm, this));
  
<span class="udiff-line-modified-removed">-     m_moduleRecordStructure.set(vm, this, JSModuleRecord::createStructure(vm, this, jsNull()));</span>
<span class="udiff-line-modified-removed">-     m_moduleNamespaceObjectStructure.set(vm, this, JSModuleNamespaceObject::createStructure(vm, this, jsNull()));</span>
<span class="udiff-line-modified-removed">-     {</span>
<span class="udiff-line-modified-removed">-         bool isCallable = false;</span>
<span class="udiff-line-modified-removed">-         m_proxyObjectStructure.set(vm, this, ProxyObject::createStructure(vm, this, jsNull(), isCallable));</span>
<span class="udiff-line-modified-removed">-         isCallable = true;</span>
<span class="udiff-line-modified-removed">-         m_callableProxyObjectStructure.set(vm, this, ProxyObject::createStructure(vm, this, jsNull(), isCallable));</span>
<span class="udiff-line-modified-removed">-     }</span>
<span class="udiff-line-modified-removed">-     m_proxyRevokeStructure.set(vm, this, ProxyRevoke::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-added">+     m_moduleRecordStructure.initLater(</span>
<span class="udiff-line-modified-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+             init.set(JSModuleRecord::createStructure(init.vm, init.owner, jsNull()));</span>
<span class="udiff-line-modified-added">+         });</span>
<span class="udiff-line-modified-added">+     m_moduleNamespaceObjectStructure.initLater(</span>
<span class="udiff-line-modified-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+             init.set(JSModuleNamespaceObject::createStructure(init.vm, init.owner, jsNull()));</span>
<span class="udiff-line-modified-added">+         });</span>
<span class="udiff-line-modified-added">+     m_proxyObjectStructure.initLater(</span>
<span class="udiff-line-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-added">+             bool isCallable = false;</span>
<span class="udiff-line-added">+             init.set(ProxyObject::createStructure(init.vm, init.owner, jsNull(), isCallable));</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+     m_callableProxyObjectStructure.initLater(</span>
<span class="udiff-line-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-added">+             bool isCallable = true;</span>
<span class="udiff-line-added">+             init.set(ProxyObject::createStructure(init.vm, init.owner, jsNull(), isCallable));</span>
<span class="udiff-line-added">+         });</span>
<span class="udiff-line-added">+     m_proxyRevokeStructure.initLater(</span>
<span class="udiff-line-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-added">+             init.set(ProxyRevoke::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));</span>
<span class="udiff-line-added">+         });</span>
  
<span class="udiff-line-modified-removed">-     m_parseIntFunction.set(vm, this, JSFunction::create(vm, this, 2, vm.propertyNames-&gt;parseInt.string(), globalFuncParseInt, ParseIntIntrinsic));</span>
<span class="udiff-line-modified-removed">-     putDirectWithoutTransition(vm, vm.propertyNames-&gt;parseInt, m_parseIntFunction.get(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-removed">-     m_parseFloatFunction.set(vm, this, JSFunction::create(vm, this, 1, vm.propertyNames-&gt;parseFloat.string(), globalFuncParseFloat, NoIntrinsic));</span>
<span class="udiff-line-modified-removed">-     putDirectWithoutTransition(vm, vm.propertyNames-&gt;parseFloat, m_parseFloatFunction.get(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+     m_parseIntFunction.initLater(</span>
<span class="udiff-line-modified-added">+         [] (const Initializer&lt;JSFunction&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+             init.set(JSFunction::create(init.vm, init.owner, 2, init.vm.propertyNames-&gt;parseInt.string(), globalFuncParseInt, ParseIntIntrinsic));</span>
<span class="udiff-line-modified-added">+         });</span>
<span class="udiff-line-added">+     m_parseFloatFunction.initLater(</span>
<span class="udiff-line-added">+         [] (const Initializer&lt;JSFunction&gt;&amp; init) {</span>
<span class="udiff-line-added">+             init.set(JSFunction::create(init.vm, init.owner, 1, init.vm.propertyNames-&gt;parseFloat.string(), globalFuncParseFloat, NoIntrinsic));</span>
<span class="udiff-line-added">+         });</span>
  
<span class="udiff-line-removed">-     m_arrayBufferPrototype.set(vm, this, JSArrayBufferPrototype::create(vm, this, JSArrayBufferPrototype::createStructure(vm, this, m_objectPrototype.get()), ArrayBufferSharingMode::Default));</span>
<span class="udiff-line-removed">-     m_arrayBufferStructure.set(vm, this, JSArrayBuffer::createStructure(vm, this, m_arrayBufferPrototype.get()));</span>
  #if ENABLE(SHARED_ARRAY_BUFFER)
      m_sharedArrayBufferPrototype.set(vm, this, JSArrayBufferPrototype::create(vm, this, JSArrayBufferPrototype::createStructure(vm, this, m_objectPrototype.get()), ArrayBufferSharingMode::Shared));
      m_sharedArrayBufferStructure.set(vm, this, JSArrayBuffer::createStructure(vm, this, m_sharedArrayBufferPrototype.get()));
  #endif
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -655,36 +729,31 @@</span>
      m_asyncIteratorPrototype.set(vm, this, AsyncIteratorPrototype::create(vm, this, AsyncIteratorPrototype::createStructure(vm, this, m_objectPrototype.get())));
  
      m_generatorPrototype.set(vm, this, GeneratorPrototype::create(vm, this, GeneratorPrototype::createStructure(vm, this, m_iteratorPrototype.get())));
      m_asyncGeneratorPrototype.set(vm, this, AsyncGeneratorPrototype::create(vm, this, AsyncGeneratorPrototype::createStructure(vm, this, m_asyncIteratorPrototype.get())));
  
<span class="udiff-line-modified-removed">- #define CREATE_PROTOTYPE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase) do { \</span>
<span class="udiff-line-modified-added">+ #define CREATE_PROTOTYPE_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) { \</span>
          m_ ## lowerName ## Prototype.set(vm, this, capitalName##Prototype::create(vm, this, capitalName##Prototype::createStructure(vm, this, m_ ## prototypeBase ## Prototype.get()))); \
          m_ ## properName ## Structure.set(vm, this, instanceType::createStructure(vm, this, m_ ## lowerName ## Prototype.get())); \
<span class="udiff-line-modified-removed">-     } while (0);</span>
<span class="udiff-line-modified-added">+     }</span>
  
      FOR_EACH_SIMPLE_BUILTIN_TYPE(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if (UNLIKELY(Options::useBigInt()))</span>
<span class="udiff-line-removed">-         FOR_BIG_INT_BUILTIN_TYPE_WITH_CONSTRUCTOR(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)</span>
<span class="udiff-line-removed">- </span>
      FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(CREATE_PROTOTYPE_FOR_SIMPLE_TYPE)
  
  #undef CREATE_PROTOTYPE_FOR_SIMPLE_TYPE
  
<span class="udiff-line-modified-removed">- #define CREATE_PROTOTYPE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase) \</span>
<span class="udiff-line-modified-added">+ #define CREATE_PROTOTYPE_FOR_LAZY_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) {  \</span>
      m_ ## properName ## Structure.initLater(\
          [] (LazyClassStructure::Initializer&amp; init) { \
              init.setPrototype(capitalName##Prototype::create(init.vm, init.global, capitalName##Prototype::createStructure(init.vm, init.global, init.global-&gt;m_ ## prototypeBase ## Prototype.get()))); \
              init.setStructure(instanceType::createStructure(init.vm, init.global, init.prototype)); \
              init.setConstructor(capitalName ## Constructor::create(init.vm, capitalName ## Constructor::createStructure(init.vm, init.global, init.global-&gt;m_functionPrototype.get()), jsCast&lt;capitalName ## Prototype*&gt;(init.prototype), init.global-&gt;m_speciesGetterSetter.get())); \
<span class="udiff-line-modified-removed">-         });</span>
<span class="udiff-line-modified-added">+         }); \</span>
<span class="udiff-line-added">+     }</span>
  
      FOR_EACH_LAZY_BUILTIN_TYPE(CREATE_PROTOTYPE_FOR_LAZY_TYPE)
  
<span class="udiff-line-removed">- #undef CREATE_PROTOTYPE_FOR_LAZY_TYPE</span>
<span class="udiff-line-removed">- </span>
      // Constructors
  
      ObjectConstructor* objectConstructor = ObjectConstructor::create(vm, this, ObjectConstructor::createStructure(vm, this, m_functionPrototype.get()), m_objectPrototype.get());
      m_objectConstructor.set(vm, this, objectConstructor);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -695,40 +764,32 @@</span>
  
      ArrayConstructor* arrayConstructor = ArrayConstructor::create(vm, this, ArrayConstructor::createStructure(vm, this, m_functionPrototype.get()), m_arrayPrototype.get(), m_speciesGetterSetter.get());
      m_arrayConstructor.set(vm, this, arrayConstructor);
  
      RegExpConstructor* regExpConstructor = RegExpConstructor::create(vm, RegExpConstructor::createStructure(vm, this, m_functionPrototype.get()), m_regExpPrototype.get(), m_speciesGetterSetter.get());
<span class="udiff-line-modified-removed">-     m_regExpGlobalData.cachedResult().record(vm, this, nullptr, jsEmptyString(&amp;vm), MatchResult(0, 0));</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     JSArrayBufferConstructor* arrayBufferConstructor = JSArrayBufferConstructor::create(vm, JSArrayBufferConstructor::createStructure(vm, this, m_functionPrototype.get()), m_arrayBufferPrototype.get(), m_speciesGetterSetter.get());</span>
<span class="udiff-line-removed">-     m_arrayBufferPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, arrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+     m_regExpGlobalData.cachedResult().record(vm, this, nullptr, jsEmptyString(vm), MatchResult(0, 0));</span>
  
  #if ENABLE(SHARED_ARRAY_BUFFER)
      JSSharedArrayBufferConstructor* sharedArrayBufferConstructor = nullptr;
      sharedArrayBufferConstructor = JSSharedArrayBufferConstructor::create(vm, JSSharedArrayBufferConstructor::createStructure(vm, this, m_functionPrototype.get()), m_sharedArrayBufferPrototype.get(), m_speciesGetterSetter.get());
      m_sharedArrayBufferPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, sharedArrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
  
      AtomicsObject* atomicsObject = AtomicsObject::create(vm, this, AtomicsObject::createStructure(vm, this, m_objectPrototype.get()));
  #endif
  
<span class="udiff-line-modified-removed">- #define CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase) \</span>
<span class="udiff-line-modified-removed">- capitalName ## Constructor* lowerName ## Constructor = capitalName ## Constructor::create(vm, capitalName ## Constructor::createStructure(vm, this, m_functionPrototype.get()), m_ ## lowerName ## Prototype.get(), m_speciesGetterSetter.get()); \</span>
<span class="udiff-line-modified-removed">- m_ ## lowerName ## Prototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
<span class="udiff-line-modified-added">+ #define CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
<span class="udiff-line-modified-added">+ capitalName ## Constructor* lowerName ## Constructor = featureFlag ? capitalName ## Constructor::create(vm, capitalName ## Constructor::createStructure(vm, this, m_functionPrototype.get()), m_ ## lowerName ## Prototype.get(), m_speciesGetterSetter.get()) : nullptr; \</span>
<span class="udiff-line-modified-added">+     if (featureFlag) \</span>
<span class="udiff-line-added">+         m_ ## lowerName ## Prototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
  
      FOR_EACH_SIMPLE_BUILTIN_TYPE(CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE)
<span class="udiff-line-removed">-     BigIntConstructor* bigIntConstructor = nullptr;</span>
<span class="udiff-line-removed">-     if (UNLIKELY(Options::useBigInt())) {</span>
<span class="udiff-line-removed">-         bigIntConstructor = BigIntConstructor::create(vm, BigIntConstructor::createStructure(vm, this, m_functionPrototype.get()), m_bigIntPrototype.get(), m_speciesGetterSetter.get());</span>
<span class="udiff-line-removed">-         m_bigIntPrototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, bigIntConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-removed">-     }</span>
  
  #undef CREATE_CONSTRUCTOR_FOR_SIMPLE_TYPE
  
      m_promiseConstructor.set(vm, this, promiseConstructor);
      m_internalPromiseConstructor.set(vm, this, internalPromiseConstructor);
  
<span class="udiff-line-removed">-     m_errorConstructor.set(vm, this, errorConstructor);</span>
      m_evalErrorStructure.initLater(
          [] (LazyClassStructure::Initializer&amp; init) {
              init.global-&gt;initializeErrorConstructor&lt;ErrorType::EvalError&gt;(init);
          });
      m_rangeErrorStructure.initLater(
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -784,28 +845,32 @@</span>
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;RegExp, regExpConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
  
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().ObjectPrivateName(), objectConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;builtinNames().ArrayPrivateName(), arrayConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly);
  
<span class="udiff-line-removed">-     putDirectWithoutTransition(vm, vm.propertyNames-&gt;ArrayBuffer, arrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
  #if ENABLE(SHARED_ARRAY_BUFFER)
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;SharedArrayBuffer, sharedArrayBufferConstructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
<span class="udiff-line-modified-removed">-     putDirectWithoutTransition(vm, Identifier::fromString(exec, &quot;Atomics&quot;), atomicsObject, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+     putDirectWithoutTransition(vm, Identifier::fromString(vm, &quot;Atomics&quot;), atomicsObject, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
  #endif
  
<span class="udiff-line-modified-removed">- #define PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase) \</span>
<span class="udiff-line-modified-removed">- putDirectWithoutTransition(vm, vm.propertyNames-&gt; jsName, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
<span class="udiff-line-modified-added">+ #define PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
<span class="udiff-line-modified-added">+     if (featureFlag) \</span>
<span class="udiff-line-added">+         putDirectWithoutTransition(vm, vm.propertyNames-&gt; jsName, lowerName ## Constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-added">+ </span>
  
      FOR_EACH_SIMPLE_BUILTIN_TYPE_WITH_CONSTRUCTOR(PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE)
<span class="udiff-line-removed">-     if (UNLIKELY(Options::useBigInt()))</span>
<span class="udiff-line-removed">-         FOR_BIG_INT_BUILTIN_TYPE_WITH_CONSTRUCTOR(PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE)</span>
  
  #undef PUT_CONSTRUCTOR_FOR_SIMPLE_TYPE
<span class="udiff-line-modified-removed">-     m_iteratorResultObjectStructure.set(vm, this, createIteratorResultObjectStructure(vm, *this));</span>
<span class="udiff-line-modified-added">+     m_iteratorResultObjectStructure.initLater(</span>
<span class="udiff-line-added">+         [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-added">+             init.set(createIteratorResultObjectStructure(init.vm, *init.owner));</span>
<span class="udiff-line-added">+         });</span>
  
<span class="udiff-line-modified-removed">-     m_evalFunction.set(vm, this, JSFunction::create(vm, this, 1, vm.propertyNames-&gt;eval.string(), globalFuncEval));</span>
<span class="udiff-line-modified-removed">-     putDirectWithoutTransition(vm, vm.propertyNames-&gt;eval, m_evalFunction.get(), static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+     m_evalFunction.initLater(</span>
<span class="udiff-line-modified-added">+         [] (const Initializer&lt;JSFunction&gt;&amp; init) {</span>
<span class="udiff-line-added">+             init.set(JSFunction::create(init.vm, init.owner, 1, init.vm.propertyNames-&gt;eval.string(), globalFuncEval, NoIntrinsic));</span>
<span class="udiff-line-added">+         });</span>
  
  #if ENABLE(INTL)
      m_collatorStructure.initLater(
          [] (const Initializer&lt;Structure&gt;&amp; init) {
              JSGlobalObject* globalObject = jsCast&lt;JSGlobalObject*&gt;(init.owner);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -831,14 +896,11 @@</span>
              init.set(IntlPluralRules::createStructure(init.vm, globalObject, pluralRulesPrototype));
          });
  
      IntlObject* intl = IntlObject::create(vm, IntlObject::createStructure(vm, this, m_objectPrototype.get()));
      putDirectWithoutTransition(vm, vm.propertyNames-&gt;Intl, intl, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));
<span class="udiff-line-removed">-     m_intlObject.set(vm, this, intl);</span>
  #endif // ENABLE(INTL)
<span class="udiff-line-removed">-     ReflectObject* reflectObject = ReflectObject::create(vm, this, ReflectObject::createStructure(vm, this, m_objectPrototype.get()));</span>
<span class="udiff-line-removed">-     putDirectWithoutTransition(vm, vm.propertyNames-&gt;Reflect, reflectObject, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
  
      m_moduleLoader.initLater(
          [] (const Initializer&lt;JSModuleLoader&gt;&amp; init) {
              auto catchScope = DECLARE_CATCH_SCOPE(init.vm);
              init.set(JSModuleLoader::create(init.owner-&gt;globalExec(), init.vm, init.owner, JSModuleLoader::createStructure(init.vm, init.owner, jsNull())));
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -851,11 +913,13 @@</span>
      JSFunction* builtinDescribe = JSFunction::create(vm, this, 1, vm.propertyNames-&gt;emptyIdentifier.string(), globalFuncBuiltinDescribe);
  
      JSFunction* privateFuncTrunc = JSFunction::create(vm, this, 0, String(), mathProtoFuncTrunc, TruncIntrinsic);
  
      JSFunction* privateFuncPropertyIsEnumerable = JSFunction::create(vm, this, 0, String(), globalFuncPropertyIsEnumerable);
<span class="udiff-line-added">+     JSFunction* privateFuncOwnKeys = JSFunction::create(vm, this, 0, String(), globalFuncOwnKeys);</span>
      JSFunction* privateFuncImportModule = JSFunction::create(vm, this, 0, String(), globalFuncImportModule);
<span class="udiff-line-added">+     JSFunction* privateFuncMakeTypeError = JSFunction::create(vm, this, 0, String(), globalFuncMakeTypeError);</span>
      JSFunction* privateFuncTypedArrayLength = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncLength);
      JSFunction* privateFuncTypedArrayGetOriginalConstructor = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncGetOriginalConstructor);
      JSFunction* privateFuncTypedArraySort = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncSort);
      JSFunction* privateFuncIsTypedArrayView = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncIsTypedArrayView, IsTypedArrayViewIntrinsic);
      JSFunction* privateFuncTypedArraySubarrayCreate = JSFunction::create(vm, this, 0, String(), typedArrayViewPrivateFuncSubarrayCreate);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -864,11 +928,10 @@</span>
      JSFunction* privateFuncInstanceOf = JSFunction::create(vm, this, 0, String(), objectPrivateFuncInstanceOf);
      JSFunction* privateFuncThisTimeValue = JSFunction::create(vm, this, 0, String(), dateProtoFuncGetTime);
  #if ENABLE(INTL)
      JSFunction* privateFuncDateTimeFormat = JSFunction::create(vm, this, 0, String(), globalFuncDateTimeFormat);
  #endif
<span class="udiff-line-removed">-     JSFunction* privateFuncIsArrayConstructor = JSFunction::create(vm, this, 0, String(), arrayConstructorPrivateFuncIsArrayConstructor);</span>
      JSFunction* privateFuncIsArraySlow = JSFunction::create(vm, this, 0, String(), arrayConstructorPrivateFuncIsArraySlow);
      JSFunction* privateFuncConcatMemcpy = JSFunction::create(vm, this, 0, String(), arrayProtoPrivateFuncConcatMemcpy);
      JSFunction* privateFuncAppendMemcpy = JSFunction::create(vm, this, 0, String(), arrayProtoPrivateFuncAppendMemcpy);
      JSFunction* privateFuncMapBucketHead = JSFunction::create(vm, this, 0, String(), mapPrivateFuncMapBucketHead, JSMapBucketHeadIntrinsic);
      JSFunction* privateFuncMapBucketNext = JSFunction::create(vm, this, 0, String(), mapPrivateFuncMapBucketNext, JSMapBucketNextIntrinsic);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -897,39 +960,41 @@</span>
      JSObject* builtinRegExpExec = asObject(m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;exec).asCell());
      m_regExpProtoExec.set(vm, this, builtinRegExpExec);
      JSObject* regExpSymbolReplace = asObject(m_regExpPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;replaceSymbol).asCell());
      m_regExpProtoSymbolReplace.set(vm, this, regExpSymbolReplace);
  
<span class="udiff-line-modified-removed">- #define CREATE_PRIVATE_GLOBAL_FUNCTION(name, code) JSFunction* name ## PrivateFunction = JSFunction::create(vm, code ## CodeGenerator(vm), this);</span>
<span class="udiff-line-modified-added">+ #define CREATE_PRIVATE_GLOBAL_FUNCTION(varName, funcName, code) JSFunction* varName ## PrivateFunction = JSFunction::create(vm, code ## CodeGenerator(vm), this);</span>
      JSC_FOREACH_BUILTIN_FUNCTION_PRIVATE_GLOBAL_NAME(CREATE_PRIVATE_GLOBAL_FUNCTION)
  #undef CREATE_PRIVATE_GLOBAL_FUNCTION
  
      JSObject* arrayIteratorPrototype = ArrayIteratorPrototype::create(vm, this, ArrayIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="udiff-line-modified-removed">-     createArrayIteratorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, arrayIteratorPrototype);</span>
<span class="udiff-line-modified-added">+     arrayIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, arrayIteratorPrototype);</span>
  
      JSObject* asyncFromSyncIteratorPrototype = AsyncFromSyncIteratorPrototype::create(vm, this, AsyncFromSyncIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="udiff-line-modified-removed">-     AsyncFromSyncIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, asyncFromSyncIteratorPrototype);</span>
<span class="udiff-line-modified-added">+     asyncFromSyncIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, asyncFromSyncIteratorPrototype);</span>
  
      JSObject* mapIteratorPrototype = MapIteratorPrototype::create(vm, this, MapIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="udiff-line-modified-removed">-     createMapIteratorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, mapIteratorPrototype);</span>
<span class="udiff-line-modified-added">+     mapIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, mapIteratorPrototype);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     JSObject* regExpStringIteratorPrototype = RegExpStringIteratorPrototype::create(vm, this, RegExpStringIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));</span>
<span class="udiff-line-added">+     regExpStringIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, regExpStringIteratorPrototype);</span>
  
      JSObject* setIteratorPrototype = SetIteratorPrototype::create(vm, this, SetIteratorPrototype::createStructure(vm, this, m_iteratorPrototype.get()));
<span class="udiff-line-modified-removed">-     createSetIteratorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, setIteratorPrototype);</span>
<span class="udiff-line-modified-added">+     setIteratorConstructorPrivateFunction-&gt;putDirect(vm, vm.propertyNames-&gt;prototype, setIteratorPrototype);</span>
  
      GlobalPropertyInfo staticGlobals[] = {
<span class="udiff-line-modified-removed">- #define INIT_PRIVATE_GLOBAL(name, code) GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().name ## PrivateName(), name ## PrivateFunction, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="udiff-line-modified-added">+ #define INIT_PRIVATE_GLOBAL(varName, funcName, code) GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().funcName ## PrivateName(), varName ## PrivateFunction, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
          JSC_FOREACH_BUILTIN_FUNCTION_PRIVATE_GLOBAL_NAME(INIT_PRIVATE_GLOBAL)
  #undef INIT_PRIVATE_GLOBAL
          GlobalPropertyInfo(vm.propertyNames-&gt;NaN, jsNaN(), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;Infinity, jsNumber(std::numeric_limits&lt;double&gt;::infinity()), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;undefinedKeyword, jsUndefined(), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().propertyIsEnumerablePrivateName(), privateFuncPropertyIsEnumerable, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
<span class="udiff-line-added">+         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().ownKeysPrivateName(), privateFuncOwnKeys, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().importModulePrivateName(), privateFuncImportModule, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().enqueueJobPrivateName(), JSFunction::create(vm, this, 0, String(), enqueueJob), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
<span class="udiff-line-modified-removed">-         // FIXME: Offer @makeTypeError function instead of exposing @TypeError here.</span>
<span class="udiff-line-removed">-         // https://bugs.webkit.org/show_bug.cgi?id=193858</span>
<span class="udiff-line-removed">-         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().TypeErrorPrivateName(), m_typeErrorStructure.constructor(this), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
<span class="udiff-line-modified-added">+         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().makeTypeErrorPrivateName(), privateFuncMakeTypeError, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArrayLengthPrivateName(), privateFuncTypedArrayLength, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArrayGetOriginalConstructorPrivateName(), privateFuncTypedArrayGetOriginalConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArraySortPrivateName(), privateFuncTypedArraySort, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isTypedArrayViewPrivateName(), privateFuncIsTypedArrayView, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().typedArraySubarrayCreatePrivateName(), privateFuncTypedArraySubarrayCreate, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -939,17 +1004,16 @@</span>
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().BuiltinLogPrivateName(), builtinLog, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().BuiltinDescribePrivateName(), builtinDescribe, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().RegExpPrivateName(), regExpConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().truncPrivateName(), privateFuncTrunc, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().PromisePrivateName(), promiseConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
<span class="udiff-line-removed">-         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().ReflectPrivateName(), reflectObject, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().InternalPromisePrivateName(), internalPromiseConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
  
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().repeatCharacterPrivateName(), JSFunction::create(vm, this, 2, String(), stringProtoFuncRepeatCharacter), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
<span class="udiff-line-added">+         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().arraySpeciesCreatePrivateName(), JSFunction::create(vm, this, 2, String(), arrayProtoFuncSpeciesCreate), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isArrayPrivateName(), arrayConstructor-&gt;getDirect(vm, vm.propertyNames-&gt;isArray), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isArraySlowPrivateName(), privateFuncIsArraySlow, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
<span class="udiff-line-removed">-         GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().isArrayConstructorPrivateName(), privateFuncIsArrayConstructor, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),</span>
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().concatMemcpyPrivateName(), privateFuncConcatMemcpy, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().appendMemcpyPrivateName(), privateFuncAppendMemcpy, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
  
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().hostPromiseRejectionTrackerPrivateName(), JSFunction::create(vm, this, 2, String(), globalFuncHostPromiseRejectionTracker), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().InspectorInstrumentationPrivateName(), InspectorInstrumentationObject::create(vm, this, InspectorInstrumentationObject::createStructure(vm, this, m_objectPrototype.get())), PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1015,40 +1079,52 @@</span>
  
      if (UNLIKELY(Options::useDollarVM()))
          exposeDollarVM(vm);
  
  #if ENABLE(WEBASSEMBLY)
<span class="udiff-line-modified-removed">-     if (Options::useWebAssembly()) {</span>
<span class="udiff-line-modified-removed">-         auto* webAssemblyPrototype = WebAssemblyPrototype::create(vm, this, WebAssemblyPrototype::createStructure(vm, this, m_objectPrototype.get()));</span>
<span class="udiff-line-modified-removed">-         m_webAssemblyStructure.set(vm, this, JSWebAssembly::createStructure(vm, this, webAssemblyPrototype));</span>
<span class="udiff-line-modified-removed">-         m_webAssemblyModuleRecordStructure.set(vm, this, WebAssemblyModuleRecord::createStructure(vm, this, m_objectPrototype.get()));</span>
<span class="udiff-line-modified-removed">-         m_webAssemblyFunctionStructure.set(vm, this, WebAssemblyFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-removed">-         m_webAssemblyWrapperFunctionStructure.set(vm, this, WebAssemblyWrapperFunction::createStructure(vm, this, m_functionPrototype.get()));</span>
<span class="udiff-line-modified-removed">-         m_webAssemblyToJSCalleeStructure.set(vm, this, WebAssemblyToJSCallee::createStructure(vm, this, jsNull()));</span>
<span class="udiff-line-modified-removed">-         auto* webAssembly = JSWebAssembly::create(vm, this, m_webAssemblyStructure.get());</span>
<span class="udiff-line-modified-removed">-         putDirectWithoutTransition(vm, Identifier::fromString(exec, &quot;WebAssembly&quot;), webAssembly, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">- #define CREATE_WEBASSEMBLY_CONSTRUCTOR(capitalName, lowerName, properName, instanceType, jsName, prototypeBase) do { \</span>
<span class="udiff-line-modified-removed">-         typedef capitalName ## Prototype Prototype; \</span>
<span class="udiff-line-modified-removed">-         typedef capitalName ## Constructor Constructor; \</span>
<span class="udiff-line-modified-removed">-         typedef JS ## capitalName JSObj; \</span>
<span class="udiff-line-modified-removed">-         auto* base = m_ ## prototypeBase ## Prototype.get(); \</span>
<span class="udiff-line-modified-removed">-         auto* prototype = Prototype::create(vm, this, Prototype::createStructure(vm, this, base)); \</span>
<span class="udiff-line-modified-removed">-         auto* structure = JSObj::createStructure(vm, this, prototype); \</span>
<span class="udiff-line-modified-removed">-         auto* constructor = Constructor::create(vm, Constructor::createStructure(vm, this, this-&gt;functionPrototype()), prototype); \</span>
<span class="udiff-line-modified-removed">-         prototype-&gt;putDirectWithoutTransition(vm, vm.propertyNames-&gt;constructor, constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
<span class="udiff-line-modified-removed">-         m_ ## lowerName ## Prototype.set(vm, this, prototype); \</span>
<span class="udiff-line-modified-removed">-         m_ ## properName ## Structure.set(vm, this, structure); \</span>
<span class="udiff-line-modified-removed">-         webAssembly-&gt;putDirectWithoutTransition(vm, Identifier::fromString(this-&gt;globalExec(), #jsName), constructor, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum)); \</span>
<span class="udiff-line-modified-removed">-     } while (0);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(CREATE_WEBASSEMBLY_CONSTRUCTOR)</span>
<span class="udiff-line-modified-added">+     if (Wasm::isSupported()) {</span>
<span class="udiff-line-modified-added">+         m_webAssemblyModuleRecordStructure.initLater(</span>
<span class="udiff-line-modified-added">+             [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+                 init.set(WebAssemblyModuleRecord::createStructure(init.vm, init.owner, init.owner-&gt;m_objectPrototype.get()));</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+         m_webAssemblyFunctionStructure.initLater(</span>
<span class="udiff-line-modified-added">+             [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+                 init.set(WebAssemblyFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+         m_jsToWasmICCalleeStructure.initLater(</span>
<span class="udiff-line-modified-added">+             [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+                 init.set(JSToWasmICCallee::createStructure(init.vm, init.owner, jsNull()));</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+         m_webAssemblyWrapperFunctionStructure.initLater(</span>
<span class="udiff-line-modified-added">+             [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+                 init.set(WebAssemblyWrapperFunction::createStructure(init.vm, init.owner, init.owner-&gt;m_functionPrototype.get()));</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+         m_webAssemblyToJSCalleeStructure.initLater(</span>
<span class="udiff-line-modified-added">+             [] (const Initializer&lt;Structure&gt;&amp; init) {</span>
<span class="udiff-line-modified-added">+                 init.set(WebAssemblyToJSCallee::createStructure(init.vm, init.owner, jsNull()));</span>
<span class="udiff-line-modified-added">+             });</span>
<span class="udiff-line-modified-added">+         auto* webAssembly = JSWebAssembly::create(vm, this, JSWebAssembly::createStructure(vm, this, m_objectPrototype.get()));</span>
<span class="udiff-line-modified-added">+         putDirectWithoutTransition(vm, Identifier::fromString(vm, &quot;WebAssembly&quot;), webAssembly, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+ #define CREATE_WEBASSEMBLY_PROTOTYPE(capitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) \</span>
<span class="udiff-line-added">+     if (featureFlag) {\</span>
<span class="udiff-line-added">+         m_ ## properName ## Structure.initLater(\</span>
<span class="udiff-line-added">+             [] (LazyClassStructure::Initializer&amp; init) { \</span>
<span class="udiff-line-added">+                 init.setPrototype(capitalName##Prototype::create(init.vm, init.global, capitalName##Prototype::createStructure(init.vm, init.global, init.global-&gt;prototypeBase ## Prototype()))); \</span>
<span class="udiff-line-added">+                 init.setStructure(instanceType::createStructure(init.vm, init.global, init.prototype)); \</span>
<span class="udiff-line-added">+                 init.setConstructor(capitalName ## Constructor::create(init.vm, capitalName ## Constructor::createStructure(init.vm, init.global, init.global-&gt;functionPrototype()), jsCast&lt;capitalName ## Prototype*&gt;(init.prototype))); \</span>
<span class="udiff-line-added">+             }); \</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(CREATE_WEBASSEMBLY_PROTOTYPE)</span>
  
  #undef CREATE_WEBASSEMBLY_CONSTRUCTOR
      }
  #endif // ENABLE(WEBASSEMBLY)
  
<span class="udiff-line-added">+ #undef CREATE_PROTOTYPE_FOR_LAZY_TYPE</span>
<span class="udiff-line-added">+ </span>
      auto setupAdaptiveWatchpoint = [&amp;] (JSObject* base, const Identifier&amp; ident) -&gt; ObjectPropertyCondition {
          // Performing these gets should not throw.
          ExecState* exec = globalExec();
          PropertySlot slot(base, PropertySlot::InternalMethodType::Get);
          bool result = base-&gt;getOwnPropertySlot(base, exec, ident, slot);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1068,77 +1144,82 @@</span>
          return condition;
      };
  
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(arrayIteratorPrototype, m_vm.propertyNames-&gt;next);
<span class="udiff-line-modified-removed">-         m_arrayIteratorPrototypeNext = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_arrayIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_arrayIteratorPrototypeNext = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayIteratorProtocolWatchpointSet);</span>
          m_arrayIteratorPrototypeNext-&gt;install(vm);
      }
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this-&gt;arrayPrototype(), m_vm.propertyNames-&gt;iteratorSymbol);
<span class="udiff-line-modified-removed">-         m_arrayPrototypeSymbolIteratorWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_arrayIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_arrayPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayIteratorProtocolWatchpointSet);</span>
          m_arrayPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
      }
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         ObjectPropertyCondition condition = setupAdaptiveWatchpoint(this-&gt;arrayPrototype(), m_vm.propertyNames-&gt;join);</span>
<span class="udiff-line-added">+         m_arrayPrototypeJoinWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_arrayJoinWatchpointSet);</span>
<span class="udiff-line-added">+         m_arrayPrototypeJoinWatchpoint-&gt;install(vm);</span>
<span class="udiff-line-added">+     }</span>
  
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(mapIteratorPrototype, m_vm.propertyNames-&gt;next);
<span class="udiff-line-modified-removed">-         m_mapIteratorPrototypeNextWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_mapIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_mapIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapIteratorProtocolWatchpointSet);</span>
          m_mapIteratorPrototypeNextWatchpoint-&gt;install(vm);
      }
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_mapPrototype.get(), m_vm.propertyNames-&gt;iteratorSymbol);
<span class="udiff-line-modified-removed">-         m_mapPrototypeSymbolIteratorWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_mapIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_mapPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapIteratorProtocolWatchpointSet);</span>
          m_mapPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
      }
  
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(setIteratorPrototype, m_vm.propertyNames-&gt;next);
<span class="udiff-line-modified-removed">-         m_setIteratorPrototypeNextWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_setIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_setIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setIteratorProtocolWatchpointSet);</span>
          m_setIteratorPrototypeNextWatchpoint-&gt;install(vm);
      }
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_setPrototype.get(), m_vm.propertyNames-&gt;iteratorSymbol);
<span class="udiff-line-modified-removed">-         m_setPrototypeSymbolIteratorWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_setIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_setPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setIteratorProtocolWatchpointSet);</span>
          m_setPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
      }
  
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_stringIteratorPrototype.get(), m_vm.propertyNames-&gt;next);
<span class="udiff-line-modified-removed">-         m_stringIteratorPrototypeNextWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_stringIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_stringIteratorPrototypeNextWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_stringIteratorProtocolWatchpointSet);</span>
          m_stringIteratorPrototypeNextWatchpoint-&gt;install(vm);
      }
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_stringPrototype.get(), m_vm.propertyNames-&gt;iteratorSymbol);
<span class="udiff-line-modified-removed">-         m_stringPrototypeSymbolIteratorWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_stringIteratorProtocolWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_stringPrototypeSymbolIteratorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_stringIteratorProtocolWatchpointSet);</span>
          m_stringPrototypeSymbolIteratorWatchpoint-&gt;install(vm);
      }
  
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_mapPrototype.get(), m_vm.propertyNames-&gt;set);
<span class="udiff-line-modified-removed">-         m_mapPrototypeSetWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_mapSetWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_mapPrototypeSetWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_mapSetWatchpointSet);</span>
          m_mapPrototypeSetWatchpoint-&gt;install(vm);
      }
  
      {
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(m_setPrototype.get(), m_vm.propertyNames-&gt;add);
<span class="udiff-line-modified-removed">-         m_setPrototypeAddWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_setAddWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_setPrototypeAddWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_setAddWatchpointSet);</span>
          m_setPrototypeAddWatchpoint-&gt;install(vm);
      }
  
      // Unfortunately, the prototype objects of the builtin objects can be touched from concurrent compilers. So eagerly initialize them only if we use JIT.
      if (VM::canUseJIT()) {
          this-&gt;booleanPrototype();
          auto* numberPrototype = this-&gt;numberPrototype();
          this-&gt;symbolPrototype();
  
          ObjectPropertyCondition condition = setupAdaptiveWatchpoint(numberPrototype, m_vm.propertyNames-&gt;toString);
<span class="udiff-line-modified-removed">-         m_numberPrototypeToStringWatchpoint = std::make_unique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(condition, m_numberToStringWatchpoint);</span>
<span class="udiff-line-modified-added">+         m_numberPrototypeToStringWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, condition, m_numberToStringWatchpointSet);</span>
          m_numberPrototypeToStringWatchpoint-&gt;install(vm);
          m_numberProtoToStringFunction.set(vm, this, jsCast&lt;JSFunction*&gt;(numberPrototype-&gt;getDirect(vm, vm.propertyNames-&gt;toString)));
      }
  
<span class="udiff-line-modified-removed">-     resetPrototype(vm, getPrototypeDirect(vm));</span>
<span class="udiff-line-modified-added">+     fixupPrototypeChainWithObjectPrototype(vm);</span>
  }
  
  bool JSGlobalObject::put(JSCell* cell, ExecState* exec, PropertyName propertyName, JSValue value, PutPropertySlot&amp; slot)
  {
      VM&amp; vm = exec-&gt;vm();
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1559,20 +1640,25 @@</span>
          ASSERT(hasBrokenIndexing(object));
          object-&gt;switchToSlowPutArrayStorage(vm);
      }
  }
  
<span class="udiff-line-modified-removed">- // Set prototype, and also insert the object prototype at the end of the chain.</span>
<span class="udiff-line-removed">- void JSGlobalObject::resetPrototype(VM&amp; vm, JSValue prototype)</span>
<span class="udiff-line-modified-added">+ void JSGlobalObject::fixupPrototypeChainWithObjectPrototype(VM&amp; vm)</span>
  {
<span class="udiff-line-removed">-     setPrototypeDirect(vm, prototype);</span>
<span class="udiff-line-removed">- </span>
      JSObject* oldLastInPrototypeChain = lastInPrototypeChain(vm, this);
      JSObject* objectPrototype = m_objectPrototype.get();
      if (oldLastInPrototypeChain != objectPrototype)
          oldLastInPrototypeChain-&gt;setPrototypeDirect(vm, objectPrototype);
<span class="udiff-line-added">+ }</span>
  
<span class="udiff-line-added">+ // Set prototype, and also insert the object prototype at the end of the chain.</span>
<span class="udiff-line-added">+ void JSGlobalObject::resetPrototype(VM&amp; vm, JSValue prototype)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     if (getPrototypeDirect(vm) == prototype)</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     setPrototypeDirect(vm, prototype);</span>
<span class="udiff-line-added">+     fixupPrototypeChainWithObjectPrototype(vm);</span>
      // Whenever we change the prototype of the global object, we need to create a new JSProxy with the correct prototype.
      setGlobalThis(vm, JSNonDestructibleProxy::create(vm, JSNonDestructibleProxy::createStructure(vm, this, prototype, PureForwardingProxyType), this));
  }
  
  void JSGlobalObject::visitChildren(JSCell* cell, SlotVisitor&amp; visitor)
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1585,39 +1671,37 @@</span>
  
      visitor.append(thisObject-&gt;m_globalLexicalEnvironment);
      visitor.append(thisObject-&gt;m_globalScopeExtension);
      visitor.append(thisObject-&gt;m_globalCallee);
      visitor.append(thisObject-&gt;m_stackOverflowFrameCallee);
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_errorConstructor);</span>
      thisObject-&gt;m_evalErrorStructure.visit(visitor);
      thisObject-&gt;m_rangeErrorStructure.visit(visitor);
      thisObject-&gt;m_referenceErrorStructure.visit(visitor);
      thisObject-&gt;m_syntaxErrorStructure.visit(visitor);
      thisObject-&gt;m_typeErrorStructure.visit(visitor);
      thisObject-&gt;m_URIErrorStructure.visit(visitor);
      visitor.append(thisObject-&gt;m_objectConstructor);
      visitor.append(thisObject-&gt;m_promiseConstructor);
  
  #if ENABLE(INTL)
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_intlObject);</span>
      visitor.append(thisObject-&gt;m_defaultCollator);
      thisObject-&gt;m_collatorStructure.visit(visitor);
      thisObject-&gt;m_numberFormatStructure.visit(visitor);
      thisObject-&gt;m_dateTimeFormatStructure.visit(visitor);
      thisObject-&gt;m_pluralRulesStructure.visit(visitor);
  #endif
      visitor.append(thisObject-&gt;m_nullGetterFunction);
      visitor.append(thisObject-&gt;m_nullSetterFunction);
  
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_parseIntFunction);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_parseFloatFunction);</span>
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_evalFunction);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_parseIntFunction.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_parseFloatFunction.visit(visitor);</span>
      visitor.append(thisObject-&gt;m_callFunction);
      visitor.append(thisObject-&gt;m_applyFunction);
      visitor.append(thisObject-&gt;m_throwTypeErrorFunction);
      thisObject-&gt;m_arrayProtoToStringFunction.visit(visitor);
      thisObject-&gt;m_arrayProtoValuesFunction.visit(visitor);
<span class="udiff-line-added">+     thisObject-&gt;m_evalFunction.visit(visitor);</span>
      thisObject-&gt;m_initializePromiseFunction.visit(visitor);
      thisObject-&gt;m_iteratorProtocolFunction.visit(visitor);
      thisObject-&gt;m_promiseResolveFunction.visit(visitor);
      visitor.append(thisObject-&gt;m_objectProtoValueOfFunction);
      visitor.append(thisObject-&gt;m_numberProtoToStringFunction);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1628,22 +1712,21 @@</span>
      thisObject-&gt;m_moduleLoader.visit(visitor);
  
      visitor.append(thisObject-&gt;m_objectPrototype);
      visitor.append(thisObject-&gt;m_functionPrototype);
      visitor.append(thisObject-&gt;m_arrayPrototype);
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_errorPrototype);</span>
      visitor.append(thisObject-&gt;m_iteratorPrototype);
      visitor.append(thisObject-&gt;m_generatorFunctionPrototype);
      visitor.append(thisObject-&gt;m_generatorPrototype);
      visitor.append(thisObject-&gt;m_asyncFunctionPrototype);
      visitor.append(thisObject-&gt;m_asyncGeneratorPrototype);
      visitor.append(thisObject-&gt;m_asyncIteratorPrototype);
      visitor.append(thisObject-&gt;m_asyncGeneratorFunctionPrototype);
  
      thisObject-&gt;m_debuggerScopeStructure.visit(visitor);
      thisObject-&gt;m_withScopeStructure.visit(visitor);
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_strictEvalActivationStructure);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_strictEvalActivationStructure.visit(visitor);</span>
      visitor.append(thisObject-&gt;m_lexicalEnvironmentStructure);
      thisObject-&gt;m_moduleEnvironmentStructure.visit(visitor);
      visitor.append(thisObject-&gt;m_directArgumentsStructure);
      visitor.append(thisObject-&gt;m_scopedArgumentsStructure);
      visitor.append(thisObject-&gt;m_clonedArgumentsStructure);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1662,11 +1745,10 @@</span>
  #ifdef JSC_GLIB_API_ENABLED
      thisObject-&gt;m_glibCallbackFunctionStructure.visit(visitor);
      thisObject-&gt;m_glibWrapperObjectStructure.visit(visitor);
  #endif
      visitor.append(thisObject-&gt;m_nullPrototypeObjectStructure);
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_errorStructure);</span>
      visitor.append(thisObject-&gt;m_calleeStructure);
  
      visitor.append(thisObject-&gt;m_hostFunctionStructure);
      auto visitFunctionStructures = [&amp;] (FunctionStructures&amp; structures) {
          visitor.append(structures.arrowFunctionStructure);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1678,57 +1760,51 @@</span>
  
      thisObject-&gt;m_customGetterSetterFunctionStructure.visit(visitor);
      thisObject-&gt;m_boundFunctionStructure.visit(visitor);
      visitor.append(thisObject-&gt;m_getterSetterStructure);
      thisObject-&gt;m_nativeStdFunctionStructure.visit(visitor);
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_bigIntObjectStructure);</span>
      visitor.append(thisObject-&gt;m_regExpStructure);
      visitor.append(thisObject-&gt;m_generatorFunctionStructure);
      visitor.append(thisObject-&gt;m_asyncFunctionStructure);
      visitor.append(thisObject-&gt;m_asyncGeneratorFunctionStructure);
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_iteratorResultObjectStructure);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_iteratorResultObjectStructure.visit(visitor);</span>
      visitor.append(thisObject-&gt;m_regExpMatchesArrayStructure);
      visitor.append(thisObject-&gt;m_regExpMatchesArrayWithGroupsStructure);
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_moduleRecordStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_moduleNamespaceObjectStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_proxyObjectStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_callableProxyObjectStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_proxyRevokeStructure);</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_arrayBufferPrototype);</span>
<span class="udiff-line-removed">-     visitor.append(thisObject-&gt;m_arrayBufferStructure);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_moduleRecordStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_moduleNamespaceObjectStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_proxyObjectStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_callableProxyObjectStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_proxyRevokeStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+ </span>
  #if ENABLE(SHARED_ARRAY_BUFFER)
      visitor.append(thisObject-&gt;m_sharedArrayBufferPrototype);
      visitor.append(thisObject-&gt;m_sharedArrayBufferStructure);
  #endif
  
<span class="udiff-line-modified-removed">- #define VISIT_SIMPLE_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase) do { \</span>
<span class="udiff-line-modified-added">+ #define VISIT_SIMPLE_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) { \</span>
          visitor.append(thisObject-&gt;m_ ## lowerName ## Prototype); \
          visitor.append(thisObject-&gt;m_ ## properName ## Structure); \
<span class="udiff-line-modified-removed">-     } while (0);</span>
<span class="udiff-line-modified-added">+     }</span>
  
      FOR_EACH_SIMPLE_BUILTIN_TYPE(VISIT_SIMPLE_TYPE)
<span class="udiff-line-removed">-     if (UNLIKELY(Options::useBigInt()))</span>
<span class="udiff-line-removed">-         FOR_BIG_INT_BUILTIN_TYPE_WITH_CONSTRUCTOR(VISIT_SIMPLE_TYPE)</span>
      FOR_EACH_BUILTIN_DERIVED_ITERATOR_TYPE(VISIT_SIMPLE_TYPE)
  
<span class="udiff-line-added">+ #define VISIT_LAZY_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase, featureFlag) if (featureFlag) \</span>
<span class="udiff-line-added">+         thisObject-&gt;m_ ## properName ## Structure.visit(visitor);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     FOR_EACH_LAZY_BUILTIN_TYPE(VISIT_LAZY_TYPE)</span>
<span class="udiff-line-added">+ </span>
  #if ENABLE(WEBASSEMBLY)
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_webAssemblyStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_webAssemblyModuleRecordStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_webAssemblyFunctionStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_webAssemblyWrapperFunctionStructure);</span>
<span class="udiff-line-modified-removed">-     visitor.append(thisObject-&gt;m_webAssemblyToJSCalleeStructure);</span>
<span class="udiff-line-modified-removed">-     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(VISIT_SIMPLE_TYPE)</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_webAssemblyModuleRecordStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_webAssemblyFunctionStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_jsToWasmICCalleeStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_webAssemblyWrapperFunctionStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     thisObject-&gt;m_webAssemblyToJSCalleeStructure.visit(visitor);</span>
<span class="udiff-line-modified-added">+     FOR_EACH_WEBASSEMBLY_CONSTRUCTOR_TYPE(VISIT_LAZY_TYPE)</span>
  #endif // ENABLE(WEBASSEMBLY)
  
  #undef VISIT_SIMPLE_TYPE
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #define VISIT_LAZY_TYPE(CapitalName, lowerName, properName, instanceType, jsName, prototypeBase) \</span>
<span class="udiff-line-removed">-     thisObject-&gt;m_ ## properName ## Structure.visit(visitor);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     FOR_EACH_LAZY_BUILTIN_TYPE(VISIT_LAZY_TYPE)</span>
<span class="udiff-line-removed">- </span>
  #undef VISIT_LAZY_TYPE
  
      for (unsigned i = NumberOfTypedArrayTypes; i--;)
          thisObject-&gt;lazyTypedArrayStructure(indexToTypedArrayType(i)).visit(visitor);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1753,11 +1829,11 @@</span>
      GlobalPropertyInfo extraStaticGlobals[] = {
          GlobalPropertyInfo(vm.propertyNames-&gt;builtinNames().dollarVMPrivateName(), dollarVM, PropertyAttribute::DontEnum | PropertyAttribute::DontDelete | PropertyAttribute::ReadOnly),
      };
      addStaticGlobals(extraStaticGlobals, WTF_ARRAY_LENGTH(extraStaticGlobals));
  
<span class="udiff-line-modified-removed">-     putDirect(vm, Identifier::fromString(globalExec(), &quot;$vm&quot;), dollarVM, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
<span class="udiff-line-modified-added">+     putDirect(vm, Identifier::fromString(vm, &quot;$vm&quot;), dollarVM, static_cast&lt;unsigned&gt;(PropertyAttribute::DontEnum));</span>
  }
  
  void JSGlobalObject::addStaticGlobals(GlobalPropertyInfo* globals, int count)
  {
      ScopeOffset startOffset = addVariables(count, jsUndefined());
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1796,10 +1872,81 @@</span>
  void JSGlobalObject::clearRareData(JSCell* cell)
  {
      jsCast&lt;JSGlobalObject*&gt;(cell)-&gt;m_rareData = nullptr;
  }
  
<span class="udiff-line-added">+ void JSGlobalObject::tryInstallArraySpeciesWatchpoint(ExecState* exec)</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     RELEASE_ASSERT(!m_arrayPrototypeConstructorWatchpoint);</span>
<span class="udiff-line-added">+     RELEASE_ASSERT(!m_arrayConstructorSpeciesWatchpoint);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     VM&amp; vm = exec-&gt;vm();</span>
<span class="udiff-line-added">+     auto scope = DECLARE_THROW_SCOPE(vm);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // First we need to make sure that the Array.prototype.constructor property points to Array</span>
<span class="udiff-line-added">+     // and that Array[Symbol.species] is the primordial GetterSetter.</span>
<span class="udiff-line-added">+     ArrayPrototype* arrayPrototype = this-&gt;arrayPrototype();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // We only initialize once so flattening the structures does not have any real cost.</span>
<span class="udiff-line-added">+     Structure* prototypeStructure = arrayPrototype-&gt;structure(vm);</span>
<span class="udiff-line-added">+     if (prototypeStructure-&gt;isDictionary())</span>
<span class="udiff-line-added">+         prototypeStructure = prototypeStructure-&gt;flattenDictionaryStructure(vm, arrayPrototype);</span>
<span class="udiff-line-added">+     RELEASE_ASSERT(!prototypeStructure-&gt;isDictionary());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ArrayConstructor* arrayConstructor = this-&gt;arrayConstructor();</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     auto invalidateWatchpoint = [&amp;] {</span>
<span class="udiff-line-added">+         m_arraySpeciesWatchpointSet.invalidate(vm, StringFireDetail(&quot;Was not able to set up array species watchpoint.&quot;));</span>
<span class="udiff-line-added">+     };</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     PropertySlot constructorSlot(arrayPrototype, PropertySlot::InternalMethodType::VMInquiry);</span>
<span class="udiff-line-added">+     arrayPrototype-&gt;getOwnPropertySlot(arrayPrototype, exec, vm.propertyNames-&gt;constructor, constructorSlot);</span>
<span class="udiff-line-added">+     scope.assertNoException();</span>
<span class="udiff-line-added">+     if (constructorSlot.slotBase() != arrayPrototype</span>
<span class="udiff-line-added">+         || !constructorSlot.isCacheableValue()</span>
<span class="udiff-line-added">+         || constructorSlot.getValue(exec, vm.propertyNames-&gt;constructor) != arrayConstructor) {</span>
<span class="udiff-line-added">+         invalidateWatchpoint();</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     Structure* constructorStructure = arrayConstructor-&gt;structure(vm);</span>
<span class="udiff-line-added">+     if (constructorStructure-&gt;isDictionary())</span>
<span class="udiff-line-added">+         constructorStructure = constructorStructure-&gt;flattenDictionaryStructure(vm, arrayConstructor);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     PropertySlot speciesSlot(arrayConstructor, PropertySlot::InternalMethodType::VMInquiry);</span>
<span class="udiff-line-added">+     arrayConstructor-&gt;getOwnPropertySlot(arrayConstructor, exec, vm.propertyNames-&gt;speciesSymbol, speciesSlot);</span>
<span class="udiff-line-added">+     scope.assertNoException();</span>
<span class="udiff-line-added">+     if (speciesSlot.slotBase() != arrayConstructor</span>
<span class="udiff-line-added">+         || !speciesSlot.isCacheableGetter()</span>
<span class="udiff-line-added">+         || speciesSlot.getterSetter() != speciesGetterSetter()) {</span>
<span class="udiff-line-added">+         invalidateWatchpoint();</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // Now we need to setup the watchpoints to make sure these conditions remain valid.</span>
<span class="udiff-line-added">+     prototypeStructure-&gt;startWatchingPropertyForReplacements(vm, constructorSlot.cachedOffset());</span>
<span class="udiff-line-added">+     constructorStructure-&gt;startWatchingPropertyForReplacements(vm, speciesSlot.cachedOffset());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     ObjectPropertyCondition constructorCondition = ObjectPropertyCondition::equivalence(vm, arrayPrototype, arrayPrototype, vm.propertyNames-&gt;constructor.impl(), arrayConstructor);</span>
<span class="udiff-line-added">+     ObjectPropertyCondition speciesCondition = ObjectPropertyCondition::equivalence(vm, arrayPrototype, arrayConstructor, vm.propertyNames-&gt;speciesSymbol.impl(), speciesGetterSetter());</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if (!constructorCondition.isWatchable() || !speciesCondition.isWatchable()) {</span>
<span class="udiff-line-added">+         invalidateWatchpoint();</span>
<span class="udiff-line-added">+         return;</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     // We only watch this from the DFG, and the DFG makes sure to only start watching if the watchpoint is in the IsWatched state.</span>
<span class="udiff-line-added">+     RELEASE_ASSERT(!m_arraySpeciesWatchpointSet.isBeingWatched());</span>
<span class="udiff-line-added">+     m_arraySpeciesWatchpointSet.touch(vm, &quot;Set up array species watchpoint.&quot;);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     m_arrayPrototypeConstructorWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, constructorCondition, m_arraySpeciesWatchpointSet);</span>
<span class="udiff-line-added">+     m_arrayPrototypeConstructorWatchpoint-&gt;install(vm);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     m_arrayConstructorSpeciesWatchpoint = makeUnique&lt;ObjectPropertyChangeAdaptiveWatchpoint&lt;InlineWatchpointSet&gt;&gt;(this, speciesCondition, m_arraySpeciesWatchpointSet);</span>
<span class="udiff-line-added">+     m_arrayConstructorSpeciesWatchpoint-&gt;install(vm);</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  void slowValidateCell(JSGlobalObject* globalObject)
  {
      RELEASE_ASSERT(globalObject-&gt;isGlobalObject());
      ASSERT_GC_OBJECT_INHERITS(globalObject, JSGlobalObject::info());
  }
</pre>
<center><a href="JSGenericTypedArrayViewPrototypeFunctions.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="JSGlobalObject.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>