<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/layout/displaytree/DisplayBox.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="DisplayBox.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../floats/FloatAvoider.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/layout/displaytree/DisplayBox.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,10 +25,11 @@</span>
  
  #pragma once
  
  #if ENABLE(LAYOUT_FORMATTING_CONTEXT)
  
<span class="udiff-line-added">+ #include &quot;DisplayRect.h&quot;</span>
  #include &quot;LayoutUnits.h&quot;
  #include &quot;RenderStyleConstants.h&quot;
  #include &lt;wtf/IsoMalloc.h&gt;
  
  namespace WebCore {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -41,10 +42,11 @@</span>
  class FloatBox;
  class FormattingContext;
  class FloatingContext;
  class InlineFormattingContext;
  class LayoutState;
<span class="udiff-line-added">+ class TableFormattingContext;</span>
  }
  
  namespace Display {
  
  class Box {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -55,75 +57,14 @@</span>
      friend class Layout::FloatBox;
      friend class Layout::FormattingContext;
      friend class Layout::FloatingContext;
      friend class Layout::InlineFormattingContext;
      friend class Layout::LayoutState;
<span class="udiff-line-added">+     friend class Layout::TableFormattingContext;</span>
  
      Box(const RenderStyle&amp;);
      Box(const Box&amp;);
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     class Rect {</span>
<span class="udiff-line-removed">-     public:</span>
<span class="udiff-line-removed">-         Rect() = default;</span>
<span class="udiff-line-removed">-         Rect(LayoutUnit top, LayoutUnit left, LayoutUnit width, LayoutUnit height);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         LayoutUnit top() const;</span>
<span class="udiff-line-removed">-         LayoutUnit left() const;</span>
<span class="udiff-line-removed">-         LayoutPoint topLeft() const;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         LayoutUnit bottom() const;</span>
<span class="udiff-line-removed">-         LayoutUnit right() const;</span>
<span class="udiff-line-removed">-         LayoutPoint bottomRight() const;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         LayoutUnit width() const;</span>
<span class="udiff-line-removed">-         LayoutUnit height() const;</span>
<span class="udiff-line-removed">-         LayoutSize size() const;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         void setTop(LayoutUnit);</span>
<span class="udiff-line-removed">-         void setLeft(LayoutUnit);</span>
<span class="udiff-line-removed">-         void setTopLeft(const LayoutPoint&amp;);</span>
<span class="udiff-line-removed">-         void setWidth(LayoutUnit);</span>
<span class="udiff-line-removed">-         void setHeight(LayoutUnit);</span>
<span class="udiff-line-removed">-         void setSize(const LayoutSize&amp;);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         void shiftLeftTo(LayoutUnit);</span>
<span class="udiff-line-removed">-         void shiftRightTo(LayoutUnit);</span>
<span class="udiff-line-removed">-         void shiftTopTo(LayoutUnit);</span>
<span class="udiff-line-removed">-         void shiftBottomTo(LayoutUnit);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         void moveHorizontally(LayoutUnit);</span>
<span class="udiff-line-removed">-         void moveVertically(LayoutUnit);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         void expand(LayoutUnit, LayoutUnit);</span>
<span class="udiff-line-removed">-         bool intersects(const Rect&amp; rect) const { return m_rect.intersects(rect); }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         Rect clone() const;</span>
<span class="udiff-line-removed">-         operator LayoutRect() const;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     private:</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-         void invalidateTop() { m_hasValidTop = false; }</span>
<span class="udiff-line-removed">-         void invalidateLeft() { m_hasValidLeft = false; }</span>
<span class="udiff-line-removed">-         void invalidateWidth() { m_hasValidWidth = false; }</span>
<span class="udiff-line-removed">-         void invalidateHeight() { m_hasValidHeight = false; }</span>
<span class="udiff-line-removed">-         void invalidatePosition();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         bool hasValidPosition() const { return m_hasValidTop &amp;&amp; m_hasValidLeft; }</span>
<span class="udiff-line-removed">-         bool hasValidSize() const { return m_hasValidWidth &amp;&amp; m_hasValidHeight; }</span>
<span class="udiff-line-removed">-         bool hasValidGeometry() const { return hasValidPosition() &amp;&amp; hasValidSize(); }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         void setHasValidPosition();</span>
<span class="udiff-line-removed">-         void setHasValidSize();</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         bool m_hasValidTop { false };</span>
<span class="udiff-line-removed">-         bool m_hasValidLeft { false };</span>
<span class="udiff-line-removed">-         bool m_hasValidWidth { false };</span>
<span class="udiff-line-removed">-         bool m_hasValidHeight { false };</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-         LayoutRect m_rect;</span>
<span class="udiff-line-removed">-     };</span>
<span class="udiff-line-removed">- </span>
      ~Box();
  
      LayoutUnit top() const;
      LayoutUnit left() const;
      LayoutUnit bottom() const { return top() + height(); }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -137,10 +78,11 @@</span>
      LayoutUnit height() const { return borderTop() + paddingBoxHeight() + borderBottom(); }
      Rect rect() const { return { top(), left(), width(), height() }; }
      Rect rectWithMargin() const;
  
      Layout::UsedVerticalMargin verticalMargin() const;
<span class="udiff-line-added">+     Layout::UsedHorizontalMargin horizontalMargin() const;</span>
      LayoutUnit marginBefore() const;
      LayoutUnit marginStart() const;
      LayoutUnit marginAfter() const;
      LayoutUnit marginEnd() const;
      bool hasCollapsedThroughMargin() const { return m_verticalMargin.isCollapsedThrough(); }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -177,10 +119,17 @@</span>
      LayoutUnit paddingBoxBottom() const { return paddingBoxTop() + paddingBoxHeight(); }
      LayoutUnit paddingBoxRight() const { return paddingBoxLeft() + paddingBoxWidth(); }
      LayoutUnit paddingBoxHeight() const { return paddingTop().valueOr(0) + contentBoxHeight() + paddingBottom().valueOr(0); }
      LayoutUnit paddingBoxWidth() const { return paddingLeft().valueOr(0) + contentBoxWidth() + paddingRight().valueOr(0); }
  
<span class="udiff-line-added">+     LayoutUnit borderBoxHeight() const { return borderTop() + paddingBoxHeight() + borderBottom(); }</span>
<span class="udiff-line-added">+     LayoutUnit borderBoxWidth() const { return borderLeft() + paddingBoxWidth() + borderRight(); }</span>
<span class="udiff-line-added">+     LayoutUnit marginBoxHeight() const { return marginBefore() + borderBoxHeight() + marginAfter(); }</span>
<span class="udiff-line-added">+     LayoutUnit marginBoxWidth() const { return marginStart() + borderBoxWidth() + marginEnd(); }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     LayoutUnit horizontalMarginBorderAndPadding() const { return marginStart() + horizontalBorder() + horizontalPadding().valueOr(0) + marginEnd(); }</span>
<span class="udiff-line-added">+ </span>
      Rect marginBox() const;
      Rect nonCollapsedMarginBox() const;
  
      Rect borderBox() const;
      Rect paddingBox() const;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -198,12 +147,12 @@</span>
      };
  
      void setTopLeft(const LayoutPoint&amp;);
      void setTop(LayoutUnit);
      void setLeft(LayoutUnit);
<span class="udiff-line-modified-removed">-     void moveHorizontally(LayoutUnit offset) { m_topLeft.move(offset, { }); }</span>
<span class="udiff-line-modified-removed">-     void moveVertically(LayoutUnit offset) { m_topLeft.move({ }, offset); }</span>
<span class="udiff-line-modified-added">+     void moveHorizontally(LayoutUnit offset) { m_topLeft.move(offset, 0_lu); }</span>
<span class="udiff-line-modified-added">+     void moveVertically(LayoutUnit offset) { m_topLeft.move(0_lu, offset); }</span>
  
      void setContentBoxHeight(LayoutUnit);
      void setContentBoxWidth(LayoutUnit);
  
      void setHorizontalMargin(Layout::UsedHorizontalMargin);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -262,198 +211,17 @@</span>
      bool m_hasEstimatedMarginBefore { false };
  #endif
  };
  
  #if !ASSERT_DISABLED
<span class="udiff-line-removed">- inline void Box::Rect::invalidatePosition()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     invalidateTop();</span>
<span class="udiff-line-removed">-     invalidateLeft();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setHasValidPosition()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     m_hasValidTop = true;</span>
<span class="udiff-line-removed">-     m_hasValidLeft = true;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setHasValidSize()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     m_hasValidWidth = true;</span>
<span class="udiff-line-removed">-     m_hasValidHeight = true;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  inline void Box::invalidateMargin()
  {
      m_hasValidHorizontalMargin = false;
      m_hasValidVerticalMargin = false;
  }
  #endif
  
<span class="udiff-line-removed">- inline LayoutUnit Box::Rect::top() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidTop);</span>
<span class="udiff-line-removed">-     return m_rect.y();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutUnit Box::Rect::left() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidLeft);</span>
<span class="udiff-line-removed">-     return m_rect.x();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutUnit Box::Rect::bottom() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidTop &amp;&amp; m_hasValidHeight);</span>
<span class="udiff-line-removed">-     return m_rect.maxY();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutUnit Box::Rect::right() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidLeft &amp;&amp; m_hasValidWidth);</span>
<span class="udiff-line-removed">-     return m_rect.maxX();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutPoint Box::Rect::topLeft() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(hasValidPosition());</span>
<span class="udiff-line-removed">-     return m_rect.minXMinYCorner();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutPoint Box::Rect::bottomRight() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(hasValidGeometry());</span>
<span class="udiff-line-removed">-     return m_rect.maxXMaxYCorner();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutSize Box::Rect::size() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(hasValidSize());</span>
<span class="udiff-line-removed">-     return m_rect.size();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutUnit Box::Rect::width() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidWidth);</span>
<span class="udiff-line-removed">-     return m_rect.width();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline LayoutUnit Box::Rect::height() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidHeight);</span>
<span class="udiff-line-removed">-     return m_rect.height();</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setTopLeft(const LayoutPoint&amp; topLeft)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     setHasValidPosition();</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     m_rect.setLocation(topLeft);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setTop(LayoutUnit top)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     m_hasValidTop = true;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     m_rect.setY(top);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setLeft(LayoutUnit left)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     m_hasValidLeft = true;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     m_rect.setX(left);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setWidth(LayoutUnit width)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     m_hasValidWidth = true;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     m_rect.setWidth(width);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setHeight(LayoutUnit height)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     m_hasValidHeight = true;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     m_rect.setHeight(height);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::setSize(const LayoutSize&amp; size)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     setHasValidSize();</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     m_rect.setSize(size);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::shiftLeftTo(LayoutUnit left)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidLeft);</span>
<span class="udiff-line-removed">-     m_rect.shiftXEdgeTo(left);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::shiftRightTo(LayoutUnit right)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidLeft &amp;&amp; m_hasValidWidth);</span>
<span class="udiff-line-removed">-     m_rect.shiftMaxXEdgeTo(right);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::shiftTopTo(LayoutUnit top)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidTop);</span>
<span class="udiff-line-removed">-     m_rect.shiftYEdgeTo(top);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::shiftBottomTo(LayoutUnit bottom)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidTop &amp;&amp; m_hasValidHeight);</span>
<span class="udiff-line-removed">-     m_rect.shiftMaxYEdgeTo(bottom);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::moveHorizontally(LayoutUnit offset)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidLeft);</span>
<span class="udiff-line-removed">-     m_rect.move(offset, { });</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::moveVertically(LayoutUnit offset)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(m_hasValidTop);</span>
<span class="udiff-line-removed">-     m_rect.move({ }, offset);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline void Box::Rect::expand(LayoutUnit width, LayoutUnit height)</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(hasValidGeometry());</span>
<span class="udiff-line-removed">-     m_rect.expand(width, height);</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline Box::Rect Box::Rect::clone() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     Rect rect;</span>
<span class="udiff-line-removed">- #if !ASSERT_DISABLED</span>
<span class="udiff-line-removed">-     rect.m_hasValidTop = m_hasValidTop;</span>
<span class="udiff-line-removed">-     rect.m_hasValidLeft = m_hasValidLeft;</span>
<span class="udiff-line-removed">-     rect.m_hasValidWidth = m_hasValidWidth;</span>
<span class="udiff-line-removed">-     rect.m_hasValidHeight  = m_hasValidHeight;</span>
<span class="udiff-line-removed">- #endif</span>
<span class="udiff-line-removed">-     rect.m_rect = m_rect;</span>
<span class="udiff-line-removed">-     return rect;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- inline Box::Rect::operator LayoutRect() const</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     ASSERT(hasValidGeometry());</span>
<span class="udiff-line-removed">-     return m_rect;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  inline LayoutUnit Box::top() const
  {
      ASSERT(m_hasValidTop &amp;&amp; (m_hasEstimatedMarginBefore || m_hasValidVerticalMargin));
      return m_topLeft.y();
  }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -564,11 +332,11 @@</span>
      setHasValidPadding();
  #endif
      m_padding = padding;
  }
  
<span class="udiff-line-modified-removed">- inline Box::Rect Box::rectWithMargin() const</span>
<span class="udiff-line-modified-added">+ inline Rect Box::rectWithMargin() const</span>
  {
      auto marginAfter = this-&gt;marginAfter();
      if (m_verticalMargin.collapsedValues().isCollapsedThrough)
          marginAfter = 0;
      return { top() - marginBefore(), left() - marginStart(), marginStart() + width() + marginEnd(), marginBefore() + height() + marginAfter };
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -578,10 +346,16 @@</span>
  {
      ASSERT(m_hasValidVerticalMargin);
      return m_verticalMargin;
  }
  
<span class="udiff-line-added">+ inline Layout::UsedHorizontalMargin Box::horizontalMargin() const</span>
<span class="udiff-line-added">+ {</span>
<span class="udiff-line-added">+     ASSERT(m_hasValidHorizontalMargin);</span>
<span class="udiff-line-added">+     return m_horizontalMargin;</span>
<span class="udiff-line-added">+ }</span>
<span class="udiff-line-added">+ </span>
  inline LayoutUnit Box::marginBefore() const
  {
      ASSERT(m_hasValidVerticalMargin);
      return m_verticalMargin.before();
  }
</pre>
<center><a href="DisplayBox.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../floats/FloatAvoider.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>