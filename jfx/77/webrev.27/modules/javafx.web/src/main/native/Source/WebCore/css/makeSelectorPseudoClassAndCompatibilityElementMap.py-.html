<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/WebCore/css/makeSelectorPseudoClassAndCompatibilityElementMap.py</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 #!/usr/bin/env python
  2 #
  3 # Copyright (C) 2014 Apple Inc. All rights reserved.
  4 #
  5 # Redistribution and use in source and binary forms, with or without
  6 # modification, are permitted provided that the following conditions
  7 # are met:
  8 # 1. Redistributions of source code must retain the above copyright
  9 #    notice, this list of conditions and the following disclaimer.
 10 # 2. Redistributions in binary form must reproduce the above copyright
 11 #    notice, this list of conditions and the following disclaimer in the
 12 #    documentation and/or other materials provided with the distribution.
 13 #
 14 # THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 15 # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 16 # THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17 # PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 18 # BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 19 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 20 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 21 # INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 22 # CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 23 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 24 # THE POSSIBILITY OF SUCH DAMAGE.
 25 
 26 import os
 27 import sys
 28 import subprocess
 29 
 30 
 31 def enumerablePseudoType(stringPseudoType):
 32     output = [&#39;CSSSelector::PseudoClass&#39;]
 33 
 34     if stringPseudoType.endswith(&#39;(&#39;):
 35         stringPseudoType = stringPseudoType[:-1]
 36 
 37     webkitPrefix = &#39;-webkit-&#39;
 38     if (stringPseudoType.startswith(webkitPrefix)):
 39         stringPseudoType = stringPseudoType[len(webkitPrefix):]
 40 
 41     khtmlPrefix = &#39;-khtml-&#39;
 42     if (stringPseudoType.startswith(khtmlPrefix)):
 43         stringPseudoType = stringPseudoType[len(khtmlPrefix):]
 44 
 45     substring_start = 0
 46     next_dash_position = stringPseudoType.find(&#39;-&#39;)
 47     while (next_dash_position != -1):
 48         output.append(stringPseudoType[substring_start].upper())
 49         output.append(stringPseudoType[substring_start + 1:next_dash_position])
 50         substring_start = next_dash_position + 1
 51         next_dash_position = stringPseudoType.find(&#39;-&#39;, substring_start)
 52 
 53     output.append(stringPseudoType[substring_start].upper())
 54     output.append(stringPseudoType[substring_start + 1:])
 55     return &#39;&#39;.join(output)
 56 
 57 
 58 def expand_ifdef_condition(condition):
 59     return condition.replace(&#39;(&#39;, &#39;_&#39;).replace(&#39;)&#39;, &#39;&#39;)
 60 
 61 output_file = open(&#39;SelectorPseudoClassAndCompatibilityElementMap.gperf&#39;, &#39;w&#39;)
 62 
 63 output_file.write(&quot;&quot;&quot;
 64 %{
 65 /*
 66  * Copyright (C) 2014-2016 Apple Inc. All rights reserved.
 67  *
 68  * Redistribution and use in source and binary forms, with or without
 69  * modification, are permitted provided that the following conditions
 70  * are met:
 71  * 1. Redistributions of source code must retain the above copyright
 72  *    notice, this list of conditions and the following disclaimer.
 73  * 2. Redistributions in binary form must reproduce the above copyright
 74  *    notice, this list of conditions and the following disclaimer in the
 75  *    documentation and/or other materials provided with the distribution.
 76  *
 77  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 78  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 79  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 80  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 81  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 82  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 83  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 84  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 85  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 86  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 87  * THE POSSIBILITY OF SUCH DAMAGE.
 88  */
 89 
 90 // This file is automatically generated from SelectorPseudoTypeMap.in by makeprop, do not edit by hand.
 91 
 92 #include &quot;config.h&quot;
 93 #include &quot;SelectorPseudoTypeMap.h&quot;
 94 
 95 #include &quot;CSSParserSelector.h&quot;
 96 
 97 IGNORE_WARNINGS_BEGIN(&quot;implicit-fallthrough&quot;)
 98 
 99 // Older versions of gperf like to use the `register` keyword.
100 #define register
101 
102 namespace WebCore {
103 
104 struct SelectorPseudoClassOrCompatibilityPseudoElementEntry {
105     const char* name;
106     PseudoClassOrCompatibilityPseudoElement pseudoTypes;
107 };
108 
109 %}
110 %struct-type
111 %define initializer-suffix ,{CSSSelector::PseudoClassUnknown,CSSSelector::PseudoElementUnknown}
112 %define class-name SelectorPseudoClassAndCompatibilityElementMapHash
113 %omit-struct-type
114 %language=C++
115 %readonly-tables
116 %global-table
117 %ignore-case
118 %compare-strncmp
119 %enum
120 
121 struct SelectorPseudoClassOrCompatibilityPseudoElementEntry;
122 
123 %%
124 &quot;&quot;&quot;)
125 
126 webcore_defines = [i.strip() for i in sys.argv[-1].split(&#39; &#39;)]
127 
128 longest_keyword = 0
129 
130 ignore_until_endif = False
131 input_file = open(sys.argv[1], &#39;r&#39;)
132 for line in input_file:
133     line = line.strip()
134     if not line:
135         continue
136 
137     if line.startswith(&#39;#if &#39;):
138         condition = line[4:].strip()
139         if expand_ifdef_condition(condition) not in webcore_defines:
140             ignore_until_endif = True
141         continue
142 
143     if line.startswith(&#39;#endif&#39;):
144         ignore_until_endif = False
145         continue
146 
147     if ignore_until_endif:
148         continue
149 
150     keyword_definition = line.split(&#39;,&#39;)
151     if len(keyword_definition) == 1:
152         keyword = keyword_definition[0].strip()
153         output_file.write(&#39;&quot;%s&quot;, {%s, CSSSelector::PseudoElementUnknown}\n&#39; % (keyword, enumerablePseudoType(keyword)))
154     else:
155         output_file.write(&#39;&quot;%s&quot;, {CSSSelector::%s, CSSSelector::%s}\n&#39; % (keyword_definition[0].strip(), keyword_definition[1].strip(), keyword_definition[2].strip()))
156 
157     longest_keyword = max(longest_keyword, len(keyword))
158 
159 output_file.write(&quot;&quot;&quot;%%
160 
161 static inline const SelectorPseudoClassOrCompatibilityPseudoElementEntry* parsePseudoClassAndCompatibilityElementString(const LChar* characters, unsigned length)
162 {
163     return SelectorPseudoClassAndCompatibilityElementMapHash::in_word_set(reinterpret_cast&lt;const char*&gt;(characters), length);
164 }&quot;&quot;&quot;)
165 
166 output_file.write(&quot;&quot;&quot;
167 
168 static inline const SelectorPseudoClassOrCompatibilityPseudoElementEntry* parsePseudoClassAndCompatibilityElementString(const UChar* characters, unsigned length)
169 {
170     const unsigned maxKeywordLength = %s;
171     LChar buffer[maxKeywordLength];
172     if (length &gt; maxKeywordLength)
173         return nullptr;
174 
175     for (unsigned i = 0; i &lt; length; ++i) {
176         UChar character = characters[i];
177         if (character &amp; ~0xff)
178             return nullptr;
179 
180         buffer[i] = static_cast&lt;LChar&gt;(character);
181     }
182     return parsePseudoClassAndCompatibilityElementString(buffer, length);
183 }
184 &quot;&quot;&quot; % longest_keyword)
185 
186 output_file.write(&quot;&quot;&quot;
187 PseudoClassOrCompatibilityPseudoElement parsePseudoClassAndCompatibilityElementString(const StringView&amp; pseudoTypeString)
188 {
189     const SelectorPseudoClassOrCompatibilityPseudoElementEntry* entry;
190     if (pseudoTypeString.is8Bit())
191         entry = parsePseudoClassAndCompatibilityElementString(pseudoTypeString.characters8(), pseudoTypeString.length());
192     else
193         entry = parsePseudoClassAndCompatibilityElementString(pseudoTypeString.characters16(), pseudoTypeString.length());
194 
195     if (entry)
196         return entry-&gt;pseudoTypes;
197     return { CSSSelector::PseudoClassUnknown, CSSSelector::PseudoElementUnknown };
198 }
199 
200 } // namespace WebCore
201 
202 IGNORE_WARNINGS_END
203 
204 &quot;&quot;&quot;)
205 output_file.close()
206 
207 gperf_command = sys.argv[2]
208 if &#39;GPERF&#39; in os.environ:
209     gperf_command = os.environ[&#39;GPERF&#39;]
210 
211 if subprocess.call([gperf_command, &#39;--key-positions=*&#39;, &#39;-m&#39;, &#39;10&#39;, &#39;-s&#39;, &#39;2&#39;, &#39;SelectorPseudoClassAndCompatibilityElementMap.gperf&#39;, &#39;--output-file=SelectorPseudoClassAndCompatibilityElementMap.cpp&#39;]) != 0:
212     print(&quot;Error when generating SelectorPseudoClassAndCompatibilityElementMap.cpp from SelectorPseudoClassAndCompatibilityElementMap.gperf :(&quot;)
213     sys.exit(gperf_return)
    </pre>
  </body>
</html>