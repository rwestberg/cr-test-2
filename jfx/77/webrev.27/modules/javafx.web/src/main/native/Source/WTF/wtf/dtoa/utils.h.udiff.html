<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WTF/wtf/dtoa/utils.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="strtod.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../fuchsia/CPUTimeFuchsia.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WTF/wtf/dtoa/utils.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -169,150 +169,150 @@</span>
  static const int kCharSize = sizeof(char);
  
  // Returns the maximum of the two parameters.
  template &lt;typename T&gt;
  static T Max(T a, T b) {
<span class="udiff-line-modified-removed">-         return a &lt; b ? b : a;</span>
<span class="udiff-line-modified-added">+   return a &lt; b ? b : a;</span>
  }
  
  
  // Returns the minimum of the two parameters.
  template &lt;typename T&gt;
  static T Min(T a, T b) {
<span class="udiff-line-modified-removed">-         return a &lt; b ? a : b;</span>
<span class="udiff-line-modified-added">+   return a &lt; b ? a : b;</span>
  }
  
  
  inline int StrLength(const char* string) {
<span class="udiff-line-modified-removed">-         size_t length = strlen(string);</span>
<span class="udiff-line-modified-removed">-         ASSERT(length == static_cast&lt;size_t&gt;(static_cast&lt;int&gt;(length)));</span>
<span class="udiff-line-modified-removed">-         return static_cast&lt;int&gt;(length);</span>
<span class="udiff-line-modified-added">+   size_t length = strlen(string);</span>
<span class="udiff-line-modified-added">+   ASSERT(length == static_cast&lt;size_t&gt;(static_cast&lt;int&gt;(length)));</span>
<span class="udiff-line-modified-added">+   return static_cast&lt;int&gt;(length);</span>
  }
  
  // This is a simplified version of V8&#39;s Vector class.
  template &lt;typename T&gt;
  class BufferReference {
<span class="udiff-line-modified-removed">-     public:</span>
<span class="udiff-line-modified-removed">-         BufferReference() : start_(NULL), length_(0) {}</span>
<span class="udiff-line-modified-added">+  public:</span>
<span class="udiff-line-modified-added">+   BufferReference() : start_(NULL), length_(0) {}</span>
    BufferReference(T* data, int len) : start_(data), length_(len) {
      ASSERT(len == 0 || (len &gt; 0 &amp;&amp; data != NULL));
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+   }</span>
  
    // Returns a BufferReference using the same backing storage as this one,
<span class="udiff-line-modified-removed">-         // spanning from and including &#39;from&#39;, to but not including &#39;to&#39;.</span>
<span class="udiff-line-modified-removed">-         BufferReference&lt;T&gt; SubBufferReference(int from, int to) {</span>
<span class="udiff-line-modified-removed">-             ASSERT(to &lt;= length_);</span>
<span class="udiff-line-modified-added">+   // spanning from and including &#39;from&#39;, to but not including &#39;to&#39;.</span>
<span class="udiff-line-modified-added">+   BufferReference&lt;T&gt; SubBufferReference(int from, int to) {</span>
<span class="udiff-line-modified-added">+     ASSERT(to &lt;= length_);</span>
      ASSERT(from &lt; to);
<span class="udiff-line-modified-removed">-             ASSERT(0 &lt;= from);</span>
<span class="udiff-line-modified-removed">-             return BufferReference&lt;T&gt;(start() + from, to - from);</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+     ASSERT(0 &lt;= from);</span>
<span class="udiff-line-modified-added">+     return BufferReference&lt;T&gt;(start() + from, to - from);</span>
<span class="udiff-line-modified-added">+   }</span>
  
    // Returns the length of the BufferReference.
<span class="udiff-line-modified-removed">-         int length() const { return length_; }</span>
<span class="udiff-line-modified-added">+   int length() const { return length_; }</span>
  
    // Returns whether or not the BufferReference is empty.
<span class="udiff-line-modified-removed">-         bool is_empty() const { return length_ == 0; }</span>
<span class="udiff-line-modified-added">+   bool is_empty() const { return length_ == 0; }</span>
  
    // Returns the pointer to the start of the data in the BufferReference.
<span class="udiff-line-modified-removed">-         T* start() const { return start_; }</span>
<span class="udiff-line-modified-added">+   T* start() const { return start_; }</span>
  
    // Access individual BufferReference elements - checks bounds in debug mode.
<span class="udiff-line-modified-removed">-         T&amp; operator[](int index) const {</span>
<span class="udiff-line-modified-removed">-             ASSERT(0 &lt;= index &amp;&amp; index &lt; length_);</span>
<span class="udiff-line-modified-removed">-             return start_[index];</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+   T&amp; operator[](int index) const {</span>
<span class="udiff-line-modified-added">+     ASSERT(0 &lt;= index &amp;&amp; index &lt; length_);</span>
<span class="udiff-line-modified-added">+     return start_[index];</span>
<span class="udiff-line-modified-added">+   }</span>
  
<span class="udiff-line-modified-removed">-         T&amp; first() { return start_[0]; }</span>
<span class="udiff-line-modified-added">+   T&amp; first() { return start_[0]; }</span>
  
<span class="udiff-line-modified-removed">-         T&amp; last() { return start_[length_ - 1]; }</span>
<span class="udiff-line-modified-added">+   T&amp; last() { return start_[length_ - 1]; }</span>
  
<span class="udiff-line-modified-removed">-     private:</span>
<span class="udiff-line-modified-removed">-         T* start_;</span>
<span class="udiff-line-modified-removed">-         int length_;</span>
<span class="udiff-line-modified-added">+  private:</span>
<span class="udiff-line-modified-added">+   T* start_;</span>
<span class="udiff-line-modified-added">+   int length_;</span>
  };
  
  
  // Helper class for building result strings in a character buffer. The
  // purpose of the class is to use safe operations that checks the
  // buffer bounds on all operations in debug mode.
  class StringBuilder {
<span class="udiff-line-modified-removed">-     public:</span>
<span class="udiff-line-modified-added">+  public:</span>
    StringBuilder(char* buffer, int buffer_size)
        : buffer_(buffer, buffer_size), position_(0) { }
  
<span class="udiff-line-modified-removed">-         ~StringBuilder() { if (!is_finalized()) Finalize(); }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         int size() const { return buffer_.length(); }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // Get the current position in the builder.</span>
<span class="udiff-line-modified-removed">-         int position() const {</span>
<span class="udiff-line-modified-removed">-             ASSERT(!is_finalized());</span>
<span class="udiff-line-modified-removed">-             return position_;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // Reset the position.</span>
<span class="udiff-line-modified-removed">-         void Reset() { position_ = 0; }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // Add a single character to the builder. It is not allowed to add</span>
<span class="udiff-line-modified-removed">-         // 0-characters; use the Finalize() method to terminate the string</span>
<span class="udiff-line-modified-removed">-         // instead.</span>
<span class="udiff-line-modified-removed">-         void AddCharacter(char c) {</span>
<span class="udiff-line-modified-removed">-             ASSERT(c != &#39;\0&#39;);</span>
<span class="udiff-line-modified-removed">-             ASSERT(!is_finalized() &amp;&amp; position_ &lt; buffer_.length());</span>
<span class="udiff-line-modified-removed">-             buffer_[position_++] = c;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // Add an entire string to the builder. Uses strlen() internally to</span>
<span class="udiff-line-modified-removed">-         // compute the length of the input string.</span>
<span class="udiff-line-modified-removed">-         void AddString(const char* s) {</span>
<span class="udiff-line-modified-removed">-             AddSubstring(s, StrLength(s));</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // Add the first &#39;n&#39; characters of the given string &#39;s&#39; to the</span>
<span class="udiff-line-modified-removed">-         // builder. The input string must have enough characters.</span>
<span class="udiff-line-modified-removed">-         void AddSubstring(const char* s, int n) {</span>
<span class="udiff-line-modified-removed">-             ASSERT(!is_finalized() &amp;&amp; position_ + n &lt; buffer_.length());</span>
<span class="udiff-line-modified-removed">-             ASSERT_WITH_SECURITY_IMPLICATION(static_cast&lt;size_t&gt;(n) &lt;= strlen(s));</span>
<span class="udiff-line-modified-added">+   ~StringBuilder() { if (!is_finalized()) Finalize(); }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   int size() const { return buffer_.length(); }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Get the current position in the builder.</span>
<span class="udiff-line-modified-added">+   int position() const {</span>
<span class="udiff-line-modified-added">+     ASSERT(!is_finalized());</span>
<span class="udiff-line-modified-added">+     return position_;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Reset the position.</span>
<span class="udiff-line-modified-added">+   void Reset() { position_ = 0; }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Add a single character to the builder. It is not allowed to add</span>
<span class="udiff-line-modified-added">+   // 0-characters; use the Finalize() method to terminate the string</span>
<span class="udiff-line-modified-added">+   // instead.</span>
<span class="udiff-line-modified-added">+   void AddCharacter(char c) {</span>
<span class="udiff-line-modified-added">+     ASSERT(c != &#39;\0&#39;);</span>
<span class="udiff-line-modified-added">+     ASSERT(!is_finalized() &amp;&amp; position_ &lt; buffer_.length());</span>
<span class="udiff-line-modified-added">+     buffer_[position_++] = c;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Add an entire string to the builder. Uses strlen() internally to</span>
<span class="udiff-line-modified-added">+   // compute the length of the input string.</span>
<span class="udiff-line-modified-added">+   void AddString(const char* s) {</span>
<span class="udiff-line-modified-added">+     AddSubstring(s, StrLength(s));</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Add the first &#39;n&#39; characters of the given string &#39;s&#39; to the</span>
<span class="udiff-line-modified-added">+   // builder. The input string must have enough characters.</span>
<span class="udiff-line-modified-added">+   void AddSubstring(const char* s, int n) {</span>
<span class="udiff-line-modified-added">+     ASSERT(!is_finalized() &amp;&amp; position_ + n &lt; buffer_.length());</span>
<span class="udiff-line-modified-added">+     ASSERT_WITH_SECURITY_IMPLICATION(static_cast&lt;size_t&gt;(n) &lt;= strlen(s));</span>
      memmove(&amp;buffer_[position_], s, n * kCharSize);
<span class="udiff-line-modified-removed">-             position_ += n;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+     position_ += n;</span>
<span class="udiff-line-modified-added">+   }</span>
  
  
<span class="udiff-line-modified-removed">-         // Add character padding to the builder. If count is non-positive,</span>
<span class="udiff-line-modified-removed">-         // nothing is added to the builder.</span>
<span class="udiff-line-modified-removed">-         void AddPadding(char c, int count) {</span>
<span class="udiff-line-modified-removed">-             for (int i = 0; i &lt; count; i++) {</span>
<span class="udiff-line-modified-removed">-                 AddCharacter(c);</span>
<span class="udiff-line-modified-removed">-             }</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-added">+   // Add character padding to the builder. If count is non-positive,</span>
<span class="udiff-line-modified-added">+   // nothing is added to the builder.</span>
<span class="udiff-line-modified-added">+   void AddPadding(char c, int count) {</span>
<span class="udiff-line-modified-added">+     for (int i = 0; i &lt; count; i++) {</span>
<span class="udiff-line-modified-added">+       AddCharacter(c);</span>
<span class="udiff-line-modified-added">+     }</span>
<span class="udiff-line-modified-added">+   }</span>
  
    void RemoveCharacters(int start, int end) {
<span class="udiff-line-modified-removed">-             ASSERT(start &gt;= 0);</span>
<span class="udiff-line-modified-removed">-             ASSERT(end &gt;= 0);</span>
<span class="udiff-line-modified-removed">-             ASSERT(start &lt;= end);</span>
<span class="udiff-line-modified-removed">-             ASSERT(end &lt;= position_);</span>
<span class="udiff-line-modified-removed">-             std::memmove(&amp;buffer_[start], &amp;buffer_[end], position_ - end);</span>
<span class="udiff-line-modified-removed">-             position_ -= end - start;</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         // Finalize the string by 0-terminating it and returning the buffer.</span>
<span class="udiff-line-modified-removed">-         char* Finalize() {</span>
<span class="udiff-line-modified-removed">-             ASSERT(!is_finalized() &amp;&amp; position_ &lt; buffer_.length());</span>
<span class="udiff-line-modified-removed">-             buffer_[position_] = &#39;\0&#39;;</span>
<span class="udiff-line-modified-removed">-             // Make sure nobody managed to add a 0-character to the</span>
<span class="udiff-line-modified-removed">-             // buffer while building the string.</span>
<span class="udiff-line-modified-removed">-             ASSERT(strlen(buffer_.start()) == static_cast&lt;size_t&gt;(position_));</span>
<span class="udiff-line-modified-removed">-             position_ = -1;</span>
<span class="udiff-line-modified-removed">-             ASSERT(is_finalized());</span>
<span class="udiff-line-modified-removed">-             return buffer_.start();</span>
<span class="udiff-line-modified-removed">-         }</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-     private:</span>
<span class="udiff-line-modified-removed">-         BufferReference&lt;char&gt; buffer_;</span>
<span class="udiff-line-modified-removed">-         int position_;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-modified-removed">-         bool is_finalized() const { return position_ &lt; 0; }</span>
<span class="udiff-line-modified-added">+     ASSERT(start &gt;= 0);</span>
<span class="udiff-line-modified-added">+     ASSERT(end &gt;= 0);</span>
<span class="udiff-line-modified-added">+     ASSERT(start &lt;= end);</span>
<span class="udiff-line-modified-added">+     ASSERT(end &lt;= position_);</span>
<span class="udiff-line-modified-added">+     std::memmove(&amp;buffer_[start], &amp;buffer_[end], position_ - end);</span>
<span class="udiff-line-modified-added">+     position_ -= end - start;</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   // Finalize the string by 0-terminating it and returning the buffer.</span>
<span class="udiff-line-modified-added">+   char* Finalize() {</span>
<span class="udiff-line-modified-added">+     ASSERT(!is_finalized() &amp;&amp; position_ &lt; buffer_.length());</span>
<span class="udiff-line-modified-added">+     buffer_[position_] = &#39;\0&#39;;</span>
<span class="udiff-line-modified-added">+     // Make sure nobody managed to add a 0-character to the</span>
<span class="udiff-line-modified-added">+     // buffer while building the string.</span>
<span class="udiff-line-modified-added">+     ASSERT(strlen(buffer_.start()) == static_cast&lt;size_t&gt;(position_));</span>
<span class="udiff-line-modified-added">+     position_ = -1;</span>
<span class="udiff-line-modified-added">+     ASSERT(is_finalized());</span>
<span class="udiff-line-modified-added">+     return buffer_.start();</span>
<span class="udiff-line-modified-added">+   }</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+  private:</span>
<span class="udiff-line-modified-added">+   BufferReference&lt;char&gt; buffer_;</span>
<span class="udiff-line-modified-added">+   int position_;</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+   bool is_finalized() const { return position_ &lt; 0; }</span>
  
    DC_DISALLOW_IMPLICIT_CONSTRUCTORS(StringBuilder);
  };
  
  // The type-based aliasing rule allows the compiler to assume that pointers of
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -339,28 +339,28 @@</span>
  // you can use BitCast to cast one pointer type to another.  This confuses gcc
  // enough that it can no longer see that you have cast one pointer type to
  // another thus avoiding the warning.
  template &lt;class Dest, class Source&gt;
  inline Dest BitCast(const Source&amp; source) {
<span class="udiff-line-modified-removed">-         // Compile time assertion: sizeof(Dest) == sizeof(Source)</span>
<span class="udiff-line-modified-removed">-         // A compile error here means your Dest and Source have different sizes.</span>
<span class="udiff-line-modified-added">+   // Compile time assertion: sizeof(Dest) == sizeof(Source)</span>
<span class="udiff-line-modified-added">+   // A compile error here means your Dest and Source have different sizes.</span>
  #if __cplusplus &gt;= 201103L
    static_assert(sizeof(Dest) == sizeof(Source),
                  &quot;source and destination size mismatch&quot;);
  #else
    typedef char VerifySizesAreEqual[sizeof(Dest) == sizeof(Source) ? 1 : -1];
  #endif
  
<span class="udiff-line-modified-removed">-         Dest dest;</span>
<span class="udiff-line-modified-added">+   Dest dest;</span>
    memmove(&amp;dest, &amp;source, sizeof(dest));
<span class="udiff-line-modified-removed">-         return dest;</span>
<span class="udiff-line-modified-added">+   return dest;</span>
  }
  
  template &lt;class Dest, class Source&gt;
  inline Dest BitCast(Source* source) {
<span class="udiff-line-modified-removed">-         return BitCast&lt;Dest&gt;(reinterpret_cast&lt;uintptr_t&gt;(source));</span>
<span class="udiff-line-modified-added">+   return BitCast&lt;Dest&gt;(reinterpret_cast&lt;uintptr_t&gt;(source));</span>
  }
  
  }  // namespace double_conversion
<span class="udiff-line-modified-removed">- } // namespace WTF</span>
<span class="udiff-line-modified-added">+ }  // namespace WTF</span>
  
  #endif  // DOUBLE_CONVERSION_UTILS_H_
</pre>
<center><a href="strtod.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="../fuchsia/CPUTimeFuchsia.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>