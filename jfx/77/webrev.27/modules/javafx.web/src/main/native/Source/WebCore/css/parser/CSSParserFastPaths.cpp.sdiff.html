<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/css/parser/CSSParserFastPaths.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CSSParserContext.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="CSSParserFastPaths.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/css/parser/CSSParserFastPaths.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  14 //    * Neither the name of Google Inc. nor the names of its
  15 // contributors may be used to endorse or promote products derived from
  16 // this software without specific prior written permission.
  17 //
  18 // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  19 // &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  20 // LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  21 // A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  22 // OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  23 // SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  24 // LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  25 // DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  26 // THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  27 // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  28 // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  29 
  30 #include &quot;config.h&quot;
  31 #include &quot;CSSParserFastPaths.h&quot;
  32 
  33 #include &quot;CSSFunctionValue.h&quot;

  34 #include &quot;CSSParserIdioms.h&quot;
  35 #include &quot;CSSPrimitiveValue.h&quot;
  36 #include &quot;CSSPropertyParser.h&quot;
  37 #include &quot;CSSValueList.h&quot;
  38 #include &quot;CSSValuePool.h&quot;
  39 #include &quot;HTMLParserIdioms.h&quot;
  40 #include &quot;RuntimeEnabledFeatures.h&quot;
  41 #include &quot;StyleColor.h&quot;
  42 #include &quot;StylePropertyShorthand.h&quot;
  43 
  44 namespace WebCore {
  45 
  46 static inline bool isSimpleLengthPropertyID(CSSPropertyID propertyId, bool&amp; acceptsNegativeNumbers)
  47 {
  48     switch (propertyId) {
  49     case CSSPropertyFontSize:
  50     case CSSPropertyHeight:
  51     case CSSPropertyWidth:
  52     case CSSPropertyMinHeight:
  53     case CSSPropertyMinWidth:
</pre>
<hr />
<pre>
 502     CSSValueID valueID = cssValueKeywordID(string);
 503     if (StyleColor::isColorKeyword(valueID)) {
 504         if (!isValueAllowedInMode(valueID, parserMode))
 505             return nullptr;
 506         return CSSValuePool::singleton().createIdentifierValue(valueID);
 507     }
 508 
 509     bool quirksMode = isQuirksModeBehavior(parserMode);
 510 
 511     // Fast path for hex colors and rgb()/rgba() colors
 512     Color color;
 513     if (string.is8Bit())
 514         color = fastParseColorInternal(string.characters8(), string.length(), quirksMode);
 515     else
 516         color = fastParseColorInternal(string.characters16(), string.length(), quirksMode);
 517     if (!color.isValid())
 518         return nullptr;
 519     return CSSValuePool::singleton().createColorValue(color);
 520 }
 521 
<span class="line-modified"> 522 bool CSSParserFastPaths::isValidKeywordPropertyAndValue(CSSPropertyID propertyId, CSSValueID valueID, CSSParserMode parserMode)</span>
 523 {
<span class="line-modified"> 524     if (valueID == CSSValueInvalid || !isValueAllowedInMode(valueID, parserMode))</span>




 525         return false;
 526 
 527     switch (propertyId) {
 528     case CSSPropertyAlignmentBaseline:
 529         // auto | baseline | before-edge | text-before-edge | middle |
 530         // central | after-edge | text-after-edge | ideographic | alphabetic |
 531         // hanging | mathematical
 532         return valueID == CSSValueAuto || valueID == CSSValueAlphabetic || valueID == CSSValueBaseline
 533             || valueID == CSSValueMiddle || (valueID &gt;= CSSValueBeforeEdge &amp;&amp; valueID &lt;= CSSValueMathematical);
 534     case CSSPropertyAll:
 535         return false; // Only accepts css-wide keywords
 536     case CSSPropertyBackgroundRepeatX: // repeat | no-repeat
 537     case CSSPropertyBackgroundRepeatY: // repeat | no-repeat
 538         return valueID == CSSValueRepeat || valueID == CSSValueNoRepeat;
 539     case CSSPropertyBorderCollapse: // collapse | separate
 540         return valueID == CSSValueCollapse || valueID == CSSValueSeparate;
 541     case CSSPropertyBorderTopStyle: // &lt;border-style&gt;
 542     case CSSPropertyBorderRightStyle: // Defined as: none | hidden | dotted | dashed |
 543     case CSSPropertyBorderBottomStyle: // solid | double | groove | ridge | inset | outset
 544     case CSSPropertyBorderLeftStyle:
</pre>
<hr />
<pre>
 555     case CSSPropertyCaptionSide: // top | bottom | left | right
 556         return valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueTop || valueID == CSSValueBottom;
 557     case CSSPropertyClear: // none | left | right | both
 558         return valueID == CSSValueNone || valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueBoth;
 559     case CSSPropertyClipRule:
 560     case CSSPropertyFillRule:
 561         return valueID == CSSValueNonzero || valueID == CSSValueEvenodd;
 562     case CSSPropertyColorInterpolation:
 563     case CSSPropertyColorInterpolationFilters:
 564         return valueID == CSSValueAuto || valueID == CSSValueSRGB || valueID == CSSValueLinearRGB;
 565     case CSSPropertyColorRendering:
 566         return valueID == CSSValueAuto || valueID == CSSValueOptimizeSpeed || valueID == CSSValueOptimizeQuality;
 567     case CSSPropertyDirection: // ltr | rtl
 568         return valueID == CSSValueLtr || valueID == CSSValueRtl;
 569     case CSSPropertyDisplay:
 570         // inline | block | list-item | inline-block | table |
 571         // inline-table | table-row-group | table-header-group | table-footer-group | table-row |
 572         // table-column-group | table-column | table-cell | table-caption | -webkit-box | -webkit-inline-box | none
 573         // flex | inline-flex | -webkit-flex | -webkit-inline-flex | grid | inline-grid
 574         return (valueID &gt;= CSSValueInline &amp;&amp; valueID &lt;= CSSValueContents) || valueID == CSSValueNone
<span class="line-modified"> 575             || valueID == CSSValueGrid || valueID == CSSValueInlineGrid;</span>
 576     case CSSPropertyDominantBaseline:
 577         // auto | use-script | no-change | reset-size | ideographic |
 578         // alphabetic | hanging | mathematical | central | middle |
 579         // text-after-edge | text-before-edge
 580         return valueID == CSSValueAuto || valueID == CSSValueAlphabetic || valueID == CSSValueMiddle
 581             || (valueID &gt;= CSSValueUseScript &amp;&amp; valueID &lt;= CSSValueResetSize)
 582             || (valueID &gt;= CSSValueCentral &amp;&amp; valueID &lt;= CSSValueMathematical);
 583     case CSSPropertyEmptyCells: // show | hide
 584         return valueID == CSSValueShow || valueID == CSSValueHide;
 585     case CSSPropertyFloat: // left | right | none
 586         return valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueNone;
 587     case CSSPropertyImageRendering: // auto | optimizeContrast | pixelated | optimizeSpeed | crispEdges | optimizeQuality | webkit-crispEdges
 588         return valueID == CSSValueAuto || valueID == CSSValueOptimizeSpeed || valueID == CSSValueOptimizeQuality || valueID == CSSValueWebkitCrispEdges || valueID == CSSValueWebkitOptimizeContrast || valueID == CSSValueCrispEdges || valueID == CSSValuePixelated;
 589 #if ENABLE(CSS_COMPOSITING)
 590     case CSSPropertyIsolation: // auto | isolate
 591         return valueID == CSSValueAuto || valueID == CSSValueIsolate;
 592 #endif
 593     case CSSPropertyListStylePosition: // inside | outside
 594         return valueID == CSSValueInside || valueID == CSSValueOutside;
 595     case CSSPropertyListStyleType:
</pre>
<hr />
<pre>
 605     // FIXME-NEWPARSER: Support?
 606     // case CSSPropertyOverflowAnchor:
 607     //    return valueID == CSSValueVisible || valueID == CSSValueNone || valueID == CSSValueAuto;
 608     case CSSPropertyOverflowWrap: // normal | break-word
 609     case CSSPropertyWordWrap:
 610         return valueID == CSSValueNormal || valueID == CSSValueBreakWord;
 611     case CSSPropertyOverflowX: // visible | hidden | scroll | auto | overlay (overlay is a synonym for auto)
 612         return valueID == CSSValueVisible || valueID == CSSValueHidden || valueID == CSSValueScroll || valueID == CSSValueAuto || valueID == CSSValueOverlay;
 613     case CSSPropertyOverflowY: // visible | hidden | scroll | auto | overlay | -webkit-paged-x | -webkit-paged-y (overlay is a synonym for auto)
 614         return valueID == CSSValueVisible || valueID == CSSValueHidden || valueID == CSSValueScroll || valueID == CSSValueAuto || valueID == CSSValueOverlay || valueID == CSSValueWebkitPagedX || valueID == CSSValueWebkitPagedY;
 615     case CSSPropertyBreakAfter:
 616     case CSSPropertyBreakBefore:
 617         return valueID == CSSValueAuto || valueID == CSSValueAvoid || valueID == CSSValueAvoidPage || valueID == CSSValuePage || valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueRecto || valueID == CSSValueVerso || valueID == CSSValueAvoidColumn || valueID == CSSValueColumn;
 618     case CSSPropertyBreakInside:
 619         return valueID == CSSValueAuto || valueID == CSSValueAvoid || valueID == CSSValueAvoidPage || valueID == CSSValueAvoidColumn;
 620     case CSSPropertyPointerEvents:
 621         // none | visiblePainted | visibleFill | visibleStroke | visible |
 622         // painted | fill | stroke | auto | all | bounding-box
 623         return valueID == CSSValueVisible || valueID == CSSValueNone || valueID == CSSValueAll || valueID == CSSValueAuto || (valueID &gt;= CSSValueVisiblePainted &amp;&amp; valueID &lt;= CSSValueStroke);
 624     case CSSPropertyPosition: // static | relative | absolute | fixed | sticky
<span class="line-modified"> 625         return valueID == CSSValueStatic || valueID == CSSValueRelative || valueID == CSSValueAbsolute || valueID == CSSValueFixed || valueID == CSSValueWebkitSticky;</span>




 626     case CSSPropertyResize: // none | both | horizontal | vertical | auto
 627         return valueID == CSSValueNone || valueID == CSSValueBoth || valueID == CSSValueHorizontal || valueID == CSSValueVertical || valueID == CSSValueAuto;
 628     // FIXME-NEWPARSER: Investigate this property.
 629     // case CSSPropertyScrollBehavior: // auto | smooth
 630     //     ASSERT(RuntimeEnabledFeatures::cssomSmoothScrollEnabled());
 631     //   return valueID == CSSValueAuto || valueID == CSSValueSmooth;
 632     case CSSPropertyShapeRendering:
 633         return valueID == CSSValueAuto || valueID == CSSValueOptimizeSpeed || valueID == CSSValueCrispedges || valueID == CSSValueGeometricPrecision;
 634     case CSSPropertyStrokeLinejoin:
 635         return valueID == CSSValueMiter || valueID == CSSValueRound || valueID == CSSValueBevel;
 636     case CSSPropertyStrokeLinecap:
 637         return valueID == CSSValueButt || valueID == CSSValueRound || valueID == CSSValueSquare;
 638     case CSSPropertyTableLayout: // auto | fixed
 639         return valueID == CSSValueAuto || valueID == CSSValueFixed;
 640     case CSSPropertyTextAlign:
 641         return (valueID &gt;= CSSValueWebkitAuto &amp;&amp; valueID &lt;= CSSValueWebkitMatchParent) || valueID == CSSValueStart || valueID == CSSValueEnd;
 642 #if ENABLE(CSS3_TEXT)
 643     case CSSPropertyWebkitTextAlignLast:
 644         // auto | start | end | left | right | center | justify
 645         return (valueID &gt;= CSSValueLeft &amp;&amp; valueID &lt;= CSSValueJustify) || valueID == CSSValueStart || valueID == CSSValueEnd || valueID == CSSValueAuto;
</pre>
<hr />
<pre>
 705         return valueID == CSSValueAuto || valueID == CSSValueAutoHide;
 706 #endif
 707     case CSSPropertyColumnFill:
 708         return valueID == CSSValueAuto || valueID == CSSValueBalance;
 709     case CSSPropertyWebkitColumnAxis:
 710         return valueID == CSSValueHorizontal || valueID == CSSValueVertical || valueID == CSSValueAuto;
 711     case CSSPropertyWebkitColumnProgression:
 712         return valueID == CSSValueNormal || valueID == CSSValueReverse;
 713     case CSSPropertyFlexDirection:
 714         return valueID == CSSValueRow || valueID == CSSValueRowReverse || valueID == CSSValueColumn || valueID == CSSValueColumnReverse;
 715     case CSSPropertyFlexWrap:
 716         return valueID == CSSValueNowrap || valueID == CSSValueWrap || valueID == CSSValueWrapReverse;
 717     case CSSPropertyWebkitHyphens:
 718         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueManual;
 719     case CSSPropertyWebkitFontKerning:
 720         return valueID == CSSValueAuto || valueID == CSSValueNormal || valueID == CSSValueNone;
 721     case CSSPropertyWebkitFontSmoothing:
 722         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueAntialiased || valueID == CSSValueSubpixelAntialiased;
 723     case CSSPropertyWebkitLineAlign:
 724         return valueID == CSSValueNone || valueID == CSSValueEdges;
<span class="line-modified"> 725     case CSSPropertyLineBreak: // auto | loose | normal | strict | after-white-space</span>
<span class="line-modified"> 726         return valueID == CSSValueAuto || valueID == CSSValueLoose || valueID == CSSValueNormal || valueID == CSSValueStrict || valueID == CSSValueAfterWhiteSpace;</span>
 727     case CSSPropertyWebkitLineSnap:
 728         return valueID == CSSValueNone || valueID == CSSValueBaseline || valueID == CSSValueContain;
 729     case CSSPropertyWebkitMarginAfterCollapse:
 730     case CSSPropertyWebkitMarginBeforeCollapse:
 731     case CSSPropertyWebkitMarginBottomCollapse:
 732     case CSSPropertyWebkitMarginTopCollapse:
 733         return valueID == CSSValueCollapse || valueID == CSSValueSeparate || valueID == CSSValueDiscard;
 734     case CSSPropertyWebkitPrintColorAdjust:
 735         return valueID == CSSValueExact || valueID == CSSValueEconomy;
 736     case CSSPropertyWebkitRtlOrdering:
 737         return valueID == CSSValueLogical || valueID == CSSValueVisual;
 738     case CSSPropertyWebkitRubyPosition:
 739         return valueID == CSSValueBefore || valueID == CSSValueAfter || valueID == CSSValueInterCharacter;
 740     case CSSPropertyWebkitTextCombine:
 741         return valueID == CSSValueNone || valueID == CSSValueHorizontal;
 742     case CSSPropertyWebkitTextSecurity: // disc | circle | square | none
 743         return valueID == CSSValueDisc || valueID == CSSValueCircle || valueID == CSSValueSquare || valueID == CSSValueNone;
 744     case CSSPropertyTransformStyle:
 745     case CSSPropertyWebkitTransformStyle:
 746         return valueID == CSSValueFlat || valueID == CSSValuePreserve3d;
 747     case CSSPropertyWebkitUserDrag: // auto | none | element
 748         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueElement;
 749     case CSSPropertyWebkitUserModify: // read-only | read-write
 750         return valueID == CSSValueReadOnly || valueID == CSSValueReadWrite || valueID == CSSValueReadWritePlaintextOnly;
 751     case CSSPropertyWebkitUserSelect: // auto | none | text | all
 752         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueText || valueID == CSSValueAll;
 753     case CSSPropertyWritingMode:
 754         // Note that horizontal-bt is not supported by the unprefixed version of
 755         // the property, only by the -webkit- version.
 756         return (valueID &gt;= CSSValueHorizontalTb &amp;&amp; valueID &lt;= CSSValueHorizontalBt)
 757             || valueID == CSSValueLrTb || valueID == CSSValueRlTb || valueID == CSSValueTbRl
 758             || valueID == CSSValueLr || valueID == CSSValueRl || valueID == CSSValueTb;
<span class="line-modified"> 759     case CSSPropertyWhiteSpace: // normal | pre | nowrap</span>
<span class="line-modified"> 760         return valueID == CSSValueNormal || valueID == CSSValuePre || valueID == CSSValuePreWrap || valueID == CSSValuePreLine || valueID == CSSValueNowrap;</span>
 761     case CSSPropertyWordBreak: // normal | break-all | keep-all | break-word (this is a custom extension)
 762         return valueID == CSSValueNormal || valueID == CSSValueBreakAll || valueID == CSSValueKeepAll || valueID == CSSValueBreakWord;
 763     case CSSPropertyWebkitBorderFit:
 764         return valueID == CSSValueBorder || valueID == CSSValueLines;
 765 #if ENABLE(CSS_TRAILING_WORD)
 766     case CSSPropertyAppleTrailingWord: // auto | -apple-partially-balanced
 767         return valueID == CSSValueAuto || valueID == CSSValueWebkitPartiallyBalanced;
 768 #endif
 769 #if ENABLE(APPLE_PAY)
 770     case CSSPropertyApplePayButtonStyle: // white | white-outline | black
 771         return valueID == CSSValueWhite || valueID == CSSValueWhiteOutline || valueID == CSSValueBlack;
 772     case CSSPropertyApplePayButtonType: // plain | buy | set-up | donate
 773         if (valueID == CSSValuePlain || valueID == CSSValueBuy || valueID == CSSValueSetUp || valueID == CSSValueDonate)
 774             return true;
 775 #if ENABLE(APPLE_PAY_SESSION_V4)
 776         // check-out | book | subscribe
 777         return valueID == CSSValueCheckOut || valueID == CSSValueBook || valueID == CSSValueSubscribe;
 778 #else
 779         return false;
 780 #endif
</pre>
<hr />
<pre>
 783         return valueID == CSSValueNormal || valueID == CSSValueSpace;
 784     case CSSPropertyWebkitTextZoom:
 785         return valueID == CSSValueNormal || valueID == CSSValueReset;
 786 #if PLATFORM(IOS_FAMILY)
 787     // Apple specific property. These will never be standardized and is purely to
 788     // support custom WebKit-based Apple applications.
 789     case CSSPropertyWebkitTouchCallout:
 790         return valueID == CSSValueDefault || valueID == CSSValueNone;
 791 #endif
 792     case CSSPropertyWebkitMarqueeDirection:
 793         return valueID == CSSValueForwards || valueID == CSSValueBackwards || valueID == CSSValueAhead || valueID == CSSValueReverse || valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueDown
 794             || valueID == CSSValueUp || valueID == CSSValueAuto;
 795     case CSSPropertyWebkitMarqueeStyle:
 796         return valueID == CSSValueNone || valueID == CSSValueSlide || valueID == CSSValueScroll || valueID == CSSValueAlternate;
 797     case CSSPropertyFontVariantPosition: // normal | sub | super
 798         return valueID == CSSValueNormal || valueID == CSSValueSub || valueID == CSSValueSuper;
 799     case CSSPropertyFontVariantCaps: // normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps
 800         return valueID == CSSValueNormal || valueID == CSSValueSmallCaps || valueID == CSSValueAllSmallCaps || valueID == CSSValuePetiteCaps || valueID == CSSValueAllPetiteCaps || valueID == CSSValueUnicase || valueID == CSSValueTitlingCaps;
 801     case CSSPropertyFontVariantAlternates: // We only support the normal and historical-forms values.
 802         return valueID == CSSValueNormal || valueID == CSSValueHistoricalForms;
<span class="line-modified"> 803 #if ENABLE(ACCELERATED_OVERFLOW_SCROLLING)</span>
 804     case CSSPropertyWebkitOverflowScrolling:


 805         return valueID == CSSValueAuto || valueID == CSSValueTouch;
 806 #endif
 807 #if ENABLE(VARIATION_FONTS)
 808     case CSSPropertyFontOpticalSizing:
 809         return valueID == CSSValueAuto || valueID == CSSValueNone;
 810 #endif
 811     default:
 812         ASSERT_NOT_REACHED();
 813         return false;
 814     }
 815 }
 816 
 817 bool CSSParserFastPaths::isKeywordPropertyID(CSSPropertyID propertyId)
 818 {
 819     switch (propertyId) {
 820     case CSSPropertyBorderBlockEndStyle:
 821     case CSSPropertyBorderBlockStartStyle:
 822     case CSSPropertyBorderBottomStyle:
 823     case CSSPropertyBorderCollapse:
 824     case CSSPropertyBorderInlineEndStyle:
</pre>
<hr />
<pre>
 930     // case CSSPropertyScrollSnapType:
 931     // case CSSPropertyTextAlignLast:
 932     // case CSSPropertyTextCombineUpright:
 933     // case CSSPropertyTextDecorationStyle:
 934     // case CSSPropertyTextJustify:
 935     // case CSSPropertyTextOrientation:
 936     // case CSSPropertyUserSelect:
 937 #if ENABLE(CSS_TRAILING_WORD)
 938     case CSSPropertyAppleTrailingWord:
 939 #endif
 940 #if ENABLE(CSS_COMPOSITING)
 941     case CSSPropertyIsolation:
 942     case CSSPropertyMixBlendMode:
 943 #endif
 944 #if ENABLE(CSS_BOX_DECORATION_BREAK)
 945     case CSSPropertyWebkitBoxDecorationBreak:
 946 #endif
 947 #if ENABLE(CURSOR_VISIBILITY)
 948     case CSSPropertyWebkitCursorVisibility:
 949 #endif
<span class="line-modified"> 950 #if ENABLE(ACCELERATED_OVERFLOW_SCROLLING)</span>
 951     case CSSPropertyWebkitOverflowScrolling:
 952 #endif
 953 #if ENABLE(CSS3_TEXT)
 954     case CSSPropertyWebkitTextAlignLast:
 955     case CSSPropertyWebkitTextJustify:
 956 #endif
 957 #if PLATFORM(IOS_FAMILY)
 958     // Apple specific property. This will never be standardized and is purely to
 959     // support custom WebKit-based Apple applications.
 960     case CSSPropertyWebkitTouchCallout:
 961 #endif
 962 #if ENABLE(APPLE_PAY)
 963     case CSSPropertyApplePayButtonStyle:
 964     case CSSPropertyApplePayButtonType:
 965 #endif
 966 #if ENABLE(VARIATION_FONTS)
 967     case CSSPropertyFontOpticalSizing:
 968 #endif
 969         return true;
 970     default:
 971         return false;
 972     }
 973 }
 974 
 975 static bool isUniversalKeyword(const String&amp; string)
 976 {
 977     // These keywords can be used for all properties.
 978     return equalLettersIgnoringASCIICase(string, &quot;initial&quot;)
 979     || equalLettersIgnoringASCIICase(string, &quot;inherit&quot;)
 980     || equalLettersIgnoringASCIICase(string, &quot;unset&quot;)
 981     || equalLettersIgnoringASCIICase(string, &quot;revert&quot;);
 982 }
 983 
<span class="line-modified"> 984 static RefPtr&lt;CSSValue&gt; parseKeywordValue(CSSPropertyID propertyId, const String&amp; string, CSSParserMode parserMode)</span>
 985 {
 986     ASSERT(!string.isEmpty());
 987 
 988     if (!CSSParserFastPaths::isKeywordPropertyID(propertyId)) {
 989         // All properties accept the values of &quot;initial&quot; and &quot;inherit&quot;.
 990         if (!isUniversalKeyword(string))
 991             return nullptr;
 992 
 993         // Parse initial/inherit shorthands using the CSSPropertyParser.
 994         if (shorthandForProperty(propertyId).length())
 995             return nullptr;
 996 
 997         // Descriptors do not support css wide keywords.
 998         if (CSSProperty::isDescriptorOnly(propertyId))
 999             return nullptr;
1000     }
1001 
1002     CSSValueID valueID = cssValueKeywordID(string);
1003 
1004     if (!valueID)
1005         return nullptr;
1006 
1007     if (valueID == CSSValueInherit)
1008         return CSSValuePool::singleton().createInheritedValue();
1009     if (valueID == CSSValueInitial)
1010         return CSSValuePool::singleton().createExplicitInitialValue();
1011     if (valueID == CSSValueUnset)
1012         return CSSValuePool::singleton().createUnsetValue();
1013     if (valueID == CSSValueRevert)
1014         return CSSValuePool::singleton().createRevertValue();
1015 
<span class="line-modified">1016     if (CSSParserFastPaths::isValidKeywordPropertyAndValue(propertyId, valueID, parserMode))</span>
1017         return CSSPrimitiveValue::createIdentifier(valueID);
1018     return nullptr;
1019 }
1020 
1021 template &lt;typename CharType&gt;
1022 static bool parseTransformTranslateArguments(CharType*&amp; pos, CharType* end, unsigned expectedCount, CSSFunctionValue* transformValue)
1023 {
1024     while (expectedCount) {
1025         size_t delimiter = WTF::find(pos, end - pos, expectedCount == 1 ? &#39;)&#39; : &#39;,&#39;);
1026         if (delimiter == notFound)
1027             return false;
1028         unsigned argumentLength = static_cast&lt;unsigned&gt;(delimiter);
1029         CSSPrimitiveValue::UnitType unit = CSSPrimitiveValue::UnitType::CSS_NUMBER;
1030         double number;
1031         if (!parseSimpleLength(pos, argumentLength, unit, number))
1032             return false;
1033         if (!number &amp;&amp; unit == CSSPrimitiveValue::CSS_NUMBER)
1034             unit = CSSPrimitiveValue::UnitType::CSS_PX;
1035         if (unit == CSSPrimitiveValue::UnitType::CSS_NUMBER || (unit == CSSPrimitiveValue::UnitType::CSS_PERCENTAGE &amp;&amp; (transformValue-&gt;name() == CSSValueTranslateZ || (transformValue-&gt;name() == CSSValueTranslate3d &amp;&amp; expectedCount == 1))))
1036             return false;
</pre>
<hr />
<pre>
1275 
1276 static RefPtr&lt;CSSValue&gt; parseSimpleTransform(CSSPropertyID propertyID, const String&amp; string)
1277 {
1278     ASSERT(!string.isEmpty());
1279     if (propertyID != CSSPropertyTransform)
1280         return nullptr;
1281     if (string.is8Bit())
1282         return parseSimpleTransformList(string.characters8(), string.length());
1283     return parseSimpleTransformList(string.characters16(), string.length());
1284 }
1285 
1286 static RefPtr&lt;CSSValue&gt; parseCaretColor(const String&amp; string, CSSParserMode parserMode)
1287 {
1288     ASSERT(!string.isEmpty());
1289     CSSValueID valueID = cssValueKeywordID(string);
1290     if (valueID == CSSValueAuto)
1291         return CSSValuePool::singleton().createIdentifierValue(valueID);
1292     return CSSParserFastPaths::parseColor(string, parserMode);
1293 }
1294 
<span class="line-modified">1295 RefPtr&lt;CSSValue&gt; CSSParserFastPaths::maybeParseValue(CSSPropertyID propertyID, const String&amp; string, CSSParserMode parserMode)</span>
1296 {
<span class="line-modified">1297     if (auto result = parseSimpleLengthValue(propertyID, string, parserMode))</span>
1298         return result;
1299     if (propertyID == CSSPropertyCaretColor)
<span class="line-modified">1300         return parseCaretColor(string, parserMode);</span>
1301     if (isColorPropertyID(propertyID))
<span class="line-modified">1302         return parseColor(string, parserMode);</span>
<span class="line-modified">1303     if (auto result = parseKeywordValue(propertyID, string, parserMode))</span>
1304         return result;
1305     return parseSimpleTransform(propertyID, string);
1306 }
1307 
1308 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
  14 //    * Neither the name of Google Inc. nor the names of its
  15 // contributors may be used to endorse or promote products derived from
  16 // this software without specific prior written permission.
  17 //
  18 // THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  19 // &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  20 // LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  21 // A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
  22 // OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  23 // SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  24 // LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  25 // DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  26 // THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  27 // (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  28 // OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
  29 
  30 #include &quot;config.h&quot;
  31 #include &quot;CSSParserFastPaths.h&quot;
  32 
  33 #include &quot;CSSFunctionValue.h&quot;
<span class="line-added">  34 #include &quot;CSSParserContext.h&quot;</span>
  35 #include &quot;CSSParserIdioms.h&quot;
  36 #include &quot;CSSPrimitiveValue.h&quot;
  37 #include &quot;CSSPropertyParser.h&quot;
  38 #include &quot;CSSValueList.h&quot;
  39 #include &quot;CSSValuePool.h&quot;
  40 #include &quot;HTMLParserIdioms.h&quot;
  41 #include &quot;RuntimeEnabledFeatures.h&quot;
  42 #include &quot;StyleColor.h&quot;
  43 #include &quot;StylePropertyShorthand.h&quot;
  44 
  45 namespace WebCore {
  46 
  47 static inline bool isSimpleLengthPropertyID(CSSPropertyID propertyId, bool&amp; acceptsNegativeNumbers)
  48 {
  49     switch (propertyId) {
  50     case CSSPropertyFontSize:
  51     case CSSPropertyHeight:
  52     case CSSPropertyWidth:
  53     case CSSPropertyMinHeight:
  54     case CSSPropertyMinWidth:
</pre>
<hr />
<pre>
 503     CSSValueID valueID = cssValueKeywordID(string);
 504     if (StyleColor::isColorKeyword(valueID)) {
 505         if (!isValueAllowedInMode(valueID, parserMode))
 506             return nullptr;
 507         return CSSValuePool::singleton().createIdentifierValue(valueID);
 508     }
 509 
 510     bool quirksMode = isQuirksModeBehavior(parserMode);
 511 
 512     // Fast path for hex colors and rgb()/rgba() colors
 513     Color color;
 514     if (string.is8Bit())
 515         color = fastParseColorInternal(string.characters8(), string.length(), quirksMode);
 516     else
 517         color = fastParseColorInternal(string.characters16(), string.length(), quirksMode);
 518     if (!color.isValid())
 519         return nullptr;
 520     return CSSValuePool::singleton().createColorValue(color);
 521 }
 522 
<span class="line-modified"> 523 bool CSSParserFastPaths::isValidKeywordPropertyAndValue(CSSPropertyID propertyId, CSSValueID valueID, const CSSParserContext&amp; context)</span>
 524 {
<span class="line-modified"> 525 #if !ENABLE(OVERFLOW_SCROLLING_TOUCH)</span>
<span class="line-added"> 526     UNUSED_PARAM(context);</span>
<span class="line-added"> 527 #endif</span>
<span class="line-added"> 528 </span>
<span class="line-added"> 529     if (valueID == CSSValueInvalid || !isValueAllowedInMode(valueID, context.mode))</span>
 530         return false;
 531 
 532     switch (propertyId) {
 533     case CSSPropertyAlignmentBaseline:
 534         // auto | baseline | before-edge | text-before-edge | middle |
 535         // central | after-edge | text-after-edge | ideographic | alphabetic |
 536         // hanging | mathematical
 537         return valueID == CSSValueAuto || valueID == CSSValueAlphabetic || valueID == CSSValueBaseline
 538             || valueID == CSSValueMiddle || (valueID &gt;= CSSValueBeforeEdge &amp;&amp; valueID &lt;= CSSValueMathematical);
 539     case CSSPropertyAll:
 540         return false; // Only accepts css-wide keywords
 541     case CSSPropertyBackgroundRepeatX: // repeat | no-repeat
 542     case CSSPropertyBackgroundRepeatY: // repeat | no-repeat
 543         return valueID == CSSValueRepeat || valueID == CSSValueNoRepeat;
 544     case CSSPropertyBorderCollapse: // collapse | separate
 545         return valueID == CSSValueCollapse || valueID == CSSValueSeparate;
 546     case CSSPropertyBorderTopStyle: // &lt;border-style&gt;
 547     case CSSPropertyBorderRightStyle: // Defined as: none | hidden | dotted | dashed |
 548     case CSSPropertyBorderBottomStyle: // solid | double | groove | ridge | inset | outset
 549     case CSSPropertyBorderLeftStyle:
</pre>
<hr />
<pre>
 560     case CSSPropertyCaptionSide: // top | bottom | left | right
 561         return valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueTop || valueID == CSSValueBottom;
 562     case CSSPropertyClear: // none | left | right | both
 563         return valueID == CSSValueNone || valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueBoth;
 564     case CSSPropertyClipRule:
 565     case CSSPropertyFillRule:
 566         return valueID == CSSValueNonzero || valueID == CSSValueEvenodd;
 567     case CSSPropertyColorInterpolation:
 568     case CSSPropertyColorInterpolationFilters:
 569         return valueID == CSSValueAuto || valueID == CSSValueSRGB || valueID == CSSValueLinearRGB;
 570     case CSSPropertyColorRendering:
 571         return valueID == CSSValueAuto || valueID == CSSValueOptimizeSpeed || valueID == CSSValueOptimizeQuality;
 572     case CSSPropertyDirection: // ltr | rtl
 573         return valueID == CSSValueLtr || valueID == CSSValueRtl;
 574     case CSSPropertyDisplay:
 575         // inline | block | list-item | inline-block | table |
 576         // inline-table | table-row-group | table-header-group | table-footer-group | table-row |
 577         // table-column-group | table-column | table-cell | table-caption | -webkit-box | -webkit-inline-box | none
 578         // flex | inline-flex | -webkit-flex | -webkit-inline-flex | grid | inline-grid
 579         return (valueID &gt;= CSSValueInline &amp;&amp; valueID &lt;= CSSValueContents) || valueID == CSSValueNone
<span class="line-modified"> 580             || valueID == CSSValueGrid || valueID == CSSValueInlineGrid || valueID == CSSValueFlowRoot;</span>
 581     case CSSPropertyDominantBaseline:
 582         // auto | use-script | no-change | reset-size | ideographic |
 583         // alphabetic | hanging | mathematical | central | middle |
 584         // text-after-edge | text-before-edge
 585         return valueID == CSSValueAuto || valueID == CSSValueAlphabetic || valueID == CSSValueMiddle
 586             || (valueID &gt;= CSSValueUseScript &amp;&amp; valueID &lt;= CSSValueResetSize)
 587             || (valueID &gt;= CSSValueCentral &amp;&amp; valueID &lt;= CSSValueMathematical);
 588     case CSSPropertyEmptyCells: // show | hide
 589         return valueID == CSSValueShow || valueID == CSSValueHide;
 590     case CSSPropertyFloat: // left | right | none
 591         return valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueNone;
 592     case CSSPropertyImageRendering: // auto | optimizeContrast | pixelated | optimizeSpeed | crispEdges | optimizeQuality | webkit-crispEdges
 593         return valueID == CSSValueAuto || valueID == CSSValueOptimizeSpeed || valueID == CSSValueOptimizeQuality || valueID == CSSValueWebkitCrispEdges || valueID == CSSValueWebkitOptimizeContrast || valueID == CSSValueCrispEdges || valueID == CSSValuePixelated;
 594 #if ENABLE(CSS_COMPOSITING)
 595     case CSSPropertyIsolation: // auto | isolate
 596         return valueID == CSSValueAuto || valueID == CSSValueIsolate;
 597 #endif
 598     case CSSPropertyListStylePosition: // inside | outside
 599         return valueID == CSSValueInside || valueID == CSSValueOutside;
 600     case CSSPropertyListStyleType:
</pre>
<hr />
<pre>
 610     // FIXME-NEWPARSER: Support?
 611     // case CSSPropertyOverflowAnchor:
 612     //    return valueID == CSSValueVisible || valueID == CSSValueNone || valueID == CSSValueAuto;
 613     case CSSPropertyOverflowWrap: // normal | break-word
 614     case CSSPropertyWordWrap:
 615         return valueID == CSSValueNormal || valueID == CSSValueBreakWord;
 616     case CSSPropertyOverflowX: // visible | hidden | scroll | auto | overlay (overlay is a synonym for auto)
 617         return valueID == CSSValueVisible || valueID == CSSValueHidden || valueID == CSSValueScroll || valueID == CSSValueAuto || valueID == CSSValueOverlay;
 618     case CSSPropertyOverflowY: // visible | hidden | scroll | auto | overlay | -webkit-paged-x | -webkit-paged-y (overlay is a synonym for auto)
 619         return valueID == CSSValueVisible || valueID == CSSValueHidden || valueID == CSSValueScroll || valueID == CSSValueAuto || valueID == CSSValueOverlay || valueID == CSSValueWebkitPagedX || valueID == CSSValueWebkitPagedY;
 620     case CSSPropertyBreakAfter:
 621     case CSSPropertyBreakBefore:
 622         return valueID == CSSValueAuto || valueID == CSSValueAvoid || valueID == CSSValueAvoidPage || valueID == CSSValuePage || valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueRecto || valueID == CSSValueVerso || valueID == CSSValueAvoidColumn || valueID == CSSValueColumn;
 623     case CSSPropertyBreakInside:
 624         return valueID == CSSValueAuto || valueID == CSSValueAvoid || valueID == CSSValueAvoidPage || valueID == CSSValueAvoidColumn;
 625     case CSSPropertyPointerEvents:
 626         // none | visiblePainted | visibleFill | visibleStroke | visible |
 627         // painted | fill | stroke | auto | all | bounding-box
 628         return valueID == CSSValueVisible || valueID == CSSValueNone || valueID == CSSValueAll || valueID == CSSValueAuto || (valueID &gt;= CSSValueVisiblePainted &amp;&amp; valueID &lt;= CSSValueStroke);
 629     case CSSPropertyPosition: // static | relative | absolute | fixed | sticky
<span class="line-modified"> 630         return valueID == CSSValueStatic</span>
<span class="line-added"> 631             || valueID == CSSValueRelative</span>
<span class="line-added"> 632             || valueID == CSSValueAbsolute</span>
<span class="line-added"> 633             || valueID == CSSValueFixed</span>
<span class="line-added"> 634             || valueID == CSSValueSticky || valueID == CSSValueWebkitSticky;</span>
 635     case CSSPropertyResize: // none | both | horizontal | vertical | auto
 636         return valueID == CSSValueNone || valueID == CSSValueBoth || valueID == CSSValueHorizontal || valueID == CSSValueVertical || valueID == CSSValueAuto;
 637     // FIXME-NEWPARSER: Investigate this property.
 638     // case CSSPropertyScrollBehavior: // auto | smooth
 639     //     ASSERT(RuntimeEnabledFeatures::cssomSmoothScrollEnabled());
 640     //   return valueID == CSSValueAuto || valueID == CSSValueSmooth;
 641     case CSSPropertyShapeRendering:
 642         return valueID == CSSValueAuto || valueID == CSSValueOptimizeSpeed || valueID == CSSValueCrispedges || valueID == CSSValueGeometricPrecision;
 643     case CSSPropertyStrokeLinejoin:
 644         return valueID == CSSValueMiter || valueID == CSSValueRound || valueID == CSSValueBevel;
 645     case CSSPropertyStrokeLinecap:
 646         return valueID == CSSValueButt || valueID == CSSValueRound || valueID == CSSValueSquare;
 647     case CSSPropertyTableLayout: // auto | fixed
 648         return valueID == CSSValueAuto || valueID == CSSValueFixed;
 649     case CSSPropertyTextAlign:
 650         return (valueID &gt;= CSSValueWebkitAuto &amp;&amp; valueID &lt;= CSSValueWebkitMatchParent) || valueID == CSSValueStart || valueID == CSSValueEnd;
 651 #if ENABLE(CSS3_TEXT)
 652     case CSSPropertyWebkitTextAlignLast:
 653         // auto | start | end | left | right | center | justify
 654         return (valueID &gt;= CSSValueLeft &amp;&amp; valueID &lt;= CSSValueJustify) || valueID == CSSValueStart || valueID == CSSValueEnd || valueID == CSSValueAuto;
</pre>
<hr />
<pre>
 714         return valueID == CSSValueAuto || valueID == CSSValueAutoHide;
 715 #endif
 716     case CSSPropertyColumnFill:
 717         return valueID == CSSValueAuto || valueID == CSSValueBalance;
 718     case CSSPropertyWebkitColumnAxis:
 719         return valueID == CSSValueHorizontal || valueID == CSSValueVertical || valueID == CSSValueAuto;
 720     case CSSPropertyWebkitColumnProgression:
 721         return valueID == CSSValueNormal || valueID == CSSValueReverse;
 722     case CSSPropertyFlexDirection:
 723         return valueID == CSSValueRow || valueID == CSSValueRowReverse || valueID == CSSValueColumn || valueID == CSSValueColumnReverse;
 724     case CSSPropertyFlexWrap:
 725         return valueID == CSSValueNowrap || valueID == CSSValueWrap || valueID == CSSValueWrapReverse;
 726     case CSSPropertyWebkitHyphens:
 727         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueManual;
 728     case CSSPropertyWebkitFontKerning:
 729         return valueID == CSSValueAuto || valueID == CSSValueNormal || valueID == CSSValueNone;
 730     case CSSPropertyWebkitFontSmoothing:
 731         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueAntialiased || valueID == CSSValueSubpixelAntialiased;
 732     case CSSPropertyWebkitLineAlign:
 733         return valueID == CSSValueNone || valueID == CSSValueEdges;
<span class="line-modified"> 734     case CSSPropertyLineBreak: // auto | loose | normal | strict | after-white-space | anywhere</span>
<span class="line-modified"> 735         return valueID == CSSValueAuto || valueID == CSSValueLoose || valueID == CSSValueNormal || valueID == CSSValueStrict || valueID == CSSValueAfterWhiteSpace || valueID == CSSValueAnywhere;</span>
 736     case CSSPropertyWebkitLineSnap:
 737         return valueID == CSSValueNone || valueID == CSSValueBaseline || valueID == CSSValueContain;
 738     case CSSPropertyWebkitMarginAfterCollapse:
 739     case CSSPropertyWebkitMarginBeforeCollapse:
 740     case CSSPropertyWebkitMarginBottomCollapse:
 741     case CSSPropertyWebkitMarginTopCollapse:
 742         return valueID == CSSValueCollapse || valueID == CSSValueSeparate || valueID == CSSValueDiscard;
 743     case CSSPropertyWebkitPrintColorAdjust:
 744         return valueID == CSSValueExact || valueID == CSSValueEconomy;
 745     case CSSPropertyWebkitRtlOrdering:
 746         return valueID == CSSValueLogical || valueID == CSSValueVisual;
 747     case CSSPropertyWebkitRubyPosition:
 748         return valueID == CSSValueBefore || valueID == CSSValueAfter || valueID == CSSValueInterCharacter;
 749     case CSSPropertyWebkitTextCombine:
 750         return valueID == CSSValueNone || valueID == CSSValueHorizontal;
 751     case CSSPropertyWebkitTextSecurity: // disc | circle | square | none
 752         return valueID == CSSValueDisc || valueID == CSSValueCircle || valueID == CSSValueSquare || valueID == CSSValueNone;
 753     case CSSPropertyTransformStyle:
 754     case CSSPropertyWebkitTransformStyle:
 755         return valueID == CSSValueFlat || valueID == CSSValuePreserve3d;
 756     case CSSPropertyWebkitUserDrag: // auto | none | element
 757         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueElement;
 758     case CSSPropertyWebkitUserModify: // read-only | read-write
 759         return valueID == CSSValueReadOnly || valueID == CSSValueReadWrite || valueID == CSSValueReadWritePlaintextOnly;
 760     case CSSPropertyWebkitUserSelect: // auto | none | text | all
 761         return valueID == CSSValueAuto || valueID == CSSValueNone || valueID == CSSValueText || valueID == CSSValueAll;
 762     case CSSPropertyWritingMode:
 763         // Note that horizontal-bt is not supported by the unprefixed version of
 764         // the property, only by the -webkit- version.
 765         return (valueID &gt;= CSSValueHorizontalTb &amp;&amp; valueID &lt;= CSSValueHorizontalBt)
 766             || valueID == CSSValueLrTb || valueID == CSSValueRlTb || valueID == CSSValueTbRl
 767             || valueID == CSSValueLr || valueID == CSSValueRl || valueID == CSSValueTb;
<span class="line-modified"> 768     case CSSPropertyWhiteSpace: // normal | pre | nowrap | pre-line | nowrap | break-spacess</span>
<span class="line-modified"> 769         return valueID == CSSValueNormal || valueID == CSSValuePre || valueID == CSSValuePreWrap || valueID == CSSValuePreLine || valueID == CSSValueNowrap || valueID == CSSValueBreakSpaces;</span>
 770     case CSSPropertyWordBreak: // normal | break-all | keep-all | break-word (this is a custom extension)
 771         return valueID == CSSValueNormal || valueID == CSSValueBreakAll || valueID == CSSValueKeepAll || valueID == CSSValueBreakWord;
 772     case CSSPropertyWebkitBorderFit:
 773         return valueID == CSSValueBorder || valueID == CSSValueLines;
 774 #if ENABLE(CSS_TRAILING_WORD)
 775     case CSSPropertyAppleTrailingWord: // auto | -apple-partially-balanced
 776         return valueID == CSSValueAuto || valueID == CSSValueWebkitPartiallyBalanced;
 777 #endif
 778 #if ENABLE(APPLE_PAY)
 779     case CSSPropertyApplePayButtonStyle: // white | white-outline | black
 780         return valueID == CSSValueWhite || valueID == CSSValueWhiteOutline || valueID == CSSValueBlack;
 781     case CSSPropertyApplePayButtonType: // plain | buy | set-up | donate
 782         if (valueID == CSSValuePlain || valueID == CSSValueBuy || valueID == CSSValueSetUp || valueID == CSSValueDonate)
 783             return true;
 784 #if ENABLE(APPLE_PAY_SESSION_V4)
 785         // check-out | book | subscribe
 786         return valueID == CSSValueCheckOut || valueID == CSSValueBook || valueID == CSSValueSubscribe;
 787 #else
 788         return false;
 789 #endif
</pre>
<hr />
<pre>
 792         return valueID == CSSValueNormal || valueID == CSSValueSpace;
 793     case CSSPropertyWebkitTextZoom:
 794         return valueID == CSSValueNormal || valueID == CSSValueReset;
 795 #if PLATFORM(IOS_FAMILY)
 796     // Apple specific property. These will never be standardized and is purely to
 797     // support custom WebKit-based Apple applications.
 798     case CSSPropertyWebkitTouchCallout:
 799         return valueID == CSSValueDefault || valueID == CSSValueNone;
 800 #endif
 801     case CSSPropertyWebkitMarqueeDirection:
 802         return valueID == CSSValueForwards || valueID == CSSValueBackwards || valueID == CSSValueAhead || valueID == CSSValueReverse || valueID == CSSValueLeft || valueID == CSSValueRight || valueID == CSSValueDown
 803             || valueID == CSSValueUp || valueID == CSSValueAuto;
 804     case CSSPropertyWebkitMarqueeStyle:
 805         return valueID == CSSValueNone || valueID == CSSValueSlide || valueID == CSSValueScroll || valueID == CSSValueAlternate;
 806     case CSSPropertyFontVariantPosition: // normal | sub | super
 807         return valueID == CSSValueNormal || valueID == CSSValueSub || valueID == CSSValueSuper;
 808     case CSSPropertyFontVariantCaps: // normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps
 809         return valueID == CSSValueNormal || valueID == CSSValueSmallCaps || valueID == CSSValueAllSmallCaps || valueID == CSSValuePetiteCaps || valueID == CSSValueAllPetiteCaps || valueID == CSSValueUnicase || valueID == CSSValueTitlingCaps;
 810     case CSSPropertyFontVariantAlternates: // We only support the normal and historical-forms values.
 811         return valueID == CSSValueNormal || valueID == CSSValueHistoricalForms;
<span class="line-modified"> 812 #if ENABLE(OVERFLOW_SCROLLING_TOUCH)</span>
 813     case CSSPropertyWebkitOverflowScrolling:
<span class="line-added"> 814         if (!context.legacyOverflowScrollingTouchEnabled)</span>
<span class="line-added"> 815             return false;</span>
 816         return valueID == CSSValueAuto || valueID == CSSValueTouch;
 817 #endif
 818 #if ENABLE(VARIATION_FONTS)
 819     case CSSPropertyFontOpticalSizing:
 820         return valueID == CSSValueAuto || valueID == CSSValueNone;
 821 #endif
 822     default:
 823         ASSERT_NOT_REACHED();
 824         return false;
 825     }
 826 }
 827 
 828 bool CSSParserFastPaths::isKeywordPropertyID(CSSPropertyID propertyId)
 829 {
 830     switch (propertyId) {
 831     case CSSPropertyBorderBlockEndStyle:
 832     case CSSPropertyBorderBlockStartStyle:
 833     case CSSPropertyBorderBottomStyle:
 834     case CSSPropertyBorderCollapse:
 835     case CSSPropertyBorderInlineEndStyle:
</pre>
<hr />
<pre>
 941     // case CSSPropertyScrollSnapType:
 942     // case CSSPropertyTextAlignLast:
 943     // case CSSPropertyTextCombineUpright:
 944     // case CSSPropertyTextDecorationStyle:
 945     // case CSSPropertyTextJustify:
 946     // case CSSPropertyTextOrientation:
 947     // case CSSPropertyUserSelect:
 948 #if ENABLE(CSS_TRAILING_WORD)
 949     case CSSPropertyAppleTrailingWord:
 950 #endif
 951 #if ENABLE(CSS_COMPOSITING)
 952     case CSSPropertyIsolation:
 953     case CSSPropertyMixBlendMode:
 954 #endif
 955 #if ENABLE(CSS_BOX_DECORATION_BREAK)
 956     case CSSPropertyWebkitBoxDecorationBreak:
 957 #endif
 958 #if ENABLE(CURSOR_VISIBILITY)
 959     case CSSPropertyWebkitCursorVisibility:
 960 #endif
<span class="line-modified"> 961 #if ENABLE(OVERFLOW_SCROLLING_TOUCH)</span>
 962     case CSSPropertyWebkitOverflowScrolling:
 963 #endif
 964 #if ENABLE(CSS3_TEXT)
 965     case CSSPropertyWebkitTextAlignLast:
 966     case CSSPropertyWebkitTextJustify:
 967 #endif
 968 #if PLATFORM(IOS_FAMILY)
 969     // Apple specific property. This will never be standardized and is purely to
 970     // support custom WebKit-based Apple applications.
 971     case CSSPropertyWebkitTouchCallout:
 972 #endif
 973 #if ENABLE(APPLE_PAY)
 974     case CSSPropertyApplePayButtonStyle:
 975     case CSSPropertyApplePayButtonType:
 976 #endif
 977 #if ENABLE(VARIATION_FONTS)
 978     case CSSPropertyFontOpticalSizing:
 979 #endif
 980         return true;
 981     default:
 982         return false;
 983     }
 984 }
 985 
 986 static bool isUniversalKeyword(const String&amp; string)
 987 {
 988     // These keywords can be used for all properties.
 989     return equalLettersIgnoringASCIICase(string, &quot;initial&quot;)
 990     || equalLettersIgnoringASCIICase(string, &quot;inherit&quot;)
 991     || equalLettersIgnoringASCIICase(string, &quot;unset&quot;)
 992     || equalLettersIgnoringASCIICase(string, &quot;revert&quot;);
 993 }
 994 
<span class="line-modified"> 995 static RefPtr&lt;CSSValue&gt; parseKeywordValue(CSSPropertyID propertyId, const String&amp; string, const CSSParserContext&amp; context)</span>
 996 {
 997     ASSERT(!string.isEmpty());
 998 
 999     if (!CSSParserFastPaths::isKeywordPropertyID(propertyId)) {
1000         // All properties accept the values of &quot;initial&quot; and &quot;inherit&quot;.
1001         if (!isUniversalKeyword(string))
1002             return nullptr;
1003 
1004         // Parse initial/inherit shorthands using the CSSPropertyParser.
1005         if (shorthandForProperty(propertyId).length())
1006             return nullptr;
1007 
1008         // Descriptors do not support css wide keywords.
1009         if (CSSProperty::isDescriptorOnly(propertyId))
1010             return nullptr;
1011     }
1012 
1013     CSSValueID valueID = cssValueKeywordID(string);
1014 
1015     if (!valueID)
1016         return nullptr;
1017 
1018     if (valueID == CSSValueInherit)
1019         return CSSValuePool::singleton().createInheritedValue();
1020     if (valueID == CSSValueInitial)
1021         return CSSValuePool::singleton().createExplicitInitialValue();
1022     if (valueID == CSSValueUnset)
1023         return CSSValuePool::singleton().createUnsetValue();
1024     if (valueID == CSSValueRevert)
1025         return CSSValuePool::singleton().createRevertValue();
1026 
<span class="line-modified">1027     if (CSSParserFastPaths::isValidKeywordPropertyAndValue(propertyId, valueID, context))</span>
1028         return CSSPrimitiveValue::createIdentifier(valueID);
1029     return nullptr;
1030 }
1031 
1032 template &lt;typename CharType&gt;
1033 static bool parseTransformTranslateArguments(CharType*&amp; pos, CharType* end, unsigned expectedCount, CSSFunctionValue* transformValue)
1034 {
1035     while (expectedCount) {
1036         size_t delimiter = WTF::find(pos, end - pos, expectedCount == 1 ? &#39;)&#39; : &#39;,&#39;);
1037         if (delimiter == notFound)
1038             return false;
1039         unsigned argumentLength = static_cast&lt;unsigned&gt;(delimiter);
1040         CSSPrimitiveValue::UnitType unit = CSSPrimitiveValue::UnitType::CSS_NUMBER;
1041         double number;
1042         if (!parseSimpleLength(pos, argumentLength, unit, number))
1043             return false;
1044         if (!number &amp;&amp; unit == CSSPrimitiveValue::CSS_NUMBER)
1045             unit = CSSPrimitiveValue::UnitType::CSS_PX;
1046         if (unit == CSSPrimitiveValue::UnitType::CSS_NUMBER || (unit == CSSPrimitiveValue::UnitType::CSS_PERCENTAGE &amp;&amp; (transformValue-&gt;name() == CSSValueTranslateZ || (transformValue-&gt;name() == CSSValueTranslate3d &amp;&amp; expectedCount == 1))))
1047             return false;
</pre>
<hr />
<pre>
1286 
1287 static RefPtr&lt;CSSValue&gt; parseSimpleTransform(CSSPropertyID propertyID, const String&amp; string)
1288 {
1289     ASSERT(!string.isEmpty());
1290     if (propertyID != CSSPropertyTransform)
1291         return nullptr;
1292     if (string.is8Bit())
1293         return parseSimpleTransformList(string.characters8(), string.length());
1294     return parseSimpleTransformList(string.characters16(), string.length());
1295 }
1296 
1297 static RefPtr&lt;CSSValue&gt; parseCaretColor(const String&amp; string, CSSParserMode parserMode)
1298 {
1299     ASSERT(!string.isEmpty());
1300     CSSValueID valueID = cssValueKeywordID(string);
1301     if (valueID == CSSValueAuto)
1302         return CSSValuePool::singleton().createIdentifierValue(valueID);
1303     return CSSParserFastPaths::parseColor(string, parserMode);
1304 }
1305 
<span class="line-modified">1306 RefPtr&lt;CSSValue&gt; CSSParserFastPaths::maybeParseValue(CSSPropertyID propertyID, const String&amp; string, const CSSParserContext&amp; context)</span>
1307 {
<span class="line-modified">1308     if (auto result = parseSimpleLengthValue(propertyID, string, context.mode))</span>
1309         return result;
1310     if (propertyID == CSSPropertyCaretColor)
<span class="line-modified">1311         return parseCaretColor(string, context.mode);</span>
1312     if (isColorPropertyID(propertyID))
<span class="line-modified">1313         return parseColor(string, context.mode);</span>
<span class="line-modified">1314     if (auto result = parseKeywordValue(propertyID, string, context))</span>
1315         return result;
1316     return parseSimpleTransform(propertyID, string);
1317 }
1318 
1319 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="CSSParserContext.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="CSSParserFastPaths.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>