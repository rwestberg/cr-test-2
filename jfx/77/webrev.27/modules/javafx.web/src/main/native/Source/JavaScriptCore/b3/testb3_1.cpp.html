<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>New modules/javafx.web/src/main/native/Source/JavaScriptCore/b3/testb3_1.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 /*
  2  * Copyright (C) 2015-2019 Apple Inc. All rights reserved.
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #include &quot;config.h&quot;
 27 #include &quot;testb3.h&quot;
 28 
 29 #if ENABLE(B3_JIT)
 30 
 31 Lock crashLock;
 32 
 33 bool shouldRun(const char* filter, const char* testName)
 34 {
 35     // FIXME: These tests fail &lt;https://bugs.webkit.org/show_bug.cgi?id=199330&gt;.
 36     if (!filter &amp;&amp; isARM64()) {
 37         for (auto&amp; failingTest : {
 38             &quot;testReportUsedRegistersLateUseFollowedByEarlyDefDoesNotMarkUseAsDead&quot;,
 39             &quot;testNegFloatWithUselessDoubleConversion&quot;,
 40             &quot;testPinRegisters&quot;,
 41         }) {
 42             if (WTF::findIgnoringASCIICaseWithoutLength(testName, failingTest) != WTF::notFound) {
 43                 dataLogLn(&quot;*** Warning: Skipping known-bad test: &quot;, testName);
 44                 return false;
 45             }
 46         }
 47     }
 48     if (!filter &amp;&amp; isX86()) {
 49         for (auto&amp; failingTest : {
 50             &quot;testReportUsedRegistersLateUseFollowedByEarlyDefDoesNotMarkUseAsDead&quot;,
 51         }) {
 52             if (WTF::findIgnoringASCIICaseWithoutLength(testName, failingTest) != WTF::notFound) {
 53                 dataLogLn(&quot;*** Warning: Skipping known-bad test: &quot;, testName);
 54                 return false;
 55             }
 56         }
 57     }
 58     return !filter || WTF::findIgnoringASCIICaseWithoutLength(testName, filter) != WTF::notFound;
 59 }
 60 
 61 template&lt;typename T&gt;
 62 void testRotR(T valueInt, int32_t shift)
 63 {
 64     Procedure proc;
 65     BasicBlock* root = proc.addBlock();
 66 
 67     Value* value = root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0);
 68     if (sizeof(T) == 4)
 69         value = root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), value);
 70 
 71     Value* ammount = root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(),
 72         root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR1));
 73     root-&gt;appendNewControlValue(proc, Return, Origin(),
 74         root-&gt;appendNew&lt;Value&gt;(proc, RotR, Origin(), value, ammount));
 75 
 76     CHECK_EQ(compileAndRun&lt;T&gt;(proc, valueInt, shift), rotateRight(valueInt, shift));
 77 }
 78 
 79 template&lt;typename T&gt;
 80 void testRotL(T valueInt, int32_t shift)
 81 {
 82     Procedure proc;
 83     BasicBlock* root = proc.addBlock();
 84 
 85     Value* value = root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0);
 86     if (sizeof(T) == 4)
 87         value = root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), value);
 88 
 89     Value* ammount = root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(),
 90         root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR1));
 91     root-&gt;appendNewControlValue(proc, Return, Origin(),
 92         root-&gt;appendNew&lt;Value&gt;(proc, RotL, Origin(), value, ammount));
 93 
 94     CHECK_EQ(compileAndRun&lt;T&gt;(proc, valueInt, shift), rotateLeft(valueInt, shift));
 95 }
 96 
 97 
 98 template&lt;typename T&gt;
 99 void testRotRWithImmShift(T valueInt, int32_t shift)
100 {
101     Procedure proc;
102     BasicBlock* root = proc.addBlock();
103 
104     Value* value = root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0);
105     if (sizeof(T) == 4)
106         value = root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), value);
107 
108     Value* ammount = root-&gt;appendIntConstant(proc, Origin(), Int32, shift);
109     root-&gt;appendNewControlValue(proc, Return, Origin(),
110         root-&gt;appendNew&lt;Value&gt;(proc, RotR, Origin(), value, ammount));
111 
112     CHECK_EQ(compileAndRun&lt;T&gt;(proc, valueInt, shift), rotateRight(valueInt, shift));
113 }
114 
115 template&lt;typename T&gt;
116 void testRotLWithImmShift(T valueInt, int32_t shift)
117 {
118     Procedure proc;
119     BasicBlock* root = proc.addBlock();
120 
121     Value* value = root-&gt;appendNew&lt;ArgumentRegValue&gt;(proc, Origin(), GPRInfo::argumentGPR0);
122     if (sizeof(T) == 4)
123         value = root-&gt;appendNew&lt;Value&gt;(proc, Trunc, Origin(), value);
124 
125     Value* ammount = root-&gt;appendIntConstant(proc, Origin(), Int32, shift);
126     root-&gt;appendNewControlValue(proc, Return, Origin(),
127         root-&gt;appendNew&lt;Value&gt;(proc, RotL, Origin(), value, ammount));
128 
129     CHECK_EQ(compileAndRun&lt;T&gt;(proc, valueInt, shift), rotateLeft(valueInt, shift));
130 }
131 
132 template&lt;typename T&gt;
133 void testComputeDivisionMagic(T value, T magicMultiplier, unsigned shift)
134 {
135     DivisionMagic&lt;T&gt; magic = computeDivisionMagic(value);
136     CHECK(magic.magicMultiplier == magicMultiplier);
137     CHECK(magic.shift == shift);
138 }
139 
140 void run(const char* filter)
141 {
142     Deque&lt;RefPtr&lt;SharedTask&lt;void()&gt;&gt;&gt; tasks;
143 
144     RUN_NOW(testTerminalPatchpointThatNeedsToBeSpilled2());
145     RUN(test42());
146     RUN(testLoad42());
147     RUN(testLoadAcq42());
148     RUN(testLoadOffsetImm9Max());
149     RUN(testLoadOffsetImm9MaxPlusOne());
150     RUN(testLoadOffsetImm9MaxPlusTwo());
151     RUN(testLoadOffsetImm9Min());
152     RUN(testLoadOffsetImm9MinMinusOne());
153     RUN(testLoadOffsetScaledUnsignedImm12Max());
154     RUN(testLoadOffsetScaledUnsignedOverImm12Max());
155     RUN(testArg(43));
156     RUN(testReturnConst64(5));
157     RUN(testReturnConst64(-42));
158     RUN(testReturnVoid());
159 
160     RUN_UNARY(testAddTreeArg32, int32Operands());
161     RUN_UNARY(testMulTreeArg32, int32Operands());
162 
163     addArgTests(filter, tasks);
164 
165     RUN_UNARY(testNegDouble, floatingPointOperands&lt;double&gt;());
166     RUN_UNARY(testNegFloat, floatingPointOperands&lt;float&gt;());
167     RUN_UNARY(testNegFloatWithUselessDoubleConversion, floatingPointOperands&lt;float&gt;());
168 
169     addBitTests(filter, tasks);
170 
171     RUN(testShlArgs(1, 0));
172     RUN(testShlArgs(1, 1));
173     RUN(testShlArgs(1, 62));
174     RUN(testShlArgs(0xffffffffffffffff, 0));
175     RUN(testShlArgs(0xffffffffffffffff, 1));
176     RUN(testShlArgs(0xffffffffffffffff, 63));
177     RUN(testShlImms(1, 0));
178     RUN(testShlImms(1, 1));
179     RUN(testShlImms(1, 62));
180     RUN(testShlImms(1, 65));
181     RUN(testShlImms(0xffffffffffffffff, 0));
182     RUN(testShlImms(0xffffffffffffffff, 1));
183     RUN(testShlImms(0xffffffffffffffff, 63));
184     RUN(testShlArgImm(1, 0));
185     RUN(testShlArgImm(1, 1));
186     RUN(testShlArgImm(1, 62));
187     RUN(testShlArgImm(1, 65));
188     RUN(testShlArgImm(0xffffffffffffffff, 0));
189     RUN(testShlArgImm(0xffffffffffffffff, 1));
190     RUN(testShlArgImm(0xffffffffffffffff, 63));
191     RUN(testShlSShrArgImm(1, 0));
192     RUN(testShlSShrArgImm(1, 1));
193     RUN(testShlSShrArgImm(1, 62));
194     RUN(testShlSShrArgImm(1, 65));
195     RUN(testShlSShrArgImm(0xffffffffffffffff, 0));
196     RUN(testShlSShrArgImm(0xffffffffffffffff, 1));
197     RUN(testShlSShrArgImm(0xffffffffffffffff, 63));
198     RUN(testShlArg32(2));
199     RUN(testShlArgs32(1, 0));
200     RUN(testShlArgs32(1, 1));
201     RUN(testShlArgs32(1, 62));
202     RUN(testShlImms32(1, 33));
203     RUN(testShlArgs32(0xffffffff, 0));
204     RUN(testShlArgs32(0xffffffff, 1));
205     RUN(testShlArgs32(0xffffffff, 63));
206     RUN(testShlImms32(1, 0));
207     RUN(testShlImms32(1, 1));
208     RUN(testShlImms32(1, 62));
209     RUN(testShlImms32(1, 33));
210     RUN(testShlImms32(0xffffffff, 0));
211     RUN(testShlImms32(0xffffffff, 1));
212     RUN(testShlImms32(0xffffffff, 63));
213     RUN(testShlArgImm32(1, 0));
214     RUN(testShlArgImm32(1, 1));
215     RUN(testShlArgImm32(1, 62));
216     RUN(testShlArgImm32(1, 33));
217     RUN(testShlArgImm32(0xffffffff, 0));
218     RUN(testShlArgImm32(0xffffffff, 1));
219     RUN(testShlArgImm32(0xffffffff, 63));
220     RUN(testShlZShrArgImm32(1, 0));
221     RUN(testShlZShrArgImm32(1, 1));
222     RUN(testShlZShrArgImm32(1, 62));
223     RUN(testShlZShrArgImm32(1, 33));
224     RUN(testShlZShrArgImm32(0xffffffff, 0));
225     RUN(testShlZShrArgImm32(0xffffffff, 1));
226     RUN(testShlZShrArgImm32(0xffffffff, 63));
227 
228     addShrTests(filter, tasks);
229 
230     RUN_UNARY(testClzArg64, int64Operands());
231     RUN_UNARY(testClzMem64, int64Operands());
232     RUN_UNARY(testClzArg32, int32Operands());
233     RUN_UNARY(testClzMem32, int64Operands());
234 
235     RUN_UNARY(testAbsArg, floatingPointOperands&lt;double&gt;());
236     RUN_UNARY(testAbsImm, floatingPointOperands&lt;double&gt;());
237     RUN_UNARY(testAbsMem, floatingPointOperands&lt;double&gt;());
238     RUN_UNARY(testAbsAbsArg, floatingPointOperands&lt;double&gt;());
239     RUN_UNARY(testAbsNegArg, floatingPointOperands&lt;double&gt;());
240     RUN_UNARY(testAbsBitwiseCastArg, floatingPointOperands&lt;double&gt;());
241     RUN_UNARY(testBitwiseCastAbsBitwiseCastArg, floatingPointOperands&lt;double&gt;());
242     RUN_UNARY(testAbsArg, floatingPointOperands&lt;float&gt;());
243     RUN_UNARY(testAbsImm, floatingPointOperands&lt;float&gt;());
244     RUN_UNARY(testAbsMem, floatingPointOperands&lt;float&gt;());
245     RUN_UNARY(testAbsAbsArg, floatingPointOperands&lt;float&gt;());
246     RUN_UNARY(testAbsNegArg, floatingPointOperands&lt;float&gt;());
247     RUN_UNARY(testAbsBitwiseCastArg, floatingPointOperands&lt;float&gt;());
248     RUN_UNARY(testBitwiseCastAbsBitwiseCastArg, floatingPointOperands&lt;float&gt;());
249     RUN_UNARY(testAbsArgWithUselessDoubleConversion, floatingPointOperands&lt;float&gt;());
250     RUN_UNARY(testAbsArgWithEffectfulDoubleConversion, floatingPointOperands&lt;float&gt;());
251 
252     RUN_UNARY(testCeilArg, floatingPointOperands&lt;double&gt;());
253     RUN_UNARY(testCeilImm, floatingPointOperands&lt;double&gt;());
254     RUN_UNARY(testCeilMem, floatingPointOperands&lt;double&gt;());
255     RUN_UNARY(testCeilCeilArg, floatingPointOperands&lt;double&gt;());
256     RUN_UNARY(testFloorCeilArg, floatingPointOperands&lt;double&gt;());
257     RUN_UNARY(testCeilIToD64, int64Operands());
258     RUN_UNARY(testCeilIToD32, int32Operands());
259     RUN_UNARY(testCeilArg, floatingPointOperands&lt;float&gt;());
260     RUN_UNARY(testCeilImm, floatingPointOperands&lt;float&gt;());
261     RUN_UNARY(testCeilMem, floatingPointOperands&lt;float&gt;());
262     RUN_UNARY(testCeilCeilArg, floatingPointOperands&lt;float&gt;());
263     RUN_UNARY(testFloorCeilArg, floatingPointOperands&lt;float&gt;());
264     RUN_UNARY(testCeilArgWithUselessDoubleConversion, floatingPointOperands&lt;float&gt;());
265     RUN_UNARY(testCeilArgWithEffectfulDoubleConversion, floatingPointOperands&lt;float&gt;());
266 
267     RUN_UNARY(testFloorArg, floatingPointOperands&lt;double&gt;());
268     RUN_UNARY(testFloorImm, floatingPointOperands&lt;double&gt;());
269     RUN_UNARY(testFloorMem, floatingPointOperands&lt;double&gt;());
270     RUN_UNARY(testFloorFloorArg, floatingPointOperands&lt;double&gt;());
271     RUN_UNARY(testCeilFloorArg, floatingPointOperands&lt;double&gt;());
272     RUN_UNARY(testFloorIToD64, int64Operands());
273     RUN_UNARY(testFloorIToD32, int32Operands());
274     RUN_UNARY(testFloorArg, floatingPointOperands&lt;float&gt;());
275     RUN_UNARY(testFloorImm, floatingPointOperands&lt;float&gt;());
276     RUN_UNARY(testFloorMem, floatingPointOperands&lt;float&gt;());
277     RUN_UNARY(testFloorFloorArg, floatingPointOperands&lt;float&gt;());
278     RUN_UNARY(testCeilFloorArg, floatingPointOperands&lt;float&gt;());
279     RUN_UNARY(testFloorArgWithUselessDoubleConversion, floatingPointOperands&lt;float&gt;());
280     RUN_UNARY(testFloorArgWithEffectfulDoubleConversion, floatingPointOperands&lt;float&gt;());
281 
282     RUN_UNARY(testSqrtArg, floatingPointOperands&lt;double&gt;());
283     RUN_UNARY(testSqrtImm, floatingPointOperands&lt;double&gt;());
284     RUN_UNARY(testSqrtMem, floatingPointOperands&lt;double&gt;());
285     RUN_UNARY(testSqrtArg, floatingPointOperands&lt;float&gt;());
286     RUN_UNARY(testSqrtImm, floatingPointOperands&lt;float&gt;());
287     RUN_UNARY(testSqrtMem, floatingPointOperands&lt;float&gt;());
288     RUN_UNARY(testSqrtArgWithUselessDoubleConversion, floatingPointOperands&lt;float&gt;());
289     RUN_UNARY(testSqrtArgWithEffectfulDoubleConversion, floatingPointOperands&lt;float&gt;());
290 
291     RUN_BINARY(testCompareTwoFloatToDouble, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
292     RUN_BINARY(testCompareOneFloatToDouble, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;double&gt;());
293     RUN_BINARY(testCompareFloatToDoubleThroughPhi, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
294     RUN_UNARY(testDoubleToFloatThroughPhi, floatingPointOperands&lt;float&gt;());
295     RUN(testReduceFloatToDoubleValidates());
296     RUN_UNARY(testDoubleProducerPhiToFloatConversion, floatingPointOperands&lt;float&gt;());
297     RUN_UNARY(testDoubleProducerPhiToFloatConversionWithDoubleConsumer, floatingPointOperands&lt;float&gt;());
298     RUN_BINARY(testDoubleProducerPhiWithNonFloatConst, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;double&gt;());
299 
300     RUN_UNARY(testDoubleArgToInt64BitwiseCast, floatingPointOperands&lt;double&gt;());
301     RUN_UNARY(testDoubleImmToInt64BitwiseCast, floatingPointOperands&lt;double&gt;());
302     RUN_UNARY(testTwoBitwiseCastOnDouble, floatingPointOperands&lt;double&gt;());
303     RUN_UNARY(testBitwiseCastOnDoubleInMemory, floatingPointOperands&lt;double&gt;());
304     RUN_UNARY(testBitwiseCastOnDoubleInMemoryIndexed, floatingPointOperands&lt;double&gt;());
305     RUN_UNARY(testInt64BArgToDoubleBitwiseCast, int64Operands());
306     RUN_UNARY(testInt64BImmToDoubleBitwiseCast, int64Operands());
307     RUN_UNARY(testTwoBitwiseCastOnInt64, int64Operands());
308     RUN_UNARY(testBitwiseCastOnInt64InMemory, int64Operands());
309     RUN_UNARY(testBitwiseCastOnInt64InMemoryIndexed, int64Operands());
310     RUN_UNARY(testFloatImmToInt32BitwiseCast, floatingPointOperands&lt;float&gt;());
311     RUN_UNARY(testBitwiseCastOnFloatInMemory, floatingPointOperands&lt;float&gt;());
312     RUN_UNARY(testInt32BArgToFloatBitwiseCast, int32Operands());
313     RUN_UNARY(testInt32BImmToFloatBitwiseCast, int32Operands());
314     RUN_UNARY(testTwoBitwiseCastOnInt32, int32Operands());
315     RUN_UNARY(testBitwiseCastOnInt32InMemory, int32Operands());
316 
317     RUN_UNARY(testConvertDoubleToFloatArg, floatingPointOperands&lt;double&gt;());
318     RUN_UNARY(testConvertDoubleToFloatImm, floatingPointOperands&lt;double&gt;());
319     RUN_UNARY(testConvertDoubleToFloatMem, floatingPointOperands&lt;double&gt;());
320     RUN_UNARY(testConvertFloatToDoubleArg, floatingPointOperands&lt;float&gt;());
321     RUN_UNARY(testConvertFloatToDoubleImm, floatingPointOperands&lt;float&gt;());
322     RUN_UNARY(testConvertFloatToDoubleMem, floatingPointOperands&lt;float&gt;());
323     RUN_UNARY(testConvertDoubleToFloatToDoubleToFloat, floatingPointOperands&lt;double&gt;());
324     RUN_UNARY(testStoreFloat, floatingPointOperands&lt;double&gt;());
325     RUN_UNARY(testStoreDoubleConstantAsFloat, floatingPointOperands&lt;double&gt;());
326     RUN_UNARY(testLoadFloatConvertDoubleConvertFloatStoreFloat, floatingPointOperands&lt;float&gt;());
327     RUN_UNARY(testFroundArg, floatingPointOperands&lt;double&gt;());
328     RUN_UNARY(testFroundMem, floatingPointOperands&lt;double&gt;());
329 
330     RUN(testIToD64Arg());
331     RUN(testIToF64Arg());
332     RUN(testIToD32Arg());
333     RUN(testIToF32Arg());
334     RUN(testIToD64Mem());
335     RUN(testIToF64Mem());
336     RUN(testIToD32Mem());
337     RUN(testIToF32Mem());
338     RUN_UNARY(testIToD64Imm, int64Operands());
339     RUN_UNARY(testIToF64Imm, int64Operands());
340     RUN_UNARY(testIToD32Imm, int32Operands());
341     RUN_UNARY(testIToF32Imm, int32Operands());
342     RUN(testIToDReducedToIToF64Arg());
343     RUN(testIToDReducedToIToF32Arg());
344 
345     RUN(testStore32(44));
346     RUN(testStoreConstant(49));
347     RUN(testStoreConstantPtr(49));
348     RUN(testStore8Arg());
349     RUN(testStore8Imm());
350     RUN(testStorePartial8BitRegisterOnX86());
351     RUN(testStore16Arg());
352     RUN(testStore16Imm());
353     RUN(testTrunc((static_cast&lt;int64_t&gt;(1) &lt;&lt; 40) + 42));
354     RUN(testAdd1(45));
355     RUN(testAdd1Ptr(51));
356     RUN(testAdd1Ptr(static_cast&lt;intptr_t&gt;(0xbaadbeef)));
357     RUN(testNeg32(52));
358     RUN(testNegPtr(53));
359     RUN(testStoreAddLoad32(46));
360     RUN(testStoreRelAddLoadAcq32(46));
361     RUN(testStoreAddLoadImm32(46));
362     RUN(testStoreAddLoad64(4600));
363     RUN(testStoreRelAddLoadAcq64(4600));
364     RUN(testStoreAddLoadImm64(4600));
365     RUN(testStoreAddLoad8(4, Load8Z));
366     RUN(testStoreRelAddLoadAcq8(4, Load8Z));
367     RUN(testStoreRelAddFenceLoadAcq8(4, Load8Z));
368     RUN(testStoreAddLoadImm8(4, Load8Z));
369     RUN(testStoreAddLoad8(4, Load8S));
370     RUN(testStoreRelAddLoadAcq8(4, Load8S));
371     RUN(testStoreAddLoadImm8(4, Load8S));
372     RUN(testStoreAddLoad16(6, Load16Z));
373     RUN(testStoreRelAddLoadAcq16(6, Load16Z));
374     RUN(testStoreAddLoadImm16(6, Load16Z));
375     RUN(testStoreAddLoad16(6, Load16S));
376     RUN(testStoreRelAddLoadAcq16(6, Load16S));
377     RUN(testStoreAddLoadImm16(6, Load16S));
378     RUN(testStoreAddLoad32Index(46));
379     RUN(testStoreAddLoadImm32Index(46));
380     RUN(testStoreAddLoad64Index(4600));
381     RUN(testStoreAddLoadImm64Index(4600));
382     RUN(testStoreAddLoad8Index(4, Load8Z));
383     RUN(testStoreAddLoadImm8Index(4, Load8Z));
384     RUN(testStoreAddLoad8Index(4, Load8S));
385     RUN(testStoreAddLoadImm8Index(4, Load8S));
386     RUN(testStoreAddLoad16Index(6, Load16Z));
387     RUN(testStoreAddLoadImm16Index(6, Load16Z));
388     RUN(testStoreAddLoad16Index(6, Load16S));
389     RUN(testStoreAddLoadImm16Index(6, Load16S));
390     RUN(testStoreSubLoad(46));
391     RUN(testStoreAddLoadInterference(52));
392     RUN(testStoreAddAndLoad(47, 0xffff));
393     RUN(testStoreAddAndLoad(470000, 0xffff));
394     RUN(testStoreNegLoad32(54));
395     RUN(testStoreNegLoadPtr(55));
396     RUN(testAdd1Uncommuted(48));
397     RUN(testLoadOffset());
398     RUN(testLoadOffsetNotConstant());
399     RUN(testLoadOffsetUsingAdd());
400     RUN(testLoadOffsetUsingAddInterference());
401     RUN(testLoadOffsetUsingAddNotConstant());
402     RUN(testLoadAddrShift(0));
403     RUN(testLoadAddrShift(1));
404     RUN(testLoadAddrShift(2));
405     RUN(testLoadAddrShift(3));
406     RUN(testFramePointer());
407     RUN(testOverrideFramePointer());
408     RUN(testStackSlot());
409     RUN(testLoadFromFramePointer());
410     RUN(testStoreLoadStackSlot(50));
411 
412     RUN(testBranch());
413     RUN(testBranchPtr());
414     RUN(testDiamond());
415     RUN(testBranchNotEqual());
416     RUN(testBranchNotEqualCommute());
417     RUN(testBranchNotEqualNotEqual());
418     RUN(testBranchEqual());
419     RUN(testBranchEqualEqual());
420     RUN(testBranchEqualCommute());
421     RUN(testBranchEqualEqual1());
422     RUN_BINARY(testBranchEqualOrUnorderedArgs, floatingPointOperands&lt;double&gt;(), floatingPointOperands&lt;double&gt;());
423     RUN_BINARY(testBranchEqualOrUnorderedArgs, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
424     RUN_BINARY(testBranchNotEqualAndOrderedArgs, floatingPointOperands&lt;double&gt;(), floatingPointOperands&lt;double&gt;());
425     RUN_BINARY(testBranchNotEqualAndOrderedArgs, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
426     RUN_BINARY(testBranchEqualOrUnorderedDoubleArgImm, floatingPointOperands&lt;double&gt;(), floatingPointOperands&lt;double&gt;());
427     RUN_BINARY(testBranchEqualOrUnorderedFloatArgImm, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
428     RUN_BINARY(testBranchEqualOrUnorderedDoubleImms, floatingPointOperands&lt;double&gt;(), floatingPointOperands&lt;double&gt;());
429     RUN_BINARY(testBranchEqualOrUnorderedFloatImms, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
430     RUN_BINARY(testBranchEqualOrUnorderedFloatWithUselessDoubleConversion, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
431     RUN_BINARY(testBranchNotEqualAndOrderedArgs, floatingPointOperands&lt;double&gt;(), floatingPointOperands&lt;double&gt;());
432     RUN_BINARY(testBranchNotEqualAndOrderedArgs, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
433     RUN(testBranchFold(42));
434     RUN(testBranchFold(0));
435     RUN(testDiamondFold(42));
436     RUN(testDiamondFold(0));
437     RUN(testBranchNotEqualFoldPtr(42));
438     RUN(testBranchNotEqualFoldPtr(0));
439     RUN(testBranchEqualFoldPtr(42));
440     RUN(testBranchEqualFoldPtr(0));
441     RUN(testBranchLoadPtr());
442     RUN(testBranchLoad32());
443     RUN(testBranchLoad8S());
444     RUN(testBranchLoad8Z());
445     RUN(testBranchLoad16S());
446     RUN(testBranchLoad16Z());
447     RUN(testBranch8WithLoad8ZIndex());
448 
449     RUN(testComplex(64, 128));
450     RUN(testComplex(4, 128));
451     RUN(testComplex(4, 256));
452     RUN(testComplex(4, 384));
453 
454     RUN_BINARY(testBranchBitTest32TmpImm, int32Operands(), int32Operands());
455     RUN_BINARY(testBranchBitTest32AddrImm, int32Operands(), int32Operands());
456     RUN_BINARY(testBranchBitTest32TmpTmp, int32Operands(), int32Operands());
457     RUN_BINARY(testBranchBitTest64TmpTmp, int64Operands(), int64Operands());
458     RUN_BINARY(testBranchBitTest64AddrTmp, int64Operands(), int64Operands());
459     RUN_BINARY(testBranchBitTestNegation, int64Operands(), int64Operands());
460     RUN_BINARY(testBranchBitTestNegation2, int64Operands(), int64Operands());
461 
462     RUN(testSimplePatchpoint());
463     RUN(testSimplePatchpointWithoutOuputClobbersGPArgs());
464     RUN(testSimplePatchpointWithOuputClobbersGPArgs());
465     RUN(testSimplePatchpointWithoutOuputClobbersFPArgs());
466     RUN(testSimplePatchpointWithOuputClobbersFPArgs());
467     RUN(testPatchpointWithEarlyClobber());
468     RUN(testPatchpointCallArg());
469     RUN(testPatchpointFixedRegister());
470     RUN(testPatchpointAny(ValueRep::WarmAny));
471     RUN(testPatchpointAny(ValueRep::ColdAny));
472     RUN(testPatchpointGPScratch());
473     RUN(testPatchpointFPScratch());
474     RUN(testPatchpointLotsOfLateAnys());
475     RUN(testPatchpointAnyImm(ValueRep::WarmAny));
476     RUN(testPatchpointAnyImm(ValueRep::ColdAny));
477     RUN(testPatchpointAnyImm(ValueRep::LateColdAny));
478     RUN(testPatchpointManyWarmAnyImms());
479     RUN(testPatchpointManyColdAnyImms());
480     RUN(testPatchpointWithRegisterResult());
481     RUN(testPatchpointWithStackArgumentResult());
482     RUN(testPatchpointWithAnyResult());
483     RUN(testSimpleCheck());
484     RUN(testCheckFalse());
485     RUN(testCheckTrue());
486     RUN(testCheckLessThan());
487     RUN(testCheckMegaCombo());
488     RUN(testCheckTrickyMegaCombo());
489     RUN(testCheckTwoMegaCombos());
490     RUN(testCheckTwoNonRedundantMegaCombos());
491     RUN(testCheckAddImm());
492     RUN(testCheckAddImmCommute());
493     RUN(testCheckAddImmSomeRegister());
494     RUN(testCheckAdd());
495     RUN(testCheckAdd64());
496     RUN(testCheckAddFold(100, 200));
497     RUN(testCheckAddFoldFail(2147483647, 100));
498     RUN(testCheckAddArgumentAliasing64());
499     RUN(testCheckAddArgumentAliasing32());
500     RUN(testCheckAddSelfOverflow64());
501     RUN(testCheckAddSelfOverflow32());
502     RUN(testCheckSubImm());
503     RUN(testCheckSubBadImm());
504     RUN(testCheckSub());
505     RUN(testCheckSub64());
506     RUN(testCheckSubFold(100, 200));
507     RUN(testCheckSubFoldFail(-2147483647, 100));
508     RUN(testCheckNeg());
509     RUN(testCheckNeg64());
510     RUN(testCheckMul());
511     RUN(testCheckMulMemory());
512     RUN(testCheckMul2());
513     RUN(testCheckMul64());
514     RUN(testCheckMulFold(100, 200));
515     RUN(testCheckMulFoldFail(2147483647, 100));
516     RUN(testCheckMulArgumentAliasing64());
517     RUN(testCheckMulArgumentAliasing32());
518 
519     RUN_BINARY([](int32_t a, int32_t b) { testCompare(Equal, a, b); }, int64Operands(), int64Operands());
520     RUN_BINARY([](int32_t a, int32_t b) { testCompare(NotEqual, a, b); }, int64Operands(), int64Operands());
521     RUN_BINARY([](int32_t a, int32_t b) { testCompare(LessThan, a, b); }, int64Operands(), int64Operands());
522     RUN_BINARY([](int32_t a, int32_t b) { testCompare(GreaterThan, a, b); }, int64Operands(), int64Operands());
523     RUN_BINARY([](int32_t a, int32_t b) { testCompare(LessEqual, a, b); }, int64Operands(), int64Operands());
524     RUN_BINARY([](int32_t a, int32_t b) { testCompare(GreaterEqual, a, b); }, int64Operands(), int64Operands());
525     RUN_BINARY([](int32_t a, int32_t b) { testCompare(Below, a, b); }, int64Operands(), int64Operands());
526     RUN_BINARY([](int32_t a, int32_t b) { testCompare(Above, a, b); }, int64Operands(), int64Operands());
527     RUN_BINARY([](int32_t a, int32_t b) { testCompare(BelowEqual, a, b); }, int64Operands(), int64Operands());
528     RUN_BINARY([](int32_t a, int32_t b) { testCompare(AboveEqual, a, b); }, int64Operands(), int64Operands());
529     RUN_BINARY([](int32_t a, int32_t b) { testCompare(BitAnd, a, b); }, int64Operands(), int64Operands());
530 
531     RUN(testEqualDouble(42, 42, true));
532     RUN(testEqualDouble(0, -0, true));
533     RUN(testEqualDouble(42, 43, false));
534     RUN(testEqualDouble(PNaN, 42, false));
535     RUN(testEqualDouble(42, PNaN, false));
536     RUN(testEqualDouble(PNaN, PNaN, false));
537 
538     addLoadTests(filter, tasks);
539     addTupleTests(filter, tasks);
540 
541     addCopyTests(filter, tasks);
542 
543     RUN(testSpillGP());
544     RUN(testSpillFP());
545 
546     RUN(testInt32ToDoublePartialRegisterStall());
547     RUN(testInt32ToDoublePartialRegisterWithoutStall());
548 
549     addCallTests(filter, tasks);
550 
551     RUN(testLinearScanWithCalleeOnStack());
552 
553     RUN(testChillDiv(4, 2, 2));
554     RUN(testChillDiv(1, 0, 0));
555     RUN(testChillDiv(0, 0, 0));
556     RUN(testChillDiv(1, -1, -1));
557     RUN(testChillDiv(-2147483647 - 1, 0, 0));
558     RUN(testChillDiv(-2147483647 - 1, 1, -2147483647 - 1));
559     RUN(testChillDiv(-2147483647 - 1, -1, -2147483647 - 1));
560     RUN(testChillDiv(-2147483647 - 1, 2, -1073741824));
561     RUN(testChillDiv64(4, 2, 2));
562     RUN(testChillDiv64(1, 0, 0));
563     RUN(testChillDiv64(0, 0, 0));
564     RUN(testChillDiv64(1, -1, -1));
565     RUN(testChillDiv64(-9223372036854775807ll - 1, 0, 0));
566     RUN(testChillDiv64(-9223372036854775807ll - 1, 1, -9223372036854775807ll - 1));
567     RUN(testChillDiv64(-9223372036854775807ll - 1, -1, -9223372036854775807ll - 1));
568     RUN(testChillDiv64(-9223372036854775807ll - 1, 2, -4611686018427387904));
569     RUN(testChillDivTwice(4, 2, 6, 2, 5));
570     RUN(testChillDivTwice(4, 0, 6, 2, 3));
571     RUN(testChillDivTwice(4, 2, 6, 0, 2));
572 
573     RUN_UNARY(testModArg, int64Operands());
574     RUN_BINARY(testModArgs, int64Operands(), int64Operands());
575     RUN_BINARY(testModImms, int64Operands(), int64Operands());
576     RUN_UNARY(testModArg32, int32Operands());
577     RUN_BINARY(testModArgs32, int32Operands(), int32Operands());
578     RUN_BINARY(testModImms32, int32Operands(), int32Operands());
579     RUN_UNARY(testChillModArg, int64Operands());
580     RUN_BINARY(testChillModArgs, int64Operands(), int64Operands());
581     RUN_BINARY(testChillModImms, int64Operands(), int64Operands());
582     RUN_UNARY(testChillModArg32, int32Operands());
583     RUN_BINARY(testChillModArgs32, int32Operands(), int32Operands());
584     RUN_BINARY(testChillModImms32, int32Operands(), int32Operands());
585 
586     RUN(testSwitch(0, 1));
587     RUN(testSwitch(1, 1));
588     RUN(testSwitch(2, 1));
589     RUN(testSwitch(2, 2));
590     RUN(testSwitch(10, 1));
591     RUN(testSwitch(10, 2));
592     RUN(testSwitch(100, 1));
593     RUN(testSwitch(100, 100));
594 
595     RUN(testSwitchSameCaseAsDefault());
596 
597     RUN(testSwitchChillDiv(0, 1));
598     RUN(testSwitchChillDiv(1, 1));
599     RUN(testSwitchChillDiv(2, 1));
600     RUN(testSwitchChillDiv(2, 2));
601     RUN(testSwitchChillDiv(10, 1));
602     RUN(testSwitchChillDiv(10, 2));
603     RUN(testSwitchChillDiv(100, 1));
604     RUN(testSwitchChillDiv(100, 100));
605 
606     RUN(testSwitchTargettingSameBlock());
607     RUN(testSwitchTargettingSameBlockFoldPathConstant());
608 
609     RUN(testTrunc(0));
610     RUN(testTrunc(1));
611     RUN(testTrunc(-1));
612     RUN(testTrunc(1000000000000ll));
613     RUN(testTrunc(-1000000000000ll));
614     RUN(testTruncFold(0));
615     RUN(testTruncFold(1));
616     RUN(testTruncFold(-1));
617     RUN(testTruncFold(1000000000000ll));
618     RUN(testTruncFold(-1000000000000ll));
619 
620     RUN(testZExt32(0));
621     RUN(testZExt32(1));
622     RUN(testZExt32(-1));
623     RUN(testZExt32(1000000000ll));
624     RUN(testZExt32(-1000000000ll));
625     RUN(testZExt32Fold(0));
626     RUN(testZExt32Fold(1));
627     RUN(testZExt32Fold(-1));
628     RUN(testZExt32Fold(1000000000ll));
629     RUN(testZExt32Fold(-1000000000ll));
630 
631     RUN(testSExt32(0));
632     RUN(testSExt32(1));
633     RUN(testSExt32(-1));
634     RUN(testSExt32(1000000000ll));
635     RUN(testSExt32(-1000000000ll));
636     RUN(testSExt32Fold(0));
637     RUN(testSExt32Fold(1));
638     RUN(testSExt32Fold(-1));
639     RUN(testSExt32Fold(1000000000ll));
640     RUN(testSExt32Fold(-1000000000ll));
641 
642     RUN(testTruncZExt32(0));
643     RUN(testTruncZExt32(1));
644     RUN(testTruncZExt32(-1));
645     RUN(testTruncZExt32(1000000000ll));
646     RUN(testTruncZExt32(-1000000000ll));
647     RUN(testTruncSExt32(0));
648     RUN(testTruncSExt32(1));
649     RUN(testTruncSExt32(-1));
650     RUN(testTruncSExt32(1000000000ll));
651     RUN(testTruncSExt32(-1000000000ll));
652 
653     addSExtTests(filter, tasks);
654 
655     RUN(testBasicSelect());
656     RUN(testSelectTest());
657     RUN(testSelectCompareDouble());
658     RUN_BINARY(testSelectCompareFloat, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
659     RUN_BINARY(testSelectCompareFloatToDouble, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
660     RUN(testSelectDouble());
661     RUN(testSelectDoubleTest());
662     RUN(testSelectDoubleCompareDouble());
663     RUN_BINARY(testSelectDoubleCompareFloat, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
664     RUN_BINARY(testSelectFloatCompareFloat, floatingPointOperands&lt;float&gt;(), floatingPointOperands&lt;float&gt;());
665     RUN(testSelectDoubleCompareDoubleWithAliasing());
666     RUN(testSelectFloatCompareFloatWithAliasing());
667     RUN(testSelectFold(42));
668     RUN(testSelectFold(43));
669     RUN(testSelectInvert());
670     RUN(testCheckSelect());
671     RUN(testCheckSelectCheckSelect());
672     RUN(testCheckSelectAndCSE());
673     RUN_BINARY(testPowDoubleByIntegerLoop, floatingPointOperands&lt;double&gt;(), int64Operands());
674 
675     RUN(testTruncOrHigh());
676     RUN(testTruncOrLow());
677     RUN(testBitAndOrHigh());
678     RUN(testBitAndOrLow());
679 
680     RUN(testBranch64Equal(0, 0));
681     RUN(testBranch64Equal(1, 1));
682     RUN(testBranch64Equal(-1, -1));
683     RUN(testBranch64Equal(1, -1));
684     RUN(testBranch64Equal(-1, 1));
685     RUN(testBranch64EqualImm(0, 0));
686     RUN(testBranch64EqualImm(1, 1));
687     RUN(testBranch64EqualImm(-1, -1));
688     RUN(testBranch64EqualImm(1, -1));
689     RUN(testBranch64EqualImm(-1, 1));
690     RUN(testBranch64EqualMem(0, 0));
691     RUN(testBranch64EqualMem(1, 1));
692     RUN(testBranch64EqualMem(-1, -1));
693     RUN(testBranch64EqualMem(1, -1));
694     RUN(testBranch64EqualMem(-1, 1));
695     RUN(testBranch64EqualMemImm(0, 0));
696     RUN(testBranch64EqualMemImm(1, 1));
697     RUN(testBranch64EqualMemImm(-1, -1));
698     RUN(testBranch64EqualMemImm(1, -1));
699     RUN(testBranch64EqualMemImm(-1, 1));
700 
701     RUN(testStore8Load8Z(0));
702     RUN(testStore8Load8Z(123));
703     RUN(testStore8Load8Z(12345));
704     RUN(testStore8Load8Z(-123));
705 
706     RUN(testStore16Load16Z(0));
707     RUN(testStore16Load16Z(123));
708     RUN(testStore16Load16Z(12345));
709     RUN(testStore16Load16Z(12345678));
710     RUN(testStore16Load16Z(-123));
711 
712     addSShrShTests(filter, tasks);
713 
714     RUN(testCheckMul64SShr());
715 
716     RUN_BINARY(testRotR, int32Operands(), int32Operands());
717     RUN_BINARY(testRotR, int64Operands(), int32Operands());
718     RUN_BINARY(testRotL, int32Operands(), int32Operands());
719     RUN_BINARY(testRotL, int64Operands(), int32Operands());
720 
721     RUN_BINARY(testRotRWithImmShift, int32Operands(), int32Operands());
722     RUN_BINARY(testRotRWithImmShift, int64Operands(), int32Operands());
723     RUN_BINARY(testRotLWithImmShift, int32Operands(), int32Operands());
724     RUN_BINARY(testRotLWithImmShift, int64Operands(), int32Operands());
725 
726     RUN(testComputeDivisionMagic&lt;int32_t&gt;(2, -2147483647, 0));
727     RUN(testTrivialInfiniteLoop());
728     RUN(testFoldPathEqual());
729 
730     RUN(testRShiftSelf32());
731     RUN(testURShiftSelf32());
732     RUN(testLShiftSelf32());
733     RUN(testRShiftSelf64());
734     RUN(testURShiftSelf64());
735     RUN(testLShiftSelf64());
736 
737     RUN(testPatchpointDoubleRegs());
738     RUN(testSpillDefSmallerThanUse());
739     RUN(testSpillUseLargerThanDef());
740     RUN(testLateRegister());
741     RUN(testInterpreter());
742     RUN(testReduceStrengthCheckBottomUseInAnotherBlock());
743     RUN(testResetReachabilityDanglingReference());
744 
745     RUN(testEntrySwitchSimple());
746     RUN(testEntrySwitchNoEntrySwitch());
747     RUN(testEntrySwitchWithCommonPaths());
748     RUN(testEntrySwitchWithCommonPathsAndNonTrivialEntrypoint());
749     RUN(testEntrySwitchLoop());
750 
751     RUN(testSomeEarlyRegister());
752     RUN(testPatchpointTerminalReturnValue(true));
753     RUN(testPatchpointTerminalReturnValue(false));
754     RUN(testTerminalPatchpointThatNeedsToBeSpilled());
755 
756     RUN(testMemoryFence());
757     RUN(testStoreFence());
758     RUN(testLoadFence());
759     RUN(testTrappingLoad());
760     RUN(testTrappingStore());
761     RUN(testTrappingLoadAddStore());
762     RUN(testTrappingLoadDCE());
763     RUN(testTrappingStoreElimination());
764     RUN(testMoveConstants());
765     RUN(testPCOriginMapDoesntInsertNops());
766     RUN(testPinRegisters());
767     RUN(testReduceStrengthReassociation(true));
768     RUN(testReduceStrengthReassociation(false));
769     RUN(testAddShl32());
770     RUN(testAddShl64());
771     RUN(testAddShl65());
772     RUN(testLoadBaseIndexShift2());
773     RUN(testLoadBaseIndexShift32());
774     RUN(testOptimizeMaterialization());
775     RUN(testLICMPure());
776     RUN(testLICMPureSideExits());
777     RUN(testLICMPureWritesPinned());
778     RUN(testLICMPureWrites());
779     RUN(testLICMReadsLocalState());
780     RUN(testLICMReadsPinned());
781     RUN(testLICMReads());
782     RUN(testLICMPureNotBackwardsDominant());
783     RUN(testLICMPureFoiledByChild());
784     RUN(testLICMPureNotBackwardsDominantFoiledByChild());
785     RUN(testLICMExitsSideways());
786     RUN(testLICMWritesLocalState());
787     RUN(testLICMWrites());
788     RUN(testLICMWritesPinned());
789     RUN(testLICMFence());
790     RUN(testLICMControlDependent());
791     RUN(testLICMControlDependentNotBackwardsDominant());
792     RUN(testLICMControlDependentSideExits());
793     RUN(testLICMReadsPinnedWritesPinned());
794     RUN(testLICMReadsWritesDifferentHeaps());
795     RUN(testLICMReadsWritesOverlappingHeaps());
796     RUN(testLICMDefaultCall());
797 
798     addAtomicTests(filter, tasks);
799     RUN(testDepend32());
800     RUN(testDepend64());
801 
802     RUN(testWasmBoundsCheck(0));
803     RUN(testWasmBoundsCheck(100));
804     RUN(testWasmBoundsCheck(10000));
805     RUN(testWasmBoundsCheck(std::numeric_limits&lt;unsigned&gt;::max() - 5));
806 
807     RUN(testWasmAddress());
808 
809     RUN(testFastTLSLoad());
810     RUN(testFastTLSStore());
811 
812     RUN(testDoubleLiteralComparison(bitwise_cast&lt;double&gt;(0x8000000000000001ull), bitwise_cast&lt;double&gt;(0x0000000000000000ull)));
813     RUN(testDoubleLiteralComparison(bitwise_cast&lt;double&gt;(0x0000000000000000ull), bitwise_cast&lt;double&gt;(0x8000000000000001ull)));
814     RUN(testDoubleLiteralComparison(125.3144446948241, 125.3144446948242));
815     RUN(testDoubleLiteralComparison(125.3144446948242, 125.3144446948241));
816 
817     RUN(testFloatEqualOrUnorderedFolding());
818     RUN(testFloatEqualOrUnorderedFoldingNaN());
819     RUN(testFloatEqualOrUnorderedDontFold());
820 
821     RUN(testShuffleDoesntTrashCalleeSaves());
822     RUN(testDemotePatchpointTerminal());
823 
824     RUN(testLoopWithMultipleHeaderEdges());
825 
826     RUN(testInfiniteLoopDoesntCauseBadHoisting());
827 
828     if (isX86()) {
829         RUN(testBranchBitAndImmFusion(Identity, Int64, 1, Air::BranchTest32, Air::Arg::Tmp));
830         RUN(testBranchBitAndImmFusion(Identity, Int64, 0xff, Air::BranchTest32, Air::Arg::Tmp));
831         RUN(testBranchBitAndImmFusion(Trunc, Int32, 1, Air::BranchTest32, Air::Arg::Tmp));
832         RUN(testBranchBitAndImmFusion(Trunc, Int32, 0xff, Air::BranchTest32, Air::Arg::Tmp));
833         RUN(testBranchBitAndImmFusion(Load8S, Int32, 1, Air::BranchTest8, Air::Arg::Addr));
834         RUN(testBranchBitAndImmFusion(Load8Z, Int32, 1, Air::BranchTest8, Air::Arg::Addr));
835         RUN(testBranchBitAndImmFusion(Load, Int32, 1, Air::BranchTest32, Air::Arg::Addr));
836         RUN(testBranchBitAndImmFusion(Load, Int64, 1, Air::BranchTest32, Air::Arg::Addr));
837         RUN(testX86LeaAddAddShlLeft());
838         RUN(testX86LeaAddAddShlRight());
839         RUN(testX86LeaAddAdd());
840         RUN(testX86LeaAddShlRight());
841         RUN(testX86LeaAddShlLeftScale1());
842         RUN(testX86LeaAddShlLeftScale2());
843         RUN(testX86LeaAddShlLeftScale4());
844         RUN(testX86LeaAddShlLeftScale8());
845     }
846 
847     if (isARM64()) {
848         RUN(testTernarySubInstructionSelection(Identity, Int64, Air::Sub64));
849         RUN(testTernarySubInstructionSelection(Trunc, Int32, Air::Sub32));
850     }
851 
852     RUN(testReportUsedRegistersLateUseFollowedByEarlyDefDoesNotMarkUseAsDead());
853 
854     if (tasks.isEmpty())
855         usage();
856 
857     Lock lock;
858 
859     Vector&lt;Ref&lt;Thread&gt;&gt; threads;
860     for (unsigned i = filter ? 1 : WTF::numberOfProcessorCores(); i--;) {
861         threads.append(
862             Thread::create(
863                 &quot;testb3 thread&quot;,
864                 [&amp;] () {
865                     for (;;) {
866                         RefPtr&lt;SharedTask&lt;void()&gt;&gt; task;
867                         {
868                             LockHolder locker(lock);
869                             if (tasks.isEmpty())
870                                 return;
871                             task = tasks.takeFirst();
872                         }
873 
874                         task-&gt;run();
875                     }
876                 }));
877     }
878 
879     for (auto&amp; thread : threads)
880         thread-&gt;waitForCompletion();
881     crashLock.lock();
882     crashLock.unlock();
883 }
884 
885 #else // ENABLE(B3_JIT)
886 
887 static void run(const char*)
888 {
889     dataLog(&quot;B3 JIT is not enabled.\n&quot;);
890 }
891 
892 #endif // ENABLE(B3_JIT)
893 
894 int main(int argc, char** argv)
895 {
896     const char* filter = nullptr;
897     switch (argc) {
898     case 1:
899         break;
900     case 2:
901         filter = argv[1];
902         break;
903     default:
904         usage();
905         break;
906     }
907 
908     WTF::initializeMainThread();
909     JSC::initializeThreading();
910 
911     for (unsigned i = 0; i &lt;= 2; ++i) {
912         JSC::Options::defaultB3OptLevel() = i;
913         run(filter);
914     }
915 
916     return 0;
917 }
918 
919 #if OS(WINDOWS)
920 extern &quot;C&quot; __declspec(dllexport) int WINAPI dllLauncherEntryPoint(int argc, const char* argv[])
921 {
922     return main(argc, const_cast&lt;char**&gt;(argv));
923 }
924 #endif
    </pre>
  </body>
</html>