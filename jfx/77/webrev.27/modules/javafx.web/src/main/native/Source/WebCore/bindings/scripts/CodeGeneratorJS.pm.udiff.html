<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/bindings/scripts/CodeGeneratorJS.pm</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="CodeGenerator.pm.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="IDLAttributes.json.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/bindings/scripts/CodeGeneratorJS.pm</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -598,11 +598,11 @@</span>
      my $returnType = &quot;Optional&lt;&quot; . $resultType . &quot;&gt;&quot;;
  
      push(@$outputArray, &quot;    auto getterFunctor = [] (auto&amp; thisObject, auto propertyName) -&gt; ${returnType} {\n&quot;);
  
      my @arguments = GenerateCallWithUsingReferences($namedGetterOperation-&gt;extendedAttributes-&gt;{CallWith}, $outputArray, &quot;WTF::nullopt&quot;, &quot;thisObject&quot;, &quot;        &quot;);
<span class="udiff-line-modified-removed">-     push(@arguments, &quot;propertyNameToAtomicString(propertyName)&quot;);</span>
<span class="udiff-line-modified-added">+     push(@arguments, &quot;propertyNameToAtomString(propertyName)&quot;);</span>
  
      push(@$outputArray, &quot;        auto result = thisObject.wrapped().${namedGetterFunctionName}(&quot; . join(&quot;, &quot;, @arguments) . &quot;);\n&quot;);
      
      if ($namedGetterOperation-&gt;extendedAttributes-&gt;{MayThrowException}) {
          push(@$outputArray, &quot;        if (result.hasException())\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -725,24 +725,27 @@</span>
      # to the point where we actually need it.
      my $didGeneratePropertyName = 0;
      my $propertyNameGeneration = sub {
          return if $didGeneratePropertyName;
          
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto propertyName = Identifier::from(state, index);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    auto propertyName = Identifier::from(vm, index);\n&quot;);</span>
          $didGeneratePropertyName = 1;
      };
      
<span class="udiff-line-added">+     my $namedGetterOperation = GetNamedGetterOperation($interface);</span>
<span class="udiff-line-added">+     my $indexedGetterOperation = GetIndexedGetterOperation($interface);</span>
<span class="udiff-line-added">+     </span>
      push(@$outputArray, &quot;bool ${className}::getOwnPropertySlotByIndex(JSObject* object, ExecState* state, unsigned index, PropertySlot&amp; slot)\n&quot;);
      push(@$outputArray, &quot;{\n&quot;);
<span class="udiff-line-added">+     if ($namedGetterOperation || $interface-&gt;extendedAttributes-&gt;{Plugin} || ($indexedGetterOperation &amp;&amp; $indexedGetterOperation-&gt;extendedAttributes-&gt;{MayThrowException})) {</span>
<span class="udiff-line-added">+         push(@$outputArray, &quot;    VM&amp; vm = state-&gt;vm();\n&quot;);</span>
<span class="udiff-line-added">+     }</span>
      push(@$outputArray, &quot;    auto* thisObject = jsCast&lt;${className}*&gt;(object);\n&quot;);
      push(@$outputArray, &quot;    ASSERT_GC_OBJECT_INHERITS(thisObject, info());\n&quot;);
      
<span class="udiff-line-removed">-     my $namedGetterOperation = GetNamedGetterOperation($interface);</span>
<span class="udiff-line-removed">-     my $indexedGetterOperation = GetIndexedGetterOperation($interface);</span>
<span class="udiff-line-removed">-     </span>
      if (($namedGetterOperation &amp;&amp; $namedGetterOperation-&gt;extendedAttributes-&gt;{MayThrowException}) || ($indexedGetterOperation &amp;&amp; $indexedGetterOperation-&gt;extendedAttributes-&gt;{MayThrowException})) {
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto throwScope = DECLARE_THROW_SCOPE(state-&gt;vm());\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    auto throwScope = DECLARE_THROW_SCOPE(vm);\n&quot;);</span>
      }
      
      # NOTE: The alogithm for [[GetOwnProperty]] contains only the following step:
      # 1. Return LegacyPlatformObjectGetOwnProperty(O, P, false).
      
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -834,34 +837,37 @@</span>
      my $namedGetterOperation = GetNamedGetterOperation($interface);
      my $indexedGetterOperation = GetIndexedGetterOperation($interface);
      
      push(@$outputArray, &quot;void ${className}::getOwnPropertyNames(JSObject* object, ExecState* state, PropertyNameArray&amp; propertyNames, EnumerationMode mode)\n&quot;);
      push(@$outputArray, &quot;{\n&quot;);
<span class="udiff-line-added">+     if ($indexedGetterOperation || $namedGetterOperation) {</span>
<span class="udiff-line-added">+         push(@$outputArray, &quot;    VM&amp; vm = state-&gt;vm();\n&quot;);</span>
<span class="udiff-line-added">+     }</span>
      push(@$outputArray, &quot;    auto* thisObject = jsCast&lt;${className}*&gt;(object);\n&quot;);
      push(@$outputArray, &quot;    ASSERT_GC_OBJECT_INHERITS(object, info());\n&quot;);
      
      # 1. If the object supports indexed properties, then the object’s supported
      #    property indices are enumerated first, in numerical order.
      # FIXME: This should support non-contiguous indices.
      if ($indexedGetterOperation) {
          push(@$outputArray, &quot;    for (unsigned i = 0, count = thisObject-&gt;wrapped().length(); i &lt; count; ++i)\n&quot;);
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;        propertyNames.add(Identifier::from(state, i));\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;        propertyNames.add(Identifier::from(vm, i));\n&quot;);</span>
      }
  
      # 2. If the object supports named properties and doesn’t implement an interface
      #    with the [LegacyUnenumerableNamedProperties] extended attribute, then the
      #    object’s supported property names that are visible according to the named
      #    property visibility algorithm are enumerated next, in the order given in
      #    the definition of the set of supported property names.
      if ($namedGetterOperation) {
          if (!$interface-&gt;extendedAttributes-&gt;{LegacyUnenumerableNamedProperties}) {
              push(@$outputArray, &quot;    for (auto&amp; propertyName : thisObject-&gt;wrapped().supportedPropertyNames())\n&quot;);
<span class="udiff-line-modified-removed">-             push(@$outputArray, &quot;        propertyNames.add(Identifier::fromString(state, propertyName));\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@$outputArray, &quot;        propertyNames.add(Identifier::fromString(vm, propertyName));\n&quot;);</span>
          } else {
              push(@$outputArray, &quot;    if (mode.includeDontEnumProperties()) {\n&quot;);
              push(@$outputArray, &quot;        for (auto&amp; propertyName : thisObject-&gt;wrapped().supportedPropertyNames())\n&quot;);
<span class="udiff-line-modified-removed">-             push(@$outputArray, &quot;            propertyNames.add(Identifier::fromString(state, propertyName));\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@$outputArray, &quot;            propertyNames.add(Identifier::fromString(vm, propertyName));\n&quot;);</span>
              push(@$outputArray, &quot;    }\n&quot;);
          }
      }
      
      # 3. Finally, any enumerable own properties or properties from the object’s
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1004,10 +1010,13 @@</span>
      my $overrideBuiltins = $codeGenerator-&gt;InheritsExtendedAttribute($interface, &quot;OverrideBuiltins&quot;);
      my $ellidesCallsToBase = ($namedSetterOperation &amp;&amp; $overrideBuiltins) &amp;&amp; !$interface-&gt;extendedAttributes-&gt;{Plugin} &amp;&amp; !$namedSetterOperation-&gt;extendedAttributes-&gt;{CallNamedSetterOnlyForSupportedProperties};
      
      push(@$outputArray, &quot;bool ${className}::putByIndex(JSCell* cell, ExecState* state, unsigned index, JSValue value, bool&quot; . (!$ellidesCallsToBase ? &quot; shouldThrow&quot; : &quot;&quot;) . &quot;)\n&quot;);
      push(@$outputArray, &quot;{\n&quot;);
<span class="udiff-line-added">+     if ($namedSetterOperation || $interface-&gt;extendedAttributes-&gt;{Plugin}) {</span>
<span class="udiff-line-added">+         push(@$outputArray, &quot;    VM&amp; vm = state-&gt;vm();\n&quot;);</span>
<span class="udiff-line-added">+     }</span>
      push(@$outputArray, &quot;    auto* thisObject = jsCast&lt;${className}*&gt;(cell);\n&quot;);
      push(@$outputArray, &quot;    ASSERT_GC_OBJECT_INHERITS(thisObject, info());\n\n&quot;);
  
      assert(&quot;CEReactions is not supported on having both named setters and indexed setters&quot;) if $namedSetterOperation &amp;&amp; $namedSetterOperation-&gt;extendedAttributes-&gt;{CEReactions}
          &amp;&amp; $indexedSetterOperation &amp;&amp; $indexedSetterOperation-&gt;extendedAttributes-&gt;{CEReactions};
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1016,26 +1025,26 @@</span>
      }
      if ($indexedSetterOperation) {
          GenerateCustomElementReactionsStackIfNeeded($outputArray, $indexedSetterOperation, &quot;*state&quot;);
      }
      
<span class="udiff-line-modified-removed">-     if ($indexedSetterOperation ) {</span>
<span class="udiff-line-modified-added">+     if ($indexedSetterOperation) {</span>
          push(@$outputArray, &quot;    if (LIKELY(index &lt;= MAX_ARRAY_INDEX)) {\n&quot;);
          
          GenerateInvokeIndexedPropertySetter($outputArray, &quot;        &quot;, $interface, $indexedSetterOperation, &quot;index&quot;, &quot;value&quot;);
          
          push(@$outputArray, &quot;        return true;\n&quot;);
          push(@$outputArray, &quot;    }\n\n&quot;);
      }
      
      if ($namedSetterOperation) {
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto propertyName = Identifier::from(state, index);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    auto propertyName = Identifier::from(vm, index);\n&quot;);</span>
                  
          my $additionalIndent = &quot;&quot;;
          if (!$overrideBuiltins) {
              push(@$outputArray, &quot;    PropertySlot slot { thisObject, PropertySlot::InternalMethodType::VMInquiry };\n&quot;);
<span class="udiff-line-modified-removed">-             push(@$outputArray, &quot;    JSValue prototype = thisObject-&gt;getPrototypeDirect(state-&gt;vm());\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@$outputArray, &quot;    JSValue prototype = thisObject-&gt;getPrototypeDirect(vm);\n&quot;);</span>
              push(@$outputArray, &quot;    if (!(prototype.isObject() &amp;&amp; asObject(prototype)-&gt;getPropertySlot(state, propertyName, slot))) {\n&quot;);
              $additionalIndent .= &quot;    &quot;;
          }
          
          GenerateInvokeNamedPropertySetter($outputArray, $additionalIndent . &quot;    &quot;, $interface, $namedSetterOperation, &quot;value&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1051,11 +1060,11 @@</span>
      }
  
      assert(&quot;Using both a named property setter and [Plugin] together is not supported.&quot;) if $namedSetterOperation &amp;&amp; $interface-&gt;extendedAttributes-&gt;{Plugin};
      if ($interface-&gt;extendedAttributes-&gt;{Plugin}) {
          AddToImplIncludes(&quot;JSPluginElementFunctions.h&quot;);
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto propertyName = Identifier::from(state, index);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    auto propertyName = Identifier::from(vm, index);\n&quot;);</span>
          push(@$outputArray, &quot;    PutPropertySlot putPropertySlot(thisObject, shouldThrow);\n&quot;);
          push(@$outputArray, &quot;    bool putResult = false;\n&quot;);
          push(@$outputArray, &quot;    if (pluginElementCustomPut(thisObject, state, propertyName, value, putPropertySlot, putResult))\n&quot;);
          push(@$outputArray, &quot;        return putResult;\n\n&quot;);
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1339,11 +1348,12 @@</span>
      #       is all that needs to be done, no need to generate the .
  
      if (GetIndexedGetterOperation($interface)) {
          push(@$outputArray, &quot;    return !impl.isSupportedPropertyIndex(index);\n&quot;);
      } else {
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto propertyName = Identifier::from(state, index);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    VM&amp; vm = state-&gt;vm();\n&quot;);</span>
<span class="udiff-line-added">+         push(@$outputArray, &quot;    auto propertyName = Identifier::from(vm, index);\n&quot;);</span>
  
          # GenerateDeletePropertyCommon implements step 2.
          GenerateDeletePropertyCommon($outputArray, $interface, $className, $operation, $conditional);
  
          # FIXME: Instead of calling down JSObject::deletePropertyByIndex, perhaps we should implement
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -1703,15 +1713,17 @@</span>
          my $interfaceExposures = $interface-&gt;extendedAttributes-&gt;{Exposed} || &quot;Window&quot;;
          return 1 if !IsAlwaysExposedOnInterface($interfaceExposures, $context-&gt;extendedAttributes-&gt;{Exposed});
      }
  
      return $context-&gt;extendedAttributes-&gt;{EnabledAtRuntime}
<span class="udiff-line-added">+         || $context-&gt;extendedAttributes-&gt;{EnabledForContext}</span>
          || $context-&gt;extendedAttributes-&gt;{EnabledForWorld}
          || $context-&gt;extendedAttributes-&gt;{EnabledBySetting}
          || $context-&gt;extendedAttributes-&gt;{DisabledByQuirk}
          || $context-&gt;extendedAttributes-&gt;{SecureContext}
<span class="udiff-line-modified-removed">-         || $context-&gt;extendedAttributes-&gt;{ContextHasServiceWorkerScheme};</span>
<span class="udiff-line-modified-added">+         || $context-&gt;extendedAttributes-&gt;{ContextHasServiceWorkerScheme}</span>
<span class="udiff-line-added">+         || $context-&gt;extendedAttributes-&gt;{CustomEnabled};</span>
  }
  
  # https://heycam.github.io/webidl/#es-operations
  sub OperationShouldBeOnInstance
  {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2185,17 +2197,17 @@</span>
  sub GenerateDefaultValue
  {
      my ($typeScope, $context, $type, $defaultValue) = @_;
  
      if ($codeGenerator-&gt;IsStringType($type)) {
<span class="udiff-line-modified-removed">-         my $useAtomicString = $type-&gt;extendedAttributes-&gt;{AtomicString};</span>
<span class="udiff-line-modified-added">+         my $useAtomString = $type-&gt;extendedAttributes-&gt;{AtomString};</span>
          if ($defaultValue eq &quot;null&quot;) {
<span class="udiff-line-modified-removed">-             return $useAtomicString ? &quot;nullAtom()&quot; : &quot;String()&quot;;</span>
<span class="udiff-line-modified-added">+             return $useAtomString ? &quot;nullAtom()&quot; : &quot;String()&quot;;</span>
          } elsif ($defaultValue eq &quot;\&quot;\&quot;&quot;) {
<span class="udiff-line-modified-removed">-             return $useAtomicString ? &quot;emptyAtom()&quot; : &quot;emptyString()&quot;;</span>
<span class="udiff-line-modified-added">+             return $useAtomString ? &quot;emptyAtom()&quot; : &quot;emptyString()&quot;;</span>
          } else {
<span class="udiff-line-modified-removed">-             return $useAtomicString ? &quot;AtomicString(${defaultValue}, AtomicString::ConstructFromLiteral)&quot; : &quot;${defaultValue}_s&quot;;</span>
<span class="udiff-line-modified-added">+             return $useAtomString ? &quot;AtomString(${defaultValue}, AtomString::ConstructFromLiteral)&quot; : &quot;${defaultValue}_s&quot;;</span>
          }
      }
  
      if ($codeGenerator-&gt;IsEnumType($type)) {
          # FIXME: Would be nice to report an error if the value does not have quote marks around it.
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2328,20 +2340,26 @@</span>
              $member-&gt;default(&quot;undefined&quot;) if $member-&gt;type-&gt;name eq &quot;any&quot; and !defined($member-&gt;default); # Use undefined as default value for member of type &#39;any&#39; unless specified otherwise.
  
              my $type = $member-&gt;type;
              AddToImplIncludesForIDLType($type);
  
<span class="udiff-line-added">+             my $conditional = $member-&gt;extendedAttributes-&gt;{Conditional};</span>
<span class="udiff-line-added">+             if ($conditional) {</span>
<span class="udiff-line-added">+                 my $conditionalString = $codeGenerator-&gt;GenerateConditionalStringFromAttributeValue($conditional);</span>
<span class="udiff-line-added">+                 $result .= &quot;#if ${conditionalString}\n&quot;;</span>
<span class="udiff-line-added">+             }</span>
<span class="udiff-line-added">+ </span>
              # 4.1. Let key be the identifier of member.
              my $key = $member-&gt;name;
              my $implementedAsKey = $member-&gt;extendedAttributes-&gt;{ImplementedAs} || $key;
  
              # 4.2. Let value be an ECMAScript value, depending on Type(V):
              $result .= &quot;    JSValue ${key}Value;\n&quot;;
              $result .= &quot;    if (isNullOrUndefined)\n&quot;;
              $result .= &quot;        ${key}Value = jsUndefined();\n&quot;;
              $result .= &quot;    else {\n&quot;;
<span class="udiff-line-modified-removed">-             $result .= &quot;        ${key}Value = object-&gt;get(&amp;state, Identifier::fromString(&amp;state, \&quot;${key}\&quot;));\n&quot;;</span>
<span class="udiff-line-modified-added">+             $result .= &quot;        ${key}Value = object-&gt;get(&amp;state, Identifier::fromString(vm, \&quot;${key}\&quot;));\n&quot;;</span>
              $result .= &quot;        RETURN_IF_EXCEPTION(throwScope, { });\n&quot;;
              $result .= &quot;    }\n&quot;;
  
              my $IDLType = GetIDLType($typeScope, $type);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2364,10 +2382,12 @@</span>
                  $result .= &quot;        return { };\n&quot;;
                  $result .= &quot;    }\n&quot;;
              } else {
                  $result .= &quot;    }\n&quot;;
              }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+             $result .= &quot;#endif\n&quot; if $conditional;</span>
          }
      }
  
      # 5. Return dict.
      $result .= &quot;    return result;\n&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2395,30 +2415,49 @@</span>
              foreach my $member (@sortedMembers) {
                  my $key = $member-&gt;name;
                  my $implementedAsKey = $member-&gt;extendedAttributes-&gt;{ImplementedAs} || $key;
                  my $valueExpression = &quot;dictionary.${implementedAsKey}&quot;;
  
<span class="udiff-line-added">+                 my $conditional = $member-&gt;extendedAttributes-&gt;{Conditional};</span>
<span class="udiff-line-added">+                 if ($conditional) {</span>
<span class="udiff-line-added">+                     my $conditionalString = $codeGenerator-&gt;GenerateConditionalStringFromAttributeValue($conditional);</span>
<span class="udiff-line-added">+                     $result .= &quot;#if ${conditionalString}\n&quot;;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
                  # 1. Let key be the identifier of member.
                  # 2. If the dictionary member named key is present in V, then:
                      # 1. Let idlValue be the value of member on V.
                      # 2. Let value be the result of converting idlValue to an ECMAScript value.
                      # 3. Perform ! CreateDataProperty(O, key, value).
  
<span class="udiff-line-added">+                 my $needsRuntimeCheck = NeedsRuntimeCheck($dictionary, $member);</span>
<span class="udiff-line-added">+                 my $indent = &quot;&quot;;</span>
<span class="udiff-line-added">+                 if ($needsRuntimeCheck) {</span>
<span class="udiff-line-added">+                     my $runtimeEnableConditionalString = GenerateRuntimeEnableConditionalString($dictionary, $member, &quot;true&quot;);</span>
<span class="udiff-line-added">+                     $result .= &quot;    if (${runtimeEnableConditionalString}) {\n&quot;;</span>
<span class="udiff-line-added">+                     $indent = &quot;    &quot;;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+ </span>
                  if (!$member-&gt;isRequired &amp;&amp; not defined $member-&gt;default) {
                      my $IDLType = GetIDLType($typeScope, $member-&gt;type);
                      my $conversionExpression = NativeToJSValueUsingReferences($member, $typeScope, &quot;${IDLType}::extractValueFromNullable(${valueExpression})&quot;, &quot;globalObject&quot;);
  
<span class="udiff-line-modified-removed">-                     $result .= &quot;    if (!${IDLType}::isNullValue(${valueExpression})) {\n&quot;;</span>
<span class="udiff-line-modified-removed">-                     $result .= &quot;        auto ${key}Value = ${conversionExpression};\n&quot;;</span>
<span class="udiff-line-modified-removed">-                     $result .= &quot;        result-&gt;putDirect(vm, JSC::Identifier::fromString(&amp;vm, \&quot;${key}\&quot;), ${key}Value);\n&quot;;</span>
<span class="udiff-line-modified-removed">-                     $result .= &quot;    }\n&quot;;</span>
<span class="udiff-line-modified-added">+                     $result .= &quot;${indent}    if (!${IDLType}::isNullValue(${valueExpression})) {\n&quot;;</span>
<span class="udiff-line-modified-added">+                     $result .= &quot;${indent}        auto ${key}Value = ${conversionExpression};\n&quot;;</span>
<span class="udiff-line-modified-added">+                     $result .= &quot;${indent}        result-&gt;putDirect(vm, JSC::Identifier::fromString(vm, \&quot;${key}\&quot;), ${key}Value);\n&quot;;</span>
<span class="udiff-line-modified-added">+                     $result .= &quot;${indent}    }\n&quot;;</span>
                  } else {
                      my $conversionExpression = NativeToJSValueUsingReferences($member, $typeScope, $valueExpression, &quot;globalObject&quot;);
  
<span class="udiff-line-modified-removed">-                     $result .= &quot;    auto ${key}Value = ${conversionExpression};\n&quot;;</span>
<span class="udiff-line-modified-removed">-                     $result .= &quot;    result-&gt;putDirect(vm, JSC::Identifier::fromString(&amp;vm, \&quot;${key}\&quot;), ${key}Value);\n&quot;;</span>
<span class="udiff-line-modified-added">+                     $result .= &quot;${indent}    auto ${key}Value = ${conversionExpression};\n&quot;;</span>
<span class="udiff-line-modified-added">+                     $result .= &quot;${indent}    result-&gt;putDirect(vm, JSC::Identifier::fromString(vm, \&quot;${key}\&quot;), ${key}Value);\n&quot;;</span>
<span class="udiff-line-added">+                 }</span>
<span class="udiff-line-added">+                 if ($needsRuntimeCheck) {</span>
<span class="udiff-line-added">+                     $result .= &quot;    }\n&quot;;</span>
                  }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+                 $result .= &quot;#endif\n&quot; if $conditional;</span>
              }
          }
  
          $result .= &quot;    return result;\n&quot;;
          $result .= &quot;}\n\n&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2497,12 +2536,10 @@</span>
          if ($interface-&gt;isException) {
              $headerIncludes{&quot;&lt;JavaScriptCore/ErrorPrototype.h&gt;&quot;} = 1;
          }
      }
  
<span class="udiff-line-removed">-     $headerIncludes{&quot;$interfaceName.h&quot;} = 1 if $hasParent &amp;&amp; $interface-&gt;extendedAttributes-&gt;{JSGenerateToNativeObject};</span>
<span class="udiff-line-removed">- </span>
      $headerIncludes{&quot;SVGElement.h&quot;} = 1 if $className =~ /^JSSVG/;
  
      my $implType = GetImplClassName($interface);
  
      my $numConstants = @{$interface-&gt;constants};
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2510,12 +2547,15 @@</span>
      my $numOperations = @{$interface-&gt;operations};
  
      push(@headerContent, &quot;\nnamespace WebCore {\n\n&quot;);
  
      if ($codeGenerator-&gt;IsSVGAnimatedType($interface-&gt;type)) {
<span class="udiff-line-modified-removed">-         $headerIncludes{&quot;$interfaceName.h&quot;} = 1;</span>
<span class="udiff-line-modified-added">+         $headerIncludes{&quot;SVGAnimatedPropertyImpl.h&quot;} = 1;</span>
<span class="udiff-line-added">+     } elsif ($codeGenerator-&gt;IsSVGPathSegType($interface-&gt;type)) {</span>
<span class="udiff-line-added">+         $headerIncludes{&quot;SVGPathSegImpl.h&quot;} = 1;</span>
      } else {
<span class="udiff-line-added">+         $headerIncludes{&quot;$interfaceName.h&quot;} = 1 if $hasParent &amp;&amp; $interface-&gt;extendedAttributes-&gt;{JSGenerateToNativeObject};</span>
          # Implementation class forward declaration
          if (IsDOMGlobalObject($interface)) {
              AddClassForwardIfNeeded($interface-&gt;type);
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2561,11 +2601,13 @@</span>
          push(@headerContent, &quot;        $className* ptr = new (NotNull, JSC::allocateCell&lt;$className&gt;(globalObject-&gt;vm().heap)) $className(structure, *globalObject);\n&quot;);
          push(@headerContent, &quot;        ptr-&gt;finishCreation(globalObject-&gt;vm());\n&quot;);
          push(@headerContent, &quot;        return ptr;\n&quot;);
          push(@headerContent, &quot;    }\n\n&quot;);  
      } else {
<span class="udiff-line-modified-removed">-         AddIncludesForImplementationTypeInHeader($implType);</span>
<span class="udiff-line-modified-added">+         if (!$codeGenerator-&gt;IsSVGAnimatedType($interface-&gt;type) &amp;&amp; !$codeGenerator-&gt;IsSVGPathSegType($interface-&gt;type)) {</span>
<span class="udiff-line-added">+             AddIncludesForImplementationTypeInHeader($implType);</span>
<span class="udiff-line-added">+         }</span>
          push(@headerContent, &quot;    static $className* create(JSC::Structure* structure, JSDOMGlobalObject* globalObject, Ref&lt;$implType&gt;&amp;&amp; impl)\n&quot;);
          push(@headerContent, &quot;    {\n&quot;);
          push(@headerContent, &quot;        $className* ptr = new (NotNull, JSC::allocateCell&lt;$className&gt;(globalObject-&gt;vm().heap)) $className(structure, *globalObject, WTFMove(impl));\n&quot;);
          push(@headerContent, &quot;        ptr-&gt;finishCreation(globalObject-&gt;vm());\n&quot;);
          push(@headerContent, &quot;        return ptr;\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2621,10 +2663,15 @@</span>
          push(@headerContent, &quot;    static bool getOwnPropertySlot(JSC::JSObject*, JSC::ExecState*, JSC::PropertyName, JSC::PropertySlot&amp;);\n&quot;);
          $structureFlags{&quot;JSC::OverridesGetOwnPropertySlot&quot;} = 1;
          push(@headerContent, &quot;    static bool getOwnPropertySlotByIndex(JSC::JSObject*, JSC::ExecState*, unsigned propertyName, JSC::PropertySlot&amp;);\n&quot;);
          $structureFlags{&quot;JSC::InterceptsGetOwnPropertySlotByIndexEvenWhenLengthIsNotZero&quot;} = 1;
      }
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+     if ($interface-&gt;extendedAttributes-&gt;{CheckSecurity}) {</span>
<span class="udiff-line-added">+         push(@headerContent, &quot;    static void doPutPropertySecurityCheck(JSC::JSObject*, JSC::ExecState*, JSC::PropertyName, JSC::PutPropertySlot&amp;);\n&quot;);</span>
<span class="udiff-line-added">+         $structureFlags{&quot;JSC::HasPutPropertySecurityCheck&quot;} = 1;</span>
<span class="udiff-line-added">+     }</span>
      
      if (InstanceOverridesGetOwnPropertyNames($interface)) {
          push(@headerContent, &quot;    static void getOwnPropertyNames(JSC::JSObject*, JSC::ExecState*, JSC::PropertyNameArray&amp;, JSC::EnumerationMode = JSC::EnumerationMode());\n&quot;);
          $structureFlags{&quot;JSC::OverridesGetPropertyNames&quot;} = 1;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -2761,11 +2808,11 @@</span>
              push(@headerContent, &quot;    template&lt;typename, JSC::SubspaceAccess&gt; static JSC::CompleteSubspace* subspaceFor(JSC::VM&amp; vm) { return $subspaceFunc(vm); }\n&quot;);
          }
      }
  
      if (NeedsImplementationClass($interface)) {
<span class="udiff-line-modified-removed">-         push(@headerContent, &quot;    static void heapSnapshot(JSCell*, JSC::HeapSnapshotBuilder&amp;);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@headerContent, &quot;    static void analyzeHeap(JSCell*, JSC::HeapAnalyzer&amp;);\n&quot;);</span>
      }
      
      if ($numCustomAttributes &gt; 0) {
          push(@headerContent, &quot;\n    // Custom attributes\n&quot;);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3728,10 +3775,17 @@</span>
          foreach my $flag (@flags) {
              push(@conjuncts, &quot;downcast&lt;Document&gt;(jsCast&lt;JSDOMGlobalObject*&gt;(&quot; . $globalObjectPtr . &quot;)-&gt;scriptExecutionContext())-&gt;settings().&quot; . ToMethodName($flag) . &quot;Enabled()&quot;);
          }
      }
  
<span class="udiff-line-added">+     if ($context-&gt;extendedAttributes-&gt;{CustomEnabled}) {</span>
<span class="udiff-line-added">+         assert(&quot;CustomEnabled can only be used by interfaces only exposed to the Window&quot;) if $interface-&gt;extendedAttributes-&gt;{Exposed} &amp;&amp; $interface-&gt;extendedAttributes-&gt;{Exposed} ne &quot;Window&quot;;</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         my $className = &quot;JS&quot; . $interface-&gt;type-&gt;name;</span>
<span class="udiff-line-added">+         push(@conjuncts, &quot;${className}&quot; . $codeGenerator-&gt;WK_ucfirst($context-&gt;name) . &quot;IsEnabled()&quot;);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      if ($context-&gt;extendedAttributes-&gt;{DisabledByQuirk}) {
          assert(&quot;Must specify value for DisabledByQuirk.&quot;) if $context-&gt;extendedAttributes-&gt;{DisabledByQuirk} eq &quot;VALUE_IS_MISSING&quot;;
  
          AddToImplIncludes(&quot;Document.h&quot;);
          AddToImplIncludes(&quot;Quirks.h&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3753,10 +3807,19 @@</span>
          foreach my $flag (@flags) {
              push(@conjuncts, &quot;RuntimeEnabledFeatures::sharedFeatures().&quot; . ToMethodName($flag) . &quot;Enabled()&quot;);
          }
      }
  
<span class="udiff-line-added">+     if ($context-&gt;extendedAttributes-&gt;{EnabledForContext}) {</span>
<span class="udiff-line-added">+         assert(&quot;Must not specify value for EnabledForContext.&quot;) unless $context-&gt;extendedAttributes-&gt;{EnabledForContext} eq &quot;VALUE_IS_MISSING&quot;;</span>
<span class="udiff-line-added">+         assert(&quot;EnabledForContext must be an interface or constructor attribute.&quot;) unless $codeGenerator-&gt;IsConstructorType($context-&gt;type);</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         my $contextRef = &quot;*jsCast&lt;JSDOMGlobalObject*&gt;(&quot; . $globalObjectPtr . &quot;)-&gt;scriptExecutionContext()&quot;;</span>
<span class="udiff-line-added">+         my $name = $context-&gt;name;</span>
<span class="udiff-line-added">+         push(@conjuncts,  &quot;${name}::enabledForContext(&quot; . $contextRef . &quot;)&quot;);</span>
<span class="udiff-line-added">+     }</span>
<span class="udiff-line-added">+ </span>
      my $result = join(&quot; &amp;&amp; &quot;, @conjuncts);
      $result = &quot;($result)&quot; if @conjuncts &gt; 1;
      return $result;
  }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3779,16 +3842,16 @@</span>
      return if scalar(@unscopables) == 0;
  
      AddToImplIncludes(&quot;&lt;JavaScriptCore/ObjectConstructor.h&gt;&quot;);
      push(@implContent, &quot;    JSObject&amp; unscopables = *constructEmptyObject(globalObject()-&gt;globalExec(), globalObject()-&gt;nullPrototypeObjectStructure());\n&quot;);
      foreach my $unscopable (@unscopables) {
<span class="udiff-line-modified-removed">-         push(@implContent, &quot;    unscopables.putDirect(vm, Identifier::fromString(&amp;vm, \&quot;$unscopable\&quot;), jsBoolean(true));\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@implContent, &quot;    unscopables.putDirect(vm, Identifier::fromString(vm, \&quot;$unscopable\&quot;), jsBoolean(true));\n&quot;);</span>
      }
      push(@implContent, &quot;    putDirectWithoutTransition(vm, vm.propertyNames-&gt;unscopablesSymbol, &amp;unscopables, JSC::PropertyAttribute::DontEnum | JSC::PropertyAttribute::ReadOnly);\n&quot;);
  }
  
<span class="udiff-line-modified-removed">- sub GetUnsafeArgumentType</span>
<span class="udiff-line-modified-added">+ sub GetArgumentTypeForFunctionWithoutTypeCheck</span>
  {
      my ($interface, $type) = @_;
  
      my $IDLType = GetIDLType($interface, $type);
      return &quot;DOMJIT::IDLJSArgumentType&lt;${IDLType}&gt;&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3908,15 +3971,15 @@</span>
              push(@implContent, &quot;#if ${conditionalString}\n&quot;) if $conditionalString;
              my $functionName = GetFunctionName($interface, $className, $operation);
              push(@implContent, &quot;JSC::EncodedJSValue JSC_HOST_CALL ${functionName}(JSC::ExecState*);\n&quot;);
              if ($operation-&gt;extendedAttributes-&gt;{DOMJIT}) {
                  $implIncludes{&quot;DOMJITIDLType.h&quot;} = 1;
<span class="udiff-line-modified-removed">-                 my $unsafeFunctionName = &quot;unsafe&quot; . $codeGenerator-&gt;WK_ucfirst($functionName);</span>
<span class="udiff-line-modified-removed">-                 my $functionSignature = &quot;JSC::EncodedJSValue JIT_OPERATION ${unsafeFunctionName}(JSC::ExecState*, $className*&quot;;</span>
<span class="udiff-line-modified-added">+                 my $nameOfFunctionWithoutTypeCheck = $codeGenerator-&gt;WK_lcfirst($functionName) . &quot;WithoutTypeCheck&quot;;</span>
<span class="udiff-line-modified-added">+                 my $functionSignature = &quot;JSC::EncodedJSValue JIT_OPERATION ${nameOfFunctionWithoutTypeCheck}(JSC::ExecState*, $className*&quot;;</span>
                  foreach my $argument (@{$operation-&gt;arguments}) {
                      my $type = $argument-&gt;type;
<span class="udiff-line-modified-removed">-                     my $argumentType = GetUnsafeArgumentType($interface, $type);</span>
<span class="udiff-line-modified-added">+                     my $argumentType = GetArgumentTypeForFunctionWithoutTypeCheck($interface, $type);</span>
                      $functionSignature .= &quot;, ${argumentType}&quot;;
                  }
                  push(@implContent, $functionSignature . &quot;);\n&quot;);
              }
              push(@implContent, &quot;#endif\n&quot;) if $conditionalString;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -3971,15 +4034,15 @@</span>
              die &quot;Overloads is not supported in DOMJIT&quot; if $isOverloaded;
              die &quot;Currently ReadDOM value is only allowed&quot; unless $codeGenerator-&gt;ExtendedAttributeContains($operation-&gt;extendedAttributes-&gt;{DOMJIT}, &quot;ReadDOM&quot;);
  
              my $interfaceName = $interface-&gt;type-&gt;name;
              my $functionName = GetFunctionName($interface, $className, $operation);
<span class="udiff-line-modified-removed">-             my $unsafeFunctionName = &quot;unsafe&quot; . $codeGenerator-&gt;WK_ucfirst($functionName);</span>
<span class="udiff-line-modified-added">+             my $nameOfFunctionWithoutTypeCheck = $codeGenerator-&gt;WK_lcfirst($functionName) . &quot;WithoutTypeCheck&quot;;</span>
              my $domJITSignatureName = &quot;DOMJITSignatureFor&quot; . $interface-&gt;type-&gt;name . $codeGenerator-&gt;WK_ucfirst($operation-&gt;name);
              my $classInfo = &quot;JS&quot; . $interface-&gt;type-&gt;name . &quot;::info()&quot;;
              my $resultType = GetResultTypeFilter($interface, $operation-&gt;type);
<span class="udiff-line-modified-removed">-             my $domJITSignatureHeader = &quot;static const JSC::DOMJIT::Signature ${domJITSignatureName}((uintptr_t)${unsafeFunctionName},&quot;;</span>
<span class="udiff-line-modified-added">+             my $domJITSignatureHeader = &quot;static const JSC::DOMJIT::Signature ${domJITSignatureName}(${nameOfFunctionWithoutTypeCheck},&quot;;</span>
              my $domJITSignatureFooter = &quot;$classInfo, JSC::DOMJIT::Effect::forRead(DOMJIT::AbstractHeapRepository::DOM), ${resultType}&quot;;
              foreach my $argument (@{$operation-&gt;arguments}) {
                  my $type = $argument-&gt;type;
                  my $argumentType = GetArgumentTypeFilter($interface, $type);
                  $domJITSignatureFooter .= &quot;, ${argumentType}&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4205,11 +4268,11 @@</span>
              push(@implContent, &quot;#if ${conditionalString}\n&quot;) if $conditionalString;
              my $runtimeEnableConditionalString = GenerateRuntimeEnableConditionalString($interface, $operationOrAttribute);
              my $name = $operationOrAttribute-&gt;name;
              push(@implContent, &quot;    if (!${runtimeEnableConditionalString}) {\n&quot;);
              push(@implContent, &quot;        hasDisabledRuntimeProperties = true;\n&quot;);
<span class="udiff-line-modified-removed">-             push(@implContent, &quot;        auto propertyName = Identifier::fromString(&amp;vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;$name\&quot;), strlen(\&quot;$name\&quot;));\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@implContent, &quot;        auto propertyName = Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;$name\&quot;), strlen(\&quot;$name\&quot;));\n&quot;);</span>
              push(@implContent, &quot;        VM::DeletePropertyModeScope scope(vm, VM::DeletePropertyMode::IgnoreConfigurable);\n&quot;);
              push(@implContent, &quot;        JSObject::deleteProperty(this, globalObject()-&gt;globalExec(), propertyName);\n&quot;);
              push(@implContent, &quot;    }\n&quot;);
              push(@implContent, &quot;#endif\n&quot;) if $conditionalString;
          }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4444,14 +4507,15 @@</span>
          my $castingFunction = $interface-&gt;extendedAttributes-&gt;{CustomProxyToJSObject} ? &quot;to${className}&quot; : GetCastingHelperForThisObject($interface);
          # FIXME: Remove ImplicitThis keyword as it is no longer defined by WebIDL spec and is only used in DOMWindow.
          if ($interface-&gt;extendedAttributes-&gt;{ImplicitThis}) {
              push(@implContent, &quot;template&lt;&gt; inline ${className}* IDLAttribute&lt;${className}&gt;::cast(ExecState&amp; state, EncodedJSValue thisValue)\n&quot;);
              push(@implContent, &quot;{\n&quot;);
<span class="udiff-line-added">+             push(@implContent, &quot;    VM&amp; vm = state.vm();\n&quot;);</span>
              push(@implContent, &quot;    auto decodedThisValue = JSValue::decode(thisValue);\n&quot;);
              push(@implContent, &quot;    if (decodedThisValue.isUndefinedOrNull())\n&quot;);
              push(@implContent, &quot;        decodedThisValue = state.thisValue().toThis(&amp;state, NotStrictMode);\n&quot;);
<span class="udiff-line-modified-removed">-             push(@implContent, &quot;    return $castingFunction(state.vm(), decodedThisValue);&quot;);</span>
<span class="udiff-line-modified-added">+             push(@implContent, &quot;    return $castingFunction(vm, decodedThisValue);&quot;);</span>
              push(@implContent, &quot;}\n\n&quot;);
          } else {
              push(@implContent, &quot;template&lt;&gt; inline ${className}* IDLAttribute&lt;${className}&gt;::cast(ExecState&amp; state, EncodedJSValue thisValue)\n&quot;);
              push(@implContent, &quot;{\n&quot;);
              push(@implContent, &quot;    return $castingFunction(state.vm(), JSValue::decode(thisValue));\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4565,20 +4629,20 @@</span>
          push(@implContent, &quot;    return Base::estimatedSize(thisObject, vm) + thisObject-&gt;wrapped().memoryCost();\n&quot;);
          push(@implContent, &quot;}\n\n&quot;);
      }
  
      if (NeedsImplementationClass($interface) &amp;&amp; !$interface-&gt;extendedAttributes-&gt;{CustomHeapSnapshot}) {
<span class="udiff-line-modified-removed">-         AddToImplIncludes(&quot;&lt;JavaScriptCore/HeapSnapshotBuilder.h&gt;&quot;);</span>
<span class="udiff-line-modified-added">+         AddToImplIncludes(&quot;&lt;JavaScriptCore/HeapAnalyzer.h&gt;&quot;);</span>
          AddToImplIncludes(&quot;ScriptExecutionContext.h&quot;);
          AddToImplIncludes(&quot;&lt;wtf/URL.h&gt;&quot;);
<span class="udiff-line-modified-removed">-         push(@implContent, &quot;void ${className}::heapSnapshot(JSCell* cell, HeapSnapshotBuilder&amp; builder)\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@implContent, &quot;void ${className}::analyzeHeap(JSCell* cell, HeapAnalyzer&amp; analyzer)\n&quot;);</span>
          push(@implContent, &quot;{\n&quot;);
          push(@implContent, &quot;    auto* thisObject = jsCast&lt;${className}*&gt;(cell);\n&quot;);
<span class="udiff-line-modified-removed">-         push(@implContent, &quot;    builder.setWrappedObjectForCell(cell, &amp;thisObject-&gt;wrapped());\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@implContent, &quot;    analyzer.setWrappedObjectForCell(cell, &amp;thisObject-&gt;wrapped());\n&quot;);</span>
          push(@implContent, &quot;    if (thisObject-&gt;scriptExecutionContext())\n&quot;);
<span class="udiff-line-modified-removed">-         push(@implContent, &quot;        builder.setLabelForCell(cell, \&quot;url \&quot; + thisObject-&gt;scriptExecutionContext()-&gt;url().string());\n&quot;);</span>
<span class="udiff-line-modified-removed">-         push(@implContent, &quot;    Base::heapSnapshot(cell, builder);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@implContent, &quot;        analyzer.setLabelForCell(cell, \&quot;url \&quot; + thisObject-&gt;scriptExecutionContext()-&gt;url().string());\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@implContent, &quot;    Base::analyzeHeap(cell, analyzer);\n&quot;);</span>
          push(@implContent, &quot;}\n\n&quot;);
      }
  
      if ($indexedGetterOperation) {
          $implIncludes{&quot;&lt;wtf/URL.h&gt;&quot;} = 1 if $indexedGetterOperation-&gt;type-&gt;name eq &quot;DOMString&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4640,16 +4704,24 @@</span>
                  $rootString .= &quot;        *reason = \&quot;Reachable from ${interfaceName}\&quot;;\n&quot;;
              } elsif (GetGenerateIsReachable($interface) eq &quot;ImplWebGLRenderingContext&quot;) {
                  $rootString  = &quot;    WebGLRenderingContextBase* root = WTF::getPtr(js${interfaceName}-&gt;wrapped().context());\n&quot;;
                  $rootString .= &quot;    if (UNLIKELY(reason))\n&quot;;
                  $rootString .= &quot;        *reason = \&quot;Reachable from ${interfaceName}\&quot;;\n&quot;;
<span class="udiff-line-modified-removed">-             } elsif (GetGenerateIsReachable($interface) eq &quot;ImplFrame&quot;) {</span>
<span class="udiff-line-modified-removed">-                 $rootString  = &quot;    Frame* root = WTF::getPtr(js${interfaceName}-&gt;wrapped().frame());\n&quot;;</span>
<span class="udiff-line-modified-added">+             } elsif (GetGenerateIsReachable($interface) eq &quot;ReachableFromDOMWindow&quot;) {</span>
<span class="udiff-line-modified-added">+                 $rootString  = &quot;    auto* root = WTF::getPtr(js${interfaceName}-&gt;wrapped().window());\n&quot;;</span>
                  $rootString .= &quot;    if (!root)\n&quot;;
                  $rootString .= &quot;        return false;\n&quot;;
                  $rootString .= &quot;    if (UNLIKELY(reason))\n&quot;;
<span class="udiff-line-modified-removed">-                 $rootString .= &quot;        *reason = \&quot;Reachable from Frame\&quot;;\n&quot;;</span>
<span class="udiff-line-modified-added">+                 $rootString .= &quot;        *reason = \&quot;Reachable from Window\&quot;;\n&quot;;</span>
<span class="udiff-line-added">+             } elsif (GetGenerateIsReachable($interface) eq &quot;ReachableFromNavigator&quot;) {</span>
<span class="udiff-line-added">+                 $implIncludes{&quot;Navigator.h&quot;} = 1;</span>
<span class="udiff-line-added">+                 $implIncludes{&quot;WorkerNavigator.h&quot;} = 1;</span>
<span class="udiff-line-added">+                 $rootString  = &quot;    NavigatorBase* root = WTF::getPtr(js${interfaceName}-&gt;wrapped().navigator());\n&quot;;</span>
<span class="udiff-line-added">+                 $rootString .= &quot;    if (!root)\n&quot;;</span>
<span class="udiff-line-added">+                 $rootString .= &quot;        return false;\n&quot;;</span>
<span class="udiff-line-added">+                 $rootString .= &quot;    if (UNLIKELY(reason))\n&quot;;</span>
<span class="udiff-line-added">+                 $rootString .= &quot;        *reason = \&quot;Reachable from Navigator\&quot;;\n&quot;;</span>
              } elsif (GetGenerateIsReachable($interface) eq &quot;ImplDocument&quot;) {
                  $rootString  = &quot;    Document* root = WTF::getPtr(js${interfaceName}-&gt;wrapped().document());\n&quot;;
                  $rootString .= &quot;    if (!root)\n&quot;;
                  $rootString .= &quot;        return false;\n&quot;;
                  $rootString .= &quot;    if (UNLIKELY(reason))\n&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4680,11 +4752,11 @@</span>
                  $rootString .= &quot;    if (UNLIKELY(reason))\n&quot;;
                  $rootString .= &quot;        *reason = \&quot;Reachable from js${interfaceName}\&quot;;\n&quot;;
              }
  
              push(@implContent, $rootString);
<span class="udiff-line-modified-removed">-             push(@implContent, &quot;    return root &amp;&amp; visitor.containsOpaqueRoot(root);\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@implContent, &quot;    return visitor.containsOpaqueRoot(root);\n&quot;);</span>
          } else {
              if (!$emittedJSCast) {
                  push(@implContent, &quot;    UNUSED_PARAM(handle);\n&quot;);
              }
              push(@implContent, &quot;    UNUSED_PARAM(visitor);\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4916,11 +4988,16 @@</span>
      push(@signatureArguments, &quot;JSValue value&quot;);
      push(@signatureArguments, &quot;ThrowScope&amp; throwScope&quot;);
      
      push(@$outputArray, &quot;static inline bool ${attributeSetterBodyName}(&quot; . join(&quot;, &quot;, @signatureArguments) . &quot;)\n&quot;);
      push(@$outputArray, &quot;{\n&quot;);
<span class="udiff-line-modified-removed">-     push(@$outputArray, &quot;    UNUSED_PARAM(throwScope);\n&quot;);</span>
<span class="udiff-line-modified-added">+     push(@$outputArray, &quot;    UNUSED_PARAM(state);\n&quot;);</span>
<span class="udiff-line-added">+     if ($codeGenerator-&gt;IsConstructorType($attribute-&gt;type) || $attribute-&gt;extendedAttributes-&gt;{Replaceable} || $attribute-&gt;extendedAttributes-&gt;{PutForwards}) {</span>
<span class="udiff-line-added">+         push(@$outputArray, &quot;    VM&amp; vm = throwScope.vm();\n&quot;);</span>
<span class="udiff-line-added">+     } else {</span>
<span class="udiff-line-added">+         push(@$outputArray, &quot;    UNUSED_PARAM(throwScope);\n&quot;);</span>
<span class="udiff-line-added">+     }</span>
  
      GenerateCustomElementReactionsStackIfNeeded($outputArray, $attribute, &quot;state&quot;);
  
      if ($interface-&gt;extendedAttributes-&gt;{CheckSecurity} &amp;&amp; !$attribute-&gt;extendedAttributes-&gt;{DoNotCheckSecurity} &amp;&amp; !$attribute-&gt;extendedAttributes-&gt;{DoNotCheckSecurityOnSetter}) {
          AddToImplIncludes(&quot;JSDOMBindingSecurity.h&quot;, $conditional);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4960,25 +5037,25 @@</span>
          if ($constructorType ne &quot;any&quot; and $constructorType !~ /Named$/) {
              AddToImplIncludes(&quot;JS&quot; . $constructorType . &quot;.h&quot;, $conditional);
          }
          my $id = $attribute-&gt;name;
          push(@$outputArray, &quot;    // Shadowing a built-in constructor.\n&quot;);
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    return thisObject.putDirect(state.vm(), Identifier::fromString(&amp;state.vm(), reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;)), value);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    return thisObject.putDirect(vm, Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;)), value);\n&quot;);</span>
      } elsif ($attribute-&gt;extendedAttributes-&gt;{Replaceable}) {
          my $id = $attribute-&gt;name;
          push(@$outputArray, &quot;    // Shadowing a built-in property.\n&quot;);
          if (AttributeShouldBeOnInstance($interface, $attribute)) {
<span class="udiff-line-modified-removed">-             push(@$outputArray, &quot;    return replaceStaticPropertySlot(state.vm(), &amp;thisObject, Identifier::fromString(&amp;state.vm(), reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;)), value);\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@$outputArray, &quot;    return replaceStaticPropertySlot(vm, &amp;thisObject, Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;)), value);\n&quot;);</span>
          } else {
<span class="udiff-line-modified-removed">-             push(@$outputArray, &quot;    return thisObject.putDirect(state.vm(), Identifier::fromString(&amp;state.vm(), reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;)), value);\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@$outputArray, &quot;    return thisObject.putDirect(vm, Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;)), value);\n&quot;);</span>
          }
      } elsif ($attribute-&gt;extendedAttributes-&gt;{PutForwards}) {
          assert(&quot;[PutForwards] is not compatible with static attributes&quot;) if $attribute-&gt;isStatic;
          
          # 3.5.9.1. Let Q be ? Get(O, id).
          my $id = $attribute-&gt;name;
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto id = Identifier::fromString(&amp;state.vm(), reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;));\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    auto id = Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;${id}\&quot;), strlen(\&quot;${id}\&quot;));\n&quot;);</span>
          push(@$outputArray, &quot;    auto valueToForwardTo = thisObject.get(&amp;state, id);\n&quot;);
          push(@$outputArray, &quot;    RETURN_IF_EXCEPTION(throwScope, false);\n&quot;);
          
          # 3.5.9.2. If Type(Q) is not Object, then throw a TypeError.
          push(@$outputArray, &quot;    if (UNLIKELY(!valueToForwardTo.isObject())) {\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -4986,17 +5063,17 @@</span>
          push(@$outputArray, &quot;        return false;\n&quot;);
          push(@$outputArray, &quot;    }\n&quot;);
          
          # 3.5.9.3. Let forwardId be the identifier argument of the [PutForwards] extended attribute.
          my $forwardId = $attribute-&gt;extendedAttributes-&gt;{PutForwards};
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    auto forwardId = Identifier::fromString(&amp;state.vm(), reinterpret_cast&lt;const LChar*&gt;(\&quot;${forwardId}\&quot;), strlen(\&quot;${forwardId}\&quot;));\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    auto forwardId = Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;${forwardId}\&quot;), strlen(\&quot;${forwardId}\&quot;));\n&quot;);</span>
          
          # 3.5.9.4. Perform ? Set(Q, forwardId, V).
          # FIXME: What should the second value to the PutPropertySlot be?
          # (https://github.com/heycam/webidl/issues/368)
          push(@$outputArray, &quot;    PutPropertySlot slot(valueToForwardTo, false);\n&quot;);
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    asObject(valueToForwardTo)-&gt;methodTable(state.vm())-&gt;put(asObject(valueToForwardTo), &amp;state, forwardId, value, slot);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    asObject(valueToForwardTo)-&gt;methodTable(vm)-&gt;put(asObject(valueToForwardTo), &amp;state, forwardId, value, slot);\n&quot;);</span>
          push(@$outputArray, &quot;    RETURN_IF_EXCEPTION(throwScope, false);\n&quot;);
          
          push(@$outputArray, &quot;    return true;\n&quot;);
      } else {
          push(@$outputArray, &quot;    auto&amp; impl = thisObject.wrapped();\n&quot;) if !$attribute-&gt;isStatic;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5029,12 +5106,11 @@</span>
          unshift(@arguments, GenerateCallWithUsingReferences($attribute-&gt;extendedAttributes-&gt;{CallWith}, $outputArray, &quot;false&quot;, &quot;thisObject&quot;));
  
          my $callTracingCallback = $attribute-&gt;extendedAttributes-&gt;{CallTracingCallback} || $interface-&gt;extendedAttributes-&gt;{CallTracingCallback};
          if ($callTracingCallback) {
              my $indent = &quot;    &quot;;
<span class="udiff-line-modified-removed">-             my @callTracerArguments = ();</span>
<span class="udiff-line-removed">-             push(@callTracerArguments, GenerateCallTracerParameter(&quot;nativeValue&quot;, $attribute-&gt;type, 0, $indent));</span>
<span class="udiff-line-modified-added">+             my @callTracerArguments = (&quot;nativeValue&quot;);</span>
              GenerateCallTracer($outputArray, $callTracingCallback, $attribute-&gt;name, \@callTracerArguments, $indent);
          }
  
          my $functionString = &quot;${functionName}(&quot; . join(&quot;, &quot;, @arguments) . &quot;)&quot;;
          push(@$outputArray, &quot;    AttributeSetter::call(state, throwScope, [&amp;] {\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5257,24 +5333,24 @@</span>
              my $conditionalString = $codeGenerator-&gt;GenerateConditionalStringFromAttributeValue($conditional);
              push(@$outputArray, &quot;#if ${conditionalString}\n&quot;);
          }
  
          AddToImplIncludes(&quot;&lt;JavaScriptCore/FrameTracers.h&gt;&quot;, $conditional);
<span class="udiff-line-modified-removed">-         my $unsafeFunctionName = &quot;unsafe&quot; . $codeGenerator-&gt;WK_ucfirst($functionName);</span>
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;JSC::EncodedJSValue JIT_OPERATION ${unsafeFunctionName}(JSC::ExecState* state, $className* castedThis&quot;);</span>
<span class="udiff-line-modified-added">+         my $nameOfFunctionWithoutTypeCheck = $codeGenerator-&gt;WK_lcfirst($functionName) . &quot;WithoutTypeCheck&quot;;</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;JSC::EncodedJSValue JIT_OPERATION ${nameOfFunctionWithoutTypeCheck}(JSC::ExecState* state, $className* castedThis&quot;);</span>
          foreach my $argument (@{$operation-&gt;arguments}) {
              my $type = $argument-&gt;type;
<span class="udiff-line-modified-removed">-             my $argumentType = GetUnsafeArgumentType($interface, $type);</span>
<span class="udiff-line-modified-added">+             my $argumentType = GetArgumentTypeForFunctionWithoutTypeCheck($interface, $type);</span>
              my $name = $argument-&gt;name;
              my $encodedName = &quot;encoded&quot; . $codeGenerator-&gt;WK_ucfirst($name);
              push(@$outputArray, &quot;, ${argumentType} ${encodedName}&quot;);
          }
          push(@$outputArray, &quot;)\n&quot;);
          push(@$outputArray, &quot;{\n&quot;);
          push(@$outputArray, &quot;    UNUSED_PARAM(state);\n&quot;);
          push(@$outputArray, &quot;    VM&amp; vm = state-&gt;vm();\n&quot;);
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;    JSC::NativeCallFrameTracer tracer(&amp;vm, state);\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;    JSC::NativeCallFrameTracer tracer(vm, state);\n&quot;);</span>
          push(@$outputArray, &quot;    auto throwScope = DECLARE_THROW_SCOPE(vm);\n&quot;);
          push(@$outputArray, &quot;    UNUSED_PARAM(throwScope);\n&quot;);
          push(@$outputArray, &quot;    auto&amp; impl = castedThis-&gt;wrapped();\n&quot;);
          
          my $implFunctionName = GetFullyQualifiedImplementationCallName($interface, $operation, $functionImplementationName, &quot;impl&quot;, $conditional);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5287,11 +5363,11 @@</span>
              my $type = $argument-&gt;type;
              my $name = $argument-&gt;name;
              my $encodedName = &quot;encoded&quot; . $codeGenerator-&gt;WK_ucfirst($name);
              my $shouldPassByReference = ShouldPassArgumentByReference($argument);
  
<span class="udiff-line-modified-removed">-             my ($nativeValue, $mayThrowException) = UnsafeToNative($interface, $argument, $encodedName, $operation-&gt;extendedAttributes-&gt;{Conditional});</span>
<span class="udiff-line-modified-added">+             my ($nativeValue, $mayThrowException) = ToNativeForFunctionWithoutTypeCheck($interface, $argument, $encodedName, $operation-&gt;extendedAttributes-&gt;{Conditional});</span>
              push(@$outputArray, &quot;    auto $name = ${nativeValue};\n&quot;);
              push(@$outputArray, &quot;    RETURN_IF_EXCEPTION(throwScope, encodedJSValue());\n&quot;) if $mayThrowException;
              $value = &quot;WTFMove($name)&quot;;
  
              if ($shouldPassByReference) {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -5373,19 +5449,19 @@</span>
          if ($codeGenerator-&gt;IsInterfaceType($attribute-&gt;type)) {
              my $attributeInterfaceName = $attribute-&gt;type-&gt;name;
              if ($attribute-&gt;type-&gt;isNullable) {
                  push(@implContent, &quot;    if (!${name}Value.isNull()) {\n&quot;);
                  push(@implContent, &quot;        auto* ${name}SerializedValue = JS${attributeInterfaceName}::serialize(state, *jsCast&lt;JS${attributeInterfaceName}*&gt;(${name}Value), globalObject, throwScope);\n&quot;);
<span class="udiff-line-modified-removed">-                 push(@implContent, &quot;        result-&gt;putDirect(vm, Identifier::fromString(&amp;vm, \&quot;${name}\&quot;), ${name}SerializedValue);\n&quot;);</span>
<span class="udiff-line-modified-added">+                 push(@implContent, &quot;        result-&gt;putDirect(vm, Identifier::fromString(vm, \&quot;${name}\&quot;), ${name}SerializedValue);\n&quot;);</span>
                  push(@implContent, &quot;    } else\n&quot;);
<span class="udiff-line-modified-removed">-                 push(@implContent, &quot;        result-&gt;putDirect(vm, Identifier::fromString(&amp;vm, \&quot;${name}\&quot;), ${name}Value);\n&quot;);</span>
<span class="udiff-line-modified-added">+                 push(@implContent, &quot;        result-&gt;putDirect(vm, Identifier::fromString(vm, \&quot;${name}\&quot;), ${name}Value);\n&quot;);</span>
              } else {
                  push(@implContent, &quot;    auto* ${name}SerializedValue = JS${attributeInterfaceName}::serialize(state, *jsCast&lt;JS${attributeInterfaceName}*&gt;(${name}Value), globalObject, throwScope);\n&quot;);
<span class="udiff-line-modified-removed">-                 push(@implContent, &quot;    result-&gt;putDirect(vm, Identifier::fromString(&amp;vm, \&quot;${name}\&quot;), ${name}SerializedValue);\n&quot;);</span>
<span class="udiff-line-modified-added">+                 push(@implContent, &quot;    result-&gt;putDirect(vm, Identifier::fromString(vm, \&quot;${name}\&quot;), ${name}SerializedValue);\n&quot;);</span>
              }
          } else {
<span class="udiff-line-modified-removed">-             push(@implContent, &quot;    result-&gt;putDirect(vm, Identifier::fromString(&amp;vm, \&quot;${name}\&quot;), ${name}Value);\n&quot;);</span>
<span class="udiff-line-modified-added">+             push(@implContent, &quot;    result-&gt;putDirect(vm, Identifier::fromString(vm, \&quot;${name}\&quot;), ${name}Value);\n&quot;);</span>
          }
  
          push(@implContent, &quot;\n&quot;);
      }
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6172,11 +6248,11 @@</span>
              my $callbackInvocation;
              if (ref($interfaceOrCallback) eq &quot;IDLCallbackFunction&quot;) {
                  $callbackInvocation = &quot;m_data-&gt;invokeCallback(thisValue, args, JSCallbackData::CallbackType::Function, Identifier(), returnedException)&quot;;
              } else {
                  my $callbackType = $numOperations &gt; 1 ? &quot;Object&quot; : &quot;FunctionOrObject&quot;;
<span class="udiff-line-modified-removed">-                 $callbackInvocation = &quot;m_data-&gt;invokeCallback(thisValue, args, JSCallbackData::CallbackType::${callbackType}, Identifier::fromString(&amp;vm, \&quot;${functionName}\&quot;), returnedException)&quot;;</span>
<span class="udiff-line-modified-added">+                 $callbackInvocation = &quot;m_data-&gt;invokeCallback(thisValue, args, JSCallbackData::CallbackType::${callbackType}, Identifier::fromString(vm, \&quot;${functionName}\&quot;), returnedException)&quot;;</span>
              }
  
              if ($operation-&gt;type-&gt;name eq &quot;void&quot;) {
                  push(@$contentRef, &quot;    ${callbackInvocation};\n&quot;);
              } else {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6200,11 +6276,11 @@</span>
                  my $nativeValue = JSValueToNative($interfaceOrCallback, $operation, &quot;jsResult&quot;, &quot;&quot;, &quot;&amp;state&quot;, &quot;state&quot;);
              
                  push(@$contentRef, &quot;    auto throwScope = DECLARE_THROW_SCOPE(vm);\n&quot;);
                  push(@$contentRef, &quot;    auto returnValue = ${nativeValue};\n&quot;);
                  push(@$contentRef, &quot;    RETURN_IF_EXCEPTION(throwScope, CallbackResultType::ExceptionThrown);\n&quot;);
<span class="udiff-line-modified-removed">-                 push(@$contentRef, &quot;    return WTFMove(returnValue);\n&quot;);</span>
<span class="udiff-line-modified-added">+                 push(@$contentRef, &quot;    return returnValue;\n&quot;);</span>
              }
  
              push(@$contentRef, &quot;}\n\n&quot;);
          }
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6228,14 +6304,11 @@</span>
  {
      my ($outputArray, $operation, $interface, $functionString, $indent) = @_;
  
      my $callTracingCallback = $operation-&gt;extendedAttributes-&gt;{CallTracingCallback} || $interface-&gt;extendedAttributes-&gt;{CallTracingCallback};
      if ($callTracingCallback) {
<span class="udiff-line-modified-removed">-         my @callTracerArguments = ();</span>
<span class="udiff-line-removed">-         foreach my $argument (@{$operation-&gt;arguments}) {</span>
<span class="udiff-line-removed">-             push(@callTracerArguments, GenerateCallTracerParameter($argument-&gt;name, $argument-&gt;type, $argument-&gt;isOptional &amp;&amp; !defined($argument-&gt;default), $indent));</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-modified-added">+         my @callTracerArguments = map { $_-&gt;name } @{$operation-&gt;arguments};</span>
          GenerateCallTracer($outputArray, $callTracingCallback, $operation-&gt;name, \@callTracerArguments, $indent);
      }
  
      if (OperationHasForcedReturnValue($operation)) {
          push(@$outputArray, $indent . &quot;$functionString;\n&quot;);
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6415,23 +6488,23 @@</span>
      my ($type) = @_;
  
      return 1 if $type-&gt;extendedAttributes-&gt;{Clamp};
      return 1 if $type-&gt;extendedAttributes-&gt;{EnforceRange};
      return 1 if $type-&gt;extendedAttributes-&gt;{TreatNullAs} &amp;&amp; $type-&gt;extendedAttributes-&gt;{TreatNullAs} eq &quot;EmptyString&quot;;
<span class="udiff-line-modified-removed">-     return 1 if $type-&gt;extendedAttributes-&gt;{AtomicString};</span>
<span class="udiff-line-modified-removed">-     return 1 if $type-&gt;extendedAttributes-&gt;{RequiresExistingAtomicString};</span>
<span class="udiff-line-modified-added">+     return 1 if $type-&gt;extendedAttributes-&gt;{AtomString};</span>
<span class="udiff-line-modified-added">+     return 1 if $type-&gt;extendedAttributes-&gt;{RequiresExistingAtomString};</span>
  }
  
  sub GetAnnotatedIDLType
  {
      my ($type) = @_;
  
      return &quot;IDLClampAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{Clamp};
      return &quot;IDLEnforceRangeAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{EnforceRange};
      return &quot;IDLTreatNullAsEmptyAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{TreatNullAs} &amp;&amp; $type-&gt;extendedAttributes-&gt;{TreatNullAs} eq &quot;EmptyString&quot;;
<span class="udiff-line-modified-removed">-     return &quot;IDLAtomicStringAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{AtomicString};</span>
<span class="udiff-line-modified-removed">-     return &quot;IDLRequiresExistingAtomicStringAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{RequiresExistingAtomicString};</span>
<span class="udiff-line-modified-added">+     return &quot;IDLAtomStringAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{AtomString};</span>
<span class="udiff-line-modified-added">+     return &quot;IDLRequiresExistingAtomStringAdaptor&quot; if $type-&gt;extendedAttributes-&gt;{RequiresExistingAtomString};</span>
  }
  
  sub GetBaseIDLType
  {
      my ($interface, $type) = @_;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -6579,11 +6652,11 @@</span>
      push(@conversionArguments, $exceptionThrower) if $exceptionThrower;
  
      return &quot;convert&lt;$IDLType&gt;(&quot; . join(&quot;, &quot;, @conversionArguments) . &quot;)&quot;;
  }
  
<span class="udiff-line-modified-removed">- sub UnsafeToNative</span>
<span class="udiff-line-modified-added">+ sub ToNativeForFunctionWithoutTypeCheck</span>
  {
      my ($interface, $context, $value, $conditional, $statePointer, $stateReference, $thisObjectReference) = @_;
  
      assert(&quot;Invalid context type&quot;) if !IsValidContextForJSValueToNative($context);
  
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -7292,11 +7365,11 @@</span>
          push(@$outputArray, &quot;    UNUSED_PARAM(globalObject);\n&quot;);
      } else {
          push(@$outputArray, &quot;    putDirect(vm, vm.propertyNames-&gt;prototype, ${className}::prototype(vm, globalObject), JSC::PropertyAttribute::DontDelete | JSC::PropertyAttribute::ReadOnly | JSC::PropertyAttribute::DontEnum);\n&quot;);
      }
  
<span class="udiff-line-modified-removed">-     push(@$outputArray, &quot;    putDirect(vm, vm.propertyNames-&gt;name, jsNontrivialString(&amp;vm, String(\&quot;$visibleInterfaceName\&quot;_s)), JSC::PropertyAttribute::ReadOnly | JSC::PropertyAttribute::DontEnum);\n&quot;);</span>
<span class="udiff-line-modified-added">+     push(@$outputArray, &quot;    putDirect(vm, vm.propertyNames-&gt;name, jsNontrivialString(vm, String(\&quot;$visibleInterfaceName\&quot;_s)), JSC::PropertyAttribute::ReadOnly | JSC::PropertyAttribute::DontEnum);\n&quot;);</span>
      push(@$outputArray, &quot;    putDirect(vm, vm.propertyNames-&gt;length, jsNumber(${leastConstructorLength}), JSC::PropertyAttribute::ReadOnly | JSC::PropertyAttribute::DontEnum);\n&quot;) if defined $leastConstructorLength;
  
      my $classForThis = &quot;${className}::info()&quot;;
      if ($interface-&gt;isCallback) {
          $classForThis = &quot;nullptr&quot;;
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -7309,11 +7382,11 @@</span>
          my $conditionalString = $codeGenerator-&gt;GenerateConditionalString($operationOrAttribute);
          push(@$outputArray, &quot;#if ${conditionalString}\n&quot;) if $conditionalString;
          my $runtimeEnableConditionalString = GenerateRuntimeEnableConditionalString($interface, $operationOrAttribute, &quot;true&quot;);
          my $name = $operationOrAttribute-&gt;name;
          push(@$outputArray, &quot;    if (!${runtimeEnableConditionalString}) {\n&quot;);
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;        auto propertyName = Identifier::fromString(&amp;vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;$name\&quot;), strlen(\&quot;$name\&quot;));\n&quot;);</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;        auto propertyName = Identifier::fromString(vm, reinterpret_cast&lt;const LChar*&gt;(\&quot;$name\&quot;), strlen(\&quot;$name\&quot;));\n&quot;);</span>
          push(@$outputArray, &quot;        VM::DeletePropertyModeScope scope(vm, VM::DeletePropertyMode::IgnoreConfigurable);\n&quot;);
          push(@$outputArray, &quot;        JSObject::deleteProperty(this, globalObject.globalExec(), propertyName);\n&quot;);
          push(@$outputArray, &quot;    }\n&quot;);
          push(@$outputArray, &quot;#endif\n&quot;) if $conditionalString;
      }
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -7471,61 +7544,22 @@</span>
      foreach my $attribute (@{$interface-&gt;attributes}) {
          AddToImplIncludes(GetJSBuiltinScopeName($interface, $attribute) . &quot;Builtins.h&quot;, $attribute-&gt;extendedAttributes-&gt;{Conditional}) if IsJSBuiltin($interface, $attribute);
      }
  }
  
<span class="udiff-line-removed">- sub GenerateCallTracerParameter()</span>
<span class="udiff-line-removed">- {</span>
<span class="udiff-line-removed">-     my ($name, $type, $optional, $indent) = @_;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     my $result = &quot;&quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ($optional || $type-&gt;isNullable) {</span>
<span class="udiff-line-removed">-         $result .= $indent . &quot;    if (&quot; . $name . &quot;)\n&quot;;</span>
<span class="udiff-line-removed">-         $result .= &quot;    &quot;;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     $result .= $indent . &quot;    &quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ($type-&gt;isUnion) {</span>
<span class="udiff-line-removed">-         $result .= &quot;WTF::visit([&amp;] (auto&amp; value) { callTracerParameters.append(value); }, &quot;;</span>
<span class="udiff-line-removed">-     } else {</span>
<span class="udiff-line-removed">-         $result .= &quot;callTracerParameters.append(&quot;;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     if ($optional || ($type-&gt;isUnion &amp;&amp; $type-&gt;isNullable)) {</span>
<span class="udiff-line-removed">-         $result .= &quot;*&quot;;</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     $result .= $name . &quot;);&quot;;</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     return $result;</span>
<span class="udiff-line-removed">- }</span>
<span class="udiff-line-removed">- </span>
  sub GenerateCallTracer()
  {
      my ($outputArray, $callTracingCallback, $name, $arguments, $indent) = @_;
  
      AddToImplIncludes(&quot;CallTracer.h&quot;);
  
<span class="udiff-line-modified-removed">-     my $count = scalar(@$arguments);</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     push(@$outputArray, $indent . &quot;if (UNLIKELY(impl.callTracingActive()))&quot;);</span>
<span class="udiff-line-removed">-     if ($count) {</span>
<span class="udiff-line-removed">-         push(@$outputArray, &quot; {\n&quot;);</span>
<span class="udiff-line-removed">-         push(@$outputArray, $indent . &quot;    Vector&lt;&quot; . $codeGenerator-&gt;WK_ucfirst($callTracingCallback) . &quot;Variant&gt; callTracerParameters;\n&quot;);</span>
<span class="udiff-line-removed">-         push(@$outputArray, join(&quot;\n&quot;, @$arguments));</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-removed">-     push(@$outputArray, &quot;\n&quot;);</span>
<span class="udiff-line-modified-added">+     push(@$outputArray, $indent . &quot;if (UNLIKELY(impl.callTracingActive()))\n&quot;);</span>
      push(@$outputArray, $indent . &quot;    CallTracer::&quot; . $callTracingCallback . &quot;(impl, \&quot;&quot; . $name . &quot;\&quot;_s&quot;);
<span class="udiff-line-modified-removed">-     if ($count) {</span>
<span class="udiff-line-modified-removed">-         push(@$outputArray, &quot;, WTFMove(callTracerParameters)&quot;);</span>
<span class="udiff-line-modified-added">+     if (scalar(@$arguments)) {</span>
<span class="udiff-line-modified-added">+         push(@$outputArray, &quot;, { &quot; . join(&quot;, &quot;, @$arguments) . &quot; }&quot;);</span>
      }
      push(@$outputArray, &quot;);\n&quot;);
<span class="udiff-line-removed">-     if ($count) {</span>
<span class="udiff-line-removed">-         push(@$outputArray, $indent . &quot;}\n&quot;)</span>
<span class="udiff-line-removed">-     }</span>
  }
  
  sub GenerateCustomElementReactionsStackIfNeeded
  {
      my ($outputArray, $context, $stateVariable) = @_;
</pre>
<center><a href="CodeGenerator.pm.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="IDLAttributes.json.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>