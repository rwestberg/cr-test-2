<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/ImageOrientation.h</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="ImageFrame.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ImageSource.cpp.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/ImageOrientation.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -1,7 +1,8 @@</span>
  /*
   * Copyright (C) 2010 Google Inc. All rights reserved.
<span class="udiff-line-added">+  * Copyright (C) 2012-2019 Apple Inc. All rights reserved.</span>
   *
   * Redistribution and use in source and binary forms, with or without
   * modification, are permitted provided that the following conditions
   * are met:
   *
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -21,109 +22,102 @@</span>
   * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
   * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
   * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
   */
  
<span class="udiff-line-modified-removed">- #ifndef ImageOrientation_h</span>
<span class="udiff-line-modified-removed">- #define ImageOrientation_h</span>
<span class="udiff-line-modified-added">+ #pragma once</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-added">+ #include &quot;AffineTransform.h&quot;</span>
<span class="udiff-line-added">+ #include &quot;FloatSize.h&quot;</span>
  
  namespace WebCore {
  
<span class="udiff-line-modified-removed">- class AffineTransform;</span>
<span class="udiff-line-modified-removed">- class FloatSize;</span>
<span class="udiff-line-modified-removed">- </span>
<span class="udiff-line-removed">- // This enum intentionally matches the orientation values from the EXIF spec.</span>
<span class="udiff-line-removed">- // See JEITA CP-3451, page 18. http://www.exif.org/Exif2-2.PDF</span>
<span class="udiff-line-removed">- enum ImageOrientationEnum {</span>
<span class="udiff-line-removed">-     // &quot;TopLeft&quot; means that the 0 row starts at the Top, the 0 column starts at the Left.</span>
<span class="udiff-line-removed">-     OriginTopLeft = 1, // default</span>
<span class="udiff-line-removed">-     OriginTopRight = 2, // mirror along y-axis</span>
<span class="udiff-line-removed">-     OriginBottomRight = 3, // 180 degree rotation</span>
<span class="udiff-line-removed">-     OriginBottomLeft = 4, // mirror along the x-axis</span>
<span class="udiff-line-removed">-     OriginLeftTop = 5, // mirror along x-axis + 270 degree CW rotation</span>
<span class="udiff-line-removed">-     OriginRightTop = 6, // 90 degree CW rotation</span>
<span class="udiff-line-removed">-     OriginRightBottom = 7, // mirror along x-axis + 90 degree CW rotation</span>
<span class="udiff-line-removed">-     OriginLeftBottom = 8, // 270 degree CW rotation</span>
<span class="udiff-line-removed">-     // All other values are &quot;reserved&quot; as of EXIF 2.2</span>
<span class="udiff-line-removed">-     DefaultImageOrientation = OriginTopLeft,</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-modified-added">+ struct ImageOrientation {</span>
<span class="udiff-line-modified-added">+     enum Orientation {</span>
<span class="udiff-line-modified-added">+         FromImage         = 0, // Orientation from the image should be respected.</span>
  
<span class="udiff-line-modified-removed">- enum RespectImageOrientationEnum {</span>
<span class="udiff-line-modified-removed">-     DoNotRespectImageOrientation = 0,</span>
<span class="udiff-line-modified-removed">-     RespectImageOrientation = 1</span>
<span class="udiff-line-modified-removed">- };</span>
<span class="udiff-line-modified-added">+         // This range intentionally matches the orientation values from the EXIF spec.</span>
<span class="udiff-line-modified-added">+         // See JEITA CP-3451, page 18. http://www.exif.org/Exif2-2.PDF</span>
<span class="udiff-line-modified-added">+         OriginTopLeft     = 1, // default</span>
<span class="udiff-line-modified-added">+         OriginTopRight    = 2, // mirror along y-axis</span>
<span class="udiff-line-added">+         OriginBottomRight = 3, // 180 degree rotation</span>
<span class="udiff-line-added">+         OriginBottomLeft  = 4, // mirror along the x-axis</span>
<span class="udiff-line-added">+         OriginLeftTop     = 5, // mirror along x-axis + 270 degree CW rotation</span>
<span class="udiff-line-added">+         OriginRightTop    = 6, // 90 degree CW rotation</span>
<span class="udiff-line-added">+         OriginRightBottom = 7, // mirror along x-axis + 90 degree CW rotation</span>
<span class="udiff-line-added">+         OriginLeftBottom  = 8, // 270 degree CW rotation</span>
  
<span class="udiff-line-modified-removed">- struct ImageOrientationDescription {</span>
<span class="udiff-line-modified-removed">-     ImageOrientationDescription(RespectImageOrientationEnum shouldRespectImageOrientation,</span>
<span class="udiff-line-removed">-         ImageOrientationEnum orientation)</span>
<span class="udiff-line-removed">-         : m_respectOrientation(shouldRespectImageOrientation)</span>
<span class="udiff-line-removed">-         , m_orientation(orientation)</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+         None              = OriginTopLeft</span>
<span class="udiff-line-modified-added">+     };</span>
  
<span class="udiff-line-modified-removed">-     ImageOrientationDescription()</span>
<span class="udiff-line-removed">-         : m_respectOrientation(DoNotRespectImageOrientation)</span>
<span class="udiff-line-removed">-         , m_orientation(DefaultImageOrientation)</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     ImageOrientation() = default;</span>
  
<span class="udiff-line-modified-removed">-     ImageOrientationDescription(RespectImageOrientationEnum shouldRespectImageOrientation)</span>
<span class="udiff-line-modified-removed">-         : m_respectOrientation(shouldRespectImageOrientation)</span>
<span class="udiff-line-removed">-         , m_orientation(DefaultImageOrientation)</span>
<span class="udiff-line-modified-added">+     ImageOrientation(Orientation orientation)</span>
<span class="udiff-line-modified-added">+         : m_orientation(orientation)</span>
      {
      }
  
<span class="udiff-line-modified-removed">-     void setRespectImageOrientation(RespectImageOrientationEnum shouldRespectImageOrientation) { m_respectOrientation = shouldRespectImageOrientation; }</span>
<span class="udiff-line-removed">-     RespectImageOrientationEnum respectImageOrientation() { return m_respectOrientation; }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     void setImageOrientationEnum(ImageOrientationEnum orientation) { m_orientation = orientation; }</span>
<span class="udiff-line-removed">-     ImageOrientationEnum imageOrientation() { return m_orientation; }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     RespectImageOrientationEnum m_respectOrientation;</span>
<span class="udiff-line-removed">-     ImageOrientationEnum m_orientation;</span>
<span class="udiff-line-removed">- };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- class ImageOrientation {</span>
<span class="udiff-line-removed">- public:</span>
<span class="udiff-line-removed">-     ImageOrientation()</span>
<span class="udiff-line-removed">-         : m_orientation(DefaultImageOrientation)</span>
<span class="udiff-line-modified-added">+     static Orientation fromEXIFValue(int exifValue)</span>
      {
<span class="udiff-line-added">+         return isValidEXIFOrientation(exifValue) ? static_cast&lt;Orientation&gt;(exifValue) : None;</span>
      }
  
<span class="udiff-line-modified-removed">-     explicit ImageOrientation(ImageOrientationEnum orientation)</span>
<span class="udiff-line-removed">-         : m_orientation(orientation)</span>
<span class="udiff-line-removed">-     {</span>
<span class="udiff-line-removed">-     }</span>
<span class="udiff-line-modified-added">+     operator Orientation() const { return m_orientation; }</span>
  
      bool usesWidthAsHeight() const
      {
<span class="udiff-line-added">+         ASSERT(isValidEXIFOrientation(m_orientation));</span>
          // Values 5 through 8 all flip the width/height.
<span class="udiff-line-modified-removed">-         return m_orientation &gt;= OriginLeftTop;</span>
<span class="udiff-line-modified-added">+         return m_orientation &gt;= OriginLeftTop &amp;&amp; m_orientation &lt;= OriginLeftBottom;</span>
      }
  
<span class="udiff-line-modified-removed">-     // ImageOrientationEnum currently matches EXIF values, however code outside</span>
<span class="udiff-line-removed">-     // this function should never assume that.</span>
<span class="udiff-line-removed">-     static ImageOrientation fromEXIFValue(int exifValue)</span>
<span class="udiff-line-modified-added">+     AffineTransform transformFromDefault(const FloatSize&amp; drawnSize) const</span>
      {
<span class="udiff-line-modified-removed">-         // Values direct from images may be invalid, in which case we use the default.</span>
<span class="udiff-line-modified-removed">-         if (exifValue &lt; OriginTopLeft || exifValue &gt; OriginLeftBottom)</span>
<span class="udiff-line-modified-removed">-             return ImageOrientation();</span>
<span class="udiff-line-modified-removed">-         return ImageOrientation(static_cast&lt;ImageOrientationEnum&gt;(exifValue));</span>
<span class="udiff-line-modified-added">+         float w = drawnSize.width();</span>
<span class="udiff-line-modified-added">+         float h = drawnSize.height();</span>
<span class="udiff-line-modified-added">+ </span>
<span class="udiff-line-modified-added">+         switch (m_orientation) {</span>
<span class="udiff-line-added">+         case FromImage:</span>
<span class="udiff-line-added">+             ASSERT_NOT_REACHED();</span>
<span class="udiff-line-added">+             return AffineTransform();</span>
<span class="udiff-line-added">+         case OriginTopLeft:</span>
<span class="udiff-line-added">+             return AffineTransform();</span>
<span class="udiff-line-added">+         case OriginTopRight:</span>
<span class="udiff-line-added">+             return AffineTransform(-1,  0,  0,  1,  w, 0);</span>
<span class="udiff-line-added">+         case OriginBottomRight:</span>
<span class="udiff-line-added">+             return AffineTransform(-1,  0,  0, -1,  w, h);</span>
<span class="udiff-line-added">+         case OriginBottomLeft:</span>
<span class="udiff-line-added">+             return AffineTransform( 1,  0,  0, -1,  0, h);</span>
<span class="udiff-line-added">+         case OriginLeftTop:</span>
<span class="udiff-line-added">+             return AffineTransform( 0,  1,  1,  0,  0, 0);</span>
<span class="udiff-line-added">+         case OriginRightTop:</span>
<span class="udiff-line-added">+             return AffineTransform( 0,  1, -1,  0,  w, 0);</span>
<span class="udiff-line-added">+         case OriginRightBottom:</span>
<span class="udiff-line-added">+             return AffineTransform( 0, -1, -1,  0,  w, h);</span>
<span class="udiff-line-added">+         case OriginLeftBottom:</span>
<span class="udiff-line-added">+             return AffineTransform( 0, -1,  1,  0,  0, h);</span>
<span class="udiff-line-added">+         }</span>
<span class="udiff-line-added">+ </span>
<span class="udiff-line-added">+         ASSERT_NOT_REACHED();</span>
<span class="udiff-line-added">+         return AffineTransform();</span>
      }
  
<span class="udiff-line-modified-removed">-     // This transform can be used for drawing an image according to the orientation.</span>
<span class="udiff-line-modified-removed">-     // It should be used in a right-handed coordinate system.</span>
<span class="udiff-line-modified-removed">-     AffineTransform transformFromDefault(const FloatSize&amp; drawnSize) const;</span>
<span class="udiff-line-modified-added">+ private:</span>
<span class="udiff-line-modified-added">+     static const Orientation EXIFFirst = OriginTopLeft;</span>
<span class="udiff-line-modified-added">+     static const Orientation EXIFLast = OriginLeftBottom;</span>
<span class="udiff-line-added">+     static const Orientation First = FromImage;</span>
<span class="udiff-line-added">+     static const Orientation Last = EXIFLast;</span>
  
<span class="udiff-line-modified-removed">-     inline operator ImageOrientationEnum() const { return m_orientation; }</span>
<span class="udiff-line-modified-added">+     static bool isValidOrientation(int orientation)</span>
<span class="udiff-line-added">+     {</span>
<span class="udiff-line-added">+         return orientation &gt;= static_cast&lt;int&gt;(First) &amp;&amp; orientation &lt;= static_cast&lt;int&gt;(Last);</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">-     inline bool operator==(const ImageOrientation&amp; other) const { return other.m_orientation == m_orientation; }</span>
<span class="udiff-line-modified-removed">-     inline bool operator!=(const ImageOrientation&amp; other) const { return !(*this == other); }</span>
<span class="udiff-line-modified-added">+     static bool isValidEXIFOrientation(int orientation)</span>
<span class="udiff-line-modified-added">+     {</span>
<span class="udiff-line-added">+         return orientation &gt;= static_cast&lt;int&gt;(EXIFFirst) &amp;&amp; orientation &lt;= static_cast&lt;int&gt;(EXIFLast);</span>
<span class="udiff-line-added">+     }</span>
  
<span class="udiff-line-modified-removed">- private:</span>
<span class="udiff-line-removed">-     // FIXME: This only needs to be one byte.</span>
<span class="udiff-line-removed">-     ImageOrientationEnum m_orientation;</span>
<span class="udiff-line-modified-added">+     Orientation m_orientation { None };</span>
  };
  
  } // namespace WebCore
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">- #endif // ImageOrientation_h</span>
</pre>
<center><a href="ImageFrame.h.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="ImageSource.cpp.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>