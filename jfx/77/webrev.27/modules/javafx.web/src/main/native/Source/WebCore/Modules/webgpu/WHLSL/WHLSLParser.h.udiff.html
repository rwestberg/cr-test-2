<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Udiff modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/WHLSLParser.h</title>
    <link rel="stylesheet" href="../../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="WHLSLParser.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="WHLSLProgram.h.udiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/Modules/webgpu/WHLSL/WHLSLParser.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-new-header">@@ -25,178 +25,117 @@</span>
  
  #pragma once
  
  #if ENABLE(WEBGPU)
  
<span class="udiff-line-modified-removed">- #include &quot;WHLSLArrayReferenceType.h&quot;</span>
<span class="udiff-line-modified-removed">- #include &quot;WHLSLArrayType.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLAssignmentExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLBaseFunctionAttribute.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLBaseSemantic.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLBlock.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLBooleanLiteral.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLBreak.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLBuiltInSemantic.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLCallExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLCommaExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLConstantExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLContinue.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLDereferenceExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLDoWhileLoop.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLDotExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLEffectfulExpressionStatement.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLEnumerationDefinition.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLEnumerationMember.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLFallthrough.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLFloatLiteral.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLForLoop.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLFunctionAttribute.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLFunctionDeclaration.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLFunctionDefinition.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLIfStatement.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLIndexExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLIntegerLiteral.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;WHLSLAST.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;WHLSLError.h&quot;</span>
  #include &quot;WHLSLLexer.h&quot;
<span class="udiff-line-modified-removed">- #include &quot;WHLSLLogicalExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLLogicalNotExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLMakeArrayReferenceExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLMakePointerExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLNativeFunctionDeclaration.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLNativeTypeDeclaration.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLNode.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLNullLiteral.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLNumThreadsFunctionAttribute.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLPointerType.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLProgram.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLPropertyAccessExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLQualifier.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLReadModifyWriteExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLReferenceType.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLResourceSemantic.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLReturn.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLSemantic.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLSpecializationConstantSemantic.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLStageInOutSemantic.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLStatement.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLStructureDefinition.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLStructureElement.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLSwitchCase.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLSwitchStatement.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLTernaryExpression.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLTrap.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLType.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLTypeArgument.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLTypeDefinition.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLTypeReference.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLUnsignedIntegerLiteral.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLValue.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLVariableDeclaration.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLVariableDeclarationsStatement.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLVariableReference.h&quot;</span>
<span class="udiff-line-removed">- #include &quot;WHLSLWhileLoop.h&quot;</span>
<span class="udiff-line-modified-added">+ #include &quot;WHLSLParsingMode.h&quot;</span>
  #include &lt;wtf/Expected.h&gt;
  #include &lt;wtf/Optional.h&gt;
<span class="udiff-line-added">+ #include &lt;wtf/PrintStream.h&gt;</span>
  
  namespace WebCore {
  
  namespace WHLSL {
  
<span class="udiff-line-added">+ class Program;</span>
<span class="udiff-line-added">+ </span>
  class Parser {
  public:
<span class="udiff-line-modified-removed">-     enum class Mode {</span>
<span class="udiff-line-removed">-         StandardLibrary,</span>
<span class="udiff-line-removed">-         User</span>
<span class="udiff-line-removed">-     };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     struct Error {</span>
<span class="udiff-line-removed">-         Error(String&amp;&amp; error)</span>
<span class="udiff-line-removed">-             : error(WTFMove(error))</span>
<span class="udiff-line-removed">-         {</span>
<span class="udiff-line-removed">-         }</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-         String error;</span>
<span class="udiff-line-removed">-     };</span>
<span class="udiff-line-removed">- </span>
<span class="udiff-line-removed">-     Optional&lt;Error&gt; parse(Program&amp;, StringView, Mode);</span>
<span class="udiff-line-modified-added">+     Expected&lt;void, Error&gt; parse(Program&amp;, StringView, ParsingMode, AST::NameSpace);</span>
  
  private:
<span class="udiff-line-added">+     // FIXME: We should not need this</span>
<span class="udiff-line-added">+     // https://bugs.webkit.org/show_bug.cgi?id=198357</span>
      template&lt;typename T&gt; T backtrackingScope(std::function&lt;T()&gt; callback)
      {
          auto state = m_lexer.state();
          auto result = callback();
          if (result)
              return result;
          m_lexer.setState(WTFMove(state));
          return result;
      }
  
<span class="udiff-line-modified-removed">-     Unexpected&lt;Error&gt; fail(const String&amp; message);</span>
<span class="udiff-line-modified-removed">-     Expected&lt;Lexer::Token, Error&gt; peek();</span>
<span class="udiff-line-modified-removed">-     Optional&lt;Lexer::Token&gt; tryType(Lexer::Token::Type);</span>
<span class="udiff-line-modified-removed">-     Optional&lt;Lexer::Token&gt; tryTypes(Vector&lt;Lexer::Token::Type&gt;);</span>
<span class="udiff-line-modified-removed">-     Expected&lt;Lexer::Token, Error&gt; consumeType(Lexer::Token::Type);</span>
<span class="udiff-line-modified-removed">-     Expected&lt;Lexer::Token, Error&gt; consumeTypes(Vector&lt;Lexer::Token::Type&gt;);</span>
<span class="udiff-line-modified-added">+     enum class TryToPeek {</span>
<span class="udiff-line-modified-added">+         Yes,</span>
<span class="udiff-line-modified-added">+         No</span>
<span class="udiff-line-modified-added">+     };</span>
<span class="udiff-line-modified-added">+     Unexpected&lt;Error&gt; fail(const String&amp; message, TryToPeek = TryToPeek::Yes);</span>
<span class="udiff-line-modified-added">+     Expected&lt;Token, Error&gt; peek();</span>
<span class="udiff-line-added">+     Expected&lt;Token, Error&gt; peekFurther();</span>
<span class="udiff-line-added">+     bool peekType(Token::Type);</span>
<span class="udiff-line-added">+     template &lt;Token::Type... types&gt;</span>
<span class="udiff-line-added">+     bool peekTypes();</span>
<span class="udiff-line-added">+     Optional&lt;Token&gt; tryType(Token::Type);</span>
<span class="udiff-line-added">+     template &lt;Token::Type... types&gt;</span>
<span class="udiff-line-added">+     Optional&lt;Token&gt; tryTypes();</span>
<span class="udiff-line-added">+     Expected&lt;Token, Error&gt; consumeType(Token::Type);</span>
<span class="udiff-line-added">+     template &lt;Token::Type... types&gt;</span>
<span class="udiff-line-added">+     Expected&lt;Token, Error&gt; consumeTypes();</span>
  
      Expected&lt;Variant&lt;int, unsigned&gt;, Error&gt; consumeIntegralLiteral();
      Expected&lt;unsigned, Error&gt; consumeNonNegativeIntegralLiteral();
      Expected&lt;AST::ConstantExpression, Error&gt; parseConstantExpression();
      Expected&lt;AST::TypeArgument, Error&gt; parseTypeArgument();
      Expected&lt;AST::TypeArguments, Error&gt; parseTypeArguments();
      struct TypeSuffixAbbreviated {
<span class="udiff-line-modified-removed">-         Lexer::Token token;</span>
<span class="udiff-line-modified-added">+         CodeLocation location;</span>
<span class="udiff-line-added">+         Token token;</span>
          Optional&lt;unsigned&gt; numElements;
      };
      Expected&lt;TypeSuffixAbbreviated, Error&gt; parseTypeSuffixAbbreviated();
      struct TypeSuffixNonAbbreviated {
<span class="udiff-line-modified-removed">-         Lexer::Token token;</span>
<span class="udiff-line-modified-added">+         CodeLocation location;</span>
<span class="udiff-line-added">+         Token token;</span>
          Optional&lt;AST::AddressSpace&gt; addressSpace;
          Optional&lt;unsigned&gt; numElements;
      };
      Expected&lt;TypeSuffixNonAbbreviated, Error&gt; parseTypeSuffixNonAbbreviated();
<span class="udiff-line-modified-removed">-     Expected&lt;UniqueRef&lt;AST::UnnamedType&gt;, Error&gt; parseAddressSpaceType();</span>
<span class="udiff-line-modified-removed">-     Expected&lt;UniqueRef&lt;AST::UnnamedType&gt;, Error&gt; parseNonAddressSpaceType();</span>
<span class="udiff-line-modified-removed">-     Expected&lt;UniqueRef&lt;AST::UnnamedType&gt;, Error&gt; parseType();</span>
<span class="udiff-line-modified-added">+     Expected&lt;Ref&lt;AST::UnnamedType&gt;, Error&gt; parseAddressSpaceType();</span>
<span class="udiff-line-modified-added">+     Expected&lt;Ref&lt;AST::UnnamedType&gt;, Error&gt; parseNonAddressSpaceType();</span>
<span class="udiff-line-modified-added">+     Expected&lt;Ref&lt;AST::UnnamedType&gt;, Error&gt; parseType();</span>
      Expected&lt;AST::TypeDefinition, Error&gt; parseTypeDefinition();
      Expected&lt;AST::BuiltInSemantic, Error&gt; parseBuiltInSemantic();
      Expected&lt;AST::ResourceSemantic, Error&gt; parseResourceSemantic();
      Expected&lt;AST::SpecializationConstantSemantic, Error&gt; parseSpecializationConstantSemantic();
      Expected&lt;AST::StageInOutSemantic, Error&gt; parseStageInOutSemantic();
<span class="udiff-line-modified-removed">-     Expected&lt;AST::Semantic, Error&gt; parseSemantic();</span>
<span class="udiff-line-modified-added">+     Expected&lt;std::unique_ptr&lt;AST::Semantic&gt;, Error&gt; parseSemantic();</span>
      AST::Qualifiers parseQualifiers();
      Expected&lt;AST::StructureElement, Error&gt; parseStructureElement();
      Expected&lt;AST::StructureDefinition, Error&gt; parseStructureDefinition();
      Expected&lt;AST::EnumerationDefinition, Error&gt; parseEnumerationDefinition();
<span class="udiff-line-modified-removed">-     Expected&lt;AST::EnumerationMember, Error&gt; parseEnumerationMember();</span>
<span class="udiff-line-modified-added">+     Expected&lt;AST::EnumerationMember, Error&gt; parseEnumerationMember(int64_t defaultValue);</span>
      Expected&lt;AST::NativeTypeDeclaration, Error&gt; parseNativeTypeDeclaration();
      Expected&lt;AST::NumThreadsFunctionAttribute, Error&gt; parseNumThreadsFunctionAttribute();
      Expected&lt;AST::AttributeBlock, Error&gt; parseAttributeBlock();
      Expected&lt;AST::VariableDeclaration, Error&gt; parseParameter();
      Expected&lt;AST::VariableDeclarations, Error&gt; parseParameters();
<span class="udiff-line-modified-removed">-     Expected&lt;AST::FunctionDeclaration, Error&gt; parseEntryPointFunctionDeclaration();</span>
<span class="udiff-line-modified-added">+     Expected&lt;AST::FunctionDeclaration, Error&gt; parseComputeFunctionDeclaration();</span>
<span class="udiff-line-added">+     Expected&lt;AST::FunctionDeclaration, Error&gt; parseVertexOrFragmentFunctionDeclaration();</span>
      Expected&lt;AST::FunctionDeclaration, Error&gt; parseRegularFunctionDeclaration();
      Expected&lt;AST::FunctionDeclaration, Error&gt; parseOperatorFunctionDeclaration();
      Expected&lt;AST::FunctionDeclaration, Error&gt; parseFunctionDeclaration();
      Expected&lt;AST::FunctionDefinition, Error&gt; parseFunctionDefinition();
      Expected&lt;AST::NativeFunctionDeclaration, Error&gt; parseNativeFunctionDeclaration();
  
      Expected&lt;AST::Block, Error&gt; parseBlock();
<span class="udiff-line-modified-removed">-     AST::Block parseBlockBody(Lexer::Token&amp;&amp; origin);</span>
<span class="udiff-line-modified-added">+     Expected&lt;AST::Block, Error&gt; parseBlockBody();</span>
      Expected&lt;AST::IfStatement, Error&gt; parseIfStatement();
      Expected&lt;AST::SwitchStatement, Error&gt; parseSwitchStatement();
      Expected&lt;AST::SwitchCase, Error&gt; parseSwitchCase();
      Expected&lt;AST::ForLoop, Error&gt; parseForLoop();
      Expected&lt;AST::WhileLoop, Error&gt; parseWhileLoop();
      Expected&lt;AST::DoWhileLoop, Error&gt; parseDoWhileLoop();
<span class="udiff-line-modified-removed">-     Expected&lt;AST::VariableDeclaration, Error&gt; parseVariableDeclaration(UniqueRef&lt;AST::UnnamedType&gt;&amp;&amp;);</span>
<span class="udiff-line-modified-added">+     Expected&lt;AST::VariableDeclaration, Error&gt; parseVariableDeclaration(Ref&lt;AST::UnnamedType&gt;&amp;&amp;);</span>
      Expected&lt;AST::VariableDeclarationsStatement, Error&gt; parseVariableDeclarations();
      Expected&lt;UniqueRef&lt;AST::Statement&gt;, Error&gt; parseStatement();
  
<span class="udiff-line-modified-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseEffectfulExpression();</span>
<span class="udiff-line-modified-added">+     Expected&lt;UniqueRef&lt;AST::Statement&gt;, Error&gt; parseEffectfulExpression();</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseEffectfulAssignment();
<span class="udiff-line-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseEffectfulPrefix();</span>
<span class="udiff-line-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseEffectfulSuffix();</span>
      struct SuffixExpression {
          SuffixExpression(UniqueRef&lt;AST::Expression&gt;&amp;&amp; result, bool success)
              : result(WTFMove(result))
              , success(success)
          {
</pre>
<hr />
<pre>
<span class="line-new-header">@@ -208,25 +147,30 @@</span>
      };
      SuffixExpression parseLimitedSuffixOperator(UniqueRef&lt;AST::Expression&gt;&amp;&amp;);
      SuffixExpression parseSuffixOperator(UniqueRef&lt;AST::Expression&gt;&amp;&amp;);
  
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseExpression();
<span class="udiff-line-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseTernaryConditional();</span>
<span class="udiff-line-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseAssignment();</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleTernaryConditional();
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completeTernaryConditional(UniqueRef&lt;AST::Expression&gt;&amp;&amp; predicate);</span>
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completeAssignment(UniqueRef&lt;AST::Expression&gt;&amp;&amp; left);</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleLogicalBinaryOperation();
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completePossibleLogicalBinaryOperation(UniqueRef&lt;AST::Expression&gt;&amp;&amp; previous);</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleRelationalBinaryOperation();
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completePossibleRelationalBinaryOperation(UniqueRef&lt;AST::Expression&gt;&amp;&amp; previous);</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleShift();
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completePossibleShift(UniqueRef&lt;AST::Expression&gt;&amp;&amp; previous);</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleAdd();
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completePossibleAdd(UniqueRef&lt;AST::Expression&gt;&amp;&amp; previous);</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleMultiply();
<span class="udiff-line-modified-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossiblePrefix();</span>
<span class="udiff-line-modified-removed">-     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleSuffix();</span>
<span class="udiff-line-modified-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; completePossibleMultiply(UniqueRef&lt;AST::Expression&gt;&amp;&amp; previous);</span>
<span class="udiff-line-modified-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossiblePrefix(bool *isEffectful = nullptr);</span>
<span class="udiff-line-added">+     Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parsePossibleSuffix(bool *isEffectful = nullptr);</span>
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseCallExpression();
      Expected&lt;UniqueRef&lt;AST::Expression&gt;, Error&gt; parseTerm();
  
      Lexer m_lexer;
<span class="udiff-line-modified-removed">-     Mode m_mode;</span>
<span class="udiff-line-modified-added">+     ParsingMode m_mode;</span>
  };
  
  } // namespace WHLSL
  
  } // namespace WebCore
</pre>
<center><a href="WHLSLParser.cpp.udiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../../index.html" target="_top">index</a> <a href="WHLSLProgram.h.udiff.html" target="_top">next &gt;</a></center>  </body>
</html>