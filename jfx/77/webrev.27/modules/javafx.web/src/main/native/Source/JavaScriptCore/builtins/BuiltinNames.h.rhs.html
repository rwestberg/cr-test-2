<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/JavaScriptCore/builtins/BuiltinNames.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>  1 /*
<a name="1" id="anc1"></a><span class="line-modified">  2  * Copyright (C) 2014-2019 Apple Inc. All rights reserved.</span>
  3  *
  4  * Redistribution and use in source and binary forms, with or without
  5  * modification, are permitted provided that the following conditions
  6  * are met:
  7  * 1. Redistributions of source code must retain the above copyright
  8  *    notice, this list of conditions and the following disclaimer.
  9  * 2. Redistributions in binary form must reproduce the above copyright
 10  *    notice, this list of conditions and the following disclaimer in the
 11  *    documentation and/or other materials provided with the distribution.
 12  *
 13  * THIS SOFTWARE IS PROVIDED BY APPLE INC. ``AS IS&#39;&#39; AND ANY
 14  * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 15  * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 16  * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL APPLE INC. OR
 17  * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 18  * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 19  * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 20  * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 21  * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 22  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
 23  * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 24  */
 25 
 26 #pragma once
 27 
 28 #include &quot;BuiltinUtils.h&quot;
 29 #include &quot;BytecodeIntrinsicRegistry.h&quot;
 30 #include &quot;CommonIdentifiers.h&quot;
 31 #include &quot;JSCBuiltins.h&quot;
 32 
 33 namespace JSC {
 34 
 35 #define DECLARE_BUILTIN_NAMES_IN_JSC(name) const JSC::Identifier m_##name;
 36 #define DECLARE_BUILTIN_SYMBOLS_IN_JSC(name) const JSC::Identifier m_##name##Symbol; const JSC::Identifier m_##name##SymbolPrivateIdentifier;
 37 #define DECLARE_BUILTIN_SYMBOL_ACCESSOR(name) \
 38     const JSC::Identifier&amp; name##Symbol() const { return m_##name##Symbol; }
 39 #define DECLARE_BUILTIN_IDENTIFIER_ACCESSOR_IN_JSC(name) \
 40     const JSC::Identifier&amp; name##PublicName() const { return m_##name; } \
 41     JSC::Identifier name##PrivateName() const { return JSC::Identifier::fromUid(*bitwise_cast&lt;SymbolImpl*&gt;(&amp;JSC::Symbols::name##PrivateName)); }
 42 
 43 
 44 #define JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_PROPERTY_NAME(macro) \
 45     JSC_COMMON_BYTECODE_INTRINSIC_FUNCTIONS_EACH_NAME(macro) \
 46     JSC_COMMON_BYTECODE_INTRINSIC_CONSTANTS_EACH_NAME(macro) \
 47     macro(add) \
 48     macro(arrayIteratorNextIndex) \
 49     macro(arrayIterationKind) \
 50     macro(arrayIteratorNext) \
 51     macro(arrayIteratorIsDone) \
 52     macro(arrayIteratorKind) \
<a name="2" id="anc2"></a><span class="line-added"> 53     macro(arraySpeciesCreate) \</span>
 54     macro(assert) \
 55     macro(charCodeAt) \
 56     macro(executor) \
 57     macro(isView) \
 58     macro(iteratedObject) \
 59     macro(iteratedString) \
 60     macro(stringIteratorNextIndex) \
 61     macro(promise) \
 62     macro(Object) \
 63     macro(Number) \
 64     macro(Array) \
 65     macro(ArrayBuffer) \
 66     macro(RegExp) \
 67     macro(Promise) \
<a name="3" id="anc3"></a>
 68     macro(InternalPromise) \
 69     macro(trunc) \
 70     macro(create) \
 71     macro(defineProperty) \
 72     macro(getPrototypeOf) \
<a name="4" id="anc4"></a>
 73     macro(getOwnPropertyNames) \
 74     macro(ownKeys) \
 75     macro(Set) \
<a name="5" id="anc5"></a>
 76     macro(typedArrayLength) \
 77     macro(typedArraySort) \
 78     macro(typedArrayGetOriginalConstructor) \
 79     macro(typedArraySubarrayCreate) \
 80     macro(BuiltinLog) \
 81     macro(BuiltinDescribe) \
 82     macro(homeObject) \
<a name="6" id="anc6"></a>
 83     macro(enqueueJob) \
 84     macro(hostPromiseRejectionTracker) \
 85     macro(promiseIsHandled) \
 86     macro(promiseState) \
 87     macro(promiseReactions) \
 88     macro(promiseResult) \
 89     macro(onFulfilled) \
 90     macro(onRejected) \
 91     macro(push) \
 92     macro(repeatCharacter) \
 93     macro(capabilities) \
 94     macro(starDefault) \
 95     macro(InspectorInstrumentation) \
 96     macro(get) \
 97     macro(set) \
 98     macro(shift) \
 99     macro(allocateTypedArray) \
100     macro(Int8Array) \
101     macro(Int16Array) \
102     macro(Int32Array) \
103     macro(Uint8Array) \
104     macro(Uint8ClampedArray) \
105     macro(Uint16Array) \
106     macro(Uint32Array) \
107     macro(Float32Array) \
108     macro(Float64Array) \
109     macro(exec) \
110     macro(generator) \
111     macro(generatorNext) \
112     macro(generatorState) \
113     macro(generatorFrame) \
114     macro(generatorValue) \
115     macro(generatorThis) \
116     macro(syncIterator) \
117     macro(nextMethod) \
118     macro(asyncGeneratorState) \
119     macro(asyncGeneratorSuspendReason) \
120     macro(asyncGeneratorQueue) \
121     macro(asyncGeneratorQueueFirst) \
122     macro(asyncGeneratorQueueLast) \
123     macro(asyncGeneratorQueueItemNext) \
124     macro(asyncGeneratorQueueItemPrevious) \
125     macro(generatorResumeMode) \
126     macro(dateTimeFormat) \
127     macro(intlSubstituteValue) \
128     macro(thisTimeValue) \
129     macro(newTargetLocal) \
130     macro(derivedConstructor) \
131     macro(isTypedArrayView) \
132     macro(isBoundFunction) \
133     macro(hasInstanceBoundFunction) \
134     macro(instanceOf) \
135     macro(isArraySlow) \
<a name="7" id="anc7"></a>
136     macro(isConstructor) \
137     macro(concatMemcpy) \
138     macro(appendMemcpy) \
139     macro(regExpCreate) \
140     macro(replaceUsingRegExp) \
141     macro(replaceUsingStringSearch) \
<a name="8" id="anc8"></a><span class="line-added">142     macro(makeTypeError) \</span>
143     macro(mapBucket) \
144     macro(mapBucketHead) \
145     macro(mapBucketNext) \
146     macro(mapBucketKey) \
147     macro(mapBucketValue) \
148     macro(mapIteratorKind) \
149     macro(setBucket) \
150     macro(setBucketHead) \
151     macro(setBucketNext) \
152     macro(setBucketKey) \
153     macro(setIteratorKind) \
154     macro(regExpBuiltinExec) \
155     macro(regExpMatchFast) \
156     macro(regExpProtoFlagsGetter) \
157     macro(regExpProtoGlobalGetter) \
158     macro(regExpProtoIgnoreCaseGetter) \
159     macro(regExpProtoMultilineGetter) \
160     macro(regExpProtoSourceGetter) \
161     macro(regExpProtoStickyGetter) \
162     macro(regExpProtoUnicodeGetter) \
163     macro(regExpPrototypeSymbolReplace) \
164     macro(regExpSearchFast) \
165     macro(regExpSplitFast) \
166     macro(regExpTestFast) \
<a name="9" id="anc9"></a><span class="line-added">167     macro(regExpStringIteratorRegExp) \</span>
<span class="line-added">168     macro(regExpStringIteratorString) \</span>
<span class="line-added">169     macro(regExpStringIteratorGlobal) \</span>
<span class="line-added">170     macro(regExpStringIteratorUnicode) \</span>
<span class="line-added">171     macro(regExpStringIteratorDone) \</span>
172     macro(stringIncludesInternal) \
173     macro(stringSplitFast) \
174     macro(stringSubstrInternal) \
175     macro(makeBoundFunction) \
176     macro(hasOwnLengthProperty) \
177     macro(importModule) \
178     macro(propertyIsEnumerable) \
179     macro(meta) \
180     macro(webAssemblyCompileStreamingInternal) \
181     macro(webAssemblyInstantiateStreamingInternal) \
182 
183 namespace Symbols {
184 #define DECLARE_BUILTIN_STATIC_SYMBOLS(name) extern JS_EXPORT_PRIVATE SymbolImpl::StaticSymbolImpl name##Symbol;
185 JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_WELL_KNOWN_SYMBOL(DECLARE_BUILTIN_STATIC_SYMBOLS)
186 #undef DECLARE_BUILTIN_STATIC_SYMBOLS
187 
188 #define DECLARE_BUILTIN_PRIVATE_NAMES(name) extern JS_EXPORT_PRIVATE SymbolImpl::StaticSymbolImpl name##PrivateName;
189 JSC_FOREACH_BUILTIN_FUNCTION_NAME(DECLARE_BUILTIN_PRIVATE_NAMES)
190 JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_PROPERTY_NAME(DECLARE_BUILTIN_PRIVATE_NAMES)
191 #undef DECLARE_BUILTIN_PRIVATE_NAMES
192 
193 extern JS_EXPORT_PRIVATE SymbolImpl::StaticSymbolImpl dollarVMPrivateName;
194 extern JS_EXPORT_PRIVATE SymbolImpl::StaticSymbolImpl polyProtoPrivateName;
195 }
196 
197 class BuiltinNames {
198     WTF_MAKE_NONCOPYABLE(BuiltinNames); WTF_MAKE_FAST_ALLOCATED;
199 
200 public:
<a name="10" id="anc10"></a><span class="line-modified">201     BuiltinNames(VM&amp;, CommonIdentifiers*);</span>
202 
203     SymbolImpl* lookUpPrivateName(const Identifier&amp;) const;
204     Identifier getPublicName(VM&amp;, SymbolImpl*) const;
205 
206     void appendExternalName(const Identifier&amp; publicName, const Identifier&amp; privateName);
207 
208     JSC_FOREACH_BUILTIN_FUNCTION_NAME(DECLARE_BUILTIN_IDENTIFIER_ACCESSOR_IN_JSC)
209     JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_PROPERTY_NAME(DECLARE_BUILTIN_IDENTIFIER_ACCESSOR_IN_JSC)
210     JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_WELL_KNOWN_SYMBOL(DECLARE_BUILTIN_SYMBOL_ACCESSOR)
211     const JSC::Identifier&amp; dollarVMPublicName() const { return m_dollarVMName; }
212     const JSC::Identifier&amp; dollarVMPrivateName() const { return m_dollarVMPrivateName; }
213     const JSC::Identifier&amp; polyProtoName() const { return m_polyProtoPrivateName; }
214 
215 private:
216     void checkPublicToPrivateMapConsistency(UniquedStringImpl* publicName, UniquedStringImpl* privateName);
217 
218     Identifier m_emptyIdentifier;
219     JSC_FOREACH_BUILTIN_FUNCTION_NAME(DECLARE_BUILTIN_NAMES_IN_JSC)
220     JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_PROPERTY_NAME(DECLARE_BUILTIN_NAMES_IN_JSC)
221     JSC_COMMON_PRIVATE_IDENTIFIERS_EACH_WELL_KNOWN_SYMBOL(DECLARE_BUILTIN_SYMBOLS_IN_JSC)
222     const JSC::Identifier m_dollarVMName;
223     const JSC::Identifier m_dollarVMPrivateName;
224     const JSC::Identifier m_polyProtoPrivateName;
225     typedef HashMap&lt;RefPtr&lt;UniquedStringImpl&gt;, SymbolImpl*, IdentifierRepHash&gt; BuiltinNamesMap;
226     BuiltinNamesMap m_publicToPrivateMap;
227 };
228 
229 inline SymbolImpl* BuiltinNames::lookUpPrivateName(const Identifier&amp; ident) const
230 {
231     auto iter = m_publicToPrivateMap.find(ident.impl());
232     if (iter != m_publicToPrivateMap.end())
233         return iter-&gt;value;
234     return nullptr;
235 }
236 
237 inline Identifier BuiltinNames::getPublicName(VM&amp; vm, SymbolImpl* symbol) const
238 {
239     if (symbol-&gt;isPrivate())
<a name="11" id="anc11"></a><span class="line-modified">240         return Identifier::fromString(vm, symbol);</span>
241     // We have special handling for well-known symbols.
242     ASSERT(symbol-&gt;startsWith(&quot;Symbol.&quot;));
<a name="12" id="anc12"></a><span class="line-modified">243     return Identifier::fromString(vm, makeString(String(symbol-&gt;substring(strlen(&quot;Symbol.&quot;))), &quot;Symbol&quot;));</span>
244 }
245 
246 inline void BuiltinNames::checkPublicToPrivateMapConsistency(UniquedStringImpl* publicName, UniquedStringImpl* privateName)
247 {
248 #ifndef NDEBUG
249     for (const auto&amp; key : m_publicToPrivateMap.keys())
250         ASSERT(String(publicName) != *key);
251 
252     ASSERT(privateName-&gt;isSymbol());
253     SymbolImpl* symbol = static_cast&lt;SymbolImpl*&gt;(privateName);
254     if (symbol-&gt;isPrivate()) {
255         // This guarantees that we can get public symbols from private symbols by using content of private symbols.
256         ASSERT(String(symbol) == *publicName);
257     } else {
258         // We have a hack in m_publicToPrivateMap: adding non-private Symbol with readable name to use it
259         // in builtin code. The example is @iteratorSymbol =&gt; Symbol.iterator mapping. To allow the reverse
260         // transformation, we ensure that non-private symbol mapping has xxxSymbol =&gt; Symbol.xxx.
261         ASSERT(makeString(String(symbol), &quot;Symbol&quot;) == makeString(&quot;Symbol.&quot;, String(publicName)));
262     }
263 #else
264     UNUSED_PARAM(publicName);
265     UNUSED_PARAM(privateName);
266 #endif
267 }
268 
269 inline void BuiltinNames::appendExternalName(const Identifier&amp; publicName, const Identifier&amp; privateName)
270 {
271     checkPublicToPrivateMapConsistency(publicName.impl(), privateName.impl());
272     m_publicToPrivateMap.add(publicName.impl(), static_cast&lt;SymbolImpl*&gt;(privateName.impl()));
273 }
274 
275 } // namespace JSC
<a name="13" id="anc13"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="13" type="hidden" />
</body>
</html>