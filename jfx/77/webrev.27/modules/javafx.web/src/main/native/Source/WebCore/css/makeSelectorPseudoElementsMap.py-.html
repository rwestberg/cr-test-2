<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Old modules/javafx.web/src/main/native/Source/WebCore/css/makeSelectorPseudoElementsMap.py</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
  <body>
    <pre>
  1 #!/usr/bin/env python
  2 #
  3 # Copyright (C) 2014 Apple Inc. All rights reserved.
  4 #
  5 # Redistribution and use in source and binary forms, with or without
  6 # modification, are permitted provided that the following conditions
  7 # are met:
  8 # 1. Redistributions of source code must retain the above copyright
  9 #    notice, this list of conditions and the following disclaimer.
 10 # 2. Redistributions in binary form must reproduce the above copyright
 11 #    notice, this list of conditions and the following disclaimer in the
 12 #    documentation and/or other materials provided with the distribution.
 13 #
 14 # THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 15 # AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 16 # THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 17 # PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 18 # BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 19 # CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 20 # SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 21 # INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 22 # CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 23 # ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 24 # THE POSSIBILITY OF SUCH DAMAGE.
 25 
 26 import os
 27 import sys
 28 import subprocess
 29 
 30 
 31 def enumerablePseudoType(stringPseudoType):
 32     output = [&#39;CSSSelector::PseudoElement&#39;]
 33 
 34     if stringPseudoType.endswith(&#39;(&#39;):
 35         stringPseudoType = stringPseudoType[:-1]
 36 
 37     webkitPrefix = &#39;-webkit-&#39;
 38     if (stringPseudoType.startswith(webkitPrefix)):
 39         stringPseudoType = stringPseudoType[len(webkitPrefix):]
 40 
 41     khtmlPrefix = &#39;-khtml-&#39;
 42     if (stringPseudoType.startswith(khtmlPrefix)):
 43         stringPseudoType = stringPseudoType[len(khtmlPrefix):]
 44 
 45     substring_start = 0
 46     next_dash_position = stringPseudoType.find(&#39;-&#39;)
 47     while (next_dash_position != -1):
 48         output.append(stringPseudoType[substring_start].upper())
 49         output.append(stringPseudoType[substring_start + 1:next_dash_position])
 50         substring_start = next_dash_position + 1
 51         next_dash_position = stringPseudoType.find(&#39;-&#39;, substring_start)
 52 
 53     output.append(stringPseudoType[substring_start].upper())
 54     output.append(stringPseudoType[substring_start + 1:])
 55     return &#39;&#39;.join(output)
 56 
 57 
 58 def expand_ifdef_condition(condition):
 59     return condition.replace(&#39;(&#39;, &#39;_&#39;).replace(&#39;)&#39;, &#39;&#39;)
 60 
 61 output_file = open(&#39;SelectorPseudoElementTypeMap.gperf&#39;, &#39;w&#39;)
 62 
 63 output_file.write(&quot;&quot;&quot;
 64 %{
 65 /*
 66  * Copyright (C) 2014 Apple Inc. All rights reserved.
 67  *
 68  * Redistribution and use in source and binary forms, with or without
 69  * modification, are permitted provided that the following conditions
 70  * are met:
 71  * 1. Redistributions of source code must retain the above copyright
 72  *    notice, this list of conditions and the following disclaimer.
 73  * 2. Redistributions in binary form must reproduce the above copyright
 74  *    notice, this list of conditions and the following disclaimer in the
 75  *    documentation and/or other materials provided with the distribution.
 76  *
 77  * THIS SOFTWARE IS PROVIDED BY APPLE INC. AND ITS CONTRIBUTORS ``AS IS&#39;&#39;
 78  * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 79  * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 80  * PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL APPLE INC. OR ITS CONTRIBUTORS
 81  * BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 82  * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 83  * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 84  * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 85  * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 86  * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF
 87  * THE POSSIBILITY OF SUCH DAMAGE.
 88  */
 89 
 90 // This file is automatically generated from SelectorPseudoTypeMap.in by makeprop, do not edit by hand.
 91 
 92 #include &quot;config.h&quot;
 93 #include &quot;SelectorPseudoTypeMap.h&quot;
 94 
 95 IGNORE_WARNINGS_BEGIN(&quot;implicit-fallthrough&quot;)
 96 
 97 // Older versions of gperf like to use the `register` keyword.
 98 #define register
 99 
100 namespace WebCore {
101 
102 struct SelectorPseudoTypeEntry {
103     const char* name;
104     CSSSelector::PseudoElementType type;
105 };
106 
107 %}
108 %struct-type
109 %define initializer-suffix ,CSSSelector::PseudoElementUnknown
110 %define class-name SelectorPseudoElementTypeMapHash
111 %omit-struct-type
112 %language=C++
113 %readonly-tables
114 %global-table
115 %compare-strncmp
116 %enum
117 
118 struct SelectorPseudoTypeEntry;
119 
120 %%
121 &quot;&quot;&quot;)
122 
123 webcore_defines = [i.strip() for i in sys.argv[-1].split(&#39; &#39;)]
124 
125 longest_keyword = 0
126 
127 ignore_until_endif = False
128 input_file = open(sys.argv[1], &#39;r&#39;)
129 for line in input_file:
130     line = line.strip()
131     if not line:
132         continue
133 
134     if line.startswith(&#39;#if &#39;):
135         condition = line[4:].strip()
136         if expand_ifdef_condition(condition) not in webcore_defines:
137             ignore_until_endif = True
138         continue
139 
140     if line.startswith(&#39;#endif&#39;):
141         ignore_until_endif = False
142         continue
143 
144     if ignore_until_endif:
145         continue
146 
147     keyword_definition = line.split(&#39;,&#39;)
148     if len(keyword_definition) == 1:
149         keyword = keyword_definition[0].strip()
150         pseudo_element_enum_value = enumerablePseudoType(keyword)
151     else:
152         keyword = keyword_definition[0].strip()
153         pseudo_element_enum_value = &quot;CSSSelector::&quot; + keyword_definition[1].strip()
154 
155     output_file.write(&#39;&quot;%s&quot;, %s\n&#39; % (keyword, pseudo_element_enum_value))
156     longest_keyword = max(longest_keyword, len(keyword))
157 
158 output_file.write(&quot;&quot;&quot;%%
159 
160 static inline CSSSelector::PseudoElementType parsePseudoElementString(const LChar* characters, unsigned length)
161 {
162     if (const SelectorPseudoTypeEntry* entry = SelectorPseudoElementTypeMapHash::in_word_set(reinterpret_cast&lt;const char*&gt;(characters), length))
163         return entry-&gt;type;
164     return CSSSelector::PseudoElementUnknown;
165 }&quot;&quot;&quot;)
166 
167 output_file.write(&quot;&quot;&quot;
168 
169 static inline CSSSelector::PseudoElementType parsePseudoElementString(const UChar* characters, unsigned length)
170 {
171     const unsigned maxKeywordLength = %s;
172     LChar buffer[maxKeywordLength];
173     if (length &gt; maxKeywordLength)
174         return CSSSelector::PseudoElementUnknown;
175 
176     for (unsigned i = 0; i &lt; length; ++i) {
177         UChar character = characters[i];
178         if (character &amp; ~0xff)
179             return CSSSelector::PseudoElementUnknown;
180 
181         buffer[i] = static_cast&lt;LChar&gt;(character);
182     }
183     return parsePseudoElementString(buffer, length);
184 }
185 &quot;&quot;&quot; % longest_keyword)
186 
187 output_file.write(&quot;&quot;&quot;
188 CSSSelector::PseudoElementType parsePseudoElementString(const StringImpl&amp; pseudoTypeString)
189 {
190     if (pseudoTypeString.is8Bit())
191         return parsePseudoElementString(pseudoTypeString.characters8(), pseudoTypeString.length());
192     return parsePseudoElementString(pseudoTypeString.characters16(), pseudoTypeString.length());
193 }
194 
195 } // namespace WebCore
196 
197 IGNORE_WARNINGS_END
198 
199 &quot;&quot;&quot;)
200 output_file.close()
201 
202 gperf_command = sys.argv[2]
203 if &#39;GPERF&#39; in os.environ:
204     gperf_command = os.environ[&#39;GPERF&#39;]
205 
206 if subprocess.call([gperf_command, &#39;--key-positions=*&#39;, &#39;-m&#39;, &#39;10&#39;, &#39;-s&#39;, &#39;2&#39;, &#39;SelectorPseudoElementTypeMap.gperf&#39;, &#39;--output-file=SelectorPseudoElementTypeMap.cpp&#39;]) != 0:
207     print(&quot;Error when generating SelectorPseudoElementTypeMap.cpp from SelectorPseudoElementTypeMap.gperf :(&quot;)
208     sys.exit(gperf_return)
    </pre>
  </body>
</html>