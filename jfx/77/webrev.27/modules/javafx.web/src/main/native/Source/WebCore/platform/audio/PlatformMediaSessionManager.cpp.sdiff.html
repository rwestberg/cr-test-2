<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/audio/PlatformMediaSessionManager.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="PlatformMediaSession.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PlatformMediaSessionManager.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/audio/PlatformMediaSessionManager.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 42 {
 43     if (!platformMediaSessionManager)
 44         platformMediaSessionManager = new PlatformMediaSessionManager;
 45     return *platformMediaSessionManager;
 46 }
 47 
 48 PlatformMediaSessionManager* PlatformMediaSessionManager::sharedManagerIfExists()
 49 {
 50     return platformMediaSessionManager;
 51 }
 52 #endif // !PLATFORM(COCOA)
 53 
 54 void PlatformMediaSessionManager::updateNowPlayingInfoIfNecessary()
 55 {
 56     if (auto existingManager = PlatformMediaSessionManager::sharedManagerIfExists())
 57         existingManager-&gt;scheduleUpdateNowPlayingInfo();
 58 }
 59 
 60 PlatformMediaSessionManager::PlatformMediaSessionManager()
 61     : m_systemSleepListener(PAL::SystemSleepListener::create(*this))



 62 {
 63     resetRestrictions();
 64 }
 65 
 66 void PlatformMediaSessionManager::resetRestrictions()
 67 {
 68     m_restrictions[PlatformMediaSession::Video] = NoRestrictions;
 69     m_restrictions[PlatformMediaSession::Audio] = NoRestrictions;
 70     m_restrictions[PlatformMediaSession::VideoAudio] = NoRestrictions;
 71     m_restrictions[PlatformMediaSession::WebAudio] = NoRestrictions;
 72     m_restrictions[PlatformMediaSession::MediaStreamCapturingAudio] = NoRestrictions;
 73 }
 74 
 75 bool PlatformMediaSessionManager::has(PlatformMediaSession::MediaType type) const
 76 {
 77     ASSERT(type &gt;= PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
 78 
<span class="line-modified"> 79     return anyOfSessions([type] (PlatformMediaSession&amp; session, size_t) {</span>
 80         return session.mediaType() == type;
 81     });
 82 }
 83 
 84 bool PlatformMediaSessionManager::activeAudioSessionRequired() const
 85 {
<span class="line-modified"> 86     return anyOfSessions([] (PlatformMediaSession&amp; session, size_t) {</span>
 87         return session.activeAudioSessionRequired();
 88     });
 89 }
 90 
 91 bool PlatformMediaSessionManager::canProduceAudio() const
 92 {
<span class="line-modified"> 93     return anyOfSessions([] (PlatformMediaSession&amp; session, size_t) {</span>
 94         return session.canProduceAudio();
 95     });
 96 }
 97 
 98 int PlatformMediaSessionManager::count(PlatformMediaSession::MediaType type) const
 99 {
100     ASSERT(type &gt;= PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
101 
102     int count = 0;
<span class="line-modified">103     for (auto* session : m_sessions) {</span>
104         if (session-&gt;mediaType() == type)
105             ++count;
106     }
107 
108     return count;
109 }
110 
111 void PlatformMediaSessionManager::beginInterruption(PlatformMediaSession::InterruptionType type)
112 {
<span class="line-modified">113     LOG(Media, &quot;PlatformMediaSessionManager::beginInterruption&quot;);</span>
114 
115     m_interrupted = true;
<span class="line-modified">116     forEachSession([type] (PlatformMediaSession&amp; session, size_t) {</span>
117         session.beginInterruption(type);
118     });
119     updateSessionState();
120 }
121 
122 void PlatformMediaSessionManager::endInterruption(PlatformMediaSession::EndInterruptionFlags flags)
123 {
<span class="line-modified">124     LOG(Media, &quot;PlatformMediaSessionManager::endInterruption&quot;);</span>
125 
126     m_interrupted = false;
<span class="line-modified">127     forEachSession([flags] (PlatformMediaSession&amp; session, size_t) {</span>
128         session.endInterruption(flags);
129     });
130 }
131 
132 void PlatformMediaSessionManager::addSession(PlatformMediaSession&amp; session)
133 {
<span class="line-modified">134     LOG(Media, &quot;PlatformMediaSessionManager::addSession - %p&quot;, &amp;session);</span>
<span class="line-modified">135 </span>
<span class="line-removed">136     m_sessions.append(&amp;session);</span>
137     if (m_interrupted)
138         session.setState(PlatformMediaSession::Interrupted);
139 
140     if (!m_remoteCommandListener)
141         m_remoteCommandListener = RemoteCommandListener::create(*this);
142 
143     if (!m_audioHardwareListener)
144         m_audioHardwareListener = AudioHardwareListener::create(*this);
145 




146     updateSessionState();
147 }
148 
149 void PlatformMediaSessionManager::removeSession(PlatformMediaSession&amp; session)
150 {
<span class="line-modified">151     LOG(Media, &quot;PlatformMediaSessionManager::removeSession - %p&quot;, &amp;session);</span>
152 
153     size_t index = m_sessions.find(&amp;session);
154     if (index == notFound)
155         return;
156 
<span class="line-modified">157     if (m_iteratingOverSessions)</span>
<span class="line-removed">158         m_sessions.at(index) = nullptr;</span>
<span class="line-removed">159     else</span>
<span class="line-removed">160         m_sessions.remove(index);</span>
161 
162     if (m_sessions.isEmpty() || std::all_of(m_sessions.begin(), m_sessions.end(), std::logical_not&lt;void&gt;())) {
163         m_remoteCommandListener = nullptr;
164         m_audioHardwareListener = nullptr;
165 #if USE(AUDIO_SESSION)
166         if (m_becameActive &amp;&amp; shouldDeactivateAudioSession()) {
167             AudioSession::sharedSession().tryToSetActive(false);
168             m_becameActive = false;
169         }
170 #endif
171     }
172 




173     updateSessionState();
174 }
175 
176 void PlatformMediaSessionManager::addRestriction(PlatformMediaSession::MediaType type, SessionRestrictions restriction)
177 {
178     ASSERT(type &gt; PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
179     m_restrictions[type] |= restriction;
180 }
181 
182 void PlatformMediaSessionManager::removeRestriction(PlatformMediaSession::MediaType type, SessionRestrictions restriction)
183 {
184     ASSERT(type &gt; PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
185     m_restrictions[type] &amp;= ~restriction;
186 }
187 
188 PlatformMediaSessionManager::SessionRestrictions PlatformMediaSessionManager::restrictions(PlatformMediaSession::MediaType type)
189 {
190     ASSERT(type &gt; PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
191     return m_restrictions[type];
192 }
193 
194 bool PlatformMediaSessionManager::sessionWillBeginPlayback(PlatformMediaSession&amp; session)
195 {
<span class="line-removed">196     LOG(Media, &quot;PlatformMediaSessionManager::sessionWillBeginPlayback - %p&quot;, &amp;session);</span>
<span class="line-removed">197 </span>
198     setCurrentSession(session);
199 
200     PlatformMediaSession::MediaType sessionType = session.mediaType();
201     SessionRestrictions restrictions = m_restrictions[sessionType];
<span class="line-modified">202     if (session.state() == PlatformMediaSession::Interrupted &amp;&amp; restrictions &amp; InterruptedPlaybackNotPermitted)</span>

203         return false;

204 
205 #if USE(AUDIO_SESSION)
<span class="line-modified">206     if (activeAudioSessionRequired() &amp;&amp; !AudioSession::sharedSession().tryToSetActive(true))</span>
<span class="line-modified">207         return false;</span>



208 
<span class="line-modified">209     m_becameActive = true;</span>


210 #endif
211 
212     if (m_interrupted)
213         endInterruption(PlatformMediaSession::NoFlags);
214 
<span class="line-modified">215     forEachSession([&amp;] (PlatformMediaSession&amp; oneSession, size_t) {</span>
<span class="line-modified">216         if (&amp;oneSession == &amp;session)</span>
<span class="line-modified">217             return;</span>
<span class="line-modified">218         if (oneSession.mediaType() == sessionType</span>
<span class="line-modified">219             &amp;&amp; restrictions &amp; ConcurrentPlaybackNotPermitted</span>
<span class="line-modified">220             &amp;&amp; oneSession.state() == PlatformMediaSession::Playing)</span>

221             oneSession.pauseSession();
<span class="line-modified">222     });</span>
<span class="line-modified">223 </span>

224     return true;
225 }
226 
227 void PlatformMediaSessionManager::sessionWillEndPlayback(PlatformMediaSession&amp; session)
228 {
<span class="line-modified">229     LOG(Media, &quot;PlatformMediaSessionManager::sessionWillEndPlayback - %p&quot;, &amp;session);</span>
230 
231     if (m_sessions.size() &lt; 2)
232         return;
233 
234     size_t pausingSessionIndex = notFound;
235     size_t lastPlayingSessionIndex = notFound;
<span class="line-modified">236     anyOfSessions([&amp;] (PlatformMediaSession&amp; oneSession, size_t i) {</span>
<span class="line-modified">237         if (&amp;oneSession == &amp;session) {</span>

238             pausingSessionIndex = i;
<span class="line-modified">239             return false;</span>
<span class="line-removed">240         }</span>
<span class="line-removed">241         if (oneSession.state() == PlatformMediaSession::Playing) {</span>
242             lastPlayingSessionIndex = i;
<span class="line-modified">243             return false;</span>
<span class="line-modified">244         }</span>
<span class="line-modified">245         return oneSession.state() != PlatformMediaSession::Playing;</span>
<span class="line-modified">246     });</span>
247     if (lastPlayingSessionIndex == notFound || pausingSessionIndex == notFound)
248         return;
249 
250     if (pausingSessionIndex &gt; lastPlayingSessionIndex)
251         return;
252 
253     m_sessions.remove(pausingSessionIndex);
<span class="line-modified">254     m_sessions.insert(lastPlayingSessionIndex, &amp;session);</span>
255 
<span class="line-modified">256     LOG(Media, &quot;PlatformMediaSessionManager::sessionWillEndPlayback - session moved from index %zu to %zu&quot;, pausingSessionIndex, lastPlayingSessionIndex);</span>
257 }
258 
259 void PlatformMediaSessionManager::sessionStateChanged(PlatformMediaSession&amp;)
260 {
261     updateSessionState();
262 }
263 
264 void PlatformMediaSessionManager::setCurrentSession(PlatformMediaSession&amp; session)
265 {
<span class="line-modified">266     LOG(Media, &quot;PlatformMediaSessionManager::setCurrentSession - %p&quot;, &amp;session);</span>
267 
268     if (m_sessions.size() &lt; 2)
269         return;
270 
271     size_t index = m_sessions.find(&amp;session);
272     ASSERT(index != notFound);
273     if (!index || index == notFound)
274         return;
275 
276     m_sessions.remove(index);
<span class="line-modified">277     m_sessions.insert(0, &amp;session);</span>
278     if (m_remoteCommandListener)
279         m_remoteCommandListener-&gt;updateSupportedCommands();
280 
<span class="line-modified">281     LOG(Media, &quot;PlatformMediaSessionManager::setCurrentSession - session moved from index %zu to 0&quot;, index);</span>
282 }
283 
284 PlatformMediaSession* PlatformMediaSessionManager::currentSession() const
285 {
286     if (!m_sessions.size())
287         return nullptr;
288 
<span class="line-modified">289     return m_sessions[0];</span>
290 }
291 
<span class="line-modified">292 Vector&lt;PlatformMediaSession*&gt; PlatformMediaSessionManager::currentSessionsMatching(const WTF::Function&lt;bool(const PlatformMediaSession&amp;)&gt;&amp; filter)</span>
293 {
<span class="line-modified">294     Vector&lt;PlatformMediaSession*&gt; matchingSessions;</span>
<span class="line-removed">295     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-removed">296         if (filter(session))</span>
<span class="line-removed">297             matchingSessions.append(&amp;session);</span>
<span class="line-removed">298     });</span>
<span class="line-removed">299     return matchingSessions;</span>
<span class="line-removed">300 }</span>
<span class="line-removed">301 </span>
<span class="line-removed">302 void PlatformMediaSessionManager::applicationWillBecomeInactive() const</span>
<span class="line-removed">303 {</span>
<span class="line-removed">304     LOG(Media, &quot;PlatformMediaSessionManager::applicationWillBecomeInactive&quot;);</span>
305 
<span class="line-modified">306     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-modified">307         if (m_restrictions[session.mediaType()] &amp; InactiveProcessPlaybackRestricted)</span>
<span class="line-modified">308             session.beginInterruption(PlatformMediaSession::ProcessInactive);</span>

309     });
310 }
311 
<span class="line-modified">312 void PlatformMediaSessionManager::applicationDidBecomeActive() const</span>
313 {
<span class="line-modified">314     LOG(Media, &quot;PlatformMediaSessionManager::applicationDidBecomeActive&quot;);</span>
315 
<span class="line-modified">316     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-modified">317         if (m_restrictions[session.mediaType()] &amp; InactiveProcessPlaybackRestricted)</span>
<span class="line-modified">318             session.endInterruption(PlatformMediaSession::MayResumePlaying);</span>

319     });
320 }
321 
<span class="line-modified">322 void PlatformMediaSessionManager::applicationDidEnterBackground(bool suspendedUnderLock) const</span>
323 {
<span class="line-modified">324     LOG(Media, &quot;PlatformMediaSessionManager::applicationDidEnterBackground - suspendedUnderLock(%d)&quot;, suspendedUnderLock);</span>
325 
326     if (m_isApplicationInBackground)
327         return;
328 
329     m_isApplicationInBackground = true;
330 
<span class="line-modified">331     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
332         if (suspendedUnderLock &amp;&amp; m_restrictions[session.mediaType()] &amp; SuspendedUnderLockPlaybackRestricted)
333             session.beginInterruption(PlatformMediaSession::SuspendedUnderLock);
334         else if (m_restrictions[session.mediaType()] &amp; BackgroundProcessPlaybackRestricted)
335             session.beginInterruption(PlatformMediaSession::EnteringBackground);
336     });
337 }
338 
<span class="line-modified">339 void PlatformMediaSessionManager::applicationWillEnterForeground(bool suspendedUnderLock) const</span>
340 {
<span class="line-modified">341     LOG(Media, &quot;PlatformMediaSessionManager::applicationWillEnterForeground - suspendedUnderLock(%d)&quot;, suspendedUnderLock);</span>
342 
343     if (!m_isApplicationInBackground)
344         return;
345 
346     m_isApplicationInBackground = false;
347 
<span class="line-modified">348     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-modified">349         if ((suspendedUnderLock &amp;&amp; m_restrictions[session.mediaType()] &amp; SuspendedUnderLockPlaybackRestricted) || m_restrictions[session.mediaType()] &amp; BackgroundProcessPlaybackRestricted)</span>
<span class="line-modified">350             session.endInterruption(PlatformMediaSession::MayResumePlaying);</span>

351     });
352 }
353 














































354 void PlatformMediaSessionManager::sessionIsPlayingToWirelessPlaybackTargetChanged(PlatformMediaSession&amp; session)
355 {
356     if (!m_isApplicationInBackground || !(m_restrictions[session.mediaType()] &amp; BackgroundProcessPlaybackRestricted))
357         return;
358 
359     if (session.state() != PlatformMediaSession::Interrupted)
360         session.beginInterruption(PlatformMediaSession::EnteringBackground);
361 }
362 
363 void PlatformMediaSessionManager::sessionCanProduceAudioChanged(PlatformMediaSession&amp;)
364 {
365     updateSessionState();
366 }
367 
368 void PlatformMediaSessionManager::didReceiveRemoteControlCommand(PlatformMediaSession::RemoteControlCommandType command, const PlatformMediaSession::RemoteCommandArgument* argument)
369 {
370     PlatformMediaSession* activeSession = currentSession();
371     if (!activeSession || !activeSession-&gt;canReceiveRemoteControlCommands())
372         return;
373     activeSession-&gt;didReceiveRemoteControlCommand(command, argument);
374 }
375 
376 bool PlatformMediaSessionManager::supportsSeeking() const
377 {
378     PlatformMediaSession* activeSession = currentSession();
379     if (!activeSession)
380         return false;
381     return activeSession-&gt;supportsSeeking();
382 }
383 
384 void PlatformMediaSessionManager::systemWillSleep()
385 {
386     if (m_interrupted)
387         return;
388 
<span class="line-modified">389     forEachSession([] (PlatformMediaSession&amp; session, size_t) {</span>
390         session.beginInterruption(PlatformMediaSession::SystemSleep);
391     });
392 }
393 
394 void PlatformMediaSessionManager::systemDidWake()
395 {
396     if (m_interrupted)
397         return;
398 
<span class="line-modified">399     forEachSession([] (PlatformMediaSession&amp; session, size_t) {</span>
400         session.endInterruption(PlatformMediaSession::MayResumePlaying);
401     });
402 }
403 
404 void PlatformMediaSessionManager::audioOutputDeviceChanged()
405 {
406     updateSessionState();
407 }
408 
<span class="line-modified">409 void PlatformMediaSessionManager::stopAllMediaPlaybackForDocument(const Document* document)</span>
410 {
<span class="line-modified">411     forEachSession([document] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-modified">412         if (session.client().hostingDocument() == document)</span>
<span class="line-removed">413             session.pauseSession();</span>
414     });
415 }
416 
417 void PlatformMediaSessionManager::stopAllMediaPlaybackForProcess()
418 {
<span class="line-modified">419     forEachSession([] (PlatformMediaSession&amp; session, size_t) {</span>
420         session.stopSession();
421     });
422 }
423 
424 void PlatformMediaSessionManager::suspendAllMediaPlaybackForDocument(const Document&amp; document)
425 {
<span class="line-modified">426     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-modified">427         if (session.client().hostingDocument() == &amp;document)</span>
<span class="line-removed">428             session.beginInterruption(PlatformMediaSession::PlaybackSuspended);</span>
429     });
430 }
431 
432 void PlatformMediaSessionManager::resumeAllMediaPlaybackForDocument(const Document&amp; document)
433 {
<span class="line-modified">434     forEachSession([&amp;] (PlatformMediaSession&amp; session, size_t) {</span>
<span class="line-modified">435         if (session.client().hostingDocument() == &amp;document)</span>
<span class="line-removed">436             session.endInterruption(PlatformMediaSession::MayResumePlaying);</span>
437     });
438 }
439 
<span class="line-modified">440 void PlatformMediaSessionManager::forEachSession(const Function&lt;void(PlatformMediaSession&amp;, size_t)&gt;&amp; predicate) const</span>
441 {
<span class="line-modified">442     ++m_iteratingOverSessions;</span>
<span class="line-modified">443 </span>
<span class="line-modified">444     for (size_t i = 0, size = m_sessions.size(); i &lt; size; ++i) {</span>
<span class="line-modified">445         auto session = m_sessions[i];</span>
<span class="line-removed">446         if (!session)</span>
<span class="line-removed">447             continue;</span>
<span class="line-removed">448         predicate(*session, i);</span>
<span class="line-removed">449     }</span>
450 
<span class="line-modified">451     --m_iteratingOverSessions;</span>
<span class="line-modified">452     if (!m_iteratingOverSessions)</span>
<span class="line-modified">453         m_sessions.removeAll(nullptr);</span>


454 }
455 
<span class="line-modified">456 PlatformMediaSession* PlatformMediaSessionManager::findSession(const Function&lt;bool(PlatformMediaSession&amp;, size_t)&gt;&amp; predicate) const</span>
457 {
<span class="line-modified">458     ++m_iteratingOverSessions;</span>






459 
<span class="line-modified">460     PlatformMediaSession* foundSession = nullptr;</span>
<span class="line-modified">461     for (size_t i = 0, size = m_sessions.size(); i &lt; size; ++i) {</span>
<span class="line-modified">462         auto session = m_sessions[i];</span>
<span class="line-modified">463         if (!session)</span>
<span class="line-modified">464             continue;</span>



465 
<span class="line-modified">466         if (!predicate(*session, i))</span>
<span class="line-modified">467             continue;</span>






468 
<span class="line-modified">469         foundSession = session;</span>
<span class="line-modified">470         break;</span>





471     }

472 
<span class="line-modified">473     --m_iteratingOverSessions;</span>
<span class="line-modified">474     if (!m_iteratingOverSessions)</span>
<span class="line-modified">475         m_sessions.removeAll(nullptr);</span>
<span class="line-modified">476 </span>
<span class="line-modified">477     return foundSession;</span>
478 }
479 
480 static bool&amp; deactivateAudioSession()
481 {
482     static bool deactivate;
483     return deactivate;
484 }
485 
486 bool PlatformMediaSessionManager::shouldDeactivateAudioSession()
487 {
488     return deactivateAudioSession();
489 }
490 
491 void PlatformMediaSessionManager::setShouldDeactivateAudioSession(bool deactivate)
492 {
493     deactivateAudioSession() = deactivate;
494 }
495 
496 #else // ENABLE(VIDEO) || ENABLE(WEB_AUDIO)
497 
498 void PlatformMediaSessionManager::updateNowPlayingInfoIfNecessary()
499 {
500 
501 }
502 
503 #endif // ENABLE(VIDEO) || ENABLE(WEB_AUDIO)
504 







505 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 42 {
 43     if (!platformMediaSessionManager)
 44         platformMediaSessionManager = new PlatformMediaSessionManager;
 45     return *platformMediaSessionManager;
 46 }
 47 
 48 PlatformMediaSessionManager* PlatformMediaSessionManager::sharedManagerIfExists()
 49 {
 50     return platformMediaSessionManager;
 51 }
 52 #endif // !PLATFORM(COCOA)
 53 
 54 void PlatformMediaSessionManager::updateNowPlayingInfoIfNecessary()
 55 {
 56     if (auto existingManager = PlatformMediaSessionManager::sharedManagerIfExists())
 57         existingManager-&gt;scheduleUpdateNowPlayingInfo();
 58 }
 59 
 60 PlatformMediaSessionManager::PlatformMediaSessionManager()
 61     : m_systemSleepListener(PAL::SystemSleepListener::create(*this))
<span class="line-added"> 62 #if !RELEASE_LOG_DISABLED</span>
<span class="line-added"> 63     , m_logger(AggregateLogger::create(this))</span>
<span class="line-added"> 64 #endif</span>
 65 {
 66     resetRestrictions();
 67 }
 68 
 69 void PlatformMediaSessionManager::resetRestrictions()
 70 {
 71     m_restrictions[PlatformMediaSession::Video] = NoRestrictions;
 72     m_restrictions[PlatformMediaSession::Audio] = NoRestrictions;
 73     m_restrictions[PlatformMediaSession::VideoAudio] = NoRestrictions;
 74     m_restrictions[PlatformMediaSession::WebAudio] = NoRestrictions;
 75     m_restrictions[PlatformMediaSession::MediaStreamCapturingAudio] = NoRestrictions;
 76 }
 77 
 78 bool PlatformMediaSessionManager::has(PlatformMediaSession::MediaType type) const
 79 {
 80     ASSERT(type &gt;= PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
 81 
<span class="line-modified"> 82     return anyOfSessions([type] (auto&amp; session) {</span>
 83         return session.mediaType() == type;
 84     });
 85 }
 86 
 87 bool PlatformMediaSessionManager::activeAudioSessionRequired() const
 88 {
<span class="line-modified"> 89     return anyOfSessions([] (auto&amp; session) {</span>
 90         return session.activeAudioSessionRequired();
 91     });
 92 }
 93 
 94 bool PlatformMediaSessionManager::canProduceAudio() const
 95 {
<span class="line-modified"> 96     return anyOfSessions([] (auto&amp; session) {</span>
 97         return session.canProduceAudio();
 98     });
 99 }
100 
101 int PlatformMediaSessionManager::count(PlatformMediaSession::MediaType type) const
102 {
103     ASSERT(type &gt;= PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
104 
105     int count = 0;
<span class="line-modified">106     for (const auto&amp; session : m_sessions) {</span>
107         if (session-&gt;mediaType() == type)
108             ++count;
109     }
110 
111     return count;
112 }
113 
114 void PlatformMediaSessionManager::beginInterruption(PlatformMediaSession::InterruptionType type)
115 {
<span class="line-modified">116     ALWAYS_LOG(LOGIDENTIFIER);</span>
117 
118     m_interrupted = true;
<span class="line-modified">119     forEachSession([type] (auto&amp; session) {</span>
120         session.beginInterruption(type);
121     });
122     updateSessionState();
123 }
124 
125 void PlatformMediaSessionManager::endInterruption(PlatformMediaSession::EndInterruptionFlags flags)
126 {
<span class="line-modified">127     ALWAYS_LOG(LOGIDENTIFIER);</span>
128 
129     m_interrupted = false;
<span class="line-modified">130     forEachSession([flags] (auto&amp; session) {</span>
131         session.endInterruption(flags);
132     });
133 }
134 
135 void PlatformMediaSessionManager::addSession(PlatformMediaSession&amp; session)
136 {
<span class="line-modified">137     ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier());</span>
<span class="line-modified">138     m_sessions.append(makeWeakPtr(session));</span>

139     if (m_interrupted)
140         session.setState(PlatformMediaSession::Interrupted);
141 
142     if (!m_remoteCommandListener)
143         m_remoteCommandListener = RemoteCommandListener::create(*this);
144 
145     if (!m_audioHardwareListener)
146         m_audioHardwareListener = AudioHardwareListener::create(*this);
147 
<span class="line-added">148 #if !RELEASE_LOG_DISABLED</span>
<span class="line-added">149     m_logger-&gt;addLogger(session.logger());</span>
<span class="line-added">150 #endif</span>
<span class="line-added">151 </span>
152     updateSessionState();
153 }
154 
155 void PlatformMediaSessionManager::removeSession(PlatformMediaSession&amp; session)
156 {
<span class="line-modified">157     ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier());</span>
158 
159     size_t index = m_sessions.find(&amp;session);
160     if (index == notFound)
161         return;
162 
<span class="line-modified">163     m_sessions.remove(index);</span>



164 
165     if (m_sessions.isEmpty() || std::all_of(m_sessions.begin(), m_sessions.end(), std::logical_not&lt;void&gt;())) {
166         m_remoteCommandListener = nullptr;
167         m_audioHardwareListener = nullptr;
168 #if USE(AUDIO_SESSION)
169         if (m_becameActive &amp;&amp; shouldDeactivateAudioSession()) {
170             AudioSession::sharedSession().tryToSetActive(false);
171             m_becameActive = false;
172         }
173 #endif
174     }
175 
<span class="line-added">176 #if !RELEASE_LOG_DISABLED</span>
<span class="line-added">177     m_logger-&gt;removeLogger(session.logger());</span>
<span class="line-added">178 #endif</span>
<span class="line-added">179 </span>
180     updateSessionState();
181 }
182 
183 void PlatformMediaSessionManager::addRestriction(PlatformMediaSession::MediaType type, SessionRestrictions restriction)
184 {
185     ASSERT(type &gt; PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
186     m_restrictions[type] |= restriction;
187 }
188 
189 void PlatformMediaSessionManager::removeRestriction(PlatformMediaSession::MediaType type, SessionRestrictions restriction)
190 {
191     ASSERT(type &gt; PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
192     m_restrictions[type] &amp;= ~restriction;
193 }
194 
195 PlatformMediaSessionManager::SessionRestrictions PlatformMediaSessionManager::restrictions(PlatformMediaSession::MediaType type)
196 {
197     ASSERT(type &gt; PlatformMediaSession::None &amp;&amp; type &lt;= PlatformMediaSession::MediaStreamCapturingAudio);
198     return m_restrictions[type];
199 }
200 
201 bool PlatformMediaSessionManager::sessionWillBeginPlayback(PlatformMediaSession&amp; session)
202 {


203     setCurrentSession(session);
204 
205     PlatformMediaSession::MediaType sessionType = session.mediaType();
206     SessionRestrictions restrictions = m_restrictions[sessionType];
<span class="line-modified">207     if (session.state() == PlatformMediaSession::Interrupted &amp;&amp; restrictions &amp; InterruptedPlaybackNotPermitted) {</span>
<span class="line-added">208         ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier(), &quot; returning false because session.state() is Interrupted, and InterruptedPlaybackNotPermitted&quot;);</span>
209         return false;
<span class="line-added">210     }</span>
211 
212 #if USE(AUDIO_SESSION)
<span class="line-modified">213     if (activeAudioSessionRequired()) {</span>
<span class="line-modified">214         if (!AudioSession::sharedSession().tryToSetActive(true)) {</span>
<span class="line-added">215             ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier(), &quot; returning false failed to set active AudioSession&quot;);</span>
<span class="line-added">216             return false;</span>
<span class="line-added">217         }</span>
218 
<span class="line-modified">219         ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier(), &quot; sucessfully activated AudioSession&quot;);</span>
<span class="line-added">220         m_becameActive = true;</span>
<span class="line-added">221     }</span>
222 #endif
223 
224     if (m_interrupted)
225         endInterruption(PlatformMediaSession::NoFlags);
226 
<span class="line-modified">227     if (restrictions &amp; ConcurrentPlaybackNotPermitted) {</span>
<span class="line-modified">228         forEachMatchingSession([&amp;session, sessionType](auto&amp; oneSession) {</span>
<span class="line-modified">229             return &amp;oneSession != &amp;session</span>
<span class="line-modified">230                 &amp;&amp; oneSession.mediaType() == sessionType</span>
<span class="line-modified">231                 &amp;&amp; oneSession.state() == PlatformMediaSession::Playing</span>
<span class="line-modified">232                 &amp;&amp; !oneSession.canPlayConcurrently(session);</span>
<span class="line-added">233         }, [](auto&amp; oneSession) {</span>
234             oneSession.pauseSession();
<span class="line-modified">235         });</span>
<span class="line-modified">236     }</span>
<span class="line-added">237     ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier(), &quot; returning true&quot;);</span>
238     return true;
239 }
240 
241 void PlatformMediaSessionManager::sessionWillEndPlayback(PlatformMediaSession&amp; session)
242 {
<span class="line-modified">243     ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier());</span>
244 
245     if (m_sessions.size() &lt; 2)
246         return;
247 
248     size_t pausingSessionIndex = notFound;
249     size_t lastPlayingSessionIndex = notFound;
<span class="line-modified">250     for (size_t i = 0, size = m_sessions.size(); i &lt; size; ++i) {</span>
<span class="line-modified">251         const auto&amp; oneSession = *m_sessions[i];</span>
<span class="line-added">252         if (&amp;oneSession == &amp;session)</span>
253             pausingSessionIndex = i;
<span class="line-modified">254         else if (oneSession.state() == PlatformMediaSession::Playing)</span>


255             lastPlayingSessionIndex = i;
<span class="line-modified">256         else</span>
<span class="line-modified">257             break;</span>
<span class="line-modified">258     }</span>
<span class="line-modified">259 </span>
260     if (lastPlayingSessionIndex == notFound || pausingSessionIndex == notFound)
261         return;
262 
263     if (pausingSessionIndex &gt; lastPlayingSessionIndex)
264         return;
265 
266     m_sessions.remove(pausingSessionIndex);
<span class="line-modified">267     m_sessions.append(makeWeakPtr(session));</span>
268 
<span class="line-modified">269     ALWAYS_LOG(LOGIDENTIFIER, &quot;session moved from index &quot;, pausingSessionIndex, &quot; to &quot;, lastPlayingSessionIndex);</span>
270 }
271 
272 void PlatformMediaSessionManager::sessionStateChanged(PlatformMediaSession&amp;)
273 {
274     updateSessionState();
275 }
276 
277 void PlatformMediaSessionManager::setCurrentSession(PlatformMediaSession&amp; session)
278 {
<span class="line-modified">279     ALWAYS_LOG(LOGIDENTIFIER, session.logIdentifier());</span>
280 
281     if (m_sessions.size() &lt; 2)
282         return;
283 
284     size_t index = m_sessions.find(&amp;session);
285     ASSERT(index != notFound);
286     if (!index || index == notFound)
287         return;
288 
289     m_sessions.remove(index);
<span class="line-modified">290     m_sessions.insert(0, makeWeakPtr(session));</span>
291     if (m_remoteCommandListener)
292         m_remoteCommandListener-&gt;updateSupportedCommands();
293 
<span class="line-modified">294     ALWAYS_LOG(LOGIDENTIFIER, &quot;session moved from index &quot;, index, &quot; to 0&quot;);</span>
295 }
296 
297 PlatformMediaSession* PlatformMediaSessionManager::currentSession() const
298 {
299     if (!m_sessions.size())
300         return nullptr;
301 
<span class="line-modified">302     return m_sessions[0].get();</span>
303 }
304 
<span class="line-modified">305 void PlatformMediaSessionManager::applicationWillBecomeInactive()</span>
306 {
<span class="line-modified">307     ALWAYS_LOG(LOGIDENTIFIER);</span>










308 
<span class="line-modified">309     forEachMatchingSession([&amp;](auto&amp; session) {</span>
<span class="line-modified">310         return m_restrictions[session.mediaType()] &amp; InactiveProcessPlaybackRestricted;</span>
<span class="line-modified">311     }, [](auto&amp; session) {</span>
<span class="line-added">312         session.beginInterruption(PlatformMediaSession::ProcessInactive);</span>
313     });
314 }
315 
<span class="line-modified">316 void PlatformMediaSessionManager::applicationDidBecomeActive()</span>
317 {
<span class="line-modified">318     ALWAYS_LOG(LOGIDENTIFIER);</span>
319 
<span class="line-modified">320     forEachMatchingSession([&amp;](auto&amp; session) {</span>
<span class="line-modified">321         return m_restrictions[session.mediaType()] &amp; InactiveProcessPlaybackRestricted;</span>
<span class="line-modified">322     }, [](auto&amp; session) {</span>
<span class="line-added">323         session.endInterruption(PlatformMediaSession::MayResumePlaying);</span>
324     });
325 }
326 
<span class="line-modified">327 void PlatformMediaSessionManager::applicationDidEnterBackground(bool suspendedUnderLock)</span>
328 {
<span class="line-modified">329     ALWAYS_LOG(LOGIDENTIFIER, &quot;suspendedUnderLock: &quot;, suspendedUnderLock);</span>
330 
331     if (m_isApplicationInBackground)
332         return;
333 
334     m_isApplicationInBackground = true;
335 
<span class="line-modified">336     forEachSession([&amp;] (auto&amp; session) {</span>
337         if (suspendedUnderLock &amp;&amp; m_restrictions[session.mediaType()] &amp; SuspendedUnderLockPlaybackRestricted)
338             session.beginInterruption(PlatformMediaSession::SuspendedUnderLock);
339         else if (m_restrictions[session.mediaType()] &amp; BackgroundProcessPlaybackRestricted)
340             session.beginInterruption(PlatformMediaSession::EnteringBackground);
341     });
342 }
343 
<span class="line-modified">344 void PlatformMediaSessionManager::applicationWillEnterForeground(bool suspendedUnderLock)</span>
345 {
<span class="line-modified">346     ALWAYS_LOG(LOGIDENTIFIER, &quot;suspendedUnderLock: &quot;, suspendedUnderLock);</span>
347 
348     if (!m_isApplicationInBackground)
349         return;
350 
351     m_isApplicationInBackground = false;
352 
<span class="line-modified">353     forEachMatchingSession([&amp;](auto&amp; session) {</span>
<span class="line-modified">354         return (suspendedUnderLock &amp;&amp; m_restrictions[session.mediaType()] &amp; SuspendedUnderLockPlaybackRestricted) || m_restrictions[session.mediaType()] &amp; BackgroundProcessPlaybackRestricted;</span>
<span class="line-modified">355     }, [](auto&amp; session) {</span>
<span class="line-added">356         session.endInterruption(PlatformMediaSession::MayResumePlaying);</span>
357     });
358 }
359 
<span class="line-added">360 void PlatformMediaSessionManager::processWillSuspend()</span>
<span class="line-added">361 {</span>
<span class="line-added">362     if (m_processIsSuspended)</span>
<span class="line-added">363         return;</span>
<span class="line-added">364     m_processIsSuspended = true;</span>
<span class="line-added">365 </span>
<span class="line-added">366     forEachSession([&amp;] (auto&amp; session) {</span>
<span class="line-added">367         session.client().processIsSuspendedChanged();</span>
<span class="line-added">368     });</span>
<span class="line-added">369 </span>
<span class="line-added">370 #if USE(AUDIO_SESSION)</span>
<span class="line-added">371     if (m_becameActive &amp;&amp; shouldDeactivateAudioSession()) {</span>
<span class="line-added">372         AudioSession::sharedSession().tryToSetActive(false);</span>
<span class="line-added">373         ALWAYS_LOG(LOGIDENTIFIER, &quot;tried to set inactive AudioSession&quot;);</span>
<span class="line-added">374         m_becameActive = false;</span>
<span class="line-added">375     }</span>
<span class="line-added">376 #endif</span>
<span class="line-added">377 }</span>
<span class="line-added">378 </span>
<span class="line-added">379 void PlatformMediaSessionManager::processDidResume()</span>
<span class="line-added">380 {</span>
<span class="line-added">381     if (!m_processIsSuspended)</span>
<span class="line-added">382         return;</span>
<span class="line-added">383     m_processIsSuspended = false;</span>
<span class="line-added">384 </span>
<span class="line-added">385     forEachSession([&amp;] (auto&amp; session) {</span>
<span class="line-added">386         session.client().processIsSuspendedChanged();</span>
<span class="line-added">387     });</span>
<span class="line-added">388 </span>
<span class="line-added">389 #if USE(AUDIO_SESSION)</span>
<span class="line-added">390     if (!m_becameActive &amp;&amp; activeAudioSessionRequired()) {</span>
<span class="line-added">391         m_becameActive = AudioSession::sharedSession().tryToSetActive(true);</span>
<span class="line-added">392         ALWAYS_LOG(LOGIDENTIFIER, &quot;tried to set active AudioSession, &quot;, m_becameActive ? &quot;succeeded&quot; : &quot;failed&quot;);</span>
<span class="line-added">393     }</span>
<span class="line-added">394 #endif</span>
<span class="line-added">395 }</span>
<span class="line-added">396 </span>
<span class="line-added">397 void PlatformMediaSessionManager::setIsPlayingToAutomotiveHeadUnit(bool isPlayingToAutomotiveHeadUnit)</span>
<span class="line-added">398 {</span>
<span class="line-added">399     if (isPlayingToAutomotiveHeadUnit == m_isPlayingToAutomotiveHeadUnit)</span>
<span class="line-added">400         return;</span>
<span class="line-added">401 </span>
<span class="line-added">402     ALWAYS_LOG(LOGIDENTIFIER, isPlayingToAutomotiveHeadUnit);</span>
<span class="line-added">403     m_isPlayingToAutomotiveHeadUnit = isPlayingToAutomotiveHeadUnit;</span>
<span class="line-added">404 }</span>
<span class="line-added">405 </span>
406 void PlatformMediaSessionManager::sessionIsPlayingToWirelessPlaybackTargetChanged(PlatformMediaSession&amp; session)
407 {
408     if (!m_isApplicationInBackground || !(m_restrictions[session.mediaType()] &amp; BackgroundProcessPlaybackRestricted))
409         return;
410 
411     if (session.state() != PlatformMediaSession::Interrupted)
412         session.beginInterruption(PlatformMediaSession::EnteringBackground);
413 }
414 
415 void PlatformMediaSessionManager::sessionCanProduceAudioChanged(PlatformMediaSession&amp;)
416 {
417     updateSessionState();
418 }
419 
420 void PlatformMediaSessionManager::didReceiveRemoteControlCommand(PlatformMediaSession::RemoteControlCommandType command, const PlatformMediaSession::RemoteCommandArgument* argument)
421 {
422     PlatformMediaSession* activeSession = currentSession();
423     if (!activeSession || !activeSession-&gt;canReceiveRemoteControlCommands())
424         return;
425     activeSession-&gt;didReceiveRemoteControlCommand(command, argument);
426 }
427 
428 bool PlatformMediaSessionManager::supportsSeeking() const
429 {
430     PlatformMediaSession* activeSession = currentSession();
431     if (!activeSession)
432         return false;
433     return activeSession-&gt;supportsSeeking();
434 }
435 
436 void PlatformMediaSessionManager::systemWillSleep()
437 {
438     if (m_interrupted)
439         return;
440 
<span class="line-modified">441     forEachSession([] (auto&amp; session) {</span>
442         session.beginInterruption(PlatformMediaSession::SystemSleep);
443     });
444 }
445 
446 void PlatformMediaSessionManager::systemDidWake()
447 {
448     if (m_interrupted)
449         return;
450 
<span class="line-modified">451     forEachSession([] (auto&amp; session) {</span>
452         session.endInterruption(PlatformMediaSession::MayResumePlaying);
453     });
454 }
455 
456 void PlatformMediaSessionManager::audioOutputDeviceChanged()
457 {
458     updateSessionState();
459 }
460 
<span class="line-modified">461 void PlatformMediaSessionManager::stopAllMediaPlaybackForDocument(const Document&amp; document)</span>
462 {
<span class="line-modified">463     forEachDocumentSession(document, [](auto&amp; session) {</span>
<span class="line-modified">464         session.pauseSession();</span>

465     });
466 }
467 
468 void PlatformMediaSessionManager::stopAllMediaPlaybackForProcess()
469 {
<span class="line-modified">470     forEachSession([] (auto&amp; session) {</span>
471         session.stopSession();
472     });
473 }
474 
475 void PlatformMediaSessionManager::suspendAllMediaPlaybackForDocument(const Document&amp; document)
476 {
<span class="line-modified">477     forEachDocumentSession(document, [](auto&amp; session) {</span>
<span class="line-modified">478         session.beginInterruption(PlatformMediaSession::PlaybackSuspended);</span>

479     });
480 }
481 
482 void PlatformMediaSessionManager::resumeAllMediaPlaybackForDocument(const Document&amp; document)
483 {
<span class="line-modified">484     forEachDocumentSession(document, [](auto&amp; session) {</span>
<span class="line-modified">485         session.endInterruption(PlatformMediaSession::MayResumePlaying);</span>

486     });
487 }
488 
<span class="line-modified">489 void PlatformMediaSessionManager::suspendAllMediaBufferingForDocument(const Document&amp; document)</span>
490 {
<span class="line-modified">491     forEachDocumentSession(document, [](auto&amp; session) {</span>
<span class="line-modified">492         session.suspendBuffering();</span>
<span class="line-modified">493     });</span>
<span class="line-modified">494 }</span>




495 
<span class="line-modified">496 void PlatformMediaSessionManager::resumeAllMediaBufferingForDocument(const Document&amp; document)</span>
<span class="line-modified">497 {</span>
<span class="line-modified">498     forEachDocumentSession(document, [](auto&amp; session) {</span>
<span class="line-added">499         session.resumeBuffering();</span>
<span class="line-added">500     });</span>
501 }
502 
<span class="line-modified">503 Vector&lt;WeakPtr&lt;PlatformMediaSession&gt;&gt; PlatformMediaSessionManager::sessionsMatching(const WTF::Function&lt;bool(const PlatformMediaSession&amp;)&gt;&amp; filter) const</span>
504 {
<span class="line-modified">505     Vector&lt;WeakPtr&lt;PlatformMediaSession&gt;&gt; matchingSessions;</span>
<span class="line-added">506     for (auto&amp; session : m_sessions) {</span>
<span class="line-added">507         if (filter(*session))</span>
<span class="line-added">508             matchingSessions.append(session);</span>
<span class="line-added">509     }</span>
<span class="line-added">510     return matchingSessions;</span>
<span class="line-added">511 }</span>
512 
<span class="line-modified">513 void PlatformMediaSessionManager::forEachMatchingSession(const Function&lt;bool(const PlatformMediaSession&amp;)&gt;&amp; predicate, const Function&lt;void(PlatformMediaSession&amp;)&gt;&amp; callback)</span>
<span class="line-modified">514 {</span>
<span class="line-modified">515     for (auto&amp; session : sessionsMatching(predicate)) {</span>
<span class="line-modified">516         ASSERT(session);</span>
<span class="line-modified">517         if (session)</span>
<span class="line-added">518             callback(*session);</span>
<span class="line-added">519     }</span>
<span class="line-added">520 }</span>
521 
<span class="line-modified">522 void PlatformMediaSessionManager::forEachDocumentSession(const Document&amp; document, const Function&lt;void(PlatformMediaSession&amp;)&gt;&amp; callback)</span>
<span class="line-modified">523 {</span>
<span class="line-added">524     forEachMatchingSession([&amp;document](auto&amp; session) {</span>
<span class="line-added">525         return session.client().hostingDocument() == &amp;document;</span>
<span class="line-added">526     }, [&amp;callback](auto&amp; session) {</span>
<span class="line-added">527         callback(session);</span>
<span class="line-added">528     });</span>
<span class="line-added">529 }</span>
530 
<span class="line-modified">531 void PlatformMediaSessionManager::forEachSession(const Function&lt;void(PlatformMediaSession&amp;)&gt;&amp; callback)</span>
<span class="line-modified">532 {</span>
<span class="line-added">533     auto sessions = m_sessions;</span>
<span class="line-added">534     for (auto&amp; session : sessions) {</span>
<span class="line-added">535         ASSERT(session);</span>
<span class="line-added">536         if (session)</span>
<span class="line-added">537             callback(*session);</span>
538     }
<span class="line-added">539 }</span>
540 
<span class="line-modified">541 bool PlatformMediaSessionManager::anyOfSessions(const Function&lt;bool(const PlatformMediaSession&amp;)&gt;&amp; predicate) const</span>
<span class="line-modified">542 {</span>
<span class="line-modified">543     return WTF::anyOf(m_sessions, [&amp;predicate](const auto&amp; session) {</span>
<span class="line-modified">544         return predicate(*session);</span>
<span class="line-modified">545     });</span>
546 }
547 
548 static bool&amp; deactivateAudioSession()
549 {
550     static bool deactivate;
551     return deactivate;
552 }
553 
554 bool PlatformMediaSessionManager::shouldDeactivateAudioSession()
555 {
556     return deactivateAudioSession();
557 }
558 
559 void PlatformMediaSessionManager::setShouldDeactivateAudioSession(bool deactivate)
560 {
561     deactivateAudioSession() = deactivate;
562 }
563 
564 #else // ENABLE(VIDEO) || ENABLE(WEB_AUDIO)
565 
566 void PlatformMediaSessionManager::updateNowPlayingInfoIfNecessary()
567 {
568 
569 }
570 
571 #endif // ENABLE(VIDEO) || ENABLE(WEB_AUDIO)
572 
<span class="line-added">573 #if !RELEASE_LOG_DISABLED</span>
<span class="line-added">574 WTFLogChannel&amp; PlatformMediaSessionManager::logChannel() const</span>
<span class="line-added">575 {</span>
<span class="line-added">576     return LogMedia;</span>
<span class="line-added">577 }</span>
<span class="line-added">578 #endif</span>
<span class="line-added">579 </span>
580 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="PlatformMediaSession.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="PlatformMediaSessionManager.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>