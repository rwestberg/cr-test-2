<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/FontCascadeDescription.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="FontCascade.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="FontCascadeDescription.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/platform/graphics/FontCascadeDescription.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
 24  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 25  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 26  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 27  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 28  */
 29 
 30 #include &quot;config.h&quot;
 31 #include &quot;FontCascadeDescription.h&quot;
 32 
 33 #include &lt;wtf/text/StringHash.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 struct SameSizeAsFontCascadeDescription {
 38     Vector&lt;void*&gt; vector;
 39 #if ENABLE(VARIATION_FONTS)
 40     Vector&lt;void*&gt; vector2;
 41 #else
 42     char c;
 43 #endif
<span class="line-modified"> 44     AtomicString string;</span>
 45     int16_t fontSelectionRequest[3];
 46     float size;
 47     unsigned bitfields1;
 48     unsigned bitfields2 : 22;
 49     void* array;
 50     float size2;
 51     unsigned bitfields3 : 10;
 52 };
 53 
 54 COMPILE_ASSERT(sizeof(FontCascadeDescription) == sizeof(SameSizeAsFontCascadeDescription), FontCascadeDescription_should_stay_small);
 55 
 56 FontCascadeDescription::FontCascadeDescription()
 57     : m_isAbsoluteSize(false)
 58     , m_kerning(static_cast&lt;unsigned&gt;(Kerning::Auto))
 59     , m_keywordSize(0)
 60     , m_fontSmoothing(static_cast&lt;unsigned&gt;(FontSmoothingMode::AutoSmoothing))
 61     , m_isSpecifiedFont(false)
 62 {
 63 }
 64 
<span class="line-modified"> 65 #if !USE_PLATFORM_SYSTEM_FALLBACK_LIST</span>

 66 unsigned FontCascadeDescription::effectiveFamilyCount() const
 67 {
 68     return familyCount();
 69 }
 70 
 71 FontFamilySpecification FontCascadeDescription::effectiveFamilyAt(unsigned i) const
 72 {
 73     return familyAt(i);
 74 }

 75 #endif
 76 
 77 FontSelectionValue FontCascadeDescription::lighterWeight(FontSelectionValue weight)
 78 {
 79     if (weight &lt; FontSelectionValue(100))
 80         return weight;
 81     if (weight &lt; FontSelectionValue(550))
 82         return FontSelectionValue(100);
 83     if (weight &lt; FontSelectionValue(750))
 84         return FontSelectionValue(400);
 85     return FontSelectionValue(700);
 86 }
 87 
 88 FontSelectionValue FontCascadeDescription::bolderWeight(FontSelectionValue weight)
 89 {
 90     if (weight &lt; FontSelectionValue(350))
 91         return FontSelectionValue(400);
 92     if (weight &lt; FontSelectionValue(550))
 93         return FontSelectionValue(700);
 94     if (weight &lt; FontSelectionValue(900))
 95         return FontSelectionValue(900);
 96     return weight;
 97 }
 98 
 99 #if ENABLE(TEXT_AUTOSIZING)
100 
101 bool FontCascadeDescription::familiesEqualForTextAutoSizing(const FontCascadeDescription&amp; other) const
102 {
103     unsigned thisFamilyCount = familyCount();
104     unsigned otherFamilyCount = other.familyCount();
105 
106     if (thisFamilyCount != otherFamilyCount)
107         return false;
108 
109     for (unsigned i = 0; i &lt; thisFamilyCount; ++i) {
<span class="line-modified">110         if (!equalIgnoringASCIICase(familyAt(i), other.familyAt(i)))</span>
111             return false;
112     }
113 
114     return true;
115 }
116 
117 #endif // ENABLE(TEXT_AUTOSIZING)
118 
<span class="line-modified">119 bool FontCascadeDescription::familyNamesAreEqual(const AtomicString&amp; family1, const AtomicString&amp; family2)</span>
120 {
<span class="line-modified">121     // FIXME: &lt;rdar://problem/33594253&gt; CoreText matches dot-prefixed font names case sensitively. We should</span>
<span class="line-removed">122     // always take the case insensitive patch once this radar is fixed.</span>
123     if (family1.startsWith(&#39;.&#39;))
<span class="line-modified">124         return StringHash::equal(family1.string(), family2.string());</span>

125     return ASCIICaseInsensitiveHash::equal(family1, family2);
126 }
127 
<span class="line-modified">128 unsigned FontCascadeDescription::familyNameHash(const AtomicString&amp; family)</span>
129 {
<span class="line-modified">130     // FIXME: &lt;rdar://problem/33594253&gt; CoreText matches dot-prefixed font names case sensitively. We should</span>
<span class="line-removed">131     // always take the case insensitive patch once this radar is fixed.</span>
132     if (family.startsWith(&#39;.&#39;))
<span class="line-modified">133         return StringHash::hash(family.string());</span>

134     return ASCIICaseInsensitiveHash::hash(family);
135 }
136 
<span class="line-modified">137 String FontCascadeDescription::foldedFamilyName(const AtomicString&amp; family)</span>
138 {
<span class="line-modified">139     // FIXME: &lt;rdar://problem/33594253&gt; CoreText matches dot-prefixed font names case sensitively. We should</span>
<span class="line-removed">140     // always take the case insensitive patch once this radar is fixed.</span>
141     if (family.startsWith(&#39;.&#39;))
<span class="line-modified">142         return family.string();</span>
<span class="line-modified">143     return family.string().foldCase();</span>

144 }
145 
146 } // namespace WebCore
</pre>
</td>
<td>
<hr />
<pre>
 24  * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 25  * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 26  * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 27  * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 28  */
 29 
 30 #include &quot;config.h&quot;
 31 #include &quot;FontCascadeDescription.h&quot;
 32 
 33 #include &lt;wtf/text/StringHash.h&gt;
 34 
 35 namespace WebCore {
 36 
 37 struct SameSizeAsFontCascadeDescription {
 38     Vector&lt;void*&gt; vector;
 39 #if ENABLE(VARIATION_FONTS)
 40     Vector&lt;void*&gt; vector2;
 41 #else
 42     char c;
 43 #endif
<span class="line-modified"> 44     AtomString string;</span>
 45     int16_t fontSelectionRequest[3];
 46     float size;
 47     unsigned bitfields1;
 48     unsigned bitfields2 : 22;
 49     void* array;
 50     float size2;
 51     unsigned bitfields3 : 10;
 52 };
 53 
 54 COMPILE_ASSERT(sizeof(FontCascadeDescription) == sizeof(SameSizeAsFontCascadeDescription), FontCascadeDescription_should_stay_small);
 55 
 56 FontCascadeDescription::FontCascadeDescription()
 57     : m_isAbsoluteSize(false)
 58     , m_kerning(static_cast&lt;unsigned&gt;(Kerning::Auto))
 59     , m_keywordSize(0)
 60     , m_fontSmoothing(static_cast&lt;unsigned&gt;(FontSmoothingMode::AutoSmoothing))
 61     , m_isSpecifiedFont(false)
 62 {
 63 }
 64 
<span class="line-modified"> 65 #if !USE(PLATFORM_SYSTEM_FALLBACK_LIST)</span>
<span class="line-added"> 66 </span>
 67 unsigned FontCascadeDescription::effectiveFamilyCount() const
 68 {
 69     return familyCount();
 70 }
 71 
 72 FontFamilySpecification FontCascadeDescription::effectiveFamilyAt(unsigned i) const
 73 {
 74     return familyAt(i);
 75 }
<span class="line-added"> 76 </span>
 77 #endif
 78 
 79 FontSelectionValue FontCascadeDescription::lighterWeight(FontSelectionValue weight)
 80 {
 81     if (weight &lt; FontSelectionValue(100))
 82         return weight;
 83     if (weight &lt; FontSelectionValue(550))
 84         return FontSelectionValue(100);
 85     if (weight &lt; FontSelectionValue(750))
 86         return FontSelectionValue(400);
 87     return FontSelectionValue(700);
 88 }
 89 
 90 FontSelectionValue FontCascadeDescription::bolderWeight(FontSelectionValue weight)
 91 {
 92     if (weight &lt; FontSelectionValue(350))
 93         return FontSelectionValue(400);
 94     if (weight &lt; FontSelectionValue(550))
 95         return FontSelectionValue(700);
 96     if (weight &lt; FontSelectionValue(900))
 97         return FontSelectionValue(900);
 98     return weight;
 99 }
100 
101 #if ENABLE(TEXT_AUTOSIZING)
102 
103 bool FontCascadeDescription::familiesEqualForTextAutoSizing(const FontCascadeDescription&amp; other) const
104 {
105     unsigned thisFamilyCount = familyCount();
106     unsigned otherFamilyCount = other.familyCount();
107 
108     if (thisFamilyCount != otherFamilyCount)
109         return false;
110 
111     for (unsigned i = 0; i &lt; thisFamilyCount; ++i) {
<span class="line-modified">112         if (!familyNamesAreEqual(familyAt(i), other.familyAt(i)))</span>
113             return false;
114     }
115 
116     return true;
117 }
118 
119 #endif // ENABLE(TEXT_AUTOSIZING)
120 
<span class="line-modified">121 bool FontCascadeDescription::familyNamesAreEqual(const AtomString&amp; family1, const AtomString&amp; family2)</span>
122 {
<span class="line-modified">123 #if PLATFORM(COCOA)</span>

124     if (family1.startsWith(&#39;.&#39;))
<span class="line-modified">125         return family1 == family2;</span>
<span class="line-added">126 #endif</span>
127     return ASCIICaseInsensitiveHash::equal(family1, family2);
128 }
129 
<span class="line-modified">130 unsigned FontCascadeDescription::familyNameHash(const AtomString&amp; family)</span>
131 {
<span class="line-modified">132 #if PLATFORM(COCOA)</span>

133     if (family.startsWith(&#39;.&#39;))
<span class="line-modified">134         return family.existingHash();</span>
<span class="line-added">135 #endif</span>
136     return ASCIICaseInsensitiveHash::hash(family);
137 }
138 
<span class="line-modified">139 String FontCascadeDescription::foldedFamilyName(const String&amp; family)</span>
140 {
<span class="line-modified">141 #if PLATFORM(COCOA)</span>

142     if (family.startsWith(&#39;.&#39;))
<span class="line-modified">143         return family;</span>
<span class="line-modified">144 #endif</span>
<span class="line-added">145     return family.convertToASCIILowercase();</span>
146 }
147 
148 } // namespace WebCore
</pre>
</td>
</tr>
</table>
<center><a href="FontCascade.h.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> <a href="FontCascadeDescription.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>