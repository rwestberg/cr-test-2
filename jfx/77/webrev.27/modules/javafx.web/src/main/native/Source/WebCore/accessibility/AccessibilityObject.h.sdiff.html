<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.web/src/main/native/Source/WebCore/accessibility/AccessibilityObject.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="AccessibilityObject.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AccessibilityObjectInterface.h.sdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/accessibility/AccessibilityObject.h</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  28  */
  29 
  30 #pragma once
  31 
  32 #include &quot;AccessibilityObjectInterface.h&quot;
  33 #include &quot;FloatQuad.h&quot;
  34 #include &quot;HTMLTextFormControlElement.h&quot;
  35 #include &quot;LayoutRect.h&quot;
  36 #include &quot;Path.h&quot;
  37 #include &quot;Range.h&quot;
  38 #include &quot;TextIteratorBehavior.h&quot;
  39 #include &quot;VisiblePosition.h&quot;
  40 #include &quot;VisibleSelection.h&quot;
  41 #include &lt;wtf/Forward.h&gt;
  42 #include &lt;wtf/Function.h&gt;
  43 #include &lt;wtf/RefPtr.h&gt;
  44 #include &lt;wtf/Vector.h&gt;
  45 
  46 #if PLATFORM(COCOA)
  47 #include &lt;wtf/RetainPtr.h&gt;
<span class="line-removed">  48 #elif PLATFORM(WIN)</span>
<span class="line-removed">  49 #include &quot;AccessibilityObjectWrapperWin.h&quot;</span>
<span class="line-removed">  50 #include &quot;COMPtr.h&quot;</span>
  51 #endif
  52 
<span class="line-modified">  53 #if PLATFORM(GTK)</span>
  54 #include &lt;wtf/glib/GRefPtr.h&gt;
  55 #endif
  56 
  57 #if PLATFORM(COCOA)
  58 
  59 typedef struct _NSRange NSRange;
  60 
  61 OBJC_CLASS NSArray;
  62 OBJC_CLASS NSAttributedString;
  63 OBJC_CLASS NSData;
  64 OBJC_CLASS NSMutableAttributedString;
  65 OBJC_CLASS NSString;
  66 OBJC_CLASS NSValue;
  67 OBJC_CLASS NSView;
<span class="line-removed">  68 OBJC_CLASS WebAccessibilityObjectWrapper;</span>
<span class="line-removed">  69 </span>
<span class="line-removed">  70 typedef WebAccessibilityObjectWrapper AccessibilityObjectWrapper;</span>
  71 
<span class="line-removed">  72 #elif PLATFORM(GTK)</span>
<span class="line-removed">  73 typedef struct _WebKitAccessible WebKitAccessible;</span>
<span class="line-removed">  74 typedef struct _WebKitAccessible AccessibilityObjectWrapper;</span>
<span class="line-removed">  75 #elif PLATFORM(WPE)</span>
<span class="line-removed">  76 class AccessibilityObjectWrapper : public RefCounted&lt;AccessibilityObjectWrapper&gt; { };</span>
<span class="line-removed">  77 #else</span>
<span class="line-removed">  78 class AccessibilityObjectWrapper;</span>
  79 #endif
  80 
  81 namespace WebCore {
  82 
  83 class AccessibilityObject;

  84 class AXObjectCache;
  85 class Element;
  86 class Frame;
  87 class FrameView;
  88 class IntPoint;
  89 class IntSize;
  90 class Node;
  91 class Page;
  92 class RenderObject;
  93 class ScrollableArea;
  94 class ScrollView;
  95 class Widget;

  96 
  97 enum class AccessibilityTextSource {
  98     Alternative,
  99     Children,
 100     Summary,
 101     Help,
 102     Visible,
 103     TitleTag,
 104     Placeholder,
 105     LabelByElement,
 106     Title,
 107     Subtitle,
 108     Action,
 109 };
 110 
<span class="line-removed"> 111 enum class AccessibilityEventType {</span>
<span class="line-removed"> 112     ContextMenu,</span>
<span class="line-removed"> 113     Click,</span>
<span class="line-removed"> 114     Decrement,</span>
<span class="line-removed"> 115     Dismiss,</span>
<span class="line-removed"> 116     Focus,</span>
<span class="line-removed"> 117     Increment,</span>
<span class="line-removed"> 118     ScrollIntoView,</span>
<span class="line-removed"> 119     Select,</span>
<span class="line-removed"> 120 };</span>
<span class="line-removed"> 121 </span>
 122 struct AccessibilityText {
 123     String text;
 124     AccessibilityTextSource textSource;
 125     Vector&lt;RefPtr&lt;AccessibilityObject&gt;&gt; textElements;
 126 
 127     AccessibilityText(const String&amp; t, const AccessibilityTextSource&amp; s)
 128         : text(t)
 129         , textSource(s)
 130     { }
 131 
 132     AccessibilityText(const String&amp; t, const AccessibilityTextSource&amp; s, Vector&lt;RefPtr&lt;AccessibilityObject&gt;&gt; elements)
 133         : text(t)
 134         , textSource(s)
 135         , textElements(WTFMove(elements))
 136     { }
 137 
 138     AccessibilityText(const String&amp; t, const AccessibilityTextSource&amp; s, RefPtr&lt;AccessibilityObject&gt;&amp;&amp; element)
 139         : text(t)
 140         , textSource(s)
 141     {
</pre>
<hr />
<pre>
 214     Blockquote,
 215     BoldFont,
 216     Button,
 217     CheckBox,
 218     Control,
 219     DifferentType,
 220     FontChange,
 221     FontColorChange,
 222     Frame,
 223     Graphic,
 224     HeadingLevel1,
 225     HeadingLevel2,
 226     HeadingLevel3,
 227     HeadingLevel4,
 228     HeadingLevel5,
 229     HeadingLevel6,
 230     HeadingSameLevel,
 231     Heading,
 232     Highlighted,
 233     ItalicFont,

 234     Landmark,
 235     Link,
 236     List,
 237     LiveRegion,
 238     MisspelledWord,
 239     Outline,
 240     PlainText,
 241     RadioGroup,
 242     SameType,
 243     StaticText,
 244     StyleChange,
 245     TableSameLevel,
 246     Table,
 247     TextField,
 248     Underline,
 249     UnvisitedLink,
 250     VisitedLink,
 251 };
 252 
 253 enum class AccessibilityVisiblePositionForBounds {
</pre>
<hr />
<pre>
 291     VisiblePositionRange(const VisibleSelection&amp; selection)
 292         : start(selection.start())
 293         , end(selection.end())
 294     { }
 295 
 296     bool isNull() const { return start.isNull() || end.isNull(); }
 297 };
 298 
 299 struct PlainTextRange {
 300 
 301     unsigned start { 0 };
 302     unsigned length { 0 };
 303 
 304     PlainTextRange() = default;
 305 
 306     PlainTextRange(unsigned s, unsigned l)
 307         : start(s)
 308         , length(l)
 309     { }
 310 




 311     bool isNull() const { return !start &amp;&amp; !length; }
 312 };
 313 
<span class="line-modified"> 314 enum class AccessibilitySelectTextActivity {</span>
<span class="line-modified"> 315     FindAndReplace,</span>
<span class="line-modified"> 316     FindAndSelect,</span>
<span class="line-modified"> 317     FindAndCapitalize,</span>
<span class="line-removed"> 318     FindAndLowercase,</span>
<span class="line-removed"> 319     FindAndUppercase</span>
 320 };
 321 
<span class="line-modified"> 322 enum class AccessibilitySelectTextAmbiguityResolution {</span>
<span class="line-modified"> 323     ClosestAfter,</span>
<span class="line-modified"> 324     ClosestBefore,</span>
<span class="line-modified"> 325     ClosestTo</span>

 326 };
 327 
<span class="line-modified"> 328 struct AccessibilitySelectTextCriteria {</span>
<span class="line-modified"> 329     AccessibilitySelectTextActivity activity;</span>
<span class="line-modified"> 330     AccessibilitySelectTextAmbiguityResolution ambiguityResolution;</span>
<span class="line-modified"> 331     String replacementString;</span>
<span class="line-removed"> 332     Vector&lt;String&gt; searchStrings;</span>
 333 
<span class="line-modified"> 334     AccessibilitySelectTextCriteria(AccessibilitySelectTextActivity activity, AccessibilitySelectTextAmbiguityResolution ambiguityResolution, const String&amp; replacementString)</span>
<span class="line-modified"> 335         : activity(activity)</span>
<span class="line-modified"> 336         , ambiguityResolution(ambiguityResolution)</span>
<span class="line-modified"> 337         , replacementString(replacementString)</span>

















 338     { }
 339 };
 340 
 341 enum class AccessibilityMathScriptObjectType { Subscript, Superscript };
 342 enum class AccessibilityMathMultiscriptObjectType { PreSubscript, PreSuperscript, PostSubscript, PostSuperscript };
 343 
 344 enum class AccessibilityCurrentState { False, True, Page, Step, Location, Date, Time };

 345 
 346 bool nodeHasPresentationRole(Node*);
 347 
 348 class AccessibilityObject : public RefCounted&lt;AccessibilityObject&gt;, public AccessibilityObjectInterface {
 349 protected:
 350     AccessibilityObject() = default;
 351 
 352 public:
 353     virtual ~AccessibilityObject();
 354 
 355     // After constructing an AccessibilityObject, it must be given a
 356     // unique ID, then added to AXObjectCache, and finally init() must
 357     // be called last.
 358     void setAXObjectID(AXID axObjectID) { m_id = axObjectID; }
 359     virtual void init() { }
 360 
 361     // When the corresponding WebCore object that this AccessibilityObject
 362     // wraps is deleted, it must be detached.
 363     virtual void detach(AccessibilityDetachmentType, AXObjectCache* cache = nullptr);
 364     virtual bool isDetached() const;
 365 
 366     typedef Vector&lt;RefPtr&lt;AccessibilityObject&gt;&gt; AccessibilityChildrenVector;
 367 
 368     virtual bool isAccessibilityNodeObject() const { return false; }
 369     virtual bool isAccessibilityRenderObject() const { return false; }
 370     virtual bool isAccessibilityScrollbar() const { return false; }
 371     virtual bool isAccessibilityScrollView() const { return false; }
 372     virtual bool isAccessibilitySVGRoot() const { return false; }
 373     virtual bool isAccessibilitySVGElement() const { return false; }
 374 
 375     bool accessibilityObjectContainsText(String *) const;
 376 
 377     virtual bool isAttachmentElement() const { return false; }
 378     virtual bool isHeading() const { return false; }
<span class="line-modified"> 379     virtual bool isLink() const { return false; }</span>
<span class="line-modified"> 380     virtual bool isImage() const { return false; }</span>
 381     virtual bool isImageMap() const { return roleValue() == AccessibilityRole::ImageMap; }
 382     virtual bool isNativeImage() const { return false; }
 383     virtual bool isImageButton() const { return false; }
 384     virtual bool isPasswordField() const { return false; }
 385     bool isContainedByPasswordField() const;
 386     virtual AccessibilityObject* passwordFieldOrContainingPasswordField() { return nullptr; }
 387     virtual bool isNativeTextControl() const { return false; }
 388     virtual bool isSearchField() const { return false; }
 389     bool isWebArea() const { return roleValue() == AccessibilityRole::WebArea; }
 390     virtual bool isCheckbox() const { return roleValue() == AccessibilityRole::CheckBox; }
 391     virtual bool isRadioButton() const { return roleValue() == AccessibilityRole::RadioButton; }
 392     virtual bool isNativeListBox() const { return false; }
 393     bool isListBox() const { return roleValue() == AccessibilityRole::ListBox; }
 394     virtual bool isListBoxOption() const { return false; }
<span class="line-modified"> 395     virtual bool isAttachment() const { return false; }</span>
 396     virtual bool isMediaTimeline() const { return false; }
 397     virtual bool isMenuRelated() const { return false; }
 398     virtual bool isMenu() const { return false; }
 399     virtual bool isMenuBar() const { return false; }
 400     virtual bool isMenuButton() const { return false; }
 401     virtual bool isMenuItem() const { return false; }
<span class="line-modified"> 402     virtual bool isFileUploadButton() const { return false; }</span>
 403     virtual bool isInputImage() const { return false; }
 404     virtual bool isProgressIndicator() const { return false; }
 405     virtual bool isSlider() const { return false; }
 406     virtual bool isSliderThumb() const { return false; }
 407     virtual bool isInputSlider() const { return false; }
 408     virtual bool isControl() const { return false; }
 409     virtual bool isLabel() const { return false; }
 410     virtual bool isList() const { return false; }
 411     virtual bool isTable() const { return false; }
 412     virtual bool isDataTable() const { return false; }
 413     virtual bool isTableRow() const { return false; }
 414     virtual bool isTableColumn() const { return false; }
 415     virtual bool isTableCell() const { return false; }
 416     virtual bool isFieldset() const { return false; }
 417     virtual bool isGroup() const { return false; }
 418     virtual bool isARIATreeGridRow() const { return false; }
<span class="line-modified"> 419     virtual bool isImageMapLink() const { return false; }</span>
 420     virtual bool isMenuList() const { return false; }
 421     virtual bool isMenuListPopup() const { return false; }
 422     virtual bool isMenuListOption() const { return false; }
 423     virtual bool isSpinButton() const { return roleValue() == AccessibilityRole::SpinButton; }
 424     virtual bool isNativeSpinButton() const { return false; }
 425     virtual bool isSpinButtonPart() const { return false; }
 426     virtual bool isMockObject() const { return false; }
<span class="line-modified"> 427     virtual bool isMediaControlLabel() const { return false; }</span>
 428     virtual bool isMediaObject() const { return false; }
 429     bool isSwitch() const { return roleValue() == AccessibilityRole::Switch; }
 430     bool isToggleButton() const { return roleValue() == AccessibilityRole::ToggleButton; }
 431     bool isTextControl() const;
 432     bool isARIATextControl() const;
 433     bool isNonNativeTextControl() const;
 434     bool isTabList() const { return roleValue() == AccessibilityRole::TabList; }
 435     bool isTabItem() const { return roleValue() == AccessibilityRole::Tab; }
 436     bool isRadioGroup() const { return roleValue() == AccessibilityRole::RadioGroup; }
 437     bool isComboBox() const { return roleValue() == AccessibilityRole::ComboBox; }
<span class="line-modified"> 438     bool isTree() const { return roleValue() == AccessibilityRole::Tree; }</span>
 439     bool isTreeGrid() const { return roleValue() == AccessibilityRole::TreeGrid; }
<span class="line-modified"> 440     bool isTreeItem() const { return roleValue() == AccessibilityRole::TreeItem; }</span>
<span class="line-modified"> 441     bool isScrollbar() const { return roleValue() == AccessibilityRole::ScrollBar; }</span>
 442     bool isButton() const;
 443     bool isListItem() const { return roleValue() == AccessibilityRole::ListItem; }
 444     bool isCheckboxOrRadio() const { return isCheckbox() || isRadioButton(); }
 445     bool isScrollView() const { return roleValue() == AccessibilityRole::ScrollArea; }
 446     bool isCanvas() const { return roleValue() == AccessibilityRole::Canvas; }
 447     bool isPopUpButton() const { return roleValue() == AccessibilityRole::PopUpButton; }
 448     bool isBlockquote() const;
 449     bool isLandmark() const;
 450     bool isColorWell() const { return roleValue() == AccessibilityRole::ColorWell; }
 451     bool isRangeControl() const;
 452     bool isMeter() const;
 453     bool isSplitter() const { return roleValue() == AccessibilityRole::Splitter; }
 454     bool isToolbar() const { return roleValue() == AccessibilityRole::Toolbar; }
 455     bool isStyleFormatGroup() const;
<span class="line-removed"> 456     bool isSubscriptStyleGroup() const;</span>
<span class="line-removed"> 457     bool isSuperscriptStyleGroup() const;</span>
 458     bool isFigureElement() const;

 459     bool isSummary() const { return roleValue() == AccessibilityRole::Summary; }
 460     bool isOutput() const;
 461 
 462     virtual bool isChecked() const { return false; }
 463     virtual bool isEnabled() const { return false; }
 464     virtual bool isSelected() const { return false; }
 465     virtual bool isFocused() const { return false; }
 466     virtual bool isHovered() const { return false; }
 467     virtual bool isIndeterminate() const { return false; }
 468     virtual bool isLoaded() const { return false; }
 469     virtual bool isMultiSelectable() const { return false; }
 470     virtual bool isOffScreen() const { return false; }
 471     virtual bool isPressed() const { return false; }
 472     virtual bool isUnvisited() const { return false; }
 473     virtual bool isVisited() const { return false; }
 474     virtual bool isRequired() const { return false; }
 475     virtual bool supportsRequiredAttribute() const { return false; }
 476     virtual bool isLinked() const { return false; }
 477     virtual bool isExpanded() const;
 478     virtual bool isVisible() const { return true; }
 479     virtual bool isCollapsed() const { return false; }
 480     virtual void setIsExpanded(bool) { }


 481 
 482     // In a multi-select list, many items can be selected but only one is active at a time.
 483     virtual bool isSelectedOptionActive() const { return false; }
 484 
 485     virtual bool hasBoldFont() const { return false; }
 486     virtual bool hasItalicFont() const { return false; }
 487     bool hasMisspelling() const;
 488     virtual bool hasPlainText() const { return false; }
 489     virtual bool hasSameFont(RenderObject*) const { return false; }
 490     virtual bool hasSameFontColor(RenderObject*) const { return false; }
 491     virtual bool hasSameStyle(RenderObject*) const { return false; }
 492     bool isStaticText() const { return roleValue() == AccessibilityRole::StaticText; }
 493     virtual bool hasUnderline() const { return false; }
 494     bool hasHighlighting() const;
 495 
 496     bool supportsDatetimeAttribute() const;
<span class="line-modified"> 497     const AtomicString&amp; datetimeAttributeValue() const;</span>
 498 
 499     virtual bool canSetFocusAttribute() const { return false; }
 500     virtual bool canSetTextRangeAttributes() const { return false; }
 501     virtual bool canSetValueAttribute() const { return false; }
 502     virtual bool canSetNumericValue() const { return false; }
 503     virtual bool canSetSelectedAttribute() const { return false; }
 504     virtual bool canSetSelectedChildrenAttribute() const { return false; }
 505     virtual bool canSetExpandedAttribute() const { return false; }
 506 
 507     virtual Element* element() const;
 508     virtual Node* node() const { return nullptr; }
 509     virtual RenderObject* renderer() const { return nullptr; }
<span class="line-modified"> 510     virtual bool accessibilityIsIgnored() const;</span>
 511     virtual AccessibilityObjectInclusion defaultObjectInclusion() const;
 512     bool accessibilityIsIgnoredByDefault() const;
 513 
 514     bool isShowingValidationMessage() const;
 515     String validationMessage() const;
 516 
 517     unsigned blockquoteLevel() const;
 518     virtual int headingLevel() const { return 0; }
 519     virtual int tableLevel() const { return 0; }
 520     virtual AccessibilityButtonState checkboxOrRadioValue() const;
 521     virtual String valueDescription() const { return String(); }
 522     virtual float valueForRange() const { return 0.0f; }
 523     virtual float maxValueForRange() const { return 0.0f; }
 524     virtual float minValueForRange() const { return 0.0f; }
 525     virtual float stepValueForRange() const { return 0.0f; }
 526     virtual AccessibilityObject* selectedRadioButton() { return nullptr; }
 527     virtual AccessibilityObject* selectedTabItem() { return nullptr; }
 528     AccessibilityObject* selectedListItem();
 529     virtual int layoutCount() const { return 0; }
 530     virtual double estimatedLoadingProgress() const { return 0; }
<span class="line-modified"> 531     static bool isARIAControl(AccessibilityRole);</span>
<span class="line-modified"> 532     static bool isARIAInput(AccessibilityRole);</span>
 533 
 534     virtual bool supportsARIAOwns() const { return false; }
 535     bool isActiveDescendantOfFocusedContainer() const;
 536     void ariaActiveDescendantReferencingElements(AccessibilityChildrenVector&amp;) const;
 537     void ariaControlsElements(AccessibilityChildrenVector&amp;) const;
 538     void ariaControlsReferencingElements(AccessibilityChildrenVector&amp;) const;
 539     void ariaDescribedByElements(AccessibilityChildrenVector&amp;) const;
 540     void ariaDescribedByReferencingElements(AccessibilityChildrenVector&amp;) const;
 541     void ariaDetailsElements(AccessibilityChildrenVector&amp;) const;
 542     void ariaDetailsReferencingElements(AccessibilityChildrenVector&amp;) const;
 543     void ariaErrorMessageElements(AccessibilityChildrenVector&amp;) const;
 544     void ariaErrorMessageReferencingElements(AccessibilityChildrenVector&amp;) const;
 545     void ariaFlowToElements(AccessibilityChildrenVector&amp;) const;
 546     void ariaFlowToReferencingElements(AccessibilityChildrenVector&amp;) const;
 547     void ariaLabelledByElements(AccessibilityChildrenVector&amp;) const;
 548     void ariaLabelledByReferencingElements(AccessibilityChildrenVector&amp;) const;
 549     void ariaOwnsElements(AccessibilityChildrenVector&amp;) const;
 550     void ariaOwnsReferencingElements(AccessibilityChildrenVector&amp;) const;
 551 
 552     virtual bool hasPopup() const { return false; }
<span class="line-modified"> 553     String hasPopupValue() const;</span>

 554     bool supportsHasPopup() const;
 555     bool pressedIsPresent() const;
 556     bool ariaIsMultiline() const;
 557     String invalidStatus() const;
 558     bool supportsPressed() const;
 559     bool supportsExpanded() const;
 560     bool supportsChecked() const;
 561     AccessibilitySortDirection sortDirection() const;
 562     virtual bool canvasHasFallbackContent() const { return false; }
 563     bool supportsRangeValue() const;
<span class="line-modified"> 564     const AtomicString&amp; identifierAttribute() const;</span>
<span class="line-modified"> 565     const AtomicString&amp; linkRelValue() const;</span>
 566     void classList(Vector&lt;String&gt;&amp;) const;
 567     virtual String roleDescription() const;
 568     AccessibilityCurrentState currentState() const;
 569     String currentValue() const;
 570     bool supportsCurrent() const;
 571     const String keyShortcutsValue() const;
 572 
 573     // This function checks if the object should be ignored when there&#39;s a modal dialog displayed.
 574     bool ignoredFromModalPresence() const;
 575     bool isModalDescendant(Node*) const;
 576     bool isModalNode() const;
 577 
 578     bool supportsSetSize() const;
 579     bool supportsPosInSet() const;
 580     int setSize() const;
 581     int posInSet() const;
 582 
 583     // ARIA drag and drop
 584     virtual bool supportsARIADropping() const { return false; }
 585     virtual bool supportsARIADragging() const { return false; }
 586     virtual bool isARIAGrabbed() { return false; }
 587     virtual void setARIAGrabbed(bool) { }
 588     virtual Vector&lt;String&gt; determineARIADropEffects() { return { }; }
 589 
 590     // Called on the root AX object to return the deepest available element.
<span class="line-modified"> 591     virtual AccessibilityObject* accessibilityHitTest(const IntPoint&amp;) const { return nullptr; }</span>
 592     // Called on the AX object after the render tree determines which is the right AccessibilityRenderObject.
<span class="line-modified"> 593     virtual AccessibilityObject* elementAccessibilityHitTest(const IntPoint&amp;) const;</span>
 594 
<span class="line-modified"> 595     virtual AccessibilityObject* focusedUIElement() const;</span>
 596 
 597     virtual AccessibilityObject* firstChild() const { return nullptr; }
 598     virtual AccessibilityObject* lastChild() const { return nullptr; }
 599     virtual AccessibilityObject* previousSibling() const { return nullptr; }
 600     virtual AccessibilityObject* nextSibling() const { return nullptr; }
 601     virtual AccessibilityObject* nextSiblingUnignored(int limit) const;
 602     virtual AccessibilityObject* previousSiblingUnignored(int limit) const;
<span class="line-modified"> 603     virtual AccessibilityObject* parentObject() const = 0;</span>
 604     virtual AccessibilityObject* parentObjectUnignored() const;

 605     virtual AccessibilityObject* parentObjectIfExists() const { return nullptr; }
 606     static AccessibilityObject* firstAccessibleObjectFromNode(const Node*);
 607     void findMatchingObjects(AccessibilitySearchCriteria*, AccessibilityChildrenVector&amp;);
 608     virtual bool isDescendantOfBarrenParent() const { return false; }
 609 
 610     bool isDescendantOfRole(AccessibilityRole) const;
 611 
 612     // Text selection
<span class="line-modified"> 613     RefPtr&lt;Range&gt; rangeOfStringClosestToRangeInDirection(Range*, AccessibilitySearchDirection, Vector&lt;String&gt;&amp;) const;</span>

 614     RefPtr&lt;Range&gt; selectionRange() const;
<span class="line-modified"> 615     String selectText(AccessibilitySelectTextCriteria*);</span>



 616 
 617     virtual AccessibilityObject* observableObject() const { return nullptr; }
 618     virtual void linkedUIElements(AccessibilityChildrenVector&amp;) const { }
 619     virtual AccessibilityObject* titleUIElement() const { return nullptr; }
 620     virtual bool exposesTitleUIElement() const { return true; }
 621     virtual AccessibilityObject* correspondingLabelForControlElement() const { return nullptr; }
 622     virtual AccessibilityObject* correspondingControlForLabelElement() const { return nullptr; }
 623     virtual AccessibilityObject* scrollBar(AccessibilityOrientation) { return nullptr; }
 624 
 625     virtual AccessibilityRole ariaRoleAttribute() const { return AccessibilityRole::Unknown; }
 626     virtual bool isPresentationalChildOfAriaRole() const { return false; }
 627     virtual bool ariaRoleHasPresentationalChildren() const { return false; }
 628     virtual bool inheritsPresentationalRole() const { return false; }
 629 
 630     // Accessibility Text
<span class="line-modified"> 631     virtual void accessibilityText(Vector&lt;AccessibilityText&gt;&amp;) { };</span>
 632     // A single method for getting a computed label for an AXObject. It condenses the nuances of accessibilityText. Used by Inspector.
 633     String computedLabel();
 634 
 635     // A programmatic way to set a name on an AccessibleObject.
<span class="line-modified"> 636     virtual void setAccessibleName(const AtomicString&amp;) { }</span>
 637     virtual bool hasAttributesRequiredForInclusion() const;
 638 
 639     // Accessibility Text - (To be deprecated).
 640     virtual String accessibilityDescription() const { return String(); }
 641     virtual String title() const { return String(); }
 642     virtual String helpText() const { return String(); }
 643 
 644     // Methods for determining accessibility text.
 645     bool isARIAStaticText() const { return ariaRoleAttribute() == AccessibilityRole::StaticText; }
 646     virtual String stringValue() const { return String(); }
 647     virtual String textUnderElement(AccessibilityTextUnderElementMode = AccessibilityTextUnderElementMode()) const { return String(); }
 648     virtual String text() const { return String(); }
 649     virtual int textLength() const { return 0; }
 650     virtual String ariaLabeledByAttribute() const { return String(); }
 651     virtual String ariaDescribedByAttribute() const { return String(); }
 652     const String placeholderValue() const;
 653     bool accessibleNameDerivesFromContent() const;
 654 
 655     // Abbreviations
 656     virtual String expandedTextValue() const { return String(); }
 657     virtual bool supportsExpandedTextValue() const { return false; }
 658 
 659     void elementsFromAttribute(Vector&lt;Element*&gt;&amp;, const QualifiedName&amp;) const;
 660 
 661     // Only if isColorWell()
 662     virtual void colorValue(int&amp; r, int&amp; g, int&amp; b) const { r = 0; g = 0; b = 0; }
 663 
<span class="line-modified"> 664     virtual AccessibilityRole roleValue() const { return m_role; }</span>
 665 
 666     virtual AXObjectCache* axObjectCache() const;
 667     AXID axObjectID() const { return m_id; }
 668 
 669     static AccessibilityObject* anchorElementForNode(Node*);
 670     static AccessibilityObject* headingElementForNode(Node*);
 671     virtual Element* anchorElement() const { return nullptr; }
 672     bool supportsPressAction() const;
 673     virtual Element* actionElement() const { return nullptr; }
 674     virtual LayoutRect boundingBoxRect() const { return LayoutRect(); }
 675     IntRect pixelSnappedBoundingBoxRect() const { return snappedIntRect(boundingBoxRect()); }
 676     virtual LayoutRect elementRect() const = 0;
 677     LayoutSize size() const { return elementRect().size(); }
 678     virtual IntPoint clickPoint();
 679     static IntRect boundingBoxForQuads(RenderObject*, const Vector&lt;FloatQuad&gt;&amp;);
 680     virtual Path elementPath() const { return Path(); }
 681     virtual bool supportsPath() const { return false; }
 682 
 683     TextIteratorBehavior textIteratorBehaviorForTextRange() const;
 684     virtual PlainTextRange selectedTextRange() const { return PlainTextRange(); }
 685     unsigned selectionStart() const { return selectedTextRange().start; }
 686     unsigned selectionEnd() const { return selectedTextRange().length; }
 687 
 688     virtual URL url() const { return URL(); }
 689     virtual VisibleSelection selection() const { return VisibleSelection(); }
 690     virtual String selectedText() const { return String(); }
<span class="line-modified"> 691     virtual const AtomicString&amp; accessKey() const { return nullAtom(); }</span>
 692     const String&amp; actionVerb() const;
 693     virtual Widget* widget() const { return nullptr; }
 694     virtual Widget* widgetForAttachmentView() const { return nullptr; }
 695     Page* page() const;
 696     virtual Document* document() const;
 697     virtual FrameView* documentFrameView() const;
 698     Frame* frame() const;
 699     Frame* mainFrame() const;
 700     Document* topDocument() const;
 701     ScrollView* scrollViewAncestor() const;
 702     String language() const;
 703     // 1-based, to match the aria-level spec.
 704     virtual unsigned hierarchicalLevel() const { return 0; }
 705 
 706     virtual void setFocused(bool) { }
 707     virtual void setSelectedText(const String&amp;) { }
 708     virtual void setSelectedTextRange(const PlainTextRange&amp;) { }
 709     virtual void setValue(const String&amp;) { }



 710     virtual void setValue(float) { }
 711     virtual void setSelected(bool) { }
 712     virtual void setSelectedRows(AccessibilityChildrenVector&amp;) { }
 713 
 714     virtual void makeRangeVisible(const PlainTextRange&amp;) { }
 715     virtual bool press();
 716     bool performDefaultAction() { return press(); }
 717 
 718     virtual AccessibilityOrientation orientation() const;
 719     virtual void increment() { }
 720     virtual void decrement() { }
 721 
 722     virtual void childrenChanged() { }
 723     virtual void textChanged() { }
 724     virtual void updateAccessibilityRole() { }
 725     const AccessibilityChildrenVector&amp; children(bool updateChildrenIfNeeded = true);
 726     virtual void addChildren() { }
 727     virtual void addChild(AccessibilityObject*);
 728     virtual void insertChild(AccessibilityObject*, unsigned);
 729 
 730     virtual bool shouldIgnoreAttributeRole() const { return false; }
 731 
 732     virtual bool canHaveChildren() const { return true; }
 733     virtual bool hasChildren() const { return m_haveChildren; }
<span class="line-modified"> 734     virtual void updateChildrenIfNecessary();</span>
 735     virtual void setNeedsToUpdateChildren() { }
 736     virtual void setNeedsToUpdateSubtree() { }
 737     virtual void clearChildren();
 738     virtual bool needsToUpdateChildren() const { return false; }
 739 #if PLATFORM(COCOA)
 740     virtual void detachFromParent();
 741 #else
 742     virtual void detachFromParent() { }
 743 #endif
 744     virtual bool isDetachedFromParent() { return false; }
 745 
 746     virtual bool canHaveSelectedChildren() const { return false; }
 747     virtual void selectedChildren(AccessibilityChildrenVector&amp;) { }
 748     virtual void visibleChildren(AccessibilityChildrenVector&amp;) { }
 749     virtual void tabChildren(AccessibilityChildrenVector&amp;) { }
 750     virtual bool shouldFocusActiveDescendant() const { return false; }
 751     virtual AccessibilityObject* activeDescendant() const { return nullptr; }
 752     virtual void handleActiveDescendantChanged() { }
 753     virtual void handleAriaExpandedChanged() { }
 754     bool isDescendantOfObject(const AccessibilityObject*) const;
 755     bool isAncestorOfObject(const AccessibilityObject*) const;
 756     AccessibilityObject* firstAnonymousBlockChild() const;
 757 
<span class="line-modified"> 758     static AccessibilityRole ariaRoleToWebCoreRole(const String&amp;);</span>
 759     bool hasAttribute(const QualifiedName&amp;) const;
<span class="line-modified"> 760     const AtomicString&amp; getAttribute(const QualifiedName&amp;) const;</span>
 761     bool hasTagName(const QualifiedName&amp;) const;
 762 
<span class="line-removed"> 763     bool shouldDispatchAccessibilityEvent() const;</span>
<span class="line-removed"> 764     bool dispatchAccessibilityEvent(Event&amp;) const;</span>
<span class="line-removed"> 765     bool dispatchAccessibilityEventWithType(AccessibilityEventType) const;</span>
<span class="line-removed"> 766     bool dispatchAccessibleSetValueEvent(const String&amp;) const;</span>
<span class="line-removed"> 767 </span>
 768     virtual VisiblePositionRange visiblePositionRange() const { return VisiblePositionRange(); }
 769     virtual VisiblePositionRange visiblePositionRangeForLine(unsigned) const { return VisiblePositionRange(); }
 770 
 771     RefPtr&lt;Range&gt; elementRange() const;
 772     static bool replacedNodeNeedsCharacter(Node* replacedNode);
 773 
 774     VisiblePositionRange visiblePositionRangeForUnorderedPositions(const VisiblePosition&amp;, const VisiblePosition&amp;) const;
 775     VisiblePositionRange positionOfLeftWord(const VisiblePosition&amp;) const;
 776     VisiblePositionRange positionOfRightWord(const VisiblePosition&amp;) const;
 777     VisiblePositionRange leftLineVisiblePositionRange(const VisiblePosition&amp;) const;
 778     VisiblePositionRange rightLineVisiblePositionRange(const VisiblePosition&amp;) const;
 779     VisiblePositionRange sentenceForPosition(const VisiblePosition&amp;) const;
 780     VisiblePositionRange paragraphForPosition(const VisiblePosition&amp;) const;
 781     VisiblePositionRange styleRangeForPosition(const VisiblePosition&amp;) const;
 782     VisiblePositionRange visiblePositionRangeForRange(const PlainTextRange&amp;) const;
 783     VisiblePositionRange lineRangeForPosition(const VisiblePosition&amp;) const;
 784 
 785     RefPtr&lt;Range&gt; rangeForPlainTextRange(const PlainTextRange&amp;) const;
 786 
 787     static String stringForVisiblePositionRange(const VisiblePositionRange&amp;);
</pre>
<hr />
<pre>
 838     bool isValueAutofilled() const;
 839     bool isValueAutofillAvailable() const;
 840     AutoFillButtonType valueAutofillButtonType() const;
 841 
 842     // Used by an ARIA tree to get all its rows.
 843     void ariaTreeRows(AccessibilityChildrenVector&amp;);
 844     // Used by an ARIA tree item to get all of its direct rows that it can disclose.
 845     void ariaTreeItemDisclosedRows(AccessibilityChildrenVector&amp;);
 846     // Used by an ARIA tree item to get only its content, and not its child tree items and groups.
 847     void ariaTreeItemContent(AccessibilityChildrenVector&amp;);
 848 
 849     // ARIA live-region features.
 850     bool supportsLiveRegion(bool excludeIfOff = true) const;
 851     bool isInsideLiveRegion(bool excludeIfOff = true) const;
 852     AccessibilityObject* liveRegionAncestor(bool excludeIfOff = true) const;
 853     virtual const String liveRegionStatus() const { return String(); }
 854     virtual const String liveRegionRelevant() const { return nullAtom(); }
 855     virtual bool liveRegionAtomic() const { return false; }
 856     virtual bool isBusy() const { return false; }
 857     static const String defaultLiveRegionStatusForRole(AccessibilityRole);
<span class="line-modified"> 858     static bool liveRegionStatusIsEnabled(const AtomicString&amp;);</span>
 859     static bool contentEditableAttributeIsEnabled(Element*);
 860     bool hasContentEditableAttributeSet() const;
 861 
 862     bool supportsReadOnly() const;
 863     virtual String readOnlyValue() const;
 864 
 865     bool supportsAutoComplete() const;
 866     String autoCompleteValue() const;
 867 
 868     bool supportsARIAAttributes() const;
 869 
 870     // CSS3 Speech properties.
 871     virtual OptionSet&lt;SpeakAs&gt; speakAsProperty() const { return OptionSet&lt;SpeakAs&gt; { }; }
 872 
 873     // Make this object visible by scrolling as many nested scrollable views as needed.
 874     virtual void scrollToMakeVisible() const;
 875     // Same, but if the whole object can&#39;t be made visible, try for this subrect, in local coordinates.
 876     virtual void scrollToMakeVisibleWithSubFocus(const IntRect&amp;) const;
 877     // Scroll this object to a given point in global coordinates of the top-level window.
 878     virtual void scrollToGlobalPoint(const IntPoint&amp;) const;
 879 
 880     enum class ScrollByPageDirection { Up, Down, Left, Right };
 881     bool scrollByPage(ScrollByPageDirection) const;
 882     IntPoint scrollPosition() const;
 883     IntSize scrollContentsSize() const;
 884     IntRect scrollVisibleContentRect() const;

 885 
 886     bool lastKnownIsIgnoredValue();
 887     void setLastKnownIsIgnoredValue(bool);
 888 
 889     // Fires a children changed notification on the parent if the isIgnored value changed.
 890     void notifyIfIgnoredValueChanged();
 891 
 892     // All math elements return true for isMathElement().
 893     virtual bool isMathElement() const { return false; }
 894     virtual bool isMathFraction() const { return false; }
 895     virtual bool isMathFenced() const { return false; }
 896     virtual bool isMathSubscriptSuperscript() const { return false; }
 897     virtual bool isMathRow() const { return false; }
 898     virtual bool isMathUnderOver() const { return false; }
 899     virtual bool isMathRoot() const { return false; }
 900     virtual bool isMathSquareRoot() const { return false; }
 901     virtual bool isMathText() const { return false; }
 902     virtual bool isMathNumber() const { return false; }
 903     virtual bool isMathOperator() const { return false; }
 904     virtual bool isMathFenceOperator() const { return false; }
</pre>
<hr />
<pre>
 928     virtual AccessibilityObject* mathBaseObject() { return nullptr; }
 929     virtual AccessibilityObject* mathSubscriptObject() { return nullptr; }
 930     virtual AccessibilityObject* mathSuperscriptObject() { return nullptr; }
 931 
 932     // Fenced components.
 933     virtual String mathFencedOpenString() const { return String(); }
 934     virtual String mathFencedCloseString() const { return String(); }
 935     virtual int mathLineThickness() const { return 0; }
 936     virtual bool isAnonymousMathOperator() const { return false; }
 937 
 938     // Multiscripts components.
 939     typedef Vector&lt;std::pair&lt;AccessibilityObject*, AccessibilityObject*&gt;&gt; AccessibilityMathMultiscriptPairs;
 940     virtual void mathPrescripts(AccessibilityMathMultiscriptPairs&amp;) { }
 941     virtual void mathPostscripts(AccessibilityMathMultiscriptPairs&amp;) { }
 942 
 943     // Visibility.
 944     bool isAXHidden() const;
 945     bool isDOMHidden() const;
 946     bool isHidden() const { return isAXHidden() || isDOMHidden(); }
 947 
<span class="line-modified"> 948 #if HAVE(ACCESSIBILITY)</span>
<span class="line-modified"> 949     AccessibilityObjectWrapper* wrapper() const { return m_wrapper.get(); }</span>
 950     void setWrapper(AccessibilityObjectWrapper* wrapper) { m_wrapper = wrapper; }


 951 #endif
 952 
 953 #if PLATFORM(COCOA)
 954     void overrideAttachmentParent(AccessibilityObject* parent);
 955 #else
 956     void overrideAttachmentParent(AccessibilityObject*) { }
 957 #endif
 958 
<span class="line-modified"> 959 #if HAVE(ACCESSIBILITY)</span>
 960     // a platform-specific method for determining if an attachment is ignored
 961     bool accessibilityIgnoreAttachment() const;
 962     // gives platforms the opportunity to indicate if and how an object should be included
 963     AccessibilityObjectInclusion accessibilityPlatformIncludesObject() const;
 964 #else
 965     bool accessibilityIgnoreAttachment() const { return true; }
 966     AccessibilityObjectInclusion accessibilityPlatformIncludesObject() const { return AccessibilityObjectInclusion::DefaultBehavior; }
 967 #endif
 968 
 969 #if PLATFORM(IOS_FAMILY)
 970     int accessibilityPasswordFieldLength();
 971     bool hasTouchEventListener() const;
 972     bool isInputTypePopupButton() const;
<span class="line-removed"> 973     bool hasAccessibleDismissEventListener() const;</span>
 974 #endif
 975 
 976     // allows for an AccessibilityObject to update its render tree or perform
 977     // other operations update type operations
 978     void updateBackingStore();
 979 
 980 #if PLATFORM(COCOA)
 981     bool preventKeyboardDOMEventDispatch() const;
 982     void setPreventKeyboardDOMEventDispatch(bool);





 983 #endif
 984 
 985 #if PLATFORM(COCOA) &amp;&amp; !PLATFORM(IOS_FAMILY)
 986     bool caretBrowsingEnabled() const;
 987     void setCaretBrowsingEnabled(bool);
 988 #endif
 989 
 990     AccessibilityObject* focusableAncestor();
 991     AccessibilityObject* editableAncestor();
 992     AccessibilityObject* highestEditableAncestor();
 993 

 994     static const AccessibilityObject* matchedParent(const AccessibilityObject&amp;, bool includeSelf, const WTF::Function&lt;bool(const AccessibilityObject&amp;)&gt;&amp;);
 995 
 996     void clearIsIgnoredFromParentData() { m_isIgnoredFromParentData = AccessibilityIsIgnoredFromParentData(); }
 997     void setIsIgnoredFromParentDataForChild(AccessibilityObject*);
 998 
 999 protected:
1000     AXID m_id { 0 };
1001     AccessibilityChildrenVector m_children;
1002     mutable bool m_haveChildren { false };
1003     AccessibilityRole m_role { AccessibilityRole::Unknown };
1004     AccessibilityObjectInclusion m_lastKnownIsIgnoredValue { AccessibilityObjectInclusion::DefaultBehavior };
1005     AccessibilityIsIgnoredFromParentData m_isIgnoredFromParentData { };
1006     bool m_childrenDirty { false };
1007     bool m_subtreeDirty { false };
1008 #if ENABLE(ACCESSIBILITY_ISOLATED_TREE)
1009     bool m_isolatedTreeNodeInitialized { false };
1010 #endif
1011 
1012     void setIsIgnoredFromParentData(AccessibilityIsIgnoredFromParentData&amp; data) { m_isIgnoredFromParentData = data; }
1013 
1014     virtual bool computeAccessibilityIsIgnored() const { return true; }

1015 
1016     // If this object itself scrolls, return its ScrollableArea.
1017     virtual ScrollableArea* getScrollableAreaIfScrollable() const { return nullptr; }
1018     virtual void scrollTo(const IntPoint&amp;) const { }
1019     ScrollableArea* scrollableAreaAncestor() const;
1020     void scrollAreaAndAncestor(std::pair&lt;ScrollableArea*, AccessibilityObject*&gt;&amp;) const;
1021 
1022     static bool isAccessibilityObjectSearchMatchAtIndex(AccessibilityObject*, AccessibilitySearchCriteria*, size_t);
1023     static bool isAccessibilityObjectSearchMatch(AccessibilityObject*, AccessibilitySearchCriteria*);
1024     static bool isAccessibilityTextSearchMatch(AccessibilityObject*, AccessibilitySearchCriteria*);
1025     static bool objectMatchesSearchCriteriaWithResultLimit(AccessibilityObject*, AccessibilitySearchCriteria*, AccessibilityChildrenVector&amp;);
1026     virtual AccessibilityRole buttonRoleType() const;
1027     bool isOnscreen() const;
1028     bool dispatchTouchEvent();
1029 
1030     void ariaElementsFromAttribute(AccessibilityChildrenVector&amp;, const QualifiedName&amp;) const;
1031     void ariaElementsReferencedByAttribute(AccessibilityChildrenVector&amp;, const QualifiedName&amp;) const;
1032 
1033     AccessibilityObject* radioGroupAncestor() const;
1034 
<span class="line-modified">1035 #if PLATFORM(GTK) &amp;&amp; HAVE(ACCESSIBILITY)</span>
1036     bool allowsTextRanges() const;
1037     unsigned getLengthForTextRange() const;
1038 #else
1039     bool allowsTextRanges() const { return isTextControl(); }
1040     unsigned getLengthForTextRange() const { return text().length(); }
1041 #endif
1042 
1043 #if PLATFORM(COCOA)
1044     RetainPtr&lt;WebAccessibilityObjectWrapper&gt; m_wrapper;
1045 #elif PLATFORM(WIN)
1046     COMPtr&lt;AccessibilityObjectWrapper&gt; m_wrapper;
<span class="line-modified">1047 #elif PLATFORM(GTK)</span>
1048     GRefPtr&lt;WebKitAccessible&gt; m_wrapper;
<span class="line-removed">1049 #elif PLATFORM(WPE)</span>
<span class="line-removed">1050     RefPtr&lt;AccessibilityObjectWrapper&gt; m_wrapper;</span>
1051 #endif
1052 };
1053 
<span class="line-modified">1054 #if !HAVE(ACCESSIBILITY)</span>
1055 inline const AccessibilityObject::AccessibilityChildrenVector&amp; AccessibilityObject::children(bool) { return m_children; }
1056 inline const String&amp; AccessibilityObject::actionVerb() const { return emptyString(); }
1057 inline int AccessibilityObject::lineForPosition(const VisiblePosition&amp;) const { return -1; }
1058 inline void AccessibilityObject::updateBackingStore() { }
1059 #endif
1060 


1061 } // namespace WebCore
1062 
1063 #define SPECIALIZE_TYPE_TRAITS_ACCESSIBILITY(ToValueTypeName, predicate) \
1064 SPECIALIZE_TYPE_TRAITS_BEGIN(WebCore::ToValueTypeName) \
1065     static bool isType(const WebCore::AccessibilityObject&amp; object) { return object.predicate; } \
1066 SPECIALIZE_TYPE_TRAITS_END()




</pre>
</td>
<td>
<hr />
<pre>
  28  */
  29 
  30 #pragma once
  31 
  32 #include &quot;AccessibilityObjectInterface.h&quot;
  33 #include &quot;FloatQuad.h&quot;
  34 #include &quot;HTMLTextFormControlElement.h&quot;
  35 #include &quot;LayoutRect.h&quot;
  36 #include &quot;Path.h&quot;
  37 #include &quot;Range.h&quot;
  38 #include &quot;TextIteratorBehavior.h&quot;
  39 #include &quot;VisiblePosition.h&quot;
  40 #include &quot;VisibleSelection.h&quot;
  41 #include &lt;wtf/Forward.h&gt;
  42 #include &lt;wtf/Function.h&gt;
  43 #include &lt;wtf/RefPtr.h&gt;
  44 #include &lt;wtf/Vector.h&gt;
  45 
  46 #if PLATFORM(COCOA)
  47 #include &lt;wtf/RetainPtr.h&gt;



  48 #endif
  49 
<span class="line-modified">  50 #if USE(ATK)</span>
  51 #include &lt;wtf/glib/GRefPtr.h&gt;
  52 #endif
  53 
  54 #if PLATFORM(COCOA)
  55 
  56 typedef struct _NSRange NSRange;
  57 
  58 OBJC_CLASS NSArray;
  59 OBJC_CLASS NSAttributedString;
  60 OBJC_CLASS NSData;
  61 OBJC_CLASS NSMutableAttributedString;
  62 OBJC_CLASS NSString;
  63 OBJC_CLASS NSValue;
  64 OBJC_CLASS NSView;



  65 







  66 #endif
  67 
  68 namespace WebCore {
  69 
  70 class AccessibilityObject;
<span class="line-added">  71 class AccessibilityScrollView;</span>
  72 class AXObjectCache;
  73 class Element;
  74 class Frame;
  75 class FrameView;
  76 class IntPoint;
  77 class IntSize;
  78 class Node;
  79 class Page;
  80 class RenderObject;
  81 class ScrollableArea;
  82 class ScrollView;
  83 class Widget;
<span class="line-added">  84 struct ScrollRectToVisibleOptions;</span>
  85 
  86 enum class AccessibilityTextSource {
  87     Alternative,
  88     Children,
  89     Summary,
  90     Help,
  91     Visible,
  92     TitleTag,
  93     Placeholder,
  94     LabelByElement,
  95     Title,
  96     Subtitle,
  97     Action,
  98 };
  99 











 100 struct AccessibilityText {
 101     String text;
 102     AccessibilityTextSource textSource;
 103     Vector&lt;RefPtr&lt;AccessibilityObject&gt;&gt; textElements;
 104 
 105     AccessibilityText(const String&amp; t, const AccessibilityTextSource&amp; s)
 106         : text(t)
 107         , textSource(s)
 108     { }
 109 
 110     AccessibilityText(const String&amp; t, const AccessibilityTextSource&amp; s, Vector&lt;RefPtr&lt;AccessibilityObject&gt;&gt; elements)
 111         : text(t)
 112         , textSource(s)
 113         , textElements(WTFMove(elements))
 114     { }
 115 
 116     AccessibilityText(const String&amp; t, const AccessibilityTextSource&amp; s, RefPtr&lt;AccessibilityObject&gt;&amp;&amp; element)
 117         : text(t)
 118         , textSource(s)
 119     {
</pre>
<hr />
<pre>
 192     Blockquote,
 193     BoldFont,
 194     Button,
 195     CheckBox,
 196     Control,
 197     DifferentType,
 198     FontChange,
 199     FontColorChange,
 200     Frame,
 201     Graphic,
 202     HeadingLevel1,
 203     HeadingLevel2,
 204     HeadingLevel3,
 205     HeadingLevel4,
 206     HeadingLevel5,
 207     HeadingLevel6,
 208     HeadingSameLevel,
 209     Heading,
 210     Highlighted,
 211     ItalicFont,
<span class="line-added"> 212     KeyboardFocusable,</span>
 213     Landmark,
 214     Link,
 215     List,
 216     LiveRegion,
 217     MisspelledWord,
 218     Outline,
 219     PlainText,
 220     RadioGroup,
 221     SameType,
 222     StaticText,
 223     StyleChange,
 224     TableSameLevel,
 225     Table,
 226     TextField,
 227     Underline,
 228     UnvisitedLink,
 229     VisitedLink,
 230 };
 231 
 232 enum class AccessibilityVisiblePositionForBounds {
</pre>
<hr />
<pre>
 270     VisiblePositionRange(const VisibleSelection&amp; selection)
 271         : start(selection.start())
 272         , end(selection.end())
 273     { }
 274 
 275     bool isNull() const { return start.isNull() || end.isNull(); }
 276 };
 277 
 278 struct PlainTextRange {
 279 
 280     unsigned start { 0 };
 281     unsigned length { 0 };
 282 
 283     PlainTextRange() = default;
 284 
 285     PlainTextRange(unsigned s, unsigned l)
 286         : start(s)
 287         , length(l)
 288     { }
 289 
<span class="line-added"> 290 #if PLATFORM(COCOA)</span>
<span class="line-added"> 291     PlainTextRange(NSRange);</span>
<span class="line-added"> 292 #endif</span>
<span class="line-added"> 293 </span>
 294     bool isNull() const { return !start &amp;&amp; !length; }
 295 };
 296 
<span class="line-modified"> 297 enum class AccessibilitySearchTextStartFrom {</span>
<span class="line-modified"> 298     Begin, // Search from the beginning of the element.</span>
<span class="line-modified"> 299     Selection, // Search from the position of the current selection.</span>
<span class="line-modified"> 300     End // Search from the end of the element.</span>


 301 };
 302 
<span class="line-modified"> 303 enum class AccessibilitySearchTextDirection {</span>
<span class="line-modified"> 304     Forward, // Occurrence after the starting range.</span>
<span class="line-modified"> 305     Backward, // Occurrence before the starting range.</span>
<span class="line-modified"> 306     Closest, // Closest occurrence to the starting range, whether after or before.</span>
<span class="line-added"> 307     All // All occurrences</span>
 308 };
 309 
<span class="line-modified"> 310 struct AccessibilitySearchTextCriteria {</span>
<span class="line-modified"> 311     Vector&lt;String&gt; searchStrings; // Text strings to search for.</span>
<span class="line-modified"> 312     AccessibilitySearchTextStartFrom start;</span>
<span class="line-modified"> 313     AccessibilitySearchTextDirection direction;</span>

 314 
<span class="line-modified"> 315     AccessibilitySearchTextCriteria()</span>
<span class="line-modified"> 316         : start(AccessibilitySearchTextStartFrom::Selection)</span>
<span class="line-modified"> 317         , direction(AccessibilitySearchTextDirection::Forward)</span>
<span class="line-modified"> 318     { }</span>
<span class="line-added"> 319 };</span>
<span class="line-added"> 320 </span>
<span class="line-added"> 321 enum class AccessibilityTextOperationType {</span>
<span class="line-added"> 322     Select,</span>
<span class="line-added"> 323     Replace,</span>
<span class="line-added"> 324     Capitalize,</span>
<span class="line-added"> 325     Lowercase,</span>
<span class="line-added"> 326     Uppercase</span>
<span class="line-added"> 327 };</span>
<span class="line-added"> 328 </span>
<span class="line-added"> 329 struct AccessibilityTextOperation {</span>
<span class="line-added"> 330     Vector&lt;RefPtr&lt;Range&gt;&gt; textRanges; // text on which perform the operation.</span>
<span class="line-added"> 331     AccessibilityTextOperationType type;</span>
<span class="line-added"> 332     String replacementText; // For type = replace.</span>
<span class="line-added"> 333 </span>
<span class="line-added"> 334     AccessibilityTextOperation()</span>
<span class="line-added"> 335         : type(AccessibilityTextOperationType::Select)</span>
 336     { }
 337 };
 338 
 339 enum class AccessibilityMathScriptObjectType { Subscript, Superscript };
 340 enum class AccessibilityMathMultiscriptObjectType { PreSubscript, PreSuperscript, PostSubscript, PostSuperscript };
 341 
 342 enum class AccessibilityCurrentState { False, True, Page, Step, Location, Date, Time };
<span class="line-added"> 343 enum class AccessibilityConversionSpace { Screen, Page };</span>
 344 
 345 bool nodeHasPresentationRole(Node*);
 346 
 347 class AccessibilityObject : public RefCounted&lt;AccessibilityObject&gt;, public AccessibilityObjectInterface {
 348 protected:
 349     AccessibilityObject() = default;
 350 
 351 public:
 352     virtual ~AccessibilityObject();
 353 
 354     // After constructing an AccessibilityObject, it must be given a
 355     // unique ID, then added to AXObjectCache, and finally init() must
 356     // be called last.
 357     void setAXObjectID(AXID axObjectID) { m_id = axObjectID; }
 358     virtual void init() { }
 359 
 360     // When the corresponding WebCore object that this AccessibilityObject
 361     // wraps is deleted, it must be detached.
 362     virtual void detach(AccessibilityDetachmentType, AXObjectCache* cache = nullptr);
 363     virtual bool isDetached() const;
 364 
 365     typedef Vector&lt;RefPtr&lt;AccessibilityObject&gt;&gt; AccessibilityChildrenVector;
 366 
 367     virtual bool isAccessibilityNodeObject() const { return false; }
 368     virtual bool isAccessibilityRenderObject() const { return false; }
 369     virtual bool isAccessibilityScrollbar() const { return false; }
 370     virtual bool isAccessibilityScrollView() const { return false; }
 371     virtual bool isAccessibilitySVGRoot() const { return false; }
 372     virtual bool isAccessibilitySVGElement() const { return false; }
 373 
 374     bool accessibilityObjectContainsText(String *) const;
 375 
 376     virtual bool isAttachmentElement() const { return false; }
 377     virtual bool isHeading() const { return false; }
<span class="line-modified"> 378     bool isLink() const override { return false; }</span>
<span class="line-modified"> 379     bool isImage() const override { return false; }</span>
 380     virtual bool isImageMap() const { return roleValue() == AccessibilityRole::ImageMap; }
 381     virtual bool isNativeImage() const { return false; }
 382     virtual bool isImageButton() const { return false; }
 383     virtual bool isPasswordField() const { return false; }
 384     bool isContainedByPasswordField() const;
 385     virtual AccessibilityObject* passwordFieldOrContainingPasswordField() { return nullptr; }
 386     virtual bool isNativeTextControl() const { return false; }
 387     virtual bool isSearchField() const { return false; }
 388     bool isWebArea() const { return roleValue() == AccessibilityRole::WebArea; }
 389     virtual bool isCheckbox() const { return roleValue() == AccessibilityRole::CheckBox; }
 390     virtual bool isRadioButton() const { return roleValue() == AccessibilityRole::RadioButton; }
 391     virtual bool isNativeListBox() const { return false; }
 392     bool isListBox() const { return roleValue() == AccessibilityRole::ListBox; }
 393     virtual bool isListBoxOption() const { return false; }
<span class="line-modified"> 394     bool isAttachment() const override { return false; }</span>
 395     virtual bool isMediaTimeline() const { return false; }
 396     virtual bool isMenuRelated() const { return false; }
 397     virtual bool isMenu() const { return false; }
 398     virtual bool isMenuBar() const { return false; }
 399     virtual bool isMenuButton() const { return false; }
 400     virtual bool isMenuItem() const { return false; }
<span class="line-modified"> 401     bool isFileUploadButton() const override { return false; }</span>
 402     virtual bool isInputImage() const { return false; }
 403     virtual bool isProgressIndicator() const { return false; }
 404     virtual bool isSlider() const { return false; }
 405     virtual bool isSliderThumb() const { return false; }
 406     virtual bool isInputSlider() const { return false; }
 407     virtual bool isControl() const { return false; }
 408     virtual bool isLabel() const { return false; }
 409     virtual bool isList() const { return false; }
 410     virtual bool isTable() const { return false; }
 411     virtual bool isDataTable() const { return false; }
 412     virtual bool isTableRow() const { return false; }
 413     virtual bool isTableColumn() const { return false; }
 414     virtual bool isTableCell() const { return false; }
 415     virtual bool isFieldset() const { return false; }
 416     virtual bool isGroup() const { return false; }
 417     virtual bool isARIATreeGridRow() const { return false; }
<span class="line-modified"> 418     bool isImageMapLink() const override { return false; }</span>
 419     virtual bool isMenuList() const { return false; }
 420     virtual bool isMenuListPopup() const { return false; }
 421     virtual bool isMenuListOption() const { return false; }
 422     virtual bool isSpinButton() const { return roleValue() == AccessibilityRole::SpinButton; }
 423     virtual bool isNativeSpinButton() const { return false; }
 424     virtual bool isSpinButtonPart() const { return false; }
 425     virtual bool isMockObject() const { return false; }
<span class="line-modified"> 426     bool isMediaControlLabel() const override { return false; }</span>
 427     virtual bool isMediaObject() const { return false; }
 428     bool isSwitch() const { return roleValue() == AccessibilityRole::Switch; }
 429     bool isToggleButton() const { return roleValue() == AccessibilityRole::ToggleButton; }
 430     bool isTextControl() const;
 431     bool isARIATextControl() const;
 432     bool isNonNativeTextControl() const;
 433     bool isTabList() const { return roleValue() == AccessibilityRole::TabList; }
 434     bool isTabItem() const { return roleValue() == AccessibilityRole::Tab; }
 435     bool isRadioGroup() const { return roleValue() == AccessibilityRole::RadioGroup; }
 436     bool isComboBox() const { return roleValue() == AccessibilityRole::ComboBox; }
<span class="line-modified"> 437     bool isTree() const override { return roleValue() == AccessibilityRole::Tree; }</span>
 438     bool isTreeGrid() const { return roleValue() == AccessibilityRole::TreeGrid; }
<span class="line-modified"> 439     bool isTreeItem() const override { return roleValue() == AccessibilityRole::TreeItem; }</span>
<span class="line-modified"> 440     bool isScrollbar() const override { return roleValue() == AccessibilityRole::ScrollBar; }</span>
 441     bool isButton() const;
 442     bool isListItem() const { return roleValue() == AccessibilityRole::ListItem; }
 443     bool isCheckboxOrRadio() const { return isCheckbox() || isRadioButton(); }
 444     bool isScrollView() const { return roleValue() == AccessibilityRole::ScrollArea; }
 445     bool isCanvas() const { return roleValue() == AccessibilityRole::Canvas; }
 446     bool isPopUpButton() const { return roleValue() == AccessibilityRole::PopUpButton; }
 447     bool isBlockquote() const;
 448     bool isLandmark() const;
 449     bool isColorWell() const { return roleValue() == AccessibilityRole::ColorWell; }
 450     bool isRangeControl() const;
 451     bool isMeter() const;
 452     bool isSplitter() const { return roleValue() == AccessibilityRole::Splitter; }
 453     bool isToolbar() const { return roleValue() == AccessibilityRole::Toolbar; }
 454     bool isStyleFormatGroup() const;


 455     bool isFigureElement() const;
<span class="line-added"> 456     bool isKeyboardFocusable() const;</span>
 457     bool isSummary() const { return roleValue() == AccessibilityRole::Summary; }
 458     bool isOutput() const;
 459 
 460     virtual bool isChecked() const { return false; }
 461     virtual bool isEnabled() const { return false; }
 462     virtual bool isSelected() const { return false; }
 463     virtual bool isFocused() const { return false; }
 464     virtual bool isHovered() const { return false; }
 465     virtual bool isIndeterminate() const { return false; }
 466     virtual bool isLoaded() const { return false; }
 467     virtual bool isMultiSelectable() const { return false; }
 468     virtual bool isOffScreen() const { return false; }
 469     virtual bool isPressed() const { return false; }
 470     virtual bool isUnvisited() const { return false; }
 471     virtual bool isVisited() const { return false; }
 472     virtual bool isRequired() const { return false; }
 473     virtual bool supportsRequiredAttribute() const { return false; }
 474     virtual bool isLinked() const { return false; }
 475     virtual bool isExpanded() const;
 476     virtual bool isVisible() const { return true; }
 477     virtual bool isCollapsed() const { return false; }
 478     virtual void setIsExpanded(bool) { }
<span class="line-added"> 479     FloatRect relativeFrame() const override;</span>
<span class="line-added"> 480     FloatRect convertFrameToSpace(const FloatRect&amp;, AccessibilityConversionSpace) const;</span>
 481 
 482     // In a multi-select list, many items can be selected but only one is active at a time.
 483     virtual bool isSelectedOptionActive() const { return false; }
 484 
 485     virtual bool hasBoldFont() const { return false; }
 486     virtual bool hasItalicFont() const { return false; }
 487     bool hasMisspelling() const;
 488     virtual bool hasPlainText() const { return false; }
 489     virtual bool hasSameFont(RenderObject*) const { return false; }
 490     virtual bool hasSameFontColor(RenderObject*) const { return false; }
 491     virtual bool hasSameStyle(RenderObject*) const { return false; }
 492     bool isStaticText() const { return roleValue() == AccessibilityRole::StaticText; }
 493     virtual bool hasUnderline() const { return false; }
 494     bool hasHighlighting() const;
 495 
 496     bool supportsDatetimeAttribute() const;
<span class="line-modified"> 497     const AtomString&amp; datetimeAttributeValue() const;</span>
 498 
 499     virtual bool canSetFocusAttribute() const { return false; }
 500     virtual bool canSetTextRangeAttributes() const { return false; }
 501     virtual bool canSetValueAttribute() const { return false; }
 502     virtual bool canSetNumericValue() const { return false; }
 503     virtual bool canSetSelectedAttribute() const { return false; }
 504     virtual bool canSetSelectedChildrenAttribute() const { return false; }
 505     virtual bool canSetExpandedAttribute() const { return false; }
 506 
 507     virtual Element* element() const;
 508     virtual Node* node() const { return nullptr; }
 509     virtual RenderObject* renderer() const { return nullptr; }
<span class="line-modified"> 510     bool accessibilityIsIgnored() const override;</span>
 511     virtual AccessibilityObjectInclusion defaultObjectInclusion() const;
 512     bool accessibilityIsIgnoredByDefault() const;
 513 
 514     bool isShowingValidationMessage() const;
 515     String validationMessage() const;
 516 
 517     unsigned blockquoteLevel() const;
 518     virtual int headingLevel() const { return 0; }
 519     virtual int tableLevel() const { return 0; }
 520     virtual AccessibilityButtonState checkboxOrRadioValue() const;
 521     virtual String valueDescription() const { return String(); }
 522     virtual float valueForRange() const { return 0.0f; }
 523     virtual float maxValueForRange() const { return 0.0f; }
 524     virtual float minValueForRange() const { return 0.0f; }
 525     virtual float stepValueForRange() const { return 0.0f; }
 526     virtual AccessibilityObject* selectedRadioButton() { return nullptr; }
 527     virtual AccessibilityObject* selectedTabItem() { return nullptr; }
 528     AccessibilityObject* selectedListItem();
 529     virtual int layoutCount() const { return 0; }
 530     virtual double estimatedLoadingProgress() const { return 0; }
<span class="line-modified"> 531     WEBCORE_EXPORT static bool isARIAControl(AccessibilityRole);</span>
<span class="line-modified"> 532     WEBCORE_EXPORT static bool isARIAInput(AccessibilityRole);</span>
 533 
 534     virtual bool supportsARIAOwns() const { return false; }
 535     bool isActiveDescendantOfFocusedContainer() const;
 536     void ariaActiveDescendantReferencingElements(AccessibilityChildrenVector&amp;) const;
 537     void ariaControlsElements(AccessibilityChildrenVector&amp;) const;
 538     void ariaControlsReferencingElements(AccessibilityChildrenVector&amp;) const;
 539     void ariaDescribedByElements(AccessibilityChildrenVector&amp;) const;
 540     void ariaDescribedByReferencingElements(AccessibilityChildrenVector&amp;) const;
 541     void ariaDetailsElements(AccessibilityChildrenVector&amp;) const;
 542     void ariaDetailsReferencingElements(AccessibilityChildrenVector&amp;) const;
 543     void ariaErrorMessageElements(AccessibilityChildrenVector&amp;) const;
 544     void ariaErrorMessageReferencingElements(AccessibilityChildrenVector&amp;) const;
 545     void ariaFlowToElements(AccessibilityChildrenVector&amp;) const;
 546     void ariaFlowToReferencingElements(AccessibilityChildrenVector&amp;) const;
 547     void ariaLabelledByElements(AccessibilityChildrenVector&amp;) const;
 548     void ariaLabelledByReferencingElements(AccessibilityChildrenVector&amp;) const;
 549     void ariaOwnsElements(AccessibilityChildrenVector&amp;) const;
 550     void ariaOwnsReferencingElements(AccessibilityChildrenVector&amp;) const;
 551 
 552     virtual bool hasPopup() const { return false; }
<span class="line-modified"> 553     String popupValue() const;</span>
<span class="line-added"> 554     bool hasDatalist() const;</span>
 555     bool supportsHasPopup() const;
 556     bool pressedIsPresent() const;
 557     bool ariaIsMultiline() const;
 558     String invalidStatus() const;
 559     bool supportsPressed() const;
 560     bool supportsExpanded() const;
 561     bool supportsChecked() const;
 562     AccessibilitySortDirection sortDirection() const;
 563     virtual bool canvasHasFallbackContent() const { return false; }
 564     bool supportsRangeValue() const;
<span class="line-modified"> 565     const AtomString&amp; identifierAttribute() const;</span>
<span class="line-modified"> 566     const AtomString&amp; linkRelValue() const;</span>
 567     void classList(Vector&lt;String&gt;&amp;) const;
 568     virtual String roleDescription() const;
 569     AccessibilityCurrentState currentState() const;
 570     String currentValue() const;
 571     bool supportsCurrent() const;
 572     const String keyShortcutsValue() const;
 573 
 574     // This function checks if the object should be ignored when there&#39;s a modal dialog displayed.
 575     bool ignoredFromModalPresence() const;
 576     bool isModalDescendant(Node*) const;
 577     bool isModalNode() const;
 578 
 579     bool supportsSetSize() const;
 580     bool supportsPosInSet() const;
 581     int setSize() const;
 582     int posInSet() const;
 583 
 584     // ARIA drag and drop
 585     virtual bool supportsARIADropping() const { return false; }
 586     virtual bool supportsARIADragging() const { return false; }
 587     virtual bool isARIAGrabbed() { return false; }
 588     virtual void setARIAGrabbed(bool) { }
 589     virtual Vector&lt;String&gt; determineARIADropEffects() { return { }; }
 590 
 591     // Called on the root AX object to return the deepest available element.
<span class="line-modified"> 592     AccessibilityObjectInterface* accessibilityHitTest(const IntPoint&amp;) const override { return nullptr; }</span>
 593     // Called on the AX object after the render tree determines which is the right AccessibilityRenderObject.
<span class="line-modified"> 594     virtual AccessibilityObjectInterface* elementAccessibilityHitTest(const IntPoint&amp;) const;</span>
 595 
<span class="line-modified"> 596     AccessibilityObjectInterface* focusedUIElement() const override;</span>
 597 
 598     virtual AccessibilityObject* firstChild() const { return nullptr; }
 599     virtual AccessibilityObject* lastChild() const { return nullptr; }
 600     virtual AccessibilityObject* previousSibling() const { return nullptr; }
 601     virtual AccessibilityObject* nextSibling() const { return nullptr; }
 602     virtual AccessibilityObject* nextSiblingUnignored(int limit) const;
 603     virtual AccessibilityObject* previousSiblingUnignored(int limit) const;
<span class="line-modified"> 604     virtual AccessibilityObject* parentObject() const { return nullptr; }</span>
 605     virtual AccessibilityObject* parentObjectUnignored() const;
<span class="line-added"> 606     AccessibilityObjectInterface* parentObjectInterfaceUnignored() const override { return parentObjectUnignored(); }</span>
 607     virtual AccessibilityObject* parentObjectIfExists() const { return nullptr; }
 608     static AccessibilityObject* firstAccessibleObjectFromNode(const Node*);
 609     void findMatchingObjects(AccessibilitySearchCriteria*, AccessibilityChildrenVector&amp;);
 610     virtual bool isDescendantOfBarrenParent() const { return false; }
 611 
 612     bool isDescendantOfRole(AccessibilityRole) const;
 613 
 614     // Text selection
<span class="line-modified"> 615 private:</span>
<span class="line-added"> 616     RefPtr&lt;Range&gt; rangeOfStringClosestToRangeInDirection(Range*, AccessibilitySearchDirection, Vector&lt;String&gt; const&amp;) const;</span>
 617     RefPtr&lt;Range&gt; selectionRange() const;
<span class="line-modified"> 618     RefPtr&lt;Range&gt; findTextRange(Vector&lt;String&gt; const&amp; searchStrings, RefPtr&lt;Range&gt; const&amp; start, AccessibilitySearchTextDirection) const;</span>
<span class="line-added"> 619 public:</span>
<span class="line-added"> 620     Vector&lt;RefPtr&lt;Range&gt;&gt; findTextRanges(AccessibilitySearchTextCriteria const&amp;) const;</span>
<span class="line-added"> 621     Vector&lt;String&gt; performTextOperation(AccessibilityTextOperation const&amp;);</span>
 622 
 623     virtual AccessibilityObject* observableObject() const { return nullptr; }
 624     virtual void linkedUIElements(AccessibilityChildrenVector&amp;) const { }
 625     virtual AccessibilityObject* titleUIElement() const { return nullptr; }
 626     virtual bool exposesTitleUIElement() const { return true; }
 627     virtual AccessibilityObject* correspondingLabelForControlElement() const { return nullptr; }
 628     virtual AccessibilityObject* correspondingControlForLabelElement() const { return nullptr; }
 629     virtual AccessibilityObject* scrollBar(AccessibilityOrientation) { return nullptr; }
 630 
 631     virtual AccessibilityRole ariaRoleAttribute() const { return AccessibilityRole::Unknown; }
 632     virtual bool isPresentationalChildOfAriaRole() const { return false; }
 633     virtual bool ariaRoleHasPresentationalChildren() const { return false; }
 634     virtual bool inheritsPresentationalRole() const { return false; }
 635 
 636     // Accessibility Text
<span class="line-modified"> 637     virtual void accessibilityText(Vector&lt;AccessibilityText&gt;&amp;) const { };</span>
 638     // A single method for getting a computed label for an AXObject. It condenses the nuances of accessibilityText. Used by Inspector.
 639     String computedLabel();
 640 
 641     // A programmatic way to set a name on an AccessibleObject.
<span class="line-modified"> 642     virtual void setAccessibleName(const AtomString&amp;) { }</span>
 643     virtual bool hasAttributesRequiredForInclusion() const;
 644 
 645     // Accessibility Text - (To be deprecated).
 646     virtual String accessibilityDescription() const { return String(); }
 647     virtual String title() const { return String(); }
 648     virtual String helpText() const { return String(); }
 649 
 650     // Methods for determining accessibility text.
 651     bool isARIAStaticText() const { return ariaRoleAttribute() == AccessibilityRole::StaticText; }
 652     virtual String stringValue() const { return String(); }
 653     virtual String textUnderElement(AccessibilityTextUnderElementMode = AccessibilityTextUnderElementMode()) const { return String(); }
 654     virtual String text() const { return String(); }
 655     virtual int textLength() const { return 0; }
 656     virtual String ariaLabeledByAttribute() const { return String(); }
 657     virtual String ariaDescribedByAttribute() const { return String(); }
 658     const String placeholderValue() const;
 659     bool accessibleNameDerivesFromContent() const;
 660 
 661     // Abbreviations
 662     virtual String expandedTextValue() const { return String(); }
 663     virtual bool supportsExpandedTextValue() const { return false; }
 664 
 665     void elementsFromAttribute(Vector&lt;Element*&gt;&amp;, const QualifiedName&amp;) const;
 666 
 667     // Only if isColorWell()
 668     virtual void colorValue(int&amp; r, int&amp; g, int&amp; b) const { r = 0; g = 0; b = 0; }
 669 
<span class="line-modified"> 670     AccessibilityRole roleValue() const override { return m_role; }</span>
 671 
 672     virtual AXObjectCache* axObjectCache() const;
 673     AXID axObjectID() const { return m_id; }
 674 
 675     static AccessibilityObject* anchorElementForNode(Node*);
 676     static AccessibilityObject* headingElementForNode(Node*);
 677     virtual Element* anchorElement() const { return nullptr; }
 678     bool supportsPressAction() const;
 679     virtual Element* actionElement() const { return nullptr; }
 680     virtual LayoutRect boundingBoxRect() const { return LayoutRect(); }
 681     IntRect pixelSnappedBoundingBoxRect() const { return snappedIntRect(boundingBoxRect()); }
 682     virtual LayoutRect elementRect() const = 0;
 683     LayoutSize size() const { return elementRect().size(); }
 684     virtual IntPoint clickPoint();
 685     static IntRect boundingBoxForQuads(RenderObject*, const Vector&lt;FloatQuad&gt;&amp;);
 686     virtual Path elementPath() const { return Path(); }
 687     virtual bool supportsPath() const { return false; }
 688 
 689     TextIteratorBehavior textIteratorBehaviorForTextRange() const;
 690     virtual PlainTextRange selectedTextRange() const { return PlainTextRange(); }
 691     unsigned selectionStart() const { return selectedTextRange().start; }
 692     unsigned selectionEnd() const { return selectedTextRange().length; }
 693 
 694     virtual URL url() const { return URL(); }
 695     virtual VisibleSelection selection() const { return VisibleSelection(); }
 696     virtual String selectedText() const { return String(); }
<span class="line-modified"> 697     virtual const AtomString&amp; accessKey() const { return nullAtom(); }</span>
 698     const String&amp; actionVerb() const;
 699     virtual Widget* widget() const { return nullptr; }
 700     virtual Widget* widgetForAttachmentView() const { return nullptr; }
 701     Page* page() const;
 702     virtual Document* document() const;
 703     virtual FrameView* documentFrameView() const;
 704     Frame* frame() const;
 705     Frame* mainFrame() const;
 706     Document* topDocument() const;
 707     ScrollView* scrollViewAncestor() const;
 708     String language() const;
 709     // 1-based, to match the aria-level spec.
 710     virtual unsigned hierarchicalLevel() const { return 0; }
 711 
 712     virtual void setFocused(bool) { }
 713     virtual void setSelectedText(const String&amp;) { }
 714     virtual void setSelectedTextRange(const PlainTextRange&amp;) { }
 715     virtual void setValue(const String&amp;) { }
<span class="line-added"> 716     bool replaceTextInRange(const String&amp;, const PlainTextRange&amp;);</span>
<span class="line-added"> 717     bool insertText(const String&amp;);</span>
<span class="line-added"> 718 </span>
 719     virtual void setValue(float) { }
 720     virtual void setSelected(bool) { }
 721     virtual void setSelectedRows(AccessibilityChildrenVector&amp;) { }
 722 
 723     virtual void makeRangeVisible(const PlainTextRange&amp;) { }
 724     virtual bool press();
 725     bool performDefaultAction() { return press(); }
 726 
 727     virtual AccessibilityOrientation orientation() const;
 728     virtual void increment() { }
 729     virtual void decrement() { }
 730 
 731     virtual void childrenChanged() { }
 732     virtual void textChanged() { }
 733     virtual void updateAccessibilityRole() { }
 734     const AccessibilityChildrenVector&amp; children(bool updateChildrenIfNeeded = true);
 735     virtual void addChildren() { }
 736     virtual void addChild(AccessibilityObject*);
 737     virtual void insertChild(AccessibilityObject*, unsigned);
 738 
 739     virtual bool shouldIgnoreAttributeRole() const { return false; }
 740 
 741     virtual bool canHaveChildren() const { return true; }
 742     virtual bool hasChildren() const { return m_haveChildren; }
<span class="line-modified"> 743     void updateChildrenIfNecessary() override;</span>
 744     virtual void setNeedsToUpdateChildren() { }
 745     virtual void setNeedsToUpdateSubtree() { }
 746     virtual void clearChildren();
 747     virtual bool needsToUpdateChildren() const { return false; }
 748 #if PLATFORM(COCOA)
 749     virtual void detachFromParent();
 750 #else
 751     virtual void detachFromParent() { }
 752 #endif
 753     virtual bool isDetachedFromParent() { return false; }
 754 
 755     virtual bool canHaveSelectedChildren() const { return false; }
 756     virtual void selectedChildren(AccessibilityChildrenVector&amp;) { }
 757     virtual void visibleChildren(AccessibilityChildrenVector&amp;) { }
 758     virtual void tabChildren(AccessibilityChildrenVector&amp;) { }
 759     virtual bool shouldFocusActiveDescendant() const { return false; }
 760     virtual AccessibilityObject* activeDescendant() const { return nullptr; }
 761     virtual void handleActiveDescendantChanged() { }
 762     virtual void handleAriaExpandedChanged() { }
 763     bool isDescendantOfObject(const AccessibilityObject*) const;
 764     bool isAncestorOfObject(const AccessibilityObject*) const;
 765     AccessibilityObject* firstAnonymousBlockChild() const;
 766 
<span class="line-modified"> 767     WEBCORE_EXPORT static AccessibilityRole ariaRoleToWebCoreRole(const String&amp;);</span>
 768     bool hasAttribute(const QualifiedName&amp;) const;
<span class="line-modified"> 769     const AtomString&amp; getAttribute(const QualifiedName&amp;) const;</span>
 770     bool hasTagName(const QualifiedName&amp;) const;
 771 





 772     virtual VisiblePositionRange visiblePositionRange() const { return VisiblePositionRange(); }
 773     virtual VisiblePositionRange visiblePositionRangeForLine(unsigned) const { return VisiblePositionRange(); }
 774 
 775     RefPtr&lt;Range&gt; elementRange() const;
 776     static bool replacedNodeNeedsCharacter(Node* replacedNode);
 777 
 778     VisiblePositionRange visiblePositionRangeForUnorderedPositions(const VisiblePosition&amp;, const VisiblePosition&amp;) const;
 779     VisiblePositionRange positionOfLeftWord(const VisiblePosition&amp;) const;
 780     VisiblePositionRange positionOfRightWord(const VisiblePosition&amp;) const;
 781     VisiblePositionRange leftLineVisiblePositionRange(const VisiblePosition&amp;) const;
 782     VisiblePositionRange rightLineVisiblePositionRange(const VisiblePosition&amp;) const;
 783     VisiblePositionRange sentenceForPosition(const VisiblePosition&amp;) const;
 784     VisiblePositionRange paragraphForPosition(const VisiblePosition&amp;) const;
 785     VisiblePositionRange styleRangeForPosition(const VisiblePosition&amp;) const;
 786     VisiblePositionRange visiblePositionRangeForRange(const PlainTextRange&amp;) const;
 787     VisiblePositionRange lineRangeForPosition(const VisiblePosition&amp;) const;
 788 
 789     RefPtr&lt;Range&gt; rangeForPlainTextRange(const PlainTextRange&amp;) const;
 790 
 791     static String stringForVisiblePositionRange(const VisiblePositionRange&amp;);
</pre>
<hr />
<pre>
 842     bool isValueAutofilled() const;
 843     bool isValueAutofillAvailable() const;
 844     AutoFillButtonType valueAutofillButtonType() const;
 845 
 846     // Used by an ARIA tree to get all its rows.
 847     void ariaTreeRows(AccessibilityChildrenVector&amp;);
 848     // Used by an ARIA tree item to get all of its direct rows that it can disclose.
 849     void ariaTreeItemDisclosedRows(AccessibilityChildrenVector&amp;);
 850     // Used by an ARIA tree item to get only its content, and not its child tree items and groups.
 851     void ariaTreeItemContent(AccessibilityChildrenVector&amp;);
 852 
 853     // ARIA live-region features.
 854     bool supportsLiveRegion(bool excludeIfOff = true) const;
 855     bool isInsideLiveRegion(bool excludeIfOff = true) const;
 856     AccessibilityObject* liveRegionAncestor(bool excludeIfOff = true) const;
 857     virtual const String liveRegionStatus() const { return String(); }
 858     virtual const String liveRegionRelevant() const { return nullAtom(); }
 859     virtual bool liveRegionAtomic() const { return false; }
 860     virtual bool isBusy() const { return false; }
 861     static const String defaultLiveRegionStatusForRole(AccessibilityRole);
<span class="line-modified"> 862     static bool liveRegionStatusIsEnabled(const AtomString&amp;);</span>
 863     static bool contentEditableAttributeIsEnabled(Element*);
 864     bool hasContentEditableAttributeSet() const;
 865 
 866     bool supportsReadOnly() const;
 867     virtual String readOnlyValue() const;
 868 
 869     bool supportsAutoComplete() const;
 870     String autoCompleteValue() const;
 871 
 872     bool supportsARIAAttributes() const;
 873 
 874     // CSS3 Speech properties.
 875     virtual OptionSet&lt;SpeakAs&gt; speakAsProperty() const { return OptionSet&lt;SpeakAs&gt; { }; }
 876 
 877     // Make this object visible by scrolling as many nested scrollable views as needed.
 878     virtual void scrollToMakeVisible() const;
 879     // Same, but if the whole object can&#39;t be made visible, try for this subrect, in local coordinates.
 880     virtual void scrollToMakeVisibleWithSubFocus(const IntRect&amp;) const;
 881     // Scroll this object to a given point in global coordinates of the top-level window.
 882     virtual void scrollToGlobalPoint(const IntPoint&amp;) const;
 883 
 884     enum class ScrollByPageDirection { Up, Down, Left, Right };
 885     bool scrollByPage(ScrollByPageDirection) const;
 886     IntPoint scrollPosition() const;
 887     IntSize scrollContentsSize() const;
 888     IntRect scrollVisibleContentRect() const;
<span class="line-added"> 889     void scrollToMakeVisible(const ScrollRectToVisibleOptions&amp;) const;</span>
 890 
 891     bool lastKnownIsIgnoredValue();
 892     void setLastKnownIsIgnoredValue(bool);
 893 
 894     // Fires a children changed notification on the parent if the isIgnored value changed.
 895     void notifyIfIgnoredValueChanged();
 896 
 897     // All math elements return true for isMathElement().
 898     virtual bool isMathElement() const { return false; }
 899     virtual bool isMathFraction() const { return false; }
 900     virtual bool isMathFenced() const { return false; }
 901     virtual bool isMathSubscriptSuperscript() const { return false; }
 902     virtual bool isMathRow() const { return false; }
 903     virtual bool isMathUnderOver() const { return false; }
 904     virtual bool isMathRoot() const { return false; }
 905     virtual bool isMathSquareRoot() const { return false; }
 906     virtual bool isMathText() const { return false; }
 907     virtual bool isMathNumber() const { return false; }
 908     virtual bool isMathOperator() const { return false; }
 909     virtual bool isMathFenceOperator() const { return false; }
</pre>
<hr />
<pre>
 933     virtual AccessibilityObject* mathBaseObject() { return nullptr; }
 934     virtual AccessibilityObject* mathSubscriptObject() { return nullptr; }
 935     virtual AccessibilityObject* mathSuperscriptObject() { return nullptr; }
 936 
 937     // Fenced components.
 938     virtual String mathFencedOpenString() const { return String(); }
 939     virtual String mathFencedCloseString() const { return String(); }
 940     virtual int mathLineThickness() const { return 0; }
 941     virtual bool isAnonymousMathOperator() const { return false; }
 942 
 943     // Multiscripts components.
 944     typedef Vector&lt;std::pair&lt;AccessibilityObject*, AccessibilityObject*&gt;&gt; AccessibilityMathMultiscriptPairs;
 945     virtual void mathPrescripts(AccessibilityMathMultiscriptPairs&amp;) { }
 946     virtual void mathPostscripts(AccessibilityMathMultiscriptPairs&amp;) { }
 947 
 948     // Visibility.
 949     bool isAXHidden() const;
 950     bool isDOMHidden() const;
 951     bool isHidden() const { return isAXHidden() || isDOMHidden(); }
 952 
<span class="line-modified"> 953 #if ENABLE(ACCESSIBILITY)</span>
<span class="line-modified"> 954     AccessibilityObjectWrapper* wrapper() const override { return m_wrapper.get(); }</span>
 955     void setWrapper(AccessibilityObjectWrapper* wrapper) { m_wrapper = wrapper; }
<span class="line-added"> 956 #else</span>
<span class="line-added"> 957     AccessibilityObjectWrapper* wrapper() const override { return nullptr; }</span>
 958 #endif
 959 
 960 #if PLATFORM(COCOA)
 961     void overrideAttachmentParent(AccessibilityObject* parent);
 962 #else
 963     void overrideAttachmentParent(AccessibilityObject*) { }
 964 #endif
 965 
<span class="line-modified"> 966 #if ENABLE(ACCESSIBILITY)</span>
 967     // a platform-specific method for determining if an attachment is ignored
 968     bool accessibilityIgnoreAttachment() const;
 969     // gives platforms the opportunity to indicate if and how an object should be included
 970     AccessibilityObjectInclusion accessibilityPlatformIncludesObject() const;
 971 #else
 972     bool accessibilityIgnoreAttachment() const { return true; }
 973     AccessibilityObjectInclusion accessibilityPlatformIncludesObject() const { return AccessibilityObjectInclusion::DefaultBehavior; }
 974 #endif
 975 
 976 #if PLATFORM(IOS_FAMILY)
 977     int accessibilityPasswordFieldLength();
 978     bool hasTouchEventListener() const;
 979     bool isInputTypePopupButton() const;

 980 #endif
 981 
 982     // allows for an AccessibilityObject to update its render tree or perform
 983     // other operations update type operations
 984     void updateBackingStore();
 985 
 986 #if PLATFORM(COCOA)
 987     bool preventKeyboardDOMEventDispatch() const;
 988     void setPreventKeyboardDOMEventDispatch(bool);
<span class="line-added"> 989     bool fileUploadButtonReturnsValueInTitle() const;</span>
<span class="line-added"> 990     String speechHintAttributeValue() const override;</span>
<span class="line-added"> 991     String descriptionAttributeValue() const override;</span>
<span class="line-added"> 992     String helpTextAttributeValue() const override;</span>
<span class="line-added"> 993     String titleAttributeValue() const override;</span>
 994 #endif
 995 
 996 #if PLATFORM(COCOA) &amp;&amp; !PLATFORM(IOS_FAMILY)
 997     bool caretBrowsingEnabled() const;
 998     void setCaretBrowsingEnabled(bool);
 999 #endif
1000 
1001     AccessibilityObject* focusableAncestor();
1002     AccessibilityObject* editableAncestor();
1003     AccessibilityObject* highestEditableAncestor();
1004 
<span class="line-added">1005     const AccessibilityScrollView* ancestorAccessibilityScrollView(bool includeSelf) const;</span>
1006     static const AccessibilityObject* matchedParent(const AccessibilityObject&amp;, bool includeSelf, const WTF::Function&lt;bool(const AccessibilityObject&amp;)&gt;&amp;);
1007 
1008     void clearIsIgnoredFromParentData() { m_isIgnoredFromParentData = AccessibilityIsIgnoredFromParentData(); }
1009     void setIsIgnoredFromParentDataForChild(AccessibilityObject*);
1010 
1011 protected:
1012     AXID m_id { 0 };
1013     AccessibilityChildrenVector m_children;
1014     mutable bool m_haveChildren { false };
1015     AccessibilityRole m_role { AccessibilityRole::Unknown };
1016     AccessibilityObjectInclusion m_lastKnownIsIgnoredValue { AccessibilityObjectInclusion::DefaultBehavior };
1017     AccessibilityIsIgnoredFromParentData m_isIgnoredFromParentData { };
1018     bool m_childrenDirty { false };
1019     bool m_subtreeDirty { false };
1020 #if ENABLE(ACCESSIBILITY_ISOLATED_TREE)
1021     bool m_isolatedTreeNodeInitialized { false };
1022 #endif
1023 
1024     void setIsIgnoredFromParentData(AccessibilityIsIgnoredFromParentData&amp; data) { m_isIgnoredFromParentData = data; }
1025 
1026     virtual bool computeAccessibilityIsIgnored() const { return true; }
<span class="line-added">1027     bool isAccessibilityObject() const override { return true; }</span>
1028 
1029     // If this object itself scrolls, return its ScrollableArea.
1030     virtual ScrollableArea* getScrollableAreaIfScrollable() const { return nullptr; }
1031     virtual void scrollTo(const IntPoint&amp;) const { }
1032     ScrollableArea* scrollableAreaAncestor() const;
1033     void scrollAreaAndAncestor(std::pair&lt;ScrollableArea*, AccessibilityObject*&gt;&amp;) const;
1034 
1035     static bool isAccessibilityObjectSearchMatchAtIndex(AccessibilityObject*, AccessibilitySearchCriteria*, size_t);
1036     static bool isAccessibilityObjectSearchMatch(AccessibilityObject*, AccessibilitySearchCriteria*);
1037     static bool isAccessibilityTextSearchMatch(AccessibilityObject*, AccessibilitySearchCriteria*);
1038     static bool objectMatchesSearchCriteriaWithResultLimit(AccessibilityObject*, AccessibilitySearchCriteria*, AccessibilityChildrenVector&amp;);
1039     virtual AccessibilityRole buttonRoleType() const;
1040     bool isOnscreen() const;
1041     bool dispatchTouchEvent();
1042 
1043     void ariaElementsFromAttribute(AccessibilityChildrenVector&amp;, const QualifiedName&amp;) const;
1044     void ariaElementsReferencedByAttribute(AccessibilityChildrenVector&amp;, const QualifiedName&amp;) const;
1045 
1046     AccessibilityObject* radioGroupAncestor() const;
1047 
<span class="line-modified">1048 #if ENABLE(ACCESSIBILITY) &amp;&amp; USE(ATK)</span>
1049     bool allowsTextRanges() const;
1050     unsigned getLengthForTextRange() const;
1051 #else
1052     bool allowsTextRanges() const { return isTextControl(); }
1053     unsigned getLengthForTextRange() const { return text().length(); }
1054 #endif
1055 
1056 #if PLATFORM(COCOA)
1057     RetainPtr&lt;WebAccessibilityObjectWrapper&gt; m_wrapper;
1058 #elif PLATFORM(WIN)
1059     COMPtr&lt;AccessibilityObjectWrapper&gt; m_wrapper;
<span class="line-modified">1060 #elif USE(ATK)</span>
1061     GRefPtr&lt;WebKitAccessible&gt; m_wrapper;


1062 #endif
1063 };
1064 
<span class="line-modified">1065 #if !ENABLE(ACCESSIBILITY)</span>
1066 inline const AccessibilityObject::AccessibilityChildrenVector&amp; AccessibilityObject::children(bool) { return m_children; }
1067 inline const String&amp; AccessibilityObject::actionVerb() const { return emptyString(); }
1068 inline int AccessibilityObject::lineForPosition(const VisiblePosition&amp;) const { return -1; }
1069 inline void AccessibilityObject::updateBackingStore() { }
1070 #endif
1071 
<span class="line-added">1072 AccessibilityObject* firstAccessibleObjectFromNode(const Node*, const WTF::Function&lt;bool(const AccessibilityObject&amp;)&gt;&amp; isAccessible);</span>
<span class="line-added">1073 </span>
1074 } // namespace WebCore
1075 
1076 #define SPECIALIZE_TYPE_TRAITS_ACCESSIBILITY(ToValueTypeName, predicate) \
1077 SPECIALIZE_TYPE_TRAITS_BEGIN(WebCore::ToValueTypeName) \
1078     static bool isType(const WebCore::AccessibilityObject&amp; object) { return object.predicate; } \
1079 SPECIALIZE_TYPE_TRAITS_END()
<span class="line-added">1080 </span>
<span class="line-added">1081 SPECIALIZE_TYPE_TRAITS_BEGIN(WebCore::AccessibilityObject)</span>
<span class="line-added">1082 static bool isType(const WebCore::AccessibilityObjectInterface&amp; context) { return context.isAccessibilityObject(); }</span>
<span class="line-added">1083 SPECIALIZE_TYPE_TRAITS_END()</span>
</pre>
</td>
</tr>
</table>
<center><a href="AccessibilityObject.cpp.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="AccessibilityObjectInterface.h.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>