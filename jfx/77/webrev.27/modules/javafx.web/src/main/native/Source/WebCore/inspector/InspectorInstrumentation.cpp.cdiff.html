<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Cdiff modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorInstrumentation.cpp</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
  </head>
<body>
<center><a href="InspectorHistory.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorInstrumentation.h.cdiff.html" target="_top">next &gt;</a></center>    <h2>modules/javafx.web/src/main/native/Source/WebCore/inspector/InspectorInstrumentation.cpp</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<hr />
<pre>
<span class="line-old-header">*** 31,13 ***</span>
  
  #include &quot;config.h&quot;
  #include &quot;InspectorInstrumentation.h&quot;
  
  #include &quot;CachedResource.h&quot;
  #include &quot;DOMWindow.h&quot;
  #include &quot;DOMWrapperWorld.h&quot;
<span class="line-removed">- #include &quot;Database.h&quot;</span>
  #include &quot;DocumentLoader.h&quot;
  #include &quot;Event.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;InspectorApplicationCacheAgent.h&quot;
  #include &quot;InspectorCSSAgent.h&quot;
<span class="line-new-header">--- 31,13 ---</span>
  
  #include &quot;config.h&quot;
  #include &quot;InspectorInstrumentation.h&quot;
  
  #include &quot;CachedResource.h&quot;
<span class="line-added">+ #include &quot;CustomHeaderFields.h&quot;</span>
  #include &quot;DOMWindow.h&quot;
  #include &quot;DOMWrapperWorld.h&quot;
  #include &quot;DocumentLoader.h&quot;
  #include &quot;Event.h&quot;
  #include &quot;Frame.h&quot;
  #include &quot;InspectorApplicationCacheAgent.h&quot;
  #include &quot;InspectorCSSAgent.h&quot;
</pre>
<hr />
<pre>
<span class="line-old-header">*** 108,15 ***</span>
      return frame;
  }
  
  void InspectorInstrumentation::didClearWindowObjectInWorldImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DOMWrapperWorld&amp; world)
  {
<span class="line-removed">-     InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent();</span>
      if (PageDebuggerAgent* debuggerAgent = instrumentingAgents.pageDebuggerAgent()) {
<span class="line-modified">!         if (pageAgent &amp;&amp; &amp;world == &amp;mainThreadNormalWorld() &amp;&amp; &amp;frame == &amp;pageAgent-&gt;mainFrame())</span>
              debuggerAgent-&gt;didClearMainFrameWindowObject();
      }
      if (PageRuntimeAgent* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent()) {
          if (&amp;world == &amp;mainThreadNormalWorld())
              pageRuntimeAgent-&gt;didCreateMainWorldContext(frame);
      }
  }
<span class="line-new-header">--- 108,15 ---</span>
      return frame;
  }
  
  void InspectorInstrumentation::didClearWindowObjectInWorldImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, DOMWrapperWorld&amp; world)
  {
      if (PageDebuggerAgent* debuggerAgent = instrumentingAgents.pageDebuggerAgent()) {
<span class="line-modified">!         if (&amp;world == &amp;mainThreadNormalWorld() &amp;&amp; frame.isMainFrame())</span>
              debuggerAgent-&gt;didClearMainFrameWindowObject();
      }
<span class="line-added">+ </span>
      if (PageRuntimeAgent* pageRuntimeAgent = instrumentingAgents.pageRuntimeAgent()) {
          if (&amp;world == &amp;mainThreadNormalWorld())
              pageRuntimeAgent-&gt;didCreateMainWorldContext(frame);
      }
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 167,46 ***</span>
          domDebuggerAgent-&gt;didRemoveDOMNode(node);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didRemoveDOMNode(node);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomicString&amp; oldValue, const AtomicString&amp; newValue)</span>
  {
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
          domDebuggerAgent-&gt;willModifyDOMAttr(element);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;willModifyDOMAttr(element, oldValue, newValue);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomicString&amp; name, const AtomicString&amp; value)</span>
  {
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didModifyDOMAttr(element, name, value);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didRemoveDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomicString&amp; name)</span>
  {
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didRemoveDOMAttr(element, name);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Node&amp; node)</span>
  {
<span class="line-modified">!     if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())</span>
<span class="line-modified">!         domAgent-&gt;didInvalidateStyleAttr(node);</span>
<span class="line-modified">!     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified">!         domDebuggerAgent-&gt;didInvalidateStyleAttr(node);</span>
  }
  
  void InspectorInstrumentation::documentDetachedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
  {
      if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
          cssAgent-&gt;documentDetached(document);
  }
  
  void InspectorInstrumentation::frameWindowDiscardedImpl(InstrumentingAgents&amp; instrumentingAgents, DOMWindow* window)
  {
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
          consoleAgent-&gt;frameWindowDiscarded(window);
  }
  
  void InspectorInstrumentation::mediaQueryResultChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
<span class="line-new-header">--- 167,53 ---</span>
          domDebuggerAgent-&gt;didRemoveDOMNode(node);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didRemoveDOMNode(node);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; oldValue, const AtomString&amp; newValue)</span>
  {
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
          domDebuggerAgent-&gt;willModifyDOMAttr(element);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;willModifyDOMAttr(element, oldValue, newValue);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didModifyDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name, const AtomString&amp; value)</span>
  {
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didModifyDOMAttr(element, name, value);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didRemoveDOMAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element, const AtomString&amp; name)</span>
  {
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didRemoveDOMAttr(element, name);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)</span>
  {
<span class="line-modified">!     if (auto* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-modified">!         domDebuggerAgent-&gt;willInvalidateStyleAttr(element);</span>
<span class="line-modified">! }</span>
<span class="line-modified">! </span>
<span class="line-added">+ void InspectorInstrumentation::didInvalidateStyleAttrImpl(InstrumentingAgents&amp; instrumentingAgents, Element&amp; element)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())</span>
<span class="line-added">+         domAgent-&gt;didInvalidateStyleAttr(element);</span>
  }
  
  void InspectorInstrumentation::documentDetachedImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
  {
      if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
          cssAgent-&gt;documentDetached(document);
  }
  
  void InspectorInstrumentation::frameWindowDiscardedImpl(InstrumentingAgents&amp; instrumentingAgents, DOMWindow* window)
  {
<span class="line-added">+     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
          consoleAgent-&gt;frameWindowDiscarded(window);
  }
  
  void InspectorInstrumentation::mediaQueryResultChangedImpl(InstrumentingAgents&amp; instrumentingAgents)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 307,39 ***</span>
  void InspectorInstrumentation::didInstallTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, Seconds timeout, bool singleShot, ScriptExecutionContext&amp; context)
  {
      if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
          debuggerAgent-&gt;didScheduleAsyncCall(context.execState(), InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId, singleShot);
  
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didInstallTimer(timerId, timeout, singleShot, frameForScriptExecutionContext(context));
  }
  
  void InspectorInstrumentation::didRemoveTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, ScriptExecutionContext&amp; context)
  {
      if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
          debuggerAgent-&gt;didCancelAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didRemoveTimer(timerId, frameForScriptExecutionContext(context));
  }
  
<span class="line-modified">! void InspectorInstrumentation::didAddEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomicString&amp; eventType, EventListener&amp; listener, bool capture)</span>
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;didAddEventListener(target, eventType, listener, capture);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didAddEventListener(target);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willRemoveEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomicString&amp; eventType, EventListener&amp; listener, bool capture)</span>
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
  }
  
<span class="line-modified">! bool InspectorInstrumentation::isEventListenerDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomicString&amp; eventType, EventListener&amp; listener, bool capture)</span>
  {
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          return domAgent-&gt;isEventListenerDisabled(target, eventType, listener, capture);
      return false;
  }
<span class="line-new-header">--- 314,39 ---</span>
  void InspectorInstrumentation::didInstallTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, Seconds timeout, bool singleShot, ScriptExecutionContext&amp; context)
  {
      if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
          debuggerAgent-&gt;didScheduleAsyncCall(context.execState(), InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId, singleShot);
  
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didInstallTimer(timerId, timeout, singleShot, frameForScriptExecutionContext(context));
  }
  
  void InspectorInstrumentation::didRemoveTimerImpl(InstrumentingAgents&amp; instrumentingAgents, int timerId, ScriptExecutionContext&amp; context)
  {
      if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
          debuggerAgent-&gt;didCancelAsyncCall(InspectorDebuggerAgent::AsyncCallType::DOMTimer, timerId);
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didRemoveTimer(timerId, frameForScriptExecutionContext(context));
  }
  
<span class="line-modified">! void InspectorInstrumentation::didAddEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)</span>
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;didAddEventListener(target, eventType, listener, capture);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;didAddEventListener(target);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willRemoveEventListenerImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)</span>
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          domAgent-&gt;willRemoveEventListener(target, eventType, listener, capture);
  }
  
<span class="line-modified">! bool InspectorInstrumentation::isEventListenerDisabledImpl(InstrumentingAgents&amp; instrumentingAgents, EventTarget&amp; target, const AtomString&amp; eventType, EventListener&amp; listener, bool capture)</span>
  {
      if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
          return domAgent-&gt;isEventListenerDisabled(target, eventType, listener, capture);
      return false;
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 369,11 ***</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; scriptName, int scriptLine, int scriptColumn, ScriptExecutionContext* context)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willCallFunction(scriptName, scriptLine, scriptColumn, frameForScriptExecutionContext(context));
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
<span class="line-new-header">--- 376,11 ---</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willCallFunctionImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; scriptName, int scriptLine, int scriptColumn, ScriptExecutionContext* context)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willCallFunction(scriptName, scriptLine, scriptColumn, frameForScriptExecutionContext(context));
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 385,20 ***</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document, const Event&amp; event, bool hasEventListeners)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent();</span>
      if (timelineAgent &amp;&amp; hasEventListeners) {
          timelineAgent-&gt;willDispatchEvent(event, document.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
  
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, const RegisteredEventListener&amp; listener)</span>
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;willHandleEvent(listener);
  
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
<span class="line-new-header">--- 392,20 ---</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document, const Event&amp; event, bool hasEventListeners)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent();</span>
      if (timelineAgent &amp;&amp; hasEventListeners) {
          timelineAgent-&gt;willDispatchEvent(event, document.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
  
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
  
<span class="line-modified">! void InspectorInstrumentation::willHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents, Event&amp; event, const RegisteredEventListener&amp; listener)</span>
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;willHandleEvent(listener);
  
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 407,34 ***</span>
  
  void InspectorInstrumentation::didHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents)
  {
      if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
          debuggerAgent-&gt;didDispatchAsyncCall();
  }
  
<span class="line-modified">! void InspectorInstrumentation::didDispatchEventImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
  {
      if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified">!         timelineAgent-&gt;didDispatchEvent();</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, DOMWindow&amp; window)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent();</span>
      if (timelineAgent &amp;&amp; window.hasEventListeners(event.type())) {
          timelineAgent-&gt;willDispatchEvent(event, window.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
  
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didDispatchEventOnWindowImpl(const InspectorInstrumentationCookie&amp; cookie)</span>
  {
      if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified">!         timelineAgent-&gt;didDispatchEvent();</span>
  }
  
  void InspectorInstrumentation::eventDidResetAfterDispatchImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)
  {
      if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
<span class="line-new-header">--- 414,37 ---</span>
  
  void InspectorInstrumentation::didHandleEventImpl(InstrumentingAgents&amp; instrumentingAgents)
  {
      if (InspectorDebuggerAgent* debuggerAgent = instrumentingAgents.inspectorDebuggerAgent())
          debuggerAgent-&gt;didDispatchAsyncCall();
<span class="line-added">+ </span>
<span class="line-added">+     if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())</span>
<span class="line-added">+         domDebuggerAgent-&gt;didHandleEvent();</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::didDispatchEventImpl(const InspectorInstrumentationCookie&amp; cookie, bool defaultPrevented)</span>
  {
      if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified">!         timelineAgent-&gt;didDispatchEvent(defaultPrevented);</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willDispatchEventOnWindowImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event, DOMWindow&amp; window)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent();</span>
      if (timelineAgent &amp;&amp; window.hasEventListeners(event.type())) {
          timelineAgent-&gt;willDispatchEvent(event, window.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
  
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didDispatchEventOnWindowImpl(const InspectorInstrumentationCookie&amp; cookie, bool defaultPrevented)</span>
  {
      if (InspectorTimelineAgent* timelineAgent = retrieveTimelineAgent(cookie))
<span class="line-modified">!         timelineAgent-&gt;didDispatchEvent(defaultPrevented);</span>
  }
  
  void InspectorInstrumentation::eventDidResetAfterDispatchImpl(InstrumentingAgents&amp; instrumentingAgents, const Event&amp; event)
  {
      if (auto* domAgent = instrumentingAgents.inspectorDOMAgent())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 442,11 ***</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; url, int lineNumber, int columnNumber)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willEvaluateScript(url, lineNumber, columnNumber, frame);
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
<span class="line-new-header">--- 452,11 ---</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willEvaluateScriptImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; url, int lineNumber, int columnNumber)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willEvaluateScript(url, lineNumber, columnNumber, frame);
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 464,11 ***</span>
  
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
          domDebuggerAgent-&gt;willFireTimer(oneShot);
  
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willFireTimer(timerId, frameForScriptExecutionContext(context));
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
<span class="line-new-header">--- 474,11 ---</span>
  
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
          domDebuggerAgent-&gt;willFireTimer(oneShot);
  
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willFireTimer(timerId, frameForScriptExecutionContext(context));
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 481,18 ***</span>
          timelineAgent-&gt;didFireTimer();
  }
  
  void InspectorInstrumentation::didInvalidateLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didInvalidateLayout(frame);
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willLayout(frame);
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
<span class="line-new-header">--- 491,18 ---</span>
          timelineAgent-&gt;didFireTimer();
  }
  
  void InspectorInstrumentation::didInvalidateLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didInvalidateLayout(frame);
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willLayoutImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willLayout(frame);
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 506,39 ***</span>
          pageAgent-&gt;didLayout();
  }
  
  void InspectorInstrumentation::willCompositeImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;willComposite(frame);
  }
  
  void InspectorInstrumentation::didCompositeImpl(InstrumentingAgents&amp; instrumentingAgents)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didComposite();
  }
  
  void InspectorInstrumentation::willPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;willPaint(renderer.frame());
  }
  
  void InspectorInstrumentation::didPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer, const LayoutRect&amp; rect)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didPaint(renderer, rect);
  
      if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
          pageAgent-&gt;didPaint(renderer, rect);
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willRecalculateStyle(document.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
      if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
          networkAgent-&gt;willRecalculateStyle();
<span class="line-new-header">--- 516,39 ---</span>
          pageAgent-&gt;didLayout();
  }
  
  void InspectorInstrumentation::willCompositeImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;willComposite(frame);
  }
  
  void InspectorInstrumentation::didCompositeImpl(InstrumentingAgents&amp; instrumentingAgents)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didComposite();
  }
  
  void InspectorInstrumentation::willPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;willPaint(renderer.frame());
  }
  
  void InspectorInstrumentation::didPaintImpl(InstrumentingAgents&amp; instrumentingAgents, RenderObject&amp; renderer, const LayoutRect&amp; rect)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didPaint(renderer, rect);
  
      if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
          pageAgent-&gt;didPaint(renderer, rect);
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willRecalculateStyleImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willRecalculateStyle(document.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
      if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
          networkAgent-&gt;willRecalculateStyle();
</pre>
<hr />
<pre>
<span class="line-old-header">*** 560,11 ***</span>
          pageAgent-&gt;didRecalculateStyle();
  }
  
  void InspectorInstrumentation::didScheduleStyleRecalculationImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didScheduleStyleRecalculation(document.frame());
      if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
          networkAgent-&gt;didScheduleStyleRecalculation(document);
  }
  
<span class="line-new-header">--- 570,11 ---</span>
          pageAgent-&gt;didRecalculateStyle();
  }
  
  void InspectorInstrumentation::didScheduleStyleRecalculationImpl(InstrumentingAgents&amp; instrumentingAgents, Document&amp; document)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didScheduleStyleRecalculation(document.frame());
      if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
          networkAgent-&gt;didScheduleStyleRecalculation(document);
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 601,10 ***</span>
<span class="line-new-header">--- 611,13 ---</span>
          networkAgent-&gt;didLoadResourceFromMemoryCache(loader, *cachedResource);
  }
  
  void InspectorInstrumentation::didReceiveResourceResponseImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceResponse&amp; response, ResourceLoader* resourceLoader)
  {
<span class="line-added">+     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
      if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
          networkAgent-&gt;didReceiveResponse(identifier, loader, response, resourceLoader);
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
          consoleAgent-&gt;didReceiveResponse(identifier, response); // This should come AFTER resource notification, front-end relies on this.
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 627,10 ***</span>
<span class="line-new-header">--- 640,13 ---</span>
          networkAgent-&gt;didFinishLoading(identifier, loader, networkLoadMetrics, resourceLoader);
  }
  
  void InspectorInstrumentation::didFailLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, unsigned long identifier, DocumentLoader* loader, const ResourceError&amp; error)
  {
<span class="line-added">+     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
      if (InspectorNetworkAgent* networkAgent = instrumentingAgents.inspectorNetworkAgent())
          networkAgent-&gt;didFailLoading(identifier, loader, error);
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
          consoleAgent-&gt;didFailLoading(identifier, error); // This should come AFTER resource notification, front-end relies on this.
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 710,12 ***</span>
              networkAgent-&gt;mainFrameNavigated(*loader);
  
          if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
              cssAgent-&gt;reset();
  
<span class="line-modified">!         if (InspectorDatabaseAgent* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-modified">!             databaseAgent-&gt;clearResources();</span>
  
          if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
              domAgent-&gt;setDocument(frame.document());
  
          if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
<span class="line-new-header">--- 726,12 ---</span>
              networkAgent-&gt;mainFrameNavigated(*loader);
  
          if (InspectorCSSAgent* cssAgent = instrumentingAgents.inspectorCSSAgent())
              cssAgent-&gt;reset();
  
<span class="line-modified">!         if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-modified">!             databaseAgent-&gt;didCommitLoad();</span>
  
          if (InspectorDOMAgent* domAgent = instrumentingAgents.inspectorDOMAgent())
              domAgent-&gt;setDocument(frame.document());
  
          if (InspectorLayerTreeAgent* layerTreeAgent = instrumentingAgents.inspectorLayerTreeAgent())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 736,11 ***</span>
  
      if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
          pageAgent-&gt;frameNavigated(frame);
  
      if (frame.isMainFrame()) {
<span class="line-modified">!         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
              timelineAgent-&gt;mainFrameNavigated();
      }
  }
  
  void InspectorInstrumentation::frameDocumentUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
<span class="line-new-header">--- 752,11 ---</span>
  
      if (InspectorPageAgent* pageAgent = instrumentingAgents.inspectorPageAgent())
          pageAgent-&gt;frameNavigated(frame);
  
      if (frame.isMainFrame()) {
<span class="line-modified">!         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
              timelineAgent-&gt;mainFrameNavigated();
      }
  }
  
  void InspectorInstrumentation::frameDocumentUpdatedImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
</pre>
<hr />
<pre>
<span class="line-old-header">*** 761,11 ***</span>
  void InspectorInstrumentation::frameStartedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
      if (frame.isMainFrame()) {
          if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
              pageDebuggerAgent-&gt;mainFrameStartedLoading();
<span class="line-modified">!         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.persistentInspectorTimelineAgent())</span>
              timelineAgent-&gt;mainFrameStartedLoading();
      }
  
      if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
          inspectorPageAgent-&gt;frameStartedLoading(frame);
<span class="line-new-header">--- 777,11 ---</span>
  void InspectorInstrumentation::frameStartedLoadingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame)
  {
      if (frame.isMainFrame()) {
          if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
              pageDebuggerAgent-&gt;mainFrameStartedLoading();
<span class="line-modified">!         if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
              timelineAgent-&gt;mainFrameStartedLoading();
      }
  
      if (InspectorPageAgent* inspectorPageAgent = instrumentingAgents.inspectorPageAgent())
          inspectorPageAgent-&gt;frameStartedLoading(frame);
</pre>
<hr />
<pre>
<span class="line-old-header">*** 817,10 ***</span>
<span class="line-new-header">--- 833,13 ---</span>
      return source == MessageSource::ConsoleAPI &amp;&amp; type == MessageType::Assert;
  }
  
  void InspectorInstrumentation::addMessageToConsoleImpl(InstrumentingAgents&amp; instrumentingAgents, std::unique_ptr&lt;ConsoleMessage&gt; message)
  {
<span class="line-added">+     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
      MessageSource source = message-&gt;source();
      MessageType type = message-&gt;type();
      String messageText = message-&gt;message();
  
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 830,83 ***</span>
          if (isConsoleAssertMessage(source, type))
              debuggerAgent-&gt;handleConsoleAssert(messageText);
      }
  }
  
<span class="line-modified">! void InspectorInstrumentation::consoleCountImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)</span>
  {
<span class="line-modified">!     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified">!         consoleAgent-&gt;count(state, WTFMove(arguments));</span>
  }
  
  void InspectorInstrumentation::takeHeapSnapshotImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)
  {
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
          consoleAgent-&gt;takeHeapSnapshot(title);
  }
  
<span class="line-modified">! void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; title)</span>
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
<span class="line-modified">!         timelineAgent-&gt;time(frame, title);</span>
<span class="line-modified">!     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified">!         consoleAgent-&gt;startTiming(title);</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)</span>
  {
<span class="line-modified">!     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified">!         consoleAgent-&gt;startTiming(title);</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, const String&amp; title, Ref&lt;ScriptCallStack&gt;&amp;&amp; stack)</span>
  {
<span class="line-modified">!     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified">!         consoleAgent-&gt;stopTiming(title, WTFMove(stack));</span>
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
<span class="line-modified">!         timelineAgent-&gt;timeEnd(frame, title);</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title, Ref&lt;ScriptCallStack&gt;&amp;&amp; stack)</span>
  {
<span class="line-modified">!     if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified">!         consoleAgent-&gt;stopTiming(title, WTFMove(stack));</span>
  }
  
  void InspectorInstrumentation::consoleTimeStampImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          String message;
          arguments-&gt;getFirstArgumentAsString(message);
          timelineAgent-&gt;didTimeStamp(frame, message);
       }
  }
  
  void InspectorInstrumentation::startProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.persistentInspectorTimelineAgent())</span>
          timelineAgent-&gt;startFromConsole(exec, title);
  }
  
  void InspectorInstrumentation::stopProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.persistentInspectorTimelineAgent())</span>
          timelineAgent-&gt;stopFromConsole(exec, title);
  }
  
  void InspectorInstrumentation::consoleStartRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, JSC::ExecState&amp; exec, JSC::JSObject* options)
  {
      if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
          canvasAgent-&gt;consoleStartRecordingCanvas(context, exec, options);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didOpenDatabaseImpl(InstrumentingAgents&amp; instrumentingAgents, RefPtr&lt;Database&gt;&amp;&amp; database, const String&amp; domain, const String&amp; name, const String&amp; version)</span>
  {
<span class="line-modified">!     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified">!         return;</span>
<span class="line-removed">-     if (InspectorDatabaseAgent* dbAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-removed">-         dbAgent-&gt;didOpenDatabase(WTFMove(database), domain, name, version);</span>
  }
  
  void InspectorInstrumentation::didDispatchDOMStorageEventImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; key, const String&amp; oldValue, const String&amp; newValue, StorageType storageType, SecurityOrigin* securityOrigin)
  {
      if (InspectorDOMStorageAgent* domStorageAgent = instrumentingAgents.inspectorDOMStorageAgent())
<span class="line-new-header">--- 849,108 ---</span>
          if (isConsoleAssertMessage(source, type))
              debuggerAgent-&gt;handleConsoleAssert(messageText);
      }
  }
  
<span class="line-modified">! void InspectorInstrumentation::consoleCountImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, const String&amp; label)</span>
  {
<span class="line-modified">!     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-modified">!         consoleAgent-&gt;count(state, label);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void InspectorInstrumentation::consoleCountResetImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* state, const String&amp; label)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added">+         consoleAgent-&gt;countReset(state, label);</span>
  }
  
  void InspectorInstrumentation::takeHeapSnapshotImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; title)
  {
      if (WebConsoleAgent* consoleAgent = instrumentingAgents.webConsoleAgent())
          consoleAgent-&gt;takeHeapSnapshot(title);
  }
  
<span class="line-modified">! void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::ExecState* exec, const String&amp; label)</span>
  {
<span class="line-modified">!     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified">!         return;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
<span class="line-added">+         timelineAgent-&gt;time(frame, label);</span>
<span class="line-added">+     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added">+         consoleAgent-&gt;startTiming(exec, label);</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::startConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label)</span>
  {
<span class="line-modified">!     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified">!         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added">+         consoleAgent-&gt;startTiming(exec, label);</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::logConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label, Ref&lt;Inspector::ScriptArguments&gt;&amp;&amp; arguments)</span>
  {
<span class="line-modified">!     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified">!         return;</span>
<span class="line-modified">! </span>
<span class="line-modified">!     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added">+         consoleAgent-&gt;logTiming(exec, label, WTFMove(arguments));</span>
  }
  
<span class="line-modified">! void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, JSC::ExecState* exec, const String&amp; label)</span>
  {
<span class="line-modified">!     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-modified">!         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added">+         consoleAgent-&gt;stopTiming(exec, label);</span>
<span class="line-added">+     if (auto* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
<span class="line-added">+         timelineAgent-&gt;timeEnd(frame, label);</span>
<span class="line-added">+ }</span>
<span class="line-added">+ </span>
<span class="line-added">+ void InspectorInstrumentation::stopConsoleTimingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; label)</span>
<span class="line-added">+ {</span>
<span class="line-added">+     if (!instrumentingAgents.inspectorEnvironment().developerExtrasEnabled())</span>
<span class="line-added">+         return;</span>
<span class="line-added">+ </span>
<span class="line-added">+     if (auto* consoleAgent = instrumentingAgents.webConsoleAgent())</span>
<span class="line-added">+         consoleAgent-&gt;stopTiming(exec, label);</span>
  }
  
  void InspectorInstrumentation::consoleTimeStampImpl(InstrumentingAgents&amp; instrumentingAgents, Frame&amp; frame, Ref&lt;ScriptArguments&gt;&amp;&amp; arguments)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          String message;
          arguments-&gt;getFirstArgumentAsString(message);
          timelineAgent-&gt;didTimeStamp(frame, message);
       }
  }
  
  void InspectorInstrumentation::startProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;startFromConsole(exec, title);
  }
  
  void InspectorInstrumentation::stopProfilingImpl(InstrumentingAgents&amp; instrumentingAgents, JSC::ExecState* exec, const String&amp; title)
  {
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;stopFromConsole(exec, title);
  }
  
  void InspectorInstrumentation::consoleStartRecordingCanvasImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; context, JSC::ExecState&amp; exec, JSC::JSObject* options)
  {
      if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
          canvasAgent-&gt;consoleStartRecordingCanvas(context, exec, options);
  }
  
<span class="line-modified">! void InspectorInstrumentation::didOpenDatabaseImpl(InstrumentingAgents&amp; instrumentingAgents, Database&amp; database)</span>
  {
<span class="line-modified">!     if (auto* databaseAgent = instrumentingAgents.inspectorDatabaseAgent())</span>
<span class="line-modified">!         databaseAgent-&gt;didOpenDatabase(database);</span>
  }
  
  void InspectorInstrumentation::didDispatchDOMStorageEventImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; key, const String&amp; oldValue, const String&amp; newValue, StorageType storageType, SecurityOrigin* securityOrigin)
  {
      if (InspectorDOMStorageAgent* domStorageAgent = instrumentingAgents.inspectorDOMStorageAgent())
</pre>
<hr />
<pre>
<span class="line-old-header">*** 990,11 ***</span>
  {
      if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
          canvasAgent-&gt;didChangeCanvasMemory(context);
  }
  
<span class="line-modified">! void InspectorInstrumentation::recordCanvasActionImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; canvasRenderingContext, const String&amp; name, Vector&lt;RecordCanvasActionVariant&gt;&amp;&amp; parameters)</span>
  {
      if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
          canvasAgent-&gt;recordCanvasAction(canvasRenderingContext, name, WTFMove(parameters));
  }
  
<span class="line-new-header">--- 1034,11 ---</span>
  {
      if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
          canvasAgent-&gt;didChangeCanvasMemory(context);
  }
  
<span class="line-modified">! void InspectorInstrumentation::recordCanvasActionImpl(InstrumentingAgents&amp; instrumentingAgents, CanvasRenderingContext&amp; canvasRenderingContext, const String&amp; name, std::initializer_list&lt;RecordCanvasActionVariant&gt;&amp;&amp; parameters)</span>
  {
      if (InspectorCanvasAgent* canvasAgent = instrumentingAgents.inspectorCanvasAgent())
          canvasAgent-&gt;recordCanvasAction(canvasRenderingContext, name, WTFMove(parameters));
  }
  
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1058,34 ***</span>
          applicationCacheAgent-&gt;updateApplicationCacheStatus(&amp;frame);
  }
  
  bool InspectorInstrumentation::consoleAgentEnabled(ScriptExecutionContext* scriptExecutionContext)
  {
<span class="line-modified">!     InstrumentingAgents* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext);</span>
<span class="line-modified">!     InspectorConsoleAgent* consoleAgent = instrumentingAgents ? instrumentingAgents-&gt;webConsoleAgent() : nullptr;</span>
<span class="line-modified">!     return consoleAgent &amp;&amp; consoleAgent-&gt;enabled();</span>
  }
  
<span class="line-modified">! bool InspectorInstrumentation::timelineAgentEnabled(ScriptExecutionContext* scriptExecutionContext)</span>
  {
<span class="line-modified">!     InstrumentingAgents* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext);</span>
<span class="line-modified">!     return instrumentingAgents &amp;&amp; instrumentingAgents-&gt;inspectorTimelineAgent();</span>
  }
  
  void InspectorInstrumentation::didRequestAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;didRequestAnimationFrame(callbackId, document);
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didRequestAnimationFrame(callbackId, document.frame());
  }
  
  void InspectorInstrumentation::didCancelAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;didCancelAnimationFrame(callbackId);
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent())</span>
          timelineAgent-&gt;didCancelAnimationFrame(callbackId, document.frame());
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
  {
<span class="line-new-header">--- 1102,39 ---</span>
          applicationCacheAgent-&gt;updateApplicationCacheStatus(&amp;frame);
  }
  
  bool InspectorInstrumentation::consoleAgentEnabled(ScriptExecutionContext* scriptExecutionContext)
  {
<span class="line-modified">!     FAST_RETURN_IF_NO_FRONTENDS(false);</span>
<span class="line-modified">!     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext)) {</span>
<span class="line-modified">!         if (auto* webConsoleAgent = instrumentingAgents-&gt;webConsoleAgent())</span>
<span class="line-added">+             return webConsoleAgent-&gt;enabled();</span>
<span class="line-added">+     }</span>
<span class="line-added">+     return false;</span>
  }
  
<span class="line-modified">! bool InspectorInstrumentation::timelineAgentTracking(ScriptExecutionContext* scriptExecutionContext)</span>
  {
<span class="line-modified">!     FAST_RETURN_IF_NO_FRONTENDS(false);</span>
<span class="line-modified">!     if (auto* instrumentingAgents = instrumentingAgentsForContext(scriptExecutionContext))</span>
<span class="line-added">+         return instrumentingAgents-&gt;trackingInspectorTimelineAgent();</span>
<span class="line-added">+     return false;</span>
  }
  
  void InspectorInstrumentation::didRequestAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;didRequestAnimationFrame(callbackId, document);
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didRequestAnimationFrame(callbackId, document.frame());
  }
  
  void InspectorInstrumentation::didCancelAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
  {
      if (PageDebuggerAgent* pageDebuggerAgent = instrumentingAgents.pageDebuggerAgent())
          pageDebuggerAgent-&gt;didCancelAnimationFrame(callbackId);
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent())</span>
          timelineAgent-&gt;didCancelAnimationFrame(callbackId, document.frame());
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willFireAnimationFrameImpl(InstrumentingAgents&amp; instrumentingAgents, int callbackId, Document&amp; document)
  {
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1094,11 ***</span>
  
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
          domDebuggerAgent-&gt;willFireAnimationFrame();
  
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willFireAnimationFrame(callbackId, document.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
<span class="line-new-header">--- 1143,11 ---</span>
  
      if (InspectorDOMDebuggerAgent* domDebuggerAgent = instrumentingAgents.inspectorDOMDebuggerAgent())
          domDebuggerAgent-&gt;willFireAnimationFrame();
  
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willFireAnimationFrame(callbackId, document.frame());
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1112,11 ***</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; callbackType, ScriptExecutionContext&amp; context)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.inspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willFireObserverCallback(callbackType, frameForScriptExecutionContext(&amp;context));
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
<span class="line-new-header">--- 1161,11 ---</span>
  }
  
  InspectorInstrumentationCookie InspectorInstrumentation::willFireObserverCallbackImpl(InstrumentingAgents&amp; instrumentingAgents, const String&amp; callbackType, ScriptExecutionContext&amp; context)
  {
      int timelineAgentId = 0;
<span class="line-modified">!     if (InspectorTimelineAgent* timelineAgent = instrumentingAgents.trackingInspectorTimelineAgent()) {</span>
          timelineAgent-&gt;willFireObserverCallback(callbackType, frameForScriptExecutionContext(&amp;context));
          timelineAgentId = timelineAgent-&gt;id();
      }
      return InspectorInstrumentationCookie(instrumentingAgents, timelineAgentId);
  }
</pre>
<hr />
<pre>
<span class="line-old-header">*** 1150,11 ***</span>
  InspectorTimelineAgent* InspectorInstrumentation::retrieveTimelineAgent(const InspectorInstrumentationCookie&amp; cookie)
  {
      if (!cookie.isValid())
          return nullptr;
  
<span class="line-modified">!     InspectorTimelineAgent* timelineAgent = cookie.instrumentingAgents()-&gt;inspectorTimelineAgent();</span>
      if (timelineAgent &amp;&amp; cookie.hasMatchingTimelineAgentId(timelineAgent-&gt;id()))
          return timelineAgent;
      return nullptr;
  }
  
<span class="line-new-header">--- 1199,11 ---</span>
  InspectorTimelineAgent* InspectorInstrumentation::retrieveTimelineAgent(const InspectorInstrumentationCookie&amp; cookie)
  {
      if (!cookie.isValid())
          return nullptr;
  
<span class="line-modified">!     InspectorTimelineAgent* timelineAgent = cookie.instrumentingAgents()-&gt;trackingInspectorTimelineAgent();</span>
      if (timelineAgent &amp;&amp; cookie.hasMatchingTimelineAgentId(timelineAgent-&gt;id()))
          return timelineAgent;
      return nullptr;
  }
  
</pre>
<center><a href="InspectorHistory.cpp.cdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../index.html" target="_top">index</a> <a href="InspectorInstrumentation.h.cdiff.html" target="_top">next &gt;</a></center>  </body>
</html>