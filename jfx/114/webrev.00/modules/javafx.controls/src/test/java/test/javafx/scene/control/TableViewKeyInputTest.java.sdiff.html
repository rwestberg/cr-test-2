<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff modules/javafx.controls/src/test/java/test/javafx/scene/control/TableViewKeyInputTest.java</title>
    <link rel="stylesheet" href="../../../../../../../../../style.css" />
  </head>
<body>
<center><a href="../../../../../../main/java/com/sun/javafx/scene/control/behavior/TableViewBehaviorBase.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>    <h2>modules/javafx.controls/src/test/java/test/javafx/scene/control/TableViewKeyInputTest.java</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2011, 2019, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import com.sun.javafx.scene.control.behavior.TableCellBehavior;
  29 import javafx.beans.property.ReadOnlyStringWrapper;
  30 import javafx.collections.FXCollections;
  31 import javafx.collections.ListChangeListener;
  32 import javafx.collections.ObservableList;
  33 import javafx.scene.Group;
  34 import javafx.scene.control.Button;
  35 import javafx.scene.input.KeyCode;
  36 import javafx.scene.layout.HBox;
  37 


  38 import java.util.List;
  39 import java.util.function.Function;
  40 
  41 import com.sun.javafx.PlatformUtil;
  42 import com.sun.javafx.util.Utils;
  43 import test.com.sun.javafx.scene.control.behavior.TableViewAnchorRetriever;
  44 import test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils;
  45 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  46 import test.com.sun.javafx.scene.control.infrastructure.KeyModifier;
  47 import test.com.sun.javafx.scene.control.infrastructure.StageLoader;
  48 import test.com.sun.javafx.scene.control.infrastructure.VirtualFlowTestUtils;
  49 import com.sun.javafx.tk.Toolkit;
  50 import javafx.scene.control.FocusModel;
  51 import javafx.scene.control.MultipleSelectionModel;
  52 import javafx.scene.control.SelectionMode;
  53 import javafx.scene.control.TableCell;
  54 import javafx.scene.control.TableCellShim;
  55 import javafx.scene.control.TableColumn;
  56 import javafx.scene.control.TableFocusModel;
  57 import javafx.scene.control.TablePosition;
  58 import javafx.scene.control.TableSelectionModel;
  59 import javafx.scene.control.TableView;

  60 import org.junit.After;
  61 import org.junit.Before;
  62 import org.junit.Ignore;
  63 import org.junit.Test;



  64 import static org.junit.Assert.assertEquals;
  65 import static org.junit.Assert.assertFalse;
  66 import static org.junit.Assert.assertNotSame;
  67 import static org.junit.Assert.assertNull;
  68 import static org.junit.Assert.assertTrue;

  69 import static org.junit.Assert.fail;
  70 

  71 public class TableViewKeyInputTest {







  72     private TableView&lt;String&gt; tableView;
  73 //    private TableSelectionModel&lt;String&gt; sm;
  74     private TableView.TableViewSelectionModel&lt;String&gt; sm;
  75     private TableView.TableViewFocusModel&lt;String&gt; fm;
  76 
  77     private KeyEventFirer keyboard;
  78 
  79     private StageLoader stageLoader;
  80 
  81     private TableColumn&lt;String, String&gt; col0;
  82     private TableColumn&lt;String, String&gt; col1;
  83     private TableColumn&lt;String, String&gt; col2;
  84     private TableColumn&lt;String, String&gt; col3;
  85     private TableColumn&lt;String, String&gt; col4;
  86 






  87     @Before public void setup() {
  88         tableView = new TableView&lt;String&gt;();

  89         sm = tableView.getSelectionModel();
  90         fm = tableView.getFocusModel();
  91 
  92         sm.setSelectionMode(SelectionMode.MULTIPLE);
  93         sm.setCellSelectionEnabled(false);
  94 
  95         tableView.getItems().setAll(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;);
  96 
  97         col0 = new TableColumn&lt;String, String&gt;(&quot;col0&quot;);
  98         col1 = new TableColumn&lt;String, String&gt;(&quot;col1&quot;);
  99         col2 = new TableColumn&lt;String, String&gt;(&quot;col2&quot;);
 100         col3 = new TableColumn&lt;String, String&gt;(&quot;col3&quot;);
 101         col4 = new TableColumn&lt;String, String&gt;(&quot;col4&quot;);
 102         tableView.getColumns().setAll(col0, col1, col2, col3, col4);
 103 
 104         keyboard = new KeyEventFirer(tableView);
 105 
 106         stageLoader = new StageLoader(tableView);
 107         stageLoader.getStage().show();
 108     }
</pre>
<hr />
<pre>
1092 
1093         keyboard.doUpArrowPress(KeyModifier.getShortcutKey());
1094         keyboard.doKeyPress(KeyCode.SPACE,
1095                 KeyModifier.getShortcutKey(),
1096                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1097         assertTrue(isSelected(1,2,3,4));
1098         assertTrue(isAnchor(0));
1099         assertTrue(fm.isFocused(0));
1100     }
1101 
1102 
1103     /***************************************************************************
1104      * Tests for discontinuous multiple cell selection (RT-18951)
1105      **************************************************************************/
1106 
1107     // Test 1
1108     @Test public void test_rt18591_cell_1() {
1109         sm.setSelectionMode(SelectionMode.MULTIPLE);
1110         sm.setCellSelectionEnabled(true);
1111         sm.select(0, col0);
<span class="line-modified">1112         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">1113         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>






1114         keyboard.doKeyPress(KeyCode.SPACE,
1115                 KeyModifier.getShortcutKey(),
1116                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1117         assertTrue(sm.isSelected(0,col0));
1118         assertTrue(sm.isSelected(0,col2));
1119         assertTrue(isAnchor(0,2));
1120 
<span class="line-modified">1121         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1122         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>





1123         assertTrue(sm.isSelected(0,col0));
1124         assertTrue(sm.isSelected(0,col2));
1125         assertTrue(sm.isSelected(0,col3));
1126         assertTrue(sm.isSelected(0,col4));
1127         assertTrue(isAnchor(0,2));
1128     }
1129 
1130     // Test 2
1131     @Test public void test_rt18591_cell_2() {
1132         sm.setSelectionMode(SelectionMode.MULTIPLE);
1133         sm.setCellSelectionEnabled(true);
1134         sm.select(0, col4);
<span class="line-modified">1135         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">1136         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>





1137         keyboard.doKeyPress(KeyCode.SPACE,
1138                 KeyModifier.getShortcutKey(),
1139                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1140         assertTrue(sm.isSelected(0,col4));
1141         assertTrue(sm.isSelected(0,col2));
1142         assertTrue(isAnchor(0,2));
1143 
<span class="line-modified">1144         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1145         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>





1146         assertTrue(sm.isSelected(0,col0));
1147         assertTrue(sm.isSelected(0,col1));
1148         assertTrue(sm.isSelected(0,col2));
1149         assertTrue(sm.isSelected(0,col4));
1150         assertTrue(isAnchor(0,2));
1151     }
1152 
1153     // Test 3
1154     @Test public void test_rt18591_cell_3() {
1155         sm.setSelectionMode(SelectionMode.MULTIPLE);
1156         sm.setCellSelectionEnabled(true);
1157         sm.select(0, col0);
<span class="line-modified">1158         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">1159         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>





1160         keyboard.doKeyPress(KeyCode.SPACE,
1161                 KeyModifier.getShortcutKey(),
1162                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1163         assertTrue(sm.isSelected(0,col0));
1164         assertTrue(sm.isSelected(0,col2));
1165         assertTrue(isAnchor(0,2));
1166 
<span class="line-modified">1167         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1168         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>





1169         assertTrue(sm.isSelected(0,col0));
1170         assertTrue(sm.isSelected(0,col2));
1171         assertTrue(sm.isSelected(0,col3));
1172         assertTrue(sm.isSelected(0,col4));
1173         assertTrue(isAnchor(0,2));
1174 
<span class="line-modified">1175         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1176         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1177         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>






1178         assertTrue(sm.isSelected(0,col0));
1179         assertTrue(sm.isSelected(0,col1));
1180         assertTrue(sm.isSelected(0,col2));
1181         assertTrue(sm.isSelected(0,col3));
1182         assertTrue(sm.isSelected(0,col4));
1183         assertTrue(isAnchor(0,2));
1184     }
1185 
1186     // Test 4
1187     @Test public void test_rt18591_cell_4() {
1188         sm.setSelectionMode(SelectionMode.MULTIPLE);
1189         sm.setCellSelectionEnabled(true);
1190         sm.select(0, col4);
<span class="line-modified">1191         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">1192         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>






1193         keyboard.doKeyPress(KeyCode.SPACE,
1194                 KeyModifier.getShortcutKey(),
1195                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1196         assertTrue(sm.isSelected(0,col4));
1197         assertTrue(sm.isSelected(0,col2));
1198         assertTrue(isAnchor(0,2));
1199 
<span class="line-modified">1200         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1201         keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>





1202         assertTrue(sm.isSelected(0,col0));
1203         assertTrue(sm.isSelected(0,col1));
1204         assertTrue(sm.isSelected(0,col2));
1205         assertTrue(sm.isSelected(0,col4));
1206         assertTrue(isAnchor(0,2));
1207 
<span class="line-modified">1208         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1209         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1210         keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>






1211         assertTrue(sm.isSelected(0,col0));
1212         assertTrue(sm.isSelected(0,col1));
1213         assertTrue(sm.isSelected(0,col2));
1214         assertTrue(sm.isSelected(0,col3));
1215         assertTrue(sm.isSelected(0,col4));
1216         assertTrue(isAnchor(0,2));
1217     }
1218 
1219     // Test 5
1220     @Test public void test_rt18591_cell_5() {
1221         sm.setSelectionMode(SelectionMode.MULTIPLE);
1222         sm.setCellSelectionEnabled(true);
1223         sm.select(0, col1);
1224         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());
1225         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());
1226         keyboard.doKeyPress(KeyCode.SPACE,
1227                 KeyModifier.getShortcutKey(),
1228                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1229         assertTrue(sm.isSelected(0,col1));
1230         assertTrue(sm.isSelected(2,col1));
</pre>
<hr />
<pre>
1466 //        assertTrue(sm.isSelected(3,col3));
1467 //        assertTrue(sm.isSelected(3,col4));
1468 //        assertTrue(sm.isSelected(4,col3));
1469 //        assertTrue(sm.isSelected(5,col3));
1470 //        assertTrue(isAnchor(3,3));
1471 //    }
1472 
1473 
1474     /***************************************************************************
1475      * Tests for specific bug reports
1476      **************************************************************************/
1477 
1478     @Test public void test_rt18488_selectToLeft() {
1479         sm.setCellSelectionEnabled(true);
1480         sm.clearAndSelect(1, col4);
1481 
1482         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col4)
1483         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col3)
1484         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col2)
1485         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col1)
<span class="line-modified">1486         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1487         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1488         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1489         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1490         assertTrue(sm.isSelected(1, col0));</span>









1491 
1492         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // deselect (1, col1)
<span class="line-modified">1493         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1494         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1495         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1496         assertTrue(debug(), sm.isSelected(1, col1));</span>
<span class="line-modified">1497         assertFalse(sm.isSelected(1, col0));</span>






1498     }
1499 
1500     @Test public void test_rt18488_selectToRight() {
1501         sm.setCellSelectionEnabled(true);
1502         sm.clearAndSelect(1, col0);
1503 
1504         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col2)
1505         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col3)
1506         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col4)
1507         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col5)
<span class="line-modified">1508         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1509         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1510         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1511         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1512         assertTrue(sm.isSelected(1, col0));</span>









1513 
1514         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // deselect (1, col5)
<span class="line-modified">1515         assertFalse(sm.isSelected(1, col4));</span>
<span class="line-modified">1516         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1517         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1518         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1519         assertTrue(sm.isSelected(1, col0));</span>









1520     }
1521 
1522     @Test public void test_rt18488_comment1() {
1523         sm.setCellSelectionEnabled(true);
1524         sm.clearAndSelect(1, col0);
1525 
1526         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col2)
1527         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col3)
1528         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col4)
1529         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col5)
1530         keyboard.doDownArrowPress(KeyModifier.SHIFT);    // select (2, col5)
1531 
<span class="line-modified">1532         assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">1533         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1534         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1535         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1536         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1537         assertTrue(sm.isSelected(1, col0));</span>









1538 
1539         keyboard.doUpArrowPress(KeyModifier.SHIFT);     // deselect (2, col5)
<span class="line-modified">1540         assertFalse(sm.isSelected(2, col4));</span>
<span class="line-modified">1541         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1542         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1543         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1544         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1545         assertTrue(sm.isSelected(1, col0));</span>










1546     }
1547 
1548     @Test public void test_rt18536_positive_horizontal() {
<span class="line-modified">1549         // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-modified">1550         sm.setCellSelectionEnabled(true);</span>
<span class="line-modified">1551         sm.clearAndSelect(1, col0);</span>
<span class="line-modified">1552 </span>
<span class="line-modified">1553         // move focus by holding down ctrl button</span>
<span class="line-modified">1554         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-modified">1555         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-modified">1556         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col4)</span>
<span class="line-modified">1557         keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col5)</span>
<span class="line-modified">1558         assertTrue(fm.isFocused(1, col4));</span>
<span class="line-modified">1559 </span>
<span class="line-modified">1560         // press shift + space to select all cells between (1, col1) and (1, col5)</span>
<span class="line-modified">1561         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-modified">1562         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1563         assertTrue(debug(), sm.isSelected(1, col3));</span>
<span class="line-modified">1564         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1565         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1566         assertTrue(sm.isSelected(1, col0));</span>





















1567     }
1568 
1569     @Test public void test_rt18536_negative_horizontal() {
<span class="line-removed">1570         // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-removed">1571         sm.setCellSelectionEnabled(true);</span>
<span class="line-removed">1572         sm.clearAndSelect(1, col4);</span>
<span class="line-removed">1573 </span>
<span class="line-removed">1574         // move focus by holding down ctrl button</span>
<span class="line-removed">1575         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col4)</span>
<span class="line-removed">1576         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-removed">1577         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-removed">1578         keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col1)</span>
<span class="line-removed">1579         assertTrue(fm.isFocused(1, col0));</span>
1580 
<span class="line-modified">1581         // press shift + space to select all cells between (1, col1) and (1, col5)</span>
<span class="line-modified">1582         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-modified">1583         assertTrue(debug(), sm.isSelected(1, col4));</span>
<span class="line-modified">1584         assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1585         assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1586         assertTrue(sm.isSelected(1, col1));</span>
<span class="line-modified">1587         assertTrue(sm.isSelected(1, col0));</span>
































1588     }
1589 
1590     //
1591     @Test public void test_rt18536_positive_vertical() {
1592         // Test shift selection when focus is elsewhere (so as to select a range)
1593         sm.setCellSelectionEnabled(true);
1594         sm.clearAndSelect(1, col4);
1595 
1596         // move focus by holding down ctrl button
1597         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (2, col5)
1598         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (3, col5)
1599         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (4, col5)
1600         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (5, col5)
1601         assertTrue(fm.isFocused(5, col4));
1602 
1603         // press shift + space to select all cells between (1, col5) and (5, col5)
1604         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
1605         assertTrue(sm.isSelected(1, col4));
1606         assertTrue(sm.isSelected(2, col4));
1607         assertTrue(sm.isSelected(3, col4));
</pre>
<hr />
<pre>
2615         assertEquals(3, fm.getFocusedIndex());
2616         assertEquals(6, sm.getSelectedIndex());
2617 
2618         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2619         Toolkit.getToolkit().firePulse();
2620         assertEquals(6, getAnchor().getRow());
2621         assertEquals(0, getAnchor().getColumn());
2622         assertEquals(3, fm.getFocusedIndex());
2623         assertEquals(3, sm.getSelectedIndex());
2624     }
2625 
2626     @Test public void test_rt33613_up_multipleColumn_right() {
2627         final int items = 10;
2628         tableView.getItems().clear();
2629         for (int i = 0; i &lt; items; i++) {
2630             tableView.getItems().add(&quot;Row &quot; + i);
2631         }
2632 
2633         sm.setCellSelectionEnabled(true);
2634 
<span class="line-modified">2635         sm.clearAndSelect(6, col0);</span>
2636         assertEquals(6, getAnchor().getRow());
<span class="line-modified">2637         assertEquals(0, getAnchor().getColumn());</span>
<span class="line-modified">2638         assertTrue(fm.isFocused(6, col0));</span>
<span class="line-modified">2639         assertTrue(sm.isSelected(6, col0));</span>
2640 
2641         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2642         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2643         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2644         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.getShortcutKey());
2645         Toolkit.getToolkit().firePulse();
2646         assertEquals(6, getAnchor().getRow());
<span class="line-modified">2647         assertEquals(0, getAnchor().getColumn());</span>
<span class="line-modified">2648         assertTrue(fm.isFocused(3, col1));</span>
<span class="line-modified">2649         assertTrue(sm.isSelected(6, col0));</span>
<span class="line-modified">2650         assertFalse(sm.isSelected(3, col1));</span>







2651 
2652         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2653         Toolkit.getToolkit().firePulse();
2654         assertEquals(6, getAnchor().getRow());
<span class="line-modified">2655         assertEquals(0, getAnchor().getColumn());</span>
<span class="line-modified">2656         assertTrue(fm.isFocused(3, col1));</span>
<span class="line-modified">2657         assertTrue(sm.isSelected(3, col1));</span>
<span class="line-modified">2658         assertTrue(sm.isSelected(6, col0));</span>







2659     }
2660 
2661     @Test public void test_rt33613_up_multipleColumn_left() {
2662         final int items = 10;
2663         tableView.getItems().clear();
2664         for (int i = 0; i &lt; items; i++) {
2665             tableView.getItems().add(&quot;Row &quot; + i);
2666         }
2667 
2668         sm.setCellSelectionEnabled(true);
2669 
2670         sm.clearAndSelect(6, col1);
2671         assertEquals(6, getAnchor().getRow());
2672         assertEquals(1, getAnchor().getColumn());
2673         assertTrue(fm.isFocused(6, col1));
2674         assertTrue(sm.isSelected(6, col1));
2675 
2676         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2677         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2678         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2679         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.getShortcutKey());
2680         Toolkit.getToolkit().firePulse();
2681         assertEquals(6, getAnchor().getRow());
2682         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2683         assertTrue(fm.isFocused(3, col0));</span>
<span class="line-modified">2684         assertTrue(sm.isSelected(6, col1));</span>
<span class="line-modified">2685         assertFalse(sm.isSelected(3, col0));</span>







2686 
2687         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2688         Toolkit.getToolkit().firePulse();
2689         assertEquals(6, getAnchor().getRow());
2690         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2691         assertTrue(fm.isFocused(3, col0));</span>
<span class="line-modified">2692         assertTrue(sm.isSelected(3, col0));</span>
<span class="line-modified">2693         assertTrue(sm.isSelected(6, col1));</span>







2694     }
2695 
2696     @Test public void test_rt33613_down_oneColumn() {
2697         final int items = 10;
2698         tableView.getItems().clear();
2699         for (int i = 0; i &lt; items; i++) {
2700             tableView.getItems().add(&quot;Row &quot; + i);
2701         }
2702 
2703         sm.setCellSelectionEnabled(true);
2704 
2705         sm.clearAndSelect(3, col0);
2706         assertEquals(3, getAnchor().getRow());
2707         assertEquals(0, getAnchor().getColumn());
2708         assertEquals(3, fm.getFocusedIndex());
2709         assertEquals(3, sm.getSelectedIndex());
2710 
2711         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2712         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2713         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
</pre>
<hr />
<pre>
2717         assertEquals(6, fm.getFocusedIndex());
2718         assertEquals(3, sm.getSelectedIndex());
2719 
2720         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2721         Toolkit.getToolkit().firePulse();
2722         assertEquals(3, getAnchor().getRow());
2723         assertEquals(0, getAnchor().getColumn());
2724         assertEquals(6, fm.getFocusedIndex());
2725         assertEquals(6, sm.getSelectedIndex());
2726     }
2727 
2728     @Test public void test_rt33613_down_multipleColumn_right() {
2729         final int items = 10;
2730         tableView.getItems().clear();
2731         for (int i = 0; i &lt; items; i++) {
2732             tableView.getItems().add(&quot;Row &quot; + i);
2733         }
2734 
2735         sm.setCellSelectionEnabled(true);
2736 
<span class="line-modified">2737         sm.clearAndSelect(3, col0);</span>
2738         assertEquals(3, getAnchor().getRow());
<span class="line-modified">2739         assertEquals(0, getAnchor().getColumn());</span>
<span class="line-modified">2740         assertTrue(fm.isFocused(3, col0));</span>
<span class="line-modified">2741         assertTrue(sm.isSelected(3, col0));</span>
2742 
2743         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2744         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2745         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2746         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.getShortcutKey());
2747         Toolkit.getToolkit().firePulse();
2748         assertEquals(3, getAnchor().getRow());
<span class="line-modified">2749         assertEquals(0, getAnchor().getColumn());</span>
<span class="line-modified">2750         assertTrue(fm.isFocused(6, col1));</span>
<span class="line-modified">2751         assertTrue(sm.isSelected(3, col0));</span>
<span class="line-modified">2752         assertFalse(sm.isSelected(6, col1));</span>







2753 
2754         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2755         Toolkit.getToolkit().firePulse();
2756         assertEquals(3, getAnchor().getRow());
<span class="line-modified">2757         assertEquals(0, getAnchor().getColumn());</span>
<span class="line-modified">2758         assertTrue(fm.isFocused(6, col1));</span>
<span class="line-modified">2759         assertTrue(sm.isSelected(6, col1));</span>
<span class="line-modified">2760         assertTrue(sm.isSelected(3, col0));</span>







2761     }
2762 
2763     @Test public void test_rt33613_down_multipleColumn_left() {
2764         final int items = 10;
2765         tableView.getItems().clear();
2766         for (int i = 0; i &lt; items; i++) {
2767             tableView.getItems().add(&quot;Row &quot; + i);
2768         }
2769 
2770         sm.setCellSelectionEnabled(true);
2771 
2772         sm.clearAndSelect(3, col1);
2773         assertEquals(3, getAnchor().getRow());
2774         assertEquals(1, getAnchor().getColumn());
2775         assertTrue(fm.isFocused(3, col1));
2776         assertTrue(sm.isSelected(3, col1));
2777 
2778         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2779         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2780         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2781         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.getShortcutKey());
2782         assertEquals(3, getAnchor().getRow());
2783         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2784         assertTrue(fm.isFocused(6, col0));</span>
<span class="line-modified">2785         assertTrue(sm.isSelected(3, col1));</span>
<span class="line-modified">2786         assertFalse(sm.isSelected(6, col0));</span>







2787 
2788         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2789         assertEquals(3, getAnchor().getRow());
2790         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2791         assertTrue(fm.isFocused(6, col0));</span>
<span class="line-modified">2792         assertTrue(sm.isSelected(6, col0));</span>
<span class="line-modified">2793         assertTrue(sm.isSelected(3, col1));</span>







2794     }
2795 
2796     @Test public void test_rt18439() {

2797         final int items = 10;
2798         tableView.getItems().clear();
2799         for (int i = 0; i &lt; items; i++) {
2800             tableView.getItems().add(&quot;Row &quot; + i);
2801         }
2802 
2803         sm.setCellSelectionEnabled(true);
2804         sm.setSelectionMode(SelectionMode.MULTIPLE);
2805 
<span class="line-modified">2806         sm.clearAndSelect(0, col0);</span>

2807 
<span class="line-modified">2808         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">2809         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">2810         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">2811         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>
<span class="line-modified">2812         assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">2813         assertEquals(0, getAnchor().getColumn());              // anchor does not move</span>
<span class="line-modified">2814         assertTrue(fm.isFocused(0, col4));</span>
<span class="line-modified">2815         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">2816         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">2817         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">2818         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">2819         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">2820 </span>
<span class="line-modified">2821         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1</span>
<span class="line-modified">2822         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2</span>
<span class="line-modified">2823         assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">2824         assertEquals(0, getAnchor().getColumn());             // anchor does not move</span>
<span class="line-modified">2825         assertTrue(fm.isFocused(2, col4));</span>
<span class="line-modified">2826         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">2827         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">2828         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">2829         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">2830         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">2831         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">2832         assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">2833 </span>
<span class="line-modified">2834         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">2835         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">2836         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">2837         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-modified">2838         assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">2839         assertEquals(0, getAnchor().getColumn());             // anchor does not move</span>
<span class="line-modified">2840         assertTrue(fm.isFocused(2, col0));</span>
<span class="line-modified">2841         assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">2842         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">2843         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">2844         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">2845         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">2846         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">2847         assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">2848         assertTrue(sm.isSelected(2, col3));</span>
<span class="line-modified">2849         assertTrue(sm.isSelected(2, col2));</span>
<span class="line-modified">2850         assertTrue(sm.isSelected(2, col1));</span>
<span class="line-modified">2851         assertTrue(sm.isSelected(2, col0));</span>





















2852 
<span class="line-modified">2853         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 1</span>
<span class="line-modified">2854         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 0</span>
<span class="line-modified">2855         assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">2856         assertEquals(0, getAnchor().getColumn());           // anchor does not move</span>
<span class="line-modified">2857         assertTrue(fm.isFocused(0, col0));</span>
<span class="line-modified">2858         assertFalse(sm.isSelected(0, col0));                // we&#39;ve gone right around - this cell is now unselected</span>
<span class="line-modified">2859         assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">2860         assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">2861         assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">2862         assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">2863         assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">2864         assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">2865         assertTrue(sm.isSelected(2, col3));</span>
<span class="line-modified">2866         assertTrue(sm.isSelected(2, col2));</span>
<span class="line-modified">2867         assertTrue(sm.isSelected(2, col1));</span>
<span class="line-modified">2868         assertTrue(sm.isSelected(2, col0));</span>
<span class="line-modified">2869         assertTrue(sm.isSelected(1, col0));</span>














































2870     }
2871 
2872     // this is an extension of the previous test, where we had a bug where going up resulted in all cells between the
2873     // anchor (at (0,0)) and the first selected cell in column 0 were being selected. This wasn&#39;t visible in the previous
2874     // test as we only went down two rows, so when we went up everything looked as expected
2875     @Test public void test_rt18439_startAt_row0_col0_clockwise() {
2876         final int items = 10;
2877         tableView.getItems().clear();
2878         for (int i = 0; i &lt; items; i++) {
2879             tableView.getItems().add(&quot;Row &quot; + i);
2880         }
2881 
2882         sm.setCellSelectionEnabled(true);
2883         sm.setSelectionMode(SelectionMode.MULTIPLE);
2884 
2885         sm.clearAndSelect(0, col0);
2886 
<span class="line-modified">2887         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">2888         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">2889         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">2890         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>







2891 
2892         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
2893         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2
2894         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 3
2895         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 4
2896 
<span class="line-modified">2897         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">2898         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">2899         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">2900         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-modified">2901 </span>






2902         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 3
2903         assertEquals(0, getAnchor().getRow());
2904         assertEquals(0, getAnchor().getColumn());           // anchor does not move
2905         assertTrue(fm.isFocused(3, col0));
2906         assertTrue(sm.isSelected(0, col0));
2907         assertTrue(sm.isSelected(0, col1));
2908         assertTrue(sm.isSelected(0, col2));
2909         assertTrue(sm.isSelected(0, col3));
2910         assertTrue(sm.isSelected(0, col4));
2911         assertTrue(sm.isSelected(1, col4));
2912         assertTrue(sm.isSelected(2, col4));
2913         assertTrue(sm.isSelected(3, col4));
2914         assertTrue(sm.isSelected(4, col4));
2915         assertTrue(sm.isSelected(4, col3));
2916         assertTrue(sm.isSelected(4, col2));
2917         assertTrue(sm.isSelected(4, col1));
2918         assertTrue(sm.isSelected(4, col0));
2919         assertTrue(sm.isSelected(3, col0));
2920 
2921         // critical part - these cells should not be selected!
</pre>
<hr />
<pre>
2923         assertFalse(sm.isSelected(2, col0));
2924     }
2925 
2926     @Test public void test_rt18439_startAt_row0_col4_clockwise() {
2927         final int items = 10;
2928         tableView.getItems().clear();
2929         for (int i = 0; i &lt; items; i++) {
2930             tableView.getItems().add(&quot;Row &quot; + i);
2931         }
2932 
2933         sm.setCellSelectionEnabled(true);
2934         sm.setSelectionMode(SelectionMode.MULTIPLE);
2935 
2936         sm.clearAndSelect(0, col4);
2937 
2938         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
2939         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2
2940         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 3
2941         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 4
2942 
<span class="line-modified">2943         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">2944         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">2945         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">2946         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>







2947 
2948         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 3
2949         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 2
2950         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 1
2951         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 0
2952 
<span class="line-modified">2953         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>




2954         assertEquals(0, getAnchor().getRow());
2955         assertEquals(4, getAnchor().getColumn());           // anchor does not move
2956         assertTrue(fm.isFocused(0, col1));
2957         assertTrue(sm.isSelected(0, col4));
2958         assertTrue(sm.isSelected(1, col4));
2959         assertTrue(sm.isSelected(2, col4));
2960         assertTrue(sm.isSelected(3, col4));
2961         assertTrue(sm.isSelected(4, col4));
2962         assertTrue(sm.isSelected(4, col3));
2963         assertTrue(sm.isSelected(4, col2));
2964         assertTrue(sm.isSelected(4, col1));
2965         assertTrue(sm.isSelected(4, col0));
2966         assertTrue(sm.isSelected(3, col0));
2967         assertTrue(sm.isSelected(2, col0));
2968         assertTrue(sm.isSelected(1, col0));
2969         assertTrue(sm.isSelected(0, col0));
2970         assertTrue(sm.isSelected(0, col1));
2971 
2972         // critical part - these cells should not be selected!
2973         assertFalse(sm.isSelected(0, col2));
2974         assertFalse(sm.isSelected(0, col3));
2975     }
2976 
2977     @Test public void test_rt18439_startAt_row4_col4_clockwise() {
2978         final int items = 10;
2979         tableView.getItems().clear();
2980         for (int i = 0; i &lt; items; i++) {
2981             tableView.getItems().add(&quot;Row &quot; + i);
2982         }
2983 
2984         sm.setCellSelectionEnabled(true);
2985         sm.setSelectionMode(SelectionMode.MULTIPLE);
2986 
2987         sm.clearAndSelect(4, col4);
2988 
<span class="line-modified">2989         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">2990         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">2991         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">2992         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>







2993 
2994         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 3
2995         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 2
2996         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 1
2997         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 0
2998 
<span class="line-modified">2999         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3000         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3001         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3002         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>







3003 
3004         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
3005         assertEquals(4, getAnchor().getRow());
3006         assertEquals(4, getAnchor().getColumn());           // anchor does not move
3007         assertTrue(fm.isFocused(1, col4));
3008         assertTrue(sm.isSelected(4, col4));
3009         assertTrue(sm.isSelected(4, col2));
3010         assertTrue(sm.isSelected(4, col2));
3011         assertTrue(sm.isSelected(4, col1));
3012         assertTrue(sm.isSelected(4, col0));
3013         assertTrue(sm.isSelected(3, col0));
3014         assertTrue(sm.isSelected(2, col0));
3015         assertTrue(sm.isSelected(1, col0));
3016         assertTrue(sm.isSelected(0, col0));
3017         assertTrue(sm.isSelected(0, col1));
3018         assertTrue(sm.isSelected(0, col2));
3019         assertTrue(sm.isSelected(0, col3));
3020         assertTrue(sm.isSelected(0, col4));
3021         assertTrue(sm.isSelected(1, col4));
3022 
</pre>
<hr />
<pre>
3025         assertFalse(sm.isSelected(3, col4));
3026     }
3027 
3028     @Test public void test_rt18439_startAt_row4_col0_clockwise() {
3029         final int items = 10;
3030         tableView.getItems().clear();
3031         for (int i = 0; i &lt; items; i++) {
3032             tableView.getItems().add(&quot;Row &quot; + i);
3033         }
3034 
3035         sm.setCellSelectionEnabled(true);
3036         sm.setSelectionMode(SelectionMode.MULTIPLE);
3037 
3038         sm.clearAndSelect(4, col0);
3039 
3040         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 3
3041         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 2
3042         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 1
3043         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 0
3044 
<span class="line-modified">3045         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 1</span>
<span class="line-modified">3046         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 2</span>
<span class="line-modified">3047         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 3</span>
<span class="line-modified">3048         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 4</span>







3049 
3050         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
3051         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2
3052         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 3
3053         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 4
3054 
<span class="line-modified">3055         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>




3056         assertEquals(4, getAnchor().getRow());
3057         assertEquals(0, getAnchor().getColumn());           // anchor does not move
3058         assertTrue(fm.isFocused(4, col3));
3059         assertTrue(sm.isSelected(4, col0));
3060         assertTrue(sm.isSelected(3, col0));
3061         assertTrue(sm.isSelected(2, col0));
3062         assertTrue(sm.isSelected(1, col0));
3063         assertTrue(sm.isSelected(0, col0));
3064         assertTrue(sm.isSelected(0, col1));
3065         assertTrue(sm.isSelected(0, col2));
3066         assertTrue(sm.isSelected(0, col3));
3067         assertTrue(sm.isSelected(0, col4));
3068         assertTrue(sm.isSelected(1, col4));
3069         assertTrue(sm.isSelected(2, col4));
3070         assertTrue(sm.isSelected(3, col4));
3071         assertTrue(sm.isSelected(4, col4));
3072         assertTrue(sm.isSelected(4, col3));
3073 
3074         // critical part - these cells should not be selected!
3075         assertFalse(sm.isSelected(4, col2));
</pre>
<hr />
<pre>
4001 
4002         if (resetSelection) {
4003             sm.clearAndSelect(0, col);
4004 
4005             TablePosition&lt;?,?&gt; anchor = TableCellBehavior.getAnchor(tableView, null);
4006             assertEquals(0, anchor.getRow());
4007             assertEquals(col, anchor.getTableColumn());
4008         } else {
4009             expectedSize = mode == SelectionMode.SINGLE ? 1 : 10;
4010         }
4011 
4012         keyboard.doKeyPress(KeyCode.END, KeyModifier.SHIFT);
4013         assertEquals(expectedSize, indices.size());
4014         assertEquals(expectedSize, cells.size());
4015         assertTrue(sm.isSelected(9, col));
4016 
4017         sl.dispose();
4018     }
4019 
4020     @Test public void test_rt_18440_goLeft() {
<span class="line-modified">4021         test_rt_18440(KeyCode.LEFT, 3, false, colIndex -&gt; {</span>
<span class="line-modified">4022             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4023             return colIndex - 1;</span>
<span class="line-modified">4024         });</span>







4025     }
4026 
4027     @Test public void test_rt_18440_goLeft_toEnd() {
<span class="line-modified">4028         test_rt_18440(KeyCode.LEFT, 3, true, colIndex -&gt; {</span>
<span class="line-modified">4029             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4030             return colIndex - 1;</span>
<span class="line-modified">4031         });</span>







4032     }
4033 
4034     @Test public void test_rt_18440_goRight() {
<span class="line-modified">4035         test_rt_18440(KeyCode.RIGHT, 0, false, colIndex -&gt; {</span>
<span class="line-modified">4036             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4037             return colIndex + 1;</span>
<span class="line-modified">4038         });</span>







4039     }
4040 
4041     @Test public void test_rt_18440_goRight_toEnd() {
<span class="line-modified">4042         test_rt_18440(KeyCode.RIGHT, 0, true, colIndex -&gt; {</span>
<span class="line-modified">4043             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4044             return colIndex + 1;</span>
<span class="line-modified">4045         });</span>







4046     }
4047 
4048     private void test_rt_18440(KeyCode direction, int startColumn, boolean goToEnd, Function&lt;Integer, Integer&gt; r) {
4049         ObservableList&lt;String&gt; itemsList = FXCollections.observableArrayList();
4050         for (int i = 0; i &lt; 10; i++) {
4051             itemsList.add(&quot;Row &quot; + i);
4052         }
4053 
4054         tableView.setItems(itemsList);
4055 
4056         tableView.getColumns().clear();
4057         for (int i = 0; i &lt; 4; i++) {
4058             TableColumn&lt;String, String&gt; col = new TableColumn&lt;&gt;(&quot;Column &quot; + i);
4059             col.setCellValueFactory(param -&gt; new ReadOnlyStringWrapper(param.getValue()));
4060             tableView.getColumns().add(col);
4061         }
4062 
4063         TableView.TableViewFocusModel fm = tableView.getFocusModel();
4064         TableView.TableViewSelectionModel&lt;String&gt; sm = tableView.getSelectionModel();
4065         sm.setSelectionMode(SelectionMode.MULTIPLE);
</pre>
<hr />
<pre>
4082         int expectedColumn = r.apply(startColumn);
4083         assertEquals(0, sm.getSelectedIndex());
4084         assertEquals(tableView.getColumns().get(startColumn), sm.getSelectedCells().get(0).getTableColumn());
4085         assertEquals(0, fm.getFocusedIndex());
4086         assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());
4087 
4088         expectedColumn = r.apply(expectedColumn);
4089         assertEquals(0, sm.getSelectedIndex());
4090         assertEquals(tableView.getColumns().get(startColumn), sm.getSelectedCells().get(0).getTableColumn());
4091         assertEquals(0, fm.getFocusedIndex());
4092         assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());
4093 
4094         if (goToEnd) {
4095             expectedColumn = r.apply(expectedColumn);
4096             assertEquals(0, sm.getSelectedIndex());
4097             assertEquals(tableView.getColumns().get(startColumn), sm.getSelectedCells().get(0).getTableColumn());
4098             assertEquals(0, fm.getFocusedIndex());
4099             assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());
4100         }
4101 
<span class="line-modified">4102         expectedColumn = direction == KeyCode.RIGHT ? 3 : 0;</span>
<span class="line-modified">4103         keyboard.doKeyPress(direction, KeyModifier.SHIFT);</span>
<span class="line-modified">4104         assertEquals(0, sm.getSelectedIndex());</span>
<span class="line-modified">4105         assertEquals(debug(), 4, sm.getSelectedCells().size());</span>
<span class="line-modified">4106         assertEquals(0, fm.getFocusedIndex());</span>
<span class="line-modified">4107         assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());</span>
<span class="line-modified">4108 </span>








4109         sl.dispose();
4110     }
4111 
4112     @Test public void test_rt_24865_moveDownwards() {
4113         tableView.getItems().clear();
4114         for (int i = 0; i &lt; 100; i++) {
4115             tableView.getItems().add(&quot;Row &quot; + i);
4116         }
4117 
4118         Toolkit.getToolkit().firePulse();
4119 
4120         ObservableList&lt;Integer&gt; indices = sm.getSelectedIndices();
4121 
4122         sm.select(0);
4123         assertTrue(isSelected(0));
4124         assertTrue(fm.isFocused(0));
4125         assertEquals(1, indices.size());
4126         assertEquals(0, ((TablePosition)TableCellBehavior.getAnchor(tableView, null)).getRow());
4127 
4128         keyboard.doDownArrowPress(KeyModifier.SHIFT);
</pre>
<hr />
<pre>
4201         // main point of test: selection between the last index (47) and the focus
4202         // index (44) should now be true
4203         keyboard.doKeyPress(KeyCode.PAGE_UP, KeyModifier.getShortcutKey(), KeyModifier.SHIFT);
4204         final int selectedRowCount = indices.size();
4205         for (int i = 0; i &lt; selectedRowCount; i++) {
4206             assertTrue(isSelected(50 - i));
4207         }
4208         assertTrue(fm.isFocused(50 - selectedRowCount + 1));
4209         assertEquals(50, ((TablePosition)TableCellBehavior.getAnchor(tableView, null)).getRow());
4210 
4211         keyboard.doUpArrowPress(KeyModifier.SHIFT);
4212         int newSelectedRowCount = selectedRowCount + 1;
4213         for (int i = 0; i &lt; newSelectedRowCount; i++) {
4214             assertTrue(isSelected(50 - i));
4215         }
4216         assertTrue(fm.isFocused(50 - newSelectedRowCount + 1));
4217         assertEquals(50, ((TablePosition)TableCellBehavior.getAnchor(tableView, null)).getRow());
4218     }
4219 
4220     @Test public void test_rt_39792_goLeft_goPastEnd() {
<span class="line-modified">4221         test_rt_39792(3, colIndex -&gt; {</span>
<span class="line-modified">4222             keyboard.doLeftArrowPress(KeyModifier.SHIFT);</span>
<span class="line-modified">4223             return colIndex - 1;</span>
<span class="line-modified">4224         });</span>








4225     }
4226 
4227     @Test public void test_rt_39792_goRight_goPastEnd() {
<span class="line-modified">4228         test_rt_39792(0, colIndex -&gt; {</span>
<span class="line-modified">4229             keyboard.doRightArrowPress(KeyModifier.SHIFT);</span>
<span class="line-modified">4230             return colIndex + 1;</span>
<span class="line-modified">4231         });</span>








4232     }
4233 
4234     private void test_rt_39792(int startColumn, Function&lt;Integer, Integer&gt; r) {
4235         ObservableList&lt;String&gt; itemsList = FXCollections.observableArrayList();
4236         for (int i = 0; i &lt; 10; i++) {
4237             itemsList.add(&quot;Row &quot; + i);
4238         }
4239 
4240         tableView.setItems(itemsList);
4241 
4242         tableView.getColumns().clear();
4243         for (int i = 0; i &lt; 4; i++) {
4244             TableColumn&lt;String, String&gt; col = new TableColumn&lt;&gt;(&quot;Column &quot; + i);
4245             col.setCellValueFactory(param -&gt; new ReadOnlyStringWrapper(param.getValue()));
4246             tableView.getColumns().add(col);
4247         }
4248 
4249         TableView.TableViewSelectionModel&lt;String&gt; sm = tableView.getSelectionModel();
4250         sm.setSelectionMode(SelectionMode.MULTIPLE);
4251         sm.setCellSelectionEnabled(true);
</pre>
</td>
<td>
<hr />
<pre>
   1 /*
<span class="line-modified">   2  * Copyright (c) 2011, 2020, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.  Oracle designates this
   8  * particular file as subject to the &quot;Classpath&quot; exception as provided
   9  * by Oracle in the LICENSE file that accompanied this code.
  10  *
  11  * This code is distributed in the hope that it will be useful, but WITHOUT
  12  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  13  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  14  * version 2 for more details (a copy is included in the LICENSE file that
  15  * accompanied this code).
  16  *
  17  * You should have received a copy of the GNU General Public License version
  18  * 2 along with this work; if not, write to the Free Software Foundation,
  19  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  20  *
  21  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  22  * or visit www.oracle.com if you need additional information or have any
  23  * questions.
  24  */
  25 
  26 package test.javafx.scene.control;
  27 
  28 import com.sun.javafx.scene.control.behavior.TableCellBehavior;
  29 import javafx.beans.property.ReadOnlyStringWrapper;
  30 import javafx.collections.FXCollections;
  31 import javafx.collections.ListChangeListener;
  32 import javafx.collections.ObservableList;
  33 import javafx.scene.Group;
  34 import javafx.scene.control.Button;
  35 import javafx.scene.input.KeyCode;
  36 import javafx.scene.layout.HBox;
  37 
<span class="line-added">  38 import java.util.Arrays;</span>
<span class="line-added">  39 import java.util.Collection;</span>
  40 import java.util.List;
  41 import java.util.function.Function;
  42 
  43 import com.sun.javafx.PlatformUtil;
  44 import com.sun.javafx.util.Utils;
  45 import test.com.sun.javafx.scene.control.behavior.TableViewAnchorRetriever;
  46 import test.com.sun.javafx.scene.control.infrastructure.ControlTestUtils;
  47 import test.com.sun.javafx.scene.control.infrastructure.KeyEventFirer;
  48 import test.com.sun.javafx.scene.control.infrastructure.KeyModifier;
  49 import test.com.sun.javafx.scene.control.infrastructure.StageLoader;
  50 import test.com.sun.javafx.scene.control.infrastructure.VirtualFlowTestUtils;
  51 import com.sun.javafx.tk.Toolkit;
  52 import javafx.scene.control.FocusModel;
  53 import javafx.scene.control.MultipleSelectionModel;
  54 import javafx.scene.control.SelectionMode;
  55 import javafx.scene.control.TableCell;
  56 import javafx.scene.control.TableCellShim;
  57 import javafx.scene.control.TableColumn;
  58 import javafx.scene.control.TableFocusModel;
  59 import javafx.scene.control.TablePosition;
  60 import javafx.scene.control.TableSelectionModel;
  61 import javafx.scene.control.TableView;
<span class="line-added">  62 import javafx.geometry.NodeOrientation;</span>
  63 import org.junit.After;
  64 import org.junit.Before;
  65 import org.junit.Ignore;
  66 import org.junit.Test;
<span class="line-added">  67 import org.junit.runner.RunWith;</span>
<span class="line-added">  68 import org.junit.runners.Parameterized;</span>
<span class="line-added">  69 </span>
  70 import static org.junit.Assert.assertEquals;
  71 import static org.junit.Assert.assertFalse;
  72 import static org.junit.Assert.assertNotSame;
  73 import static org.junit.Assert.assertNull;
  74 import static org.junit.Assert.assertTrue;
<span class="line-added">  75 </span>
  76 import static org.junit.Assert.fail;
  77 
<span class="line-added">  78 @RunWith(Parameterized.class)</span>
  79 public class TableViewKeyInputTest {
<span class="line-added">  80     @Parameterized.Parameters public static Collection implementations() {</span>
<span class="line-added">  81         return Arrays.asList(new Object[][]{</span>
<span class="line-added">  82                 {NodeOrientation.LEFT_TO_RIGHT},</span>
<span class="line-added">  83                 {NodeOrientation.RIGHT_TO_LEFT}</span>
<span class="line-added">  84         });</span>
<span class="line-added">  85     }</span>
<span class="line-added">  86 </span>
  87     private TableView&lt;String&gt; tableView;
  88 //    private TableSelectionModel&lt;String&gt; sm;
  89     private TableView.TableViewSelectionModel&lt;String&gt; sm;
  90     private TableView.TableViewFocusModel&lt;String&gt; fm;
  91 
  92     private KeyEventFirer keyboard;
  93 
  94     private StageLoader stageLoader;
  95 
  96     private TableColumn&lt;String, String&gt; col0;
  97     private TableColumn&lt;String, String&gt; col1;
  98     private TableColumn&lt;String, String&gt; col2;
  99     private TableColumn&lt;String, String&gt; col3;
 100     private TableColumn&lt;String, String&gt; col4;
 101 
<span class="line-added"> 102     private NodeOrientation orientation;</span>
<span class="line-added"> 103 </span>
<span class="line-added"> 104     public TableViewKeyInputTest(NodeOrientation val) {</span>
<span class="line-added"> 105         orientation = val;</span>
<span class="line-added"> 106     }</span>
<span class="line-added"> 107 </span>
 108     @Before public void setup() {
 109         tableView = new TableView&lt;String&gt;();
<span class="line-added"> 110         tableView.setNodeOrientation(orientation);</span>
 111         sm = tableView.getSelectionModel();
 112         fm = tableView.getFocusModel();
 113 
 114         sm.setSelectionMode(SelectionMode.MULTIPLE);
 115         sm.setCellSelectionEnabled(false);
 116 
 117         tableView.getItems().setAll(&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;);
 118 
 119         col0 = new TableColumn&lt;String, String&gt;(&quot;col0&quot;);
 120         col1 = new TableColumn&lt;String, String&gt;(&quot;col1&quot;);
 121         col2 = new TableColumn&lt;String, String&gt;(&quot;col2&quot;);
 122         col3 = new TableColumn&lt;String, String&gt;(&quot;col3&quot;);
 123         col4 = new TableColumn&lt;String, String&gt;(&quot;col4&quot;);
 124         tableView.getColumns().setAll(col0, col1, col2, col3, col4);
 125 
 126         keyboard = new KeyEventFirer(tableView);
 127 
 128         stageLoader = new StageLoader(tableView);
 129         stageLoader.getStage().show();
 130     }
</pre>
<hr />
<pre>
1114 
1115         keyboard.doUpArrowPress(KeyModifier.getShortcutKey());
1116         keyboard.doKeyPress(KeyCode.SPACE,
1117                 KeyModifier.getShortcutKey(),
1118                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1119         assertTrue(isSelected(1,2,3,4));
1120         assertTrue(isAnchor(0));
1121         assertTrue(fm.isFocused(0));
1122     }
1123 
1124 
1125     /***************************************************************************
1126      * Tests for discontinuous multiple cell selection (RT-18951)
1127      **************************************************************************/
1128 
1129     // Test 1
1130     @Test public void test_rt18591_cell_1() {
1131         sm.setSelectionMode(SelectionMode.MULTIPLE);
1132         sm.setCellSelectionEnabled(true);
1133         sm.select(0, col0);
<span class="line-modified">1134 </span>
<span class="line-modified">1135         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-added">1136             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1137             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1138         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1139             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1140             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1141         }</span>
1142         keyboard.doKeyPress(KeyCode.SPACE,
1143                 KeyModifier.getShortcutKey(),
1144                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1145         assertTrue(sm.isSelected(0,col0));
1146         assertTrue(sm.isSelected(0,col2));
1147         assertTrue(isAnchor(0,2));
1148 
<span class="line-modified">1149         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1150             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1151             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1152         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1153             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1154             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1155         }</span>
1156         assertTrue(sm.isSelected(0,col0));
1157         assertTrue(sm.isSelected(0,col2));
1158         assertTrue(sm.isSelected(0,col3));
1159         assertTrue(sm.isSelected(0,col4));
1160         assertTrue(isAnchor(0,2));
1161     }
1162 
1163     // Test 2
1164     @Test public void test_rt18591_cell_2() {
1165         sm.setSelectionMode(SelectionMode.MULTIPLE);
1166         sm.setCellSelectionEnabled(true);
1167         sm.select(0, col4);
<span class="line-modified">1168         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1169             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1170             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1171         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1172             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1173             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1174         }</span>
1175         keyboard.doKeyPress(KeyCode.SPACE,
1176                 KeyModifier.getShortcutKey(),
1177                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1178         assertTrue(sm.isSelected(0,col4));
1179         assertTrue(sm.isSelected(0,col2));
1180         assertTrue(isAnchor(0,2));
1181 
<span class="line-modified">1182         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1183             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1184             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1185         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1186             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1187             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1188         }</span>
1189         assertTrue(sm.isSelected(0,col0));
1190         assertTrue(sm.isSelected(0,col1));
1191         assertTrue(sm.isSelected(0,col2));
1192         assertTrue(sm.isSelected(0,col4));
1193         assertTrue(isAnchor(0,2));
1194     }
1195 
1196     // Test 3
1197     @Test public void test_rt18591_cell_3() {
1198         sm.setSelectionMode(SelectionMode.MULTIPLE);
1199         sm.setCellSelectionEnabled(true);
1200         sm.select(0, col0);
<span class="line-modified">1201         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1202             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1203             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1204         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1205             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1206             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1207         }</span>
1208         keyboard.doKeyPress(KeyCode.SPACE,
1209                 KeyModifier.getShortcutKey(),
1210                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1211         assertTrue(sm.isSelected(0,col0));
1212         assertTrue(sm.isSelected(0,col2));
1213         assertTrue(isAnchor(0,2));
1214 
<span class="line-modified">1215         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1216             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1217             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1218         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1219             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1220             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1221         }</span>
1222         assertTrue(sm.isSelected(0,col0));
1223         assertTrue(sm.isSelected(0,col2));
1224         assertTrue(sm.isSelected(0,col3));
1225         assertTrue(sm.isSelected(0,col4));
1226         assertTrue(isAnchor(0,2));
1227 
<span class="line-modified">1228         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1229             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1230             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1231             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1232         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1233             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1234             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1235             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1236         }</span>
1237         assertTrue(sm.isSelected(0,col0));
1238         assertTrue(sm.isSelected(0,col1));
1239         assertTrue(sm.isSelected(0,col2));
1240         assertTrue(sm.isSelected(0,col3));
1241         assertTrue(sm.isSelected(0,col4));
1242         assertTrue(isAnchor(0,2));
1243     }
1244 
1245     // Test 4
1246     @Test public void test_rt18591_cell_4() {
1247         sm.setSelectionMode(SelectionMode.MULTIPLE);
1248         sm.setCellSelectionEnabled(true);
1249         sm.select(0, col4);
<span class="line-modified">1250 </span>
<span class="line-modified">1251         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-added">1252             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1253             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1254         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1255             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1256             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">1257         }</span>
1258         keyboard.doKeyPress(KeyCode.SPACE,
1259                 KeyModifier.getShortcutKey(),
1260                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1261         assertTrue(sm.isSelected(0,col4));
1262         assertTrue(sm.isSelected(0,col2));
1263         assertTrue(isAnchor(0,2));
1264 
<span class="line-modified">1265         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1266             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1267             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1268         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1269             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1270             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1271         }</span>
1272         assertTrue(sm.isSelected(0,col0));
1273         assertTrue(sm.isSelected(0,col1));
1274         assertTrue(sm.isSelected(0,col2));
1275         assertTrue(sm.isSelected(0,col4));
1276         assertTrue(isAnchor(0,2));
1277 
<span class="line-modified">1278         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1279             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-modified">1280             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1281             keyboard.doRightArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1282         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1283             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1284             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1285             keyboard.doLeftArrowPress(KeyModifier.SHIFT, KeyModifier.getShortcutKey());</span>
<span class="line-added">1286         }</span>
1287         assertTrue(sm.isSelected(0,col0));
1288         assertTrue(sm.isSelected(0,col1));
1289         assertTrue(sm.isSelected(0,col2));
1290         assertTrue(sm.isSelected(0,col3));
1291         assertTrue(sm.isSelected(0,col4));
1292         assertTrue(isAnchor(0,2));
1293     }
1294 
1295     // Test 5
1296     @Test public void test_rt18591_cell_5() {
1297         sm.setSelectionMode(SelectionMode.MULTIPLE);
1298         sm.setCellSelectionEnabled(true);
1299         sm.select(0, col1);
1300         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());
1301         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());
1302         keyboard.doKeyPress(KeyCode.SPACE,
1303                 KeyModifier.getShortcutKey(),
1304                 (Utils.isMac()  ? KeyModifier.CTRL : null));
1305         assertTrue(sm.isSelected(0,col1));
1306         assertTrue(sm.isSelected(2,col1));
</pre>
<hr />
<pre>
1542 //        assertTrue(sm.isSelected(3,col3));
1543 //        assertTrue(sm.isSelected(3,col4));
1544 //        assertTrue(sm.isSelected(4,col3));
1545 //        assertTrue(sm.isSelected(5,col3));
1546 //        assertTrue(isAnchor(3,3));
1547 //    }
1548 
1549 
1550     /***************************************************************************
1551      * Tests for specific bug reports
1552      **************************************************************************/
1553 
1554     @Test public void test_rt18488_selectToLeft() {
1555         sm.setCellSelectionEnabled(true);
1556         sm.clearAndSelect(1, col4);
1557 
1558         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col4)
1559         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col3)
1560         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col2)
1561         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // select (1, col1)
<span class="line-modified">1562 </span>
<span class="line-modified">1563         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1564             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1565             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1566             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1567             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1568             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1569         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1570             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-added">1571             assertFalse(sm.isSelected(1, col3));</span>
<span class="line-added">1572             assertFalse(sm.isSelected(1, col2));</span>
<span class="line-added">1573             assertFalse(sm.isSelected(1, col1));</span>
<span class="line-added">1574             assertFalse(sm.isSelected(1, col0));</span>
<span class="line-added">1575         }</span>
1576 
1577         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // deselect (1, col1)
<span class="line-modified">1578 </span>
<span class="line-modified">1579         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1580             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1581             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1582             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1583             assertTrue(debug(), sm.isSelected(1, col1));</span>
<span class="line-added">1584             assertFalse(sm.isSelected(1, col0));</span>
<span class="line-added">1585         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1586             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-added">1587             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-added">1588         }</span>
1589     }
1590 
1591     @Test public void test_rt18488_selectToRight() {
1592         sm.setCellSelectionEnabled(true);
1593         sm.clearAndSelect(1, col0);
1594 
1595         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col2)
1596         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col3)
1597         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col4)
1598         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col5)
<span class="line-modified">1599 </span>
<span class="line-modified">1600         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1601             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1602             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1603             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1604             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1605             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1606         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1607             assertFalse(sm.isSelected(1, col4));</span>
<span class="line-added">1608             assertFalse(sm.isSelected(1, col3));</span>
<span class="line-added">1609             assertFalse(sm.isSelected(1, col2));</span>
<span class="line-added">1610             assertFalse(sm.isSelected(1, col1));</span>
<span class="line-added">1611             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1612         }</span>
1613 
1614         keyboard.doLeftArrowPress(KeyModifier.SHIFT);   // deselect (1, col5)
<span class="line-modified">1615 </span>
<span class="line-modified">1616         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1617             assertFalse(sm.isSelected(1, col4));</span>
<span class="line-modified">1618             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1619             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1620             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1621             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1622         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1623             assertFalse(sm.isSelected(1, col4));</span>
<span class="line-added">1624             assertFalse(sm.isSelected(1, col3));</span>
<span class="line-added">1625             assertFalse(sm.isSelected(1, col2));</span>
<span class="line-added">1626             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1627             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1628         }</span>
1629     }
1630 
1631     @Test public void test_rt18488_comment1() {
1632         sm.setCellSelectionEnabled(true);
1633         sm.clearAndSelect(1, col0);
1634 
1635         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col2)
1636         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col3)
1637         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col4)
1638         keyboard.doRightArrowPress(KeyModifier.SHIFT);   // select (1, col5)
1639         keyboard.doDownArrowPress(KeyModifier.SHIFT);    // select (2, col5)
1640 
<span class="line-modified">1641         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1642             assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">1643             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1644             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1645             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1646             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1647             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1648         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT)  {</span>
<span class="line-added">1649             assertFalse(sm.isSelected(1, col4));</span>
<span class="line-added">1650             assertFalse(sm.isSelected(1, col3));</span>
<span class="line-added">1651             assertFalse(sm.isSelected(1, col2));</span>
<span class="line-added">1652             assertFalse(sm.isSelected(1, col1));</span>
<span class="line-added">1653             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1654             assertTrue(sm.isSelected(2, col0));</span>
<span class="line-added">1655         }</span>
1656 
1657         keyboard.doUpArrowPress(KeyModifier.SHIFT);     // deselect (2, col5)
<span class="line-modified">1658 </span>
<span class="line-modified">1659         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1660             assertFalse(sm.isSelected(2, col4));</span>
<span class="line-modified">1661             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1662             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-modified">1663             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1664             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1665             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1666         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT)  {</span>
<span class="line-added">1667             assertFalse(sm.isSelected(1, col4));</span>
<span class="line-added">1668             assertFalse(sm.isSelected(1, col3));</span>
<span class="line-added">1669             assertFalse(sm.isSelected(1, col2));</span>
<span class="line-added">1670             assertFalse(sm.isSelected(1, col1));</span>
<span class="line-added">1671             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1672             assertFalse(sm.isSelected(2, col0));</span>
<span class="line-added">1673         }</span>
1674     }
1675 
1676     @Test public void test_rt18536_positive_horizontal() {
<span class="line-modified">1677         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1678             // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-modified">1679             sm.setCellSelectionEnabled(true);</span>
<span class="line-modified">1680             sm.clearAndSelect(1, col0);</span>
<span class="line-modified">1681 </span>
<span class="line-modified">1682             // move focus by holding down ctrl button</span>
<span class="line-modified">1683             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-modified">1684             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-modified">1685             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col4)</span>
<span class="line-modified">1686             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col5)</span>
<span class="line-modified">1687             assertTrue(fm.isFocused(1, col4));</span>
<span class="line-modified">1688 </span>
<span class="line-modified">1689             // press shift + space to select all cells between (1, col1) and (1, col5)</span>
<span class="line-modified">1690             keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-modified">1691             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">1692             assertTrue(debug(), sm.isSelected(1, col3));</span>
<span class="line-modified">1693             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-modified">1694             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1695             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1696         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1697             // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-added">1698             sm.setCellSelectionEnabled(true);</span>
<span class="line-added">1699             sm.clearAndSelect(1, col4);</span>
<span class="line-added">1700 </span>
<span class="line-added">1701             // move focus by holding down ctrl button</span>
<span class="line-added">1702             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-added">1703             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-added">1704             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col1)</span>
<span class="line-added">1705             keyboard.doRightArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col0)</span>
<span class="line-added">1706             assertTrue(fm.isFocused(1, col0));</span>
<span class="line-added">1707 </span>
<span class="line-added">1708             // press shift + space to select all cells between (1, col1) and (1, col5)</span>
<span class="line-added">1709             keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-added">1710             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1711             assertTrue(debug(), sm.isSelected(1, col3));</span>
<span class="line-added">1712             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1713             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1714             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1715         }</span>
1716     }
1717 
1718     @Test public void test_rt18536_negative_horizontal() {










1719 
<span class="line-modified">1720         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">1721             // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-modified">1722             sm.setCellSelectionEnabled(true);</span>
<span class="line-modified">1723             sm.clearAndSelect(1, col4);</span>
<span class="line-modified">1724 </span>
<span class="line-modified">1725             // move focus by holding down ctrl button</span>
<span class="line-modified">1726             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col4)</span>
<span class="line-added">1727             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-added">1728             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-added">1729             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col1)</span>
<span class="line-added">1730             assertTrue(fm.isFocused(1, col0));</span>
<span class="line-added">1731 </span>
<span class="line-added">1732             // press shift + space to select all cells between (1, col1) and (1, col5)</span>
<span class="line-added">1733             keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-added">1734             assertTrue(debug(), sm.isSelected(1, col4));</span>
<span class="line-added">1735             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-added">1736             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1737             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1738             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1739         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">1740             // Test shift selection when focus is elsewhere (so as to select a range)</span>
<span class="line-added">1741             sm.setCellSelectionEnabled(true);</span>
<span class="line-added">1742             sm.clearAndSelect(1, col0);</span>
<span class="line-added">1743 </span>
<span class="line-added">1744             // move focus by holding down ctrl button</span>
<span class="line-added">1745             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col1)</span>
<span class="line-added">1746             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col2)</span>
<span class="line-added">1747             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col3)</span>
<span class="line-added">1748             keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());   // move focus to (1, col4)</span>
<span class="line-added">1749             assertTrue(fm.isFocused(1, col4));</span>
<span class="line-added">1750 </span>
<span class="line-added">1751             // press shift + space to select all cells between (1, col1) and (1, col5)</span>
<span class="line-added">1752             keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);</span>
<span class="line-added">1753             assertTrue(debug(), sm.isSelected(1, col0));</span>
<span class="line-added">1754             assertTrue(sm.isSelected(1, col3));</span>
<span class="line-added">1755             assertTrue(sm.isSelected(1, col2));</span>
<span class="line-added">1756             assertTrue(sm.isSelected(1, col1));</span>
<span class="line-added">1757             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">1758         }</span>
1759     }
1760 
1761     //
1762     @Test public void test_rt18536_positive_vertical() {
1763         // Test shift selection when focus is elsewhere (so as to select a range)
1764         sm.setCellSelectionEnabled(true);
1765         sm.clearAndSelect(1, col4);
1766 
1767         // move focus by holding down ctrl button
1768         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (2, col5)
1769         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (3, col5)
1770         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (4, col5)
1771         keyboard.doDownArrowPress(KeyModifier.getShortcutKey());   // move focus to (5, col5)
1772         assertTrue(fm.isFocused(5, col4));
1773 
1774         // press shift + space to select all cells between (1, col5) and (5, col5)
1775         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
1776         assertTrue(sm.isSelected(1, col4));
1777         assertTrue(sm.isSelected(2, col4));
1778         assertTrue(sm.isSelected(3, col4));
</pre>
<hr />
<pre>
2786         assertEquals(3, fm.getFocusedIndex());
2787         assertEquals(6, sm.getSelectedIndex());
2788 
2789         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2790         Toolkit.getToolkit().firePulse();
2791         assertEquals(6, getAnchor().getRow());
2792         assertEquals(0, getAnchor().getColumn());
2793         assertEquals(3, fm.getFocusedIndex());
2794         assertEquals(3, sm.getSelectedIndex());
2795     }
2796 
2797     @Test public void test_rt33613_up_multipleColumn_right() {
2798         final int items = 10;
2799         tableView.getItems().clear();
2800         for (int i = 0; i &lt; items; i++) {
2801             tableView.getItems().add(&quot;Row &quot; + i);
2802         }
2803 
2804         sm.setCellSelectionEnabled(true);
2805 
<span class="line-modified">2806         sm.clearAndSelect(6, col1);</span>
2807         assertEquals(6, getAnchor().getRow());
<span class="line-modified">2808         assertEquals(1, getAnchor().getColumn());</span>
<span class="line-modified">2809         assertTrue(fm.isFocused(6, col1));</span>
<span class="line-modified">2810         assertTrue(sm.isSelected(6, col1));</span>
2811 
2812         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2813         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2814         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2815         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.getShortcutKey());
2816         Toolkit.getToolkit().firePulse();
2817         assertEquals(6, getAnchor().getRow());
<span class="line-modified">2818         assertEquals(1, getAnchor().getColumn());</span>
<span class="line-modified">2819 </span>
<span class="line-modified">2820         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2821             assertTrue(fm.isFocused(3, col2));</span>
<span class="line-added">2822             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2823             assertFalse(sm.isSelected(3, col2));</span>
<span class="line-added">2824         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">2825             assertTrue(fm.isFocused(3, col0));</span>
<span class="line-added">2826             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2827             assertFalse(sm.isSelected(3, col0));</span>
<span class="line-added">2828         }</span>
2829 
2830         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2831         Toolkit.getToolkit().firePulse();
2832         assertEquals(6, getAnchor().getRow());
<span class="line-modified">2833         assertEquals(1, getAnchor().getColumn());</span>
<span class="line-modified">2834 </span>
<span class="line-modified">2835         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2836             assertTrue(fm.isFocused(3, col2));</span>
<span class="line-added">2837             assertTrue(sm.isSelected(3, col2));</span>
<span class="line-added">2838             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2839         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">2840             assertTrue(fm.isFocused(3, col0));</span>
<span class="line-added">2841             assertTrue(sm.isSelected(3, col0));</span>
<span class="line-added">2842             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2843         }</span>
2844     }
2845 
2846     @Test public void test_rt33613_up_multipleColumn_left() {
2847         final int items = 10;
2848         tableView.getItems().clear();
2849         for (int i = 0; i &lt; items; i++) {
2850             tableView.getItems().add(&quot;Row &quot; + i);
2851         }
2852 
2853         sm.setCellSelectionEnabled(true);
2854 
2855         sm.clearAndSelect(6, col1);
2856         assertEquals(6, getAnchor().getRow());
2857         assertEquals(1, getAnchor().getColumn());
2858         assertTrue(fm.isFocused(6, col1));
2859         assertTrue(sm.isSelected(6, col1));
2860 
2861         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2862         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2863         keyboard.doKeyPress(KeyCode.UP, KeyModifier.getShortcutKey());
2864         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.getShortcutKey());
2865         Toolkit.getToolkit().firePulse();
2866         assertEquals(6, getAnchor().getRow());
2867         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2868 </span>
<span class="line-modified">2869         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2870             assertTrue(fm.isFocused(3, col0));</span>
<span class="line-added">2871             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2872             assertFalse(sm.isSelected(3, col0));</span>
<span class="line-added">2873         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">2874             assertTrue(fm.isFocused(3, col2));</span>
<span class="line-added">2875             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2876             assertFalse(sm.isSelected(3, col2));</span>
<span class="line-added">2877         }</span>
2878 
2879         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2880         Toolkit.getToolkit().firePulse();
2881         assertEquals(6, getAnchor().getRow());
2882         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2883 </span>
<span class="line-modified">2884         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2885             assertTrue(fm.isFocused(3, col0));</span>
<span class="line-added">2886             assertTrue(sm.isSelected(3, col0));</span>
<span class="line-added">2887             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2888         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">2889             assertTrue(fm.isFocused(3, col2));</span>
<span class="line-added">2890             assertTrue(sm.isSelected(3, col2));</span>
<span class="line-added">2891             assertTrue(sm.isSelected(6, col1));</span>
<span class="line-added">2892         }</span>
2893     }
2894 
2895     @Test public void test_rt33613_down_oneColumn() {
2896         final int items = 10;
2897         tableView.getItems().clear();
2898         for (int i = 0; i &lt; items; i++) {
2899             tableView.getItems().add(&quot;Row &quot; + i);
2900         }
2901 
2902         sm.setCellSelectionEnabled(true);
2903 
2904         sm.clearAndSelect(3, col0);
2905         assertEquals(3, getAnchor().getRow());
2906         assertEquals(0, getAnchor().getColumn());
2907         assertEquals(3, fm.getFocusedIndex());
2908         assertEquals(3, sm.getSelectedIndex());
2909 
2910         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2911         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2912         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
</pre>
<hr />
<pre>
2916         assertEquals(6, fm.getFocusedIndex());
2917         assertEquals(3, sm.getSelectedIndex());
2918 
2919         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2920         Toolkit.getToolkit().firePulse();
2921         assertEquals(3, getAnchor().getRow());
2922         assertEquals(0, getAnchor().getColumn());
2923         assertEquals(6, fm.getFocusedIndex());
2924         assertEquals(6, sm.getSelectedIndex());
2925     }
2926 
2927     @Test public void test_rt33613_down_multipleColumn_right() {
2928         final int items = 10;
2929         tableView.getItems().clear();
2930         for (int i = 0; i &lt; items; i++) {
2931             tableView.getItems().add(&quot;Row &quot; + i);
2932         }
2933 
2934         sm.setCellSelectionEnabled(true);
2935 
<span class="line-modified">2936         sm.clearAndSelect(3, col1);</span>
2937         assertEquals(3, getAnchor().getRow());
<span class="line-modified">2938         assertEquals(1, getAnchor().getColumn());</span>
<span class="line-modified">2939         assertTrue(fm.isFocused(3, col1));</span>
<span class="line-modified">2940         assertTrue(sm.isSelected(3, col1));</span>
2941 
2942         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2943         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2944         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2945         keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.getShortcutKey());
2946         Toolkit.getToolkit().firePulse();
2947         assertEquals(3, getAnchor().getRow());
<span class="line-modified">2948         assertEquals(1, getAnchor().getColumn());</span>
<span class="line-modified">2949 </span>
<span class="line-modified">2950         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2951             assertTrue(fm.isFocused(6, col2));</span>
<span class="line-added">2952             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">2953             assertFalse(sm.isSelected(6, col2));</span>
<span class="line-added">2954         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">2955             assertTrue(fm.isFocused(6, col0));</span>
<span class="line-added">2956             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">2957             assertFalse(sm.isSelected(6, col0));</span>
<span class="line-added">2958         }</span>
2959 
2960         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
2961         Toolkit.getToolkit().firePulse();
2962         assertEquals(3, getAnchor().getRow());
<span class="line-modified">2963         assertEquals(1, getAnchor().getColumn());</span>
<span class="line-modified">2964 </span>
<span class="line-modified">2965         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2966             assertTrue(fm.isFocused(6, col2));</span>
<span class="line-added">2967             assertTrue(sm.isSelected(6, col2));</span>
<span class="line-added">2968             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">2969         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">2970             assertTrue(fm.isFocused(6, col0));</span>
<span class="line-added">2971             assertTrue(sm.isSelected(6, col0));</span>
<span class="line-added">2972             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">2973         }</span>
2974     }
2975 
2976     @Test public void test_rt33613_down_multipleColumn_left() {
2977         final int items = 10;
2978         tableView.getItems().clear();
2979         for (int i = 0; i &lt; items; i++) {
2980             tableView.getItems().add(&quot;Row &quot; + i);
2981         }
2982 
2983         sm.setCellSelectionEnabled(true);
2984 
2985         sm.clearAndSelect(3, col1);
2986         assertEquals(3, getAnchor().getRow());
2987         assertEquals(1, getAnchor().getColumn());
2988         assertTrue(fm.isFocused(3, col1));
2989         assertTrue(sm.isSelected(3, col1));
2990 
2991         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2992         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2993         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.getShortcutKey());
2994         keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.getShortcutKey());
2995         assertEquals(3, getAnchor().getRow());
2996         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">2997 </span>
<span class="line-modified">2998         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">2999             assertTrue(fm.isFocused(6, col0));</span>
<span class="line-added">3000             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">3001             assertFalse(sm.isSelected(6, col0));</span>
<span class="line-added">3002         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3003             assertTrue(fm.isFocused(6, col2));</span>
<span class="line-added">3004             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">3005             assertFalse(sm.isSelected(6, col2));</span>
<span class="line-added">3006         }</span>
3007 
3008         keyboard.doKeyPress(KeyCode.SPACE, KeyModifier.SHIFT);
3009         assertEquals(3, getAnchor().getRow());
3010         assertEquals(1, getAnchor().getColumn());
<span class="line-modified">3011 </span>
<span class="line-modified">3012         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3013             assertTrue(fm.isFocused(6, col0));</span>
<span class="line-added">3014             assertTrue(sm.isSelected(6, col0));</span>
<span class="line-added">3015             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">3016         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3017             assertTrue(fm.isFocused(6, col2));</span>
<span class="line-added">3018             assertTrue(sm.isSelected(6, col2));</span>
<span class="line-added">3019             assertTrue(sm.isSelected(3, col1));</span>
<span class="line-added">3020         }</span>
3021     }
3022 
3023     @Test public void test_rt18439() {
<span class="line-added">3024 </span>
3025         final int items = 10;
3026         tableView.getItems().clear();
3027         for (int i = 0; i &lt; items; i++) {
3028             tableView.getItems().add(&quot;Row &quot; + i);
3029         }
3030 
3031         sm.setCellSelectionEnabled(true);
3032         sm.setSelectionMode(SelectionMode.MULTIPLE);
3033 
<span class="line-modified">3034         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-added">3035             sm.clearAndSelect(0, col0);</span>
3036 
<span class="line-modified">3037             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3038             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3039             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3040             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>
<span class="line-modified">3041             assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">3042             assertEquals(0, getAnchor().getColumn());              // anchor does not move</span>
<span class="line-modified">3043             assertTrue(fm.isFocused(0, col4));</span>
<span class="line-modified">3044             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">3045             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">3046             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">3047             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">3048             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">3049 </span>
<span class="line-modified">3050             keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1</span>
<span class="line-modified">3051             keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2</span>
<span class="line-modified">3052             assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">3053             assertEquals(0, getAnchor().getColumn());             // anchor does not move</span>
<span class="line-modified">3054             assertTrue(fm.isFocused(2, col4));</span>
<span class="line-modified">3055             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">3056             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">3057             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">3058             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">3059             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">3060             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">3061             assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">3062 </span>
<span class="line-modified">3063             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3064             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3065             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3066             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-modified">3067             assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">3068             assertEquals(0, getAnchor().getColumn());             // anchor does not move</span>
<span class="line-modified">3069             assertTrue(fm.isFocused(2, col0));</span>
<span class="line-modified">3070             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">3071             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">3072             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">3073             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">3074             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">3075             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-modified">3076             assertTrue(sm.isSelected(2, col4));</span>
<span class="line-modified">3077             assertTrue(sm.isSelected(2, col3));</span>
<span class="line-modified">3078             assertTrue(sm.isSelected(2, col2));</span>
<span class="line-modified">3079             assertTrue(sm.isSelected(2, col1));</span>
<span class="line-modified">3080             assertTrue(sm.isSelected(2, col0));</span>
<span class="line-added">3081 </span>
<span class="line-added">3082             keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 1</span>
<span class="line-added">3083             keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 0</span>
<span class="line-added">3084             assertEquals(0, getAnchor().getRow());</span>
<span class="line-added">3085             assertEquals(0, getAnchor().getColumn());           // anchor does not move</span>
<span class="line-added">3086             assertTrue(fm.isFocused(0, col0));</span>
<span class="line-added">3087             assertFalse(sm.isSelected(0, col0));                // we&#39;ve gone right around - this cell is now unselected</span>
<span class="line-added">3088             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">3089             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">3090             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">3091             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">3092             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-added">3093             assertTrue(sm.isSelected(2, col4));</span>
<span class="line-added">3094             assertTrue(sm.isSelected(2, col3));</span>
<span class="line-added">3095             assertTrue(sm.isSelected(2, col2));</span>
<span class="line-added">3096             assertTrue(sm.isSelected(2, col1));</span>
<span class="line-added">3097             assertTrue(sm.isSelected(2, col0));</span>
<span class="line-added">3098             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">3099         }</span>
<span class="line-added">3100         else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3101             sm.clearAndSelect(0, col4);</span>
3102 
<span class="line-modified">3103             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3104             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3105             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3106             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 0</span>
<span class="line-modified">3107             assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">3108             assertEquals(4, getAnchor().getColumn());              // anchor does not move</span>
<span class="line-modified">3109             assertTrue(fm.isFocused(0, col0));</span>
<span class="line-modified">3110             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-modified">3111             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-modified">3112             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-modified">3113             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-modified">3114             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-modified">3115 </span>
<span class="line-modified">3116             keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1</span>
<span class="line-modified">3117             keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2</span>
<span class="line-modified">3118             assertEquals(0, getAnchor().getRow());</span>
<span class="line-modified">3119             assertEquals(4, getAnchor().getColumn());             // anchor does not move</span>
<span class="line-added">3120             assertTrue(fm.isFocused(2, col0));</span>
<span class="line-added">3121             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">3122             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">3123             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">3124             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">3125             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">3126             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">3127             assertTrue(sm.isSelected(2, col0));</span>
<span class="line-added">3128 </span>
<span class="line-added">3129             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-added">3130             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3131             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-added">3132             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3133             assertEquals(0, getAnchor().getRow());</span>
<span class="line-added">3134             assertEquals(4, getAnchor().getColumn());             // anchor does not move</span>
<span class="line-added">3135             assertTrue(fm.isFocused(2, col4));</span>
<span class="line-added">3136             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">3137             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">3138             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">3139             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">3140             assertTrue(sm.isSelected(0, col4));</span>
<span class="line-added">3141             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">3142             assertTrue(sm.isSelected(2, col4));</span>
<span class="line-added">3143             assertTrue(sm.isSelected(2, col3));</span>
<span class="line-added">3144             assertTrue(sm.isSelected(2, col2));</span>
<span class="line-added">3145             assertTrue(sm.isSelected(2, col1));</span>
<span class="line-added">3146             assertTrue(sm.isSelected(2, col0));</span>
<span class="line-added">3147 </span>
<span class="line-added">3148             keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 0</span>
<span class="line-added">3149             keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 1</span>
<span class="line-added">3150             assertEquals(0, getAnchor().getRow());</span>
<span class="line-added">3151             assertEquals(4, getAnchor().getColumn());           // anchor does not move</span>
<span class="line-added">3152             assertTrue(fm.isFocused(0, col4));</span>
<span class="line-added">3153             assertFalse(sm.isSelected(0, col4));                // we&#39;ve gone right around - this cell is now unselected</span>
<span class="line-added">3154             assertTrue(sm.isSelected(0, col1));</span>
<span class="line-added">3155             assertTrue(sm.isSelected(0, col2));</span>
<span class="line-added">3156             assertTrue(sm.isSelected(0, col3));</span>
<span class="line-added">3157             assertTrue(sm.isSelected(0, col0));</span>
<span class="line-added">3158             assertTrue(sm.isSelected(1, col4));</span>
<span class="line-added">3159             assertTrue(sm.isSelected(2, col4));</span>
<span class="line-added">3160             assertTrue(sm.isSelected(2, col3));</span>
<span class="line-added">3161             assertTrue(sm.isSelected(2, col2));</span>
<span class="line-added">3162             assertTrue(sm.isSelected(2, col1));</span>
<span class="line-added">3163             assertTrue(sm.isSelected(2, col0));</span>
<span class="line-added">3164             assertTrue(sm.isSelected(1, col0));</span>
<span class="line-added">3165         }</span>
3166     }
3167 
3168     // this is an extension of the previous test, where we had a bug where going up resulted in all cells between the
3169     // anchor (at (0,0)) and the first selected cell in column 0 were being selected. This wasn&#39;t visible in the previous
3170     // test as we only went down two rows, so when we went up everything looked as expected
3171     @Test public void test_rt18439_startAt_row0_col0_clockwise() {
3172         final int items = 10;
3173         tableView.getItems().clear();
3174         for (int i = 0; i &lt; items; i++) {
3175             tableView.getItems().add(&quot;Row &quot; + i);
3176         }
3177 
3178         sm.setCellSelectionEnabled(true);
3179         sm.setSelectionMode(SelectionMode.MULTIPLE);
3180 
3181         sm.clearAndSelect(0, col0);
3182 
<span class="line-modified">3183         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3184             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3185             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3186             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3187             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>
<span class="line-added">3188         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3189             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3190             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-added">3191             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3192             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 4</span>
<span class="line-added">3193         }</span>
3194 
3195         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
3196         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2
3197         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 3
3198         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 4
3199 
<span class="line-modified">3200         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3201             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3202             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3203             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3204             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-added">3205         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3206             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3207             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-added">3208             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3209             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>
<span class="line-added">3210         }</span>
3211         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 3
3212         assertEquals(0, getAnchor().getRow());
3213         assertEquals(0, getAnchor().getColumn());           // anchor does not move
3214         assertTrue(fm.isFocused(3, col0));
3215         assertTrue(sm.isSelected(0, col0));
3216         assertTrue(sm.isSelected(0, col1));
3217         assertTrue(sm.isSelected(0, col2));
3218         assertTrue(sm.isSelected(0, col3));
3219         assertTrue(sm.isSelected(0, col4));
3220         assertTrue(sm.isSelected(1, col4));
3221         assertTrue(sm.isSelected(2, col4));
3222         assertTrue(sm.isSelected(3, col4));
3223         assertTrue(sm.isSelected(4, col4));
3224         assertTrue(sm.isSelected(4, col3));
3225         assertTrue(sm.isSelected(4, col2));
3226         assertTrue(sm.isSelected(4, col1));
3227         assertTrue(sm.isSelected(4, col0));
3228         assertTrue(sm.isSelected(3, col0));
3229 
3230         // critical part - these cells should not be selected!
</pre>
<hr />
<pre>
3232         assertFalse(sm.isSelected(2, col0));
3233     }
3234 
3235     @Test public void test_rt18439_startAt_row0_col4_clockwise() {
3236         final int items = 10;
3237         tableView.getItems().clear();
3238         for (int i = 0; i &lt; items; i++) {
3239             tableView.getItems().add(&quot;Row &quot; + i);
3240         }
3241 
3242         sm.setCellSelectionEnabled(true);
3243         sm.setSelectionMode(SelectionMode.MULTIPLE);
3244 
3245         sm.clearAndSelect(0, col4);
3246 
3247         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
3248         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2
3249         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 3
3250         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 4
3251 
<span class="line-modified">3252         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3253             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3254             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3255             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3256             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-added">3257         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3258             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3259             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-added">3260             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3261             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 0</span>
<span class="line-added">3262         }</span>
3263 
3264         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 3
3265         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 2
3266         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 1
3267         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 0
3268 
<span class="line-modified">3269         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-added">3270             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3271         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3272             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3273         }</span>
3274         assertEquals(0, getAnchor().getRow());
3275         assertEquals(4, getAnchor().getColumn());           // anchor does not move
3276         assertTrue(fm.isFocused(0, col1));
3277         assertTrue(sm.isSelected(0, col4));
3278         assertTrue(sm.isSelected(1, col4));
3279         assertTrue(sm.isSelected(2, col4));
3280         assertTrue(sm.isSelected(3, col4));
3281         assertTrue(sm.isSelected(4, col4));
3282         assertTrue(sm.isSelected(4, col3));
3283         assertTrue(sm.isSelected(4, col2));
3284         assertTrue(sm.isSelected(4, col1));
3285         assertTrue(sm.isSelected(4, col0));
3286         assertTrue(sm.isSelected(3, col0));
3287         assertTrue(sm.isSelected(2, col0));
3288         assertTrue(sm.isSelected(1, col0));
3289         assertTrue(sm.isSelected(0, col0));
3290         assertTrue(sm.isSelected(0, col1));
3291 
3292         // critical part - these cells should not be selected!
3293         assertFalse(sm.isSelected(0, col2));
3294         assertFalse(sm.isSelected(0, col3));
3295     }
3296 
3297     @Test public void test_rt18439_startAt_row4_col4_clockwise() {
3298         final int items = 10;
3299         tableView.getItems().clear();
3300         for (int i = 0; i &lt; items; i++) {
3301             tableView.getItems().add(&quot;Row &quot; + i);
3302         }
3303 
3304         sm.setCellSelectionEnabled(true);
3305         sm.setSelectionMode(SelectionMode.MULTIPLE);
3306 
3307         sm.clearAndSelect(4, col4);
3308 
<span class="line-modified">3309         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3310             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-modified">3311             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3312             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3313             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 0</span>
<span class="line-added">3314         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3315             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3316             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-added">3317             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3318             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 0</span>
<span class="line-added">3319         }</span>
3320 
3321         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 3
3322         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 2
3323         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 1
3324         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT);   // row 0
3325 
<span class="line-modified">3326         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3327             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 1</span>
<span class="line-modified">3328             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 2</span>
<span class="line-modified">3329             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3330             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 4</span>
<span class="line-added">3331         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3332             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 1</span>
<span class="line-added">3333             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 2</span>
<span class="line-added">3334             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3335             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 4</span>
<span class="line-added">3336         }</span>
3337 
3338         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
3339         assertEquals(4, getAnchor().getRow());
3340         assertEquals(4, getAnchor().getColumn());           // anchor does not move
3341         assertTrue(fm.isFocused(1, col4));
3342         assertTrue(sm.isSelected(4, col4));
3343         assertTrue(sm.isSelected(4, col2));
3344         assertTrue(sm.isSelected(4, col2));
3345         assertTrue(sm.isSelected(4, col1));
3346         assertTrue(sm.isSelected(4, col0));
3347         assertTrue(sm.isSelected(3, col0));
3348         assertTrue(sm.isSelected(2, col0));
3349         assertTrue(sm.isSelected(1, col0));
3350         assertTrue(sm.isSelected(0, col0));
3351         assertTrue(sm.isSelected(0, col1));
3352         assertTrue(sm.isSelected(0, col2));
3353         assertTrue(sm.isSelected(0, col3));
3354         assertTrue(sm.isSelected(0, col4));
3355         assertTrue(sm.isSelected(1, col4));
3356 
</pre>
<hr />
<pre>
3359         assertFalse(sm.isSelected(3, col4));
3360     }
3361 
3362     @Test public void test_rt18439_startAt_row4_col0_clockwise() {
3363         final int items = 10;
3364         tableView.getItems().clear();
3365         for (int i = 0; i &lt; items; i++) {
3366             tableView.getItems().add(&quot;Row &quot; + i);
3367         }
3368 
3369         sm.setCellSelectionEnabled(true);
3370         sm.setSelectionMode(SelectionMode.MULTIPLE);
3371 
3372         sm.clearAndSelect(4, col0);
3373 
3374         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 3
3375         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 2
3376         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 1
3377         keyboard.doKeyPress(KeyCode.UP, KeyModifier.SHIFT); // row 0
3378 
<span class="line-modified">3379         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">3380             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 1</span>
<span class="line-modified">3381             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 2</span>
<span class="line-modified">3382             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 3</span>
<span class="line-added">3383             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT);   // col 4</span>
<span class="line-added">3384         } if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3385             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT);   // col 1</span>
<span class="line-added">3386             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT);   // col 2</span>
<span class="line-added">3387             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT);   // col 3</span>
<span class="line-added">3388             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT);   // col 4</span>
<span class="line-added">3389         }</span>
3390 
3391         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 1
3392         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 2
3393         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 3
3394         keyboard.doKeyPress(KeyCode.DOWN, KeyModifier.SHIFT); // row 4
3395 
<span class="line-modified">3396         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-added">3397             keyboard.doKeyPress(KeyCode.LEFT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3398         } if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">3399             keyboard.doKeyPress(KeyCode.RIGHT, KeyModifier.SHIFT); // col 3</span>
<span class="line-added">3400         }</span>
3401         assertEquals(4, getAnchor().getRow());
3402         assertEquals(0, getAnchor().getColumn());           // anchor does not move
3403         assertTrue(fm.isFocused(4, col3));
3404         assertTrue(sm.isSelected(4, col0));
3405         assertTrue(sm.isSelected(3, col0));
3406         assertTrue(sm.isSelected(2, col0));
3407         assertTrue(sm.isSelected(1, col0));
3408         assertTrue(sm.isSelected(0, col0));
3409         assertTrue(sm.isSelected(0, col1));
3410         assertTrue(sm.isSelected(0, col2));
3411         assertTrue(sm.isSelected(0, col3));
3412         assertTrue(sm.isSelected(0, col4));
3413         assertTrue(sm.isSelected(1, col4));
3414         assertTrue(sm.isSelected(2, col4));
3415         assertTrue(sm.isSelected(3, col4));
3416         assertTrue(sm.isSelected(4, col4));
3417         assertTrue(sm.isSelected(4, col3));
3418 
3419         // critical part - these cells should not be selected!
3420         assertFalse(sm.isSelected(4, col2));
</pre>
<hr />
<pre>
4346 
4347         if (resetSelection) {
4348             sm.clearAndSelect(0, col);
4349 
4350             TablePosition&lt;?,?&gt; anchor = TableCellBehavior.getAnchor(tableView, null);
4351             assertEquals(0, anchor.getRow());
4352             assertEquals(col, anchor.getTableColumn());
4353         } else {
4354             expectedSize = mode == SelectionMode.SINGLE ? 1 : 10;
4355         }
4356 
4357         keyboard.doKeyPress(KeyCode.END, KeyModifier.SHIFT);
4358         assertEquals(expectedSize, indices.size());
4359         assertEquals(expectedSize, cells.size());
4360         assertTrue(sm.isSelected(9, col));
4361 
4362         sl.dispose();
4363     }
4364 
4365     @Test public void test_rt_18440_goLeft() {
<span class="line-modified">4366         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4367             test_rt_18440(KeyCode.LEFT, 3, false, colIndex -&gt; {</span>
<span class="line-modified">4368                 keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4369                 return colIndex - 1;</span>
<span class="line-added">4370             });</span>
<span class="line-added">4371         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4372             test_rt_18440(KeyCode.LEFT, 0, false, colIndex -&gt; {</span>
<span class="line-added">4373                 keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">4374                 return colIndex + 1;</span>
<span class="line-added">4375             });</span>
<span class="line-added">4376         }</span>
4377     }
4378 
4379     @Test public void test_rt_18440_goLeft_toEnd() {
<span class="line-modified">4380         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4381             test_rt_18440(KeyCode.LEFT, 3, true, colIndex -&gt; {</span>
<span class="line-modified">4382                 keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4383                 return colIndex - 1;</span>
<span class="line-added">4384             });</span>
<span class="line-added">4385         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4386             test_rt_18440(KeyCode.LEFT, 0, true, colIndex -&gt; {</span>
<span class="line-added">4387                 keyboard.doLeftArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">4388                 return colIndex + 1;</span>
<span class="line-added">4389             });</span>
<span class="line-added">4390         }</span>
4391     }
4392 
4393     @Test public void test_rt_18440_goRight() {
<span class="line-modified">4394         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4395             test_rt_18440(KeyCode.RIGHT, 0, false, colIndex -&gt; {</span>
<span class="line-modified">4396                 keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4397                 return colIndex + 1;</span>
<span class="line-added">4398             });</span>
<span class="line-added">4399         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4400             test_rt_18440(KeyCode.RIGHT, 3, false, colIndex -&gt; {</span>
<span class="line-added">4401                 keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">4402                 return colIndex - 1;</span>
<span class="line-added">4403             });</span>
<span class="line-added">4404         }</span>
4405     }
4406 
4407     @Test public void test_rt_18440_goRight_toEnd() {
<span class="line-modified">4408         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4409             test_rt_18440(KeyCode.RIGHT, 0, true, colIndex -&gt; {</span>
<span class="line-modified">4410                 keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-modified">4411                 return colIndex + 1;</span>
<span class="line-added">4412             });</span>
<span class="line-added">4413         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4414             test_rt_18440(KeyCode.RIGHT, 3, true, colIndex -&gt; {</span>
<span class="line-added">4415                 keyboard.doRightArrowPress(KeyModifier.getShortcutKey());</span>
<span class="line-added">4416                 return colIndex - 1;</span>
<span class="line-added">4417             });</span>
<span class="line-added">4418         }</span>
4419     }
4420 
4421     private void test_rt_18440(KeyCode direction, int startColumn, boolean goToEnd, Function&lt;Integer, Integer&gt; r) {
4422         ObservableList&lt;String&gt; itemsList = FXCollections.observableArrayList();
4423         for (int i = 0; i &lt; 10; i++) {
4424             itemsList.add(&quot;Row &quot; + i);
4425         }
4426 
4427         tableView.setItems(itemsList);
4428 
4429         tableView.getColumns().clear();
4430         for (int i = 0; i &lt; 4; i++) {
4431             TableColumn&lt;String, String&gt; col = new TableColumn&lt;&gt;(&quot;Column &quot; + i);
4432             col.setCellValueFactory(param -&gt; new ReadOnlyStringWrapper(param.getValue()));
4433             tableView.getColumns().add(col);
4434         }
4435 
4436         TableView.TableViewFocusModel fm = tableView.getFocusModel();
4437         TableView.TableViewSelectionModel&lt;String&gt; sm = tableView.getSelectionModel();
4438         sm.setSelectionMode(SelectionMode.MULTIPLE);
</pre>
<hr />
<pre>
4455         int expectedColumn = r.apply(startColumn);
4456         assertEquals(0, sm.getSelectedIndex());
4457         assertEquals(tableView.getColumns().get(startColumn), sm.getSelectedCells().get(0).getTableColumn());
4458         assertEquals(0, fm.getFocusedIndex());
4459         assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());
4460 
4461         expectedColumn = r.apply(expectedColumn);
4462         assertEquals(0, sm.getSelectedIndex());
4463         assertEquals(tableView.getColumns().get(startColumn), sm.getSelectedCells().get(0).getTableColumn());
4464         assertEquals(0, fm.getFocusedIndex());
4465         assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());
4466 
4467         if (goToEnd) {
4468             expectedColumn = r.apply(expectedColumn);
4469             assertEquals(0, sm.getSelectedIndex());
4470             assertEquals(tableView.getColumns().get(startColumn), sm.getSelectedCells().get(0).getTableColumn());
4471             assertEquals(0, fm.getFocusedIndex());
4472             assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());
4473         }
4474 
<span class="line-modified">4475         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4476             expectedColumn = direction == KeyCode.RIGHT ? 3 : 0;</span>
<span class="line-modified">4477             keyboard.doKeyPress(direction, KeyModifier.SHIFT);</span>
<span class="line-modified">4478             assertEquals(0, sm.getSelectedIndex());</span>
<span class="line-modified">4479             assertEquals(debug(), 4, sm.getSelectedCells().size());</span>
<span class="line-modified">4480             assertEquals(0, fm.getFocusedIndex());</span>
<span class="line-modified">4481             assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());</span>
<span class="line-added">4482         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4483             expectedColumn = direction == KeyCode.LEFT ? 3 : 0;</span>
<span class="line-added">4484             keyboard.doKeyPress(direction, KeyModifier.SHIFT);</span>
<span class="line-added">4485             assertEquals(0, sm.getSelectedIndex());</span>
<span class="line-added">4486             assertEquals(debug(), 4, sm.getSelectedCells().size());</span>
<span class="line-added">4487             assertEquals(0, fm.getFocusedIndex());</span>
<span class="line-added">4488             assertEquals(tableView.getColumns().get(expectedColumn), fm.getFocusedCell().getTableColumn());</span>
<span class="line-added">4489         }</span>
4490         sl.dispose();
4491     }
4492 
4493     @Test public void test_rt_24865_moveDownwards() {
4494         tableView.getItems().clear();
4495         for (int i = 0; i &lt; 100; i++) {
4496             tableView.getItems().add(&quot;Row &quot; + i);
4497         }
4498 
4499         Toolkit.getToolkit().firePulse();
4500 
4501         ObservableList&lt;Integer&gt; indices = sm.getSelectedIndices();
4502 
4503         sm.select(0);
4504         assertTrue(isSelected(0));
4505         assertTrue(fm.isFocused(0));
4506         assertEquals(1, indices.size());
4507         assertEquals(0, ((TablePosition)TableCellBehavior.getAnchor(tableView, null)).getRow());
4508 
4509         keyboard.doDownArrowPress(KeyModifier.SHIFT);
</pre>
<hr />
<pre>
4582         // main point of test: selection between the last index (47) and the focus
4583         // index (44) should now be true
4584         keyboard.doKeyPress(KeyCode.PAGE_UP, KeyModifier.getShortcutKey(), KeyModifier.SHIFT);
4585         final int selectedRowCount = indices.size();
4586         for (int i = 0; i &lt; selectedRowCount; i++) {
4587             assertTrue(isSelected(50 - i));
4588         }
4589         assertTrue(fm.isFocused(50 - selectedRowCount + 1));
4590         assertEquals(50, ((TablePosition)TableCellBehavior.getAnchor(tableView, null)).getRow());
4591 
4592         keyboard.doUpArrowPress(KeyModifier.SHIFT);
4593         int newSelectedRowCount = selectedRowCount + 1;
4594         for (int i = 0; i &lt; newSelectedRowCount; i++) {
4595             assertTrue(isSelected(50 - i));
4596         }
4597         assertTrue(fm.isFocused(50 - newSelectedRowCount + 1));
4598         assertEquals(50, ((TablePosition)TableCellBehavior.getAnchor(tableView, null)).getRow());
4599     }
4600 
4601     @Test public void test_rt_39792_goLeft_goPastEnd() {
<span class="line-modified">4602 </span>
<span class="line-modified">4603         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4604             test_rt_39792(3, colIndex -&gt; {</span>
<span class="line-modified">4605                 keyboard.doLeftArrowPress(KeyModifier.SHIFT);</span>
<span class="line-added">4606                 return colIndex - 1;</span>
<span class="line-added">4607             });</span>
<span class="line-added">4608         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4609             test_rt_39792(0, colIndex -&gt; {</span>
<span class="line-added">4610                 keyboard.doLeftArrowPress(KeyModifier.SHIFT);</span>
<span class="line-added">4611                 return colIndex + 1;</span>
<span class="line-added">4612             });</span>
<span class="line-added">4613         }</span>
4614     }
4615 
4616     @Test public void test_rt_39792_goRight_goPastEnd() {
<span class="line-modified">4617 </span>
<span class="line-modified">4618         if (orientation == NodeOrientation.LEFT_TO_RIGHT) {</span>
<span class="line-modified">4619             test_rt_39792(0, colIndex -&gt; {</span>
<span class="line-modified">4620                 keyboard.doRightArrowPress(KeyModifier.SHIFT);</span>
<span class="line-added">4621                 return colIndex + 1;</span>
<span class="line-added">4622             });</span>
<span class="line-added">4623         } else if (orientation == NodeOrientation.RIGHT_TO_LEFT) {</span>
<span class="line-added">4624             test_rt_39792(3, colIndex -&gt; {</span>
<span class="line-added">4625                 keyboard.doRightArrowPress(KeyModifier.SHIFT);</span>
<span class="line-added">4626                 return colIndex - 1;</span>
<span class="line-added">4627             });</span>
<span class="line-added">4628         }</span>
4629     }
4630 
4631     private void test_rt_39792(int startColumn, Function&lt;Integer, Integer&gt; r) {
4632         ObservableList&lt;String&gt; itemsList = FXCollections.observableArrayList();
4633         for (int i = 0; i &lt; 10; i++) {
4634             itemsList.add(&quot;Row &quot; + i);
4635         }
4636 
4637         tableView.setItems(itemsList);
4638 
4639         tableView.getColumns().clear();
4640         for (int i = 0; i &lt; 4; i++) {
4641             TableColumn&lt;String, String&gt; col = new TableColumn&lt;&gt;(&quot;Column &quot; + i);
4642             col.setCellValueFactory(param -&gt; new ReadOnlyStringWrapper(param.getValue()));
4643             tableView.getColumns().add(col);
4644         }
4645 
4646         TableView.TableViewSelectionModel&lt;String&gt; sm = tableView.getSelectionModel();
4647         sm.setSelectionMode(SelectionMode.MULTIPLE);
4648         sm.setCellSelectionEnabled(true);
</pre>
</td>
</tr>
</table>
<center><a href="../../../../../../main/java/com/sun/javafx/scene/control/behavior/TableViewBehaviorBase.java.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../../../index.html" target="_top">index</a> next &gt;</center>  </body>
</html>