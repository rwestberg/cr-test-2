<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames modules/javafx.web/src/main/native/Source/ThirdParty/sqlite/sqlite3.h</title>
    <link rel="stylesheet" href="../../../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>    1 /*
    2 ** 2001-09-15
    3 **
    4 ** The author disclaims copyright to this source code.  In place of
    5 ** a legal notice, here is a blessing:
    6 **
    7 **    May you do good and not evil.
    8 **    May you find forgiveness for yourself and forgive others.
    9 **    May you share freely, never taking more than you give.
   10 **
   11 *************************************************************************
   12 ** This header file defines the interface that the SQLite library
   13 ** presents to client programs.  If a C-function, structure, datatype,
   14 ** or constant definition does not appear in this file, then it is
   15 ** not a published API of SQLite, is subject to change without
   16 ** notice, and should not be referenced by programs that use SQLite.
   17 **
   18 ** Some of the definitions that are in this file are marked as
   19 ** &quot;experimental&quot;.  Experimental interfaces are normally new
   20 ** features recently added to SQLite.  We do not anticipate changes
   21 ** to experimental interfaces but reserve the right to make minor changes
   22 ** if experience from use &quot;in the wild&quot; suggest such changes are prudent.
   23 **
   24 ** The official C-language API documentation for SQLite is derived
   25 ** from comments in this file.  This file is the authoritative source
   26 ** on how SQLite interfaces are supposed to operate.
   27 **
   28 ** The name of this file under configuration management is &quot;sqlite.h.in&quot;.
   29 ** The makefile makes some minor changes to this file (such as inserting
   30 ** the version number) and changes its name to &quot;sqlite3.h&quot; as
   31 ** part of the build process.
   32 */
   33 #ifndef SQLITE3_H
   34 #define SQLITE3_H
   35 #include &lt;stdarg.h&gt;     /* Needed for the definition of va_list */
   36 
   37 /*
   38 ** Make sure we can call this stuff from C++.
   39 */
   40 #ifdef __cplusplus
   41 extern &quot;C&quot; {
   42 #endif
   43 
   44 
   45 /*
   46 ** Provide the ability to override linkage features of the interface.
   47 */
   48 #ifndef SQLITE_EXTERN
   49 # define SQLITE_EXTERN extern
   50 #endif
   51 #ifndef SQLITE_API
   52 # define SQLITE_API
   53 #endif
   54 #ifndef SQLITE_CDECL
   55 # define SQLITE_CDECL
   56 #endif
   57 #ifndef SQLITE_APICALL
   58 # define SQLITE_APICALL
   59 #endif
   60 #ifndef SQLITE_STDCALL
   61 # define SQLITE_STDCALL SQLITE_APICALL
   62 #endif
   63 #ifndef SQLITE_CALLBACK
   64 # define SQLITE_CALLBACK
   65 #endif
   66 #ifndef SQLITE_SYSAPI
   67 # define SQLITE_SYSAPI
   68 #endif
   69 
   70 /*
   71 ** These no-op macros are used in front of interfaces to mark those
   72 ** interfaces as either deprecated or experimental.  New applications
   73 ** should not use deprecated interfaces - they are supported for backwards
   74 ** compatibility only.  Application writers should be aware that
   75 ** experimental interfaces are subject to change in point releases.
   76 **
   77 ** These macros used to resolve to various kinds of compiler magic that
   78 ** would generate warning messages when they were used.  But that
   79 ** compiler magic ended up generating such a flurry of bug reports
   80 ** that we have taken it all out and gone back to using simple
   81 ** noop macros.
   82 */
   83 #define SQLITE_DEPRECATED
   84 #define SQLITE_EXPERIMENTAL
   85 
   86 /*
   87 ** Ensure these symbols were not defined by some previous header file.
   88 */
   89 #ifdef SQLITE_VERSION
   90 # undef SQLITE_VERSION
   91 #endif
   92 #ifdef SQLITE_VERSION_NUMBER
   93 # undef SQLITE_VERSION_NUMBER
   94 #endif
   95 
   96 /*
   97 ** CAPI3REF: Compile-Time Library Version Numbers
   98 **
   99 ** ^(The [SQLITE_VERSION] C preprocessor macro in the sqlite3.h header
  100 ** evaluates to a string literal that is the SQLite version in the
  101 ** format &quot;X.Y.Z&quot; where X is the major version number (always 3 for
  102 ** SQLite3) and Y is the minor version number and Z is the release number.)^
  103 ** ^(The [SQLITE_VERSION_NUMBER] C preprocessor macro resolves to an integer
  104 ** with the value (X*1000000 + Y*1000 + Z) where X, Y, and Z are the same
  105 ** numbers used in [SQLITE_VERSION].)^
  106 ** The SQLITE_VERSION_NUMBER for any given release of SQLite will also
  107 ** be larger than the release from which it is derived.  Either Y will
  108 ** be held constant and Z will be incremented or else Y will be incremented
  109 ** and Z will be reset to zero.
  110 **
  111 ** Since [version 3.6.18] ([dateof:3.6.18]),
  112 ** SQLite source code has been stored in the
  113 ** &lt;a href=&quot;http://www.fossil-scm.org/&quot;&gt;Fossil configuration management
  114 ** system&lt;/a&gt;.  ^The SQLITE_SOURCE_ID macro evaluates to
  115 ** a string which identifies a particular check-in of SQLite
  116 ** within its configuration management system.  ^The SQLITE_SOURCE_ID
  117 ** string contains the date and time of the check-in (UTC) and a SHA1
  118 ** or SHA3-256 hash of the entire source tree.  If the source code has
  119 ** been edited in any way since it was last checked in, then the last
  120 ** four hexadecimal digits of the hash may be modified.
  121 **
  122 ** See also: [sqlite3_libversion()],
  123 ** [sqlite3_libversion_number()], [sqlite3_sourceid()],
  124 ** [sqlite_version()] and [sqlite_source_id()].
  125 */
<a name="1" id="anc1"></a><span class="line-modified">  126 #define SQLITE_VERSION        &quot;3.31.1&quot;</span>
<span class="line-modified">  127 #define SQLITE_VERSION_NUMBER 3031001</span>
<span class="line-modified">  128 #define SQLITE_SOURCE_ID      &quot;2020-01-27 19:55:54 3bfa9cc97da10598521b342961df8f5f68c7388fa117345eeb516eaa837bb4d6&quot;</span>
  129 
  130 /*
  131 ** CAPI3REF: Run-Time Library Version Numbers
  132 ** KEYWORDS: sqlite3_version sqlite3_sourceid
  133 **
  134 ** These interfaces provide the same information as the [SQLITE_VERSION],
  135 ** [SQLITE_VERSION_NUMBER], and [SQLITE_SOURCE_ID] C preprocessor macros
  136 ** but are associated with the library instead of the header file.  ^(Cautious
  137 ** programmers might include assert() statements in their application to
  138 ** verify that values returned by these interfaces match the macros in
  139 ** the header, and thus ensure that the application is
  140 ** compiled with matching library and header files.
  141 **
  142 ** &lt;blockquote&gt;&lt;pre&gt;
  143 ** assert( sqlite3_libversion_number()==SQLITE_VERSION_NUMBER );
  144 ** assert( strncmp(sqlite3_sourceid(),SQLITE_SOURCE_ID,80)==0 );
  145 ** assert( strcmp(sqlite3_libversion(),SQLITE_VERSION)==0 );
  146 ** &lt;/pre&gt;&lt;/blockquote&gt;)^
  147 **
  148 ** ^The sqlite3_version[] string constant contains the text of [SQLITE_VERSION]
  149 ** macro.  ^The sqlite3_libversion() function returns a pointer to the
  150 ** to the sqlite3_version[] string constant.  The sqlite3_libversion()
  151 ** function is provided for use in DLLs since DLL users usually do not have
  152 ** direct access to string constants within the DLL.  ^The
  153 ** sqlite3_libversion_number() function returns an integer equal to
  154 ** [SQLITE_VERSION_NUMBER].  ^(The sqlite3_sourceid() function returns
  155 ** a pointer to a string constant whose value is the same as the
  156 ** [SQLITE_SOURCE_ID] C preprocessor macro.  Except if SQLite is built
  157 ** using an edited copy of [the amalgamation], then the last four characters
  158 ** of the hash might be different from [SQLITE_SOURCE_ID].)^
  159 **
  160 ** See also: [sqlite_version()] and [sqlite_source_id()].
  161 */
  162 SQLITE_API SQLITE_EXTERN const char sqlite3_version[];
  163 SQLITE_API const char *sqlite3_libversion(void);
  164 SQLITE_API const char *sqlite3_sourceid(void);
  165 SQLITE_API int sqlite3_libversion_number(void);
  166 
  167 /*
  168 ** CAPI3REF: Run-Time Library Compilation Options Diagnostics
  169 **
  170 ** ^The sqlite3_compileoption_used() function returns 0 or 1
  171 ** indicating whether the specified option was defined at
  172 ** compile time.  ^The SQLITE_ prefix may be omitted from the
  173 ** option name passed to sqlite3_compileoption_used().
  174 **
  175 ** ^The sqlite3_compileoption_get() function allows iterating
  176 ** over the list of options that were defined at compile time by
  177 ** returning the N-th compile time option string.  ^If N is out of range,
  178 ** sqlite3_compileoption_get() returns a NULL pointer.  ^The SQLITE_
  179 ** prefix is omitted from any strings returned by
  180 ** sqlite3_compileoption_get().
  181 **
  182 ** ^Support for the diagnostic functions sqlite3_compileoption_used()
  183 ** and sqlite3_compileoption_get() may be omitted by specifying the
  184 ** [SQLITE_OMIT_COMPILEOPTION_DIAGS] option at compile time.
  185 **
  186 ** See also: SQL functions [sqlite_compileoption_used()] and
  187 ** [sqlite_compileoption_get()] and the [compile_options pragma].
  188 */
  189 #ifndef SQLITE_OMIT_COMPILEOPTION_DIAGS
  190 SQLITE_API int sqlite3_compileoption_used(const char *zOptName);
  191 SQLITE_API const char *sqlite3_compileoption_get(int N);
  192 #else
  193 # define sqlite3_compileoption_used(X) 0
  194 # define sqlite3_compileoption_get(X)  ((void*)0)
  195 #endif
  196 
  197 /*
  198 ** CAPI3REF: Test To See If The Library Is Threadsafe
  199 **
  200 ** ^The sqlite3_threadsafe() function returns zero if and only if
  201 ** SQLite was compiled with mutexing code omitted due to the
  202 ** [SQLITE_THREADSAFE] compile-time option being set to 0.
  203 **
  204 ** SQLite can be compiled with or without mutexes.  When
  205 ** the [SQLITE_THREADSAFE] C preprocessor macro is 1 or 2, mutexes
  206 ** are enabled and SQLite is threadsafe.  When the
  207 ** [SQLITE_THREADSAFE] macro is 0,
  208 ** the mutexes are omitted.  Without the mutexes, it is not safe
  209 ** to use SQLite concurrently from more than one thread.
  210 **
  211 ** Enabling mutexes incurs a measurable performance penalty.
  212 ** So if speed is of utmost importance, it makes sense to disable
  213 ** the mutexes.  But for maximum safety, mutexes should be enabled.
  214 ** ^The default behavior is for mutexes to be enabled.
  215 **
  216 ** This interface can be used by an application to make sure that the
  217 ** version of SQLite that it is linking against was compiled with
  218 ** the desired setting of the [SQLITE_THREADSAFE] macro.
  219 **
  220 ** This interface only reports on the compile-time mutex setting
  221 ** of the [SQLITE_THREADSAFE] flag.  If SQLite is compiled with
  222 ** SQLITE_THREADSAFE=1 or =2 then mutexes are enabled by default but
  223 ** can be fully or partially disabled using a call to [sqlite3_config()]
  224 ** with the verbs [SQLITE_CONFIG_SINGLETHREAD], [SQLITE_CONFIG_MULTITHREAD],
  225 ** or [SQLITE_CONFIG_SERIALIZED].  ^(The return value of the
  226 ** sqlite3_threadsafe() function shows only the compile-time setting of
  227 ** thread safety, not any run-time changes to that setting made by
  228 ** sqlite3_config(). In other words, the return value from sqlite3_threadsafe()
  229 ** is unchanged by calls to sqlite3_config().)^
  230 **
  231 ** See the [threading mode] documentation for additional information.
  232 */
  233 SQLITE_API int sqlite3_threadsafe(void);
  234 
  235 /*
  236 ** CAPI3REF: Database Connection Handle
  237 ** KEYWORDS: {database connection} {database connections}
  238 **
  239 ** Each open SQLite database is represented by a pointer to an instance of
  240 ** the opaque structure named &quot;sqlite3&quot;.  It is useful to think of an sqlite3
  241 ** pointer as an object.  The [sqlite3_open()], [sqlite3_open16()], and
  242 ** [sqlite3_open_v2()] interfaces are its constructors, and [sqlite3_close()]
  243 ** and [sqlite3_close_v2()] are its destructors.  There are many other
  244 ** interfaces (such as
  245 ** [sqlite3_prepare_v2()], [sqlite3_create_function()], and
  246 ** [sqlite3_busy_timeout()] to name but three) that are methods on an
  247 ** sqlite3 object.
  248 */
  249 typedef struct sqlite3 sqlite3;
  250 
  251 /*
  252 ** CAPI3REF: 64-Bit Integer Types
  253 ** KEYWORDS: sqlite_int64 sqlite_uint64
  254 **
  255 ** Because there is no cross-platform way to specify 64-bit integer types
  256 ** SQLite includes typedefs for 64-bit signed and unsigned integers.
  257 **
  258 ** The sqlite3_int64 and sqlite3_uint64 are the preferred type definitions.
  259 ** The sqlite_int64 and sqlite_uint64 types are supported for backwards
  260 ** compatibility only.
  261 **
  262 ** ^The sqlite3_int64 and sqlite_int64 types can store integer values
  263 ** between -9223372036854775808 and +9223372036854775807 inclusive.  ^The
  264 ** sqlite3_uint64 and sqlite_uint64 types can store integer values
  265 ** between 0 and +18446744073709551615 inclusive.
  266 */
  267 #ifdef SQLITE_INT64_TYPE
  268   typedef SQLITE_INT64_TYPE sqlite_int64;
  269 # ifdef SQLITE_UINT64_TYPE
  270     typedef SQLITE_UINT64_TYPE sqlite_uint64;
  271 # else
  272     typedef unsigned SQLITE_INT64_TYPE sqlite_uint64;
  273 # endif
  274 #elif defined(_MSC_VER) || defined(__BORLANDC__)
  275   typedef __int64 sqlite_int64;
  276   typedef unsigned __int64 sqlite_uint64;
  277 #else
  278   typedef long long int sqlite_int64;
  279   typedef unsigned long long int sqlite_uint64;
  280 #endif
  281 typedef sqlite_int64 sqlite3_int64;
  282 typedef sqlite_uint64 sqlite3_uint64;
  283 
  284 /*
  285 ** If compiling for a processor that lacks floating point support,
  286 ** substitute integer for floating-point.
  287 */
  288 #ifdef SQLITE_OMIT_FLOATING_POINT
  289 # define double sqlite3_int64
  290 #endif
  291 
  292 /*
  293 ** CAPI3REF: Closing A Database Connection
  294 ** DESTRUCTOR: sqlite3
  295 **
  296 ** ^The sqlite3_close() and sqlite3_close_v2() routines are destructors
  297 ** for the [sqlite3] object.
  298 ** ^Calls to sqlite3_close() and sqlite3_close_v2() return [SQLITE_OK] if
  299 ** the [sqlite3] object is successfully destroyed and all associated
  300 ** resources are deallocated.
  301 **
  302 ** ^If the database connection is associated with unfinalized prepared
  303 ** statements or unfinished sqlite3_backup objects then sqlite3_close()
  304 ** will leave the database connection open and return [SQLITE_BUSY].
  305 ** ^If sqlite3_close_v2() is called with unfinalized prepared statements
  306 ** and/or unfinished sqlite3_backups, then the database connection becomes
  307 ** an unusable &quot;zombie&quot; which will automatically be deallocated when the
  308 ** last prepared statement is finalized or the last sqlite3_backup is
  309 ** finished.  The sqlite3_close_v2() interface is intended for use with
  310 ** host languages that are garbage collected, and where the order in which
  311 ** destructors are called is arbitrary.
  312 **
  313 ** Applications should [sqlite3_finalize | finalize] all [prepared statements],
  314 ** [sqlite3_blob_close | close] all [BLOB handles], and
  315 ** [sqlite3_backup_finish | finish] all [sqlite3_backup] objects associated
  316 ** with the [sqlite3] object prior to attempting to close the object.  ^If
  317 ** sqlite3_close_v2() is called on a [database connection] that still has
  318 ** outstanding [prepared statements], [BLOB handles], and/or
  319 ** [sqlite3_backup] objects then it returns [SQLITE_OK] and the deallocation
  320 ** of resources is deferred until all [prepared statements], [BLOB handles],
  321 ** and [sqlite3_backup] objects are also destroyed.
  322 **
  323 ** ^If an [sqlite3] object is destroyed while a transaction is open,
  324 ** the transaction is automatically rolled back.
  325 **
  326 ** The C parameter to [sqlite3_close(C)] and [sqlite3_close_v2(C)]
  327 ** must be either a NULL
  328 ** pointer or an [sqlite3] object pointer obtained
  329 ** from [sqlite3_open()], [sqlite3_open16()], or
  330 ** [sqlite3_open_v2()], and not previously closed.
  331 ** ^Calling sqlite3_close() or sqlite3_close_v2() with a NULL pointer
  332 ** argument is a harmless no-op.
  333 */
  334 SQLITE_API int sqlite3_close(sqlite3*);
  335 SQLITE_API int sqlite3_close_v2(sqlite3*);
  336 
  337 /*
  338 ** The type for a callback function.
  339 ** This is legacy and deprecated.  It is included for historical
  340 ** compatibility and is not documented.
  341 */
  342 typedef int (*sqlite3_callback)(void*,int,char**, char**);
  343 
  344 /*
  345 ** CAPI3REF: One-Step Query Execution Interface
  346 ** METHOD: sqlite3
  347 **
  348 ** The sqlite3_exec() interface is a convenience wrapper around
  349 ** [sqlite3_prepare_v2()], [sqlite3_step()], and [sqlite3_finalize()],
  350 ** that allows an application to run multiple statements of SQL
  351 ** without having to use a lot of C code.
  352 **
  353 ** ^The sqlite3_exec() interface runs zero or more UTF-8 encoded,
  354 ** semicolon-separate SQL statements passed into its 2nd argument,
  355 ** in the context of the [database connection] passed in as its 1st
  356 ** argument.  ^If the callback function of the 3rd argument to
  357 ** sqlite3_exec() is not NULL, then it is invoked for each result row
  358 ** coming out of the evaluated SQL statements.  ^The 4th argument to
  359 ** sqlite3_exec() is relayed through to the 1st argument of each
  360 ** callback invocation.  ^If the callback pointer to sqlite3_exec()
  361 ** is NULL, then no callback is ever invoked and result rows are
  362 ** ignored.
  363 **
  364 ** ^If an error occurs while evaluating the SQL statements passed into
  365 ** sqlite3_exec(), then execution of the current statement stops and
  366 ** subsequent statements are skipped.  ^If the 5th parameter to sqlite3_exec()
  367 ** is not NULL then any error message is written into memory obtained
  368 ** from [sqlite3_malloc()] and passed back through the 5th parameter.
  369 ** To avoid memory leaks, the application should invoke [sqlite3_free()]
  370 ** on error message strings returned through the 5th parameter of
  371 ** sqlite3_exec() after the error message string is no longer needed.
  372 ** ^If the 5th parameter to sqlite3_exec() is not NULL and no errors
  373 ** occur, then sqlite3_exec() sets the pointer in its 5th parameter to
  374 ** NULL before returning.
  375 **
  376 ** ^If an sqlite3_exec() callback returns non-zero, the sqlite3_exec()
  377 ** routine returns SQLITE_ABORT without invoking the callback again and
  378 ** without running any subsequent SQL statements.
  379 **
  380 ** ^The 2nd argument to the sqlite3_exec() callback function is the
  381 ** number of columns in the result.  ^The 3rd argument to the sqlite3_exec()
  382 ** callback is an array of pointers to strings obtained as if from
  383 ** [sqlite3_column_text()], one for each column.  ^If an element of a
  384 ** result row is NULL then the corresponding string pointer for the
  385 ** sqlite3_exec() callback is a NULL pointer.  ^The 4th argument to the
  386 ** sqlite3_exec() callback is an array of pointers to strings where each
  387 ** entry represents the name of corresponding result column as obtained
  388 ** from [sqlite3_column_name()].
  389 **
  390 ** ^If the 2nd parameter to sqlite3_exec() is a NULL pointer, a pointer
  391 ** to an empty string, or a pointer that contains only whitespace and/or
  392 ** SQL comments, then no SQL statements are evaluated and the database
  393 ** is not changed.
  394 **
  395 ** Restrictions:
  396 **
  397 ** &lt;ul&gt;
  398 ** &lt;li&gt; The application must ensure that the 1st parameter to sqlite3_exec()
  399 **      is a valid and open [database connection].
  400 ** &lt;li&gt; The application must not close the [database connection] specified by
  401 **      the 1st parameter to sqlite3_exec() while sqlite3_exec() is running.
  402 ** &lt;li&gt; The application must not modify the SQL statement text passed into
  403 **      the 2nd parameter of sqlite3_exec() while sqlite3_exec() is running.
  404 ** &lt;/ul&gt;
  405 */
  406 SQLITE_API int sqlite3_exec(
  407   sqlite3*,                                  /* An open database */
  408   const char *sql,                           /* SQL to be evaluated */
  409   int (*callback)(void*,int,char**,char**),  /* Callback function */
  410   void *,                                    /* 1st argument to callback */
  411   char **errmsg                              /* Error msg written here */
  412 );
  413 
  414 /*
  415 ** CAPI3REF: Result Codes
  416 ** KEYWORDS: {result code definitions}
  417 **
  418 ** Many SQLite functions return an integer result code from the set shown
  419 ** here in order to indicate success or failure.
  420 **
  421 ** New error codes may be added in future versions of SQLite.
  422 **
  423 ** See also: [extended result code definitions]
  424 */
  425 #define SQLITE_OK           0   /* Successful result */
  426 /* beginning-of-error-codes */
  427 #define SQLITE_ERROR        1   /* Generic error */
  428 #define SQLITE_INTERNAL     2   /* Internal logic error in SQLite */
  429 #define SQLITE_PERM         3   /* Access permission denied */
  430 #define SQLITE_ABORT        4   /* Callback routine requested an abort */
  431 #define SQLITE_BUSY         5   /* The database file is locked */
  432 #define SQLITE_LOCKED       6   /* A table in the database is locked */
  433 #define SQLITE_NOMEM        7   /* A malloc() failed */
  434 #define SQLITE_READONLY     8   /* Attempt to write a readonly database */
  435 #define SQLITE_INTERRUPT    9   /* Operation terminated by sqlite3_interrupt()*/
  436 #define SQLITE_IOERR       10   /* Some kind of disk I/O error occurred */
  437 #define SQLITE_CORRUPT     11   /* The database disk image is malformed */
  438 #define SQLITE_NOTFOUND    12   /* Unknown opcode in sqlite3_file_control() */
  439 #define SQLITE_FULL        13   /* Insertion failed because database is full */
  440 #define SQLITE_CANTOPEN    14   /* Unable to open the database file */
  441 #define SQLITE_PROTOCOL    15   /* Database lock protocol error */
  442 #define SQLITE_EMPTY       16   /* Internal use only */
  443 #define SQLITE_SCHEMA      17   /* The database schema changed */
  444 #define SQLITE_TOOBIG      18   /* String or BLOB exceeds size limit */
  445 #define SQLITE_CONSTRAINT  19   /* Abort due to constraint violation */
  446 #define SQLITE_MISMATCH    20   /* Data type mismatch */
  447 #define SQLITE_MISUSE      21   /* Library used incorrectly */
  448 #define SQLITE_NOLFS       22   /* Uses OS features not supported on host */
  449 #define SQLITE_AUTH        23   /* Authorization denied */
  450 #define SQLITE_FORMAT      24   /* Not used */
  451 #define SQLITE_RANGE       25   /* 2nd parameter to sqlite3_bind out of range */
  452 #define SQLITE_NOTADB      26   /* File opened that is not a database file */
  453 #define SQLITE_NOTICE      27   /* Notifications from sqlite3_log() */
  454 #define SQLITE_WARNING     28   /* Warnings from sqlite3_log() */
  455 #define SQLITE_ROW         100  /* sqlite3_step() has another row ready */
  456 #define SQLITE_DONE        101  /* sqlite3_step() has finished executing */
  457 /* end-of-error-codes */
  458 
  459 /*
  460 ** CAPI3REF: Extended Result Codes
  461 ** KEYWORDS: {extended result code definitions}
  462 **
  463 ** In its default configuration, SQLite API routines return one of 30 integer
  464 ** [result codes].  However, experience has shown that many of
  465 ** these result codes are too coarse-grained.  They do not provide as
  466 ** much information about problems as programmers might like.  In an effort to
  467 ** address this, newer versions of SQLite (version 3.3.8 [dateof:3.3.8]
  468 ** and later) include
  469 ** support for additional result codes that provide more detailed information
  470 ** about errors. These [extended result codes] are enabled or disabled
  471 ** on a per database connection basis using the
  472 ** [sqlite3_extended_result_codes()] API.  Or, the extended code for
  473 ** the most recent error can be obtained using
  474 ** [sqlite3_extended_errcode()].
  475 */
  476 #define SQLITE_ERROR_MISSING_COLLSEQ   (SQLITE_ERROR | (1&lt;&lt;8))
  477 #define SQLITE_ERROR_RETRY             (SQLITE_ERROR | (2&lt;&lt;8))
  478 #define SQLITE_ERROR_SNAPSHOT          (SQLITE_ERROR | (3&lt;&lt;8))
  479 #define SQLITE_IOERR_READ              (SQLITE_IOERR | (1&lt;&lt;8))
  480 #define SQLITE_IOERR_SHORT_READ        (SQLITE_IOERR | (2&lt;&lt;8))
  481 #define SQLITE_IOERR_WRITE             (SQLITE_IOERR | (3&lt;&lt;8))
  482 #define SQLITE_IOERR_FSYNC             (SQLITE_IOERR | (4&lt;&lt;8))
  483 #define SQLITE_IOERR_DIR_FSYNC         (SQLITE_IOERR | (5&lt;&lt;8))
  484 #define SQLITE_IOERR_TRUNCATE          (SQLITE_IOERR | (6&lt;&lt;8))
  485 #define SQLITE_IOERR_FSTAT             (SQLITE_IOERR | (7&lt;&lt;8))
  486 #define SQLITE_IOERR_UNLOCK            (SQLITE_IOERR | (8&lt;&lt;8))
  487 #define SQLITE_IOERR_RDLOCK            (SQLITE_IOERR | (9&lt;&lt;8))
  488 #define SQLITE_IOERR_DELETE            (SQLITE_IOERR | (10&lt;&lt;8))
  489 #define SQLITE_IOERR_BLOCKED           (SQLITE_IOERR | (11&lt;&lt;8))
  490 #define SQLITE_IOERR_NOMEM             (SQLITE_IOERR | (12&lt;&lt;8))
  491 #define SQLITE_IOERR_ACCESS            (SQLITE_IOERR | (13&lt;&lt;8))
  492 #define SQLITE_IOERR_CHECKRESERVEDLOCK (SQLITE_IOERR | (14&lt;&lt;8))
  493 #define SQLITE_IOERR_LOCK              (SQLITE_IOERR | (15&lt;&lt;8))
  494 #define SQLITE_IOERR_CLOSE             (SQLITE_IOERR | (16&lt;&lt;8))
  495 #define SQLITE_IOERR_DIR_CLOSE         (SQLITE_IOERR | (17&lt;&lt;8))
  496 #define SQLITE_IOERR_SHMOPEN           (SQLITE_IOERR | (18&lt;&lt;8))
  497 #define SQLITE_IOERR_SHMSIZE           (SQLITE_IOERR | (19&lt;&lt;8))
  498 #define SQLITE_IOERR_SHMLOCK           (SQLITE_IOERR | (20&lt;&lt;8))
  499 #define SQLITE_IOERR_SHMMAP            (SQLITE_IOERR | (21&lt;&lt;8))
  500 #define SQLITE_IOERR_SEEK              (SQLITE_IOERR | (22&lt;&lt;8))
  501 #define SQLITE_IOERR_DELETE_NOENT      (SQLITE_IOERR | (23&lt;&lt;8))
  502 #define SQLITE_IOERR_MMAP              (SQLITE_IOERR | (24&lt;&lt;8))
  503 #define SQLITE_IOERR_GETTEMPPATH       (SQLITE_IOERR | (25&lt;&lt;8))
  504 #define SQLITE_IOERR_CONVPATH          (SQLITE_IOERR | (26&lt;&lt;8))
  505 #define SQLITE_IOERR_VNODE             (SQLITE_IOERR | (27&lt;&lt;8))
  506 #define SQLITE_IOERR_AUTH              (SQLITE_IOERR | (28&lt;&lt;8))
  507 #define SQLITE_IOERR_BEGIN_ATOMIC      (SQLITE_IOERR | (29&lt;&lt;8))
  508 #define SQLITE_IOERR_COMMIT_ATOMIC     (SQLITE_IOERR | (30&lt;&lt;8))
  509 #define SQLITE_IOERR_ROLLBACK_ATOMIC   (SQLITE_IOERR | (31&lt;&lt;8))
  510 #define SQLITE_LOCKED_SHAREDCACHE      (SQLITE_LOCKED |  (1&lt;&lt;8))
  511 #define SQLITE_LOCKED_VTAB             (SQLITE_LOCKED |  (2&lt;&lt;8))
  512 #define SQLITE_BUSY_RECOVERY           (SQLITE_BUSY   |  (1&lt;&lt;8))
  513 #define SQLITE_BUSY_SNAPSHOT           (SQLITE_BUSY   |  (2&lt;&lt;8))
  514 #define SQLITE_CANTOPEN_NOTEMPDIR      (SQLITE_CANTOPEN | (1&lt;&lt;8))
  515 #define SQLITE_CANTOPEN_ISDIR          (SQLITE_CANTOPEN | (2&lt;&lt;8))
  516 #define SQLITE_CANTOPEN_FULLPATH       (SQLITE_CANTOPEN | (3&lt;&lt;8))
  517 #define SQLITE_CANTOPEN_CONVPATH       (SQLITE_CANTOPEN | (4&lt;&lt;8))
  518 #define SQLITE_CANTOPEN_DIRTYWAL       (SQLITE_CANTOPEN | (5&lt;&lt;8)) /* Not Used */
<a name="2" id="anc2"></a><span class="line-added">  519 #define SQLITE_CANTOPEN_SYMLINK        (SQLITE_CANTOPEN | (6&lt;&lt;8))</span>
  520 #define SQLITE_CORRUPT_VTAB            (SQLITE_CORRUPT | (1&lt;&lt;8))
  521 #define SQLITE_CORRUPT_SEQUENCE        (SQLITE_CORRUPT | (2&lt;&lt;8))
  522 #define SQLITE_READONLY_RECOVERY       (SQLITE_READONLY | (1&lt;&lt;8))
  523 #define SQLITE_READONLY_CANTLOCK       (SQLITE_READONLY | (2&lt;&lt;8))
  524 #define SQLITE_READONLY_ROLLBACK       (SQLITE_READONLY | (3&lt;&lt;8))
  525 #define SQLITE_READONLY_DBMOVED        (SQLITE_READONLY | (4&lt;&lt;8))
  526 #define SQLITE_READONLY_CANTINIT       (SQLITE_READONLY | (5&lt;&lt;8))
  527 #define SQLITE_READONLY_DIRECTORY      (SQLITE_READONLY | (6&lt;&lt;8))
  528 #define SQLITE_ABORT_ROLLBACK          (SQLITE_ABORT | (2&lt;&lt;8))
  529 #define SQLITE_CONSTRAINT_CHECK        (SQLITE_CONSTRAINT | (1&lt;&lt;8))
  530 #define SQLITE_CONSTRAINT_COMMITHOOK   (SQLITE_CONSTRAINT | (2&lt;&lt;8))
  531 #define SQLITE_CONSTRAINT_FOREIGNKEY   (SQLITE_CONSTRAINT | (3&lt;&lt;8))
  532 #define SQLITE_CONSTRAINT_FUNCTION     (SQLITE_CONSTRAINT | (4&lt;&lt;8))
  533 #define SQLITE_CONSTRAINT_NOTNULL      (SQLITE_CONSTRAINT | (5&lt;&lt;8))
  534 #define SQLITE_CONSTRAINT_PRIMARYKEY   (SQLITE_CONSTRAINT | (6&lt;&lt;8))
  535 #define SQLITE_CONSTRAINT_TRIGGER      (SQLITE_CONSTRAINT | (7&lt;&lt;8))
  536 #define SQLITE_CONSTRAINT_UNIQUE       (SQLITE_CONSTRAINT | (8&lt;&lt;8))
  537 #define SQLITE_CONSTRAINT_VTAB         (SQLITE_CONSTRAINT | (9&lt;&lt;8))
  538 #define SQLITE_CONSTRAINT_ROWID        (SQLITE_CONSTRAINT |(10&lt;&lt;8))
<a name="3" id="anc3"></a><span class="line-added">  539 #define SQLITE_CONSTRAINT_PINNED       (SQLITE_CONSTRAINT |(11&lt;&lt;8))</span>
  540 #define SQLITE_NOTICE_RECOVER_WAL      (SQLITE_NOTICE | (1&lt;&lt;8))
  541 #define SQLITE_NOTICE_RECOVER_ROLLBACK (SQLITE_NOTICE | (2&lt;&lt;8))
  542 #define SQLITE_WARNING_AUTOINDEX       (SQLITE_WARNING | (1&lt;&lt;8))
  543 #define SQLITE_AUTH_USER               (SQLITE_AUTH | (1&lt;&lt;8))
  544 #define SQLITE_OK_LOAD_PERMANENTLY     (SQLITE_OK | (1&lt;&lt;8))
<a name="4" id="anc4"></a><span class="line-added">  545 #define SQLITE_OK_SYMLINK              (SQLITE_OK | (2&lt;&lt;8))</span>
  546 
  547 /*
  548 ** CAPI3REF: Flags For File Open Operations
  549 **
  550 ** These bit values are intended for use in the
  551 ** 3rd parameter to the [sqlite3_open_v2()] interface and
  552 ** in the 4th parameter to the [sqlite3_vfs.xOpen] method.
  553 */
  554 #define SQLITE_OPEN_READONLY         0x00000001  /* Ok for sqlite3_open_v2() */
  555 #define SQLITE_OPEN_READWRITE        0x00000002  /* Ok for sqlite3_open_v2() */
  556 #define SQLITE_OPEN_CREATE           0x00000004  /* Ok for sqlite3_open_v2() */
  557 #define SQLITE_OPEN_DELETEONCLOSE    0x00000008  /* VFS only */
  558 #define SQLITE_OPEN_EXCLUSIVE        0x00000010  /* VFS only */
  559 #define SQLITE_OPEN_AUTOPROXY        0x00000020  /* VFS only */
  560 #define SQLITE_OPEN_URI              0x00000040  /* Ok for sqlite3_open_v2() */
  561 #define SQLITE_OPEN_MEMORY           0x00000080  /* Ok for sqlite3_open_v2() */
  562 #define SQLITE_OPEN_MAIN_DB          0x00000100  /* VFS only */
  563 #define SQLITE_OPEN_TEMP_DB          0x00000200  /* VFS only */
  564 #define SQLITE_OPEN_TRANSIENT_DB     0x00000400  /* VFS only */
  565 #define SQLITE_OPEN_MAIN_JOURNAL     0x00000800  /* VFS only */
  566 #define SQLITE_OPEN_TEMP_JOURNAL     0x00001000  /* VFS only */
  567 #define SQLITE_OPEN_SUBJOURNAL       0x00002000  /* VFS only */
  568 #define SQLITE_OPEN_MASTER_JOURNAL   0x00004000  /* VFS only */
  569 #define SQLITE_OPEN_NOMUTEX          0x00008000  /* Ok for sqlite3_open_v2() */
  570 #define SQLITE_OPEN_FULLMUTEX        0x00010000  /* Ok for sqlite3_open_v2() */
  571 #define SQLITE_OPEN_SHAREDCACHE      0x00020000  /* Ok for sqlite3_open_v2() */
  572 #define SQLITE_OPEN_PRIVATECACHE     0x00040000  /* Ok for sqlite3_open_v2() */
  573 #define SQLITE_OPEN_WAL              0x00080000  /* VFS only */
<a name="5" id="anc5"></a><span class="line-added">  574 #define SQLITE_OPEN_NOFOLLOW         0x01000000  /* Ok for sqlite3_open_v2() */</span>
  575 
  576 /* Reserved:                         0x00F00000 */
  577 
  578 /*
  579 ** CAPI3REF: Device Characteristics
  580 **
  581 ** The xDeviceCharacteristics method of the [sqlite3_io_methods]
  582 ** object returns an integer which is a vector of these
  583 ** bit values expressing I/O characteristics of the mass storage
  584 ** device that holds the file that the [sqlite3_io_methods]
  585 ** refers to.
  586 **
  587 ** The SQLITE_IOCAP_ATOMIC property means that all writes of
  588 ** any size are atomic.  The SQLITE_IOCAP_ATOMICnnn values
  589 ** mean that writes of blocks that are nnn bytes in size and
  590 ** are aligned to an address which is an integer multiple of
  591 ** nnn are atomic.  The SQLITE_IOCAP_SAFE_APPEND value means
  592 ** that when data is appended to a file, the data is appended
  593 ** first then the size of the file is extended, never the other
  594 ** way around.  The SQLITE_IOCAP_SEQUENTIAL property means that
  595 ** information is written to disk in the same order as calls
  596 ** to xWrite().  The SQLITE_IOCAP_POWERSAFE_OVERWRITE property means that
  597 ** after reboot following a crash or power loss, the only bytes in a
  598 ** file that were written at the application level might have changed
  599 ** and that adjacent bytes, even bytes within the same sector are
  600 ** guaranteed to be unchanged.  The SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN
  601 ** flag indicates that a file cannot be deleted when open.  The
  602 ** SQLITE_IOCAP_IMMUTABLE flag indicates that the file is on
  603 ** read-only media and cannot be changed even by processes with
  604 ** elevated privileges.
  605 **
  606 ** The SQLITE_IOCAP_BATCH_ATOMIC property means that the underlying
  607 ** filesystem supports doing multiple write operations atomically when those
  608 ** write operations are bracketed by [SQLITE_FCNTL_BEGIN_ATOMIC_WRITE] and
  609 ** [SQLITE_FCNTL_COMMIT_ATOMIC_WRITE].
  610 */
  611 #define SQLITE_IOCAP_ATOMIC                 0x00000001
  612 #define SQLITE_IOCAP_ATOMIC512              0x00000002
  613 #define SQLITE_IOCAP_ATOMIC1K               0x00000004
  614 #define SQLITE_IOCAP_ATOMIC2K               0x00000008
  615 #define SQLITE_IOCAP_ATOMIC4K               0x00000010
  616 #define SQLITE_IOCAP_ATOMIC8K               0x00000020
  617 #define SQLITE_IOCAP_ATOMIC16K              0x00000040
  618 #define SQLITE_IOCAP_ATOMIC32K              0x00000080
  619 #define SQLITE_IOCAP_ATOMIC64K              0x00000100
  620 #define SQLITE_IOCAP_SAFE_APPEND            0x00000200
  621 #define SQLITE_IOCAP_SEQUENTIAL             0x00000400
  622 #define SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN  0x00000800
  623 #define SQLITE_IOCAP_POWERSAFE_OVERWRITE    0x00001000
  624 #define SQLITE_IOCAP_IMMUTABLE              0x00002000
  625 #define SQLITE_IOCAP_BATCH_ATOMIC           0x00004000
  626 
  627 /*
  628 ** CAPI3REF: File Locking Levels
  629 **
  630 ** SQLite uses one of these integer values as the second
  631 ** argument to calls it makes to the xLock() and xUnlock() methods
  632 ** of an [sqlite3_io_methods] object.
  633 */
  634 #define SQLITE_LOCK_NONE          0
  635 #define SQLITE_LOCK_SHARED        1
  636 #define SQLITE_LOCK_RESERVED      2
  637 #define SQLITE_LOCK_PENDING       3
  638 #define SQLITE_LOCK_EXCLUSIVE     4
  639 
  640 /*
  641 ** CAPI3REF: Synchronization Type Flags
  642 **
  643 ** When SQLite invokes the xSync() method of an
  644 ** [sqlite3_io_methods] object it uses a combination of
  645 ** these integer values as the second argument.
  646 **
  647 ** When the SQLITE_SYNC_DATAONLY flag is used, it means that the
  648 ** sync operation only needs to flush data to mass storage.  Inode
  649 ** information need not be flushed. If the lower four bits of the flag
  650 ** equal SQLITE_SYNC_NORMAL, that means to use normal fsync() semantics.
  651 ** If the lower four bits equal SQLITE_SYNC_FULL, that means
  652 ** to use Mac OS X style fullsync instead of fsync().
  653 **
  654 ** Do not confuse the SQLITE_SYNC_NORMAL and SQLITE_SYNC_FULL flags
  655 ** with the [PRAGMA synchronous]=NORMAL and [PRAGMA synchronous]=FULL
  656 ** settings.  The [synchronous pragma] determines when calls to the
  657 ** xSync VFS method occur and applies uniformly across all platforms.
  658 ** The SQLITE_SYNC_NORMAL and SQLITE_SYNC_FULL flags determine how
  659 ** energetic or rigorous or forceful the sync operations are and
  660 ** only make a difference on Mac OSX for the default SQLite code.
  661 ** (Third-party VFS implementations might also make the distinction
  662 ** between SQLITE_SYNC_NORMAL and SQLITE_SYNC_FULL, but among the
  663 ** operating systems natively supported by SQLite, only Mac OSX
  664 ** cares about the difference.)
  665 */
  666 #define SQLITE_SYNC_NORMAL        0x00002
  667 #define SQLITE_SYNC_FULL          0x00003
  668 #define SQLITE_SYNC_DATAONLY      0x00010
  669 
  670 /*
  671 ** CAPI3REF: OS Interface Open File Handle
  672 **
  673 ** An [sqlite3_file] object represents an open file in the
  674 ** [sqlite3_vfs | OS interface layer].  Individual OS interface
  675 ** implementations will
  676 ** want to subclass this object by appending additional fields
  677 ** for their own use.  The pMethods entry is a pointer to an
  678 ** [sqlite3_io_methods] object that defines methods for performing
  679 ** I/O operations on the open file.
  680 */
  681 typedef struct sqlite3_file sqlite3_file;
  682 struct sqlite3_file {
  683   const struct sqlite3_io_methods *pMethods;  /* Methods for an open file */
  684 };
  685 
  686 /*
  687 ** CAPI3REF: OS Interface File Virtual Methods Object
  688 **
  689 ** Every file opened by the [sqlite3_vfs.xOpen] method populates an
  690 ** [sqlite3_file] object (or, more commonly, a subclass of the
  691 ** [sqlite3_file] object) with a pointer to an instance of this object.
  692 ** This object defines the methods used to perform various operations
  693 ** against the open file represented by the [sqlite3_file] object.
  694 **
  695 ** If the [sqlite3_vfs.xOpen] method sets the sqlite3_file.pMethods element
  696 ** to a non-NULL pointer, then the sqlite3_io_methods.xClose method
  697 ** may be invoked even if the [sqlite3_vfs.xOpen] reported that it failed.  The
  698 ** only way to prevent a call to xClose following a failed [sqlite3_vfs.xOpen]
  699 ** is for the [sqlite3_vfs.xOpen] to set the sqlite3_file.pMethods element
  700 ** to NULL.
  701 **
  702 ** The flags argument to xSync may be one of [SQLITE_SYNC_NORMAL] or
  703 ** [SQLITE_SYNC_FULL].  The first choice is the normal fsync().
  704 ** The second choice is a Mac OS X style fullsync.  The [SQLITE_SYNC_DATAONLY]
  705 ** flag may be ORed in to indicate that only the data of the file
  706 ** and not its inode needs to be synced.
  707 **
  708 ** The integer values to xLock() and xUnlock() are one of
  709 ** &lt;ul&gt;
  710 ** &lt;li&gt; [SQLITE_LOCK_NONE],
  711 ** &lt;li&gt; [SQLITE_LOCK_SHARED],
  712 ** &lt;li&gt; [SQLITE_LOCK_RESERVED],
  713 ** &lt;li&gt; [SQLITE_LOCK_PENDING], or
  714 ** &lt;li&gt; [SQLITE_LOCK_EXCLUSIVE].
  715 ** &lt;/ul&gt;
  716 ** xLock() increases the lock. xUnlock() decreases the lock.
  717 ** The xCheckReservedLock() method checks whether any database connection,
  718 ** either in this process or in some other process, is holding a RESERVED,
  719 ** PENDING, or EXCLUSIVE lock on the file.  It returns true
  720 ** if such a lock exists and false otherwise.
  721 **
  722 ** The xFileControl() method is a generic interface that allows custom
  723 ** VFS implementations to directly control an open file using the
  724 ** [sqlite3_file_control()] interface.  The second &quot;op&quot; argument is an
  725 ** integer opcode.  The third argument is a generic pointer intended to
  726 ** point to a structure that may contain arguments or space in which to
  727 ** write return values.  Potential uses for xFileControl() might be
  728 ** functions to enable blocking locks with timeouts, to change the
  729 ** locking strategy (for example to use dot-file locks), to inquire
  730 ** about the status of a lock, or to break stale locks.  The SQLite
  731 ** core reserves all opcodes less than 100 for its own use.
  732 ** A [file control opcodes | list of opcodes] less than 100 is available.
  733 ** Applications that define a custom xFileControl method should use opcodes
  734 ** greater than 100 to avoid conflicts.  VFS implementations should
  735 ** return [SQLITE_NOTFOUND] for file control opcodes that they do not
  736 ** recognize.
  737 **
  738 ** The xSectorSize() method returns the sector size of the
  739 ** device that underlies the file.  The sector size is the
  740 ** minimum write that can be performed without disturbing
  741 ** other bytes in the file.  The xDeviceCharacteristics()
  742 ** method returns a bit vector describing behaviors of the
  743 ** underlying device:
  744 **
  745 ** &lt;ul&gt;
  746 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC]
  747 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC512]
  748 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC1K]
  749 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC2K]
  750 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC4K]
  751 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC8K]
  752 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC16K]
  753 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC32K]
  754 ** &lt;li&gt; [SQLITE_IOCAP_ATOMIC64K]
  755 ** &lt;li&gt; [SQLITE_IOCAP_SAFE_APPEND]
  756 ** &lt;li&gt; [SQLITE_IOCAP_SEQUENTIAL]
  757 ** &lt;li&gt; [SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN]
  758 ** &lt;li&gt; [SQLITE_IOCAP_POWERSAFE_OVERWRITE]
  759 ** &lt;li&gt; [SQLITE_IOCAP_IMMUTABLE]
  760 ** &lt;li&gt; [SQLITE_IOCAP_BATCH_ATOMIC]
  761 ** &lt;/ul&gt;
  762 **
  763 ** The SQLITE_IOCAP_ATOMIC property means that all writes of
  764 ** any size are atomic.  The SQLITE_IOCAP_ATOMICnnn values
  765 ** mean that writes of blocks that are nnn bytes in size and
  766 ** are aligned to an address which is an integer multiple of
  767 ** nnn are atomic.  The SQLITE_IOCAP_SAFE_APPEND value means
  768 ** that when data is appended to a file, the data is appended
  769 ** first then the size of the file is extended, never the other
  770 ** way around.  The SQLITE_IOCAP_SEQUENTIAL property means that
  771 ** information is written to disk in the same order as calls
  772 ** to xWrite().
  773 **
  774 ** If xRead() returns SQLITE_IOERR_SHORT_READ it must also fill
  775 ** in the unread portions of the buffer with zeros.  A VFS that
  776 ** fails to zero-fill short reads might seem to work.  However,
  777 ** failure to zero-fill short reads will eventually lead to
  778 ** database corruption.
  779 */
  780 typedef struct sqlite3_io_methods sqlite3_io_methods;
  781 struct sqlite3_io_methods {
  782   int iVersion;
  783   int (*xClose)(sqlite3_file*);
  784   int (*xRead)(sqlite3_file*, void*, int iAmt, sqlite3_int64 iOfst);
  785   int (*xWrite)(sqlite3_file*, const void*, int iAmt, sqlite3_int64 iOfst);
  786   int (*xTruncate)(sqlite3_file*, sqlite3_int64 size);
  787   int (*xSync)(sqlite3_file*, int flags);
  788   int (*xFileSize)(sqlite3_file*, sqlite3_int64 *pSize);
  789   int (*xLock)(sqlite3_file*, int);
  790   int (*xUnlock)(sqlite3_file*, int);
  791   int (*xCheckReservedLock)(sqlite3_file*, int *pResOut);
  792   int (*xFileControl)(sqlite3_file*, int op, void *pArg);
  793   int (*xSectorSize)(sqlite3_file*);
  794   int (*xDeviceCharacteristics)(sqlite3_file*);
  795   /* Methods above are valid for version 1 */
  796   int (*xShmMap)(sqlite3_file*, int iPg, int pgsz, int, void volatile**);
  797   int (*xShmLock)(sqlite3_file*, int offset, int n, int flags);
  798   void (*xShmBarrier)(sqlite3_file*);
  799   int (*xShmUnmap)(sqlite3_file*, int deleteFlag);
  800   /* Methods above are valid for version 2 */
  801   int (*xFetch)(sqlite3_file*, sqlite3_int64 iOfst, int iAmt, void **pp);
  802   int (*xUnfetch)(sqlite3_file*, sqlite3_int64 iOfst, void *p);
  803   /* Methods above are valid for version 3 */
  804   /* Additional methods may be added in future releases */
  805 };
  806 
  807 /*
  808 ** CAPI3REF: Standard File Control Opcodes
  809 ** KEYWORDS: {file control opcodes} {file control opcode}
  810 **
  811 ** These integer constants are opcodes for the xFileControl method
  812 ** of the [sqlite3_io_methods] object and for the [sqlite3_file_control()]
  813 ** interface.
  814 **
  815 ** &lt;ul&gt;
  816 ** &lt;li&gt;[[SQLITE_FCNTL_LOCKSTATE]]
  817 ** The [SQLITE_FCNTL_LOCKSTATE] opcode is used for debugging.  This
  818 ** opcode causes the xFileControl method to write the current state of
  819 ** the lock (one of [SQLITE_LOCK_NONE], [SQLITE_LOCK_SHARED],
  820 ** [SQLITE_LOCK_RESERVED], [SQLITE_LOCK_PENDING], or [SQLITE_LOCK_EXCLUSIVE])
  821 ** into an integer that the pArg argument points to. This capability
  822 ** is used during testing and is only available when the SQLITE_TEST
  823 ** compile-time option is used.
  824 **
  825 ** &lt;li&gt;[[SQLITE_FCNTL_SIZE_HINT]]
  826 ** The [SQLITE_FCNTL_SIZE_HINT] opcode is used by SQLite to give the VFS
  827 ** layer a hint of how large the database file will grow to be during the
  828 ** current transaction.  This hint is not guaranteed to be accurate but it
  829 ** is often close.  The underlying VFS might choose to preallocate database
  830 ** file space based on this hint in order to help writes to the database
  831 ** file run faster.
  832 **
  833 ** &lt;li&gt;[[SQLITE_FCNTL_SIZE_LIMIT]]
  834 ** The [SQLITE_FCNTL_SIZE_LIMIT] opcode is used by in-memory VFS that
  835 ** implements [sqlite3_deserialize()] to set an upper bound on the size
  836 ** of the in-memory database.  The argument is a pointer to a [sqlite3_int64].
  837 ** If the integer pointed to is negative, then it is filled in with the
  838 ** current limit.  Otherwise the limit is set to the larger of the value
  839 ** of the integer pointed to and the current database size.  The integer
  840 ** pointed to is set to the new limit.
  841 **
  842 ** &lt;li&gt;[[SQLITE_FCNTL_CHUNK_SIZE]]
  843 ** The [SQLITE_FCNTL_CHUNK_SIZE] opcode is used to request that the VFS
  844 ** extends and truncates the database file in chunks of a size specified
  845 ** by the user. The fourth argument to [sqlite3_file_control()] should
  846 ** point to an integer (type int) containing the new chunk-size to use
  847 ** for the nominated database. Allocating database file space in large
  848 ** chunks (say 1MB at a time), may reduce file-system fragmentation and
  849 ** improve performance on some systems.
  850 **
  851 ** &lt;li&gt;[[SQLITE_FCNTL_FILE_POINTER]]
  852 ** The [SQLITE_FCNTL_FILE_POINTER] opcode is used to obtain a pointer
  853 ** to the [sqlite3_file] object associated with a particular database
  854 ** connection.  See also [SQLITE_FCNTL_JOURNAL_POINTER].
  855 **
  856 ** &lt;li&gt;[[SQLITE_FCNTL_JOURNAL_POINTER]]
  857 ** The [SQLITE_FCNTL_JOURNAL_POINTER] opcode is used to obtain a pointer
  858 ** to the [sqlite3_file] object associated with the journal file (either
  859 ** the [rollback journal] or the [write-ahead log]) for a particular database
  860 ** connection.  See also [SQLITE_FCNTL_FILE_POINTER].
  861 **
  862 ** &lt;li&gt;[[SQLITE_FCNTL_SYNC_OMITTED]]
  863 ** No longer in use.
  864 **
  865 ** &lt;li&gt;[[SQLITE_FCNTL_SYNC]]
  866 ** The [SQLITE_FCNTL_SYNC] opcode is generated internally by SQLite and
  867 ** sent to the VFS immediately before the xSync method is invoked on a
  868 ** database file descriptor. Or, if the xSync method is not invoked
  869 ** because the user has configured SQLite with
  870 ** [PRAGMA synchronous | PRAGMA synchronous=OFF] it is invoked in place
  871 ** of the xSync method. In most cases, the pointer argument passed with
  872 ** this file-control is NULL. However, if the database file is being synced
  873 ** as part of a multi-database commit, the argument points to a nul-terminated
  874 ** string containing the transactions master-journal file name. VFSes that
  875 ** do not need this signal should silently ignore this opcode. Applications
  876 ** should not call [sqlite3_file_control()] with this opcode as doing so may
  877 ** disrupt the operation of the specialized VFSes that do require it.
  878 **
  879 ** &lt;li&gt;[[SQLITE_FCNTL_COMMIT_PHASETWO]]
  880 ** The [SQLITE_FCNTL_COMMIT_PHASETWO] opcode is generated internally by SQLite
  881 ** and sent to the VFS after a transaction has been committed immediately
  882 ** but before the database is unlocked. VFSes that do not need this signal
  883 ** should silently ignore this opcode. Applications should not call
  884 ** [sqlite3_file_control()] with this opcode as doing so may disrupt the
  885 ** operation of the specialized VFSes that do require it.
  886 **
  887 ** &lt;li&gt;[[SQLITE_FCNTL_WIN32_AV_RETRY]]
  888 ** ^The [SQLITE_FCNTL_WIN32_AV_RETRY] opcode is used to configure automatic
  889 ** retry counts and intervals for certain disk I/O operations for the
  890 ** windows [VFS] in order to provide robustness in the presence of
  891 ** anti-virus programs.  By default, the windows VFS will retry file read,
  892 ** file write, and file delete operations up to 10 times, with a delay
  893 ** of 25 milliseconds before the first retry and with the delay increasing
  894 ** by an additional 25 milliseconds with each subsequent retry.  This
  895 ** opcode allows these two values (10 retries and 25 milliseconds of delay)
  896 ** to be adjusted.  The values are changed for all database connections
  897 ** within the same process.  The argument is a pointer to an array of two
  898 ** integers where the first integer is the new retry count and the second
  899 ** integer is the delay.  If either integer is negative, then the setting
  900 ** is not changed but instead the prior value of that setting is written
  901 ** into the array entry, allowing the current retry settings to be
  902 ** interrogated.  The zDbName parameter is ignored.
  903 **
  904 ** &lt;li&gt;[[SQLITE_FCNTL_PERSIST_WAL]]
  905 ** ^The [SQLITE_FCNTL_PERSIST_WAL] opcode is used to set or query the
  906 ** persistent [WAL | Write Ahead Log] setting.  By default, the auxiliary
  907 ** write ahead log ([WAL file]) and shared memory
  908 ** files used for transaction control
  909 ** are automatically deleted when the latest connection to the database
  910 ** closes.  Setting persistent WAL mode causes those files to persist after
  911 ** close.  Persisting the files is useful when other processes that do not
  912 ** have write permission on the directory containing the database file want
  913 ** to read the database file, as the WAL and shared memory files must exist
  914 ** in order for the database to be readable.  The fourth parameter to
  915 ** [sqlite3_file_control()] for this opcode should be a pointer to an integer.
  916 ** That integer is 0 to disable persistent WAL mode or 1 to enable persistent
  917 ** WAL mode.  If the integer is -1, then it is overwritten with the current
  918 ** WAL persistence setting.
  919 **
  920 ** &lt;li&gt;[[SQLITE_FCNTL_POWERSAFE_OVERWRITE]]
  921 ** ^The [SQLITE_FCNTL_POWERSAFE_OVERWRITE] opcode is used to set or query the
  922 ** persistent &quot;powersafe-overwrite&quot; or &quot;PSOW&quot; setting.  The PSOW setting
  923 ** determines the [SQLITE_IOCAP_POWERSAFE_OVERWRITE] bit of the
  924 ** xDeviceCharacteristics methods. The fourth parameter to
  925 ** [sqlite3_file_control()] for this opcode should be a pointer to an integer.
  926 ** That integer is 0 to disable zero-damage mode or 1 to enable zero-damage
  927 ** mode.  If the integer is -1, then it is overwritten with the current
  928 ** zero-damage mode setting.
  929 **
  930 ** &lt;li&gt;[[SQLITE_FCNTL_OVERWRITE]]
  931 ** ^The [SQLITE_FCNTL_OVERWRITE] opcode is invoked by SQLite after opening
  932 ** a write transaction to indicate that, unless it is rolled back for some
  933 ** reason, the entire database file will be overwritten by the current
  934 ** transaction. This is used by VACUUM operations.
  935 **
  936 ** &lt;li&gt;[[SQLITE_FCNTL_VFSNAME]]
  937 ** ^The [SQLITE_FCNTL_VFSNAME] opcode can be used to obtain the names of
  938 ** all [VFSes] in the VFS stack.  The names are of all VFS shims and the
  939 ** final bottom-level VFS are written into memory obtained from
  940 ** [sqlite3_malloc()] and the result is stored in the char* variable
  941 ** that the fourth parameter of [sqlite3_file_control()] points to.
  942 ** The caller is responsible for freeing the memory when done.  As with
  943 ** all file-control actions, there is no guarantee that this will actually
  944 ** do anything.  Callers should initialize the char* variable to a NULL
  945 ** pointer in case this file-control is not implemented.  This file-control
  946 ** is intended for diagnostic use only.
  947 **
  948 ** &lt;li&gt;[[SQLITE_FCNTL_VFS_POINTER]]
  949 ** ^The [SQLITE_FCNTL_VFS_POINTER] opcode finds a pointer to the top-level
  950 ** [VFSes] currently in use.  ^(The argument X in
  951 ** sqlite3_file_control(db,SQLITE_FCNTL_VFS_POINTER,X) must be
  952 ** of type &quot;[sqlite3_vfs] **&quot;.  This opcodes will set *X
  953 ** to a pointer to the top-level VFS.)^
  954 ** ^When there are multiple VFS shims in the stack, this opcode finds the
  955 ** upper-most shim only.
  956 **
  957 ** &lt;li&gt;[[SQLITE_FCNTL_PRAGMA]]
  958 ** ^Whenever a [PRAGMA] statement is parsed, an [SQLITE_FCNTL_PRAGMA]
  959 ** file control is sent to the open [sqlite3_file] object corresponding
  960 ** to the database file to which the pragma statement refers. ^The argument
  961 ** to the [SQLITE_FCNTL_PRAGMA] file control is an array of
  962 ** pointers to strings (char**) in which the second element of the array
  963 ** is the name of the pragma and the third element is the argument to the
  964 ** pragma or NULL if the pragma has no argument.  ^The handler for an
  965 ** [SQLITE_FCNTL_PRAGMA] file control can optionally make the first element
  966 ** of the char** argument point to a string obtained from [sqlite3_mprintf()]
  967 ** or the equivalent and that string will become the result of the pragma or
  968 ** the error message if the pragma fails. ^If the
  969 ** [SQLITE_FCNTL_PRAGMA] file control returns [SQLITE_NOTFOUND], then normal
  970 ** [PRAGMA] processing continues.  ^If the [SQLITE_FCNTL_PRAGMA]
  971 ** file control returns [SQLITE_OK], then the parser assumes that the
  972 ** VFS has handled the PRAGMA itself and the parser generates a no-op
  973 ** prepared statement if result string is NULL, or that returns a copy
  974 ** of the result string if the string is non-NULL.
  975 ** ^If the [SQLITE_FCNTL_PRAGMA] file control returns
  976 ** any result code other than [SQLITE_OK] or [SQLITE_NOTFOUND], that means
  977 ** that the VFS encountered an error while handling the [PRAGMA] and the
  978 ** compilation of the PRAGMA fails with an error.  ^The [SQLITE_FCNTL_PRAGMA]
  979 ** file control occurs at the beginning of pragma statement analysis and so
  980 ** it is able to override built-in [PRAGMA] statements.
  981 **
  982 ** &lt;li&gt;[[SQLITE_FCNTL_BUSYHANDLER]]
  983 ** ^The [SQLITE_FCNTL_BUSYHANDLER]
  984 ** file-control may be invoked by SQLite on the database file handle
  985 ** shortly after it is opened in order to provide a custom VFS with access
<a name="6" id="anc6"></a><span class="line-modified">  986 ** to the connection&#39;s busy-handler callback. The argument is of type (void**)</span>
  987 ** - an array of two (void *) values. The first (void *) actually points
<a name="7" id="anc7"></a><span class="line-modified">  988 ** to a function of type (int (*)(void *)). In order to invoke the connection&#39;s</span>
  989 ** busy-handler, this function should be invoked with the second (void *) in
  990 ** the array as the only argument. If it returns non-zero, then the operation
  991 ** should be retried. If it returns zero, the custom VFS should abandon the
  992 ** current operation.
  993 **
  994 ** &lt;li&gt;[[SQLITE_FCNTL_TEMPFILENAME]]
<a name="8" id="anc8"></a><span class="line-modified">  995 ** ^Applications can invoke the [SQLITE_FCNTL_TEMPFILENAME] file-control</span>
  996 ** to have SQLite generate a
  997 ** temporary filename using the same algorithm that is followed to generate
  998 ** temporary filenames for TEMP tables and other internal uses.  The
  999 ** argument should be a char** which will be filled with the filename
 1000 ** written into memory obtained from [sqlite3_malloc()].  The caller should
 1001 ** invoke [sqlite3_free()] on the result to avoid a memory leak.
 1002 **
 1003 ** &lt;li&gt;[[SQLITE_FCNTL_MMAP_SIZE]]
 1004 ** The [SQLITE_FCNTL_MMAP_SIZE] file control is used to query or set the
 1005 ** maximum number of bytes that will be used for memory-mapped I/O.
 1006 ** The argument is a pointer to a value of type sqlite3_int64 that
 1007 ** is an advisory maximum number of bytes in the file to memory map.  The
 1008 ** pointer is overwritten with the old value.  The limit is not changed if
 1009 ** the value originally pointed to is negative, and so the current limit
 1010 ** can be queried by passing in a pointer to a negative number.  This
 1011 ** file-control is used internally to implement [PRAGMA mmap_size].
 1012 **
 1013 ** &lt;li&gt;[[SQLITE_FCNTL_TRACE]]
 1014 ** The [SQLITE_FCNTL_TRACE] file control provides advisory information
 1015 ** to the VFS about what the higher layers of the SQLite stack are doing.
 1016 ** This file control is used by some VFS activity tracing [shims].
 1017 ** The argument is a zero-terminated string.  Higher layers in the
 1018 ** SQLite stack may generate instances of this file control if
 1019 ** the [SQLITE_USE_FCNTL_TRACE] compile-time option is enabled.
 1020 **
 1021 ** &lt;li&gt;[[SQLITE_FCNTL_HAS_MOVED]]
 1022 ** The [SQLITE_FCNTL_HAS_MOVED] file control interprets its argument as a
 1023 ** pointer to an integer and it writes a boolean into that integer depending
 1024 ** on whether or not the file has been renamed, moved, or deleted since it
 1025 ** was first opened.
 1026 **
 1027 ** &lt;li&gt;[[SQLITE_FCNTL_WIN32_GET_HANDLE]]
 1028 ** The [SQLITE_FCNTL_WIN32_GET_HANDLE] opcode can be used to obtain the
 1029 ** underlying native file handle associated with a file handle.  This file
 1030 ** control interprets its argument as a pointer to a native file handle and
 1031 ** writes the resulting value there.
 1032 **
 1033 ** &lt;li&gt;[[SQLITE_FCNTL_WIN32_SET_HANDLE]]
 1034 ** The [SQLITE_FCNTL_WIN32_SET_HANDLE] opcode is used for debugging.  This
 1035 ** opcode causes the xFileControl method to swap the file handle with the one
 1036 ** pointed to by the pArg argument.  This capability is used during testing
 1037 ** and only needs to be supported when SQLITE_TEST is defined.
 1038 **
 1039 ** &lt;li&gt;[[SQLITE_FCNTL_WAL_BLOCK]]
 1040 ** The [SQLITE_FCNTL_WAL_BLOCK] is a signal to the VFS layer that it might
 1041 ** be advantageous to block on the next WAL lock if the lock is not immediately
 1042 ** available.  The WAL subsystem issues this signal during rare
 1043 ** circumstances in order to fix a problem with priority inversion.
 1044 ** Applications should &lt;em&gt;not&lt;/em&gt; use this file-control.
 1045 **
 1046 ** &lt;li&gt;[[SQLITE_FCNTL_ZIPVFS]]
 1047 ** The [SQLITE_FCNTL_ZIPVFS] opcode is implemented by zipvfs only. All other
 1048 ** VFS should return SQLITE_NOTFOUND for this opcode.
 1049 **
 1050 ** &lt;li&gt;[[SQLITE_FCNTL_RBU]]
 1051 ** The [SQLITE_FCNTL_RBU] opcode is implemented by the special VFS used by
 1052 ** the RBU extension only.  All other VFS should return SQLITE_NOTFOUND for
 1053 ** this opcode.
 1054 **
 1055 ** &lt;li&gt;[[SQLITE_FCNTL_BEGIN_ATOMIC_WRITE]]
 1056 ** If the [SQLITE_FCNTL_BEGIN_ATOMIC_WRITE] opcode returns SQLITE_OK, then
 1057 ** the file descriptor is placed in &quot;batch write mode&quot;, which
 1058 ** means all subsequent write operations will be deferred and done
 1059 ** atomically at the next [SQLITE_FCNTL_COMMIT_ATOMIC_WRITE].  Systems
 1060 ** that do not support batch atomic writes will return SQLITE_NOTFOUND.
 1061 ** ^Following a successful SQLITE_FCNTL_BEGIN_ATOMIC_WRITE and prior to
 1062 ** the closing [SQLITE_FCNTL_COMMIT_ATOMIC_WRITE] or
 1063 ** [SQLITE_FCNTL_ROLLBACK_ATOMIC_WRITE], SQLite will make
 1064 ** no VFS interface calls on the same [sqlite3_file] file descriptor
 1065 ** except for calls to the xWrite method and the xFileControl method
 1066 ** with [SQLITE_FCNTL_SIZE_HINT].
 1067 **
 1068 ** &lt;li&gt;[[SQLITE_FCNTL_COMMIT_ATOMIC_WRITE]]
 1069 ** The [SQLITE_FCNTL_COMMIT_ATOMIC_WRITE] opcode causes all write
 1070 ** operations since the previous successful call to
 1071 ** [SQLITE_FCNTL_BEGIN_ATOMIC_WRITE] to be performed atomically.
 1072 ** This file control returns [SQLITE_OK] if and only if the writes were
 1073 ** all performed successfully and have been committed to persistent storage.
 1074 ** ^Regardless of whether or not it is successful, this file control takes
 1075 ** the file descriptor out of batch write mode so that all subsequent
 1076 ** write operations are independent.
 1077 ** ^SQLite will never invoke SQLITE_FCNTL_COMMIT_ATOMIC_WRITE without
 1078 ** a prior successful call to [SQLITE_FCNTL_BEGIN_ATOMIC_WRITE].
 1079 **
 1080 ** &lt;li&gt;[[SQLITE_FCNTL_ROLLBACK_ATOMIC_WRITE]]
 1081 ** The [SQLITE_FCNTL_ROLLBACK_ATOMIC_WRITE] opcode causes all write
 1082 ** operations since the previous successful call to
 1083 ** [SQLITE_FCNTL_BEGIN_ATOMIC_WRITE] to be rolled back.
 1084 ** ^This file control takes the file descriptor out of batch write mode
 1085 ** so that all subsequent write operations are independent.
 1086 ** ^SQLite will never invoke SQLITE_FCNTL_ROLLBACK_ATOMIC_WRITE without
 1087 ** a prior successful call to [SQLITE_FCNTL_BEGIN_ATOMIC_WRITE].
 1088 **
 1089 ** &lt;li&gt;[[SQLITE_FCNTL_LOCK_TIMEOUT]]
 1090 ** The [SQLITE_FCNTL_LOCK_TIMEOUT] opcode causes attempts to obtain
 1091 ** a file lock using the xLock or xShmLock methods of the VFS to wait
 1092 ** for up to M milliseconds before failing, where M is the single
 1093 ** unsigned integer parameter.
 1094 **
 1095 ** &lt;li&gt;[[SQLITE_FCNTL_DATA_VERSION]]
 1096 ** The [SQLITE_FCNTL_DATA_VERSION] opcode is used to detect changes to
 1097 ** a database file.  The argument is a pointer to a 32-bit unsigned integer.
 1098 ** The &quot;data version&quot; for the pager is written into the pointer.  The
 1099 ** &quot;data version&quot; changes whenever any change occurs to the corresponding
 1100 ** database file, either through SQL statements on the same database
 1101 ** connection or through transactions committed by separate database
 1102 ** connections possibly in other processes. The [sqlite3_total_changes()]
 1103 ** interface can be used to find if any database on the connection has changed,
 1104 ** but that interface responds to changes on TEMP as well as MAIN and does
 1105 ** not provide a mechanism to detect changes to MAIN only.  Also, the
 1106 ** [sqlite3_total_changes()] interface responds to internal changes only and
 1107 ** omits changes made by other database connections.  The
<a name="9" id="anc9"></a><span class="line-modified"> 1108 ** [PRAGMA data_version] command provides a mechanism to detect changes to</span>
 1109 ** a single attached database that occur due to other database connections,
 1110 ** but omits changes implemented by the database connection on which it is
 1111 ** called.  This file control is the only mechanism to detect changes that
 1112 ** happen either internally or externally and that are associated with
 1113 ** a particular attached database.
<a name="10" id="anc10"></a><span class="line-added"> 1114 **</span>
<span class="line-added"> 1115 ** &lt;li&gt;[[SQLITE_FCNTL_CKPT_DONE]]</span>
<span class="line-added"> 1116 ** The [SQLITE_FCNTL_CKPT_DONE] opcode is invoked from within a checkpoint</span>
<span class="line-added"> 1117 ** in wal mode after the client has finished copying pages from the wal</span>
<span class="line-added"> 1118 ** file to the database file, but before the *-shm file is updated to</span>
<span class="line-added"> 1119 ** record the fact that the pages have been checkpointed.</span>
 1120 ** &lt;/ul&gt;
 1121 */
 1122 #define SQLITE_FCNTL_LOCKSTATE               1
 1123 #define SQLITE_FCNTL_GET_LOCKPROXYFILE       2
 1124 #define SQLITE_FCNTL_SET_LOCKPROXYFILE       3
 1125 #define SQLITE_FCNTL_LAST_ERRNO              4
 1126 #define SQLITE_FCNTL_SIZE_HINT               5
 1127 #define SQLITE_FCNTL_CHUNK_SIZE              6
 1128 #define SQLITE_FCNTL_FILE_POINTER            7
 1129 #define SQLITE_FCNTL_SYNC_OMITTED            8
 1130 #define SQLITE_FCNTL_WIN32_AV_RETRY          9
 1131 #define SQLITE_FCNTL_PERSIST_WAL            10
 1132 #define SQLITE_FCNTL_OVERWRITE              11
 1133 #define SQLITE_FCNTL_VFSNAME                12
 1134 #define SQLITE_FCNTL_POWERSAFE_OVERWRITE    13
 1135 #define SQLITE_FCNTL_PRAGMA                 14
 1136 #define SQLITE_FCNTL_BUSYHANDLER            15
 1137 #define SQLITE_FCNTL_TEMPFILENAME           16
 1138 #define SQLITE_FCNTL_MMAP_SIZE              18
 1139 #define SQLITE_FCNTL_TRACE                  19
 1140 #define SQLITE_FCNTL_HAS_MOVED              20
 1141 #define SQLITE_FCNTL_SYNC                   21
 1142 #define SQLITE_FCNTL_COMMIT_PHASETWO        22
 1143 #define SQLITE_FCNTL_WIN32_SET_HANDLE       23
 1144 #define SQLITE_FCNTL_WAL_BLOCK              24
 1145 #define SQLITE_FCNTL_ZIPVFS                 25
 1146 #define SQLITE_FCNTL_RBU                    26
 1147 #define SQLITE_FCNTL_VFS_POINTER            27
 1148 #define SQLITE_FCNTL_JOURNAL_POINTER        28
 1149 #define SQLITE_FCNTL_WIN32_GET_HANDLE       29
 1150 #define SQLITE_FCNTL_PDB                    30
 1151 #define SQLITE_FCNTL_BEGIN_ATOMIC_WRITE     31
 1152 #define SQLITE_FCNTL_COMMIT_ATOMIC_WRITE    32
 1153 #define SQLITE_FCNTL_ROLLBACK_ATOMIC_WRITE  33
 1154 #define SQLITE_FCNTL_LOCK_TIMEOUT           34
 1155 #define SQLITE_FCNTL_DATA_VERSION           35
 1156 #define SQLITE_FCNTL_SIZE_LIMIT             36
<a name="11" id="anc11"></a><span class="line-added"> 1157 #define SQLITE_FCNTL_CKPT_DONE              37</span>
 1158 
 1159 /* deprecated names */
 1160 #define SQLITE_GET_LOCKPROXYFILE      SQLITE_FCNTL_GET_LOCKPROXYFILE
 1161 #define SQLITE_SET_LOCKPROXYFILE      SQLITE_FCNTL_SET_LOCKPROXYFILE
 1162 #define SQLITE_LAST_ERRNO             SQLITE_FCNTL_LAST_ERRNO
 1163 
 1164 
 1165 /*
 1166 ** CAPI3REF: Mutex Handle
 1167 **
 1168 ** The mutex module within SQLite defines [sqlite3_mutex] to be an
 1169 ** abstract type for a mutex object.  The SQLite core never looks
 1170 ** at the internal representation of an [sqlite3_mutex].  It only
 1171 ** deals with pointers to the [sqlite3_mutex] object.
 1172 **
 1173 ** Mutexes are created using [sqlite3_mutex_alloc()].
 1174 */
 1175 typedef struct sqlite3_mutex sqlite3_mutex;
 1176 
 1177 /*
 1178 ** CAPI3REF: Loadable Extension Thunk
 1179 **
 1180 ** A pointer to the opaque sqlite3_api_routines structure is passed as
 1181 ** the third parameter to entry points of [loadable extensions].  This
 1182 ** structure must be typedefed in order to work around compiler warnings
 1183 ** on some platforms.
 1184 */
 1185 typedef struct sqlite3_api_routines sqlite3_api_routines;
 1186 
 1187 /*
 1188 ** CAPI3REF: OS Interface Object
 1189 **
 1190 ** An instance of the sqlite3_vfs object defines the interface between
 1191 ** the SQLite core and the underlying operating system.  The &quot;vfs&quot;
 1192 ** in the name of the object stands for &quot;virtual file system&quot;.  See
 1193 ** the [VFS | VFS documentation] for further information.
 1194 **
 1195 ** The VFS interface is sometimes extended by adding new methods onto
 1196 ** the end.  Each time such an extension occurs, the iVersion field
 1197 ** is incremented.  The iVersion value started out as 1 in
 1198 ** SQLite [version 3.5.0] on [dateof:3.5.0], then increased to 2
 1199 ** with SQLite [version 3.7.0] on [dateof:3.7.0], and then increased
 1200 ** to 3 with SQLite [version 3.7.6] on [dateof:3.7.6].  Additional fields
 1201 ** may be appended to the sqlite3_vfs object and the iVersion value
 1202 ** may increase again in future versions of SQLite.
<a name="12" id="anc12"></a><span class="line-modified"> 1203 ** Note that due to an oversight, the structure</span>
<span class="line-modified"> 1204 ** of the sqlite3_vfs object changed in the transition from</span>
 1205 ** SQLite [version 3.5.9] to [version 3.6.0] on [dateof:3.6.0]
<a name="13" id="anc13"></a><span class="line-modified"> 1206 ** and yet the iVersion field was not increased.</span>
 1207 **
 1208 ** The szOsFile field is the size of the subclassed [sqlite3_file]
 1209 ** structure used by this VFS.  mxPathname is the maximum length of
 1210 ** a pathname in this VFS.
 1211 **
 1212 ** Registered sqlite3_vfs objects are kept on a linked list formed by
 1213 ** the pNext pointer.  The [sqlite3_vfs_register()]
 1214 ** and [sqlite3_vfs_unregister()] interfaces manage this list
 1215 ** in a thread-safe way.  The [sqlite3_vfs_find()] interface
 1216 ** searches the list.  Neither the application code nor the VFS
 1217 ** implementation should use the pNext pointer.
 1218 **
 1219 ** The pNext field is the only field in the sqlite3_vfs
 1220 ** structure that SQLite will ever modify.  SQLite will only access
 1221 ** or modify this field while holding a particular static mutex.
 1222 ** The application should never modify anything within the sqlite3_vfs
 1223 ** object once the object has been registered.
 1224 **
 1225 ** The zName field holds the name of the VFS module.  The name must
 1226 ** be unique across all VFS modules.
 1227 **
 1228 ** [[sqlite3_vfs.xOpen]]
 1229 ** ^SQLite guarantees that the zFilename parameter to xOpen
 1230 ** is either a NULL pointer or string obtained
 1231 ** from xFullPathname() with an optional suffix added.
 1232 ** ^If a suffix is added to the zFilename parameter, it will
 1233 ** consist of a single &quot;-&quot; character followed by no more than
 1234 ** 11 alphanumeric and/or &quot;-&quot; characters.
 1235 ** ^SQLite further guarantees that
 1236 ** the string will be valid and unchanged until xClose() is
 1237 ** called. Because of the previous sentence,
 1238 ** the [sqlite3_file] can safely store a pointer to the
 1239 ** filename if it needs to remember the filename for some reason.
 1240 ** If the zFilename parameter to xOpen is a NULL pointer then xOpen
 1241 ** must invent its own temporary name for the file.  ^Whenever the
 1242 ** xFilename parameter is NULL it will also be the case that the
 1243 ** flags parameter will include [SQLITE_OPEN_DELETEONCLOSE].
 1244 **
 1245 ** The flags argument to xOpen() includes all bits set in
 1246 ** the flags argument to [sqlite3_open_v2()].  Or if [sqlite3_open()]
 1247 ** or [sqlite3_open16()] is used, then flags includes at least
 1248 ** [SQLITE_OPEN_READWRITE] | [SQLITE_OPEN_CREATE].
 1249 ** If xOpen() opens a file read-only then it sets *pOutFlags to
 1250 ** include [SQLITE_OPEN_READONLY].  Other bits in *pOutFlags may be set.
 1251 **
 1252 ** ^(SQLite will also add one of the following flags to the xOpen()
 1253 ** call, depending on the object being opened:
 1254 **
 1255 ** &lt;ul&gt;
 1256 ** &lt;li&gt;  [SQLITE_OPEN_MAIN_DB]
 1257 ** &lt;li&gt;  [SQLITE_OPEN_MAIN_JOURNAL]
 1258 ** &lt;li&gt;  [SQLITE_OPEN_TEMP_DB]
 1259 ** &lt;li&gt;  [SQLITE_OPEN_TEMP_JOURNAL]
 1260 ** &lt;li&gt;  [SQLITE_OPEN_TRANSIENT_DB]
 1261 ** &lt;li&gt;  [SQLITE_OPEN_SUBJOURNAL]
 1262 ** &lt;li&gt;  [SQLITE_OPEN_MASTER_JOURNAL]
 1263 ** &lt;li&gt;  [SQLITE_OPEN_WAL]
 1264 ** &lt;/ul&gt;)^
 1265 **
 1266 ** The file I/O implementation can use the object type flags to
 1267 ** change the way it deals with files.  For example, an application
 1268 ** that does not care about crash recovery or rollback might make
 1269 ** the open of a journal file a no-op.  Writes to this journal would
 1270 ** also be no-ops, and any attempt to read the journal would return
 1271 ** SQLITE_IOERR.  Or the implementation might recognize that a database
 1272 ** file will be doing page-aligned sector reads and writes in a random
 1273 ** order and set up its I/O subsystem accordingly.
 1274 **
 1275 ** SQLite might also add one of the following flags to the xOpen method:
 1276 **
 1277 ** &lt;ul&gt;
 1278 ** &lt;li&gt; [SQLITE_OPEN_DELETEONCLOSE]
 1279 ** &lt;li&gt; [SQLITE_OPEN_EXCLUSIVE]
 1280 ** &lt;/ul&gt;
 1281 **
 1282 ** The [SQLITE_OPEN_DELETEONCLOSE] flag means the file should be
 1283 ** deleted when it is closed.  ^The [SQLITE_OPEN_DELETEONCLOSE]
 1284 ** will be set for TEMP databases and their journals, transient
 1285 ** databases, and subjournals.
 1286 **
 1287 ** ^The [SQLITE_OPEN_EXCLUSIVE] flag is always used in conjunction
 1288 ** with the [SQLITE_OPEN_CREATE] flag, which are both directly
 1289 ** analogous to the O_EXCL and O_CREAT flags of the POSIX open()
 1290 ** API.  The SQLITE_OPEN_EXCLUSIVE flag, when paired with the
 1291 ** SQLITE_OPEN_CREATE, is used to indicate that file should always
 1292 ** be created, and that it is an error if it already exists.
 1293 ** It is &lt;i&gt;not&lt;/i&gt; used to indicate the file should be opened
 1294 ** for exclusive access.
 1295 **
 1296 ** ^At least szOsFile bytes of memory are allocated by SQLite
<a name="14" id="anc14"></a><span class="line-modified"> 1297 ** to hold the [sqlite3_file] structure passed as the third</span>
 1298 ** argument to xOpen.  The xOpen method does not have to
 1299 ** allocate the structure; it should just fill it in.  Note that
 1300 ** the xOpen method must set the sqlite3_file.pMethods to either
 1301 ** a valid [sqlite3_io_methods] object or to NULL.  xOpen must do
 1302 ** this even if the open fails.  SQLite expects that the sqlite3_file.pMethods
 1303 ** element will be valid after xOpen returns regardless of the success
 1304 ** or failure of the xOpen call.
 1305 **
 1306 ** [[sqlite3_vfs.xAccess]]
 1307 ** ^The flags argument to xAccess() may be [SQLITE_ACCESS_EXISTS]
 1308 ** to test for the existence of a file, or [SQLITE_ACCESS_READWRITE] to
 1309 ** test whether a file is readable and writable, or [SQLITE_ACCESS_READ]
 1310 ** to test whether a file is at least readable.  The SQLITE_ACCESS_READ
 1311 ** flag is never actually used and is not implemented in the built-in
 1312 ** VFSes of SQLite.  The file is named by the second argument and can be a
 1313 ** directory. The xAccess method returns [SQLITE_OK] on success or some
 1314 ** non-zero error code if there is an I/O error or if the name of
 1315 ** the file given in the second argument is illegal.  If SQLITE_OK
 1316 ** is returned, then non-zero or zero is written into *pResOut to indicate
 1317 ** whether or not the file is accessible.
 1318 **
 1319 ** ^SQLite will always allocate at least mxPathname+1 bytes for the
 1320 ** output buffer xFullPathname.  The exact size of the output buffer
 1321 ** is also passed as a parameter to both  methods. If the output buffer
 1322 ** is not large enough, [SQLITE_CANTOPEN] should be returned. Since this is
 1323 ** handled as a fatal error by SQLite, vfs implementations should endeavor
 1324 ** to prevent this by setting mxPathname to a sufficiently large value.
 1325 **
 1326 ** The xRandomness(), xSleep(), xCurrentTime(), and xCurrentTimeInt64()
 1327 ** interfaces are not strictly a part of the filesystem, but they are
 1328 ** included in the VFS structure for completeness.
 1329 ** The xRandomness() function attempts to return nBytes bytes
 1330 ** of good-quality randomness into zOut.  The return value is
 1331 ** the actual number of bytes of randomness obtained.
 1332 ** The xSleep() method causes the calling thread to sleep for at
 1333 ** least the number of microseconds given.  ^The xCurrentTime()
 1334 ** method returns a Julian Day Number for the current date and time as
 1335 ** a floating point value.
 1336 ** ^The xCurrentTimeInt64() method returns, as an integer, the Julian
 1337 ** Day Number multiplied by 86400000 (the number of milliseconds in
 1338 ** a 24-hour day).
 1339 ** ^SQLite will use the xCurrentTimeInt64() method to get the current
 1340 ** date and time if that method is available (if iVersion is 2 or
 1341 ** greater and the function pointer is not NULL) and will fall back
 1342 ** to xCurrentTime() if xCurrentTimeInt64() is unavailable.
 1343 **
 1344 ** ^The xSetSystemCall(), xGetSystemCall(), and xNestSystemCall() interfaces
 1345 ** are not used by the SQLite core.  These optional interfaces are provided
 1346 ** by some VFSes to facilitate testing of the VFS code. By overriding
 1347 ** system calls with functions under its control, a test program can
 1348 ** simulate faults and error conditions that would otherwise be difficult
 1349 ** or impossible to induce.  The set of system calls that can be overridden
 1350 ** varies from one VFS to another, and from one version of the same VFS to the
 1351 ** next.  Applications that use these interfaces must be prepared for any
 1352 ** or all of these interfaces to be NULL or for their behavior to change
 1353 ** from one release to the next.  Applications must not attempt to access
 1354 ** any of these methods if the iVersion of the VFS is less than 3.
 1355 */
 1356 typedef struct sqlite3_vfs sqlite3_vfs;
 1357 typedef void (*sqlite3_syscall_ptr)(void);
 1358 struct sqlite3_vfs {
 1359   int iVersion;            /* Structure version number (currently 3) */
 1360   int szOsFile;            /* Size of subclassed sqlite3_file */
 1361   int mxPathname;          /* Maximum file pathname length */
 1362   sqlite3_vfs *pNext;      /* Next registered VFS */
 1363   const char *zName;       /* Name of this virtual file system */
 1364   void *pAppData;          /* Pointer to application-specific data */
 1365   int (*xOpen)(sqlite3_vfs*, const char *zName, sqlite3_file*,
 1366                int flags, int *pOutFlags);
 1367   int (*xDelete)(sqlite3_vfs*, const char *zName, int syncDir);
 1368   int (*xAccess)(sqlite3_vfs*, const char *zName, int flags, int *pResOut);
 1369   int (*xFullPathname)(sqlite3_vfs*, const char *zName, int nOut, char *zOut);
 1370   void *(*xDlOpen)(sqlite3_vfs*, const char *zFilename);
 1371   void (*xDlError)(sqlite3_vfs*, int nByte, char *zErrMsg);
 1372   void (*(*xDlSym)(sqlite3_vfs*,void*, const char *zSymbol))(void);
 1373   void (*xDlClose)(sqlite3_vfs*, void*);
 1374   int (*xRandomness)(sqlite3_vfs*, int nByte, char *zOut);
 1375   int (*xSleep)(sqlite3_vfs*, int microseconds);
 1376   int (*xCurrentTime)(sqlite3_vfs*, double*);
 1377   int (*xGetLastError)(sqlite3_vfs*, int, char *);
 1378   /*
 1379   ** The methods above are in version 1 of the sqlite_vfs object
 1380   ** definition.  Those that follow are added in version 2 or later
 1381   */
 1382   int (*xCurrentTimeInt64)(sqlite3_vfs*, sqlite3_int64*);
 1383   /*
 1384   ** The methods above are in versions 1 and 2 of the sqlite_vfs object.
 1385   ** Those below are for version 3 and greater.
 1386   */
 1387   int (*xSetSystemCall)(sqlite3_vfs*, const char *zName, sqlite3_syscall_ptr);
 1388   sqlite3_syscall_ptr (*xGetSystemCall)(sqlite3_vfs*, const char *zName);
 1389   const char *(*xNextSystemCall)(sqlite3_vfs*, const char *zName);
 1390   /*
 1391   ** The methods above are in versions 1 through 3 of the sqlite_vfs object.
 1392   ** New fields may be appended in future versions.  The iVersion
 1393   ** value will increment whenever this happens.
 1394   */
 1395 };
 1396 
 1397 /*
 1398 ** CAPI3REF: Flags for the xAccess VFS method
 1399 **
 1400 ** These integer constants can be used as the third parameter to
 1401 ** the xAccess method of an [sqlite3_vfs] object.  They determine
 1402 ** what kind of permissions the xAccess method is looking for.
 1403 ** With SQLITE_ACCESS_EXISTS, the xAccess method
 1404 ** simply checks whether the file exists.
 1405 ** With SQLITE_ACCESS_READWRITE, the xAccess method
 1406 ** checks whether the named directory is both readable and writable
 1407 ** (in other words, if files can be added, removed, and renamed within
 1408 ** the directory).
 1409 ** The SQLITE_ACCESS_READWRITE constant is currently used only by the
 1410 ** [temp_store_directory pragma], though this could change in a future
 1411 ** release of SQLite.
 1412 ** With SQLITE_ACCESS_READ, the xAccess method
 1413 ** checks whether the file is readable.  The SQLITE_ACCESS_READ constant is
 1414 ** currently unused, though it might be used in a future release of
 1415 ** SQLite.
 1416 */
 1417 #define SQLITE_ACCESS_EXISTS    0
 1418 #define SQLITE_ACCESS_READWRITE 1   /* Used by PRAGMA temp_store_directory */
 1419 #define SQLITE_ACCESS_READ      2   /* Unused */
 1420 
 1421 /*
 1422 ** CAPI3REF: Flags for the xShmLock VFS method
 1423 **
 1424 ** These integer constants define the various locking operations
 1425 ** allowed by the xShmLock method of [sqlite3_io_methods].  The
 1426 ** following are the only legal combinations of flags to the
 1427 ** xShmLock method:
 1428 **
 1429 ** &lt;ul&gt;
 1430 ** &lt;li&gt;  SQLITE_SHM_LOCK | SQLITE_SHM_SHARED
 1431 ** &lt;li&gt;  SQLITE_SHM_LOCK | SQLITE_SHM_EXCLUSIVE
 1432 ** &lt;li&gt;  SQLITE_SHM_UNLOCK | SQLITE_SHM_SHARED
 1433 ** &lt;li&gt;  SQLITE_SHM_UNLOCK | SQLITE_SHM_EXCLUSIVE
 1434 ** &lt;/ul&gt;
 1435 **
 1436 ** When unlocking, the same SHARED or EXCLUSIVE flag must be supplied as
 1437 ** was given on the corresponding lock.
 1438 **
 1439 ** The xShmLock method can transition between unlocked and SHARED or
 1440 ** between unlocked and EXCLUSIVE.  It cannot transition between SHARED
 1441 ** and EXCLUSIVE.
 1442 */
 1443 #define SQLITE_SHM_UNLOCK       1
 1444 #define SQLITE_SHM_LOCK         2
 1445 #define SQLITE_SHM_SHARED       4
 1446 #define SQLITE_SHM_EXCLUSIVE    8
 1447 
 1448 /*
 1449 ** CAPI3REF: Maximum xShmLock index
 1450 **
 1451 ** The xShmLock method on [sqlite3_io_methods] may use values
 1452 ** between 0 and this upper bound as its &quot;offset&quot; argument.
 1453 ** The SQLite core will never attempt to acquire or release a
 1454 ** lock outside of this range
 1455 */
 1456 #define SQLITE_SHM_NLOCK        8
 1457 
 1458 
 1459 /*
 1460 ** CAPI3REF: Initialize The SQLite Library
 1461 **
 1462 ** ^The sqlite3_initialize() routine initializes the
 1463 ** SQLite library.  ^The sqlite3_shutdown() routine
 1464 ** deallocates any resources that were allocated by sqlite3_initialize().
 1465 ** These routines are designed to aid in process initialization and
 1466 ** shutdown on embedded systems.  Workstation applications using
 1467 ** SQLite normally do not need to invoke either of these routines.
 1468 **
 1469 ** A call to sqlite3_initialize() is an &quot;effective&quot; call if it is
 1470 ** the first time sqlite3_initialize() is invoked during the lifetime of
 1471 ** the process, or if it is the first time sqlite3_initialize() is invoked
 1472 ** following a call to sqlite3_shutdown().  ^(Only an effective call
 1473 ** of sqlite3_initialize() does any initialization.  All other calls
 1474 ** are harmless no-ops.)^
 1475 **
 1476 ** A call to sqlite3_shutdown() is an &quot;effective&quot; call if it is the first
 1477 ** call to sqlite3_shutdown() since the last sqlite3_initialize().  ^(Only
 1478 ** an effective call to sqlite3_shutdown() does any deinitialization.
 1479 ** All other valid calls to sqlite3_shutdown() are harmless no-ops.)^
 1480 **
 1481 ** The sqlite3_initialize() interface is threadsafe, but sqlite3_shutdown()
 1482 ** is not.  The sqlite3_shutdown() interface must only be called from a
 1483 ** single thread.  All open [database connections] must be closed and all
 1484 ** other SQLite resources must be deallocated prior to invoking
 1485 ** sqlite3_shutdown().
 1486 **
 1487 ** Among other things, ^sqlite3_initialize() will invoke
 1488 ** sqlite3_os_init().  Similarly, ^sqlite3_shutdown()
 1489 ** will invoke sqlite3_os_end().
 1490 **
 1491 ** ^The sqlite3_initialize() routine returns [SQLITE_OK] on success.
 1492 ** ^If for some reason, sqlite3_initialize() is unable to initialize
 1493 ** the library (perhaps it is unable to allocate a needed resource such
 1494 ** as a mutex) it returns an [error code] other than [SQLITE_OK].
 1495 **
 1496 ** ^The sqlite3_initialize() routine is called internally by many other
 1497 ** SQLite interfaces so that an application usually does not need to
 1498 ** invoke sqlite3_initialize() directly.  For example, [sqlite3_open()]
 1499 ** calls sqlite3_initialize() so the SQLite library will be automatically
 1500 ** initialized when [sqlite3_open()] is called if it has not be initialized
 1501 ** already.  ^However, if SQLite is compiled with the [SQLITE_OMIT_AUTOINIT]
 1502 ** compile-time option, then the automatic calls to sqlite3_initialize()
 1503 ** are omitted and the application must call sqlite3_initialize() directly
 1504 ** prior to using any other SQLite interface.  For maximum portability,
 1505 ** it is recommended that applications always invoke sqlite3_initialize()
 1506 ** directly prior to using any other SQLite interface.  Future releases
 1507 ** of SQLite may require this.  In other words, the behavior exhibited
 1508 ** when SQLite is compiled with [SQLITE_OMIT_AUTOINIT] might become the
 1509 ** default behavior in some future release of SQLite.
 1510 **
 1511 ** The sqlite3_os_init() routine does operating-system specific
 1512 ** initialization of the SQLite library.  The sqlite3_os_end()
 1513 ** routine undoes the effect of sqlite3_os_init().  Typical tasks
 1514 ** performed by these routines include allocation or deallocation
 1515 ** of static resources, initialization of global variables,
 1516 ** setting up a default [sqlite3_vfs] module, or setting up
 1517 ** a default configuration using [sqlite3_config()].
 1518 **
 1519 ** The application should never invoke either sqlite3_os_init()
 1520 ** or sqlite3_os_end() directly.  The application should only invoke
 1521 ** sqlite3_initialize() and sqlite3_shutdown().  The sqlite3_os_init()
 1522 ** interface is called automatically by sqlite3_initialize() and
 1523 ** sqlite3_os_end() is called by sqlite3_shutdown().  Appropriate
 1524 ** implementations for sqlite3_os_init() and sqlite3_os_end()
 1525 ** are built into SQLite when it is compiled for Unix, Windows, or OS/2.
 1526 ** When [custom builds | built for other platforms]
 1527 ** (using the [SQLITE_OS_OTHER=1] compile-time
 1528 ** option) the application must supply a suitable implementation for
 1529 ** sqlite3_os_init() and sqlite3_os_end().  An application-supplied
 1530 ** implementation of sqlite3_os_init() or sqlite3_os_end()
 1531 ** must return [SQLITE_OK] on success and some other [error code] upon
 1532 ** failure.
 1533 */
 1534 SQLITE_API int sqlite3_initialize(void);
 1535 SQLITE_API int sqlite3_shutdown(void);
 1536 SQLITE_API int sqlite3_os_init(void);
 1537 SQLITE_API int sqlite3_os_end(void);
 1538 
 1539 /*
 1540 ** CAPI3REF: Configuring The SQLite Library
 1541 **
 1542 ** The sqlite3_config() interface is used to make global configuration
 1543 ** changes to SQLite in order to tune SQLite to the specific needs of
 1544 ** the application.  The default configuration is recommended for most
 1545 ** applications and so this routine is usually not necessary.  It is
 1546 ** provided to support rare applications with unusual needs.
 1547 **
 1548 ** &lt;b&gt;The sqlite3_config() interface is not threadsafe. The application
 1549 ** must ensure that no other SQLite interfaces are invoked by other
 1550 ** threads while sqlite3_config() is running.&lt;/b&gt;
 1551 **
 1552 ** The sqlite3_config() interface
 1553 ** may only be invoked prior to library initialization using
 1554 ** [sqlite3_initialize()] or after shutdown by [sqlite3_shutdown()].
 1555 ** ^If sqlite3_config() is called after [sqlite3_initialize()] and before
 1556 ** [sqlite3_shutdown()] then it will return SQLITE_MISUSE.
 1557 ** Note, however, that ^sqlite3_config() can be called as part of the
 1558 ** implementation of an application-defined [sqlite3_os_init()].
 1559 **
 1560 ** The first argument to sqlite3_config() is an integer
 1561 ** [configuration option] that determines
 1562 ** what property of SQLite is to be configured.  Subsequent arguments
 1563 ** vary depending on the [configuration option]
 1564 ** in the first argument.
 1565 **
 1566 ** ^When a configuration option is set, sqlite3_config() returns [SQLITE_OK].
 1567 ** ^If the option is unknown or SQLite is unable to set the option
 1568 ** then this routine returns a non-zero [error code].
 1569 */
 1570 SQLITE_API int sqlite3_config(int, ...);
 1571 
 1572 /*
 1573 ** CAPI3REF: Configure database connections
 1574 ** METHOD: sqlite3
 1575 **
 1576 ** The sqlite3_db_config() interface is used to make configuration
 1577 ** changes to a [database connection].  The interface is similar to
 1578 ** [sqlite3_config()] except that the changes apply to a single
 1579 ** [database connection] (specified in the first argument).
 1580 **
 1581 ** The second argument to sqlite3_db_config(D,V,...)  is the
 1582 ** [SQLITE_DBCONFIG_LOOKASIDE | configuration verb] - an integer code
 1583 ** that indicates what aspect of the [database connection] is being configured.
 1584 ** Subsequent arguments vary depending on the configuration verb.
 1585 **
 1586 ** ^Calls to sqlite3_db_config() return SQLITE_OK if and only if
 1587 ** the call is considered successful.
 1588 */
 1589 SQLITE_API int sqlite3_db_config(sqlite3*, int op, ...);
 1590 
 1591 /*
 1592 ** CAPI3REF: Memory Allocation Routines
 1593 **
 1594 ** An instance of this object defines the interface between SQLite
 1595 ** and low-level memory allocation routines.
 1596 **
 1597 ** This object is used in only one place in the SQLite interface.
 1598 ** A pointer to an instance of this object is the argument to
 1599 ** [sqlite3_config()] when the configuration option is
 1600 ** [SQLITE_CONFIG_MALLOC] or [SQLITE_CONFIG_GETMALLOC].
 1601 ** By creating an instance of this object
 1602 ** and passing it to [sqlite3_config]([SQLITE_CONFIG_MALLOC])
 1603 ** during configuration, an application can specify an alternative
 1604 ** memory allocation subsystem for SQLite to use for all of its
 1605 ** dynamic memory needs.
 1606 **
 1607 ** Note that SQLite comes with several [built-in memory allocators]
 1608 ** that are perfectly adequate for the overwhelming majority of applications
 1609 ** and that this object is only useful to a tiny minority of applications
 1610 ** with specialized memory allocation requirements.  This object is
 1611 ** also used during testing of SQLite in order to specify an alternative
 1612 ** memory allocator that simulates memory out-of-memory conditions in
 1613 ** order to verify that SQLite recovers gracefully from such
 1614 ** conditions.
 1615 **
 1616 ** The xMalloc, xRealloc, and xFree methods must work like the
 1617 ** malloc(), realloc() and free() functions from the standard C library.
 1618 ** ^SQLite guarantees that the second argument to
 1619 ** xRealloc is always a value returned by a prior call to xRoundup.
 1620 **
 1621 ** xSize should return the allocated size of a memory allocation
 1622 ** previously obtained from xMalloc or xRealloc.  The allocated size
 1623 ** is always at least as big as the requested size but may be larger.
 1624 **
 1625 ** The xRoundup method returns what would be the allocated size of
 1626 ** a memory allocation given a particular requested size.  Most memory
 1627 ** allocators round up memory allocations at least to the next multiple
 1628 ** of 8.  Some allocators round up to a larger multiple or to a power of 2.
 1629 ** Every memory allocation request coming in through [sqlite3_malloc()]
 1630 ** or [sqlite3_realloc()] first calls xRoundup.  If xRoundup returns 0,
 1631 ** that causes the corresponding memory allocation to fail.
 1632 **
 1633 ** The xInit method initializes the memory allocator.  For example,
<a name="15" id="anc15"></a><span class="line-modified"> 1634 ** it might allocate any required mutexes or initialize internal data</span>
 1635 ** structures.  The xShutdown method is invoked (indirectly) by
 1636 ** [sqlite3_shutdown()] and should deallocate any resources acquired
 1637 ** by xInit.  The pAppData pointer is used as the only parameter to
 1638 ** xInit and xShutdown.
 1639 **
 1640 ** SQLite holds the [SQLITE_MUTEX_STATIC_MASTER] mutex when it invokes
 1641 ** the xInit method, so the xInit method need not be threadsafe.  The
 1642 ** xShutdown method is only called from [sqlite3_shutdown()] so it does
 1643 ** not need to be threadsafe either.  For all other methods, SQLite
 1644 ** holds the [SQLITE_MUTEX_STATIC_MEM] mutex as long as the
 1645 ** [SQLITE_CONFIG_MEMSTATUS] configuration option is turned on (which
 1646 ** it is by default) and so the methods are automatically serialized.
 1647 ** However, if [SQLITE_CONFIG_MEMSTATUS] is disabled, then the other
 1648 ** methods must be threadsafe or else make their own arrangements for
 1649 ** serialization.
 1650 **
 1651 ** SQLite will never invoke xInit() more than once without an intervening
 1652 ** call to xShutdown().
 1653 */
 1654 typedef struct sqlite3_mem_methods sqlite3_mem_methods;
 1655 struct sqlite3_mem_methods {
 1656   void *(*xMalloc)(int);         /* Memory allocation function */
 1657   void (*xFree)(void*);          /* Free a prior allocation */
 1658   void *(*xRealloc)(void*,int);  /* Resize an allocation */
 1659   int (*xSize)(void*);           /* Return the size of an allocation */
 1660   int (*xRoundup)(int);          /* Round up request size to allocation size */
 1661   int (*xInit)(void*);           /* Initialize the memory allocator */
 1662   void (*xShutdown)(void*);      /* Deinitialize the memory allocator */
 1663   void *pAppData;                /* Argument to xInit() and xShutdown() */
 1664 };
 1665 
 1666 /*
 1667 ** CAPI3REF: Configuration Options
 1668 ** KEYWORDS: {configuration option}
 1669 **
 1670 ** These constants are the available integer configuration options that
 1671 ** can be passed as the first argument to the [sqlite3_config()] interface.
 1672 **
 1673 ** New configuration options may be added in future releases of SQLite.
 1674 ** Existing configuration options might be discontinued.  Applications
 1675 ** should check the return code from [sqlite3_config()] to make sure that
 1676 ** the call worked.  The [sqlite3_config()] interface will return a
 1677 ** non-zero [error code] if a discontinued or unsupported configuration option
 1678 ** is invoked.
 1679 **
 1680 ** &lt;dl&gt;
 1681 ** [[SQLITE_CONFIG_SINGLETHREAD]] &lt;dt&gt;SQLITE_CONFIG_SINGLETHREAD&lt;/dt&gt;
 1682 ** &lt;dd&gt;There are no arguments to this option.  ^This option sets the
 1683 ** [threading mode] to Single-thread.  In other words, it disables
 1684 ** all mutexing and puts SQLite into a mode where it can only be used
 1685 ** by a single thread.   ^If SQLite is compiled with
 1686 ** the [SQLITE_THREADSAFE | SQLITE_THREADSAFE=0] compile-time option then
 1687 ** it is not possible to change the [threading mode] from its default
 1688 ** value of Single-thread and so [sqlite3_config()] will return
 1689 ** [SQLITE_ERROR] if called with the SQLITE_CONFIG_SINGLETHREAD
 1690 ** configuration option.&lt;/dd&gt;
 1691 **
 1692 ** [[SQLITE_CONFIG_MULTITHREAD]] &lt;dt&gt;SQLITE_CONFIG_MULTITHREAD&lt;/dt&gt;
 1693 ** &lt;dd&gt;There are no arguments to this option.  ^This option sets the
 1694 ** [threading mode] to Multi-thread.  In other words, it disables
 1695 ** mutexing on [database connection] and [prepared statement] objects.
 1696 ** The application is responsible for serializing access to
 1697 ** [database connections] and [prepared statements].  But other mutexes
 1698 ** are enabled so that SQLite will be safe to use in a multi-threaded
 1699 ** environment as long as no two threads attempt to use the same
 1700 ** [database connection] at the same time.  ^If SQLite is compiled with
 1701 ** the [SQLITE_THREADSAFE | SQLITE_THREADSAFE=0] compile-time option then
 1702 ** it is not possible to set the Multi-thread [threading mode] and
 1703 ** [sqlite3_config()] will return [SQLITE_ERROR] if called with the
 1704 ** SQLITE_CONFIG_MULTITHREAD configuration option.&lt;/dd&gt;
 1705 **
 1706 ** [[SQLITE_CONFIG_SERIALIZED]] &lt;dt&gt;SQLITE_CONFIG_SERIALIZED&lt;/dt&gt;
 1707 ** &lt;dd&gt;There are no arguments to this option.  ^This option sets the
 1708 ** [threading mode] to Serialized. In other words, this option enables
 1709 ** all mutexes including the recursive
 1710 ** mutexes on [database connection] and [prepared statement] objects.
 1711 ** In this mode (which is the default when SQLite is compiled with
 1712 ** [SQLITE_THREADSAFE=1]) the SQLite library will itself serialize access
 1713 ** to [database connections] and [prepared statements] so that the
 1714 ** application is free to use the same [database connection] or the
 1715 ** same [prepared statement] in different threads at the same time.
 1716 ** ^If SQLite is compiled with
 1717 ** the [SQLITE_THREADSAFE | SQLITE_THREADSAFE=0] compile-time option then
 1718 ** it is not possible to set the Serialized [threading mode] and
 1719 ** [sqlite3_config()] will return [SQLITE_ERROR] if called with the
 1720 ** SQLITE_CONFIG_SERIALIZED configuration option.&lt;/dd&gt;
 1721 **
 1722 ** [[SQLITE_CONFIG_MALLOC]] &lt;dt&gt;SQLITE_CONFIG_MALLOC&lt;/dt&gt;
 1723 ** &lt;dd&gt; ^(The SQLITE_CONFIG_MALLOC option takes a single argument which is
 1724 ** a pointer to an instance of the [sqlite3_mem_methods] structure.
 1725 ** The argument specifies
 1726 ** alternative low-level memory allocation routines to be used in place of
 1727 ** the memory allocation routines built into SQLite.)^ ^SQLite makes
 1728 ** its own private copy of the content of the [sqlite3_mem_methods] structure
 1729 ** before the [sqlite3_config()] call returns.&lt;/dd&gt;
 1730 **
 1731 ** [[SQLITE_CONFIG_GETMALLOC]] &lt;dt&gt;SQLITE_CONFIG_GETMALLOC&lt;/dt&gt;
 1732 ** &lt;dd&gt; ^(The SQLITE_CONFIG_GETMALLOC option takes a single argument which
 1733 ** is a pointer to an instance of the [sqlite3_mem_methods] structure.
 1734 ** The [sqlite3_mem_methods]
 1735 ** structure is filled with the currently defined memory allocation routines.)^
 1736 ** This option can be used to overload the default memory allocation
 1737 ** routines with a wrapper that simulations memory allocation failure or
 1738 ** tracks memory usage, for example. &lt;/dd&gt;
 1739 **
 1740 ** [[SQLITE_CONFIG_SMALL_MALLOC]] &lt;dt&gt;SQLITE_CONFIG_SMALL_MALLOC&lt;/dt&gt;
 1741 ** &lt;dd&gt; ^The SQLITE_CONFIG_SMALL_MALLOC option takes single argument of
 1742 ** type int, interpreted as a boolean, which if true provides a hint to
 1743 ** SQLite that it should avoid large memory allocations if possible.
 1744 ** SQLite will run faster if it is free to make large memory allocations,
 1745 ** but some application might prefer to run slower in exchange for
 1746 ** guarantees about memory fragmentation that are possible if large
 1747 ** allocations are avoided.  This hint is normally off.
 1748 ** &lt;/dd&gt;
 1749 **
 1750 ** [[SQLITE_CONFIG_MEMSTATUS]] &lt;dt&gt;SQLITE_CONFIG_MEMSTATUS&lt;/dt&gt;
 1751 ** &lt;dd&gt; ^The SQLITE_CONFIG_MEMSTATUS option takes single argument of type int,
 1752 ** interpreted as a boolean, which enables or disables the collection of
 1753 ** memory allocation statistics. ^(When memory allocation statistics are
 1754 ** disabled, the following SQLite interfaces become non-operational:
 1755 **   &lt;ul&gt;
<a name="16" id="anc16"></a><span class="line-added"> 1756 **   &lt;li&gt; [sqlite3_hard_heap_limit64()]</span>
 1757 **   &lt;li&gt; [sqlite3_memory_used()]
 1758 **   &lt;li&gt; [sqlite3_memory_highwater()]
 1759 **   &lt;li&gt; [sqlite3_soft_heap_limit64()]
 1760 **   &lt;li&gt; [sqlite3_status64()]
 1761 **   &lt;/ul&gt;)^
 1762 ** ^Memory allocation statistics are enabled by default unless SQLite is
 1763 ** compiled with [SQLITE_DEFAULT_MEMSTATUS]=0 in which case memory
 1764 ** allocation statistics are disabled by default.
 1765 ** &lt;/dd&gt;
 1766 **
 1767 ** [[SQLITE_CONFIG_SCRATCH]] &lt;dt&gt;SQLITE_CONFIG_SCRATCH&lt;/dt&gt;
 1768 ** &lt;dd&gt; The SQLITE_CONFIG_SCRATCH option is no longer used.
 1769 ** &lt;/dd&gt;
 1770 **
 1771 ** [[SQLITE_CONFIG_PAGECACHE]] &lt;dt&gt;SQLITE_CONFIG_PAGECACHE&lt;/dt&gt;
 1772 ** &lt;dd&gt; ^The SQLITE_CONFIG_PAGECACHE option specifies a memory pool
 1773 ** that SQLite can use for the database page cache with the default page
 1774 ** cache implementation.
<a name="17" id="anc17"></a><span class="line-modified"> 1775 ** This configuration option is a no-op if an application-defined page</span>
 1776 ** cache implementation is loaded using the [SQLITE_CONFIG_PCACHE2].
 1777 ** ^There are three arguments to SQLITE_CONFIG_PAGECACHE: A pointer to
 1778 ** 8-byte aligned memory (pMem), the size of each page cache line (sz),
 1779 ** and the number of cache lines (N).
 1780 ** The sz argument should be the size of the largest database page
 1781 ** (a power of two between 512 and 65536) plus some extra bytes for each
 1782 ** page header.  ^The number of extra bytes needed by the page header
 1783 ** can be determined using [SQLITE_CONFIG_PCACHE_HDRSZ].
 1784 ** ^It is harmless, apart from the wasted memory,
 1785 ** for the sz parameter to be larger than necessary.  The pMem
 1786 ** argument must be either a NULL pointer or a pointer to an 8-byte
 1787 ** aligned block of memory of at least sz*N bytes, otherwise
 1788 ** subsequent behavior is undefined.
 1789 ** ^When pMem is not NULL, SQLite will strive to use the memory provided
 1790 ** to satisfy page cache needs, falling back to [sqlite3_malloc()] if
 1791 ** a page cache line is larger than sz bytes or if all of the pMem buffer
 1792 ** is exhausted.
 1793 ** ^If pMem is NULL and N is non-zero, then each database connection
 1794 ** does an initial bulk allocation for page cache memory
 1795 ** from [sqlite3_malloc()] sufficient for N cache lines if N is positive or
 1796 ** of -1024*N bytes if N is negative, . ^If additional
 1797 ** page cache memory is needed beyond what is provided by the initial
 1798 ** allocation, then SQLite goes to [sqlite3_malloc()] separately for each
 1799 ** additional cache line. &lt;/dd&gt;
 1800 **
 1801 ** [[SQLITE_CONFIG_HEAP]] &lt;dt&gt;SQLITE_CONFIG_HEAP&lt;/dt&gt;
 1802 ** &lt;dd&gt; ^The SQLITE_CONFIG_HEAP option specifies a static memory buffer
 1803 ** that SQLite will use for all of its dynamic memory allocation needs
 1804 ** beyond those provided for by [SQLITE_CONFIG_PAGECACHE].
 1805 ** ^The SQLITE_CONFIG_HEAP option is only available if SQLite is compiled
 1806 ** with either [SQLITE_ENABLE_MEMSYS3] or [SQLITE_ENABLE_MEMSYS5] and returns
 1807 ** [SQLITE_ERROR] if invoked otherwise.
 1808 ** ^There are three arguments to SQLITE_CONFIG_HEAP:
 1809 ** An 8-byte aligned pointer to the memory,
 1810 ** the number of bytes in the memory buffer, and the minimum allocation size.
 1811 ** ^If the first pointer (the memory pointer) is NULL, then SQLite reverts
 1812 ** to using its default memory allocator (the system malloc() implementation),
 1813 ** undoing any prior invocation of [SQLITE_CONFIG_MALLOC].  ^If the
 1814 ** memory pointer is not NULL then the alternative memory
 1815 ** allocator is engaged to handle all of SQLites memory allocation needs.
 1816 ** The first pointer (the memory pointer) must be aligned to an 8-byte
 1817 ** boundary or subsequent behavior of SQLite will be undefined.
 1818 ** The minimum allocation size is capped at 2**12. Reasonable values
 1819 ** for the minimum allocation size are 2**5 through 2**8.&lt;/dd&gt;
 1820 **
 1821 ** [[SQLITE_CONFIG_MUTEX]] &lt;dt&gt;SQLITE_CONFIG_MUTEX&lt;/dt&gt;
 1822 ** &lt;dd&gt; ^(The SQLITE_CONFIG_MUTEX option takes a single argument which is a
 1823 ** pointer to an instance of the [sqlite3_mutex_methods] structure.
 1824 ** The argument specifies alternative low-level mutex routines to be used
 1825 ** in place the mutex routines built into SQLite.)^  ^SQLite makes a copy of
 1826 ** the content of the [sqlite3_mutex_methods] structure before the call to
 1827 ** [sqlite3_config()] returns. ^If SQLite is compiled with
 1828 ** the [SQLITE_THREADSAFE | SQLITE_THREADSAFE=0] compile-time option then
 1829 ** the entire mutexing subsystem is omitted from the build and hence calls to
 1830 ** [sqlite3_config()] with the SQLITE_CONFIG_MUTEX configuration option will
 1831 ** return [SQLITE_ERROR].&lt;/dd&gt;
 1832 **
 1833 ** [[SQLITE_CONFIG_GETMUTEX]] &lt;dt&gt;SQLITE_CONFIG_GETMUTEX&lt;/dt&gt;
 1834 ** &lt;dd&gt; ^(The SQLITE_CONFIG_GETMUTEX option takes a single argument which
 1835 ** is a pointer to an instance of the [sqlite3_mutex_methods] structure.  The
 1836 ** [sqlite3_mutex_methods]
 1837 ** structure is filled with the currently defined mutex routines.)^
 1838 ** This option can be used to overload the default mutex allocation
 1839 ** routines with a wrapper used to track mutex usage for performance
 1840 ** profiling or testing, for example.   ^If SQLite is compiled with
 1841 ** the [SQLITE_THREADSAFE | SQLITE_THREADSAFE=0] compile-time option then
 1842 ** the entire mutexing subsystem is omitted from the build and hence calls to
 1843 ** [sqlite3_config()] with the SQLITE_CONFIG_GETMUTEX configuration option will
 1844 ** return [SQLITE_ERROR].&lt;/dd&gt;
 1845 **
 1846 ** [[SQLITE_CONFIG_LOOKASIDE]] &lt;dt&gt;SQLITE_CONFIG_LOOKASIDE&lt;/dt&gt;
 1847 ** &lt;dd&gt; ^(The SQLITE_CONFIG_LOOKASIDE option takes two arguments that determine
 1848 ** the default size of lookaside memory on each [database connection].
 1849 ** The first argument is the
 1850 ** size of each lookaside buffer slot and the second is the number of
 1851 ** slots allocated to each database connection.)^  ^(SQLITE_CONFIG_LOOKASIDE
 1852 ** sets the &lt;i&gt;default&lt;/i&gt; lookaside size. The [SQLITE_DBCONFIG_LOOKASIDE]
 1853 ** option to [sqlite3_db_config()] can be used to change the lookaside
 1854 ** configuration on individual connections.)^ &lt;/dd&gt;
 1855 **
 1856 ** [[SQLITE_CONFIG_PCACHE2]] &lt;dt&gt;SQLITE_CONFIG_PCACHE2&lt;/dt&gt;
 1857 ** &lt;dd&gt; ^(The SQLITE_CONFIG_PCACHE2 option takes a single argument which is
 1858 ** a pointer to an [sqlite3_pcache_methods2] object.  This object specifies
 1859 ** the interface to a custom page cache implementation.)^
 1860 ** ^SQLite makes a copy of the [sqlite3_pcache_methods2] object.&lt;/dd&gt;
 1861 **
 1862 ** [[SQLITE_CONFIG_GETPCACHE2]] &lt;dt&gt;SQLITE_CONFIG_GETPCACHE2&lt;/dt&gt;
 1863 ** &lt;dd&gt; ^(The SQLITE_CONFIG_GETPCACHE2 option takes a single argument which
 1864 ** is a pointer to an [sqlite3_pcache_methods2] object.  SQLite copies of
 1865 ** the current page cache implementation into that object.)^ &lt;/dd&gt;
 1866 **
 1867 ** [[SQLITE_CONFIG_LOG]] &lt;dt&gt;SQLITE_CONFIG_LOG&lt;/dt&gt;
 1868 ** &lt;dd&gt; The SQLITE_CONFIG_LOG option is used to configure the SQLite
 1869 ** global [error log].
 1870 ** (^The SQLITE_CONFIG_LOG option takes two arguments: a pointer to a
 1871 ** function with a call signature of void(*)(void*,int,const char*),
 1872 ** and a pointer to void. ^If the function pointer is not NULL, it is
 1873 ** invoked by [sqlite3_log()] to process each logging event.  ^If the
 1874 ** function pointer is NULL, the [sqlite3_log()] interface becomes a no-op.
 1875 ** ^The void pointer that is the second argument to SQLITE_CONFIG_LOG is
 1876 ** passed through as the first parameter to the application-defined logger
 1877 ** function whenever that function is invoked.  ^The second parameter to
 1878 ** the logger function is a copy of the first parameter to the corresponding
 1879 ** [sqlite3_log()] call and is intended to be a [result code] or an
 1880 ** [extended result code].  ^The third parameter passed to the logger is
 1881 ** log message after formatting via [sqlite3_snprintf()].
 1882 ** The SQLite logging interface is not reentrant; the logger function
 1883 ** supplied by the application must not invoke any SQLite interface.
 1884 ** In a multi-threaded application, the application-defined logger
 1885 ** function must be threadsafe. &lt;/dd&gt;
 1886 **
 1887 ** [[SQLITE_CONFIG_URI]] &lt;dt&gt;SQLITE_CONFIG_URI
 1888 ** &lt;dd&gt;^(The SQLITE_CONFIG_URI option takes a single argument of type int.
 1889 ** If non-zero, then URI handling is globally enabled. If the parameter is zero,
 1890 ** then URI handling is globally disabled.)^ ^If URI handling is globally
 1891 ** enabled, all filenames passed to [sqlite3_open()], [sqlite3_open_v2()],
 1892 ** [sqlite3_open16()] or
 1893 ** specified as part of [ATTACH] commands are interpreted as URIs, regardless
 1894 ** of whether or not the [SQLITE_OPEN_URI] flag is set when the database
 1895 ** connection is opened. ^If it is globally disabled, filenames are
 1896 ** only interpreted as URIs if the SQLITE_OPEN_URI flag is set when the
 1897 ** database connection is opened. ^(By default, URI handling is globally
 1898 ** disabled. The default value may be changed by compiling with the
 1899 ** [SQLITE_USE_URI] symbol defined.)^
 1900 **
 1901 ** [[SQLITE_CONFIG_COVERING_INDEX_SCAN]] &lt;dt&gt;SQLITE_CONFIG_COVERING_INDEX_SCAN
 1902 ** &lt;dd&gt;^The SQLITE_CONFIG_COVERING_INDEX_SCAN option takes a single integer
 1903 ** argument which is interpreted as a boolean in order to enable or disable
 1904 ** the use of covering indices for full table scans in the query optimizer.
 1905 ** ^The default setting is determined
 1906 ** by the [SQLITE_ALLOW_COVERING_INDEX_SCAN] compile-time option, or is &quot;on&quot;
 1907 ** if that compile-time option is omitted.
 1908 ** The ability to disable the use of covering indices for full table scans
 1909 ** is because some incorrectly coded legacy applications might malfunction
 1910 ** when the optimization is enabled.  Providing the ability to
 1911 ** disable the optimization allows the older, buggy application code to work
 1912 ** without change even with newer versions of SQLite.
 1913 **
 1914 ** [[SQLITE_CONFIG_PCACHE]] [[SQLITE_CONFIG_GETPCACHE]]
 1915 ** &lt;dt&gt;SQLITE_CONFIG_PCACHE and SQLITE_CONFIG_GETPCACHE
 1916 ** &lt;dd&gt; These options are obsolete and should not be used by new code.
 1917 ** They are retained for backwards compatibility but are now no-ops.
 1918 ** &lt;/dd&gt;
 1919 **
 1920 ** [[SQLITE_CONFIG_SQLLOG]]
 1921 ** &lt;dt&gt;SQLITE_CONFIG_SQLLOG
 1922 ** &lt;dd&gt;This option is only available if sqlite is compiled with the
 1923 ** [SQLITE_ENABLE_SQLLOG] pre-processor macro defined. The first argument should
 1924 ** be a pointer to a function of type void(*)(void*,sqlite3*,const char*, int).
 1925 ** The second should be of type (void*). The callback is invoked by the library
 1926 ** in three separate circumstances, identified by the value passed as the
 1927 ** fourth parameter. If the fourth parameter is 0, then the database connection
 1928 ** passed as the second argument has just been opened. The third argument
 1929 ** points to a buffer containing the name of the main database file. If the
 1930 ** fourth parameter is 1, then the SQL statement that the third parameter
 1931 ** points to has just been executed. Or, if the fourth parameter is 2, then
 1932 ** the connection being passed as the second parameter is being closed. The
 1933 ** third parameter is passed NULL In this case.  An example of using this
 1934 ** configuration option can be seen in the &quot;test_sqllog.c&quot; source file in
 1935 ** the canonical SQLite source tree.&lt;/dd&gt;
 1936 **
 1937 ** [[SQLITE_CONFIG_MMAP_SIZE]]
 1938 ** &lt;dt&gt;SQLITE_CONFIG_MMAP_SIZE
 1939 ** &lt;dd&gt;^SQLITE_CONFIG_MMAP_SIZE takes two 64-bit integer (sqlite3_int64) values
 1940 ** that are the default mmap size limit (the default setting for
 1941 ** [PRAGMA mmap_size]) and the maximum allowed mmap size limit.
 1942 ** ^The default setting can be overridden by each database connection using
 1943 ** either the [PRAGMA mmap_size] command, or by using the
 1944 ** [SQLITE_FCNTL_MMAP_SIZE] file control.  ^(The maximum allowed mmap size
 1945 ** will be silently truncated if necessary so that it does not exceed the
 1946 ** compile-time maximum mmap size set by the
 1947 ** [SQLITE_MAX_MMAP_SIZE] compile-time option.)^
 1948 ** ^If either argument to this option is negative, then that argument is
 1949 ** changed to its compile-time default.
 1950 **
 1951 ** [[SQLITE_CONFIG_WIN32_HEAPSIZE]]
 1952 ** &lt;dt&gt;SQLITE_CONFIG_WIN32_HEAPSIZE
 1953 ** &lt;dd&gt;^The SQLITE_CONFIG_WIN32_HEAPSIZE option is only available if SQLite is
 1954 ** compiled for Windows with the [SQLITE_WIN32_MALLOC] pre-processor macro
 1955 ** defined. ^SQLITE_CONFIG_WIN32_HEAPSIZE takes a 32-bit unsigned integer value
 1956 ** that specifies the maximum size of the created heap.
 1957 **
 1958 ** [[SQLITE_CONFIG_PCACHE_HDRSZ]]
 1959 ** &lt;dt&gt;SQLITE_CONFIG_PCACHE_HDRSZ
 1960 ** &lt;dd&gt;^The SQLITE_CONFIG_PCACHE_HDRSZ option takes a single parameter which
 1961 ** is a pointer to an integer and writes into that integer the number of extra
 1962 ** bytes per page required for each page in [SQLITE_CONFIG_PAGECACHE].
 1963 ** The amount of extra space required can change depending on the compiler,
 1964 ** target platform, and SQLite version.
 1965 **
 1966 ** [[SQLITE_CONFIG_PMASZ]]
 1967 ** &lt;dt&gt;SQLITE_CONFIG_PMASZ
 1968 ** &lt;dd&gt;^The SQLITE_CONFIG_PMASZ option takes a single parameter which
 1969 ** is an unsigned integer and sets the &quot;Minimum PMA Size&quot; for the multithreaded
 1970 ** sorter to that integer.  The default minimum PMA Size is set by the
 1971 ** [SQLITE_SORTER_PMASZ] compile-time option.  New threads are launched
 1972 ** to help with sort operations when multithreaded sorting
 1973 ** is enabled (using the [PRAGMA threads] command) and the amount of content
 1974 ** to be sorted exceeds the page size times the minimum of the
 1975 ** [PRAGMA cache_size] setting and this value.
 1976 **
 1977 ** [[SQLITE_CONFIG_STMTJRNL_SPILL]]
 1978 ** &lt;dt&gt;SQLITE_CONFIG_STMTJRNL_SPILL
 1979 ** &lt;dd&gt;^The SQLITE_CONFIG_STMTJRNL_SPILL option takes a single parameter which
 1980 ** becomes the [statement journal] spill-to-disk threshold.
 1981 ** [Statement journals] are held in memory until their size (in bytes)
 1982 ** exceeds this threshold, at which point they are written to disk.
 1983 ** Or if the threshold is -1, statement journals are always held
 1984 ** exclusively in memory.
 1985 ** Since many statement journals never become large, setting the spill
 1986 ** threshold to a value such as 64KiB can greatly reduce the amount of
 1987 ** I/O required to support statement rollback.
 1988 ** The default value for this setting is controlled by the
 1989 ** [SQLITE_STMTJRNL_SPILL] compile-time option.
 1990 **
 1991 ** [[SQLITE_CONFIG_SORTERREF_SIZE]]
 1992 ** &lt;dt&gt;SQLITE_CONFIG_SORTERREF_SIZE
 1993 ** &lt;dd&gt;The SQLITE_CONFIG_SORTERREF_SIZE option accepts a single parameter
 1994 ** of type (int) - the new value of the sorter-reference size threshold.
 1995 ** Usually, when SQLite uses an external sort to order records according
 1996 ** to an ORDER BY clause, all fields required by the caller are present in the
 1997 ** sorted records. However, if SQLite determines based on the declared type
 1998 ** of a table column that its values are likely to be very large - larger
 1999 ** than the configured sorter-reference size threshold - then a reference
 2000 ** is stored in each sorted record and the required column values loaded
 2001 ** from the database as records are returned in sorted order. The default
 2002 ** value for this option is to never use this optimization. Specifying a
 2003 ** negative value for this option restores the default behaviour.
 2004 ** This option is only available if SQLite is compiled with the
 2005 ** [SQLITE_ENABLE_SORTER_REFERENCES] compile-time option.
 2006 **
 2007 ** [[SQLITE_CONFIG_MEMDB_MAXSIZE]]
 2008 ** &lt;dt&gt;SQLITE_CONFIG_MEMDB_MAXSIZE
 2009 ** &lt;dd&gt;The SQLITE_CONFIG_MEMDB_MAXSIZE option accepts a single parameter
 2010 ** [sqlite3_int64] parameter which is the default maximum size for an in-memory
 2011 ** database created using [sqlite3_deserialize()].  This default maximum
 2012 ** size can be adjusted up or down for individual databases using the
 2013 ** [SQLITE_FCNTL_SIZE_LIMIT] [sqlite3_file_control|file-control].  If this
 2014 ** configuration setting is never used, then the default maximum is determined
 2015 ** by the [SQLITE_MEMDB_DEFAULT_MAXSIZE] compile-time option.  If that
 2016 ** compile-time option is not set, then the default maximum is 1073741824.
 2017 ** &lt;/dl&gt;
 2018 */
 2019 #define SQLITE_CONFIG_SINGLETHREAD  1  /* nil */
 2020 #define SQLITE_CONFIG_MULTITHREAD   2  /* nil */
 2021 #define SQLITE_CONFIG_SERIALIZED    3  /* nil */
 2022 #define SQLITE_CONFIG_MALLOC        4  /* sqlite3_mem_methods* */
 2023 #define SQLITE_CONFIG_GETMALLOC     5  /* sqlite3_mem_methods* */
 2024 #define SQLITE_CONFIG_SCRATCH       6  /* No longer used */
 2025 #define SQLITE_CONFIG_PAGECACHE     7  /* void*, int sz, int N */
 2026 #define SQLITE_CONFIG_HEAP          8  /* void*, int nByte, int min */
 2027 #define SQLITE_CONFIG_MEMSTATUS     9  /* boolean */
 2028 #define SQLITE_CONFIG_MUTEX        10  /* sqlite3_mutex_methods* */
 2029 #define SQLITE_CONFIG_GETMUTEX     11  /* sqlite3_mutex_methods* */
 2030 /* previously SQLITE_CONFIG_CHUNKALLOC 12 which is now unused. */
 2031 #define SQLITE_CONFIG_LOOKASIDE    13  /* int int */
 2032 #define SQLITE_CONFIG_PCACHE       14  /* no-op */
 2033 #define SQLITE_CONFIG_GETPCACHE    15  /* no-op */
 2034 #define SQLITE_CONFIG_LOG          16  /* xFunc, void* */
 2035 #define SQLITE_CONFIG_URI          17  /* int */
 2036 #define SQLITE_CONFIG_PCACHE2      18  /* sqlite3_pcache_methods2* */
 2037 #define SQLITE_CONFIG_GETPCACHE2   19  /* sqlite3_pcache_methods2* */
 2038 #define SQLITE_CONFIG_COVERING_INDEX_SCAN 20  /* int */
 2039 #define SQLITE_CONFIG_SQLLOG       21  /* xSqllog, void* */
 2040 #define SQLITE_CONFIG_MMAP_SIZE    22  /* sqlite3_int64, sqlite3_int64 */
 2041 #define SQLITE_CONFIG_WIN32_HEAPSIZE      23  /* int nByte */
 2042 #define SQLITE_CONFIG_PCACHE_HDRSZ        24  /* int *psz */
 2043 #define SQLITE_CONFIG_PMASZ               25  /* unsigned int szPma */
 2044 #define SQLITE_CONFIG_STMTJRNL_SPILL      26  /* int nByte */
 2045 #define SQLITE_CONFIG_SMALL_MALLOC        27  /* boolean */
 2046 #define SQLITE_CONFIG_SORTERREF_SIZE      28  /* int nByte */
 2047 #define SQLITE_CONFIG_MEMDB_MAXSIZE       29  /* sqlite3_int64 */
 2048 
 2049 /*
 2050 ** CAPI3REF: Database Connection Configuration Options
 2051 **
 2052 ** These constants are the available integer configuration options that
 2053 ** can be passed as the second argument to the [sqlite3_db_config()] interface.
 2054 **
 2055 ** New configuration options may be added in future releases of SQLite.
 2056 ** Existing configuration options might be discontinued.  Applications
 2057 ** should check the return code from [sqlite3_db_config()] to make sure that
 2058 ** the call worked.  ^The [sqlite3_db_config()] interface will return a
 2059 ** non-zero [error code] if a discontinued or unsupported configuration option
 2060 ** is invoked.
 2061 **
 2062 ** &lt;dl&gt;
 2063 ** [[SQLITE_DBCONFIG_LOOKASIDE]]
 2064 ** &lt;dt&gt;SQLITE_DBCONFIG_LOOKASIDE&lt;/dt&gt;
 2065 ** &lt;dd&gt; ^This option takes three additional arguments that determine the
 2066 ** [lookaside memory allocator] configuration for the [database connection].
 2067 ** ^The first argument (the third parameter to [sqlite3_db_config()] is a
 2068 ** pointer to a memory buffer to use for lookaside memory.
 2069 ** ^The first argument after the SQLITE_DBCONFIG_LOOKASIDE verb
 2070 ** may be NULL in which case SQLite will allocate the
 2071 ** lookaside buffer itself using [sqlite3_malloc()]. ^The second argument is the
 2072 ** size of each lookaside buffer slot.  ^The third argument is the number of
 2073 ** slots.  The size of the buffer in the first argument must be greater than
 2074 ** or equal to the product of the second and third arguments.  The buffer
 2075 ** must be aligned to an 8-byte boundary.  ^If the second argument to
 2076 ** SQLITE_DBCONFIG_LOOKASIDE is not a multiple of 8, it is internally
 2077 ** rounded down to the next smaller multiple of 8.  ^(The lookaside memory
 2078 ** configuration for a database connection can only be changed when that
 2079 ** connection is not currently using lookaside memory, or in other words
 2080 ** when the &quot;current value&quot; returned by
 2081 ** [sqlite3_db_status](D,[SQLITE_CONFIG_LOOKASIDE],...) is zero.
 2082 ** Any attempt to change the lookaside memory configuration when lookaside
 2083 ** memory is in use leaves the configuration unchanged and returns
 2084 ** [SQLITE_BUSY].)^&lt;/dd&gt;
 2085 **
 2086 ** [[SQLITE_DBCONFIG_ENABLE_FKEY]]
 2087 ** &lt;dt&gt;SQLITE_DBCONFIG_ENABLE_FKEY&lt;/dt&gt;
 2088 ** &lt;dd&gt; ^This option is used to enable or disable the enforcement of
 2089 ** [foreign key constraints].  There should be two additional arguments.
 2090 ** The first argument is an integer which is 0 to disable FK enforcement,
 2091 ** positive to enable FK enforcement or negative to leave FK enforcement
 2092 ** unchanged.  The second parameter is a pointer to an integer into which
 2093 ** is written 0 or 1 to indicate whether FK enforcement is off or on
 2094 ** following this call.  The second parameter may be a NULL pointer, in
 2095 ** which case the FK enforcement setting is not reported back. &lt;/dd&gt;
 2096 **
 2097 ** [[SQLITE_DBCONFIG_ENABLE_TRIGGER]]
 2098 ** &lt;dt&gt;SQLITE_DBCONFIG_ENABLE_TRIGGER&lt;/dt&gt;
 2099 ** &lt;dd&gt; ^This option is used to enable or disable [CREATE TRIGGER | triggers].
 2100 ** There should be two additional arguments.
 2101 ** The first argument is an integer which is 0 to disable triggers,
 2102 ** positive to enable triggers or negative to leave the setting unchanged.
 2103 ** The second parameter is a pointer to an integer into which
 2104 ** is written 0 or 1 to indicate whether triggers are disabled or enabled
 2105 ** following this call.  The second parameter may be a NULL pointer, in
 2106 ** which case the trigger setting is not reported back. &lt;/dd&gt;
 2107 **
 2108 ** [[SQLITE_DBCONFIG_ENABLE_VIEW]]
 2109 ** &lt;dt&gt;SQLITE_DBCONFIG_ENABLE_VIEW&lt;/dt&gt;
 2110 ** &lt;dd&gt; ^This option is used to enable or disable [CREATE VIEW | views].
 2111 ** There should be two additional arguments.
 2112 ** The first argument is an integer which is 0 to disable views,
 2113 ** positive to enable views or negative to leave the setting unchanged.
 2114 ** The second parameter is a pointer to an integer into which
 2115 ** is written 0 or 1 to indicate whether views are disabled or enabled
 2116 ** following this call.  The second parameter may be a NULL pointer, in
 2117 ** which case the view setting is not reported back. &lt;/dd&gt;
 2118 **
 2119 ** [[SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER]]
 2120 ** &lt;dt&gt;SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER&lt;/dt&gt;
 2121 ** &lt;dd&gt; ^This option is used to enable or disable the
 2122 ** [fts3_tokenizer()] function which is part of the
 2123 ** [FTS3] full-text search engine extension.
 2124 ** There should be two additional arguments.
 2125 ** The first argument is an integer which is 0 to disable fts3_tokenizer() or
 2126 ** positive to enable fts3_tokenizer() or negative to leave the setting
 2127 ** unchanged.
 2128 ** The second parameter is a pointer to an integer into which
 2129 ** is written 0 or 1 to indicate whether fts3_tokenizer is disabled or enabled
 2130 ** following this call.  The second parameter may be a NULL pointer, in
 2131 ** which case the new setting is not reported back. &lt;/dd&gt;
 2132 **
 2133 ** [[SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION]]
 2134 ** &lt;dt&gt;SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION&lt;/dt&gt;
 2135 ** &lt;dd&gt; ^This option is used to enable or disable the [sqlite3_load_extension()]
 2136 ** interface independently of the [load_extension()] SQL function.
 2137 ** The [sqlite3_enable_load_extension()] API enables or disables both the
 2138 ** C-API [sqlite3_load_extension()] and the SQL function [load_extension()].
 2139 ** There should be two additional arguments.
 2140 ** When the first argument to this interface is 1, then only the C-API is
 2141 ** enabled and the SQL function remains disabled.  If the first argument to
 2142 ** this interface is 0, then both the C-API and the SQL function are disabled.
 2143 ** If the first argument is -1, then no changes are made to state of either the
 2144 ** C-API or the SQL function.
 2145 ** The second parameter is a pointer to an integer into which
 2146 ** is written 0 or 1 to indicate whether [sqlite3_load_extension()] interface
 2147 ** is disabled or enabled following this call.  The second parameter may
 2148 ** be a NULL pointer, in which case the new setting is not reported back.
 2149 ** &lt;/dd&gt;
 2150 **
 2151 ** [[SQLITE_DBCONFIG_MAINDBNAME]] &lt;dt&gt;SQLITE_DBCONFIG_MAINDBNAME&lt;/dt&gt;
 2152 ** &lt;dd&gt; ^This option is used to change the name of the &quot;main&quot; database
 2153 ** schema.  ^The sole argument is a pointer to a constant UTF8 string
 2154 ** which will become the new schema name in place of &quot;main&quot;.  ^SQLite
 2155 ** does not make a copy of the new main schema name string, so the application
 2156 ** must ensure that the argument passed into this DBCONFIG option is unchanged
 2157 ** until after the database connection closes.
 2158 ** &lt;/dd&gt;
 2159 **
 2160 ** [[SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE]]
 2161 ** &lt;dt&gt;SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE&lt;/dt&gt;
 2162 ** &lt;dd&gt; Usually, when a database in wal mode is closed or detached from a
 2163 ** database handle, SQLite checks if this will mean that there are now no
 2164 ** connections at all to the database. If so, it performs a checkpoint
 2165 ** operation before closing the connection. This option may be used to
 2166 ** override this behaviour. The first parameter passed to this operation
 2167 ** is an integer - positive to disable checkpoints-on-close, or zero (the
 2168 ** default) to enable them, and negative to leave the setting unchanged.
 2169 ** The second parameter is a pointer to an integer
 2170 ** into which is written 0 or 1 to indicate whether checkpoints-on-close
 2171 ** have been disabled - 0 if they are not disabled, 1 if they are.
 2172 ** &lt;/dd&gt;
 2173 **
 2174 ** [[SQLITE_DBCONFIG_ENABLE_QPSG]] &lt;dt&gt;SQLITE_DBCONFIG_ENABLE_QPSG&lt;/dt&gt;
 2175 ** &lt;dd&gt;^(The SQLITE_DBCONFIG_ENABLE_QPSG option activates or deactivates
 2176 ** the [query planner stability guarantee] (QPSG).  When the QPSG is active,
 2177 ** a single SQL query statement will always use the same algorithm regardless
 2178 ** of values of [bound parameters].)^ The QPSG disables some query optimizations
 2179 ** that look at the values of bound parameters, which can make some queries
 2180 ** slower.  But the QPSG has the advantage of more predictable behavior.  With
 2181 ** the QPSG active, SQLite will always use the same query plan in the field as
 2182 ** was used during testing in the lab.
 2183 ** The first argument to this setting is an integer which is 0 to disable
 2184 ** the QPSG, positive to enable QPSG, or negative to leave the setting
 2185 ** unchanged. The second parameter is a pointer to an integer into which
 2186 ** is written 0 or 1 to indicate whether the QPSG is disabled or enabled
 2187 ** following this call.
 2188 ** &lt;/dd&gt;
 2189 **
 2190 ** [[SQLITE_DBCONFIG_TRIGGER_EQP]] &lt;dt&gt;SQLITE_DBCONFIG_TRIGGER_EQP&lt;/dt&gt;
 2191 ** &lt;dd&gt; By default, the output of EXPLAIN QUERY PLAN commands does not
 2192 ** include output for any operations performed by trigger programs. This
 2193 ** option is used to set or clear (the default) a flag that governs this
 2194 ** behavior. The first parameter passed to this operation is an integer -
 2195 ** positive to enable output for trigger programs, or zero to disable it,
 2196 ** or negative to leave the setting unchanged.
 2197 ** The second parameter is a pointer to an integer into which is written
 2198 ** 0 or 1 to indicate whether output-for-triggers has been disabled - 0 if
 2199 ** it is not disabled, 1 if it is.
 2200 ** &lt;/dd&gt;
 2201 **
 2202 ** [[SQLITE_DBCONFIG_RESET_DATABASE]] &lt;dt&gt;SQLITE_DBCONFIG_RESET_DATABASE&lt;/dt&gt;
 2203 ** &lt;dd&gt; Set the SQLITE_DBCONFIG_RESET_DATABASE flag and then run
 2204 ** [VACUUM] in order to reset a database back to an empty database
 2205 ** with no schema and no content. The following process works even for
 2206 ** a badly corrupted database file:
 2207 ** &lt;ol&gt;
 2208 ** &lt;li&gt; If the database connection is newly opened, make sure it has read the
 2209 **      database schema by preparing then discarding some query against the
 2210 **      database, or calling sqlite3_table_column_metadata(), ignoring any
 2211 **      errors.  This step is only necessary if the application desires to keep
 2212 **      the database in WAL mode after the reset if it was in WAL mode before
 2213 **      the reset.
 2214 ** &lt;li&gt; sqlite3_db_config(db, SQLITE_DBCONFIG_RESET_DATABASE, 1, 0);
 2215 ** &lt;li&gt; [sqlite3_exec](db, &quot;[VACUUM]&quot;, 0, 0, 0);
 2216 ** &lt;li&gt; sqlite3_db_config(db, SQLITE_DBCONFIG_RESET_DATABASE, 0, 0);
 2217 ** &lt;/ol&gt;
 2218 ** Because resetting a database is destructive and irreversible, the
 2219 ** process requires the use of this obscure API and multiple steps to help
 2220 ** ensure that it does not happen by accident.
 2221 **
 2222 ** [[SQLITE_DBCONFIG_DEFENSIVE]] &lt;dt&gt;SQLITE_DBCONFIG_DEFENSIVE&lt;/dt&gt;
 2223 ** &lt;dd&gt;The SQLITE_DBCONFIG_DEFENSIVE option activates or deactivates the
 2224 ** &quot;defensive&quot; flag for a database connection.  When the defensive
 2225 ** flag is enabled, language features that allow ordinary SQL to
 2226 ** deliberately corrupt the database file are disabled.  The disabled
 2227 ** features include but are not limited to the following:
 2228 ** &lt;ul&gt;
 2229 ** &lt;li&gt; The [PRAGMA writable_schema=ON] statement.
 2230 ** &lt;li&gt; The [PRAGMA journal_mode=OFF] statement.
 2231 ** &lt;li&gt; Writes to the [sqlite_dbpage] virtual table.
 2232 ** &lt;li&gt; Direct writes to [shadow tables].
 2233 ** &lt;/ul&gt;
 2234 ** &lt;/dd&gt;
 2235 **
 2236 ** [[SQLITE_DBCONFIG_WRITABLE_SCHEMA]] &lt;dt&gt;SQLITE_DBCONFIG_WRITABLE_SCHEMA&lt;/dt&gt;
 2237 ** &lt;dd&gt;The SQLITE_DBCONFIG_WRITABLE_SCHEMA option activates or deactivates the
 2238 ** &quot;writable_schema&quot; flag. This has the same effect and is logically equivalent
 2239 ** to setting [PRAGMA writable_schema=ON] or [PRAGMA writable_schema=OFF].
 2240 ** The first argument to this setting is an integer which is 0 to disable
 2241 ** the writable_schema, positive to enable writable_schema, or negative to
 2242 ** leave the setting unchanged. The second parameter is a pointer to an
 2243 ** integer into which is written 0 or 1 to indicate whether the writable_schema
 2244 ** is enabled or disabled following this call.
 2245 ** &lt;/dd&gt;
 2246 **
 2247 ** [[SQLITE_DBCONFIG_LEGACY_ALTER_TABLE]]
 2248 ** &lt;dt&gt;SQLITE_DBCONFIG_LEGACY_ALTER_TABLE&lt;/dt&gt;
 2249 ** &lt;dd&gt;The SQLITE_DBCONFIG_LEGACY_ALTER_TABLE option activates or deactivates
 2250 ** the legacy behavior of the [ALTER TABLE RENAME] command such it
 2251 ** behaves as it did prior to [version 3.24.0] (2018-06-04).  See the
 2252 ** &quot;Compatibility Notice&quot; on the [ALTER TABLE RENAME documentation] for
 2253 ** additional information. This feature can also be turned on and off
 2254 ** using the [PRAGMA legacy_alter_table] statement.
 2255 ** &lt;/dd&gt;
 2256 **
 2257 ** [[SQLITE_DBCONFIG_DQS_DML]]
 2258 ** &lt;dt&gt;SQLITE_DBCONFIG_DQS_DML&lt;/td&gt;
 2259 ** &lt;dd&gt;The SQLITE_DBCONFIG_DQS_DML option activates or deactivates
<a name="18" id="anc18"></a><span class="line-modified"> 2260 ** the legacy [double-quoted string literal] misfeature for DML statements</span>
 2261 ** only, that is DELETE, INSERT, SELECT, and UPDATE statements. The
 2262 ** default value of this setting is determined by the [-DSQLITE_DQS]
 2263 ** compile-time option.
 2264 ** &lt;/dd&gt;
 2265 **
 2266 ** [[SQLITE_DBCONFIG_DQS_DDL]]
 2267 ** &lt;dt&gt;SQLITE_DBCONFIG_DQS_DDL&lt;/td&gt;
 2268 ** &lt;dd&gt;The SQLITE_DBCONFIG_DQS option activates or deactivates
 2269 ** the legacy [double-quoted string literal] misfeature for DDL statements,
 2270 ** such as CREATE TABLE and CREATE INDEX. The
 2271 ** default value of this setting is determined by the [-DSQLITE_DQS]
 2272 ** compile-time option.
 2273 ** &lt;/dd&gt;
<a name="19" id="anc19"></a><span class="line-added"> 2274 **</span>
<span class="line-added"> 2275 ** [[SQLITE_DBCONFIG_TRUSTED_SCHEMA]]</span>
<span class="line-added"> 2276 ** &lt;dt&gt;SQLITE_DBCONFIG_TRUSTED_SCHEMA&lt;/td&gt;</span>
<span class="line-added"> 2277 ** &lt;dd&gt;The SQLITE_DBCONFIG_TRUSTED_SCHEMA option tells SQLite to</span>
<span class="line-added"> 2278 ** assume that database schemas (the contents of the [sqlite_master] tables)</span>
<span class="line-added"> 2279 ** are untainted by malicious content.</span>
<span class="line-added"> 2280 ** When the SQLITE_DBCONFIG_TRUSTED_SCHEMA option is disabled, SQLite</span>
<span class="line-added"> 2281 ** takes additional defensive steps to protect the application from harm</span>
<span class="line-added"> 2282 ** including:</span>
<span class="line-added"> 2283 ** &lt;ul&gt;</span>
<span class="line-added"> 2284 ** &lt;li&gt; Prohibit the use of SQL functions inside triggers, views,</span>
<span class="line-added"> 2285 ** CHECK constraints, DEFAULT clauses, expression indexes,</span>
<span class="line-added"> 2286 ** partial indexes, or generated columns</span>
<span class="line-added"> 2287 ** unless those functions are tagged with [SQLITE_INNOCUOUS].</span>
<span class="line-added"> 2288 ** &lt;li&gt; Prohibit the use of virtual tables inside of triggers or views</span>
<span class="line-added"> 2289 ** unless those virtual tables are tagged with [SQLITE_VTAB_INNOCUOUS].</span>
<span class="line-added"> 2290 ** &lt;/ul&gt;</span>
<span class="line-added"> 2291 ** This setting defaults to &quot;on&quot; for legacy compatibility, however</span>
<span class="line-added"> 2292 ** all applications are advised to turn it off if possible. This setting</span>
<span class="line-added"> 2293 ** can also be controlled using the [PRAGMA trusted_schema] statement.</span>
<span class="line-added"> 2294 ** &lt;/dd&gt;</span>
<span class="line-added"> 2295 **</span>
<span class="line-added"> 2296 ** [[SQLITE_DBCONFIG_LEGACY_FILE_FORMAT]]</span>
<span class="line-added"> 2297 ** &lt;dt&gt;SQLITE_DBCONFIG_LEGACY_FILE_FORMAT&lt;/td&gt;</span>
<span class="line-added"> 2298 ** &lt;dd&gt;The SQLITE_DBCONFIG_LEGACY_FILE_FORMAT option activates or deactivates</span>
<span class="line-added"> 2299 ** the legacy file format flag.  When activated, this flag causes all newly</span>
<span class="line-added"> 2300 ** created database file to have a schema format version number (the 4-byte</span>
<span class="line-added"> 2301 ** integer found at offset 44 into the database header) of 1.  This in turn</span>
<span class="line-added"> 2302 ** means that the resulting database file will be readable and writable by</span>
<span class="line-added"> 2303 ** any SQLite version back to 3.0.0 ([dateof:3.0.0]).  Without this setting,</span>
<span class="line-added"> 2304 ** newly created databases are generally not understandable by SQLite versions</span>
<span class="line-added"> 2305 ** prior to 3.3.0 ([dateof:3.3.0]).  As these words are written, there</span>
<span class="line-added"> 2306 ** is now scarcely any need to generated database files that are compatible</span>
<span class="line-added"> 2307 ** all the way back to version 3.0.0, and so this setting is of little</span>
<span class="line-added"> 2308 ** practical use, but is provided so that SQLite can continue to claim the</span>
<span class="line-added"> 2309 ** ability to generate new database files that are compatible with  version</span>
<span class="line-added"> 2310 ** 3.0.0.</span>
<span class="line-added"> 2311 ** &lt;p&gt;Note that when the SQLITE_DBCONFIG_LEGACY_FILE_FORMAT setting is on,</span>
<span class="line-added"> 2312 ** the [VACUUM] command will fail with an obscure error when attempting to</span>
<span class="line-added"> 2313 ** process a table with generated columns and a descending index.  This is</span>
<span class="line-added"> 2314 ** not considered a bug since SQLite versions 3.3.0 and earlier do not support</span>
<span class="line-added"> 2315 ** either generated columns or decending indexes.</span>
<span class="line-added"> 2316 ** &lt;/dd&gt;</span>
 2317 ** &lt;/dl&gt;
 2318 */
 2319 #define SQLITE_DBCONFIG_MAINDBNAME            1000 /* const char* */
 2320 #define SQLITE_DBCONFIG_LOOKASIDE             1001 /* void* int int */
 2321 #define SQLITE_DBCONFIG_ENABLE_FKEY           1002 /* int int* */
 2322 #define SQLITE_DBCONFIG_ENABLE_TRIGGER        1003 /* int int* */
 2323 #define SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER 1004 /* int int* */
 2324 #define SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION 1005 /* int int* */
 2325 #define SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE      1006 /* int int* */
 2326 #define SQLITE_DBCONFIG_ENABLE_QPSG           1007 /* int int* */
 2327 #define SQLITE_DBCONFIG_TRIGGER_EQP           1008 /* int int* */
 2328 #define SQLITE_DBCONFIG_RESET_DATABASE        1009 /* int int* */
 2329 #define SQLITE_DBCONFIG_DEFENSIVE             1010 /* int int* */
 2330 #define SQLITE_DBCONFIG_WRITABLE_SCHEMA       1011 /* int int* */
 2331 #define SQLITE_DBCONFIG_LEGACY_ALTER_TABLE    1012 /* int int* */
 2332 #define SQLITE_DBCONFIG_DQS_DML               1013 /* int int* */
 2333 #define SQLITE_DBCONFIG_DQS_DDL               1014 /* int int* */
 2334 #define SQLITE_DBCONFIG_ENABLE_VIEW           1015 /* int int* */
<a name="20" id="anc20"></a><span class="line-modified"> 2335 #define SQLITE_DBCONFIG_LEGACY_FILE_FORMAT    1016 /* int int* */</span>
<span class="line-added"> 2336 #define SQLITE_DBCONFIG_TRUSTED_SCHEMA        1017 /* int int* */</span>
<span class="line-added"> 2337 #define SQLITE_DBCONFIG_MAX                   1017 /* Largest DBCONFIG */</span>
 2338 
 2339 /*
 2340 ** CAPI3REF: Enable Or Disable Extended Result Codes
 2341 ** METHOD: sqlite3
 2342 **
 2343 ** ^The sqlite3_extended_result_codes() routine enables or disables the
 2344 ** [extended result codes] feature of SQLite. ^The extended result
 2345 ** codes are disabled by default for historical compatibility.
 2346 */
 2347 SQLITE_API int sqlite3_extended_result_codes(sqlite3*, int onoff);
 2348 
 2349 /*
 2350 ** CAPI3REF: Last Insert Rowid
 2351 ** METHOD: sqlite3
 2352 **
 2353 ** ^Each entry in most SQLite tables (except for [WITHOUT ROWID] tables)
 2354 ** has a unique 64-bit signed
 2355 ** integer key called the [ROWID | &quot;rowid&quot;]. ^The rowid is always available
 2356 ** as an undeclared column named ROWID, OID, or _ROWID_ as long as those
 2357 ** names are not also used by explicitly declared columns. ^If
 2358 ** the table has a column of type [INTEGER PRIMARY KEY] then that column
 2359 ** is another alias for the rowid.
 2360 **
 2361 ** ^The sqlite3_last_insert_rowid(D) interface usually returns the [rowid] of
 2362 ** the most recent successful [INSERT] into a rowid table or [virtual table]
 2363 ** on database connection D. ^Inserts into [WITHOUT ROWID] tables are not
 2364 ** recorded. ^If no successful [INSERT]s into rowid tables have ever occurred
 2365 ** on the database connection D, then sqlite3_last_insert_rowid(D) returns
 2366 ** zero.
 2367 **
 2368 ** As well as being set automatically as rows are inserted into database
 2369 ** tables, the value returned by this function may be set explicitly by
 2370 ** [sqlite3_set_last_insert_rowid()]
 2371 **
 2372 ** Some virtual table implementations may INSERT rows into rowid tables as
 2373 ** part of committing a transaction (e.g. to flush data accumulated in memory
 2374 ** to disk). In this case subsequent calls to this function return the rowid
 2375 ** associated with these internal INSERT operations, which leads to
 2376 ** unintuitive results. Virtual table implementations that do write to rowid
 2377 ** tables in this way can avoid this problem by restoring the original
 2378 ** rowid value using [sqlite3_set_last_insert_rowid()] before returning
 2379 ** control to the user.
 2380 **
 2381 ** ^(If an [INSERT] occurs within a trigger then this routine will
 2382 ** return the [rowid] of the inserted row as long as the trigger is
 2383 ** running. Once the trigger program ends, the value returned
 2384 ** by this routine reverts to what it was before the trigger was fired.)^
 2385 **
 2386 ** ^An [INSERT] that fails due to a constraint violation is not a
 2387 ** successful [INSERT] and does not change the value returned by this
 2388 ** routine.  ^Thus INSERT OR FAIL, INSERT OR IGNORE, INSERT OR ROLLBACK,
 2389 ** and INSERT OR ABORT make no changes to the return value of this
 2390 ** routine when their insertion fails.  ^(When INSERT OR REPLACE
 2391 ** encounters a constraint violation, it does not fail.  The
 2392 ** INSERT continues to completion after deleting rows that caused
 2393 ** the constraint problem so INSERT OR REPLACE will always change
 2394 ** the return value of this interface.)^
 2395 **
 2396 ** ^For the purposes of this routine, an [INSERT] is considered to
 2397 ** be successful even if it is subsequently rolled back.
 2398 **
 2399 ** This function is accessible to SQL statements via the
 2400 ** [last_insert_rowid() SQL function].
 2401 **
 2402 ** If a separate thread performs a new [INSERT] on the same
 2403 ** database connection while the [sqlite3_last_insert_rowid()]
 2404 ** function is running and thus changes the last insert [rowid],
 2405 ** then the value returned by [sqlite3_last_insert_rowid()] is
 2406 ** unpredictable and might not equal either the old or the new
 2407 ** last insert [rowid].
 2408 */
 2409 SQLITE_API sqlite3_int64 sqlite3_last_insert_rowid(sqlite3*);
 2410 
 2411 /*
 2412 ** CAPI3REF: Set the Last Insert Rowid value.
 2413 ** METHOD: sqlite3
 2414 **
 2415 ** The sqlite3_set_last_insert_rowid(D, R) method allows the application to
 2416 ** set the value returned by calling sqlite3_last_insert_rowid(D) to R
 2417 ** without inserting a row into the database.
 2418 */
 2419 SQLITE_API void sqlite3_set_last_insert_rowid(sqlite3*,sqlite3_int64);
 2420 
 2421 /*
 2422 ** CAPI3REF: Count The Number Of Rows Modified
 2423 ** METHOD: sqlite3
 2424 **
 2425 ** ^This function returns the number of rows modified, inserted or
 2426 ** deleted by the most recently completed INSERT, UPDATE or DELETE
 2427 ** statement on the database connection specified by the only parameter.
 2428 ** ^Executing any other type of SQL statement does not modify the value
 2429 ** returned by this function.
 2430 **
 2431 ** ^Only changes made directly by the INSERT, UPDATE or DELETE statement are
 2432 ** considered - auxiliary changes caused by [CREATE TRIGGER | triggers],
 2433 ** [foreign key actions] or [REPLACE] constraint resolution are not counted.
 2434 **
 2435 ** Changes to a view that are intercepted by
 2436 ** [INSTEAD OF trigger | INSTEAD OF triggers] are not counted. ^The value
 2437 ** returned by sqlite3_changes() immediately after an INSERT, UPDATE or
 2438 ** DELETE statement run on a view is always zero. Only changes made to real
 2439 ** tables are counted.
 2440 **
 2441 ** Things are more complicated if the sqlite3_changes() function is
 2442 ** executed while a trigger program is running. This may happen if the
 2443 ** program uses the [changes() SQL function], or if some other callback
 2444 ** function invokes sqlite3_changes() directly. Essentially:
 2445 **
 2446 ** &lt;ul&gt;
 2447 **   &lt;li&gt; ^(Before entering a trigger program the value returned by
 2448 **        sqlite3_changes() function is saved. After the trigger program
 2449 **        has finished, the original value is restored.)^
 2450 **
 2451 **   &lt;li&gt; ^(Within a trigger program each INSERT, UPDATE and DELETE
 2452 **        statement sets the value returned by sqlite3_changes()
 2453 **        upon completion as normal. Of course, this value will not include
 2454 **        any changes performed by sub-triggers, as the sqlite3_changes()
 2455 **        value will be saved and restored after each sub-trigger has run.)^
 2456 ** &lt;/ul&gt;
 2457 **
 2458 ** ^This means that if the changes() SQL function (or similar) is used
 2459 ** by the first INSERT, UPDATE or DELETE statement within a trigger, it
 2460 ** returns the value as set when the calling statement began executing.
 2461 ** ^If it is used by the second or subsequent such statement within a trigger
 2462 ** program, the value returned reflects the number of rows modified by the
 2463 ** previous INSERT, UPDATE or DELETE statement within the same trigger.
 2464 **
 2465 ** If a separate thread makes changes on the same database connection
 2466 ** while [sqlite3_changes()] is running then the value returned
 2467 ** is unpredictable and not meaningful.
 2468 **
 2469 ** See also:
 2470 ** &lt;ul&gt;
 2471 ** &lt;li&gt; the [sqlite3_total_changes()] interface
 2472 ** &lt;li&gt; the [count_changes pragma]
 2473 ** &lt;li&gt; the [changes() SQL function]
 2474 ** &lt;li&gt; the [data_version pragma]
 2475 ** &lt;/ul&gt;
 2476 */
 2477 SQLITE_API int sqlite3_changes(sqlite3*);
 2478 
 2479 /*
 2480 ** CAPI3REF: Total Number Of Rows Modified
 2481 ** METHOD: sqlite3
 2482 **
 2483 ** ^This function returns the total number of rows inserted, modified or
 2484 ** deleted by all [INSERT], [UPDATE] or [DELETE] statements completed
 2485 ** since the database connection was opened, including those executed as
 2486 ** part of trigger programs. ^Executing any other type of SQL statement
 2487 ** does not affect the value returned by sqlite3_total_changes().
 2488 **
 2489 ** ^Changes made as part of [foreign key actions] are included in the
 2490 ** count, but those made as part of REPLACE constraint resolution are
 2491 ** not. ^Changes to a view that are intercepted by INSTEAD OF triggers
 2492 ** are not counted.
 2493 **
 2494 ** The [sqlite3_total_changes(D)] interface only reports the number
 2495 ** of rows that changed due to SQL statement run against database
 2496 ** connection D.  Any changes by other database connections are ignored.
 2497 ** To detect changes against a database file from other database
 2498 ** connections use the [PRAGMA data_version] command or the
 2499 ** [SQLITE_FCNTL_DATA_VERSION] [file control].
 2500 **
 2501 ** If a separate thread makes changes on the same database connection
 2502 ** while [sqlite3_total_changes()] is running then the value
 2503 ** returned is unpredictable and not meaningful.
 2504 **
 2505 ** See also:
 2506 ** &lt;ul&gt;
 2507 ** &lt;li&gt; the [sqlite3_changes()] interface
 2508 ** &lt;li&gt; the [count_changes pragma]
 2509 ** &lt;li&gt; the [changes() SQL function]
 2510 ** &lt;li&gt; the [data_version pragma]
 2511 ** &lt;li&gt; the [SQLITE_FCNTL_DATA_VERSION] [file control]
 2512 ** &lt;/ul&gt;
 2513 */
 2514 SQLITE_API int sqlite3_total_changes(sqlite3*);
 2515 
 2516 /*
 2517 ** CAPI3REF: Interrupt A Long-Running Query
 2518 ** METHOD: sqlite3
 2519 **
 2520 ** ^This function causes any pending database operation to abort and
 2521 ** return at its earliest opportunity. This routine is typically
 2522 ** called in response to a user action such as pressing &quot;Cancel&quot;
 2523 ** or Ctrl-C where the user wants a long query operation to halt
 2524 ** immediately.
 2525 **
 2526 ** ^It is safe to call this routine from a thread different from the
 2527 ** thread that is currently running the database operation.  But it
 2528 ** is not safe to call this routine with a [database connection] that
 2529 ** is closed or might close before sqlite3_interrupt() returns.
 2530 **
 2531 ** ^If an SQL operation is very nearly finished at the time when
 2532 ** sqlite3_interrupt() is called, then it might not have an opportunity
 2533 ** to be interrupted and might continue to completion.
 2534 **
 2535 ** ^An SQL operation that is interrupted will return [SQLITE_INTERRUPT].
 2536 ** ^If the interrupted SQL operation is an INSERT, UPDATE, or DELETE
 2537 ** that is inside an explicit transaction, then the entire transaction
 2538 ** will be rolled back automatically.
 2539 **
 2540 ** ^The sqlite3_interrupt(D) call is in effect until all currently running
 2541 ** SQL statements on [database connection] D complete.  ^Any new SQL statements
 2542 ** that are started after the sqlite3_interrupt() call and before the
<a name="21" id="anc21"></a><span class="line-modified"> 2543 ** running statement count reaches zero are interrupted as if they had been</span>
 2544 ** running prior to the sqlite3_interrupt() call.  ^New SQL statements
 2545 ** that are started after the running statement count reaches zero are
 2546 ** not effected by the sqlite3_interrupt().
 2547 ** ^A call to sqlite3_interrupt(D) that occurs when there are no running
 2548 ** SQL statements is a no-op and has no effect on SQL statements
 2549 ** that are started after the sqlite3_interrupt() call returns.
 2550 */
 2551 SQLITE_API void sqlite3_interrupt(sqlite3*);
 2552 
 2553 /*
 2554 ** CAPI3REF: Determine If An SQL Statement Is Complete
 2555 **
 2556 ** These routines are useful during command-line input to determine if the
 2557 ** currently entered text seems to form a complete SQL statement or
 2558 ** if additional input is needed before sending the text into
 2559 ** SQLite for parsing.  ^These routines return 1 if the input string
 2560 ** appears to be a complete SQL statement.  ^A statement is judged to be
 2561 ** complete if it ends with a semicolon token and is not a prefix of a
 2562 ** well-formed CREATE TRIGGER statement.  ^Semicolons that are embedded within
 2563 ** string literals or quoted identifier names or comments are not
 2564 ** independent tokens (they are part of the token in which they are
 2565 ** embedded) and thus do not count as a statement terminator.  ^Whitespace
 2566 ** and comments that follow the final semicolon are ignored.
 2567 **
 2568 ** ^These routines return 0 if the statement is incomplete.  ^If a
 2569 ** memory allocation fails, then SQLITE_NOMEM is returned.
 2570 **
 2571 ** ^These routines do not parse the SQL statements thus
 2572 ** will not detect syntactically incorrect SQL.
 2573 **
 2574 ** ^(If SQLite has not been initialized using [sqlite3_initialize()] prior
 2575 ** to invoking sqlite3_complete16() then sqlite3_initialize() is invoked
 2576 ** automatically by sqlite3_complete16().  If that initialization fails,
 2577 ** then the return value from sqlite3_complete16() will be non-zero
 2578 ** regardless of whether or not the input SQL is complete.)^
 2579 **
 2580 ** The input to [sqlite3_complete()] must be a zero-terminated
 2581 ** UTF-8 string.
 2582 **
 2583 ** The input to [sqlite3_complete16()] must be a zero-terminated
 2584 ** UTF-16 string in native byte order.
 2585 */
 2586 SQLITE_API int sqlite3_complete(const char *sql);
 2587 SQLITE_API int sqlite3_complete16(const void *sql);
 2588 
 2589 /*
 2590 ** CAPI3REF: Register A Callback To Handle SQLITE_BUSY Errors
 2591 ** KEYWORDS: {busy-handler callback} {busy handler}
 2592 ** METHOD: sqlite3
 2593 **
 2594 ** ^The sqlite3_busy_handler(D,X,P) routine sets a callback function X
 2595 ** that might be invoked with argument P whenever
 2596 ** an attempt is made to access a database table associated with
 2597 ** [database connection] D when another thread
 2598 ** or process has the table locked.
 2599 ** The sqlite3_busy_handler() interface is used to implement
 2600 ** [sqlite3_busy_timeout()] and [PRAGMA busy_timeout].
 2601 **
 2602 ** ^If the busy callback is NULL, then [SQLITE_BUSY]
 2603 ** is returned immediately upon encountering the lock.  ^If the busy callback
 2604 ** is not NULL, then the callback might be invoked with two arguments.
 2605 **
 2606 ** ^The first argument to the busy handler is a copy of the void* pointer which
 2607 ** is the third argument to sqlite3_busy_handler().  ^The second argument to
 2608 ** the busy handler callback is the number of times that the busy handler has
 2609 ** been invoked previously for the same locking event.  ^If the
 2610 ** busy callback returns 0, then no additional attempts are made to
 2611 ** access the database and [SQLITE_BUSY] is returned
 2612 ** to the application.
 2613 ** ^If the callback returns non-zero, then another attempt
 2614 ** is made to access the database and the cycle repeats.
 2615 **
 2616 ** The presence of a busy handler does not guarantee that it will be invoked
 2617 ** when there is lock contention. ^If SQLite determines that invoking the busy
 2618 ** handler could result in a deadlock, it will go ahead and return [SQLITE_BUSY]
 2619 ** to the application instead of invoking the
 2620 ** busy handler.
 2621 ** Consider a scenario where one process is holding a read lock that
 2622 ** it is trying to promote to a reserved lock and
 2623 ** a second process is holding a reserved lock that it is trying
 2624 ** to promote to an exclusive lock.  The first process cannot proceed
 2625 ** because it is blocked by the second and the second process cannot
 2626 ** proceed because it is blocked by the first.  If both processes
 2627 ** invoke the busy handlers, neither will make any progress.  Therefore,
 2628 ** SQLite returns [SQLITE_BUSY] for the first process, hoping that this
 2629 ** will induce the first process to release its read lock and allow
 2630 ** the second process to proceed.
 2631 **
 2632 ** ^The default busy callback is NULL.
 2633 **
 2634 ** ^(There can only be a single busy handler defined for each
 2635 ** [database connection].  Setting a new busy handler clears any
 2636 ** previously set handler.)^  ^Note that calling [sqlite3_busy_timeout()]
 2637 ** or evaluating [PRAGMA busy_timeout=N] will change the
 2638 ** busy handler and thus clear any previously set busy handler.
 2639 **
 2640 ** The busy callback should not take any actions which modify the
 2641 ** database connection that invoked the busy handler.  In other words,
 2642 ** the busy handler is not reentrant.  Any such actions
 2643 ** result in undefined behavior.
 2644 **
 2645 ** A busy handler must not close the database connection
 2646 ** or [prepared statement] that invoked the busy handler.
 2647 */
 2648 SQLITE_API int sqlite3_busy_handler(sqlite3*,int(*)(void*,int),void*);
 2649 
 2650 /*
 2651 ** CAPI3REF: Set A Busy Timeout
 2652 ** METHOD: sqlite3
 2653 **
 2654 ** ^This routine sets a [sqlite3_busy_handler | busy handler] that sleeps
 2655 ** for a specified amount of time when a table is locked.  ^The handler
 2656 ** will sleep multiple times until at least &quot;ms&quot; milliseconds of sleeping
 2657 ** have accumulated.  ^After at least &quot;ms&quot; milliseconds of sleeping,
 2658 ** the handler returns 0 which causes [sqlite3_step()] to return
 2659 ** [SQLITE_BUSY].
 2660 **
 2661 ** ^Calling this routine with an argument less than or equal to zero
 2662 ** turns off all busy handlers.
 2663 **
 2664 ** ^(There can only be a single busy handler for a particular
 2665 ** [database connection] at any given moment.  If another busy handler
 2666 ** was defined  (using [sqlite3_busy_handler()]) prior to calling
 2667 ** this routine, that other busy handler is cleared.)^
 2668 **
 2669 ** See also:  [PRAGMA busy_timeout]
 2670 */
 2671 SQLITE_API int sqlite3_busy_timeout(sqlite3*, int ms);
 2672 
 2673 /*
 2674 ** CAPI3REF: Convenience Routines For Running Queries
 2675 ** METHOD: sqlite3
 2676 **
 2677 ** This is a legacy interface that is preserved for backwards compatibility.
 2678 ** Use of this interface is not recommended.
 2679 **
 2680 ** Definition: A &lt;b&gt;result table&lt;/b&gt; is memory data structure created by the
 2681 ** [sqlite3_get_table()] interface.  A result table records the
 2682 ** complete query results from one or more queries.
 2683 **
 2684 ** The table conceptually has a number of rows and columns.  But
 2685 ** these numbers are not part of the result table itself.  These
 2686 ** numbers are obtained separately.  Let N be the number of rows
 2687 ** and M be the number of columns.
 2688 **
 2689 ** A result table is an array of pointers to zero-terminated UTF-8 strings.
 2690 ** There are (N+1)*M elements in the array.  The first M pointers point
 2691 ** to zero-terminated strings that  contain the names of the columns.
 2692 ** The remaining entries all point to query results.  NULL values result
 2693 ** in NULL pointers.  All other values are in their UTF-8 zero-terminated
 2694 ** string representation as returned by [sqlite3_column_text()].
 2695 **
 2696 ** A result table might consist of one or more memory allocations.
 2697 ** It is not safe to pass a result table directly to [sqlite3_free()].
 2698 ** A result table should be deallocated using [sqlite3_free_table()].
 2699 **
 2700 ** ^(As an example of the result table format, suppose a query result
 2701 ** is as follows:
 2702 **
 2703 ** &lt;blockquote&gt;&lt;pre&gt;
 2704 **        Name        | Age
 2705 **        -----------------------
 2706 **        Alice       | 43
 2707 **        Bob         | 28
 2708 **        Cindy       | 21
 2709 ** &lt;/pre&gt;&lt;/blockquote&gt;
 2710 **
<a name="22" id="anc22"></a><span class="line-modified"> 2711 ** There are two columns (M==2) and three rows (N==3).  Thus the</span>
 2712 ** result table has 8 entries.  Suppose the result table is stored
<a name="23" id="anc23"></a><span class="line-modified"> 2713 ** in an array named azResult.  Then azResult holds this content:</span>
 2714 **
 2715 ** &lt;blockquote&gt;&lt;pre&gt;
 2716 **        azResult&amp;#91;0] = &quot;Name&quot;;
 2717 **        azResult&amp;#91;1] = &quot;Age&quot;;
 2718 **        azResult&amp;#91;2] = &quot;Alice&quot;;
 2719 **        azResult&amp;#91;3] = &quot;43&quot;;
 2720 **        azResult&amp;#91;4] = &quot;Bob&quot;;
 2721 **        azResult&amp;#91;5] = &quot;28&quot;;
 2722 **        azResult&amp;#91;6] = &quot;Cindy&quot;;
 2723 **        azResult&amp;#91;7] = &quot;21&quot;;
 2724 ** &lt;/pre&gt;&lt;/blockquote&gt;)^
 2725 **
 2726 ** ^The sqlite3_get_table() function evaluates one or more
 2727 ** semicolon-separated SQL statements in the zero-terminated UTF-8
 2728 ** string of its 2nd parameter and returns a result table to the
 2729 ** pointer given in its 3rd parameter.
 2730 **
 2731 ** After the application has finished with the result from sqlite3_get_table(),
 2732 ** it must pass the result table pointer to sqlite3_free_table() in order to
 2733 ** release the memory that was malloced.  Because of the way the
 2734 ** [sqlite3_malloc()] happens within sqlite3_get_table(), the calling
 2735 ** function must not try to call [sqlite3_free()] directly.  Only
 2736 ** [sqlite3_free_table()] is able to release the memory properly and safely.
 2737 **
 2738 ** The sqlite3_get_table() interface is implemented as a wrapper around
 2739 ** [sqlite3_exec()].  The sqlite3_get_table() routine does not have access
 2740 ** to any internal data structures of SQLite.  It uses only the public
 2741 ** interface defined here.  As a consequence, errors that occur in the
 2742 ** wrapper layer outside of the internal [sqlite3_exec()] call are not
 2743 ** reflected in subsequent calls to [sqlite3_errcode()] or
 2744 ** [sqlite3_errmsg()].
 2745 */
 2746 SQLITE_API int sqlite3_get_table(
 2747   sqlite3 *db,          /* An open database */
 2748   const char *zSql,     /* SQL to be evaluated */
 2749   char ***pazResult,    /* Results of the query */
 2750   int *pnRow,           /* Number of result rows written here */
 2751   int *pnColumn,        /* Number of result columns written here */
 2752   char **pzErrmsg       /* Error msg written here */
 2753 );
 2754 SQLITE_API void sqlite3_free_table(char **result);
 2755 
 2756 /*
 2757 ** CAPI3REF: Formatted String Printing Functions
 2758 **
 2759 ** These routines are work-alikes of the &quot;printf()&quot; family of functions
 2760 ** from the standard C library.
 2761 ** These routines understand most of the common formatting options from
 2762 ** the standard library printf()
 2763 ** plus some additional non-standard formats ([%q], [%Q], [%w], and [%z]).
 2764 ** See the [built-in printf()] documentation for details.
 2765 **
 2766 ** ^The sqlite3_mprintf() and sqlite3_vmprintf() routines write their
 2767 ** results into memory obtained from [sqlite3_malloc64()].
 2768 ** The strings returned by these two routines should be
 2769 ** released by [sqlite3_free()].  ^Both routines return a
 2770 ** NULL pointer if [sqlite3_malloc64()] is unable to allocate enough
 2771 ** memory to hold the resulting string.
 2772 **
 2773 ** ^(The sqlite3_snprintf() routine is similar to &quot;snprintf()&quot; from
 2774 ** the standard C library.  The result is written into the
 2775 ** buffer supplied as the second parameter whose size is given by
 2776 ** the first parameter. Note that the order of the
 2777 ** first two parameters is reversed from snprintf().)^  This is an
 2778 ** historical accident that cannot be fixed without breaking
 2779 ** backwards compatibility.  ^(Note also that sqlite3_snprintf()
 2780 ** returns a pointer to its buffer instead of the number of
 2781 ** characters actually written into the buffer.)^  We admit that
 2782 ** the number of characters written would be a more useful return
 2783 ** value but we cannot change the implementation of sqlite3_snprintf()
 2784 ** now without breaking compatibility.
 2785 **
 2786 ** ^As long as the buffer size is greater than zero, sqlite3_snprintf()
 2787 ** guarantees that the buffer is always zero-terminated.  ^The first
 2788 ** parameter &quot;n&quot; is the total size of the buffer, including space for
 2789 ** the zero terminator.  So the longest string that can be completely
 2790 ** written will be n-1 characters.
 2791 **
 2792 ** ^The sqlite3_vsnprintf() routine is a varargs version of sqlite3_snprintf().
 2793 **
 2794 ** See also:  [built-in printf()], [printf() SQL function]
 2795 */
 2796 SQLITE_API char *sqlite3_mprintf(const char*,...);
 2797 SQLITE_API char *sqlite3_vmprintf(const char*, va_list);
 2798 SQLITE_API char *sqlite3_snprintf(int,char*,const char*, ...);
 2799 SQLITE_API char *sqlite3_vsnprintf(int,char*,const char*, va_list);
 2800 
 2801 /*
 2802 ** CAPI3REF: Memory Allocation Subsystem
 2803 **
 2804 ** The SQLite core uses these three routines for all of its own
 2805 ** internal memory allocation needs. &quot;Core&quot; in the previous sentence
<a name="24" id="anc24"></a><span class="line-modified"> 2806 ** does not include operating-system specific [VFS] implementation.  The</span>
 2807 ** Windows VFS uses native malloc() and free() for some operations.
 2808 **
 2809 ** ^The sqlite3_malloc() routine returns a pointer to a block
 2810 ** of memory at least N bytes in length, where N is the parameter.
 2811 ** ^If sqlite3_malloc() is unable to obtain sufficient free
 2812 ** memory, it returns a NULL pointer.  ^If the parameter N to
 2813 ** sqlite3_malloc() is zero or negative then sqlite3_malloc() returns
 2814 ** a NULL pointer.
 2815 **
 2816 ** ^The sqlite3_malloc64(N) routine works just like
 2817 ** sqlite3_malloc(N) except that N is an unsigned 64-bit integer instead
 2818 ** of a signed 32-bit integer.
 2819 **
 2820 ** ^Calling sqlite3_free() with a pointer previously returned
 2821 ** by sqlite3_malloc() or sqlite3_realloc() releases that memory so
 2822 ** that it might be reused.  ^The sqlite3_free() routine is
 2823 ** a no-op if is called with a NULL pointer.  Passing a NULL pointer
 2824 ** to sqlite3_free() is harmless.  After being freed, memory
 2825 ** should neither be read nor written.  Even reading previously freed
 2826 ** memory might result in a segmentation fault or other severe error.
 2827 ** Memory corruption, a segmentation fault, or other severe error
 2828 ** might result if sqlite3_free() is called with a non-NULL pointer that
 2829 ** was not obtained from sqlite3_malloc() or sqlite3_realloc().
 2830 **
 2831 ** ^The sqlite3_realloc(X,N) interface attempts to resize a
 2832 ** prior memory allocation X to be at least N bytes.
 2833 ** ^If the X parameter to sqlite3_realloc(X,N)
 2834 ** is a NULL pointer then its behavior is identical to calling
 2835 ** sqlite3_malloc(N).
 2836 ** ^If the N parameter to sqlite3_realloc(X,N) is zero or
 2837 ** negative then the behavior is exactly the same as calling
 2838 ** sqlite3_free(X).
 2839 ** ^sqlite3_realloc(X,N) returns a pointer to a memory allocation
 2840 ** of at least N bytes in size or NULL if insufficient memory is available.
 2841 ** ^If M is the size of the prior allocation, then min(N,M) bytes
 2842 ** of the prior allocation are copied into the beginning of buffer returned
 2843 ** by sqlite3_realloc(X,N) and the prior allocation is freed.
 2844 ** ^If sqlite3_realloc(X,N) returns NULL and N is positive, then the
 2845 ** prior allocation is not freed.
 2846 **
 2847 ** ^The sqlite3_realloc64(X,N) interfaces works the same as
 2848 ** sqlite3_realloc(X,N) except that N is a 64-bit unsigned integer instead
 2849 ** of a 32-bit signed integer.
 2850 **
 2851 ** ^If X is a memory allocation previously obtained from sqlite3_malloc(),
 2852 ** sqlite3_malloc64(), sqlite3_realloc(), or sqlite3_realloc64(), then
 2853 ** sqlite3_msize(X) returns the size of that memory allocation in bytes.
 2854 ** ^The value returned by sqlite3_msize(X) might be larger than the number
 2855 ** of bytes requested when X was allocated.  ^If X is a NULL pointer then
 2856 ** sqlite3_msize(X) returns zero.  If X points to something that is not
 2857 ** the beginning of memory allocation, or if it points to a formerly
 2858 ** valid memory allocation that has now been freed, then the behavior
 2859 ** of sqlite3_msize(X) is undefined and possibly harmful.
 2860 **
 2861 ** ^The memory returned by sqlite3_malloc(), sqlite3_realloc(),
 2862 ** sqlite3_malloc64(), and sqlite3_realloc64()
 2863 ** is always aligned to at least an 8 byte boundary, or to a
 2864 ** 4 byte boundary if the [SQLITE_4_BYTE_ALIGNED_MALLOC] compile-time
 2865 ** option is used.
 2866 **
<a name="25" id="anc25"></a>












 2867 ** The pointer arguments to [sqlite3_free()] and [sqlite3_realloc()]
 2868 ** must be either NULL or else pointers obtained from a prior
 2869 ** invocation of [sqlite3_malloc()] or [sqlite3_realloc()] that have
 2870 ** not yet been released.
 2871 **
 2872 ** The application must not read or write any part of
 2873 ** a block of memory after it has been released using
 2874 ** [sqlite3_free()] or [sqlite3_realloc()].
 2875 */
 2876 SQLITE_API void *sqlite3_malloc(int);
 2877 SQLITE_API void *sqlite3_malloc64(sqlite3_uint64);
 2878 SQLITE_API void *sqlite3_realloc(void*, int);
 2879 SQLITE_API void *sqlite3_realloc64(void*, sqlite3_uint64);
 2880 SQLITE_API void sqlite3_free(void*);
 2881 SQLITE_API sqlite3_uint64 sqlite3_msize(void*);
 2882 
 2883 /*
 2884 ** CAPI3REF: Memory Allocator Statistics
 2885 **
 2886 ** SQLite provides these two interfaces for reporting on the status
 2887 ** of the [sqlite3_malloc()], [sqlite3_free()], and [sqlite3_realloc()]
 2888 ** routines, which form the built-in memory allocation subsystem.
 2889 **
 2890 ** ^The [sqlite3_memory_used()] routine returns the number of bytes
 2891 ** of memory currently outstanding (malloced but not freed).
 2892 ** ^The [sqlite3_memory_highwater()] routine returns the maximum
 2893 ** value of [sqlite3_memory_used()] since the high-water mark
 2894 ** was last reset.  ^The values returned by [sqlite3_memory_used()] and
 2895 ** [sqlite3_memory_highwater()] include any overhead
 2896 ** added by SQLite in its implementation of [sqlite3_malloc()],
 2897 ** but not overhead added by the any underlying system library
 2898 ** routines that [sqlite3_malloc()] may call.
 2899 **
 2900 ** ^The memory high-water mark is reset to the current value of
 2901 ** [sqlite3_memory_used()] if and only if the parameter to
 2902 ** [sqlite3_memory_highwater()] is true.  ^The value returned
 2903 ** by [sqlite3_memory_highwater(1)] is the high-water mark
 2904 ** prior to the reset.
 2905 */
 2906 SQLITE_API sqlite3_int64 sqlite3_memory_used(void);
 2907 SQLITE_API sqlite3_int64 sqlite3_memory_highwater(int resetFlag);
 2908 
 2909 /*
 2910 ** CAPI3REF: Pseudo-Random Number Generator
 2911 **
 2912 ** SQLite contains a high-quality pseudo-random number generator (PRNG) used to
 2913 ** select random [ROWID | ROWIDs] when inserting new records into a table that
 2914 ** already uses the largest possible [ROWID].  The PRNG is also used for
<a name="26" id="anc26"></a><span class="line-modified"> 2915 ** the built-in random() and randomblob() SQL functions.  This interface allows</span>
 2916 ** applications to access the same PRNG for other purposes.
 2917 **
 2918 ** ^A call to this routine stores N bytes of randomness into buffer P.
 2919 ** ^The P parameter can be a NULL pointer.
 2920 **
 2921 ** ^If this routine has not been previously called or if the previous
 2922 ** call had N less than one or a NULL pointer for P, then the PRNG is
 2923 ** seeded using randomness obtained from the xRandomness method of
 2924 ** the default [sqlite3_vfs] object.
 2925 ** ^If the previous call to this routine had an N of 1 or more and a
 2926 ** non-NULL P then the pseudo-randomness is generated
 2927 ** internally and without recourse to the [sqlite3_vfs] xRandomness
 2928 ** method.
 2929 */
 2930 SQLITE_API void sqlite3_randomness(int N, void *P);
 2931 
 2932 /*
 2933 ** CAPI3REF: Compile-Time Authorization Callbacks
 2934 ** METHOD: sqlite3
 2935 ** KEYWORDS: {authorizer callback}
 2936 **
 2937 ** ^This routine registers an authorizer callback with a particular
 2938 ** [database connection], supplied in the first argument.
 2939 ** ^The authorizer callback is invoked as SQL statements are being compiled
 2940 ** by [sqlite3_prepare()] or its variants [sqlite3_prepare_v2()],
 2941 ** [sqlite3_prepare_v3()], [sqlite3_prepare16()], [sqlite3_prepare16_v2()],
 2942 ** and [sqlite3_prepare16_v3()].  ^At various
 2943 ** points during the compilation process, as logic is being created
 2944 ** to perform various actions, the authorizer callback is invoked to
 2945 ** see if those actions are allowed.  ^The authorizer callback should
 2946 ** return [SQLITE_OK] to allow the action, [SQLITE_IGNORE] to disallow the
 2947 ** specific action but allow the SQL statement to continue to be
 2948 ** compiled, or [SQLITE_DENY] to cause the entire SQL statement to be
 2949 ** rejected with an error.  ^If the authorizer callback returns
 2950 ** any value other than [SQLITE_IGNORE], [SQLITE_OK], or [SQLITE_DENY]
 2951 ** then the [sqlite3_prepare_v2()] or equivalent call that triggered
 2952 ** the authorizer will fail with an error message.
 2953 **
 2954 ** When the callback returns [SQLITE_OK], that means the operation
 2955 ** requested is ok.  ^When the callback returns [SQLITE_DENY], the
 2956 ** [sqlite3_prepare_v2()] or equivalent call that triggered the
 2957 ** authorizer will fail with an error message explaining that
 2958 ** access is denied.
 2959 **
 2960 ** ^The first parameter to the authorizer callback is a copy of the third
 2961 ** parameter to the sqlite3_set_authorizer() interface. ^The second parameter
 2962 ** to the callback is an integer [SQLITE_COPY | action code] that specifies
 2963 ** the particular action to be authorized. ^The third through sixth parameters
 2964 ** to the callback are either NULL pointers or zero-terminated strings
 2965 ** that contain additional details about the action to be authorized.
 2966 ** Applications must always be prepared to encounter a NULL pointer in any
 2967 ** of the third through the sixth parameters of the authorization callback.
 2968 **
 2969 ** ^If the action code is [SQLITE_READ]
 2970 ** and the callback returns [SQLITE_IGNORE] then the
 2971 ** [prepared statement] statement is constructed to substitute
 2972 ** a NULL value in place of the table column that would have
 2973 ** been read if [SQLITE_OK] had been returned.  The [SQLITE_IGNORE]
 2974 ** return can be used to deny an untrusted user access to individual
 2975 ** columns of a table.
 2976 ** ^When a table is referenced by a [SELECT] but no column values are
 2977 ** extracted from that table (for example in a query like
 2978 ** &quot;SELECT count(*) FROM tab&quot;) then the [SQLITE_READ] authorizer callback
 2979 ** is invoked once for that table with a column name that is an empty string.
 2980 ** ^If the action code is [SQLITE_DELETE] and the callback returns
 2981 ** [SQLITE_IGNORE] then the [DELETE] operation proceeds but the
 2982 ** [truncate optimization] is disabled and all rows are deleted individually.
 2983 **
 2984 ** An authorizer is used when [sqlite3_prepare | preparing]
 2985 ** SQL statements from an untrusted source, to ensure that the SQL statements
 2986 ** do not try to access data they are not allowed to see, or that they do not
 2987 ** try to execute malicious statements that damage the database.  For
 2988 ** example, an application may allow a user to enter arbitrary
 2989 ** SQL queries for evaluation by a database.  But the application does
 2990 ** not want the user to be able to make arbitrary changes to the
 2991 ** database.  An authorizer could then be put in place while the
 2992 ** user-entered SQL is being [sqlite3_prepare | prepared] that
 2993 ** disallows everything except [SELECT] statements.
 2994 **
 2995 ** Applications that need to process SQL from untrusted sources
 2996 ** might also consider lowering resource limits using [sqlite3_limit()]
 2997 ** and limiting database size using the [max_page_count] [PRAGMA]
 2998 ** in addition to using an authorizer.
 2999 **
 3000 ** ^(Only a single authorizer can be in place on a database connection
 3001 ** at a time.  Each call to sqlite3_set_authorizer overrides the
 3002 ** previous call.)^  ^Disable the authorizer by installing a NULL callback.
 3003 ** The authorizer is disabled by default.
 3004 **
 3005 ** The authorizer callback must not do anything that will modify
 3006 ** the database connection that invoked the authorizer callback.
 3007 ** Note that [sqlite3_prepare_v2()] and [sqlite3_step()] both modify their
 3008 ** database connections for the meaning of &quot;modify&quot; in this paragraph.
 3009 **
 3010 ** ^When [sqlite3_prepare_v2()] is used to prepare a statement, the
 3011 ** statement might be re-prepared during [sqlite3_step()] due to a
 3012 ** schema change.  Hence, the application should ensure that the
 3013 ** correct authorizer callback remains in place during the [sqlite3_step()].
 3014 **
 3015 ** ^Note that the authorizer callback is invoked only during
 3016 ** [sqlite3_prepare()] or its variants.  Authorization is not
 3017 ** performed during statement evaluation in [sqlite3_step()], unless
 3018 ** as stated in the previous paragraph, sqlite3_step() invokes
 3019 ** sqlite3_prepare_v2() to reprepare a statement after a schema change.
 3020 */
 3021 SQLITE_API int sqlite3_set_authorizer(
 3022   sqlite3*,
 3023   int (*xAuth)(void*,int,const char*,const char*,const char*,const char*),
 3024   void *pUserData
 3025 );
 3026 
 3027 /*
 3028 ** CAPI3REF: Authorizer Return Codes
 3029 **
 3030 ** The [sqlite3_set_authorizer | authorizer callback function] must
 3031 ** return either [SQLITE_OK] or one of these two constants in order
 3032 ** to signal SQLite whether or not the action is permitted.  See the
 3033 ** [sqlite3_set_authorizer | authorizer documentation] for additional
 3034 ** information.
 3035 **
 3036 ** Note that SQLITE_IGNORE is also used as a [conflict resolution mode]
 3037 ** returned from the [sqlite3_vtab_on_conflict()] interface.
 3038 */
 3039 #define SQLITE_DENY   1   /* Abort the SQL statement with an error */
 3040 #define SQLITE_IGNORE 2   /* Don&#39;t allow access, but don&#39;t generate an error */
 3041 
 3042 /*
 3043 ** CAPI3REF: Authorizer Action Codes
 3044 **
 3045 ** The [sqlite3_set_authorizer()] interface registers a callback function
 3046 ** that is invoked to authorize certain SQL statement actions.  The
 3047 ** second parameter to the callback is an integer code that specifies
 3048 ** what action is being authorized.  These are the integer action codes that
 3049 ** the authorizer callback may be passed.
 3050 **
 3051 ** These action code values signify what kind of operation is to be
 3052 ** authorized.  The 3rd and 4th parameters to the authorization
 3053 ** callback function will be parameters or NULL depending on which of these
 3054 ** codes is used as the second parameter.  ^(The 5th parameter to the
 3055 ** authorizer callback is the name of the database (&quot;main&quot;, &quot;temp&quot;,
 3056 ** etc.) if applicable.)^  ^The 6th parameter to the authorizer callback
 3057 ** is the name of the inner-most trigger or view that is responsible for
 3058 ** the access attempt or NULL if this access attempt is directly from
 3059 ** top-level SQL code.
 3060 */
 3061 /******************************************* 3rd ************ 4th ***********/
 3062 #define SQLITE_CREATE_INDEX          1   /* Index Name      Table Name      */
 3063 #define SQLITE_CREATE_TABLE          2   /* Table Name      NULL            */
 3064 #define SQLITE_CREATE_TEMP_INDEX     3   /* Index Name      Table Name      */
 3065 #define SQLITE_CREATE_TEMP_TABLE     4   /* Table Name      NULL            */
 3066 #define SQLITE_CREATE_TEMP_TRIGGER   5   /* Trigger Name    Table Name      */
 3067 #define SQLITE_CREATE_TEMP_VIEW      6   /* View Name       NULL            */
 3068 #define SQLITE_CREATE_TRIGGER        7   /* Trigger Name    Table Name      */
 3069 #define SQLITE_CREATE_VIEW           8   /* View Name       NULL            */
 3070 #define SQLITE_DELETE                9   /* Table Name      NULL            */
 3071 #define SQLITE_DROP_INDEX           10   /* Index Name      Table Name      */
 3072 #define SQLITE_DROP_TABLE           11   /* Table Name      NULL            */
 3073 #define SQLITE_DROP_TEMP_INDEX      12   /* Index Name      Table Name      */
 3074 #define SQLITE_DROP_TEMP_TABLE      13   /* Table Name      NULL            */
 3075 #define SQLITE_DROP_TEMP_TRIGGER    14   /* Trigger Name    Table Name      */
 3076 #define SQLITE_DROP_TEMP_VIEW       15   /* View Name       NULL            */
 3077 #define SQLITE_DROP_TRIGGER         16   /* Trigger Name    Table Name      */
 3078 #define SQLITE_DROP_VIEW            17   /* View Name       NULL            */
 3079 #define SQLITE_INSERT               18   /* Table Name      NULL            */
 3080 #define SQLITE_PRAGMA               19   /* Pragma Name     1st arg or NULL */
 3081 #define SQLITE_READ                 20   /* Table Name      Column Name     */
 3082 #define SQLITE_SELECT               21   /* NULL            NULL            */
 3083 #define SQLITE_TRANSACTION          22   /* Operation       NULL            */
 3084 #define SQLITE_UPDATE               23   /* Table Name      Column Name     */
 3085 #define SQLITE_ATTACH               24   /* Filename        NULL            */
 3086 #define SQLITE_DETACH               25   /* Database Name   NULL            */
 3087 #define SQLITE_ALTER_TABLE          26   /* Database Name   Table Name      */
 3088 #define SQLITE_REINDEX              27   /* Index Name      NULL            */
 3089 #define SQLITE_ANALYZE              28   /* Table Name      NULL            */
 3090 #define SQLITE_CREATE_VTABLE        29   /* Table Name      Module Name     */
 3091 #define SQLITE_DROP_VTABLE          30   /* Table Name      Module Name     */
 3092 #define SQLITE_FUNCTION             31   /* NULL            Function Name   */
 3093 #define SQLITE_SAVEPOINT            32   /* Operation       Savepoint Name  */
 3094 #define SQLITE_COPY                  0   /* No longer used */
 3095 #define SQLITE_RECURSIVE            33   /* NULL            NULL            */
 3096 
 3097 /*
 3098 ** CAPI3REF: Tracing And Profiling Functions
 3099 ** METHOD: sqlite3
 3100 **
 3101 ** These routines are deprecated. Use the [sqlite3_trace_v2()] interface
 3102 ** instead of the routines described here.
 3103 **
 3104 ** These routines register callback functions that can be used for
 3105 ** tracing and profiling the execution of SQL statements.
 3106 **
 3107 ** ^The callback function registered by sqlite3_trace() is invoked at
 3108 ** various times when an SQL statement is being run by [sqlite3_step()].
 3109 ** ^The sqlite3_trace() callback is invoked with a UTF-8 rendering of the
 3110 ** SQL statement text as the statement first begins executing.
 3111 ** ^(Additional sqlite3_trace() callbacks might occur
 3112 ** as each triggered subprogram is entered.  The callbacks for triggers
 3113 ** contain a UTF-8 SQL comment that identifies the trigger.)^
 3114 **
 3115 ** The [SQLITE_TRACE_SIZE_LIMIT] compile-time option can be used to limit
 3116 ** the length of [bound parameter] expansion in the output of sqlite3_trace().
 3117 **
 3118 ** ^The callback function registered by sqlite3_profile() is invoked
 3119 ** as each SQL statement finishes.  ^The profile callback contains
 3120 ** the original statement text and an estimate of wall-clock time
 3121 ** of how long that statement took to run.  ^The profile callback
 3122 ** time is in units of nanoseconds, however the current implementation
 3123 ** is only capable of millisecond resolution so the six least significant
 3124 ** digits in the time are meaningless.  Future versions of SQLite
 3125 ** might provide greater resolution on the profiler callback.  Invoking
 3126 ** either [sqlite3_trace()] or [sqlite3_trace_v2()] will cancel the
 3127 ** profile callback.
 3128 */
 3129 SQLITE_API SQLITE_DEPRECATED void *sqlite3_trace(sqlite3*,
 3130    void(*xTrace)(void*,const char*), void*);
 3131 SQLITE_API SQLITE_DEPRECATED void *sqlite3_profile(sqlite3*,
 3132    void(*xProfile)(void*,const char*,sqlite3_uint64), void*);
 3133 
 3134 /*
 3135 ** CAPI3REF: SQL Trace Event Codes
 3136 ** KEYWORDS: SQLITE_TRACE
 3137 **
 3138 ** These constants identify classes of events that can be monitored
 3139 ** using the [sqlite3_trace_v2()] tracing logic.  The M argument
 3140 ** to [sqlite3_trace_v2(D,M,X,P)] is an OR-ed combination of one or more of
 3141 ** the following constants.  ^The first argument to the trace callback
 3142 ** is one of the following constants.
 3143 **
 3144 ** New tracing constants may be added in future releases.
 3145 **
 3146 ** ^A trace callback has four arguments: xCallback(T,C,P,X).
 3147 ** ^The T argument is one of the integer type codes above.
 3148 ** ^The C argument is a copy of the context pointer passed in as the
 3149 ** fourth argument to [sqlite3_trace_v2()].
 3150 ** The P and X arguments are pointers whose meanings depend on T.
 3151 **
 3152 ** &lt;dl&gt;
 3153 ** [[SQLITE_TRACE_STMT]] &lt;dt&gt;SQLITE_TRACE_STMT&lt;/dt&gt;
 3154 ** &lt;dd&gt;^An SQLITE_TRACE_STMT callback is invoked when a prepared statement
 3155 ** first begins running and possibly at other times during the
 3156 ** execution of the prepared statement, such as at the start of each
 3157 ** trigger subprogram. ^The P argument is a pointer to the
 3158 ** [prepared statement]. ^The X argument is a pointer to a string which
 3159 ** is the unexpanded SQL text of the prepared statement or an SQL comment
 3160 ** that indicates the invocation of a trigger.  ^The callback can compute
 3161 ** the same text that would have been returned by the legacy [sqlite3_trace()]
 3162 ** interface by using the X argument when X begins with &quot;--&quot; and invoking
 3163 ** [sqlite3_expanded_sql(P)] otherwise.
 3164 **
 3165 ** [[SQLITE_TRACE_PROFILE]] &lt;dt&gt;SQLITE_TRACE_PROFILE&lt;/dt&gt;
 3166 ** &lt;dd&gt;^An SQLITE_TRACE_PROFILE callback provides approximately the same
 3167 ** information as is provided by the [sqlite3_profile()] callback.
 3168 ** ^The P argument is a pointer to the [prepared statement] and the
 3169 ** X argument points to a 64-bit integer which is the estimated of
 3170 ** the number of nanosecond that the prepared statement took to run.
 3171 ** ^The SQLITE_TRACE_PROFILE callback is invoked when the statement finishes.
 3172 **
 3173 ** [[SQLITE_TRACE_ROW]] &lt;dt&gt;SQLITE_TRACE_ROW&lt;/dt&gt;
 3174 ** &lt;dd&gt;^An SQLITE_TRACE_ROW callback is invoked whenever a prepared
 3175 ** statement generates a single row of result.
 3176 ** ^The P argument is a pointer to the [prepared statement] and the
 3177 ** X argument is unused.
 3178 **
 3179 ** [[SQLITE_TRACE_CLOSE]] &lt;dt&gt;SQLITE_TRACE_CLOSE&lt;/dt&gt;
 3180 ** &lt;dd&gt;^An SQLITE_TRACE_CLOSE callback is invoked when a database
 3181 ** connection closes.
 3182 ** ^The P argument is a pointer to the [database connection] object
 3183 ** and the X argument is unused.
 3184 ** &lt;/dl&gt;
 3185 */
 3186 #define SQLITE_TRACE_STMT       0x01
 3187 #define SQLITE_TRACE_PROFILE    0x02
 3188 #define SQLITE_TRACE_ROW        0x04
 3189 #define SQLITE_TRACE_CLOSE      0x08
 3190 
 3191 /*
 3192 ** CAPI3REF: SQL Trace Hook
 3193 ** METHOD: sqlite3
 3194 **
 3195 ** ^The sqlite3_trace_v2(D,M,X,P) interface registers a trace callback
 3196 ** function X against [database connection] D, using property mask M
 3197 ** and context pointer P.  ^If the X callback is
 3198 ** NULL or if the M mask is zero, then tracing is disabled.  The
 3199 ** M argument should be the bitwise OR-ed combination of
 3200 ** zero or more [SQLITE_TRACE] constants.
 3201 **
 3202 ** ^Each call to either sqlite3_trace() or sqlite3_trace_v2() overrides
 3203 ** (cancels) any prior calls to sqlite3_trace() or sqlite3_trace_v2().
 3204 **
 3205 ** ^The X callback is invoked whenever any of the events identified by
 3206 ** mask M occur.  ^The integer return value from the callback is currently
 3207 ** ignored, though this may change in future releases.  Callback
 3208 ** implementations should return zero to ensure future compatibility.
 3209 **
 3210 ** ^A trace callback is invoked with four arguments: callback(T,C,P,X).
 3211 ** ^The T argument is one of the [SQLITE_TRACE]
 3212 ** constants to indicate why the callback was invoked.
 3213 ** ^The C argument is a copy of the context pointer.
 3214 ** The P and X arguments are pointers whose meanings depend on T.
 3215 **
 3216 ** The sqlite3_trace_v2() interface is intended to replace the legacy
 3217 ** interfaces [sqlite3_trace()] and [sqlite3_profile()], both of which
 3218 ** are deprecated.
 3219 */
 3220 SQLITE_API int sqlite3_trace_v2(
 3221   sqlite3*,
 3222   unsigned uMask,
 3223   int(*xCallback)(unsigned,void*,void*,void*),
 3224   void *pCtx
 3225 );
 3226 
 3227 /*
 3228 ** CAPI3REF: Query Progress Callbacks
 3229 ** METHOD: sqlite3
 3230 **
 3231 ** ^The sqlite3_progress_handler(D,N,X,P) interface causes the callback
 3232 ** function X to be invoked periodically during long running calls to
 3233 ** [sqlite3_exec()], [sqlite3_step()] and [sqlite3_get_table()] for
 3234 ** database connection D.  An example use for this
 3235 ** interface is to keep a GUI updated during a large query.
 3236 **
 3237 ** ^The parameter P is passed through as the only parameter to the
 3238 ** callback function X.  ^The parameter N is the approximate number of
 3239 ** [virtual machine instructions] that are evaluated between successive
 3240 ** invocations of the callback X.  ^If N is less than one then the progress
 3241 ** handler is disabled.
 3242 **
 3243 ** ^Only a single progress handler may be defined at one time per
 3244 ** [database connection]; setting a new progress handler cancels the
 3245 ** old one.  ^Setting parameter X to NULL disables the progress handler.
 3246 ** ^The progress handler is also disabled by setting N to a value less
 3247 ** than 1.
 3248 **
 3249 ** ^If the progress callback returns non-zero, the operation is
 3250 ** interrupted.  This feature can be used to implement a
 3251 ** &quot;Cancel&quot; button on a GUI progress dialog box.
 3252 **
 3253 ** The progress handler callback must not do anything that will modify
 3254 ** the database connection that invoked the progress handler.
 3255 ** Note that [sqlite3_prepare_v2()] and [sqlite3_step()] both modify their
 3256 ** database connections for the meaning of &quot;modify&quot; in this paragraph.
 3257 **
 3258 */
 3259 SQLITE_API void sqlite3_progress_handler(sqlite3*, int, int(*)(void*), void*);
 3260 
 3261 /*
 3262 ** CAPI3REF: Opening A New Database Connection
 3263 ** CONSTRUCTOR: sqlite3
 3264 **
 3265 ** ^These routines open an SQLite database file as specified by the
 3266 ** filename argument. ^The filename argument is interpreted as UTF-8 for
 3267 ** sqlite3_open() and sqlite3_open_v2() and as UTF-16 in the native byte
 3268 ** order for sqlite3_open16(). ^(A [database connection] handle is usually
 3269 ** returned in *ppDb, even if an error occurs.  The only exception is that
 3270 ** if SQLite is unable to allocate memory to hold the [sqlite3] object,
 3271 ** a NULL will be written into *ppDb instead of a pointer to the [sqlite3]
 3272 ** object.)^ ^(If the database is opened (and/or created) successfully, then
 3273 ** [SQLITE_OK] is returned.  Otherwise an [error code] is returned.)^ ^The
 3274 ** [sqlite3_errmsg()] or [sqlite3_errmsg16()] routines can be used to obtain
 3275 ** an English language description of the error following a failure of any
 3276 ** of the sqlite3_open() routines.
 3277 **
 3278 ** ^The default encoding will be UTF-8 for databases created using
 3279 ** sqlite3_open() or sqlite3_open_v2().  ^The default encoding for databases
 3280 ** created using sqlite3_open16() will be UTF-16 in the native byte order.
 3281 **
 3282 ** Whether or not an error occurs when it is opened, resources
 3283 ** associated with the [database connection] handle should be released by
 3284 ** passing it to [sqlite3_close()] when it is no longer required.
 3285 **
 3286 ** The sqlite3_open_v2() interface works like sqlite3_open()
 3287 ** except that it accepts two additional parameters for additional control
 3288 ** over the new database connection.  ^(The flags parameter to
<a name="27" id="anc27"></a><span class="line-modified"> 3289 ** sqlite3_open_v2() must include, at a minimum, one of the following</span>
<span class="line-modified"> 3290 ** three flag combinations:)^</span>


 3291 **
 3292 ** &lt;dl&gt;
 3293 ** ^(&lt;dt&gt;[SQLITE_OPEN_READONLY]&lt;/dt&gt;
 3294 ** &lt;dd&gt;The database is opened in read-only mode.  If the database does not
 3295 ** already exist, an error is returned.&lt;/dd&gt;)^
 3296 **
 3297 ** ^(&lt;dt&gt;[SQLITE_OPEN_READWRITE]&lt;/dt&gt;
 3298 ** &lt;dd&gt;The database is opened for reading and writing if possible, or reading
 3299 ** only if the file is write protected by the operating system.  In either
 3300 ** case the database must already exist, otherwise an error is returned.&lt;/dd&gt;)^
 3301 **
 3302 ** ^(&lt;dt&gt;[SQLITE_OPEN_READWRITE] | [SQLITE_OPEN_CREATE]&lt;/dt&gt;
 3303 ** &lt;dd&gt;The database is opened for reading and writing, and is created if
 3304 ** it does not already exist. This is the behavior that is always used for
 3305 ** sqlite3_open() and sqlite3_open16().&lt;/dd&gt;)^
 3306 ** &lt;/dl&gt;
 3307 **
<a name="28" id="anc28"></a><span class="line-added"> 3308 ** In addition to the required flags, the following optional flags are</span>
<span class="line-added"> 3309 ** also supported:</span>
<span class="line-added"> 3310 **</span>
<span class="line-added"> 3311 ** &lt;dl&gt;</span>
<span class="line-added"> 3312 ** ^(&lt;dt&gt;[SQLITE_OPEN_URI]&lt;/dt&gt;</span>
<span class="line-added"> 3313 ** &lt;dd&gt;The filename can be interpreted as a URI if this flag is set.&lt;/dd&gt;)^</span>
<span class="line-added"> 3314 **</span>
<span class="line-added"> 3315 ** ^(&lt;dt&gt;[SQLITE_OPEN_MEMORY]&lt;/dt&gt;</span>
<span class="line-added"> 3316 ** &lt;dd&gt;The database will be opened as an in-memory database.  The database</span>
<span class="line-added"> 3317 ** is named by the &quot;filename&quot; argument for the purposes of cache-sharing,</span>
<span class="line-added"> 3318 ** if shared cache mode is enabled, but the &quot;filename&quot; is otherwise ignored.</span>
<span class="line-added"> 3319 ** &lt;/dd&gt;)^</span>
<span class="line-added"> 3320 **</span>
<span class="line-added"> 3321 ** ^(&lt;dt&gt;[SQLITE_OPEN_NOMUTEX]&lt;/dt&gt;</span>
<span class="line-added"> 3322 ** &lt;dd&gt;The new database connection will use the &quot;multi-thread&quot;</span>
<span class="line-added"> 3323 ** [threading mode].)^  This means that separate threads are allowed</span>
<span class="line-added"> 3324 ** to use SQLite at the same time, as long as each thread is using</span>
<span class="line-added"> 3325 ** a different [database connection].</span>
<span class="line-added"> 3326 **</span>
<span class="line-added"> 3327 ** ^(&lt;dt&gt;[SQLITE_OPEN_FULLMUTEX]&lt;/dt&gt;</span>
<span class="line-added"> 3328 ** &lt;dd&gt;The new database connection will use the &quot;serialized&quot;</span>
<span class="line-added"> 3329 ** [threading mode].)^  This means the multiple threads can safely</span>
<span class="line-added"> 3330 ** attempt to use the same database connection at the same time.</span>
<span class="line-added"> 3331 ** (Mutexes will block any actual concurrency, but in this mode</span>
<span class="line-added"> 3332 ** there is no harm in trying.)</span>
<span class="line-added"> 3333 **</span>
<span class="line-added"> 3334 ** ^(&lt;dt&gt;[SQLITE_OPEN_SHAREDCACHE]&lt;/dt&gt;</span>
<span class="line-added"> 3335 ** &lt;dd&gt;The database is opened [shared cache] enabled, overriding</span>
<span class="line-added"> 3336 ** the default shared cache setting provided by</span>
<span class="line-added"> 3337 ** [sqlite3_enable_shared_cache()].)^</span>
<span class="line-added"> 3338 **</span>
<span class="line-added"> 3339 ** ^(&lt;dt&gt;[SQLITE_OPEN_PRIVATECACHE]&lt;/dt&gt;</span>
<span class="line-added"> 3340 ** &lt;dd&gt;The database is opened [shared cache] disabled, overriding</span>
<span class="line-added"> 3341 ** the default shared cache setting provided by</span>
<span class="line-added"> 3342 ** [sqlite3_enable_shared_cache()].)^</span>
<span class="line-added"> 3343 **</span>
<span class="line-added"> 3344 ** [[OPEN_NOFOLLOW]] ^(&lt;dt&gt;[SQLITE_OPEN_NOFOLLOW]&lt;/dt&gt;</span>
<span class="line-added"> 3345 ** &lt;dd&gt;The database filename is not allowed to be a symbolic link&lt;/dd&gt;</span>
<span class="line-added"> 3346 ** &lt;/dl&gt;)^</span>
<span class="line-added"> 3347 **</span>
 3348 ** If the 3rd parameter to sqlite3_open_v2() is not one of the
<a name="29" id="anc29"></a><span class="line-modified"> 3349 ** required combinations shown above optionally combined with other</span>
 3350 ** [SQLITE_OPEN_READONLY | SQLITE_OPEN_* bits]
 3351 ** then the behavior is undefined.
 3352 **
<a name="30" id="anc30"></a>











 3353 ** ^The fourth parameter to sqlite3_open_v2() is the name of the
 3354 ** [sqlite3_vfs] object that defines the operating system interface that
 3355 ** the new database connection should use.  ^If the fourth parameter is
 3356 ** a NULL pointer then the default [sqlite3_vfs] object is used.
 3357 **
 3358 ** ^If the filename is &quot;:memory:&quot;, then a private, temporary in-memory database
 3359 ** is created for the connection.  ^This in-memory database will vanish when
 3360 ** the database connection is closed.  Future versions of SQLite might
 3361 ** make use of additional special filenames that begin with the &quot;:&quot; character.
 3362 ** It is recommended that when a database filename actually does begin with
 3363 ** a &quot;:&quot; character you should prefix the filename with a pathname such as
 3364 ** &quot;./&quot; to avoid ambiguity.
 3365 **
 3366 ** ^If the filename is an empty string, then a private, temporary
 3367 ** on-disk database will be created.  ^This private database will be
 3368 ** automatically deleted as soon as the database connection is closed.
 3369 **
 3370 ** [[URI filenames in sqlite3_open()]] &lt;h3&gt;URI Filenames&lt;/h3&gt;
 3371 **
 3372 ** ^If [URI filename] interpretation is enabled, and the filename argument
 3373 ** begins with &quot;file:&quot;, then the filename is interpreted as a URI. ^URI
 3374 ** filename interpretation is enabled if the [SQLITE_OPEN_URI] flag is
 3375 ** set in the third argument to sqlite3_open_v2(), or if it has
 3376 ** been enabled globally using the [SQLITE_CONFIG_URI] option with the
 3377 ** [sqlite3_config()] method or by the [SQLITE_USE_URI] compile-time option.
 3378 ** URI filename interpretation is turned off
 3379 ** by default, but future releases of SQLite might enable URI filename
 3380 ** interpretation by default.  See &quot;[URI filenames]&quot; for additional
 3381 ** information.
 3382 **
 3383 ** URI filenames are parsed according to RFC 3986. ^If the URI contains an
 3384 ** authority, then it must be either an empty string or the string
 3385 ** &quot;localhost&quot;. ^If the authority is not an empty string or &quot;localhost&quot;, an
 3386 ** error is returned to the caller. ^The fragment component of a URI, if
 3387 ** present, is ignored.
 3388 **
 3389 ** ^SQLite uses the path component of the URI as the name of the disk file
 3390 ** which contains the database. ^If the path begins with a &#39;/&#39; character,
 3391 ** then it is interpreted as an absolute path. ^If the path does not begin
 3392 ** with a &#39;/&#39; (meaning that the authority section is omitted from the URI)
 3393 ** then the path is interpreted as a relative path.
 3394 ** ^(On windows, the first component of an absolute path
 3395 ** is a drive specification (e.g. &quot;C:&quot;).)^
 3396 **
 3397 ** [[core URI query parameters]]
 3398 ** The query component of a URI may contain parameters that are interpreted
 3399 ** either by SQLite itself, or by a [VFS | custom VFS implementation].
 3400 ** SQLite and its built-in [VFSes] interpret the
 3401 ** following query parameters:
 3402 **
 3403 ** &lt;ul&gt;
 3404 **   &lt;li&gt; &lt;b&gt;vfs&lt;/b&gt;: ^The &quot;vfs&quot; parameter may be used to specify the name of
 3405 **     a VFS object that provides the operating system interface that should
 3406 **     be used to access the database file on disk. ^If this option is set to
 3407 **     an empty string the default VFS object is used. ^Specifying an unknown
 3408 **     VFS is an error. ^If sqlite3_open_v2() is used and the vfs option is
 3409 **     present, then the VFS specified by the option takes precedence over
 3410 **     the value passed as the fourth parameter to sqlite3_open_v2().
 3411 **
 3412 **   &lt;li&gt; &lt;b&gt;mode&lt;/b&gt;: ^(The mode parameter may be set to either &quot;ro&quot;, &quot;rw&quot;,
 3413 **     &quot;rwc&quot;, or &quot;memory&quot;. Attempting to set it to any other value is
 3414 **     an error)^.
 3415 **     ^If &quot;ro&quot; is specified, then the database is opened for read-only
 3416 **     access, just as if the [SQLITE_OPEN_READONLY] flag had been set in the
 3417 **     third argument to sqlite3_open_v2(). ^If the mode option is set to
 3418 **     &quot;rw&quot;, then the database is opened for read-write (but not create)
 3419 **     access, as if SQLITE_OPEN_READWRITE (but not SQLITE_OPEN_CREATE) had
 3420 **     been set. ^Value &quot;rwc&quot; is equivalent to setting both
 3421 **     SQLITE_OPEN_READWRITE and SQLITE_OPEN_CREATE.  ^If the mode option is
 3422 **     set to &quot;memory&quot; then a pure [in-memory database] that never reads
 3423 **     or writes from disk is used. ^It is an error to specify a value for
 3424 **     the mode parameter that is less restrictive than that specified by
 3425 **     the flags passed in the third parameter to sqlite3_open_v2().
 3426 **
 3427 **   &lt;li&gt; &lt;b&gt;cache&lt;/b&gt;: ^The cache parameter may be set to either &quot;shared&quot; or
 3428 **     &quot;private&quot;. ^Setting it to &quot;shared&quot; is equivalent to setting the
 3429 **     SQLITE_OPEN_SHAREDCACHE bit in the flags argument passed to
 3430 **     sqlite3_open_v2(). ^Setting the cache parameter to &quot;private&quot; is
 3431 **     equivalent to setting the SQLITE_OPEN_PRIVATECACHE bit.
 3432 **     ^If sqlite3_open_v2() is used and the &quot;cache&quot; parameter is present in
 3433 **     a URI filename, its value overrides any behavior requested by setting
 3434 **     SQLITE_OPEN_PRIVATECACHE or SQLITE_OPEN_SHAREDCACHE flag.
 3435 **
 3436 **  &lt;li&gt; &lt;b&gt;psow&lt;/b&gt;: ^The psow parameter indicates whether or not the
 3437 **     [powersafe overwrite] property does or does not apply to the
 3438 **     storage media on which the database file resides.
 3439 **
 3440 **  &lt;li&gt; &lt;b&gt;nolock&lt;/b&gt;: ^The nolock parameter is a boolean query parameter
 3441 **     which if set disables file locking in rollback journal modes.  This
 3442 **     is useful for accessing a database on a filesystem that does not
 3443 **     support locking.  Caution:  Database corruption might result if two
 3444 **     or more processes write to the same database and any one of those
 3445 **     processes uses nolock=1.
 3446 **
 3447 **  &lt;li&gt; &lt;b&gt;immutable&lt;/b&gt;: ^The immutable parameter is a boolean query
 3448 **     parameter that indicates that the database file is stored on
 3449 **     read-only media.  ^When immutable is set, SQLite assumes that the
 3450 **     database file cannot be changed, even by a process with higher
 3451 **     privilege, and so the database is opened read-only and all locking
 3452 **     and change detection is disabled.  Caution: Setting the immutable
 3453 **     property on a database file that does in fact change can result
 3454 **     in incorrect query results and/or [SQLITE_CORRUPT] errors.
 3455 **     See also: [SQLITE_IOCAP_IMMUTABLE].
 3456 **
 3457 ** &lt;/ul&gt;
 3458 **
 3459 ** ^Specifying an unknown parameter in the query component of a URI is not an
 3460 ** error.  Future versions of SQLite might understand additional query
 3461 ** parameters.  See &quot;[query parameters with special meaning to SQLite]&quot; for
 3462 ** additional information.
 3463 **
 3464 ** [[URI filename examples]] &lt;h3&gt;URI filename examples&lt;/h3&gt;
 3465 **
 3466 ** &lt;table border=&quot;1&quot; align=center cellpadding=5&gt;
 3467 ** &lt;tr&gt;&lt;th&gt; URI filenames &lt;th&gt; Results
 3468 ** &lt;tr&gt;&lt;td&gt; file:data.db &lt;td&gt;
 3469 **          Open the file &quot;data.db&quot; in the current directory.
 3470 ** &lt;tr&gt;&lt;td&gt; file:/home/fred/data.db&lt;br&gt;
 3471 **          file:///home/fred/data.db &lt;br&gt;
 3472 **          file://localhost/home/fred/data.db &lt;br&gt; &lt;td&gt;
 3473 **          Open the database file &quot;/home/fred/data.db&quot;.
 3474 ** &lt;tr&gt;&lt;td&gt; file://darkstar/home/fred/data.db &lt;td&gt;
 3475 **          An error. &quot;darkstar&quot; is not a recognized authority.
 3476 ** &lt;tr&gt;&lt;td style=&quot;white-space:nowrap&quot;&gt;
 3477 **          file:///C:/Documents%20and%20Settings/fred/Desktop/data.db
 3478 **     &lt;td&gt; Windows only: Open the file &quot;data.db&quot; on fred&#39;s desktop on drive
 3479 **          C:. Note that the %20 escaping in this example is not strictly
 3480 **          necessary - space characters can be used literally
 3481 **          in URI filenames.
 3482 ** &lt;tr&gt;&lt;td&gt; file:data.db?mode=ro&amp;cache=private &lt;td&gt;
 3483 **          Open file &quot;data.db&quot; in the current directory for read-only access.
 3484 **          Regardless of whether or not shared-cache mode is enabled by
 3485 **          default, use a private cache.
 3486 ** &lt;tr&gt;&lt;td&gt; file:/home/fred/data.db?vfs=unix-dotfile &lt;td&gt;
 3487 **          Open file &quot;/home/fred/data.db&quot;. Use the special VFS &quot;unix-dotfile&quot;
 3488 **          that uses dot-files in place of posix advisory locking.
 3489 ** &lt;tr&gt;&lt;td&gt; file:data.db?mode=readonly &lt;td&gt;
 3490 **          An error. &quot;readonly&quot; is not a valid option for the &quot;mode&quot; parameter.
 3491 ** &lt;/table&gt;
 3492 **
 3493 ** ^URI hexadecimal escape sequences (%HH) are supported within the path and
 3494 ** query components of a URI. A hexadecimal escape sequence consists of a
 3495 ** percent sign - &quot;%&quot; - followed by exactly two hexadecimal digits
 3496 ** specifying an octet value. ^Before the path or query components of a
 3497 ** URI filename are interpreted, they are encoded using UTF-8 and all
 3498 ** hexadecimal escape sequences replaced by a single byte containing the
 3499 ** corresponding octet. If this process generates an invalid UTF-8 encoding,
 3500 ** the results are undefined.
 3501 **
 3502 ** &lt;b&gt;Note to Windows users:&lt;/b&gt;  The encoding used for the filename argument
 3503 ** of sqlite3_open() and sqlite3_open_v2() must be UTF-8, not whatever
 3504 ** codepage is currently defined.  Filenames containing international
 3505 ** characters must be converted to UTF-8 prior to passing them into
 3506 ** sqlite3_open() or sqlite3_open_v2().
 3507 **
 3508 ** &lt;b&gt;Note to Windows Runtime users:&lt;/b&gt;  The temporary directory must be set
 3509 ** prior to calling sqlite3_open() or sqlite3_open_v2().  Otherwise, various
 3510 ** features that require the use of temporary files may fail.
 3511 **
 3512 ** See also: [sqlite3_temp_directory]
 3513 */
 3514 SQLITE_API int sqlite3_open(
 3515   const char *filename,   /* Database filename (UTF-8) */
 3516   sqlite3 **ppDb          /* OUT: SQLite db handle */
 3517 );
 3518 SQLITE_API int sqlite3_open16(
 3519   const void *filename,   /* Database filename (UTF-16) */
 3520   sqlite3 **ppDb          /* OUT: SQLite db handle */
 3521 );
 3522 SQLITE_API int sqlite3_open_v2(
 3523   const char *filename,   /* Database filename (UTF-8) */
 3524   sqlite3 **ppDb,         /* OUT: SQLite db handle */
 3525   int flags,              /* Flags */
 3526   const char *zVfs        /* Name of VFS module to use */
 3527 );
 3528 
 3529 /*
 3530 ** CAPI3REF: Obtain Values For URI Parameters
 3531 **
<a name="31" id="anc31"></a><span class="line-modified"> 3532 ** These are utility routines, useful to [VFS|custom VFS implementations],</span>
<span class="line-modified"> 3533 ** that check if a database file was a URI that contained a specific query</span>
 3534 ** parameter, and if so obtains the value of that query parameter.
 3535 **
 3536 ** If F is the database filename pointer passed into the xOpen() method of
<a name="32" id="anc32"></a><span class="line-modified"> 3537 ** a VFS implementation or it is the return value of [sqlite3_db_filename()]</span>
<span class="line-modified"> 3538 ** and if P is the name of the query parameter, then</span>

 3539 ** sqlite3_uri_parameter(F,P) returns the value of the P
 3540 ** parameter if it exists or a NULL pointer if P does not appear as a
<a name="33" id="anc33"></a><span class="line-modified"> 3541 ** query parameter on F.  If P is a query parameter of F and it</span>
 3542 ** has no explicit value, then sqlite3_uri_parameter(F,P) returns
 3543 ** a pointer to an empty string.
 3544 **
 3545 ** The sqlite3_uri_boolean(F,P,B) routine assumes that P is a boolean
 3546 ** parameter and returns true (1) or false (0) according to the value
 3547 ** of P.  The sqlite3_uri_boolean(F,P,B) routine returns true (1) if the
 3548 ** value of query parameter P is one of &quot;yes&quot;, &quot;true&quot;, or &quot;on&quot; in any
 3549 ** case or if the value begins with a non-zero number.  The
 3550 ** sqlite3_uri_boolean(F,P,B) routines returns false (0) if the value of
 3551 ** query parameter P is one of &quot;no&quot;, &quot;false&quot;, or &quot;off&quot; in any case or
 3552 ** if the value begins with a numeric zero.  If P is not a query
<a name="34" id="anc34"></a><span class="line-modified"> 3553 ** parameter on F or if the value of P does not match any of the</span>
 3554 ** above, then sqlite3_uri_boolean(F,P,B) returns (B!=0).
 3555 **
 3556 ** The sqlite3_uri_int64(F,P,D) routine converts the value of P into a
 3557 ** 64-bit signed integer and returns that integer, or D if P does not
 3558 ** exist.  If the value of P is something other than an integer, then
 3559 ** zero is returned.
 3560 **
<a name="35" id="anc35"></a><span class="line-added"> 3561 ** The sqlite3_uri_key(F,N) returns a pointer to the name (not</span>
<span class="line-added"> 3562 ** the value) of the N-th query parameter for filename F, or a NULL</span>
<span class="line-added"> 3563 ** pointer if N is less than zero or greater than the number of query</span>
<span class="line-added"> 3564 ** parameters minus 1.  The N value is zero-based so N should be 0 to obtain</span>
<span class="line-added"> 3565 ** the name of the first query parameter, 1 for the second parameter, and</span>
<span class="line-added"> 3566 ** so forth.</span>
<span class="line-added"> 3567 **</span>
 3568 ** If F is a NULL pointer, then sqlite3_uri_parameter(F,P) returns NULL and
 3569 ** sqlite3_uri_boolean(F,P,B) returns B.  If F is not a NULL pointer and
<a name="36" id="anc36"></a><span class="line-modified"> 3570 ** is not a database file pathname pointer that the SQLite core passed</span>
<span class="line-modified"> 3571 ** into the xOpen VFS method, then the behavior of this routine is undefined</span>
<span class="line-modified"> 3572 ** and probably undesirable.</span>
<span class="line-added"> 3573 **</span>
<span class="line-added"> 3574 ** Beginning with SQLite [version 3.31.0] ([dateof:3.31.0]) the input F</span>
<span class="line-added"> 3575 ** parameter can also be the name of a rollback journal file or WAL file</span>
<span class="line-added"> 3576 ** in addition to the main database file.  Prior to version 3.31.0, these</span>
<span class="line-added"> 3577 ** routines would only work if F was the name of the main database file.</span>
<span class="line-added"> 3578 ** When the F parameter is the name of the rollback journal or WAL file,</span>
<span class="line-added"> 3579 ** it has access to all the same query parameters as were found on the</span>
<span class="line-added"> 3580 ** main database file.</span>
 3581 **
 3582 ** See the [URI filename] documentation for additional information.
 3583 */
 3584 SQLITE_API const char *sqlite3_uri_parameter(const char *zFilename, const char *zParam);
 3585 SQLITE_API int sqlite3_uri_boolean(const char *zFile, const char *zParam, int bDefault);
 3586 SQLITE_API sqlite3_int64 sqlite3_uri_int64(const char*, const char*, sqlite3_int64);
<a name="37" id="anc37"></a><span class="line-added"> 3587 SQLITE_API const char *sqlite3_uri_key(const char *zFilename, int N);</span>
<span class="line-added"> 3588 </span>
<span class="line-added"> 3589 /*</span>
<span class="line-added"> 3590 ** CAPI3REF:  Translate filenames</span>
<span class="line-added"> 3591 **</span>
<span class="line-added"> 3592 ** These routines are available to [VFS|custom VFS implementations] for</span>
<span class="line-added"> 3593 ** translating filenames between the main database file, the journal file,</span>
<span class="line-added"> 3594 ** and the WAL file.</span>
<span class="line-added"> 3595 **</span>
<span class="line-added"> 3596 ** If F is the name of an sqlite database file, journal file, or WAL file</span>
<span class="line-added"> 3597 ** passed by the SQLite core into the VFS, then sqlite3_filename_database(F)</span>
<span class="line-added"> 3598 ** returns the name of the corresponding database file.</span>
<span class="line-added"> 3599 **</span>
<span class="line-added"> 3600 ** If F is the name of an sqlite database file, journal file, or WAL file</span>
<span class="line-added"> 3601 ** passed by the SQLite core into the VFS, or if F is a database filename</span>
<span class="line-added"> 3602 ** obtained from [sqlite3_db_filename()], then sqlite3_filename_journal(F)</span>
<span class="line-added"> 3603 ** returns the name of the corresponding rollback journal file.</span>
<span class="line-added"> 3604 **</span>
<span class="line-added"> 3605 ** If F is the name of an sqlite database file, journal file, or WAL file</span>
<span class="line-added"> 3606 ** that was passed by the SQLite core into the VFS, or if F is a database</span>
<span class="line-added"> 3607 ** filename obtained from [sqlite3_db_filename()], then</span>
<span class="line-added"> 3608 ** sqlite3_filename_wal(F) returns the name of the corresponding</span>
<span class="line-added"> 3609 ** WAL file.</span>
<span class="line-added"> 3610 **</span>
<span class="line-added"> 3611 ** In all of the above, if F is not the name of a database, journal or WAL</span>
<span class="line-added"> 3612 ** filename passed into the VFS from the SQLite core and F is not the</span>
<span class="line-added"> 3613 ** return value from [sqlite3_db_filename()], then the result is</span>
<span class="line-added"> 3614 ** undefined and is likely a memory access violation.</span>
<span class="line-added"> 3615 */</span>
<span class="line-added"> 3616 SQLITE_API const char *sqlite3_filename_database(const char*);</span>
<span class="line-added"> 3617 SQLITE_API const char *sqlite3_filename_journal(const char*);</span>
<span class="line-added"> 3618 SQLITE_API const char *sqlite3_filename_wal(const char*);</span>
 3619 
 3620 
 3621 /*
 3622 ** CAPI3REF: Error Codes And Messages
 3623 ** METHOD: sqlite3
 3624 **
 3625 ** ^If the most recent sqlite3_* API call associated with
 3626 ** [database connection] D failed, then the sqlite3_errcode(D) interface
 3627 ** returns the numeric [result code] or [extended result code] for that
 3628 ** API call.
 3629 ** ^The sqlite3_extended_errcode()
 3630 ** interface is the same except that it always returns the
 3631 ** [extended result code] even when extended result codes are
 3632 ** disabled.
 3633 **
 3634 ** The values returned by sqlite3_errcode() and/or
 3635 ** sqlite3_extended_errcode() might change with each API call.
 3636 ** Except, there are some interfaces that are guaranteed to never
 3637 ** change the value of the error code.  The error-code preserving
 3638 ** interfaces are:
 3639 **
 3640 ** &lt;ul&gt;
 3641 ** &lt;li&gt; sqlite3_errcode()
 3642 ** &lt;li&gt; sqlite3_extended_errcode()
 3643 ** &lt;li&gt; sqlite3_errmsg()
 3644 ** &lt;li&gt; sqlite3_errmsg16()
 3645 ** &lt;/ul&gt;
 3646 **
 3647 ** ^The sqlite3_errmsg() and sqlite3_errmsg16() return English-language
 3648 ** text that describes the error, as either UTF-8 or UTF-16 respectively.
 3649 ** ^(Memory to hold the error message string is managed internally.
 3650 ** The application does not need to worry about freeing the result.
 3651 ** However, the error string might be overwritten or deallocated by
 3652 ** subsequent calls to other SQLite interface functions.)^
 3653 **
 3654 ** ^The sqlite3_errstr() interface returns the English-language text
 3655 ** that describes the [result code], as UTF-8.
 3656 ** ^(Memory to hold the error message string is managed internally
 3657 ** and must not be freed by the application)^.
 3658 **
 3659 ** When the serialized [threading mode] is in use, it might be the
 3660 ** case that a second error occurs on a separate thread in between
 3661 ** the time of the first error and the call to these interfaces.
 3662 ** When that happens, the second error will be reported since these
 3663 ** interfaces always report the most recent result.  To avoid
 3664 ** this, each thread can obtain exclusive use of the [database connection] D
 3665 ** by invoking [sqlite3_mutex_enter]([sqlite3_db_mutex](D)) before beginning
 3666 ** to use D and invoking [sqlite3_mutex_leave]([sqlite3_db_mutex](D)) after
 3667 ** all calls to the interfaces listed here are completed.
 3668 **
 3669 ** If an interface fails with SQLITE_MISUSE, that means the interface
 3670 ** was invoked incorrectly by the application.  In that case, the
 3671 ** error code and message may or may not be set.
 3672 */
 3673 SQLITE_API int sqlite3_errcode(sqlite3 *db);
 3674 SQLITE_API int sqlite3_extended_errcode(sqlite3 *db);
 3675 SQLITE_API const char *sqlite3_errmsg(sqlite3*);
 3676 SQLITE_API const void *sqlite3_errmsg16(sqlite3*);
 3677 SQLITE_API const char *sqlite3_errstr(int);
 3678 
 3679 /*
 3680 ** CAPI3REF: Prepared Statement Object
 3681 ** KEYWORDS: {prepared statement} {prepared statements}
 3682 **
 3683 ** An instance of this object represents a single SQL statement that
 3684 ** has been compiled into binary form and is ready to be evaluated.
 3685 **
 3686 ** Think of each SQL statement as a separate computer program.  The
 3687 ** original SQL text is source code.  A prepared statement object
 3688 ** is the compiled object code.  All SQL must be converted into a
 3689 ** prepared statement before it can be run.
 3690 **
 3691 ** The life-cycle of a prepared statement object usually goes like this:
 3692 **
 3693 ** &lt;ol&gt;
 3694 ** &lt;li&gt; Create the prepared statement object using [sqlite3_prepare_v2()].
 3695 ** &lt;li&gt; Bind values to [parameters] using the sqlite3_bind_*()
 3696 **      interfaces.
 3697 ** &lt;li&gt; Run the SQL by calling [sqlite3_step()] one or more times.
 3698 ** &lt;li&gt; Reset the prepared statement using [sqlite3_reset()] then go back
 3699 **      to step 2.  Do this zero or more times.
 3700 ** &lt;li&gt; Destroy the object using [sqlite3_finalize()].
 3701 ** &lt;/ol&gt;
 3702 */
 3703 typedef struct sqlite3_stmt sqlite3_stmt;
 3704 
 3705 /*
 3706 ** CAPI3REF: Run-time Limits
 3707 ** METHOD: sqlite3
 3708 **
 3709 ** ^(This interface allows the size of various constructs to be limited
 3710 ** on a connection by connection basis.  The first parameter is the
 3711 ** [database connection] whose limit is to be set or queried.  The
 3712 ** second parameter is one of the [limit categories] that define a
 3713 ** class of constructs to be size limited.  The third parameter is the
 3714 ** new limit for that construct.)^
 3715 **
 3716 ** ^If the new limit is a negative number, the limit is unchanged.
 3717 ** ^(For each limit category SQLITE_LIMIT_&lt;i&gt;NAME&lt;/i&gt; there is a
 3718 ** [limits | hard upper bound]
 3719 ** set at compile-time by a C preprocessor macro called
 3720 ** [limits | SQLITE_MAX_&lt;i&gt;NAME&lt;/i&gt;].
 3721 ** (The &quot;_LIMIT_&quot; in the name is changed to &quot;_MAX_&quot;.))^
 3722 ** ^Attempts to increase a limit above its hard upper bound are
 3723 ** silently truncated to the hard upper bound.
 3724 **
 3725 ** ^Regardless of whether or not the limit was changed, the
 3726 ** [sqlite3_limit()] interface returns the prior value of the limit.
 3727 ** ^Hence, to find the current value of a limit without changing it,
 3728 ** simply invoke this interface with the third parameter set to -1.
 3729 **
 3730 ** Run-time limits are intended for use in applications that manage
 3731 ** both their own internal database and also databases that are controlled
 3732 ** by untrusted external sources.  An example application might be a
 3733 ** web browser that has its own databases for storing history and
 3734 ** separate databases controlled by JavaScript applications downloaded
 3735 ** off the Internet.  The internal databases can be given the
 3736 ** large, default limits.  Databases managed by external sources can
 3737 ** be given much smaller limits designed to prevent a denial of service
 3738 ** attack.  Developers might also want to use the [sqlite3_set_authorizer()]
 3739 ** interface to further control untrusted SQL.  The size of the database
 3740 ** created by an untrusted script can be contained using the
 3741 ** [max_page_count] [PRAGMA].
 3742 **
 3743 ** New run-time limit categories may be added in future releases.
 3744 */
 3745 SQLITE_API int sqlite3_limit(sqlite3*, int id, int newVal);
 3746 
 3747 /*
 3748 ** CAPI3REF: Run-Time Limit Categories
 3749 ** KEYWORDS: {limit category} {*limit categories}
 3750 **
 3751 ** These constants define various performance limits
 3752 ** that can be lowered at run-time using [sqlite3_limit()].
 3753 ** The synopsis of the meanings of the various limits is shown below.
 3754 ** Additional information is available at [limits | Limits in SQLite].
 3755 **
 3756 ** &lt;dl&gt;
 3757 ** [[SQLITE_LIMIT_LENGTH]] ^(&lt;dt&gt;SQLITE_LIMIT_LENGTH&lt;/dt&gt;
 3758 ** &lt;dd&gt;The maximum size of any string or BLOB or table row, in bytes.&lt;dd&gt;)^
 3759 **
 3760 ** [[SQLITE_LIMIT_SQL_LENGTH]] ^(&lt;dt&gt;SQLITE_LIMIT_SQL_LENGTH&lt;/dt&gt;
 3761 ** &lt;dd&gt;The maximum length of an SQL statement, in bytes.&lt;/dd&gt;)^
 3762 **
 3763 ** [[SQLITE_LIMIT_COLUMN]] ^(&lt;dt&gt;SQLITE_LIMIT_COLUMN&lt;/dt&gt;
 3764 ** &lt;dd&gt;The maximum number of columns in a table definition or in the
 3765 ** result set of a [SELECT] or the maximum number of columns in an index
 3766 ** or in an ORDER BY or GROUP BY clause.&lt;/dd&gt;)^
 3767 **
 3768 ** [[SQLITE_LIMIT_EXPR_DEPTH]] ^(&lt;dt&gt;SQLITE_LIMIT_EXPR_DEPTH&lt;/dt&gt;
 3769 ** &lt;dd&gt;The maximum depth of the parse tree on any expression.&lt;/dd&gt;)^
 3770 **
 3771 ** [[SQLITE_LIMIT_COMPOUND_SELECT]] ^(&lt;dt&gt;SQLITE_LIMIT_COMPOUND_SELECT&lt;/dt&gt;
 3772 ** &lt;dd&gt;The maximum number of terms in a compound SELECT statement.&lt;/dd&gt;)^
 3773 **
 3774 ** [[SQLITE_LIMIT_VDBE_OP]] ^(&lt;dt&gt;SQLITE_LIMIT_VDBE_OP&lt;/dt&gt;
 3775 ** &lt;dd&gt;The maximum number of instructions in a virtual machine program
 3776 ** used to implement an SQL statement.  If [sqlite3_prepare_v2()] or
 3777 ** the equivalent tries to allocate space for more than this many opcodes
 3778 ** in a single prepared statement, an SQLITE_NOMEM error is returned.&lt;/dd&gt;)^
 3779 **
 3780 ** [[SQLITE_LIMIT_FUNCTION_ARG]] ^(&lt;dt&gt;SQLITE_LIMIT_FUNCTION_ARG&lt;/dt&gt;
 3781 ** &lt;dd&gt;The maximum number of arguments on a function.&lt;/dd&gt;)^
 3782 **
 3783 ** [[SQLITE_LIMIT_ATTACHED]] ^(&lt;dt&gt;SQLITE_LIMIT_ATTACHED&lt;/dt&gt;
 3784 ** &lt;dd&gt;The maximum number of [ATTACH | attached databases].)^&lt;/dd&gt;
 3785 **
 3786 ** [[SQLITE_LIMIT_LIKE_PATTERN_LENGTH]]
 3787 ** ^(&lt;dt&gt;SQLITE_LIMIT_LIKE_PATTERN_LENGTH&lt;/dt&gt;
 3788 ** &lt;dd&gt;The maximum length of the pattern argument to the [LIKE] or
 3789 ** [GLOB] operators.&lt;/dd&gt;)^
 3790 **
 3791 ** [[SQLITE_LIMIT_VARIABLE_NUMBER]]
 3792 ** ^(&lt;dt&gt;SQLITE_LIMIT_VARIABLE_NUMBER&lt;/dt&gt;
 3793 ** &lt;dd&gt;The maximum index number of any [parameter] in an SQL statement.)^
 3794 **
 3795 ** [[SQLITE_LIMIT_TRIGGER_DEPTH]] ^(&lt;dt&gt;SQLITE_LIMIT_TRIGGER_DEPTH&lt;/dt&gt;
 3796 ** &lt;dd&gt;The maximum depth of recursion for triggers.&lt;/dd&gt;)^
 3797 **
 3798 ** [[SQLITE_LIMIT_WORKER_THREADS]] ^(&lt;dt&gt;SQLITE_LIMIT_WORKER_THREADS&lt;/dt&gt;
 3799 ** &lt;dd&gt;The maximum number of auxiliary worker threads that a single
 3800 ** [prepared statement] may start.&lt;/dd&gt;)^
 3801 ** &lt;/dl&gt;
 3802 */
 3803 #define SQLITE_LIMIT_LENGTH                    0
 3804 #define SQLITE_LIMIT_SQL_LENGTH                1
 3805 #define SQLITE_LIMIT_COLUMN                    2
 3806 #define SQLITE_LIMIT_EXPR_DEPTH                3
 3807 #define SQLITE_LIMIT_COMPOUND_SELECT           4
 3808 #define SQLITE_LIMIT_VDBE_OP                   5
 3809 #define SQLITE_LIMIT_FUNCTION_ARG              6
 3810 #define SQLITE_LIMIT_ATTACHED                  7
 3811 #define SQLITE_LIMIT_LIKE_PATTERN_LENGTH       8
 3812 #define SQLITE_LIMIT_VARIABLE_NUMBER           9
 3813 #define SQLITE_LIMIT_TRIGGER_DEPTH            10
 3814 #define SQLITE_LIMIT_WORKER_THREADS           11
 3815 
 3816 /*
 3817 ** CAPI3REF: Prepare Flags
 3818 **
 3819 ** These constants define various flags that can be passed into
 3820 ** &quot;prepFlags&quot; parameter of the [sqlite3_prepare_v3()] and
 3821 ** [sqlite3_prepare16_v3()] interfaces.
 3822 **
 3823 ** New flags may be added in future releases of SQLite.
 3824 **
 3825 ** &lt;dl&gt;
 3826 ** [[SQLITE_PREPARE_PERSISTENT]] ^(&lt;dt&gt;SQLITE_PREPARE_PERSISTENT&lt;/dt&gt;
 3827 ** &lt;dd&gt;The SQLITE_PREPARE_PERSISTENT flag is a hint to the query planner
 3828 ** that the prepared statement will be retained for a long time and
 3829 ** probably reused many times.)^ ^Without this flag, [sqlite3_prepare_v3()]
 3830 ** and [sqlite3_prepare16_v3()] assume that the prepared statement will
 3831 ** be used just once or at most a few times and then destroyed using
 3832 ** [sqlite3_finalize()] relatively soon. The current implementation acts
 3833 ** on this hint by avoiding the use of [lookaside memory] so as not to
 3834 ** deplete the limited store of lookaside memory. Future versions of
 3835 ** SQLite may act on this hint differently.
 3836 **
 3837 ** [[SQLITE_PREPARE_NORMALIZE]] &lt;dt&gt;SQLITE_PREPARE_NORMALIZE&lt;/dt&gt;
 3838 ** &lt;dd&gt;The SQLITE_PREPARE_NORMALIZE flag is a no-op. This flag used
 3839 ** to be required for any prepared statement that wanted to use the
 3840 ** [sqlite3_normalized_sql()] interface.  However, the
 3841 ** [sqlite3_normalized_sql()] interface is now available to all
 3842 ** prepared statements, regardless of whether or not they use this
 3843 ** flag.
 3844 **
 3845 ** [[SQLITE_PREPARE_NO_VTAB]] &lt;dt&gt;SQLITE_PREPARE_NO_VTAB&lt;/dt&gt;
 3846 ** &lt;dd&gt;The SQLITE_PREPARE_NO_VTAB flag causes the SQL compiler
 3847 ** to return an error (error code SQLITE_ERROR) if the statement uses
 3848 ** any virtual tables.
 3849 ** &lt;/dl&gt;
 3850 */
 3851 #define SQLITE_PREPARE_PERSISTENT              0x01
 3852 #define SQLITE_PREPARE_NORMALIZE               0x02
 3853 #define SQLITE_PREPARE_NO_VTAB                 0x04
 3854 
 3855 /*
 3856 ** CAPI3REF: Compiling An SQL Statement
 3857 ** KEYWORDS: {SQL statement compiler}
 3858 ** METHOD: sqlite3
 3859 ** CONSTRUCTOR: sqlite3_stmt
 3860 **
 3861 ** To execute an SQL statement, it must first be compiled into a byte-code
 3862 ** program using one of these routines.  Or, in other words, these routines
 3863 ** are constructors for the [prepared statement] object.
 3864 **
 3865 ** The preferred routine to use is [sqlite3_prepare_v2()].  The
 3866 ** [sqlite3_prepare()] interface is legacy and should be avoided.
 3867 ** [sqlite3_prepare_v3()] has an extra &quot;prepFlags&quot; option that is used
 3868 ** for special purposes.
 3869 **
 3870 ** The use of the UTF-8 interfaces is preferred, as SQLite currently
 3871 ** does all parsing using UTF-8.  The UTF-16 interfaces are provided
 3872 ** as a convenience.  The UTF-16 interfaces work by converting the
 3873 ** input text into UTF-8, then invoking the corresponding UTF-8 interface.
 3874 **
 3875 ** The first argument, &quot;db&quot;, is a [database connection] obtained from a
 3876 ** prior successful call to [sqlite3_open()], [sqlite3_open_v2()] or
 3877 ** [sqlite3_open16()].  The database connection must not have been closed.
 3878 **
 3879 ** The second argument, &quot;zSql&quot;, is the statement to be compiled, encoded
 3880 ** as either UTF-8 or UTF-16.  The sqlite3_prepare(), sqlite3_prepare_v2(),
 3881 ** and sqlite3_prepare_v3()
 3882 ** interfaces use UTF-8, and sqlite3_prepare16(), sqlite3_prepare16_v2(),
 3883 ** and sqlite3_prepare16_v3() use UTF-16.
 3884 **
 3885 ** ^If the nByte argument is negative, then zSql is read up to the
 3886 ** first zero terminator. ^If nByte is positive, then it is the
 3887 ** number of bytes read from zSql.  ^If nByte is zero, then no prepared
 3888 ** statement is generated.
 3889 ** If the caller knows that the supplied string is nul-terminated, then
 3890 ** there is a small performance advantage to passing an nByte parameter that
 3891 ** is the number of bytes in the input string &lt;i&gt;including&lt;/i&gt;
 3892 ** the nul-terminator.
 3893 **
 3894 ** ^If pzTail is not NULL then *pzTail is made to point to the first byte
 3895 ** past the end of the first SQL statement in zSql.  These routines only
 3896 ** compile the first statement in zSql, so *pzTail is left pointing to
 3897 ** what remains uncompiled.
 3898 **
 3899 ** ^*ppStmt is left pointing to a compiled [prepared statement] that can be
 3900 ** executed using [sqlite3_step()].  ^If there is an error, *ppStmt is set
 3901 ** to NULL.  ^If the input text contains no SQL (if the input is an empty
 3902 ** string or a comment) then *ppStmt is set to NULL.
 3903 ** The calling procedure is responsible for deleting the compiled
 3904 ** SQL statement using [sqlite3_finalize()] after it has finished with it.
 3905 ** ppStmt may not be NULL.
 3906 **
 3907 ** ^On success, the sqlite3_prepare() family of routines return [SQLITE_OK];
 3908 ** otherwise an [error code] is returned.
 3909 **
 3910 ** The sqlite3_prepare_v2(), sqlite3_prepare_v3(), sqlite3_prepare16_v2(),
 3911 ** and sqlite3_prepare16_v3() interfaces are recommended for all new programs.
 3912 ** The older interfaces (sqlite3_prepare() and sqlite3_prepare16())
 3913 ** are retained for backwards compatibility, but their use is discouraged.
 3914 ** ^In the &quot;vX&quot; interfaces, the prepared statement
 3915 ** that is returned (the [sqlite3_stmt] object) contains a copy of the
 3916 ** original SQL text. This causes the [sqlite3_step()] interface to
 3917 ** behave differently in three ways:
 3918 **
 3919 ** &lt;ol&gt;
 3920 ** &lt;li&gt;
 3921 ** ^If the database schema changes, instead of returning [SQLITE_SCHEMA] as it
 3922 ** always used to do, [sqlite3_step()] will automatically recompile the SQL
 3923 ** statement and try to run it again. As many as [SQLITE_MAX_SCHEMA_RETRY]
 3924 ** retries will occur before sqlite3_step() gives up and returns an error.
 3925 ** &lt;/li&gt;
 3926 **
 3927 ** &lt;li&gt;
 3928 ** ^When an error occurs, [sqlite3_step()] will return one of the detailed
 3929 ** [error codes] or [extended error codes].  ^The legacy behavior was that
 3930 ** [sqlite3_step()] would only return a generic [SQLITE_ERROR] result code
 3931 ** and the application would have to make a second call to [sqlite3_reset()]
 3932 ** in order to find the underlying cause of the problem. With the &quot;v2&quot; prepare
 3933 ** interfaces, the underlying reason for the error is returned immediately.
 3934 ** &lt;/li&gt;
 3935 **
 3936 ** &lt;li&gt;
<a name="38" id="anc38"></a><span class="line-modified"> 3937 ** ^If the specific value bound to a [parameter | host parameter] in the</span>
 3938 ** WHERE clause might influence the choice of query plan for a statement,
 3939 ** then the statement will be automatically recompiled, as if there had been
<a name="39" id="anc39"></a><span class="line-modified"> 3940 ** a schema change, on the first [sqlite3_step()] call following any change</span>
 3941 ** to the [sqlite3_bind_text | bindings] of that [parameter].
<a name="40" id="anc40"></a><span class="line-modified"> 3942 ** ^The specific value of a WHERE-clause [parameter] might influence the</span>
 3943 ** choice of query plan if the parameter is the left-hand side of a [LIKE]
 3944 ** or [GLOB] operator or if the parameter is compared to an indexed column
 3945 ** and the [SQLITE_ENABLE_STAT4] compile-time option is enabled.
 3946 ** &lt;/li&gt;
 3947 ** &lt;/ol&gt;
 3948 **
 3949 ** &lt;p&gt;^sqlite3_prepare_v3() differs from sqlite3_prepare_v2() only in having
 3950 ** the extra prepFlags parameter, which is a bit array consisting of zero or
 3951 ** more of the [SQLITE_PREPARE_PERSISTENT|SQLITE_PREPARE_*] flags.  ^The
 3952 ** sqlite3_prepare_v2() interface works exactly the same as
 3953 ** sqlite3_prepare_v3() with a zero prepFlags parameter.
 3954 */
 3955 SQLITE_API int sqlite3_prepare(
 3956   sqlite3 *db,            /* Database handle */
 3957   const char *zSql,       /* SQL statement, UTF-8 encoded */
 3958   int nByte,              /* Maximum length of zSql in bytes. */
 3959   sqlite3_stmt **ppStmt,  /* OUT: Statement handle */
 3960   const char **pzTail     /* OUT: Pointer to unused portion of zSql */
 3961 );
 3962 SQLITE_API int sqlite3_prepare_v2(
 3963   sqlite3 *db,            /* Database handle */
 3964   const char *zSql,       /* SQL statement, UTF-8 encoded */
 3965   int nByte,              /* Maximum length of zSql in bytes. */
 3966   sqlite3_stmt **ppStmt,  /* OUT: Statement handle */
 3967   const char **pzTail     /* OUT: Pointer to unused portion of zSql */
 3968 );
 3969 SQLITE_API int sqlite3_prepare_v3(
 3970   sqlite3 *db,            /* Database handle */
 3971   const char *zSql,       /* SQL statement, UTF-8 encoded */
 3972   int nByte,              /* Maximum length of zSql in bytes. */
 3973   unsigned int prepFlags, /* Zero or more SQLITE_PREPARE_ flags */
 3974   sqlite3_stmt **ppStmt,  /* OUT: Statement handle */
 3975   const char **pzTail     /* OUT: Pointer to unused portion of zSql */
 3976 );
 3977 SQLITE_API int sqlite3_prepare16(
 3978   sqlite3 *db,            /* Database handle */
 3979   const void *zSql,       /* SQL statement, UTF-16 encoded */
 3980   int nByte,              /* Maximum length of zSql in bytes. */
 3981   sqlite3_stmt **ppStmt,  /* OUT: Statement handle */
 3982   const void **pzTail     /* OUT: Pointer to unused portion of zSql */
 3983 );
 3984 SQLITE_API int sqlite3_prepare16_v2(
 3985   sqlite3 *db,            /* Database handle */
 3986   const void *zSql,       /* SQL statement, UTF-16 encoded */
 3987   int nByte,              /* Maximum length of zSql in bytes. */
 3988   sqlite3_stmt **ppStmt,  /* OUT: Statement handle */
 3989   const void **pzTail     /* OUT: Pointer to unused portion of zSql */
 3990 );
 3991 SQLITE_API int sqlite3_prepare16_v3(
 3992   sqlite3 *db,            /* Database handle */
 3993   const void *zSql,       /* SQL statement, UTF-16 encoded */
 3994   int nByte,              /* Maximum length of zSql in bytes. */
 3995   unsigned int prepFlags, /* Zero or more SQLITE_PREPARE_ flags */
 3996   sqlite3_stmt **ppStmt,  /* OUT: Statement handle */
 3997   const void **pzTail     /* OUT: Pointer to unused portion of zSql */
 3998 );
 3999 
 4000 /*
 4001 ** CAPI3REF: Retrieving Statement SQL
 4002 ** METHOD: sqlite3_stmt
 4003 **
 4004 ** ^The sqlite3_sql(P) interface returns a pointer to a copy of the UTF-8
 4005 ** SQL text used to create [prepared statement] P if P was
 4006 ** created by [sqlite3_prepare_v2()], [sqlite3_prepare_v3()],
 4007 ** [sqlite3_prepare16_v2()], or [sqlite3_prepare16_v3()].
 4008 ** ^The sqlite3_expanded_sql(P) interface returns a pointer to a UTF-8
 4009 ** string containing the SQL text of prepared statement P with
 4010 ** [bound parameters] expanded.
 4011 ** ^The sqlite3_normalized_sql(P) interface returns a pointer to a UTF-8
 4012 ** string containing the normalized SQL text of prepared statement P.  The
 4013 ** semantics used to normalize a SQL statement are unspecified and subject
 4014 ** to change.  At a minimum, literal values will be replaced with suitable
 4015 ** placeholders.
 4016 **
 4017 ** ^(For example, if a prepared statement is created using the SQL
 4018 ** text &quot;SELECT $abc,:xyz&quot; and if parameter $abc is bound to integer 2345
 4019 ** and parameter :xyz is unbound, then sqlite3_sql() will return
 4020 ** the original string, &quot;SELECT $abc,:xyz&quot; but sqlite3_expanded_sql()
 4021 ** will return &quot;SELECT 2345,NULL&quot;.)^
 4022 **
 4023 ** ^The sqlite3_expanded_sql() interface returns NULL if insufficient memory
 4024 ** is available to hold the result, or if the result would exceed the
 4025 ** the maximum string length determined by the [SQLITE_LIMIT_LENGTH].
 4026 **
 4027 ** ^The [SQLITE_TRACE_SIZE_LIMIT] compile-time option limits the size of
 4028 ** bound parameter expansions.  ^The [SQLITE_OMIT_TRACE] compile-time
 4029 ** option causes sqlite3_expanded_sql() to always return NULL.
 4030 **
 4031 ** ^The strings returned by sqlite3_sql(P) and sqlite3_normalized_sql(P)
 4032 ** are managed by SQLite and are automatically freed when the prepared
 4033 ** statement is finalized.
 4034 ** ^The string returned by sqlite3_expanded_sql(P), on the other hand,
 4035 ** is obtained from [sqlite3_malloc()] and must be free by the application
 4036 ** by passing it to [sqlite3_free()].
 4037 */
 4038 SQLITE_API const char *sqlite3_sql(sqlite3_stmt *pStmt);
 4039 SQLITE_API char *sqlite3_expanded_sql(sqlite3_stmt *pStmt);
 4040 SQLITE_API const char *sqlite3_normalized_sql(sqlite3_stmt *pStmt);
 4041 
 4042 /*
 4043 ** CAPI3REF: Determine If An SQL Statement Writes The Database
 4044 ** METHOD: sqlite3_stmt
 4045 **
 4046 ** ^The sqlite3_stmt_readonly(X) interface returns true (non-zero) if
 4047 ** and only if the [prepared statement] X makes no direct changes to
 4048 ** the content of the database file.
 4049 **
 4050 ** Note that [application-defined SQL functions] or
 4051 ** [virtual tables] might change the database indirectly as a side effect.
 4052 ** ^(For example, if an application defines a function &quot;eval()&quot; that
 4053 ** calls [sqlite3_exec()], then the following SQL statement would
 4054 ** change the database file through side-effects:
 4055 **
 4056 ** &lt;blockquote&gt;&lt;pre&gt;
 4057 **    SELECT eval(&#39;DELETE FROM t1&#39;) FROM t2;
 4058 ** &lt;/pre&gt;&lt;/blockquote&gt;
 4059 **
 4060 ** But because the [SELECT] statement does not change the database file
 4061 ** directly, sqlite3_stmt_readonly() would still return true.)^
 4062 **
 4063 ** ^Transaction control statements such as [BEGIN], [COMMIT], [ROLLBACK],
 4064 ** [SAVEPOINT], and [RELEASE] cause sqlite3_stmt_readonly() to return true,
 4065 ** since the statements themselves do not actually modify the database but
 4066 ** rather they control the timing of when other statements modify the
 4067 ** database.  ^The [ATTACH] and [DETACH] statements also cause
 4068 ** sqlite3_stmt_readonly() to return true since, while those statements
 4069 ** change the configuration of a database connection, they do not make
 4070 ** changes to the content of the database files on disk.
 4071 ** ^The sqlite3_stmt_readonly() interface returns true for [BEGIN] since
 4072 ** [BEGIN] merely sets internal flags, but the [BEGIN|BEGIN IMMEDIATE] and
 4073 ** [BEGIN|BEGIN EXCLUSIVE] commands do touch the database and so
 4074 ** sqlite3_stmt_readonly() returns false for those commands.
 4075 */
 4076 SQLITE_API int sqlite3_stmt_readonly(sqlite3_stmt *pStmt);
 4077 
 4078 /*
 4079 ** CAPI3REF: Query The EXPLAIN Setting For A Prepared Statement
 4080 ** METHOD: sqlite3_stmt
 4081 **
 4082 ** ^The sqlite3_stmt_isexplain(S) interface returns 1 if the
 4083 ** prepared statement S is an EXPLAIN statement, or 2 if the
 4084 ** statement S is an EXPLAIN QUERY PLAN.
 4085 ** ^The sqlite3_stmt_isexplain(S) interface returns 0 if S is
 4086 ** an ordinary statement or a NULL pointer.
 4087 */
 4088 SQLITE_API int sqlite3_stmt_isexplain(sqlite3_stmt *pStmt);
 4089 
 4090 /*
 4091 ** CAPI3REF: Determine If A Prepared Statement Has Been Reset
 4092 ** METHOD: sqlite3_stmt
 4093 **
 4094 ** ^The sqlite3_stmt_busy(S) interface returns true (non-zero) if the
 4095 ** [prepared statement] S has been stepped at least once using
 4096 ** [sqlite3_step(S)] but has neither run to completion (returned
 4097 ** [SQLITE_DONE] from [sqlite3_step(S)]) nor
 4098 ** been reset using [sqlite3_reset(S)].  ^The sqlite3_stmt_busy(S)
 4099 ** interface returns false if S is a NULL pointer.  If S is not a
 4100 ** NULL pointer and is not a pointer to a valid [prepared statement]
 4101 ** object, then the behavior is undefined and probably undesirable.
 4102 **
 4103 ** This interface can be used in combination [sqlite3_next_stmt()]
 4104 ** to locate all prepared statements associated with a database
 4105 ** connection that are in need of being reset.  This can be used,
 4106 ** for example, in diagnostic routines to search for prepared
 4107 ** statements that are holding a transaction open.
 4108 */
 4109 SQLITE_API int sqlite3_stmt_busy(sqlite3_stmt*);
 4110 
 4111 /*
 4112 ** CAPI3REF: Dynamically Typed Value Object
 4113 ** KEYWORDS: {protected sqlite3_value} {unprotected sqlite3_value}
 4114 **
 4115 ** SQLite uses the sqlite3_value object to represent all values
 4116 ** that can be stored in a database table. SQLite uses dynamic typing
 4117 ** for the values it stores.  ^Values stored in sqlite3_value objects
 4118 ** can be integers, floating point values, strings, BLOBs, or NULL.
 4119 **
 4120 ** An sqlite3_value object may be either &quot;protected&quot; or &quot;unprotected&quot;.
 4121 ** Some interfaces require a protected sqlite3_value.  Other interfaces
 4122 ** will accept either a protected or an unprotected sqlite3_value.
 4123 ** Every interface that accepts sqlite3_value arguments specifies
 4124 ** whether or not it requires a protected sqlite3_value.  The
 4125 ** [sqlite3_value_dup()] interface can be used to construct a new
 4126 ** protected sqlite3_value from an unprotected sqlite3_value.
 4127 **
 4128 ** The terms &quot;protected&quot; and &quot;unprotected&quot; refer to whether or not
 4129 ** a mutex is held.  An internal mutex is held for a protected
 4130 ** sqlite3_value object but no mutex is held for an unprotected
 4131 ** sqlite3_value object.  If SQLite is compiled to be single-threaded
 4132 ** (with [SQLITE_THREADSAFE=0] and with [sqlite3_threadsafe()] returning 0)
 4133 ** or if SQLite is run in one of reduced mutex modes
 4134 ** [SQLITE_CONFIG_SINGLETHREAD] or [SQLITE_CONFIG_MULTITHREAD]
 4135 ** then there is no distinction between protected and unprotected
 4136 ** sqlite3_value objects and they can be used interchangeably.  However,
 4137 ** for maximum code portability it is recommended that applications
 4138 ** still make the distinction between protected and unprotected
 4139 ** sqlite3_value objects even when not strictly required.
 4140 **
 4141 ** ^The sqlite3_value objects that are passed as parameters into the
 4142 ** implementation of [application-defined SQL functions] are protected.
 4143 ** ^The sqlite3_value object returned by
 4144 ** [sqlite3_column_value()] is unprotected.
 4145 ** Unprotected sqlite3_value objects may only be used as arguments
 4146 ** to [sqlite3_result_value()], [sqlite3_bind_value()], and
 4147 ** [sqlite3_value_dup()].
 4148 ** The [sqlite3_value_blob | sqlite3_value_type()] family of
 4149 ** interfaces require protected sqlite3_value objects.
 4150 */
 4151 typedef struct sqlite3_value sqlite3_value;
 4152 
 4153 /*
 4154 ** CAPI3REF: SQL Function Context Object
 4155 **
 4156 ** The context in which an SQL function executes is stored in an
 4157 ** sqlite3_context object.  ^A pointer to an sqlite3_context object
 4158 ** is always first parameter to [application-defined SQL functions].
 4159 ** The application-defined SQL function implementation will pass this
 4160 ** pointer through into calls to [sqlite3_result_int | sqlite3_result()],
 4161 ** [sqlite3_aggregate_context()], [sqlite3_user_data()],
 4162 ** [sqlite3_context_db_handle()], [sqlite3_get_auxdata()],
 4163 ** and/or [sqlite3_set_auxdata()].
 4164 */
 4165 typedef struct sqlite3_context sqlite3_context;
 4166 
 4167 /*
 4168 ** CAPI3REF: Binding Values To Prepared Statements
 4169 ** KEYWORDS: {host parameter} {host parameters} {host parameter name}
 4170 ** KEYWORDS: {SQL parameter} {SQL parameters} {parameter binding}
 4171 ** METHOD: sqlite3_stmt
 4172 **
 4173 ** ^(In the SQL statement text input to [sqlite3_prepare_v2()] and its variants,
 4174 ** literals may be replaced by a [parameter] that matches one of following
 4175 ** templates:
 4176 **
 4177 ** &lt;ul&gt;
 4178 ** &lt;li&gt;  ?
 4179 ** &lt;li&gt;  ?NNN
 4180 ** &lt;li&gt;  :VVV
 4181 ** &lt;li&gt;  @VVV
 4182 ** &lt;li&gt;  $VVV
 4183 ** &lt;/ul&gt;
 4184 **
 4185 ** In the templates above, NNN represents an integer literal,
 4186 ** and VVV represents an alphanumeric identifier.)^  ^The values of these
 4187 ** parameters (also called &quot;host parameter names&quot; or &quot;SQL parameters&quot;)
 4188 ** can be set using the sqlite3_bind_*() routines defined here.
 4189 **
 4190 ** ^The first argument to the sqlite3_bind_*() routines is always
 4191 ** a pointer to the [sqlite3_stmt] object returned from
 4192 ** [sqlite3_prepare_v2()] or its variants.
 4193 **
 4194 ** ^The second argument is the index of the SQL parameter to be set.
 4195 ** ^The leftmost SQL parameter has an index of 1.  ^When the same named
 4196 ** SQL parameter is used more than once, second and subsequent
 4197 ** occurrences have the same index as the first occurrence.
 4198 ** ^The index for named parameters can be looked up using the
 4199 ** [sqlite3_bind_parameter_index()] API if desired.  ^The index
 4200 ** for &quot;?NNN&quot; parameters is the value of NNN.
 4201 ** ^The NNN value must be between 1 and the [sqlite3_limit()]
 4202 ** parameter [SQLITE_LIMIT_VARIABLE_NUMBER] (default value: 999).
 4203 **
 4204 ** ^The third argument is the value to bind to the parameter.
 4205 ** ^If the third parameter to sqlite3_bind_text() or sqlite3_bind_text16()
 4206 ** or sqlite3_bind_blob() is a NULL pointer then the fourth parameter
 4207 ** is ignored and the end result is the same as sqlite3_bind_null().
 4208 **
 4209 ** ^(In those routines that have a fourth argument, its value is the
 4210 ** number of bytes in the parameter.  To be clear: the value is the
 4211 ** number of &lt;u&gt;bytes&lt;/u&gt; in the value, not the number of characters.)^
 4212 ** ^If the fourth parameter to sqlite3_bind_text() or sqlite3_bind_text16()
 4213 ** is negative, then the length of the string is
 4214 ** the number of bytes up to the first zero terminator.
 4215 ** If the fourth parameter to sqlite3_bind_blob() is negative, then
 4216 ** the behavior is undefined.
 4217 ** If a non-negative fourth parameter is provided to sqlite3_bind_text()
 4218 ** or sqlite3_bind_text16() or sqlite3_bind_text64() then
 4219 ** that parameter must be the byte offset
 4220 ** where the NUL terminator would occur assuming the string were NUL
 4221 ** terminated.  If any NUL characters occur at byte offsets less than
 4222 ** the value of the fourth parameter then the resulting string value will
 4223 ** contain embedded NULs.  The result of expressions involving strings
 4224 ** with embedded NULs is undefined.
 4225 **
 4226 ** ^The fifth argument to the BLOB and string binding interfaces
 4227 ** is a destructor used to dispose of the BLOB or
 4228 ** string after SQLite has finished with it.  ^The destructor is called
 4229 ** to dispose of the BLOB or string even if the call to the bind API fails,
 4230 ** except the destructor is not called if the third parameter is a NULL
 4231 ** pointer or the fourth parameter is negative.
 4232 ** ^If the fifth argument is
 4233 ** the special value [SQLITE_STATIC], then SQLite assumes that the
 4234 ** information is in static, unmanaged space and does not need to be freed.
 4235 ** ^If the fifth argument has the value [SQLITE_TRANSIENT], then
 4236 ** SQLite makes its own private copy of the data immediately, before
 4237 ** the sqlite3_bind_*() routine returns.
 4238 **
 4239 ** ^The sixth argument to sqlite3_bind_text64() must be one of
 4240 ** [SQLITE_UTF8], [SQLITE_UTF16], [SQLITE_UTF16BE], or [SQLITE_UTF16LE]
 4241 ** to specify the encoding of the text in the third parameter.  If
 4242 ** the sixth argument to sqlite3_bind_text64() is not one of the
 4243 ** allowed values shown above, or if the text encoding is different
 4244 ** from the encoding specified by the sixth parameter, then the behavior
 4245 ** is undefined.
 4246 **
 4247 ** ^The sqlite3_bind_zeroblob() routine binds a BLOB of length N that
 4248 ** is filled with zeroes.  ^A zeroblob uses a fixed amount of memory
 4249 ** (just an integer to hold its size) while it is being processed.
 4250 ** Zeroblobs are intended to serve as placeholders for BLOBs whose
 4251 ** content is later written using
 4252 ** [sqlite3_blob_open | incremental BLOB I/O] routines.
 4253 ** ^A negative value for the zeroblob results in a zero-length BLOB.
 4254 **
 4255 ** ^The sqlite3_bind_pointer(S,I,P,T,D) routine causes the I-th parameter in
 4256 ** [prepared statement] S to have an SQL value of NULL, but to also be
 4257 ** associated with the pointer P of type T.  ^D is either a NULL pointer or
 4258 ** a pointer to a destructor function for P. ^SQLite will invoke the
 4259 ** destructor D with a single argument of P when it is finished using
 4260 ** P.  The T parameter should be a static string, preferably a string
 4261 ** literal. The sqlite3_bind_pointer() routine is part of the
 4262 ** [pointer passing interface] added for SQLite 3.20.0.
 4263 **
 4264 ** ^If any of the sqlite3_bind_*() routines are called with a NULL pointer
 4265 ** for the [prepared statement] or with a prepared statement for which
 4266 ** [sqlite3_step()] has been called more recently than [sqlite3_reset()],
 4267 ** then the call will return [SQLITE_MISUSE].  If any sqlite3_bind_()
 4268 ** routine is passed a [prepared statement] that has been finalized, the
 4269 ** result is undefined and probably harmful.
 4270 **
 4271 ** ^Bindings are not cleared by the [sqlite3_reset()] routine.
 4272 ** ^Unbound parameters are interpreted as NULL.
 4273 **
 4274 ** ^The sqlite3_bind_* routines return [SQLITE_OK] on success or an
 4275 ** [error code] if anything goes wrong.
 4276 ** ^[SQLITE_TOOBIG] might be returned if the size of a string or BLOB
 4277 ** exceeds limits imposed by [sqlite3_limit]([SQLITE_LIMIT_LENGTH]) or
 4278 ** [SQLITE_MAX_LENGTH].
 4279 ** ^[SQLITE_RANGE] is returned if the parameter
 4280 ** index is out of range.  ^[SQLITE_NOMEM] is returned if malloc() fails.
 4281 **
 4282 ** See also: [sqlite3_bind_parameter_count()],
 4283 ** [sqlite3_bind_parameter_name()], and [sqlite3_bind_parameter_index()].
 4284 */
 4285 SQLITE_API int sqlite3_bind_blob(sqlite3_stmt*, int, const void*, int n, void(*)(void*));
 4286 SQLITE_API int sqlite3_bind_blob64(sqlite3_stmt*, int, const void*, sqlite3_uint64,
 4287                         void(*)(void*));
 4288 SQLITE_API int sqlite3_bind_double(sqlite3_stmt*, int, double);
 4289 SQLITE_API int sqlite3_bind_int(sqlite3_stmt*, int, int);
 4290 SQLITE_API int sqlite3_bind_int64(sqlite3_stmt*, int, sqlite3_int64);
 4291 SQLITE_API int sqlite3_bind_null(sqlite3_stmt*, int);
 4292 SQLITE_API int sqlite3_bind_text(sqlite3_stmt*,int,const char*,int,void(*)(void*));
 4293 SQLITE_API int sqlite3_bind_text16(sqlite3_stmt*, int, const void*, int, void(*)(void*));
 4294 SQLITE_API int sqlite3_bind_text64(sqlite3_stmt*, int, const char*, sqlite3_uint64,
 4295                          void(*)(void*), unsigned char encoding);
 4296 SQLITE_API int sqlite3_bind_value(sqlite3_stmt*, int, const sqlite3_value*);
 4297 SQLITE_API int sqlite3_bind_pointer(sqlite3_stmt*, int, void*, const char*,void(*)(void*));
 4298 SQLITE_API int sqlite3_bind_zeroblob(sqlite3_stmt*, int, int n);
 4299 SQLITE_API int sqlite3_bind_zeroblob64(sqlite3_stmt*, int, sqlite3_uint64);
 4300 
 4301 /*
 4302 ** CAPI3REF: Number Of SQL Parameters
 4303 ** METHOD: sqlite3_stmt
 4304 **
 4305 ** ^This routine can be used to find the number of [SQL parameters]
 4306 ** in a [prepared statement].  SQL parameters are tokens of the
 4307 ** form &quot;?&quot;, &quot;?NNN&quot;, &quot;:AAA&quot;, &quot;$AAA&quot;, or &quot;@AAA&quot; that serve as
 4308 ** placeholders for values that are [sqlite3_bind_blob | bound]
 4309 ** to the parameters at a later time.
 4310 **
 4311 ** ^(This routine actually returns the index of the largest (rightmost)
 4312 ** parameter. For all forms except ?NNN, this will correspond to the
 4313 ** number of unique parameters.  If parameters of the ?NNN form are used,
 4314 ** there may be gaps in the list.)^
 4315 **
 4316 ** See also: [sqlite3_bind_blob|sqlite3_bind()],
 4317 ** [sqlite3_bind_parameter_name()], and
 4318 ** [sqlite3_bind_parameter_index()].
 4319 */
 4320 SQLITE_API int sqlite3_bind_parameter_count(sqlite3_stmt*);
 4321 
 4322 /*
 4323 ** CAPI3REF: Name Of A Host Parameter
 4324 ** METHOD: sqlite3_stmt
 4325 **
 4326 ** ^The sqlite3_bind_parameter_name(P,N) interface returns
 4327 ** the name of the N-th [SQL parameter] in the [prepared statement] P.
 4328 ** ^(SQL parameters of the form &quot;?NNN&quot; or &quot;:AAA&quot; or &quot;@AAA&quot; or &quot;$AAA&quot;
 4329 ** have a name which is the string &quot;?NNN&quot; or &quot;:AAA&quot; or &quot;@AAA&quot; or &quot;$AAA&quot;
 4330 ** respectively.
 4331 ** In other words, the initial &quot;:&quot; or &quot;$&quot; or &quot;@&quot; or &quot;?&quot;
 4332 ** is included as part of the name.)^
 4333 ** ^Parameters of the form &quot;?&quot; without a following integer have no name
 4334 ** and are referred to as &quot;nameless&quot; or &quot;anonymous parameters&quot;.
 4335 **
 4336 ** ^The first host parameter has an index of 1, not 0.
 4337 **
 4338 ** ^If the value N is out of range or if the N-th parameter is
 4339 ** nameless, then NULL is returned.  ^The returned string is
 4340 ** always in UTF-8 encoding even if the named parameter was
 4341 ** originally specified as UTF-16 in [sqlite3_prepare16()],
 4342 ** [sqlite3_prepare16_v2()], or [sqlite3_prepare16_v3()].
 4343 **
 4344 ** See also: [sqlite3_bind_blob|sqlite3_bind()],
 4345 ** [sqlite3_bind_parameter_count()], and
 4346 ** [sqlite3_bind_parameter_index()].
 4347 */
 4348 SQLITE_API const char *sqlite3_bind_parameter_name(sqlite3_stmt*, int);
 4349 
 4350 /*
 4351 ** CAPI3REF: Index Of A Parameter With A Given Name
 4352 ** METHOD: sqlite3_stmt
 4353 **
 4354 ** ^Return the index of an SQL parameter given its name.  ^The
 4355 ** index value returned is suitable for use as the second
 4356 ** parameter to [sqlite3_bind_blob|sqlite3_bind()].  ^A zero
 4357 ** is returned if no matching parameter is found.  ^The parameter
 4358 ** name must be given in UTF-8 even if the original statement
 4359 ** was prepared from UTF-16 text using [sqlite3_prepare16_v2()] or
 4360 ** [sqlite3_prepare16_v3()].
 4361 **
 4362 ** See also: [sqlite3_bind_blob|sqlite3_bind()],
 4363 ** [sqlite3_bind_parameter_count()], and
 4364 ** [sqlite3_bind_parameter_name()].
 4365 */
 4366 SQLITE_API int sqlite3_bind_parameter_index(sqlite3_stmt*, const char *zName);
 4367 
 4368 /*
 4369 ** CAPI3REF: Reset All Bindings On A Prepared Statement
 4370 ** METHOD: sqlite3_stmt
 4371 **
 4372 ** ^Contrary to the intuition of many, [sqlite3_reset()] does not reset
 4373 ** the [sqlite3_bind_blob | bindings] on a [prepared statement].
 4374 ** ^Use this routine to reset all host parameters to NULL.
 4375 */
 4376 SQLITE_API int sqlite3_clear_bindings(sqlite3_stmt*);
 4377 
 4378 /*
 4379 ** CAPI3REF: Number Of Columns In A Result Set
 4380 ** METHOD: sqlite3_stmt
 4381 **
 4382 ** ^Return the number of columns in the result set returned by the
 4383 ** [prepared statement]. ^If this routine returns 0, that means the
 4384 ** [prepared statement] returns no data (for example an [UPDATE]).
 4385 ** ^However, just because this routine returns a positive number does not
 4386 ** mean that one or more rows of data will be returned.  ^A SELECT statement
 4387 ** will always have a positive sqlite3_column_count() but depending on the
 4388 ** WHERE clause constraints and the table content, it might return no rows.
 4389 **
 4390 ** See also: [sqlite3_data_count()]
 4391 */
 4392 SQLITE_API int sqlite3_column_count(sqlite3_stmt *pStmt);
 4393 
 4394 /*
 4395 ** CAPI3REF: Column Names In A Result Set
 4396 ** METHOD: sqlite3_stmt
 4397 **
 4398 ** ^These routines return the name assigned to a particular column
 4399 ** in the result set of a [SELECT] statement.  ^The sqlite3_column_name()
 4400 ** interface returns a pointer to a zero-terminated UTF-8 string
 4401 ** and sqlite3_column_name16() returns a pointer to a zero-terminated
 4402 ** UTF-16 string.  ^The first parameter is the [prepared statement]
 4403 ** that implements the [SELECT] statement. ^The second parameter is the
 4404 ** column number.  ^The leftmost column is number 0.
 4405 **
 4406 ** ^The returned string pointer is valid until either the [prepared statement]
 4407 ** is destroyed by [sqlite3_finalize()] or until the statement is automatically
 4408 ** reprepared by the first call to [sqlite3_step()] for a particular run
 4409 ** or until the next call to
 4410 ** sqlite3_column_name() or sqlite3_column_name16() on the same column.
 4411 **
 4412 ** ^If sqlite3_malloc() fails during the processing of either routine
 4413 ** (for example during a conversion from UTF-8 to UTF-16) then a
 4414 ** NULL pointer is returned.
 4415 **
 4416 ** ^The name of a result column is the value of the &quot;AS&quot; clause for
 4417 ** that column, if there is an AS clause.  If there is no AS clause
 4418 ** then the name of the column is unspecified and may change from
 4419 ** one release of SQLite to the next.
 4420 */
 4421 SQLITE_API const char *sqlite3_column_name(sqlite3_stmt*, int N);
 4422 SQLITE_API const void *sqlite3_column_name16(sqlite3_stmt*, int N);
 4423 
 4424 /*
 4425 ** CAPI3REF: Source Of Data In A Query Result
 4426 ** METHOD: sqlite3_stmt
 4427 **
 4428 ** ^These routines provide a means to determine the database, table, and
 4429 ** table column that is the origin of a particular result column in
 4430 ** [SELECT] statement.
 4431 ** ^The name of the database or table or column can be returned as
 4432 ** either a UTF-8 or UTF-16 string.  ^The _database_ routines return
 4433 ** the database name, the _table_ routines return the table name, and
 4434 ** the origin_ routines return the column name.
 4435 ** ^The returned string is valid until the [prepared statement] is destroyed
 4436 ** using [sqlite3_finalize()] or until the statement is automatically
 4437 ** reprepared by the first call to [sqlite3_step()] for a particular run
 4438 ** or until the same information is requested
 4439 ** again in a different encoding.
 4440 **
 4441 ** ^The names returned are the original un-aliased names of the
 4442 ** database, table, and column.
 4443 **
 4444 ** ^The first argument to these interfaces is a [prepared statement].
 4445 ** ^These functions return information about the Nth result column returned by
 4446 ** the statement, where N is the second function argument.
 4447 ** ^The left-most column is column 0 for these routines.
 4448 **
 4449 ** ^If the Nth column returned by the statement is an expression or
 4450 ** subquery and is not a column value, then all of these functions return
<a name="41" id="anc41"></a><span class="line-modified"> 4451 ** NULL.  ^These routines might also return NULL if a memory allocation error</span>
 4452 ** occurs.  ^Otherwise, they return the name of the attached database, table,
 4453 ** or column that query result column was extracted from.
 4454 **
 4455 ** ^As with all other SQLite APIs, those whose names end with &quot;16&quot; return
 4456 ** UTF-16 encoded strings and the other functions return UTF-8.
 4457 **
 4458 ** ^These APIs are only available if the library was compiled with the
 4459 ** [SQLITE_ENABLE_COLUMN_METADATA] C-preprocessor symbol.
 4460 **
<a name="42" id="anc42"></a>



 4461 ** If two or more threads call one or more
 4462 ** [sqlite3_column_database_name | column metadata interfaces]
 4463 ** for the same [prepared statement] and result column
 4464 ** at the same time then the results are undefined.
 4465 */
 4466 SQLITE_API const char *sqlite3_column_database_name(sqlite3_stmt*,int);
 4467 SQLITE_API const void *sqlite3_column_database_name16(sqlite3_stmt*,int);
 4468 SQLITE_API const char *sqlite3_column_table_name(sqlite3_stmt*,int);
 4469 SQLITE_API const void *sqlite3_column_table_name16(sqlite3_stmt*,int);
 4470 SQLITE_API const char *sqlite3_column_origin_name(sqlite3_stmt*,int);
 4471 SQLITE_API const void *sqlite3_column_origin_name16(sqlite3_stmt*,int);
 4472 
 4473 /*
 4474 ** CAPI3REF: Declared Datatype Of A Query Result
 4475 ** METHOD: sqlite3_stmt
 4476 **
 4477 ** ^(The first parameter is a [prepared statement].
 4478 ** If this statement is a [SELECT] statement and the Nth column of the
 4479 ** returned result set of that [SELECT] is a table column (not an
 4480 ** expression or subquery) then the declared type of the table
 4481 ** column is returned.)^  ^If the Nth column of the result set is an
 4482 ** expression or subquery, then a NULL pointer is returned.
 4483 ** ^The returned string is always UTF-8 encoded.
 4484 **
 4485 ** ^(For example, given the database schema:
 4486 **
 4487 ** CREATE TABLE t1(c1 VARIANT);
 4488 **
 4489 ** and the following statement to be compiled:
 4490 **
 4491 ** SELECT c1 + 1, c1 FROM t1;
 4492 **
 4493 ** this routine would return the string &quot;VARIANT&quot; for the second result
 4494 ** column (i==1), and a NULL pointer for the first result column (i==0).)^
 4495 **
 4496 ** ^SQLite uses dynamic run-time typing.  ^So just because a column
 4497 ** is declared to contain a particular type does not mean that the
 4498 ** data stored in that column is of the declared type.  SQLite is
 4499 ** strongly typed, but the typing is dynamic not static.  ^Type
 4500 ** is associated with individual values, not with the containers
 4501 ** used to hold those values.
 4502 */
 4503 SQLITE_API const char *sqlite3_column_decltype(sqlite3_stmt*,int);
 4504 SQLITE_API const void *sqlite3_column_decltype16(sqlite3_stmt*,int);
 4505 
 4506 /*
 4507 ** CAPI3REF: Evaluate An SQL Statement
 4508 ** METHOD: sqlite3_stmt
 4509 **
 4510 ** After a [prepared statement] has been prepared using any of
 4511 ** [sqlite3_prepare_v2()], [sqlite3_prepare_v3()], [sqlite3_prepare16_v2()],
 4512 ** or [sqlite3_prepare16_v3()] or one of the legacy
 4513 ** interfaces [sqlite3_prepare()] or [sqlite3_prepare16()], this function
 4514 ** must be called one or more times to evaluate the statement.
 4515 **
 4516 ** The details of the behavior of the sqlite3_step() interface depend
 4517 ** on whether the statement was prepared using the newer &quot;vX&quot; interfaces
 4518 ** [sqlite3_prepare_v3()], [sqlite3_prepare_v2()], [sqlite3_prepare16_v3()],
 4519 ** [sqlite3_prepare16_v2()] or the older legacy
 4520 ** interfaces [sqlite3_prepare()] and [sqlite3_prepare16()].  The use of the
 4521 ** new &quot;vX&quot; interface is recommended for new applications but the legacy
 4522 ** interface will continue to be supported.
 4523 **
 4524 ** ^In the legacy interface, the return value will be either [SQLITE_BUSY],
 4525 ** [SQLITE_DONE], [SQLITE_ROW], [SQLITE_ERROR], or [SQLITE_MISUSE].
 4526 ** ^With the &quot;v2&quot; interface, any of the other [result codes] or
 4527 ** [extended result codes] might be returned as well.
 4528 **
 4529 ** ^[SQLITE_BUSY] means that the database engine was unable to acquire the
 4530 ** database locks it needs to do its job.  ^If the statement is a [COMMIT]
 4531 ** or occurs outside of an explicit transaction, then you can retry the
 4532 ** statement.  If the statement is not a [COMMIT] and occurs within an
 4533 ** explicit transaction then you should rollback the transaction before
 4534 ** continuing.
 4535 **
 4536 ** ^[SQLITE_DONE] means that the statement has finished executing
 4537 ** successfully.  sqlite3_step() should not be called again on this virtual
 4538 ** machine without first calling [sqlite3_reset()] to reset the virtual
 4539 ** machine back to its initial state.
 4540 **
 4541 ** ^If the SQL statement being executed returns any data, then [SQLITE_ROW]
 4542 ** is returned each time a new row of data is ready for processing by the
 4543 ** caller. The values may be accessed using the [column access functions].
 4544 ** sqlite3_step() is called again to retrieve the next row of data.
 4545 **
 4546 ** ^[SQLITE_ERROR] means that a run-time error (such as a constraint
 4547 ** violation) has occurred.  sqlite3_step() should not be called again on
 4548 ** the VM. More information may be found by calling [sqlite3_errmsg()].
 4549 ** ^With the legacy interface, a more specific error code (for example,
 4550 ** [SQLITE_INTERRUPT], [SQLITE_SCHEMA], [SQLITE_CORRUPT], and so forth)
 4551 ** can be obtained by calling [sqlite3_reset()] on the
 4552 ** [prepared statement].  ^In the &quot;v2&quot; interface,
 4553 ** the more specific error code is returned directly by sqlite3_step().
 4554 **
 4555 ** [SQLITE_MISUSE] means that the this routine was called inappropriately.
 4556 ** Perhaps it was called on a [prepared statement] that has
 4557 ** already been [sqlite3_finalize | finalized] or on one that had
 4558 ** previously returned [SQLITE_ERROR] or [SQLITE_DONE].  Or it could
 4559 ** be the case that the same database connection is being used by two or
 4560 ** more threads at the same moment in time.
 4561 **
 4562 ** For all versions of SQLite up to and including 3.6.23.1, a call to
 4563 ** [sqlite3_reset()] was required after sqlite3_step() returned anything
 4564 ** other than [SQLITE_ROW] before any subsequent invocation of
 4565 ** sqlite3_step().  Failure to reset the prepared statement using
 4566 ** [sqlite3_reset()] would result in an [SQLITE_MISUSE] return from
 4567 ** sqlite3_step().  But after [version 3.6.23.1] ([dateof:3.6.23.1],
 4568 ** sqlite3_step() began
 4569 ** calling [sqlite3_reset()] automatically in this circumstance rather
 4570 ** than returning [SQLITE_MISUSE].  This is not considered a compatibility
 4571 ** break because any application that ever receives an SQLITE_MISUSE error
 4572 ** is broken by definition.  The [SQLITE_OMIT_AUTORESET] compile-time option
 4573 ** can be used to restore the legacy behavior.
 4574 **
 4575 ** &lt;b&gt;Goofy Interface Alert:&lt;/b&gt; In the legacy interface, the sqlite3_step()
 4576 ** API always returns a generic error code, [SQLITE_ERROR], following any
 4577 ** error other than [SQLITE_BUSY] and [SQLITE_MISUSE].  You must call
 4578 ** [sqlite3_reset()] or [sqlite3_finalize()] in order to find one of the
 4579 ** specific [error codes] that better describes the error.
 4580 ** We admit that this is a goofy design.  The problem has been fixed
 4581 ** with the &quot;v2&quot; interface.  If you prepare all of your SQL statements
 4582 ** using [sqlite3_prepare_v3()] or [sqlite3_prepare_v2()]
 4583 ** or [sqlite3_prepare16_v2()] or [sqlite3_prepare16_v3()] instead
 4584 ** of the legacy [sqlite3_prepare()] and [sqlite3_prepare16()] interfaces,
 4585 ** then the more specific [error codes] are returned directly
 4586 ** by sqlite3_step().  The use of the &quot;vX&quot; interfaces is recommended.
 4587 */
 4588 SQLITE_API int sqlite3_step(sqlite3_stmt*);
 4589 
 4590 /*
 4591 ** CAPI3REF: Number of columns in a result set
 4592 ** METHOD: sqlite3_stmt
 4593 **
 4594 ** ^The sqlite3_data_count(P) interface returns the number of columns in the
 4595 ** current row of the result set of [prepared statement] P.
 4596 ** ^If prepared statement P does not have results ready to return
<a name="43" id="anc43"></a><span class="line-modified"> 4597 ** (via calls to the [sqlite3_column_int | sqlite3_column()] family of</span>
 4598 ** interfaces) then sqlite3_data_count(P) returns 0.
 4599 ** ^The sqlite3_data_count(P) routine also returns 0 if P is a NULL pointer.
 4600 ** ^The sqlite3_data_count(P) routine returns 0 if the previous call to
 4601 ** [sqlite3_step](P) returned [SQLITE_DONE].  ^The sqlite3_data_count(P)
 4602 ** will return non-zero if previous call to [sqlite3_step](P) returned
 4603 ** [SQLITE_ROW], except in the case of the [PRAGMA incremental_vacuum]
 4604 ** where it always returns zero since each step of that multi-step
 4605 ** pragma returns 0 columns of data.
 4606 **
 4607 ** See also: [sqlite3_column_count()]
 4608 */
 4609 SQLITE_API int sqlite3_data_count(sqlite3_stmt *pStmt);
 4610 
 4611 /*
 4612 ** CAPI3REF: Fundamental Datatypes
 4613 ** KEYWORDS: SQLITE_TEXT
 4614 **
 4615 ** ^(Every value in SQLite has one of five fundamental datatypes:
 4616 **
 4617 ** &lt;ul&gt;
 4618 ** &lt;li&gt; 64-bit signed integer
 4619 ** &lt;li&gt; 64-bit IEEE floating point number
 4620 ** &lt;li&gt; string
 4621 ** &lt;li&gt; BLOB
 4622 ** &lt;li&gt; NULL
 4623 ** &lt;/ul&gt;)^
 4624 **
 4625 ** These constants are codes for each of those types.
 4626 **
 4627 ** Note that the SQLITE_TEXT constant was also used in SQLite version 2
 4628 ** for a completely different meaning.  Software that links against both
 4629 ** SQLite version 2 and SQLite version 3 should use SQLITE3_TEXT, not
 4630 ** SQLITE_TEXT.
 4631 */
 4632 #define SQLITE_INTEGER  1
 4633 #define SQLITE_FLOAT    2
 4634 #define SQLITE_BLOB     4
 4635 #define SQLITE_NULL     5
 4636 #ifdef SQLITE_TEXT
 4637 # undef SQLITE_TEXT
 4638 #else
 4639 # define SQLITE_TEXT     3
 4640 #endif
 4641 #define SQLITE3_TEXT     3
 4642 
 4643 /*
 4644 ** CAPI3REF: Result Values From A Query
 4645 ** KEYWORDS: {column access functions}
 4646 ** METHOD: sqlite3_stmt
 4647 **
 4648 ** &lt;b&gt;Summary:&lt;/b&gt;
 4649 ** &lt;blockquote&gt;&lt;table border=0 cellpadding=0 cellspacing=0&gt;
 4650 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_blob&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;BLOB result
 4651 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_double&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;REAL result
 4652 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_int&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;32-bit INTEGER result
 4653 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_int64&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;64-bit INTEGER result
 4654 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_text&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;UTF-8 TEXT result
 4655 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_text16&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;UTF-16 TEXT result
 4656 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_value&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;The result as an
 4657 ** [sqlite3_value|unprotected sqlite3_value] object.
 4658 ** &lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;td&gt;&amp;nbsp;&lt;td&gt;&amp;nbsp;
 4659 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_bytes&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;Size of a BLOB
 4660 ** or a UTF-8 TEXT result in bytes
 4661 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_bytes16&amp;nbsp;&amp;nbsp;&lt;/b&gt;
 4662 ** &lt;td&gt;&amp;rarr;&amp;nbsp;&amp;nbsp;&lt;td&gt;Size of UTF-16
 4663 ** TEXT in bytes
 4664 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_column_type&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;Default
 4665 ** datatype of the result
 4666 ** &lt;/table&gt;&lt;/blockquote&gt;
 4667 **
 4668 ** &lt;b&gt;Details:&lt;/b&gt;
 4669 **
 4670 ** ^These routines return information about a single column of the current
 4671 ** result row of a query.  ^In every case the first argument is a pointer
 4672 ** to the [prepared statement] that is being evaluated (the [sqlite3_stmt*]
 4673 ** that was returned from [sqlite3_prepare_v2()] or one of its variants)
 4674 ** and the second argument is the index of the column for which information
 4675 ** should be returned. ^The leftmost column of the result set has the index 0.
 4676 ** ^The number of columns in the result can be determined using
 4677 ** [sqlite3_column_count()].
 4678 **
 4679 ** If the SQL statement does not currently point to a valid row, or if the
 4680 ** column index is out of range, the result is undefined.
 4681 ** These routines may only be called when the most recent call to
 4682 ** [sqlite3_step()] has returned [SQLITE_ROW] and neither
 4683 ** [sqlite3_reset()] nor [sqlite3_finalize()] have been called subsequently.
 4684 ** If any of these routines are called after [sqlite3_reset()] or
 4685 ** [sqlite3_finalize()] or after [sqlite3_step()] has returned
 4686 ** something other than [SQLITE_ROW], the results are undefined.
 4687 ** If [sqlite3_step()] or [sqlite3_reset()] or [sqlite3_finalize()]
 4688 ** are called from a different thread while any of these routines
 4689 ** are pending, then the results are undefined.
 4690 **
 4691 ** The first six interfaces (_blob, _double, _int, _int64, _text, and _text16)
 4692 ** each return the value of a result column in a specific data format.  If
 4693 ** the result column is not initially in the requested format (for example,
 4694 ** if the query returns an integer but the sqlite3_column_text() interface
 4695 ** is used to extract the value) then an automatic type conversion is performed.
 4696 **
 4697 ** ^The sqlite3_column_type() routine returns the
 4698 ** [SQLITE_INTEGER | datatype code] for the initial data type
 4699 ** of the result column.  ^The returned value is one of [SQLITE_INTEGER],
 4700 ** [SQLITE_FLOAT], [SQLITE_TEXT], [SQLITE_BLOB], or [SQLITE_NULL].
 4701 ** The return value of sqlite3_column_type() can be used to decide which
 4702 ** of the first six interface should be used to extract the column value.
 4703 ** The value returned by sqlite3_column_type() is only meaningful if no
 4704 ** automatic type conversions have occurred for the value in question.
 4705 ** After a type conversion, the result of calling sqlite3_column_type()
 4706 ** is undefined, though harmless.  Future
 4707 ** versions of SQLite may change the behavior of sqlite3_column_type()
 4708 ** following a type conversion.
 4709 **
 4710 ** If the result is a BLOB or a TEXT string, then the sqlite3_column_bytes()
 4711 ** or sqlite3_column_bytes16() interfaces can be used to determine the size
 4712 ** of that BLOB or string.
 4713 **
 4714 ** ^If the result is a BLOB or UTF-8 string then the sqlite3_column_bytes()
 4715 ** routine returns the number of bytes in that BLOB or string.
 4716 ** ^If the result is a UTF-16 string, then sqlite3_column_bytes() converts
 4717 ** the string to UTF-8 and then returns the number of bytes.
 4718 ** ^If the result is a numeric value then sqlite3_column_bytes() uses
 4719 ** [sqlite3_snprintf()] to convert that value to a UTF-8 string and returns
 4720 ** the number of bytes in that string.
 4721 ** ^If the result is NULL, then sqlite3_column_bytes() returns zero.
 4722 **
 4723 ** ^If the result is a BLOB or UTF-16 string then the sqlite3_column_bytes16()
 4724 ** routine returns the number of bytes in that BLOB or string.
 4725 ** ^If the result is a UTF-8 string, then sqlite3_column_bytes16() converts
 4726 ** the string to UTF-16 and then returns the number of bytes.
 4727 ** ^If the result is a numeric value then sqlite3_column_bytes16() uses
 4728 ** [sqlite3_snprintf()] to convert that value to a UTF-16 string and returns
 4729 ** the number of bytes in that string.
 4730 ** ^If the result is NULL, then sqlite3_column_bytes16() returns zero.
 4731 **
 4732 ** ^The values returned by [sqlite3_column_bytes()] and
 4733 ** [sqlite3_column_bytes16()] do not include the zero terminators at the end
 4734 ** of the string.  ^For clarity: the values returned by
 4735 ** [sqlite3_column_bytes()] and [sqlite3_column_bytes16()] are the number of
 4736 ** bytes in the string, not the number of characters.
 4737 **
 4738 ** ^Strings returned by sqlite3_column_text() and sqlite3_column_text16(),
 4739 ** even empty strings, are always zero-terminated.  ^The return
 4740 ** value from sqlite3_column_blob() for a zero-length BLOB is a NULL pointer.
 4741 **
 4742 ** &lt;b&gt;Warning:&lt;/b&gt; ^The object returned by [sqlite3_column_value()] is an
 4743 ** [unprotected sqlite3_value] object.  In a multithreaded environment,
 4744 ** an unprotected sqlite3_value object may only be used safely with
 4745 ** [sqlite3_bind_value()] and [sqlite3_result_value()].
 4746 ** If the [unprotected sqlite3_value] object returned by
 4747 ** [sqlite3_column_value()] is used in any other way, including calls
 4748 ** to routines like [sqlite3_value_int()], [sqlite3_value_text()],
 4749 ** or [sqlite3_value_bytes()], the behavior is not threadsafe.
 4750 ** Hence, the sqlite3_column_value() interface
 4751 ** is normally only useful within the implementation of
 4752 ** [application-defined SQL functions] or [virtual tables], not within
 4753 ** top-level application code.
 4754 **
 4755 ** The these routines may attempt to convert the datatype of the result.
 4756 ** ^For example, if the internal representation is FLOAT and a text result
 4757 ** is requested, [sqlite3_snprintf()] is used internally to perform the
 4758 ** conversion automatically.  ^(The following table details the conversions
 4759 ** that are applied:
 4760 **
 4761 ** &lt;blockquote&gt;
 4762 ** &lt;table border=&quot;1&quot;&gt;
 4763 ** &lt;tr&gt;&lt;th&gt; Internal&lt;br&gt;Type &lt;th&gt; Requested&lt;br&gt;Type &lt;th&gt;  Conversion
 4764 **
 4765 ** &lt;tr&gt;&lt;td&gt;  NULL    &lt;td&gt; INTEGER   &lt;td&gt; Result is 0
 4766 ** &lt;tr&gt;&lt;td&gt;  NULL    &lt;td&gt;  FLOAT    &lt;td&gt; Result is 0.0
 4767 ** &lt;tr&gt;&lt;td&gt;  NULL    &lt;td&gt;   TEXT    &lt;td&gt; Result is a NULL pointer
 4768 ** &lt;tr&gt;&lt;td&gt;  NULL    &lt;td&gt;   BLOB    &lt;td&gt; Result is a NULL pointer
 4769 ** &lt;tr&gt;&lt;td&gt; INTEGER  &lt;td&gt;  FLOAT    &lt;td&gt; Convert from integer to float
 4770 ** &lt;tr&gt;&lt;td&gt; INTEGER  &lt;td&gt;   TEXT    &lt;td&gt; ASCII rendering of the integer
 4771 ** &lt;tr&gt;&lt;td&gt; INTEGER  &lt;td&gt;   BLOB    &lt;td&gt; Same as INTEGER-&gt;TEXT
 4772 ** &lt;tr&gt;&lt;td&gt;  FLOAT   &lt;td&gt; INTEGER   &lt;td&gt; [CAST] to INTEGER
 4773 ** &lt;tr&gt;&lt;td&gt;  FLOAT   &lt;td&gt;   TEXT    &lt;td&gt; ASCII rendering of the float
 4774 ** &lt;tr&gt;&lt;td&gt;  FLOAT   &lt;td&gt;   BLOB    &lt;td&gt; [CAST] to BLOB
 4775 ** &lt;tr&gt;&lt;td&gt;  TEXT    &lt;td&gt; INTEGER   &lt;td&gt; [CAST] to INTEGER
 4776 ** &lt;tr&gt;&lt;td&gt;  TEXT    &lt;td&gt;  FLOAT    &lt;td&gt; [CAST] to REAL
 4777 ** &lt;tr&gt;&lt;td&gt;  TEXT    &lt;td&gt;   BLOB    &lt;td&gt; No change
 4778 ** &lt;tr&gt;&lt;td&gt;  BLOB    &lt;td&gt; INTEGER   &lt;td&gt; [CAST] to INTEGER
 4779 ** &lt;tr&gt;&lt;td&gt;  BLOB    &lt;td&gt;  FLOAT    &lt;td&gt; [CAST] to REAL
 4780 ** &lt;tr&gt;&lt;td&gt;  BLOB    &lt;td&gt;   TEXT    &lt;td&gt; Add a zero terminator if needed
 4781 ** &lt;/table&gt;
 4782 ** &lt;/blockquote&gt;)^
 4783 **
 4784 ** Note that when type conversions occur, pointers returned by prior
 4785 ** calls to sqlite3_column_blob(), sqlite3_column_text(), and/or
 4786 ** sqlite3_column_text16() may be invalidated.
 4787 ** Type conversions and pointer invalidations might occur
 4788 ** in the following cases:
 4789 **
 4790 ** &lt;ul&gt;
 4791 ** &lt;li&gt; The initial content is a BLOB and sqlite3_column_text() or
 4792 **      sqlite3_column_text16() is called.  A zero-terminator might
 4793 **      need to be added to the string.&lt;/li&gt;
 4794 ** &lt;li&gt; The initial content is UTF-8 text and sqlite3_column_bytes16() or
 4795 **      sqlite3_column_text16() is called.  The content must be converted
 4796 **      to UTF-16.&lt;/li&gt;
 4797 ** &lt;li&gt; The initial content is UTF-16 text and sqlite3_column_bytes() or
 4798 **      sqlite3_column_text() is called.  The content must be converted
 4799 **      to UTF-8.&lt;/li&gt;
 4800 ** &lt;/ul&gt;
 4801 **
 4802 ** ^Conversions between UTF-16be and UTF-16le are always done in place and do
 4803 ** not invalidate a prior pointer, though of course the content of the buffer
 4804 ** that the prior pointer references will have been modified.  Other kinds
 4805 ** of conversion are done in place when it is possible, but sometimes they
 4806 ** are not possible and in those cases prior pointers are invalidated.
 4807 **
 4808 ** The safest policy is to invoke these routines
 4809 ** in one of the following ways:
 4810 **
 4811 ** &lt;ul&gt;
 4812 **  &lt;li&gt;sqlite3_column_text() followed by sqlite3_column_bytes()&lt;/li&gt;
 4813 **  &lt;li&gt;sqlite3_column_blob() followed by sqlite3_column_bytes()&lt;/li&gt;
 4814 **  &lt;li&gt;sqlite3_column_text16() followed by sqlite3_column_bytes16()&lt;/li&gt;
 4815 ** &lt;/ul&gt;
 4816 **
 4817 ** In other words, you should call sqlite3_column_text(),
 4818 ** sqlite3_column_blob(), or sqlite3_column_text16() first to force the result
 4819 ** into the desired format, then invoke sqlite3_column_bytes() or
 4820 ** sqlite3_column_bytes16() to find the size of the result.  Do not mix calls
 4821 ** to sqlite3_column_text() or sqlite3_column_blob() with calls to
 4822 ** sqlite3_column_bytes16(), and do not mix calls to sqlite3_column_text16()
 4823 ** with calls to sqlite3_column_bytes().
 4824 **
 4825 ** ^The pointers returned are valid until a type conversion occurs as
 4826 ** described above, or until [sqlite3_step()] or [sqlite3_reset()] or
 4827 ** [sqlite3_finalize()] is called.  ^The memory space used to hold strings
 4828 ** and BLOBs is freed automatically.  Do not pass the pointers returned
 4829 ** from [sqlite3_column_blob()], [sqlite3_column_text()], etc. into
 4830 ** [sqlite3_free()].
 4831 **
 4832 ** As long as the input parameters are correct, these routines will only
 4833 ** fail if an out-of-memory error occurs during a format conversion.
 4834 ** Only the following subset of interfaces are subject to out-of-memory
 4835 ** errors:
 4836 **
 4837 ** &lt;ul&gt;
 4838 ** &lt;li&gt; sqlite3_column_blob()
 4839 ** &lt;li&gt; sqlite3_column_text()
 4840 ** &lt;li&gt; sqlite3_column_text16()
 4841 ** &lt;li&gt; sqlite3_column_bytes()
 4842 ** &lt;li&gt; sqlite3_column_bytes16()
 4843 ** &lt;/ul&gt;
 4844 **
 4845 ** If an out-of-memory error occurs, then the return value from these
 4846 ** routines is the same as if the column had contained an SQL NULL value.
 4847 ** Valid SQL NULL returns can be distinguished from out-of-memory errors
 4848 ** by invoking the [sqlite3_errcode()] immediately after the suspect
 4849 ** return value is obtained and before any
 4850 ** other SQLite interface is called on the same [database connection].
 4851 */
 4852 SQLITE_API const void *sqlite3_column_blob(sqlite3_stmt*, int iCol);
 4853 SQLITE_API double sqlite3_column_double(sqlite3_stmt*, int iCol);
 4854 SQLITE_API int sqlite3_column_int(sqlite3_stmt*, int iCol);
 4855 SQLITE_API sqlite3_int64 sqlite3_column_int64(sqlite3_stmt*, int iCol);
 4856 SQLITE_API const unsigned char *sqlite3_column_text(sqlite3_stmt*, int iCol);
 4857 SQLITE_API const void *sqlite3_column_text16(sqlite3_stmt*, int iCol);
 4858 SQLITE_API sqlite3_value *sqlite3_column_value(sqlite3_stmt*, int iCol);
 4859 SQLITE_API int sqlite3_column_bytes(sqlite3_stmt*, int iCol);
 4860 SQLITE_API int sqlite3_column_bytes16(sqlite3_stmt*, int iCol);
 4861 SQLITE_API int sqlite3_column_type(sqlite3_stmt*, int iCol);
 4862 
 4863 /*
 4864 ** CAPI3REF: Destroy A Prepared Statement Object
 4865 ** DESTRUCTOR: sqlite3_stmt
 4866 **
 4867 ** ^The sqlite3_finalize() function is called to delete a [prepared statement].
 4868 ** ^If the most recent evaluation of the statement encountered no errors
 4869 ** or if the statement is never been evaluated, then sqlite3_finalize() returns
 4870 ** SQLITE_OK.  ^If the most recent evaluation of statement S failed, then
 4871 ** sqlite3_finalize(S) returns the appropriate [error code] or
 4872 ** [extended error code].
 4873 **
 4874 ** ^The sqlite3_finalize(S) routine can be called at any point during
 4875 ** the life cycle of [prepared statement] S:
 4876 ** before statement S is ever evaluated, after
 4877 ** one or more calls to [sqlite3_reset()], or after any call
 4878 ** to [sqlite3_step()] regardless of whether or not the statement has
 4879 ** completed execution.
 4880 **
 4881 ** ^Invoking sqlite3_finalize() on a NULL pointer is a harmless no-op.
 4882 **
 4883 ** The application must finalize every [prepared statement] in order to avoid
 4884 ** resource leaks.  It is a grievous error for the application to try to use
 4885 ** a prepared statement after it has been finalized.  Any use of a prepared
 4886 ** statement after it has been finalized can result in undefined and
 4887 ** undesirable behavior such as segfaults and heap corruption.
 4888 */
 4889 SQLITE_API int sqlite3_finalize(sqlite3_stmt *pStmt);
 4890 
 4891 /*
 4892 ** CAPI3REF: Reset A Prepared Statement Object
 4893 ** METHOD: sqlite3_stmt
 4894 **
 4895 ** The sqlite3_reset() function is called to reset a [prepared statement]
 4896 ** object back to its initial state, ready to be re-executed.
 4897 ** ^Any SQL statement variables that had values bound to them using
 4898 ** the [sqlite3_bind_blob | sqlite3_bind_*() API] retain their values.
 4899 ** Use [sqlite3_clear_bindings()] to reset the bindings.
 4900 **
 4901 ** ^The [sqlite3_reset(S)] interface resets the [prepared statement] S
 4902 ** back to the beginning of its program.
 4903 **
 4904 ** ^If the most recent call to [sqlite3_step(S)] for the
 4905 ** [prepared statement] S returned [SQLITE_ROW] or [SQLITE_DONE],
 4906 ** or if [sqlite3_step(S)] has never before been called on S,
 4907 ** then [sqlite3_reset(S)] returns [SQLITE_OK].
 4908 **
 4909 ** ^If the most recent call to [sqlite3_step(S)] for the
 4910 ** [prepared statement] S indicated an error, then
 4911 ** [sqlite3_reset(S)] returns an appropriate [error code].
 4912 **
 4913 ** ^The [sqlite3_reset(S)] interface does not change the values
 4914 ** of any [sqlite3_bind_blob|bindings] on the [prepared statement] S.
 4915 */
 4916 SQLITE_API int sqlite3_reset(sqlite3_stmt *pStmt);
 4917 
 4918 /*
 4919 ** CAPI3REF: Create Or Redefine SQL Functions
 4920 ** KEYWORDS: {function creation routines}
<a name="44" id="anc44"></a>

 4921 ** METHOD: sqlite3
 4922 **
 4923 ** ^These functions (collectively known as &quot;function creation routines&quot;)
 4924 ** are used to add SQL functions or aggregates or to redefine the behavior
 4925 ** of existing SQL functions or aggregates. The only differences between
 4926 ** the three &quot;sqlite3_create_function*&quot; routines are the text encoding
 4927 ** expected for the second parameter (the name of the function being
 4928 ** created) and the presence or absence of a destructor callback for
 4929 ** the application data pointer. Function sqlite3_create_window_function()
 4930 ** is similar, but allows the user to supply the extra callback functions
 4931 ** needed by [aggregate window functions].
 4932 **
 4933 ** ^The first parameter is the [database connection] to which the SQL
 4934 ** function is to be added.  ^If an application uses more than one database
 4935 ** connection then application-defined SQL functions must be added
 4936 ** to each database connection separately.
 4937 **
 4938 ** ^The second parameter is the name of the SQL function to be created or
 4939 ** redefined.  ^The length of the name is limited to 255 bytes in a UTF-8
 4940 ** representation, exclusive of the zero-terminator.  ^Note that the name
 4941 ** length limit is in UTF-8 bytes, not characters nor UTF-16 bytes.
 4942 ** ^Any attempt to create a function with a longer name
 4943 ** will result in [SQLITE_MISUSE] being returned.
 4944 **
 4945 ** ^The third parameter (nArg)
 4946 ** is the number of arguments that the SQL function or
 4947 ** aggregate takes. ^If this parameter is -1, then the SQL function or
 4948 ** aggregate may take any number of arguments between 0 and the limit
 4949 ** set by [sqlite3_limit]([SQLITE_LIMIT_FUNCTION_ARG]).  If the third
 4950 ** parameter is less than -1 or greater than 127 then the behavior is
 4951 ** undefined.
 4952 **
 4953 ** ^The fourth parameter, eTextRep, specifies what
 4954 ** [SQLITE_UTF8 | text encoding] this SQL function prefers for
 4955 ** its parameters.  The application should set this parameter to
 4956 ** [SQLITE_UTF16LE] if the function implementation invokes
 4957 ** [sqlite3_value_text16le()] on an input, or [SQLITE_UTF16BE] if the
 4958 ** implementation invokes [sqlite3_value_text16be()] on an input, or
 4959 ** [SQLITE_UTF16] if [sqlite3_value_text16()] is used, or [SQLITE_UTF8]
 4960 ** otherwise.  ^The same SQL function may be registered multiple times using
 4961 ** different preferred text encodings, with different implementations for
 4962 ** each encoding.
 4963 ** ^When multiple implementations of the same function are available, SQLite
 4964 ** will pick the one that involves the least amount of data conversion.
 4965 **
 4966 ** ^The fourth parameter may optionally be ORed with [SQLITE_DETERMINISTIC]
 4967 ** to signal that the function will always return the same result given
 4968 ** the same inputs within a single SQL statement.  Most SQL functions are
 4969 ** deterministic.  The built-in [random()] SQL function is an example of a
 4970 ** function that is not deterministic.  The SQLite query planner is able to
 4971 ** perform additional optimizations on deterministic functions, so use
 4972 ** of the [SQLITE_DETERMINISTIC] flag is recommended where possible.
 4973 **
 4974 ** ^The fourth parameter may also optionally include the [SQLITE_DIRECTONLY]
 4975 ** flag, which if present prevents the function from being invoked from
<a name="45" id="anc45"></a><span class="line-modified"> 4976 ** within VIEWs, TRIGGERs, CHECK constraints, generated column expressions,</span>
<span class="line-modified"> 4977 ** index expressions, or the WHERE clause of partial indexes.</span>
<span class="line-modified"> 4978 **</span>
<span class="line-added"> 4979 ** &lt;span style=&quot;background-color:#ffff90;&quot;&gt;</span>
<span class="line-added"> 4980 ** For best security, the [SQLITE_DIRECTONLY] flag is recommended for</span>
<span class="line-added"> 4981 ** all application-defined SQL functions that do not need to be</span>
<span class="line-added"> 4982 ** used inside of triggers, view, CHECK constraints, or other elements of</span>
<span class="line-added"> 4983 ** the database schema.  This flags is especially recommended for SQL</span>
<span class="line-added"> 4984 ** functions that have side effects or reveal internal application state.</span>
<span class="line-added"> 4985 ** Without this flag, an attacker might be able to modify the schema of</span>
<span class="line-added"> 4986 ** a database file to include invocations of the function with parameters</span>
<span class="line-added"> 4987 ** chosen by the attacker, which the application will then execute when</span>
<span class="line-added"> 4988 ** the database file is opened and read.</span>
<span class="line-added"> 4989 ** &lt;/span&gt;</span>
 4990 **
 4991 ** ^(The fifth parameter is an arbitrary pointer.  The implementation of the
 4992 ** function can gain access to this pointer using [sqlite3_user_data()].)^
 4993 **
 4994 ** ^The sixth, seventh and eighth parameters passed to the three
 4995 ** &quot;sqlite3_create_function*&quot; functions, xFunc, xStep and xFinal, are
 4996 ** pointers to C-language functions that implement the SQL function or
 4997 ** aggregate. ^A scalar SQL function requires an implementation of the xFunc
 4998 ** callback only; NULL pointers must be passed as the xStep and xFinal
 4999 ** parameters. ^An aggregate SQL function requires an implementation of xStep
 5000 ** and xFinal and NULL pointer must be passed for xFunc. ^To delete an existing
 5001 ** SQL function or aggregate, pass NULL pointers for all three function
 5002 ** callbacks.
 5003 **
 5004 ** ^The sixth, seventh, eighth and ninth parameters (xStep, xFinal, xValue
 5005 ** and xInverse) passed to sqlite3_create_window_function are pointers to
 5006 ** C-language callbacks that implement the new function. xStep and xFinal
 5007 ** must both be non-NULL. xValue and xInverse may either both be NULL, in
 5008 ** which case a regular aggregate function is created, or must both be
 5009 ** non-NULL, in which case the new function may be used as either an aggregate
 5010 ** or aggregate window function. More details regarding the implementation
 5011 ** of aggregate window functions are
 5012 ** [user-defined window functions|available here].
 5013 **
 5014 ** ^(If the final parameter to sqlite3_create_function_v2() or
 5015 ** sqlite3_create_window_function() is not NULL, then it is destructor for
 5016 ** the application data pointer. The destructor is invoked when the function
 5017 ** is deleted, either by being overloaded or when the database connection
 5018 ** closes.)^ ^The destructor is also invoked if the call to
 5019 ** sqlite3_create_function_v2() fails.  ^When the destructor callback is
 5020 ** invoked, it is passed a single argument which is a copy of the application
 5021 ** data pointer which was the fifth parameter to sqlite3_create_function_v2().
 5022 **
 5023 ** ^It is permitted to register multiple implementations of the same
 5024 ** functions with the same name but with either differing numbers of
 5025 ** arguments or differing preferred text encodings.  ^SQLite will use
 5026 ** the implementation that most closely matches the way in which the
 5027 ** SQL function is used.  ^A function implementation with a non-negative
 5028 ** nArg parameter is a better match than a function implementation with
 5029 ** a negative nArg.  ^A function where the preferred text encoding
 5030 ** matches the database encoding is a better
 5031 ** match than a function where the encoding is different.
 5032 ** ^A function where the encoding difference is between UTF16le and UTF16be
 5033 ** is a closer match than a function where the encoding difference is
 5034 ** between UTF8 and UTF16.
 5035 **
 5036 ** ^Built-in functions may be overloaded by new application-defined functions.
 5037 **
 5038 ** ^An application-defined function is permitted to call other
 5039 ** SQLite interfaces.  However, such calls must not
 5040 ** close the database connection nor finalize or reset the prepared
 5041 ** statement in which the function is running.
 5042 */
 5043 SQLITE_API int sqlite3_create_function(
 5044   sqlite3 *db,
 5045   const char *zFunctionName,
 5046   int nArg,
 5047   int eTextRep,
 5048   void *pApp,
 5049   void (*xFunc)(sqlite3_context*,int,sqlite3_value**),
 5050   void (*xStep)(sqlite3_context*,int,sqlite3_value**),
 5051   void (*xFinal)(sqlite3_context*)
 5052 );
 5053 SQLITE_API int sqlite3_create_function16(
 5054   sqlite3 *db,
 5055   const void *zFunctionName,
 5056   int nArg,
 5057   int eTextRep,
 5058   void *pApp,
 5059   void (*xFunc)(sqlite3_context*,int,sqlite3_value**),
 5060   void (*xStep)(sqlite3_context*,int,sqlite3_value**),
 5061   void (*xFinal)(sqlite3_context*)
 5062 );
 5063 SQLITE_API int sqlite3_create_function_v2(
 5064   sqlite3 *db,
 5065   const char *zFunctionName,
 5066   int nArg,
 5067   int eTextRep,
 5068   void *pApp,
 5069   void (*xFunc)(sqlite3_context*,int,sqlite3_value**),
 5070   void (*xStep)(sqlite3_context*,int,sqlite3_value**),
 5071   void (*xFinal)(sqlite3_context*),
 5072   void(*xDestroy)(void*)
 5073 );
 5074 SQLITE_API int sqlite3_create_window_function(
 5075   sqlite3 *db,
 5076   const char *zFunctionName,
 5077   int nArg,
 5078   int eTextRep,
 5079   void *pApp,
 5080   void (*xStep)(sqlite3_context*,int,sqlite3_value**),
 5081   void (*xFinal)(sqlite3_context*),
 5082   void (*xValue)(sqlite3_context*),
 5083   void (*xInverse)(sqlite3_context*,int,sqlite3_value**),
 5084   void(*xDestroy)(void*)
 5085 );
 5086 
 5087 /*
 5088 ** CAPI3REF: Text Encodings
 5089 **
 5090 ** These constant define integer codes that represent the various
 5091 ** text encodings supported by SQLite.
 5092 */
 5093 #define SQLITE_UTF8           1    /* IMP: R-37514-35566 */
 5094 #define SQLITE_UTF16LE        2    /* IMP: R-03371-37637 */
 5095 #define SQLITE_UTF16BE        3    /* IMP: R-51971-34154 */
 5096 #define SQLITE_UTF16          4    /* Use native byte order */
 5097 #define SQLITE_ANY            5    /* Deprecated */
 5098 #define SQLITE_UTF16_ALIGNED  8    /* sqlite3_create_collation only */
 5099 
 5100 /*
 5101 ** CAPI3REF: Function Flags
 5102 **
 5103 ** These constants may be ORed together with the
 5104 ** [SQLITE_UTF8 | preferred text encoding] as the fourth argument
 5105 ** to [sqlite3_create_function()], [sqlite3_create_function16()], or
 5106 ** [sqlite3_create_function_v2()].
 5107 **
<a name="46" id="anc46"></a><span class="line-modified"> 5108 ** &lt;dl&gt;</span>
<span class="line-modified"> 5109 ** [[SQLITE_DETERMINISTIC]] &lt;dt&gt;SQLITE_DETERMINISTIC&lt;/dt&gt;&lt;dd&gt;</span>
<span class="line-modified"> 5110 ** The SQLITE_DETERMINISTIC flag means that the new function always gives</span>
<span class="line-added"> 5111 ** the same output when the input parameters are the same.</span>
<span class="line-added"> 5112 ** The [abs|abs() function] is deterministic, for example, but</span>
<span class="line-added"> 5113 ** [randomblob|randomblob()] is not.  Functions must</span>
<span class="line-added"> 5114 ** be deterministic in order to be used in certain contexts such as</span>
<span class="line-added"> 5115 ** with the WHERE clause of [partial indexes] or in [generated columns].</span>
<span class="line-added"> 5116 ** SQLite might also optimize deterministic functions by factoring them</span>
<span class="line-added"> 5117 ** out of inner loops.</span>
<span class="line-added"> 5118 ** &lt;/dd&gt;</span>
 5119 **
<a name="47" id="anc47"></a><span class="line-added"> 5120 ** [[SQLITE_DIRECTONLY]] &lt;dt&gt;SQLITE_DIRECTONLY&lt;/dt&gt;&lt;dd&gt;</span>
 5121 ** The SQLITE_DIRECTONLY flag means that the function may only be invoked
<a name="48" id="anc48"></a><span class="line-modified"> 5122 ** from top-level SQL, and cannot be used in VIEWs or TRIGGERs nor in</span>
<span class="line-modified"> 5123 ** schema structures such as [CHECK constraints], [DEFAULT clauses],</span>
<span class="line-modified"> 5124 ** [expression indexes], [partial indexes], or [generated columns].</span>
<span class="line-modified"> 5125 ** The SQLITE_DIRECTONLY flags is a security feature which is recommended</span>
<span class="line-modified"> 5126 ** for all [application-defined SQL functions], and especially for functions</span>
<span class="line-modified"> 5127 ** that have side-effects or that could potentially leak sensitive</span>
<span class="line-added"> 5128 ** information.</span>
<span class="line-added"> 5129 ** &lt;/dd&gt;</span>
<span class="line-added"> 5130 **</span>
<span class="line-added"> 5131 ** [[SQLITE_INNOCUOUS]] &lt;dt&gt;SQLITE_INNOCUOUS&lt;/dt&gt;&lt;dd&gt;</span>
<span class="line-added"> 5132 ** The SQLITE_INNOCUOUS flag means that the function is unlikely</span>
<span class="line-added"> 5133 ** to cause problems even if misused.  An innocuous function should have</span>
<span class="line-added"> 5134 ** no side effects and should not depend on any values other than its</span>
<span class="line-added"> 5135 ** input parameters. The [abs|abs() function] is an example of an</span>
<span class="line-added"> 5136 ** innocuous function.</span>
<span class="line-added"> 5137 ** The [load_extension() SQL function] is not innocuous because of its</span>
<span class="line-added"> 5138 ** side effects.</span>
<span class="line-added"> 5139 ** &lt;p&gt; SQLITE_INNOCUOUS is similar to SQLITE_DETERMINISTIC, but is not</span>
<span class="line-added"> 5140 ** exactly the same.  The [random|random() function] is an example of a</span>
<span class="line-added"> 5141 ** function that is innocuous but not deterministic.</span>
<span class="line-added"> 5142 ** &lt;p&gt;Some heightened security settings</span>
<span class="line-added"> 5143 ** ([SQLITE_DBCONFIG_TRUSTED_SCHEMA] and [PRAGMA trusted_schema=OFF])</span>
<span class="line-added"> 5144 ** disable the use of SQL functions inside views and triggers and in</span>
<span class="line-added"> 5145 ** schema structures such as [CHECK constraints], [DEFAULT clauses],</span>
<span class="line-added"> 5146 ** [expression indexes], [partial indexes], and [generated columns] unless</span>
<span class="line-added"> 5147 ** the function is tagged with SQLITE_INNOCUOUS.  Most built-in functions</span>
<span class="line-added"> 5148 ** are innocuous.  Developers are advised to avoid using the</span>
<span class="line-added"> 5149 ** SQLITE_INNOCUOUS flag for application-defined functions unless the</span>
<span class="line-added"> 5150 ** function has been carefully audited and found to be free of potentially</span>
<span class="line-added"> 5151 ** security-adverse side-effects and information-leaks.</span>
<span class="line-added"> 5152 ** &lt;/dd&gt;</span>
 5153 **
<a name="49" id="anc49"></a><span class="line-added"> 5154 ** [[SQLITE_SUBTYPE]] &lt;dt&gt;SQLITE_SUBTYPE&lt;/dt&gt;&lt;dd&gt;</span>
 5155 ** The SQLITE_SUBTYPE flag indicates to SQLite that a function may call
 5156 ** [sqlite3_value_subtype()] to inspect the sub-types of its arguments.
 5157 ** Specifying this flag makes no difference for scalar or aggregate user
 5158 ** functions. However, if it is not specified for a user-defined window
 5159 ** function, then any sub-types belonging to arguments passed to the window
 5160 ** function may be discarded before the window function is called (i.e.
 5161 ** sqlite3_value_subtype() will always return 0).
<a name="50" id="anc50"></a><span class="line-added"> 5162 ** &lt;/dd&gt;</span>
<span class="line-added"> 5163 ** &lt;/dl&gt;</span>
 5164 */
 5165 #define SQLITE_DETERMINISTIC    0x000000800
 5166 #define SQLITE_DIRECTONLY       0x000080000
 5167 #define SQLITE_SUBTYPE          0x000100000
<a name="51" id="anc51"></a><span class="line-added"> 5168 #define SQLITE_INNOCUOUS        0x000200000</span>
 5169 
 5170 /*
 5171 ** CAPI3REF: Deprecated Functions
 5172 ** DEPRECATED
 5173 **
 5174 ** These functions are [deprecated].  In order to maintain
 5175 ** backwards compatibility with older code, these functions continue
 5176 ** to be supported.  However, new applications should avoid
 5177 ** the use of these functions.  To encourage programmers to avoid
 5178 ** these functions, we will not explain what they do.
 5179 */
 5180 #ifndef SQLITE_OMIT_DEPRECATED
 5181 SQLITE_API SQLITE_DEPRECATED int sqlite3_aggregate_count(sqlite3_context*);
 5182 SQLITE_API SQLITE_DEPRECATED int sqlite3_expired(sqlite3_stmt*);
 5183 SQLITE_API SQLITE_DEPRECATED int sqlite3_transfer_bindings(sqlite3_stmt*, sqlite3_stmt*);
 5184 SQLITE_API SQLITE_DEPRECATED int sqlite3_global_recover(void);
 5185 SQLITE_API SQLITE_DEPRECATED void sqlite3_thread_cleanup(void);
 5186 SQLITE_API SQLITE_DEPRECATED int sqlite3_memory_alarm(void(*)(void*,sqlite3_int64,int),
 5187                       void*,sqlite3_int64);
 5188 #endif
 5189 
 5190 /*
 5191 ** CAPI3REF: Obtaining SQL Values
 5192 ** METHOD: sqlite3_value
 5193 **
 5194 ** &lt;b&gt;Summary:&lt;/b&gt;
 5195 ** &lt;blockquote&gt;&lt;table border=0 cellpadding=0 cellspacing=0&gt;
 5196 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_blob&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;BLOB value
 5197 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_double&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;REAL value
 5198 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_int&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;32-bit INTEGER value
 5199 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_int64&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;64-bit INTEGER value
 5200 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_pointer&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;Pointer value
 5201 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_text&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;UTF-8 TEXT value
 5202 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_text16&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;UTF-16 TEXT value in
 5203 ** the native byteorder
 5204 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_text16be&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;UTF-16be TEXT value
 5205 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_text16le&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;UTF-16le TEXT value
 5206 ** &lt;tr&gt;&lt;td&gt;&amp;nbsp;&lt;td&gt;&amp;nbsp;&lt;td&gt;&amp;nbsp;
 5207 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_bytes&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;Size of a BLOB
 5208 ** or a UTF-8 TEXT in bytes
 5209 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_bytes16&amp;nbsp;&amp;nbsp;&lt;/b&gt;
 5210 ** &lt;td&gt;&amp;rarr;&amp;nbsp;&amp;nbsp;&lt;td&gt;Size of UTF-16
 5211 ** TEXT in bytes
 5212 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_type&lt;/b&gt;&lt;td&gt;&amp;rarr;&lt;td&gt;Default
 5213 ** datatype of the value
 5214 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_numeric_type&amp;nbsp;&amp;nbsp;&lt;/b&gt;
 5215 ** &lt;td&gt;&amp;rarr;&amp;nbsp;&amp;nbsp;&lt;td&gt;Best numeric datatype of the value
 5216 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_nochange&amp;nbsp;&amp;nbsp;&lt;/b&gt;
 5217 ** &lt;td&gt;&amp;rarr;&amp;nbsp;&amp;nbsp;&lt;td&gt;True if the column is unchanged in an UPDATE
 5218 ** against a virtual table.
 5219 ** &lt;tr&gt;&lt;td&gt;&lt;b&gt;sqlite3_value_frombind&amp;nbsp;&amp;nbsp;&lt;/b&gt;
 5220 ** &lt;td&gt;&amp;rarr;&amp;nbsp;&amp;nbsp;&lt;td&gt;True if value originated from a [bound parameter]
 5221 ** &lt;/table&gt;&lt;/blockquote&gt;
 5222 **
 5223 ** &lt;b&gt;Details:&lt;/b&gt;
 5224 **
 5225 ** These routines extract type, size, and content information from
 5226 ** [protected sqlite3_value] objects.  Protected sqlite3_value objects
<a name="52" id="anc52"></a><span class="line-modified"> 5227 ** are used to pass parameter information into the functions that</span>
<span class="line-modified"> 5228 ** implement [application-defined SQL functions] and [virtual tables].</span>
 5229 **
 5230 ** These routines work only with [protected sqlite3_value] objects.
 5231 ** Any attempt to use these routines on an [unprotected sqlite3_value]
 5232 ** is not threadsafe.
 5233 **
 5234 ** ^These routines work just like the corresponding [column access functions]
 5235 ** except that these routines take a single [protected sqlite3_value] object
 5236 ** pointer instead of a [sqlite3_stmt*] pointer and an integer column number.
 5237 **
 5238 ** ^The sqlite3_value_text16() interface extracts a UTF-16 string
 5239 ** in the native byte-order of the host machine.  ^The
 5240 ** sqlite3_value_text16be() and sqlite3_value_text16le() interfaces
 5241 ** extract UTF-16 strings as big-endian and little-endian respectively.
 5242 **
 5243 ** ^If [sqlite3_value] object V was initialized
 5244 ** using [sqlite3_bind_pointer(S,I,P,X,D)] or [sqlite3_result_pointer(C,P,X,D)]
 5245 ** and if X and Y are strings that compare equal according to strcmp(X,Y),
 5246 ** then sqlite3_value_pointer(V,Y) will return the pointer P.  ^Otherwise,
 5247 ** sqlite3_value_pointer(V,Y) returns a NULL. The sqlite3_bind_pointer()
 5248 ** routine is part of the [pointer passing interface] added for SQLite 3.20.0.
 5249 **
 5250 ** ^(The sqlite3_value_type(V) interface returns the
 5251 ** [SQLITE_INTEGER | datatype code] for the initial datatype of the
 5252 ** [sqlite3_value] object V. The returned value is one of [SQLITE_INTEGER],
 5253 ** [SQLITE_FLOAT], [SQLITE_TEXT], [SQLITE_BLOB], or [SQLITE_NULL].)^
 5254 ** Other interfaces might change the datatype for an sqlite3_value object.
 5255 ** For example, if the datatype is initially SQLITE_INTEGER and
 5256 ** sqlite3_value_text(V) is called to extract a text value for that
 5257 ** integer, then subsequent calls to sqlite3_value_type(V) might return
 5258 ** SQLITE_TEXT.  Whether or not a persistent internal datatype conversion
 5259 ** occurs is undefined and may change from one release of SQLite to the next.
 5260 **
 5261 ** ^(The sqlite3_value_numeric_type() interface attempts to apply
 5262 ** numeric affinity to the value.  This means that an attempt is
 5263 ** made to convert the value to an integer or floating point.  If
 5264 ** such a conversion is possible without loss of information (in other
 5265 ** words, if the value is a string that looks like a number)
 5266 ** then the conversion is performed.  Otherwise no conversion occurs.
 5267 ** The [SQLITE_INTEGER | datatype] after conversion is returned.)^
 5268 **
 5269 ** ^Within the [xUpdate] method of a [virtual table], the
 5270 ** sqlite3_value_nochange(X) interface returns true if and only if
 5271 ** the column corresponding to X is unchanged by the UPDATE operation
 5272 ** that the xUpdate method call was invoked to implement and if
 5273 ** and the prior [xColumn] method call that was invoked to extracted
 5274 ** the value for that column returned without setting a result (probably
 5275 ** because it queried [sqlite3_vtab_nochange()] and found that the column
 5276 ** was unchanging).  ^Within an [xUpdate] method, any value for which
 5277 ** sqlite3_value_nochange(X) is true will in all other respects appear
 5278 ** to be a NULL value.  If sqlite3_value_nochange(X) is invoked anywhere other
 5279 ** than within an [xUpdate] method call for an UPDATE statement, then
 5280 ** the return value is arbitrary and meaningless.
 5281 **
 5282 ** ^The sqlite3_value_frombind(X) interface returns non-zero if the
 5283 ** value X originated from one of the [sqlite3_bind_int|sqlite3_bind()]
 5284 ** interfaces.  ^If X comes from an SQL literal value, or a table column,
<a name="53" id="anc53"></a><span class="line-modified"> 5285 ** or an expression, then sqlite3_value_frombind(X) returns zero.</span>
 5286 **
 5287 ** Please pay particular attention to the fact that the pointer returned
 5288 ** from [sqlite3_value_blob()], [sqlite3_value_text()], or
 5289 ** [sqlite3_value_text16()] can be invalidated by a subsequent call to
 5290 ** [sqlite3_value_bytes()], [sqlite3_value_bytes16()], [sqlite3_value_text()],
 5291 ** or [sqlite3_value_text16()].
 5292 **
 5293 ** These routines must be called from the same thread as
 5294 ** the SQL function that supplied the [sqlite3_value*] parameters.
 5295 **
 5296 ** As long as the input parameter is correct, these routines can only
 5297 ** fail if an out-of-memory error occurs during a format conversion.
 5298 ** Only the following subset of interfaces are subject to out-of-memory
 5299 ** errors:
 5300 **
 5301 ** &lt;ul&gt;
 5302 ** &lt;li&gt; sqlite3_value_blob()
 5303 ** &lt;li&gt; sqlite3_value_text()
 5304 ** &lt;li&gt; sqlite3_value_text16()
 5305 ** &lt;li&gt; sqlite3_value_text16le()
 5306 ** &lt;li&gt; sqlite3_value_text16be()
 5307 ** &lt;li&gt; sqlite3_value_bytes()
 5308 ** &lt;li&gt; sqlite3_value_bytes16()
 5309 ** &lt;/ul&gt;
 5310 **
 5311 ** If an out-of-memory error occurs, then the return value from these
 5312 ** routines is the same as if the column had contained an SQL NULL value.
 5313 ** Valid SQL NULL returns can be distinguished from out-of-memory errors
 5314 ** by invoking the [sqlite3_errcode()] immediately after the suspect
 5315 ** return value is obtained and before any
 5316 ** other SQLite interface is called on the same [database connection].
 5317 */
 5318 SQLITE_API const void *sqlite3_value_blob(sqlite3_value*);
 5319 SQLITE_API double sqlite3_value_double(sqlite3_value*);
 5320 SQLITE_API int sqlite3_value_int(sqlite3_value*);
 5321 SQLITE_API sqlite3_int64 sqlite3_value_int64(sqlite3_value*);
 5322 SQLITE_API void *sqlite3_value_pointer(sqlite3_value*, const char*);
 5323 SQLITE_API const unsigned char *sqlite3_value_text(sqlite3_value*);
 5324 SQLITE_API const void *sqlite3_value_text16(sqlite3_value*);
 5325 SQLITE_API const void *sqlite3_value_text16le(sqlite3_value*);
 5326 SQLITE_API const void *sqlite3_value_text16be(sqlite3_value*);
 5327 SQLITE_API int sqlite3_value_bytes(sqlite3_value*);
 5328 SQLITE_API int sqlite3_value_bytes16(sqlite3_value*);
 5329 SQLITE_API int sqlite3_value_type(sqlite3_value*);
 5330 SQLITE_API int sqlite3_value_numeric_type(sqlite3_value*);
 5331 SQLITE_API int sqlite3_value_nochange(sqlite3_value*);
 5332 SQLITE_API int sqlite3_value_frombind(sqlite3_value*);
 5333 
 5334 /*
 5335 ** CAPI3REF: Finding The Subtype Of SQL Values
 5336 ** METHOD: sqlite3_value
 5337 **
 5338 ** The sqlite3_value_subtype(V) function returns the subtype for
 5339 ** an [application-defined SQL function] argument V.  The subtype
 5340 ** information can be used to pass a limited amount of context from
 5341 ** one SQL function to another.  Use the [sqlite3_result_subtype()]
 5342 ** routine to set the subtype for the return value of an SQL function.
 5343 */
 5344 SQLITE_API unsigned int sqlite3_value_subtype(sqlite3_value*);
 5345 
 5346 /*
 5347 ** CAPI3REF: Copy And Free SQL Values
 5348 ** METHOD: sqlite3_value
 5349 **
 5350 ** ^The sqlite3_value_dup(V) interface makes a copy of the [sqlite3_value]
 5351 ** object D and returns a pointer to that copy.  ^The [sqlite3_value] returned
 5352 ** is a [protected sqlite3_value] object even if the input is not.
 5353 ** ^The sqlite3_value_dup(V) interface returns NULL if V is NULL or if a
 5354 ** memory allocation fails.
 5355 **
 5356 ** ^The sqlite3_value_free(V) interface frees an [sqlite3_value] object
 5357 ** previously obtained from [sqlite3_value_dup()].  ^If V is a NULL pointer
 5358 ** then sqlite3_value_free(V) is a harmless no-op.
 5359 */
 5360 SQLITE_API sqlite3_value *sqlite3_value_dup(const sqlite3_value*);
 5361 SQLITE_API void sqlite3_value_free(sqlite3_value*);
 5362 
 5363 /*
 5364 ** CAPI3REF: Obtain Aggregate Function Context
 5365 ** METHOD: sqlite3_context
 5366 **
 5367 ** Implementations of aggregate SQL functions use this
 5368 ** routine to allocate memory for storing their state.
 5369 **
 5370 ** ^The first time the sqlite3_aggregate_context(C,N) routine is called
<a name="54" id="anc54"></a><span class="line-modified"> 5371 ** for a particular aggregate function, SQLite allocates</span>
<span class="line-modified"> 5372 ** N bytes of memory, zeroes out that memory, and returns a pointer</span>
 5373 ** to the new memory. ^On second and subsequent calls to
 5374 ** sqlite3_aggregate_context() for the same aggregate function instance,
 5375 ** the same buffer is returned.  Sqlite3_aggregate_context() is normally
 5376 ** called once for each invocation of the xStep callback and then one
 5377 ** last time when the xFinal callback is invoked.  ^(When no rows match
 5378 ** an aggregate query, the xStep() callback of the aggregate function
 5379 ** implementation is never called and xFinal() is called exactly once.
 5380 ** In those cases, sqlite3_aggregate_context() might be called for the
 5381 ** first time from within xFinal().)^
 5382 **
 5383 ** ^The sqlite3_aggregate_context(C,N) routine returns a NULL pointer
 5384 ** when first called if N is less than or equal to zero or if a memory
 5385 ** allocate error occurs.
 5386 **
 5387 ** ^(The amount of space allocated by sqlite3_aggregate_context(C,N) is
 5388 ** determined by the N parameter on first successful call.  Changing the
<a name="55" id="anc55"></a><span class="line-modified"> 5389 ** value of N in any subsequents call to sqlite3_aggregate_context() within</span>
 5390 ** the same aggregate function instance will not resize the memory
 5391 ** allocation.)^  Within the xFinal callback, it is customary to set
 5392 ** N=0 in calls to sqlite3_aggregate_context(C,N) so that no
 5393 ** pointless memory allocations occur.
 5394 **
 5395 ** ^SQLite automatically frees the memory allocated by
 5396 ** sqlite3_aggregate_context() when the aggregate query concludes.
 5397 **
 5398 ** The first parameter must be a copy of the
 5399 ** [sqlite3_context | SQL function context] that is the first parameter
 5400 ** to the xStep or xFinal callback routine that implements the aggregate
 5401 ** function.
 5402 **
 5403 ** This routine must be called from the same thread in which
 5404 ** the aggregate SQL function is running.
 5405 */
 5406 SQLITE_API void *sqlite3_aggregate_context(sqlite3_context*, int nBytes);
 5407 
 5408 /*
 5409 ** CAPI3REF: User Data For Functions
 5410 ** METHOD: sqlite3_context
 5411 **
 5412 ** ^The sqlite3_user_data() interface returns a copy of
 5413 ** the pointer that was the pUserData parameter (the 5th parameter)
 5414 ** of the [sqlite3_create_function()]
 5415 ** and [sqlite3_create_function16()] routines that originally
 5416 ** registered the application defined function.
 5417 **
 5418 ** This routine must be called from the same thread in which
 5419 ** the application-defined function is running.
 5420 */
 5421 SQLITE_API void *sqlite3_user_data(sqlite3_context*);
 5422 
 5423 /*
 5424 ** CAPI3REF: Database Connection For Functions
 5425 ** METHOD: sqlite3_context
 5426 **
 5427 ** ^The sqlite3_context_db_handle() interface returns a copy of
 5428 ** the pointer to the [database connection] (the 1st parameter)
 5429 ** of the [sqlite3_create_function()]
 5430 ** and [sqlite3_create_function16()] routines that originally
 5431 ** registered the application defined function.
 5432 */
 5433 SQLITE_API sqlite3 *sqlite3_context_db_handle(sqlite3_context*);
 5434 
 5435 /*
 5436 ** CAPI3REF: Function Auxiliary Data
 5437 ** METHOD: sqlite3_context
 5438 **
 5439 ** These functions may be used by (non-aggregate) SQL functions to
 5440 ** associate metadata with argument values. If the same value is passed to
 5441 ** multiple invocations of the same SQL function during query execution, under
 5442 ** some circumstances the associated metadata may be preserved.  An example
 5443 ** of where this might be useful is in a regular-expression matching
 5444 ** function. The compiled version of the regular expression can be stored as
 5445 ** metadata associated with the pattern string.
 5446 ** Then as long as the pattern string remains the same,
 5447 ** the compiled regular expression can be reused on multiple
 5448 ** invocations of the same function.
 5449 **
 5450 ** ^The sqlite3_get_auxdata(C,N) interface returns a pointer to the metadata
 5451 ** associated by the sqlite3_set_auxdata(C,N,P,X) function with the Nth argument
 5452 ** value to the application-defined function.  ^N is zero for the left-most
 5453 ** function argument.  ^If there is no metadata
 5454 ** associated with the function argument, the sqlite3_get_auxdata(C,N) interface
 5455 ** returns a NULL pointer.
 5456 **
 5457 ** ^The sqlite3_set_auxdata(C,N,P,X) interface saves P as metadata for the N-th
 5458 ** argument of the application-defined function.  ^Subsequent
 5459 ** calls to sqlite3_get_auxdata(C,N) return P from the most recent
 5460 ** sqlite3_set_auxdata(C,N,P,X) call if the metadata is still valid or
 5461 ** NULL if the metadata has been discarded.
 5462 ** ^After each call to sqlite3_set_auxdata(C,N,P,X) where X is not NULL,
 5463 ** SQLite will invoke the destructor function X with parameter P exactly
 5464 ** once, when the metadata is discarded.
 5465 ** SQLite is free to discard the metadata at any time, including: &lt;ul&gt;
 5466 ** &lt;li&gt; ^(when the corresponding function parameter changes)^, or
 5467 ** &lt;li&gt; ^(when [sqlite3_reset()] or [sqlite3_finalize()] is called for the
 5468 **      SQL statement)^, or
 5469 ** &lt;li&gt; ^(when sqlite3_set_auxdata() is invoked again on the same
 5470 **       parameter)^, or
 5471 ** &lt;li&gt; ^(during the original sqlite3_set_auxdata() call when a memory
 5472 **      allocation error occurs.)^ &lt;/ul&gt;
 5473 **
 5474 ** Note the last bullet in particular.  The destructor X in
 5475 ** sqlite3_set_auxdata(C,N,P,X) might be called immediately, before the
 5476 ** sqlite3_set_auxdata() interface even returns.  Hence sqlite3_set_auxdata()
 5477 ** should be called near the end of the function implementation and the
 5478 ** function implementation should not make any use of P after
 5479 ** sqlite3_set_auxdata() has been called.
 5480 **
 5481 ** ^(In practice, metadata is preserved between function calls for
 5482 ** function parameters that are compile-time constants, including literal
 5483 ** values and [parameters] and expressions composed from the same.)^
 5484 **
 5485 ** The value of the N parameter to these interfaces should be non-negative.
 5486 ** Future enhancements may make use of negative N values to define new
 5487 ** kinds of function caching behavior.
 5488 **
 5489 ** These routines must be called from the same thread in which
 5490 ** the SQL function is running.
 5491 */
 5492 SQLITE_API void *sqlite3_get_auxdata(sqlite3_context*, int N);
 5493 SQLITE_API void sqlite3_set_auxdata(sqlite3_context*, int N, void*, void (*)(void*));
 5494 
 5495 
 5496 /*
 5497 ** CAPI3REF: Constants Defining Special Destructor Behavior
 5498 **
 5499 ** These are special values for the destructor that is passed in as the
 5500 ** final argument to routines like [sqlite3_result_blob()].  ^If the destructor
 5501 ** argument is SQLITE_STATIC, it means that the content pointer is constant
 5502 ** and will never change.  It does not need to be destroyed.  ^The
 5503 ** SQLITE_TRANSIENT value means that the content will likely change in
 5504 ** the near future and that SQLite should make its own private copy of
 5505 ** the content before returning.
 5506 **
 5507 ** The typedef is necessary to work around problems in certain
 5508 ** C++ compilers.
 5509 */
 5510 typedef void (*sqlite3_destructor_type)(void*);
 5511 #define SQLITE_STATIC      ((sqlite3_destructor_type)0)
 5512 #define SQLITE_TRANSIENT   ((sqlite3_destructor_type)-1)
 5513 
 5514 /*
 5515 ** CAPI3REF: Setting The Result Of An SQL Function
 5516 ** METHOD: sqlite3_context
 5517 **
 5518 ** These routines are used by the xFunc or xFinal callbacks that
 5519 ** implement SQL functions and aggregates.  See
 5520 ** [sqlite3_create_function()] and [sqlite3_create_function16()]
 5521 ** for additional information.
 5522 **
 5523 ** These functions work very much like the [parameter binding] family of
 5524 ** functions used to bind values to host parameters in prepared statements.
 5525 ** Refer to the [SQL parameter] documentation for additional information.
 5526 **
 5527 ** ^The sqlite3_result_blob() interface sets the result from
 5528 ** an application-defined function to be the BLOB whose content is pointed
 5529 ** to by the second parameter and which is N bytes long where N is the
 5530 ** third parameter.
 5531 **
 5532 ** ^The sqlite3_result_zeroblob(C,N) and sqlite3_result_zeroblob64(C,N)
 5533 ** interfaces set the result of the application-defined function to be
 5534 ** a BLOB containing all zero bytes and N bytes in size.
 5535 **
 5536 ** ^The sqlite3_result_double() interface sets the result from
 5537 ** an application-defined function to be a floating point value specified
 5538 ** by its 2nd argument.
 5539 **
 5540 ** ^The sqlite3_result_error() and sqlite3_result_error16() functions
 5541 ** cause the implemented SQL function to throw an exception.
 5542 ** ^SQLite uses the string pointed to by the
 5543 ** 2nd parameter of sqlite3_result_error() or sqlite3_result_error16()
 5544 ** as the text of an error message.  ^SQLite interprets the error
 5545 ** message string from sqlite3_result_error() as UTF-8. ^SQLite
 5546 ** interprets the string from sqlite3_result_error16() as UTF-16 in native
 5547 ** byte order.  ^If the third parameter to sqlite3_result_error()
 5548 ** or sqlite3_result_error16() is negative then SQLite takes as the error
 5549 ** message all text up through the first zero character.
 5550 ** ^If the third parameter to sqlite3_result_error() or
 5551 ** sqlite3_result_error16() is non-negative then SQLite takes that many
 5552 ** bytes (not characters) from the 2nd parameter as the error message.
 5553 ** ^The sqlite3_result_error() and sqlite3_result_error16()
 5554 ** routines make a private copy of the error message text before
 5555 ** they return.  Hence, the calling function can deallocate or
 5556 ** modify the text after they return without harm.
 5557 ** ^The sqlite3_result_error_code() function changes the error code
 5558 ** returned by SQLite as a result of an error in a function.  ^By default,
 5559 ** the error code is SQLITE_ERROR.  ^A subsequent call to sqlite3_result_error()
 5560 ** or sqlite3_result_error16() resets the error code to SQLITE_ERROR.
 5561 **
 5562 ** ^The sqlite3_result_error_toobig() interface causes SQLite to throw an
 5563 ** error indicating that a string or BLOB is too long to represent.
 5564 **
 5565 ** ^The sqlite3_result_error_nomem() interface causes SQLite to throw an
 5566 ** error indicating that a memory allocation failed.
 5567 **
 5568 ** ^The sqlite3_result_int() interface sets the return value
 5569 ** of the application-defined function to be the 32-bit signed integer
 5570 ** value given in the 2nd argument.
 5571 ** ^The sqlite3_result_int64() interface sets the return value
 5572 ** of the application-defined function to be the 64-bit signed integer
 5573 ** value given in the 2nd argument.
 5574 **
 5575 ** ^The sqlite3_result_null() interface sets the return value
 5576 ** of the application-defined function to be NULL.
 5577 **
 5578 ** ^The sqlite3_result_text(), sqlite3_result_text16(),
 5579 ** sqlite3_result_text16le(), and sqlite3_result_text16be() interfaces
 5580 ** set the return value of the application-defined function to be
 5581 ** a text string which is represented as UTF-8, UTF-16 native byte order,
 5582 ** UTF-16 little endian, or UTF-16 big endian, respectively.
 5583 ** ^The sqlite3_result_text64() interface sets the return value of an
 5584 ** application-defined function to be a text string in an encoding
 5585 ** specified by the fifth (and last) parameter, which must be one
 5586 ** of [SQLITE_UTF8], [SQLITE_UTF16], [SQLITE_UTF16BE], or [SQLITE_UTF16LE].
 5587 ** ^SQLite takes the text result from the application from
 5588 ** the 2nd parameter of the sqlite3_result_text* interfaces.
 5589 ** ^If the 3rd parameter to the sqlite3_result_text* interfaces
 5590 ** is negative, then SQLite takes result text from the 2nd parameter
 5591 ** through the first zero character.
 5592 ** ^If the 3rd parameter to the sqlite3_result_text* interfaces
 5593 ** is non-negative, then as many bytes (not characters) of the text
 5594 ** pointed to by the 2nd parameter are taken as the application-defined
 5595 ** function result.  If the 3rd parameter is non-negative, then it
 5596 ** must be the byte offset into the string where the NUL terminator would
 5597 ** appear if the string where NUL terminated.  If any NUL characters occur
 5598 ** in the string at a byte offset that is less than the value of the 3rd
 5599 ** parameter, then the resulting string will contain embedded NULs and the
 5600 ** result of expressions operating on strings with embedded NULs is undefined.
 5601 ** ^If the 4th parameter to the sqlite3_result_text* interfaces
 5602 ** or sqlite3_result_blob is a non-NULL pointer, then SQLite calls that
 5603 ** function as the destructor on the text or BLOB result when it has
 5604 ** finished using that result.
 5605 ** ^If the 4th parameter to the sqlite3_result_text* interfaces or to
 5606 ** sqlite3_result_blob is the special constant SQLITE_STATIC, then SQLite
 5607 ** assumes that the text or BLOB result is in constant space and does not
 5608 ** copy the content of the parameter nor call a destructor on the content
 5609 ** when it has finished using that result.
 5610 ** ^If the 4th parameter to the sqlite3_result_text* interfaces
 5611 ** or sqlite3_result_blob is the special constant SQLITE_TRANSIENT
 5612 ** then SQLite makes a copy of the result into space obtained
 5613 ** from [sqlite3_malloc()] before it returns.
 5614 **
 5615 ** ^The sqlite3_result_value() interface sets the result of
 5616 ** the application-defined function to be a copy of the
 5617 ** [unprotected sqlite3_value] object specified by the 2nd parameter.  ^The
 5618 ** sqlite3_result_value() interface makes a copy of the [sqlite3_value]
 5619 ** so that the [sqlite3_value] specified in the parameter may change or
 5620 ** be deallocated after sqlite3_result_value() returns without harm.
 5621 ** ^A [protected sqlite3_value] object may always be used where an
 5622 ** [unprotected sqlite3_value] object is required, so either
 5623 ** kind of [sqlite3_value] object can be used with this interface.
 5624 **
 5625 ** ^The sqlite3_result_pointer(C,P,T,D) interface sets the result to an
 5626 ** SQL NULL value, just like [sqlite3_result_null(C)], except that it
 5627 ** also associates the host-language pointer P or type T with that
 5628 ** NULL value such that the pointer can be retrieved within an
 5629 ** [application-defined SQL function] using [sqlite3_value_pointer()].
 5630 ** ^If the D parameter is not NULL, then it is a pointer to a destructor
 5631 ** for the P parameter.  ^SQLite invokes D with P as its only argument
 5632 ** when SQLite is finished with P.  The T parameter should be a static
 5633 ** string and preferably a string literal. The sqlite3_result_pointer()
 5634 ** routine is part of the [pointer passing interface] added for SQLite 3.20.0.
 5635 **
 5636 ** If these routines are called from within the different thread
 5637 ** than the one containing the application-defined function that received
 5638 ** the [sqlite3_context] pointer, the results are undefined.
 5639 */
 5640 SQLITE_API void sqlite3_result_blob(sqlite3_context*, const void*, int, void(*)(void*));
 5641 SQLITE_API void sqlite3_result_blob64(sqlite3_context*,const void*,
 5642                            sqlite3_uint64,void(*)(void*));
 5643 SQLITE_API void sqlite3_result_double(sqlite3_context*, double);
 5644 SQLITE_API void sqlite3_result_error(sqlite3_context*, const char*, int);
 5645 SQLITE_API void sqlite3_result_error16(sqlite3_context*, const void*, int);
 5646 SQLITE_API void sqlite3_result_error_toobig(sqlite3_context*);
 5647 SQLITE_API void sqlite3_result_error_nomem(sqlite3_context*);
 5648 SQLITE_API void sqlite3_result_error_code(sqlite3_context*, int);
 5649 SQLITE_API void sqlite3_result_int(sqlite3_context*, int);
 5650 SQLITE_API void sqlite3_result_int64(sqlite3_context*, sqlite3_int64);
 5651 SQLITE_API void sqlite3_result_null(sqlite3_context*);
 5652 SQLITE_API void sqlite3_result_text(sqlite3_context*, const char*, int, void(*)(void*));
 5653 SQLITE_API void sqlite3_result_text64(sqlite3_context*, const char*,sqlite3_uint64,
 5654                            void(*)(void*), unsigned char encoding);
 5655 SQLITE_API void sqlite3_result_text16(sqlite3_context*, const void*, int, void(*)(void*));
 5656 SQLITE_API void sqlite3_result_text16le(sqlite3_context*, const void*, int,void(*)(void*));
 5657 SQLITE_API void sqlite3_result_text16be(sqlite3_context*, const void*, int,void(*)(void*));
 5658 SQLITE_API void sqlite3_result_value(sqlite3_context*, sqlite3_value*);
 5659 SQLITE_API void sqlite3_result_pointer(sqlite3_context*, void*,const char*,void(*)(void*));
 5660 SQLITE_API void sqlite3_result_zeroblob(sqlite3_context*, int n);
 5661 SQLITE_API int sqlite3_result_zeroblob64(sqlite3_context*, sqlite3_uint64 n);
 5662 
 5663 
 5664 /*
 5665 ** CAPI3REF: Setting The Subtype Of An SQL Function
 5666 ** METHOD: sqlite3_context
 5667 **
 5668 ** The sqlite3_result_subtype(C,T) function causes the subtype of
 5669 ** the result from the [application-defined SQL function] with
 5670 ** [sqlite3_context] C to be the value T.  Only the lower 8 bits
 5671 ** of the subtype T are preserved in current versions of SQLite;
 5672 ** higher order bits are discarded.
 5673 ** The number of subtype bytes preserved by SQLite might increase
 5674 ** in future releases of SQLite.
 5675 */
 5676 SQLITE_API void sqlite3_result_subtype(sqlite3_context*,unsigned int);
 5677 
 5678 /*
 5679 ** CAPI3REF: Define New Collating Sequences
 5680 ** METHOD: sqlite3
 5681 **
 5682 ** ^These functions add, remove, or modify a [collation] associated
 5683 ** with the [database connection] specified as the first argument.
 5684 **
 5685 ** ^The name of the collation is a UTF-8 string
 5686 ** for sqlite3_create_collation() and sqlite3_create_collation_v2()
 5687 ** and a UTF-16 string in native byte order for sqlite3_create_collation16().
 5688 ** ^Collation names that compare equal according to [sqlite3_strnicmp()] are
 5689 ** considered to be the same name.
 5690 **
 5691 ** ^(The third argument (eTextRep) must be one of the constants:
 5692 ** &lt;ul&gt;
 5693 ** &lt;li&gt; [SQLITE_UTF8],
 5694 ** &lt;li&gt; [SQLITE_UTF16LE],
 5695 ** &lt;li&gt; [SQLITE_UTF16BE],
 5696 ** &lt;li&gt; [SQLITE_UTF16], or
 5697 ** &lt;li&gt; [SQLITE_UTF16_ALIGNED].
 5698 ** &lt;/ul&gt;)^
 5699 ** ^The eTextRep argument determines the encoding of strings passed
<a name="56" id="anc56"></a><span class="line-modified"> 5700 ** to the collating function callback, xCompare.</span>
 5701 ** ^The [SQLITE_UTF16] and [SQLITE_UTF16_ALIGNED] values for eTextRep
 5702 ** force strings to be UTF16 with native byte order.
 5703 ** ^The [SQLITE_UTF16_ALIGNED] value for eTextRep forces strings to begin
 5704 ** on an even byte address.
 5705 **
 5706 ** ^The fourth argument, pArg, is an application data pointer that is passed
 5707 ** through as the first argument to the collating function callback.
 5708 **
<a name="57" id="anc57"></a><span class="line-modified"> 5709 ** ^The fifth argument, xCompare, is a pointer to the collating function.</span>
 5710 ** ^Multiple collating functions can be registered using the same name but
 5711 ** with different eTextRep parameters and SQLite will use whichever
 5712 ** function requires the least amount of data transformation.
<a name="58" id="anc58"></a><span class="line-modified"> 5713 ** ^If the xCompare argument is NULL then the collating function is</span>
 5714 ** deleted.  ^When all collating functions having the same name are deleted,
 5715 ** that collation is no longer usable.
 5716 **
 5717 ** ^The collating function callback is invoked with a copy of the pArg
 5718 ** application data pointer and with two strings in the encoding specified
<a name="59" id="anc59"></a><span class="line-modified"> 5719 ** by the eTextRep argument.  The two integer parameters to the collating</span>
<span class="line-modified"> 5720 ** function callback are the length of the two strings, in bytes. The collating</span>
<span class="line-added"> 5721 ** function must return an integer that is negative, zero, or positive</span>
 5722 ** if the first string is less than, equal to, or greater than the second,
 5723 ** respectively.  A collating function must always return the same answer
 5724 ** given the same inputs.  If two or more collating functions are registered
 5725 ** to the same collation name (using different eTextRep values) then all
 5726 ** must give an equivalent answer when invoked with equivalent strings.
 5727 ** The collating function must obey the following properties for all
 5728 ** strings A, B, and C:
 5729 **
 5730 ** &lt;ol&gt;
 5731 ** &lt;li&gt; If A==B then B==A.
 5732 ** &lt;li&gt; If A==B and B==C then A==C.
 5733 ** &lt;li&gt; If A&amp;lt;B THEN B&amp;gt;A.
 5734 ** &lt;li&gt; If A&amp;lt;B and B&amp;lt;C then A&amp;lt;C.
 5735 ** &lt;/ol&gt;
 5736 **
 5737 ** If a collating function fails any of the above constraints and that
<a name="60" id="anc60"></a><span class="line-modified"> 5738 ** collating function is registered and used, then the behavior of SQLite</span>
 5739 ** is undefined.
 5740 **
 5741 ** ^The sqlite3_create_collation_v2() works like sqlite3_create_collation()
 5742 ** with the addition that the xDestroy callback is invoked on pArg when
 5743 ** the collating function is deleted.
 5744 ** ^Collating functions are deleted when they are overridden by later
 5745 ** calls to the collation creation functions or when the
 5746 ** [database connection] is closed using [sqlite3_close()].
 5747 **
 5748 ** ^The xDestroy callback is &lt;u&gt;not&lt;/u&gt; called if the
 5749 ** sqlite3_create_collation_v2() function fails.  Applications that invoke
 5750 ** sqlite3_create_collation_v2() with a non-NULL xDestroy argument should
 5751 ** check the return code and dispose of the application data pointer
 5752 ** themselves rather than expecting SQLite to deal with it for them.
 5753 ** This is different from every other SQLite interface.  The inconsistency
 5754 ** is unfortunate but cannot be changed without breaking backwards
 5755 ** compatibility.
 5756 **
 5757 ** See also:  [sqlite3_collation_needed()] and [sqlite3_collation_needed16()].
 5758 */
 5759 SQLITE_API int sqlite3_create_collation(
 5760   sqlite3*,
 5761   const char *zName,
 5762   int eTextRep,
 5763   void *pArg,
 5764   int(*xCompare)(void*,int,const void*,int,const void*)
 5765 );
 5766 SQLITE_API int sqlite3_create_collation_v2(
 5767   sqlite3*,
 5768   const char *zName,
 5769   int eTextRep,
 5770   void *pArg,
 5771   int(*xCompare)(void*,int,const void*,int,const void*),
 5772   void(*xDestroy)(void*)
 5773 );
 5774 SQLITE_API int sqlite3_create_collation16(
 5775   sqlite3*,
 5776   const void *zName,
 5777   int eTextRep,
 5778   void *pArg,
 5779   int(*xCompare)(void*,int,const void*,int,const void*)
 5780 );
 5781 
 5782 /*
 5783 ** CAPI3REF: Collation Needed Callbacks
 5784 ** METHOD: sqlite3
 5785 **
 5786 ** ^To avoid having to register all collation sequences before a database
 5787 ** can be used, a single callback function may be registered with the
 5788 ** [database connection] to be invoked whenever an undefined collation
 5789 ** sequence is required.
 5790 **
 5791 ** ^If the function is registered using the sqlite3_collation_needed() API,
 5792 ** then it is passed the names of undefined collation sequences as strings
 5793 ** encoded in UTF-8. ^If sqlite3_collation_needed16() is used,
 5794 ** the names are passed as UTF-16 in machine native byte order.
 5795 ** ^A call to either function replaces the existing collation-needed callback.
 5796 **
 5797 ** ^(When the callback is invoked, the first argument passed is a copy
 5798 ** of the second argument to sqlite3_collation_needed() or
 5799 ** sqlite3_collation_needed16().  The second argument is the database
 5800 ** connection.  The third argument is one of [SQLITE_UTF8], [SQLITE_UTF16BE],
 5801 ** or [SQLITE_UTF16LE], indicating the most desirable form of the collation
 5802 ** sequence function required.  The fourth parameter is the name of the
 5803 ** required collation sequence.)^
 5804 **
 5805 ** The callback function should register the desired collation using
 5806 ** [sqlite3_create_collation()], [sqlite3_create_collation16()], or
 5807 ** [sqlite3_create_collation_v2()].
 5808 */
 5809 SQLITE_API int sqlite3_collation_needed(
 5810   sqlite3*,
 5811   void*,
 5812   void(*)(void*,sqlite3*,int eTextRep,const char*)
 5813 );
 5814 SQLITE_API int sqlite3_collation_needed16(
 5815   sqlite3*,
 5816   void*,
 5817   void(*)(void*,sqlite3*,int eTextRep,const void*)
 5818 );
 5819 
 5820 #ifdef SQLITE_HAS_CODEC
 5821 /*
 5822 ** Specify the key for an encrypted database.  This routine should be
 5823 ** called right after sqlite3_open().
 5824 **
 5825 ** The code to implement this API is not available in the public release
 5826 ** of SQLite.
 5827 */
 5828 SQLITE_API int sqlite3_key(
 5829   sqlite3 *db,                   /* Database to be rekeyed */
 5830   const void *pKey, int nKey     /* The key */
 5831 );
 5832 SQLITE_API int sqlite3_key_v2(
 5833   sqlite3 *db,                   /* Database to be rekeyed */
 5834   const char *zDbName,           /* Name of the database */
 5835   const void *pKey, int nKey     /* The key */
 5836 );
 5837 
 5838 /*
 5839 ** Change the key on an open database.  If the current database is not
 5840 ** encrypted, this routine will encrypt it.  If pNew==0 or nNew==0, the
 5841 ** database is decrypted.
 5842 **
 5843 ** The code to implement this API is not available in the public release
 5844 ** of SQLite.
 5845 */
 5846 SQLITE_API int sqlite3_rekey(
 5847   sqlite3 *db,                   /* Database to be rekeyed */
 5848   const void *pKey, int nKey     /* The new key */
 5849 );
 5850 SQLITE_API int sqlite3_rekey_v2(
 5851   sqlite3 *db,                   /* Database to be rekeyed */
 5852   const char *zDbName,           /* Name of the database */
 5853   const void *pKey, int nKey     /* The new key */
 5854 );
 5855 
 5856 /*
 5857 ** Specify the activation key for a SEE database.  Unless
 5858 ** activated, none of the SEE routines will work.
 5859 */
 5860 SQLITE_API void sqlite3_activate_see(
 5861   const char *zPassPhrase        /* Activation phrase */
 5862 );
 5863 #endif
 5864 
 5865 #ifdef SQLITE_ENABLE_CEROD
 5866 /*
 5867 ** Specify the activation key for a CEROD database.  Unless
 5868 ** activated, none of the CEROD routines will work.
 5869 */
 5870 SQLITE_API void sqlite3_activate_cerod(
 5871   const char *zPassPhrase        /* Activation phrase */
 5872 );
 5873 #endif
 5874 
 5875 /*
 5876 ** CAPI3REF: Suspend Execution For A Short Time
 5877 **
 5878 ** The sqlite3_sleep() function causes the current thread to suspend execution
 5879 ** for at least a number of milliseconds specified in its parameter.
 5880 **
 5881 ** If the operating system does not support sleep requests with
 5882 ** millisecond time resolution, then the time will be rounded up to
 5883 ** the nearest second. The number of milliseconds of sleep actually
 5884 ** requested from the operating system is returned.
 5885 **
 5886 ** ^SQLite implements this interface by calling the xSleep()
 5887 ** method of the default [sqlite3_vfs] object.  If the xSleep() method
 5888 ** of the default VFS is not implemented correctly, or not implemented at
 5889 ** all, then the behavior of sqlite3_sleep() may deviate from the description
 5890 ** in the previous paragraphs.
 5891 */
 5892 SQLITE_API int sqlite3_sleep(int);
 5893 
 5894 /*
 5895 ** CAPI3REF: Name Of The Folder Holding Temporary Files
 5896 **
 5897 ** ^(If this global variable is made to point to a string which is
 5898 ** the name of a folder (a.k.a. directory), then all temporary files
 5899 ** created by SQLite when using a built-in [sqlite3_vfs | VFS]
 5900 ** will be placed in that directory.)^  ^If this variable
 5901 ** is a NULL pointer, then SQLite performs a search for an appropriate
 5902 ** temporary file directory.
 5903 **
 5904 ** Applications are strongly discouraged from using this global variable.
 5905 ** It is required to set a temporary folder on Windows Runtime (WinRT).
 5906 ** But for all other platforms, it is highly recommended that applications
 5907 ** neither read nor write this variable.  This global variable is a relic
 5908 ** that exists for backwards compatibility of legacy applications and should
 5909 ** be avoided in new projects.
 5910 **
 5911 ** It is not safe to read or modify this variable in more than one
 5912 ** thread at a time.  It is not safe to read or modify this variable
 5913 ** if a [database connection] is being used at the same time in a separate
 5914 ** thread.
 5915 ** It is intended that this variable be set once
 5916 ** as part of process initialization and before any SQLite interface
 5917 ** routines have been called and that this variable remain unchanged
 5918 ** thereafter.
 5919 **
 5920 ** ^The [temp_store_directory pragma] may modify this variable and cause
 5921 ** it to point to memory obtained from [sqlite3_malloc].  ^Furthermore,
 5922 ** the [temp_store_directory pragma] always assumes that any string
 5923 ** that this variable points to is held in memory obtained from
 5924 ** [sqlite3_malloc] and the pragma may attempt to free that memory
 5925 ** using [sqlite3_free].
 5926 ** Hence, if this variable is modified directly, either it should be
 5927 ** made NULL or made to point to memory obtained from [sqlite3_malloc]
 5928 ** or else the use of the [temp_store_directory pragma] should be avoided.
 5929 ** Except when requested by the [temp_store_directory pragma], SQLite
 5930 ** does not free the memory that sqlite3_temp_directory points to.  If
 5931 ** the application wants that memory to be freed, it must do
 5932 ** so itself, taking care to only do so after all [database connection]
 5933 ** objects have been destroyed.
 5934 **
 5935 ** &lt;b&gt;Note to Windows Runtime users:&lt;/b&gt;  The temporary directory must be set
 5936 ** prior to calling [sqlite3_open] or [sqlite3_open_v2].  Otherwise, various
 5937 ** features that require the use of temporary files may fail.  Here is an
 5938 ** example of how to do this using C++ with the Windows Runtime:
 5939 **
 5940 ** &lt;blockquote&gt;&lt;pre&gt;
 5941 ** LPCWSTR zPath = Windows::Storage::ApplicationData::Current-&gt;
 5942 ** &amp;nbsp;     TemporaryFolder-&gt;Path-&gt;Data();
 5943 ** char zPathBuf&amp;#91;MAX_PATH + 1&amp;#93;;
 5944 ** memset(zPathBuf, 0, sizeof(zPathBuf));
 5945 ** WideCharToMultiByte(CP_UTF8, 0, zPath, -1, zPathBuf, sizeof(zPathBuf),
 5946 ** &amp;nbsp;     NULL, NULL);
 5947 ** sqlite3_temp_directory = sqlite3_mprintf(&quot;%s&quot;, zPathBuf);
 5948 ** &lt;/pre&gt;&lt;/blockquote&gt;
 5949 */
 5950 SQLITE_API SQLITE_EXTERN char *sqlite3_temp_directory;
 5951 
 5952 /*
 5953 ** CAPI3REF: Name Of The Folder Holding Database Files
 5954 **
 5955 ** ^(If this global variable is made to point to a string which is
 5956 ** the name of a folder (a.k.a. directory), then all database files
 5957 ** specified with a relative pathname and created or accessed by
 5958 ** SQLite when using a built-in windows [sqlite3_vfs | VFS] will be assumed
 5959 ** to be relative to that directory.)^ ^If this variable is a NULL
 5960 ** pointer, then SQLite assumes that all database files specified
 5961 ** with a relative pathname are relative to the current directory
 5962 ** for the process.  Only the windows VFS makes use of this global
 5963 ** variable; it is ignored by the unix VFS.
 5964 **
 5965 ** Changing the value of this variable while a database connection is
 5966 ** open can result in a corrupt database.
 5967 **
 5968 ** It is not safe to read or modify this variable in more than one
 5969 ** thread at a time.  It is not safe to read or modify this variable
 5970 ** if a [database connection] is being used at the same time in a separate
 5971 ** thread.
 5972 ** It is intended that this variable be set once
 5973 ** as part of process initialization and before any SQLite interface
 5974 ** routines have been called and that this variable remain unchanged
 5975 ** thereafter.
 5976 **
 5977 ** ^The [data_store_directory pragma] may modify this variable and cause
 5978 ** it to point to memory obtained from [sqlite3_malloc].  ^Furthermore,
 5979 ** the [data_store_directory pragma] always assumes that any string
 5980 ** that this variable points to is held in memory obtained from
 5981 ** [sqlite3_malloc] and the pragma may attempt to free that memory
 5982 ** using [sqlite3_free].
 5983 ** Hence, if this variable is modified directly, either it should be
 5984 ** made NULL or made to point to memory obtained from [sqlite3_malloc]
 5985 ** or else the use of the [data_store_directory pragma] should be avoided.
 5986 */
 5987 SQLITE_API SQLITE_EXTERN char *sqlite3_data_directory;
 5988 
 5989 /*
 5990 ** CAPI3REF: Win32 Specific Interface
 5991 **
 5992 ** These interfaces are available only on Windows.  The
 5993 ** [sqlite3_win32_set_directory] interface is used to set the value associated
 5994 ** with the [sqlite3_temp_directory] or [sqlite3_data_directory] variable, to
 5995 ** zValue, depending on the value of the type parameter.  The zValue parameter
 5996 ** should be NULL to cause the previous value to be freed via [sqlite3_free];
 5997 ** a non-NULL value will be copied into memory obtained from [sqlite3_malloc]
 5998 ** prior to being used.  The [sqlite3_win32_set_directory] interface returns
 5999 ** [SQLITE_OK] to indicate success, [SQLITE_ERROR] if the type is unsupported,
 6000 ** or [SQLITE_NOMEM] if memory could not be allocated.  The value of the
 6001 ** [sqlite3_data_directory] variable is intended to act as a replacement for
 6002 ** the current directory on the sub-platforms of Win32 where that concept is
 6003 ** not present, e.g. WinRT and UWP.  The [sqlite3_win32_set_directory8] and
 6004 ** [sqlite3_win32_set_directory16] interfaces behave exactly the same as the
 6005 ** sqlite3_win32_set_directory interface except the string parameter must be
 6006 ** UTF-8 or UTF-16, respectively.
 6007 */
 6008 SQLITE_API int sqlite3_win32_set_directory(
 6009   unsigned long type, /* Identifier for directory being set or reset */
 6010   void *zValue        /* New value for directory being set or reset */
 6011 );
 6012 SQLITE_API int sqlite3_win32_set_directory8(unsigned long type, const char *zValue);
 6013 SQLITE_API int sqlite3_win32_set_directory16(unsigned long type, const void *zValue);
 6014 
 6015 /*
 6016 ** CAPI3REF: Win32 Directory Types
 6017 **
 6018 ** These macros are only available on Windows.  They define the allowed values
 6019 ** for the type argument to the [sqlite3_win32_set_directory] interface.
 6020 */
 6021 #define SQLITE_WIN32_DATA_DIRECTORY_TYPE  1
 6022 #define SQLITE_WIN32_TEMP_DIRECTORY_TYPE  2
 6023 
 6024 /*
 6025 ** CAPI3REF: Test For Auto-Commit Mode
 6026 ** KEYWORDS: {autocommit mode}
 6027 ** METHOD: sqlite3
 6028 **
 6029 ** ^The sqlite3_get_autocommit() interface returns non-zero or
 6030 ** zero if the given database connection is or is not in autocommit mode,
 6031 ** respectively.  ^Autocommit mode is on by default.
 6032 ** ^Autocommit mode is disabled by a [BEGIN] statement.
 6033 ** ^Autocommit mode is re-enabled by a [COMMIT] or [ROLLBACK].
 6034 **
 6035 ** If certain kinds of errors occur on a statement within a multi-statement
 6036 ** transaction (errors including [SQLITE_FULL], [SQLITE_IOERR],
 6037 ** [SQLITE_NOMEM], [SQLITE_BUSY], and [SQLITE_INTERRUPT]) then the
 6038 ** transaction might be rolled back automatically.  The only way to
 6039 ** find out whether SQLite automatically rolled back the transaction after
 6040 ** an error is to use this function.
 6041 **
 6042 ** If another thread changes the autocommit status of the database
 6043 ** connection while this routine is running, then the return value
 6044 ** is undefined.
 6045 */
 6046 SQLITE_API int sqlite3_get_autocommit(sqlite3*);
 6047 
 6048 /*
 6049 ** CAPI3REF: Find The Database Handle Of A Prepared Statement
 6050 ** METHOD: sqlite3_stmt
 6051 **
 6052 ** ^The sqlite3_db_handle interface returns the [database connection] handle
 6053 ** to which a [prepared statement] belongs.  ^The [database connection]
 6054 ** returned by sqlite3_db_handle is the same [database connection]
 6055 ** that was the first argument
 6056 ** to the [sqlite3_prepare_v2()] call (or its variants) that was used to
 6057 ** create the statement in the first place.
 6058 */
 6059 SQLITE_API sqlite3 *sqlite3_db_handle(sqlite3_stmt*);
 6060 
 6061 /*
 6062 ** CAPI3REF: Return The Filename For A Database Connection
 6063 ** METHOD: sqlite3
 6064 **
<a name="61" id="anc61"></a><span class="line-modified"> 6065 ** ^The sqlite3_db_filename(D,N) interface returns a pointer to the filename</span>
<span class="line-modified"> 6066 ** associated with database N of connection D.</span>
<span class="line-modified"> 6067 ** ^If there is no attached database N on the database</span>
 6068 ** connection D, or if database N is a temporary or in-memory database, then
 6069 ** this function will return either a NULL pointer or an empty string.
 6070 **
<a name="62" id="anc62"></a><span class="line-added"> 6071 ** ^The string value returned by this routine is owned and managed by</span>
<span class="line-added"> 6072 ** the database connection.  ^The value will be valid until the database N</span>
<span class="line-added"> 6073 ** is [DETACH]-ed or until the database connection closes.</span>
<span class="line-added"> 6074 **</span>
 6075 ** ^The filename returned by this function is the output of the
 6076 ** xFullPathname method of the [VFS].  ^In other words, the filename
 6077 ** will be an absolute pathname, even if the filename used
 6078 ** to open the database originally was a URI or relative pathname.
<a name="63" id="anc63"></a><span class="line-added"> 6079 **</span>
<span class="line-added"> 6080 ** If the filename pointer returned by this routine is not NULL, then it</span>
<span class="line-added"> 6081 ** can be used as the filename input parameter to these routines:</span>
<span class="line-added"> 6082 ** &lt;ul&gt;</span>
<span class="line-added"> 6083 ** &lt;li&gt; [sqlite3_uri_parameter()]</span>
<span class="line-added"> 6084 ** &lt;li&gt; [sqlite3_uri_boolean()]</span>
<span class="line-added"> 6085 ** &lt;li&gt; [sqlite3_uri_int64()]</span>
<span class="line-added"> 6086 ** &lt;li&gt; [sqlite3_filename_database()]</span>
<span class="line-added"> 6087 ** &lt;li&gt; [sqlite3_filename_journal()]</span>
<span class="line-added"> 6088 ** &lt;li&gt; [sqlite3_filename_wal()]</span>
<span class="line-added"> 6089 ** &lt;/ul&gt;</span>
 6090 */
 6091 SQLITE_API const char *sqlite3_db_filename(sqlite3 *db, const char *zDbName);
 6092 
 6093 /*
 6094 ** CAPI3REF: Determine if a database is read-only
 6095 ** METHOD: sqlite3
 6096 **
 6097 ** ^The sqlite3_db_readonly(D,N) interface returns 1 if the database N
 6098 ** of connection D is read-only, 0 if it is read/write, or -1 if N is not
 6099 ** the name of a database on connection D.
 6100 */
 6101 SQLITE_API int sqlite3_db_readonly(sqlite3 *db, const char *zDbName);
 6102 
 6103 /*
 6104 ** CAPI3REF: Find the next prepared statement
 6105 ** METHOD: sqlite3
 6106 **
 6107 ** ^This interface returns a pointer to the next [prepared statement] after
 6108 ** pStmt associated with the [database connection] pDb.  ^If pStmt is NULL
 6109 ** then this interface returns a pointer to the first prepared statement
 6110 ** associated with the database connection pDb.  ^If no prepared statement
 6111 ** satisfies the conditions of this routine, it returns NULL.
 6112 **
 6113 ** The [database connection] pointer D in a call to
 6114 ** [sqlite3_next_stmt(D,S)] must refer to an open database
 6115 ** connection and in particular must not be a NULL pointer.
 6116 */
 6117 SQLITE_API sqlite3_stmt *sqlite3_next_stmt(sqlite3 *pDb, sqlite3_stmt *pStmt);
 6118 
 6119 /*
 6120 ** CAPI3REF: Commit And Rollback Notification Callbacks
 6121 ** METHOD: sqlite3
 6122 **
 6123 ** ^The sqlite3_commit_hook() interface registers a callback
 6124 ** function to be invoked whenever a transaction is [COMMIT | committed].
 6125 ** ^Any callback set by a previous call to sqlite3_commit_hook()
 6126 ** for the same database connection is overridden.
 6127 ** ^The sqlite3_rollback_hook() interface registers a callback
 6128 ** function to be invoked whenever a transaction is [ROLLBACK | rolled back].
 6129 ** ^Any callback set by a previous call to sqlite3_rollback_hook()
 6130 ** for the same database connection is overridden.
 6131 ** ^The pArg argument is passed through to the callback.
 6132 ** ^If the callback on a commit hook function returns non-zero,
 6133 ** then the commit is converted into a rollback.
 6134 **
 6135 ** ^The sqlite3_commit_hook(D,C,P) and sqlite3_rollback_hook(D,C,P) functions
 6136 ** return the P argument from the previous call of the same function
 6137 ** on the same [database connection] D, or NULL for
 6138 ** the first call for each function on D.
 6139 **
 6140 ** The commit and rollback hook callbacks are not reentrant.
 6141 ** The callback implementation must not do anything that will modify
 6142 ** the database connection that invoked the callback.  Any actions
 6143 ** to modify the database connection must be deferred until after the
 6144 ** completion of the [sqlite3_step()] call that triggered the commit
 6145 ** or rollback hook in the first place.
 6146 ** Note that running any other SQL statements, including SELECT statements,
 6147 ** or merely calling [sqlite3_prepare_v2()] and [sqlite3_step()] will modify
 6148 ** the database connections for the meaning of &quot;modify&quot; in this paragraph.
 6149 **
 6150 ** ^Registering a NULL function disables the callback.
 6151 **
 6152 ** ^When the commit hook callback routine returns zero, the [COMMIT]
 6153 ** operation is allowed to continue normally.  ^If the commit hook
 6154 ** returns non-zero, then the [COMMIT] is converted into a [ROLLBACK].
 6155 ** ^The rollback hook is invoked on a rollback that results from a commit
 6156 ** hook returning non-zero, just as it would be with any other rollback.
 6157 **
 6158 ** ^For the purposes of this API, a transaction is said to have been
 6159 ** rolled back if an explicit &quot;ROLLBACK&quot; statement is executed, or
 6160 ** an error or constraint causes an implicit rollback to occur.
 6161 ** ^The rollback callback is not invoked if a transaction is
 6162 ** automatically rolled back because the database connection is closed.
 6163 **
 6164 ** See also the [sqlite3_update_hook()] interface.
 6165 */
 6166 SQLITE_API void *sqlite3_commit_hook(sqlite3*, int(*)(void*), void*);
 6167 SQLITE_API void *sqlite3_rollback_hook(sqlite3*, void(*)(void *), void*);
 6168 
 6169 /*
 6170 ** CAPI3REF: Data Change Notification Callbacks
 6171 ** METHOD: sqlite3
 6172 **
 6173 ** ^The sqlite3_update_hook() interface registers a callback function
 6174 ** with the [database connection] identified by the first argument
 6175 ** to be invoked whenever a row is updated, inserted or deleted in
 6176 ** a [rowid table].
 6177 ** ^Any callback set by a previous call to this function
 6178 ** for the same database connection is overridden.
 6179 **
 6180 ** ^The second argument is a pointer to the function to invoke when a
 6181 ** row is updated, inserted or deleted in a rowid table.
 6182 ** ^The first argument to the callback is a copy of the third argument
 6183 ** to sqlite3_update_hook().
 6184 ** ^The second callback argument is one of [SQLITE_INSERT], [SQLITE_DELETE],
 6185 ** or [SQLITE_UPDATE], depending on the operation that caused the callback
 6186 ** to be invoked.
 6187 ** ^The third and fourth arguments to the callback contain pointers to the
 6188 ** database and table name containing the affected row.
 6189 ** ^The final callback parameter is the [rowid] of the row.
 6190 ** ^In the case of an update, this is the [rowid] after the update takes place.
 6191 **
 6192 ** ^(The update hook is not invoked when internal system tables are
 6193 ** modified (i.e. sqlite_master and sqlite_sequence).)^
 6194 ** ^The update hook is not invoked when [WITHOUT ROWID] tables are modified.
 6195 **
 6196 ** ^In the current implementation, the update hook
 6197 ** is not invoked when conflicting rows are deleted because of an
 6198 ** [ON CONFLICT | ON CONFLICT REPLACE] clause.  ^Nor is the update hook
 6199 ** invoked when rows are deleted using the [truncate optimization].
 6200 ** The exceptions defined in this paragraph might change in a future
 6201 ** release of SQLite.
 6202 **
 6203 ** The update hook implementation must not do anything that will modify
 6204 ** the database connection that invoked the update hook.  Any actions
 6205 ** to modify the database connection must be deferred until after the
 6206 ** completion of the [sqlite3_step()] call that triggered the update hook.
 6207 ** Note that [sqlite3_prepare_v2()] and [sqlite3_step()] both modify their
 6208 ** database connections for the meaning of &quot;modify&quot; in this paragraph.
 6209 **
 6210 ** ^The sqlite3_update_hook(D,C,P) function
 6211 ** returns the P argument from the previous call
 6212 ** on the same [database connection] D, or NULL for
 6213 ** the first call on D.
 6214 **
 6215 ** See also the [sqlite3_commit_hook()], [sqlite3_rollback_hook()],
 6216 ** and [sqlite3_preupdate_hook()] interfaces.
 6217 */
 6218 SQLITE_API void *sqlite3_update_hook(
 6219   sqlite3*,
 6220   void(*)(void *,int ,char const *,char const *,sqlite3_int64),
 6221   void*
 6222 );
 6223 
 6224 /*
 6225 ** CAPI3REF: Enable Or Disable Shared Pager Cache
 6226 **
 6227 ** ^(This routine enables or disables the sharing of the database cache
 6228 ** and schema data structures between [database connection | connections]
 6229 ** to the same database. Sharing is enabled if the argument is true
 6230 ** and disabled if the argument is false.)^
 6231 **
 6232 ** ^Cache sharing is enabled and disabled for an entire process.
 6233 ** This is a change as of SQLite [version 3.5.0] ([dateof:3.5.0]).
 6234 ** In prior versions of SQLite,
 6235 ** sharing was enabled or disabled for each thread separately.
 6236 **
 6237 ** ^(The cache sharing mode set by this interface effects all subsequent
 6238 ** calls to [sqlite3_open()], [sqlite3_open_v2()], and [sqlite3_open16()].
<a name="64" id="anc64"></a><span class="line-modified"> 6239 ** Existing database connections continue to use the sharing mode</span>
 6240 ** that was in effect at the time they were opened.)^
 6241 **
 6242 ** ^(This routine returns [SQLITE_OK] if shared cache was enabled or disabled
 6243 ** successfully.  An [error code] is returned otherwise.)^
 6244 **
<a name="65" id="anc65"></a><span class="line-modified"> 6245 ** ^Shared cache is disabled by default. It is recommended that it stay</span>
<span class="line-modified"> 6246 ** that way.  In other words, do not use this routine.  This interface</span>
<span class="line-modified"> 6247 ** continues to be provided for historical compatibility, but its use is</span>
<span class="line-added"> 6248 ** discouraged.  Any use of shared cache is discouraged.  If shared cache</span>
<span class="line-added"> 6249 ** must be used, it is recommended that shared cache only be enabled for</span>
<span class="line-added"> 6250 ** individual database connections using the [sqlite3_open_v2()] interface</span>
<span class="line-added"> 6251 ** with the [SQLITE_OPEN_SHAREDCACHE] flag.</span>
 6252 **
 6253 ** Note: This method is disabled on MacOS X 10.7 and iOS version 5.0
 6254 ** and will always return SQLITE_MISUSE. On those systems,
 6255 ** shared cache mode should be enabled per-database connection via
 6256 ** [sqlite3_open_v2()] with [SQLITE_OPEN_SHAREDCACHE].
 6257 **
 6258 ** This interface is threadsafe on processors where writing a
 6259 ** 32-bit integer is atomic.
 6260 **
 6261 ** See Also:  [SQLite Shared-Cache Mode]
 6262 */
 6263 SQLITE_API int sqlite3_enable_shared_cache(int);
 6264 
 6265 /*
 6266 ** CAPI3REF: Attempt To Free Heap Memory
 6267 **
 6268 ** ^The sqlite3_release_memory() interface attempts to free N bytes
 6269 ** of heap memory by deallocating non-essential memory allocations
 6270 ** held by the database library.   Memory used to cache database
 6271 ** pages to improve performance is an example of non-essential memory.
 6272 ** ^sqlite3_release_memory() returns the number of bytes actually freed,
 6273 ** which might be more or less than the amount requested.
 6274 ** ^The sqlite3_release_memory() routine is a no-op returning zero
 6275 ** if SQLite is not compiled with [SQLITE_ENABLE_MEMORY_MANAGEMENT].
 6276 **
 6277 ** See also: [sqlite3_db_release_memory()]
 6278 */
 6279 SQLITE_API int sqlite3_release_memory(int);
 6280 
 6281 /*
 6282 ** CAPI3REF: Free Memory Used By A Database Connection
 6283 ** METHOD: sqlite3
 6284 **
 6285 ** ^The sqlite3_db_release_memory(D) interface attempts to free as much heap
 6286 ** memory as possible from database connection D. Unlike the
 6287 ** [sqlite3_release_memory()] interface, this interface is in effect even
 6288 ** when the [SQLITE_ENABLE_MEMORY_MANAGEMENT] compile-time option is
 6289 ** omitted.
 6290 **
 6291 ** See also: [sqlite3_release_memory()]
 6292 */
 6293 SQLITE_API int sqlite3_db_release_memory(sqlite3*);
 6294 
 6295 /*
 6296 ** CAPI3REF: Impose A Limit On Heap Size
 6297 **
<a name="66" id="anc66"></a><span class="line-added"> 6298 ** These interfaces impose limits on the amount of heap memory that will be</span>
<span class="line-added"> 6299 ** by all database connections within a single process.</span>
<span class="line-added"> 6300 **</span>
 6301 ** ^The sqlite3_soft_heap_limit64() interface sets and/or queries the
 6302 ** soft limit on the amount of heap memory that may be allocated by SQLite.
 6303 ** ^SQLite strives to keep heap memory utilization below the soft heap
 6304 ** limit by reducing the number of pages held in the page cache
 6305 ** as heap memory usages approaches the limit.
 6306 ** ^The soft heap limit is &quot;soft&quot; because even though SQLite strives to stay
 6307 ** below the limit, it will exceed the limit rather than generate
 6308 ** an [SQLITE_NOMEM] error.  In other words, the soft heap limit
 6309 ** is advisory only.
 6310 **
<a name="67" id="anc67"></a><span class="line-modified"> 6311 ** ^The sqlite3_hard_heap_limit64(N) interface sets a hard upper bound of</span>
<span class="line-modified"> 6312 ** N bytes on the amount of memory that will be allocated.  ^The</span>
<span class="line-modified"> 6313 ** sqlite3_hard_heap_limit64(N) interface is similar to</span>
<span class="line-modified"> 6314 ** sqlite3_soft_heap_limit64(N) except that memory allocations will fail</span>
<span class="line-modified"> 6315 ** when the hard heap limit is reached.</span>



 6316 **
<a name="68" id="anc68"></a><span class="line-modified"> 6317 ** ^The return value from both sqlite3_soft_heap_limit64() and</span>
<span class="line-added"> 6318 ** sqlite3_hard_heap_limit64() is the size of</span>
<span class="line-added"> 6319 ** the heap limit prior to the call, or negative in the case of an</span>
<span class="line-added"> 6320 ** error.  ^If the argument N is negative</span>
<span class="line-added"> 6321 ** then no change is made to the heap limit.  Hence, the current</span>
<span class="line-added"> 6322 ** size of heap limits can be determined by invoking</span>
<span class="line-added"> 6323 ** sqlite3_soft_heap_limit64(-1) or sqlite3_hard_heap_limit(-1).</span>
<span class="line-added"> 6324 **</span>
<span class="line-added"> 6325 ** ^Setting the heap limits to zero disables the heap limiter mechanism.</span>
<span class="line-added"> 6326 **</span>
<span class="line-added"> 6327 ** ^The soft heap limit may not be greater than the hard heap limit.</span>
<span class="line-added"> 6328 ** ^If the hard heap limit is enabled and if sqlite3_soft_heap_limit(N)</span>
<span class="line-added"> 6329 ** is invoked with a value of N that is greater than the hard heap limit,</span>
<span class="line-added"> 6330 ** the the soft heap limit is set to the value of the hard heap limit.</span>
<span class="line-added"> 6331 ** ^The soft heap limit is automatically enabled whenever the hard heap</span>
<span class="line-added"> 6332 ** limit is enabled. ^When sqlite3_hard_heap_limit64(N) is invoked and</span>
<span class="line-added"> 6333 ** the soft heap limit is outside the range of 1..N, then the soft heap</span>
<span class="line-added"> 6334 ** limit is set to N.  ^Invoking sqlite3_soft_heap_limit64(0) when the</span>
<span class="line-added"> 6335 ** hard heap limit is enabled makes the soft heap limit equal to the</span>
<span class="line-added"> 6336 ** hard heap limit.</span>
<span class="line-added"> 6337 **</span>
<span class="line-added"> 6338 ** The memory allocation limits can also be adjusted using</span>
<span class="line-added"> 6339 ** [PRAGMA soft_heap_limit] and [PRAGMA hard_heap_limit].</span>
<span class="line-added"> 6340 **</span>
<span class="line-added"> 6341 ** ^(The heap limits are not enforced in the current implementation</span>
 6342 ** if one or more of following conditions are true:
 6343 **
 6344 ** &lt;ul&gt;
<a name="69" id="anc69"></a><span class="line-modified"> 6345 ** &lt;li&gt; The limit value is set to zero.</span>
 6346 ** &lt;li&gt; Memory accounting is disabled using a combination of the
 6347 **      [sqlite3_config]([SQLITE_CONFIG_MEMSTATUS],...) start-time option and
 6348 **      the [SQLITE_DEFAULT_MEMSTATUS] compile-time option.
 6349 ** &lt;li&gt; An alternative page cache implementation is specified using
 6350 **      [sqlite3_config]([SQLITE_CONFIG_PCACHE2],...).
 6351 ** &lt;li&gt; The page cache allocates from its own memory pool supplied
 6352 **      by [sqlite3_config]([SQLITE_CONFIG_PAGECACHE],...) rather than
 6353 **      from the heap.
 6354 ** &lt;/ul&gt;)^
 6355 **
<a name="70" id="anc70"></a><span class="line-modified"> 6356 ** The circumstances under which SQLite will enforce the heap limits may</span>











 6357 ** changes in future releases of SQLite.
 6358 */
 6359 SQLITE_API sqlite3_int64 sqlite3_soft_heap_limit64(sqlite3_int64 N);
<a name="71" id="anc71"></a><span class="line-added"> 6360 SQLITE_API sqlite3_int64 sqlite3_hard_heap_limit64(sqlite3_int64 N);</span>
 6361 
 6362 /*
 6363 ** CAPI3REF: Deprecated Soft Heap Limit Interface
 6364 ** DEPRECATED
 6365 **
 6366 ** This is a deprecated version of the [sqlite3_soft_heap_limit64()]
 6367 ** interface.  This routine is provided for historical compatibility
 6368 ** only.  All new applications should use the
 6369 ** [sqlite3_soft_heap_limit64()] interface rather than this one.
 6370 */
 6371 SQLITE_API SQLITE_DEPRECATED void sqlite3_soft_heap_limit(int N);
 6372 
 6373 
 6374 /*
 6375 ** CAPI3REF: Extract Metadata About A Column Of A Table
 6376 ** METHOD: sqlite3
 6377 **
 6378 ** ^(The sqlite3_table_column_metadata(X,D,T,C,....) routine returns
 6379 ** information about column C of table T in database D
 6380 ** on [database connection] X.)^  ^The sqlite3_table_column_metadata()
 6381 ** interface returns SQLITE_OK and fills in the non-NULL pointers in
 6382 ** the final five arguments with appropriate values if the specified
 6383 ** column exists.  ^The sqlite3_table_column_metadata() interface returns
<a name="72" id="anc72"></a><span class="line-modified"> 6384 ** SQLITE_ERROR if the specified column does not exist.</span>
 6385 ** ^If the column-name parameter to sqlite3_table_column_metadata() is a
 6386 ** NULL pointer, then this routine simply checks for the existence of the
 6387 ** table and returns SQLITE_OK if the table exists and SQLITE_ERROR if it
 6388 ** does not.  If the table name parameter T in a call to
 6389 ** sqlite3_table_column_metadata(X,D,T,C,...) is NULL then the result is
 6390 ** undefined behavior.
 6391 **
 6392 ** ^The column is identified by the second, third and fourth parameters to
 6393 ** this function. ^(The second parameter is either the name of the database
 6394 ** (i.e. &quot;main&quot;, &quot;temp&quot;, or an attached database) containing the specified
 6395 ** table or NULL.)^ ^If it is NULL, then all attached databases are searched
 6396 ** for the table using the same algorithm used by the database engine to
 6397 ** resolve unqualified table references.
 6398 **
 6399 ** ^The third and fourth parameters to this function are the table and column
 6400 ** name of the desired column, respectively.
 6401 **
 6402 ** ^Metadata is returned by writing to the memory locations passed as the 5th
 6403 ** and subsequent parameters to this function. ^Any of these arguments may be
 6404 ** NULL, in which case the corresponding element of metadata is omitted.
 6405 **
 6406 ** ^(&lt;blockquote&gt;
 6407 ** &lt;table border=&quot;1&quot;&gt;
 6408 ** &lt;tr&gt;&lt;th&gt; Parameter &lt;th&gt; Output&lt;br&gt;Type &lt;th&gt;  Description
 6409 **
 6410 ** &lt;tr&gt;&lt;td&gt; 5th &lt;td&gt; const char* &lt;td&gt; Data type
 6411 ** &lt;tr&gt;&lt;td&gt; 6th &lt;td&gt; const char* &lt;td&gt; Name of default collation sequence
 6412 ** &lt;tr&gt;&lt;td&gt; 7th &lt;td&gt; int         &lt;td&gt; True if column has a NOT NULL constraint
 6413 ** &lt;tr&gt;&lt;td&gt; 8th &lt;td&gt; int         &lt;td&gt; True if column is part of the PRIMARY KEY
 6414 ** &lt;tr&gt;&lt;td&gt; 9th &lt;td&gt; int         &lt;td&gt; True if column is [AUTOINCREMENT]
 6415 ** &lt;/table&gt;
 6416 ** &lt;/blockquote&gt;)^
 6417 **
 6418 ** ^The memory pointed to by the character pointers returned for the
 6419 ** declaration type and collation sequence is valid until the next
 6420 ** call to any SQLite API function.
 6421 **
 6422 ** ^If the specified table is actually a view, an [error code] is returned.
 6423 **
 6424 ** ^If the specified column is &quot;rowid&quot;, &quot;oid&quot; or &quot;_rowid_&quot; and the table
 6425 ** is not a [WITHOUT ROWID] table and an
 6426 ** [INTEGER PRIMARY KEY] column has been explicitly declared, then the output
 6427 ** parameters are set for the explicitly declared column. ^(If there is no
 6428 ** [INTEGER PRIMARY KEY] column, then the outputs
 6429 ** for the [rowid] are set as follows:
 6430 **
 6431 ** &lt;pre&gt;
 6432 **     data type: &quot;INTEGER&quot;
 6433 **     collation sequence: &quot;BINARY&quot;
 6434 **     not null: 0
 6435 **     primary key: 1
 6436 **     auto increment: 0
 6437 ** &lt;/pre&gt;)^
 6438 **
 6439 ** ^This function causes all database schemas to be read from disk and
 6440 ** parsed, if that has not already been done, and returns an error if
 6441 ** any errors are encountered while loading the schema.
 6442 */
 6443 SQLITE_API int sqlite3_table_column_metadata(
 6444   sqlite3 *db,                /* Connection handle */
 6445   const char *zDbName,        /* Database name or NULL */
 6446   const char *zTableName,     /* Table name */
 6447   const char *zColumnName,    /* Column name */
 6448   char const **pzDataType,    /* OUTPUT: Declared data type */
 6449   char const **pzCollSeq,     /* OUTPUT: Collation sequence name */
 6450   int *pNotNull,              /* OUTPUT: True if NOT NULL constraint exists */
 6451   int *pPrimaryKey,           /* OUTPUT: True if column part of PK */
 6452   int *pAutoinc               /* OUTPUT: True if column is auto-increment */
 6453 );
 6454 
 6455 /*
 6456 ** CAPI3REF: Load An Extension
 6457 ** METHOD: sqlite3
 6458 **
 6459 ** ^This interface loads an SQLite extension library from the named file.
 6460 **
 6461 ** ^The sqlite3_load_extension() interface attempts to load an
 6462 ** [SQLite extension] library contained in the file zFile.  If
 6463 ** the file cannot be loaded directly, attempts are made to load
 6464 ** with various operating-system specific extensions added.
 6465 ** So for example, if &quot;samplelib&quot; cannot be loaded, then names like
 6466 ** &quot;samplelib.so&quot; or &quot;samplelib.dylib&quot; or &quot;samplelib.dll&quot; might
 6467 ** be tried also.
 6468 **
 6469 ** ^The entry point is zProc.
 6470 ** ^(zProc may be 0, in which case SQLite will try to come up with an
 6471 ** entry point name on its own.  It first tries &quot;sqlite3_extension_init&quot;.
 6472 ** If that does not work, it constructs a name &quot;sqlite3_X_init&quot; where the
 6473 ** X is consists of the lower-case equivalent of all ASCII alphabetic
 6474 ** characters in the filename from the last &quot;/&quot; to the first following
 6475 ** &quot;.&quot; and omitting any initial &quot;lib&quot;.)^
 6476 ** ^The sqlite3_load_extension() interface returns
 6477 ** [SQLITE_OK] on success and [SQLITE_ERROR] if something goes wrong.
 6478 ** ^If an error occurs and pzErrMsg is not 0, then the
 6479 ** [sqlite3_load_extension()] interface shall attempt to
 6480 ** fill *pzErrMsg with error message text stored in memory
 6481 ** obtained from [sqlite3_malloc()]. The calling function
 6482 ** should free this memory by calling [sqlite3_free()].
 6483 **
 6484 ** ^Extension loading must be enabled using
 6485 ** [sqlite3_enable_load_extension()] or
 6486 ** [sqlite3_db_config](db,[SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION],1,NULL)
 6487 ** prior to calling this API,
 6488 ** otherwise an error will be returned.
 6489 **
 6490 ** &lt;b&gt;Security warning:&lt;/b&gt; It is recommended that the
 6491 ** [SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION] method be used to enable only this
 6492 ** interface.  The use of the [sqlite3_enable_load_extension()] interface
 6493 ** should be avoided.  This will keep the SQL function [load_extension()]
 6494 ** disabled and prevent SQL injections from giving attackers
 6495 ** access to extension loading capabilities.
 6496 **
 6497 ** See also the [load_extension() SQL function].
 6498 */
 6499 SQLITE_API int sqlite3_load_extension(
 6500   sqlite3 *db,          /* Load the extension into this database connection */
 6501   const char *zFile,    /* Name of the shared library containing extension */
 6502   const char *zProc,    /* Entry point.  Derived from zFile if 0 */
 6503   char **pzErrMsg       /* Put error message here if not 0 */
 6504 );
 6505 
 6506 /*
 6507 ** CAPI3REF: Enable Or Disable Extension Loading
 6508 ** METHOD: sqlite3
 6509 **
 6510 ** ^So as not to open security holes in older applications that are
 6511 ** unprepared to deal with [extension loading], and as a means of disabling
 6512 ** [extension loading] while evaluating user-entered SQL, the following API
 6513 ** is provided to turn the [sqlite3_load_extension()] mechanism on and off.
 6514 **
 6515 ** ^Extension loading is off by default.
 6516 ** ^Call the sqlite3_enable_load_extension() routine with onoff==1
 6517 ** to turn extension loading on and call it with onoff==0 to turn
 6518 ** it back off again.
 6519 **
 6520 ** ^This interface enables or disables both the C-API
 6521 ** [sqlite3_load_extension()] and the SQL function [load_extension()].
 6522 ** ^(Use [sqlite3_db_config](db,[SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION],..)
 6523 ** to enable or disable only the C-API.)^
 6524 **
 6525 ** &lt;b&gt;Security warning:&lt;/b&gt; It is recommended that extension loading
<a name="73" id="anc73"></a><span class="line-modified"> 6526 ** be enabled using the [SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION] method</span>
 6527 ** rather than this interface, so the [load_extension()] SQL function
 6528 ** remains disabled. This will prevent SQL injections from giving attackers
 6529 ** access to extension loading capabilities.
 6530 */
 6531 SQLITE_API int sqlite3_enable_load_extension(sqlite3 *db, int onoff);
 6532 
 6533 /*
 6534 ** CAPI3REF: Automatically Load Statically Linked Extensions
 6535 **
 6536 ** ^This interface causes the xEntryPoint() function to be invoked for
 6537 ** each new [database connection] that is created.  The idea here is that
 6538 ** xEntryPoint() is the entry point for a statically linked [SQLite extension]
 6539 ** that is to be automatically loaded into all new database connections.
 6540 **
 6541 ** ^(Even though the function prototype shows that xEntryPoint() takes
 6542 ** no arguments and returns void, SQLite invokes xEntryPoint() with three
 6543 ** arguments and expects an integer result as if the signature of the
 6544 ** entry point where as follows:
 6545 **
 6546 ** &lt;blockquote&gt;&lt;pre&gt;
 6547 ** &amp;nbsp;  int xEntryPoint(
 6548 ** &amp;nbsp;    sqlite3 *db,
 6549 ** &amp;nbsp;    const char **pzErrMsg,
 6550 ** &amp;nbsp;    const struct sqlite3_api_routines *pThunk
 6551 ** &amp;nbsp;  );
 6552 ** &lt;/pre&gt;&lt;/blockquote&gt;)^
 6553 **
 6554 ** If the xEntryPoint routine encounters an error, it should make *pzErrMsg
 6555 ** point to an appropriate error message (obtained from [sqlite3_mprintf()])
 6556 ** and return an appropriate [error code].  ^SQLite ensures that *pzErrMsg
 6557 ** is NULL before calling the xEntryPoint().  ^SQLite will invoke
 6558 ** [sqlite3_free()] on *pzErrMsg after xEntryPoint() returns.  ^If any
 6559 ** xEntryPoint() returns an error, the [sqlite3_open()], [sqlite3_open16()],
 6560 ** or [sqlite3_open_v2()] call that provoked the xEntryPoint() will fail.
 6561 **
 6562 ** ^Calling sqlite3_auto_extension(X) with an entry point X that is already
 6563 ** on the list of automatic extensions is a harmless no-op. ^No entry point
 6564 ** will be called more than once for each database connection that is opened.
 6565 **
 6566 ** See also: [sqlite3_reset_auto_extension()]
 6567 ** and [sqlite3_cancel_auto_extension()]
 6568 */
 6569 SQLITE_API int sqlite3_auto_extension(void(*xEntryPoint)(void));
 6570 
 6571 /*
 6572 ** CAPI3REF: Cancel Automatic Extension Loading
 6573 **
 6574 ** ^The [sqlite3_cancel_auto_extension(X)] interface unregisters the
 6575 ** initialization routine X that was registered using a prior call to
 6576 ** [sqlite3_auto_extension(X)].  ^The [sqlite3_cancel_auto_extension(X)]
 6577 ** routine returns 1 if initialization routine X was successfully
 6578 ** unregistered and it returns 0 if X was not on the list of initialization
 6579 ** routines.
 6580 */
 6581 SQLITE_API int sqlite3_cancel_auto_extension(void(*xEntryPoint)(void));
 6582 
 6583 /*
 6584 ** CAPI3REF: Reset Automatic Extension Loading
 6585 **
 6586 ** ^This interface disables all automatic extensions previously
 6587 ** registered using [sqlite3_auto_extension()].
 6588 */
 6589 SQLITE_API void sqlite3_reset_auto_extension(void);
 6590 
 6591 /*
 6592 ** The interface to the virtual-table mechanism is currently considered
 6593 ** to be experimental.  The interface might change in incompatible ways.
 6594 ** If this is a problem for you, do not use the interface at this time.
 6595 **
 6596 ** When the virtual-table mechanism stabilizes, we will declare the
 6597 ** interface fixed, support it indefinitely, and remove this comment.
 6598 */
 6599 
 6600 /*
 6601 ** Structures used by the virtual table interface
 6602 */
 6603 typedef struct sqlite3_vtab sqlite3_vtab;
 6604 typedef struct sqlite3_index_info sqlite3_index_info;
 6605 typedef struct sqlite3_vtab_cursor sqlite3_vtab_cursor;
 6606 typedef struct sqlite3_module sqlite3_module;
 6607 
 6608 /*
 6609 ** CAPI3REF: Virtual Table Object
 6610 ** KEYWORDS: sqlite3_module {virtual table module}
 6611 **
 6612 ** This structure, sometimes called a &quot;virtual table module&quot;,
<a name="74" id="anc74"></a><span class="line-modified"> 6613 ** defines the implementation of a [virtual table].</span>
 6614 ** This structure consists mostly of methods for the module.
 6615 **
 6616 ** ^A virtual table module is created by filling in a persistent
 6617 ** instance of this structure and passing a pointer to that instance
 6618 ** to [sqlite3_create_module()] or [sqlite3_create_module_v2()].
 6619 ** ^The registration remains valid until it is replaced by a different
 6620 ** module or until the [database connection] closes.  The content
 6621 ** of this structure must not change while it is registered with
 6622 ** any database connection.
 6623 */
 6624 struct sqlite3_module {
 6625   int iVersion;
 6626   int (*xCreate)(sqlite3*, void *pAux,
 6627                int argc, const char *const*argv,
 6628                sqlite3_vtab **ppVTab, char**);
 6629   int (*xConnect)(sqlite3*, void *pAux,
 6630                int argc, const char *const*argv,
 6631                sqlite3_vtab **ppVTab, char**);
 6632   int (*xBestIndex)(sqlite3_vtab *pVTab, sqlite3_index_info*);
 6633   int (*xDisconnect)(sqlite3_vtab *pVTab);
 6634   int (*xDestroy)(sqlite3_vtab *pVTab);
 6635   int (*xOpen)(sqlite3_vtab *pVTab, sqlite3_vtab_cursor **ppCursor);
 6636   int (*xClose)(sqlite3_vtab_cursor*);
 6637   int (*xFilter)(sqlite3_vtab_cursor*, int idxNum, const char *idxStr,
 6638                 int argc, sqlite3_value **argv);
 6639   int (*xNext)(sqlite3_vtab_cursor*);
 6640   int (*xEof)(sqlite3_vtab_cursor*);
 6641   int (*xColumn)(sqlite3_vtab_cursor*, sqlite3_context*, int);
 6642   int (*xRowid)(sqlite3_vtab_cursor*, sqlite3_int64 *pRowid);
 6643   int (*xUpdate)(sqlite3_vtab *, int, sqlite3_value **, sqlite3_int64 *);
 6644   int (*xBegin)(sqlite3_vtab *pVTab);
 6645   int (*xSync)(sqlite3_vtab *pVTab);
 6646   int (*xCommit)(sqlite3_vtab *pVTab);
 6647   int (*xRollback)(sqlite3_vtab *pVTab);
 6648   int (*xFindFunction)(sqlite3_vtab *pVtab, int nArg, const char *zName,
 6649                        void (**pxFunc)(sqlite3_context*,int,sqlite3_value**),
 6650                        void **ppArg);
 6651   int (*xRename)(sqlite3_vtab *pVtab, const char *zNew);
 6652   /* The methods above are in version 1 of the sqlite_module object. Those
 6653   ** below are for version 2 and greater. */
 6654   int (*xSavepoint)(sqlite3_vtab *pVTab, int);
 6655   int (*xRelease)(sqlite3_vtab *pVTab, int);
 6656   int (*xRollbackTo)(sqlite3_vtab *pVTab, int);
 6657   /* The methods above are in versions 1 and 2 of the sqlite_module object.
 6658   ** Those below are for version 3 and greater. */
 6659   int (*xShadowName)(const char*);
 6660 };
 6661 
 6662 /*
 6663 ** CAPI3REF: Virtual Table Indexing Information
 6664 ** KEYWORDS: sqlite3_index_info
 6665 **
 6666 ** The sqlite3_index_info structure and its substructures is used as part
 6667 ** of the [virtual table] interface to
 6668 ** pass information into and receive the reply from the [xBestIndex]
 6669 ** method of a [virtual table module].  The fields under **Inputs** are the
 6670 ** inputs to xBestIndex and are read-only.  xBestIndex inserts its
 6671 ** results into the **Outputs** fields.
 6672 **
 6673 ** ^(The aConstraint[] array records WHERE clause constraints of the form:
 6674 **
 6675 ** &lt;blockquote&gt;column OP expr&lt;/blockquote&gt;
 6676 **
 6677 ** where OP is =, &amp;lt;, &amp;lt;=, &amp;gt;, or &amp;gt;=.)^  ^(The particular operator is
 6678 ** stored in aConstraint[].op using one of the
 6679 ** [SQLITE_INDEX_CONSTRAINT_EQ | SQLITE_INDEX_CONSTRAINT_ values].)^
 6680 ** ^(The index of the column is stored in
 6681 ** aConstraint[].iColumn.)^  ^(aConstraint[].usable is TRUE if the
 6682 ** expr on the right-hand side can be evaluated (and thus the constraint
 6683 ** is usable) and false if it cannot.)^
 6684 **
 6685 ** ^The optimizer automatically inverts terms of the form &quot;expr OP column&quot;
 6686 ** and makes other simplifications to the WHERE clause in an attempt to
 6687 ** get as many WHERE clause terms into the form shown above as possible.
 6688 ** ^The aConstraint[] array only reports WHERE clause terms that are
 6689 ** relevant to the particular virtual table being queried.
 6690 **
 6691 ** ^Information about the ORDER BY clause is stored in aOrderBy[].
 6692 ** ^Each term of aOrderBy records a column of the ORDER BY clause.
 6693 **
 6694 ** The colUsed field indicates which columns of the virtual table may be
 6695 ** required by the current scan. Virtual table columns are numbered from
 6696 ** zero in the order in which they appear within the CREATE TABLE statement
 6697 ** passed to sqlite3_declare_vtab(). For the first 63 columns (columns 0-62),
 6698 ** the corresponding bit is set within the colUsed mask if the column may be
 6699 ** required by SQLite. If the table has at least 64 columns and any column
 6700 ** to the right of the first 63 is required, then bit 63 of colUsed is also
 6701 ** set. In other words, column iCol may be required if the expression
 6702 ** (colUsed &amp; ((sqlite3_uint64)1 &lt;&lt; (iCol&gt;=63 ? 63 : iCol))) evaluates to
 6703 ** non-zero.
 6704 **
 6705 ** The [xBestIndex] method must fill aConstraintUsage[] with information
 6706 ** about what parameters to pass to xFilter.  ^If argvIndex&gt;0 then
 6707 ** the right-hand side of the corresponding aConstraint[] is evaluated
 6708 ** and becomes the argvIndex-th entry in argv.  ^(If aConstraintUsage[].omit
 6709 ** is true, then the constraint is assumed to be fully handled by the
<a name="75" id="anc75"></a><span class="line-modified"> 6710 ** virtual table and might not be checked again by the byte code.)^ ^(The</span>
<span class="line-added"> 6711 ** aConstraintUsage[].omit flag is an optimization hint. When the omit flag</span>
<span class="line-added"> 6712 ** is left in its default setting of false, the constraint will always be</span>
<span class="line-added"> 6713 ** checked separately in byte code.  If the omit flag is change to true, then</span>
<span class="line-added"> 6714 ** the constraint may or may not be checked in byte code.  In other words,</span>
<span class="line-added"> 6715 ** when the omit flag is true there is no guarantee that the constraint will</span>
<span class="line-added"> 6716 ** not be checked again using byte code.)^</span>
 6717 **
 6718 ** ^The idxNum and idxPtr values are recorded and passed into the
 6719 ** [xFilter] method.
 6720 ** ^[sqlite3_free()] is used to free idxPtr if and only if
 6721 ** needToFreeIdxPtr is true.
 6722 **
 6723 ** ^The orderByConsumed means that output from [xFilter]/[xNext] will occur in
 6724 ** the correct order to satisfy the ORDER BY clause so that no separate
 6725 ** sorting step is required.
 6726 **
 6727 ** ^The estimatedCost value is an estimate of the cost of a particular
 6728 ** strategy. A cost of N indicates that the cost of the strategy is similar
 6729 ** to a linear scan of an SQLite table with N rows. A cost of log(N)
 6730 ** indicates that the expense of the operation is similar to that of a
 6731 ** binary search on a unique indexed field of an SQLite table with N rows.
 6732 **
 6733 ** ^The estimatedRows value is an estimate of the number of rows that
 6734 ** will be returned by the strategy.
 6735 **
 6736 ** The xBestIndex method may optionally populate the idxFlags field with a
 6737 ** mask of SQLITE_INDEX_SCAN_* flags. Currently there is only one such flag -
 6738 ** SQLITE_INDEX_SCAN_UNIQUE. If the xBestIndex method sets this flag, SQLite
 6739 ** assumes that the strategy may visit at most one row.
 6740 **
 6741 ** Additionally, if xBestIndex sets the SQLITE_INDEX_SCAN_UNIQUE flag, then
 6742 ** SQLite also assumes that if a call to the xUpdate() method is made as
 6743 ** part of the same statement to delete or update a virtual table row and the
 6744 ** implementation returns SQLITE_CONSTRAINT, then there is no need to rollback
 6745 ** any database changes. In other words, if the xUpdate() returns
 6746 ** SQLITE_CONSTRAINT, the database contents must be exactly as they were
 6747 ** before xUpdate was called. By contrast, if SQLITE_INDEX_SCAN_UNIQUE is not
 6748 ** set and xUpdate returns SQLITE_CONSTRAINT, any database changes made by
 6749 ** the xUpdate method are automatically rolled back by SQLite.
 6750 **
 6751 ** IMPORTANT: The estimatedRows field was added to the sqlite3_index_info
 6752 ** structure for SQLite [version 3.8.2] ([dateof:3.8.2]).
 6753 ** If a virtual table extension is
 6754 ** used with an SQLite version earlier than 3.8.2, the results of attempting
 6755 ** to read or write the estimatedRows field are undefined (but are likely
<a name="76" id="anc76"></a><span class="line-modified"> 6756 ** to include crashing the application). The estimatedRows field should</span>
 6757 ** therefore only be used if [sqlite3_libversion_number()] returns a
 6758 ** value greater than or equal to 3008002. Similarly, the idxFlags field
 6759 ** was added for [version 3.9.0] ([dateof:3.9.0]).
 6760 ** It may therefore only be used if
 6761 ** sqlite3_libversion_number() returns a value greater than or equal to
 6762 ** 3009000.
 6763 */
 6764 struct sqlite3_index_info {
 6765   /* Inputs */
 6766   int nConstraint;           /* Number of entries in aConstraint */
 6767   struct sqlite3_index_constraint {
 6768      int iColumn;              /* Column constrained.  -1 for ROWID */
 6769      unsigned char op;         /* Constraint operator */
 6770      unsigned char usable;     /* True if this constraint is usable */
 6771      int iTermOffset;          /* Used internally - xBestIndex should ignore */
 6772   } *aConstraint;            /* Table of WHERE clause constraints */
 6773   int nOrderBy;              /* Number of terms in the ORDER BY clause */
 6774   struct sqlite3_index_orderby {
 6775      int iColumn;              /* Column number */
 6776      unsigned char desc;       /* True for DESC.  False for ASC. */
 6777   } *aOrderBy;               /* The ORDER BY clause */
 6778   /* Outputs */
 6779   struct sqlite3_index_constraint_usage {
 6780     int argvIndex;           /* if &gt;0, constraint is part of argv to xFilter */
 6781     unsigned char omit;      /* Do not code a test for this constraint */
 6782   } *aConstraintUsage;
 6783   int idxNum;                /* Number used to identify the index */
 6784   char *idxStr;              /* String, possibly obtained from sqlite3_malloc */
 6785   int needToFreeIdxStr;      /* Free idxStr using sqlite3_free() if true */
 6786   int orderByConsumed;       /* True if output is already ordered */
 6787   double estimatedCost;           /* Estimated cost of using this index */
 6788   /* Fields below are only available in SQLite 3.8.2 and later */
 6789   sqlite3_int64 estimatedRows;    /* Estimated number of rows returned */
 6790   /* Fields below are only available in SQLite 3.9.0 and later */
 6791   int idxFlags;              /* Mask of SQLITE_INDEX_SCAN_* flags */
 6792   /* Fields below are only available in SQLite 3.10.0 and later */
 6793   sqlite3_uint64 colUsed;    /* Input: Mask of columns used by statement */
 6794 };
 6795 
 6796 /*
 6797 ** CAPI3REF: Virtual Table Scan Flags
 6798 **
 6799 ** Virtual table implementations are allowed to set the
 6800 ** [sqlite3_index_info].idxFlags field to some combination of
 6801 ** these bits.
 6802 */
 6803 #define SQLITE_INDEX_SCAN_UNIQUE      1     /* Scan visits at most 1 row */
 6804 
 6805 /*
 6806 ** CAPI3REF: Virtual Table Constraint Operator Codes
 6807 **
<a name="77" id="anc77"></a><span class="line-modified"> 6808 ** These macros define the allowed values for the</span>
 6809 ** [sqlite3_index_info].aConstraint[].op field.  Each value represents
 6810 ** an operator that is part of a constraint term in the wHERE clause of
 6811 ** a query that uses a [virtual table].
 6812 */
 6813 #define SQLITE_INDEX_CONSTRAINT_EQ         2
 6814 #define SQLITE_INDEX_CONSTRAINT_GT         4
 6815 #define SQLITE_INDEX_CONSTRAINT_LE         8
 6816 #define SQLITE_INDEX_CONSTRAINT_LT        16
 6817 #define SQLITE_INDEX_CONSTRAINT_GE        32
 6818 #define SQLITE_INDEX_CONSTRAINT_MATCH     64
 6819 #define SQLITE_INDEX_CONSTRAINT_LIKE      65
 6820 #define SQLITE_INDEX_CONSTRAINT_GLOB      66
 6821 #define SQLITE_INDEX_CONSTRAINT_REGEXP    67
 6822 #define SQLITE_INDEX_CONSTRAINT_NE        68
 6823 #define SQLITE_INDEX_CONSTRAINT_ISNOT     69
 6824 #define SQLITE_INDEX_CONSTRAINT_ISNOTNULL 70
 6825 #define SQLITE_INDEX_CONSTRAINT_ISNULL    71
 6826 #define SQLITE_INDEX_CONSTRAINT_IS        72
 6827 #define SQLITE_INDEX_CONSTRAINT_FUNCTION 150
 6828 
 6829 /*
 6830 ** CAPI3REF: Register A Virtual Table Implementation
 6831 ** METHOD: sqlite3
 6832 **
 6833 ** ^These routines are used to register a new [virtual table module] name.
 6834 ** ^Module names must be registered before
 6835 ** creating a new [virtual table] using the module and before using a
 6836 ** preexisting [virtual table] for the module.
 6837 **
 6838 ** ^The module name is registered on the [database connection] specified
 6839 ** by the first parameter.  ^The name of the module is given by the
 6840 ** second parameter.  ^The third parameter is a pointer to
 6841 ** the implementation of the [virtual table module].   ^The fourth
 6842 ** parameter is an arbitrary client data pointer that is passed through
 6843 ** into the [xCreate] and [xConnect] methods of the virtual table module
 6844 ** when a new virtual table is be being created or reinitialized.
 6845 **
 6846 ** ^The sqlite3_create_module_v2() interface has a fifth parameter which
 6847 ** is a pointer to a destructor for the pClientData.  ^SQLite will
 6848 ** invoke the destructor function (if it is not NULL) when SQLite
 6849 ** no longer needs the pClientData pointer.  ^The destructor will also
 6850 ** be invoked if the call to sqlite3_create_module_v2() fails.
 6851 ** ^The sqlite3_create_module()
 6852 ** interface is equivalent to sqlite3_create_module_v2() with a NULL
 6853 ** destructor.
 6854 **
 6855 ** ^If the third parameter (the pointer to the sqlite3_module object) is
 6856 ** NULL then no new module is create and any existing modules with the
 6857 ** same name are dropped.
 6858 **
 6859 ** See also: [sqlite3_drop_modules()]
 6860 */
 6861 SQLITE_API int sqlite3_create_module(
 6862   sqlite3 *db,               /* SQLite connection to register module with */
 6863   const char *zName,         /* Name of the module */
 6864   const sqlite3_module *p,   /* Methods for the module */
 6865   void *pClientData          /* Client data for xCreate/xConnect */
 6866 );
 6867 SQLITE_API int sqlite3_create_module_v2(
 6868   sqlite3 *db,               /* SQLite connection to register module with */
 6869   const char *zName,         /* Name of the module */
 6870   const sqlite3_module *p,   /* Methods for the module */
 6871   void *pClientData,         /* Client data for xCreate/xConnect */
 6872   void(*xDestroy)(void*)     /* Module destructor function */
 6873 );
 6874 
 6875 /*
 6876 ** CAPI3REF: Remove Unnecessary Virtual Table Implementations
 6877 ** METHOD: sqlite3
 6878 **
 6879 ** ^The sqlite3_drop_modules(D,L) interface removes all virtual
 6880 ** table modules from database connection D except those named on list L.
 6881 ** The L parameter must be either NULL or a pointer to an array of pointers
 6882 ** to strings where the array is terminated by a single NULL pointer.
 6883 ** ^If the L parameter is NULL, then all virtual table modules are removed.
 6884 **
 6885 ** See also: [sqlite3_create_module()]
 6886 */
 6887 SQLITE_API int sqlite3_drop_modules(
 6888   sqlite3 *db,                /* Remove modules from this connection */
 6889   const char **azKeep         /* Except, do not remove the ones named here */
 6890 );
 6891 
 6892 /*
 6893 ** CAPI3REF: Virtual Table Instance Object
 6894 ** KEYWORDS: sqlite3_vtab
 6895 **
 6896 ** Every [virtual table module] implementation uses a subclass
 6897 ** of this object to describe a particular instance
 6898 ** of the [virtual table].  Each subclass will
 6899 ** be tailored to the specific needs of the module implementation.
 6900 ** The purpose of this superclass is to define certain fields that are
 6901 ** common to all module implementations.
 6902 **
 6903 ** ^Virtual tables methods can set an error message by assigning a
 6904 ** string obtained from [sqlite3_mprintf()] to zErrMsg.  The method should
 6905 ** take care that any prior string is freed by a call to [sqlite3_free()]
 6906 ** prior to assigning a new string to zErrMsg.  ^After the error message
 6907 ** is delivered up to the client application, the string will be automatically
 6908 ** freed by sqlite3_free() and the zErrMsg field will be zeroed.
 6909 */
 6910 struct sqlite3_vtab {
 6911   const sqlite3_module *pModule;  /* The module for this virtual table */
 6912   int nRef;                       /* Number of open cursors */
 6913   char *zErrMsg;                  /* Error message from sqlite3_mprintf() */
 6914   /* Virtual table implementations will typically add additional fields */
 6915 };
 6916 
 6917 /*
 6918 ** CAPI3REF: Virtual Table Cursor Object
 6919 ** KEYWORDS: sqlite3_vtab_cursor {virtual table cursor}
 6920 **
 6921 ** Every [virtual table module] implementation uses a subclass of the
 6922 ** following structure to describe cursors that point into the
 6923 ** [virtual table] and are used
 6924 ** to loop through the virtual table.  Cursors are created using the
 6925 ** [sqlite3_module.xOpen | xOpen] method of the module and are destroyed
 6926 ** by the [sqlite3_module.xClose | xClose] method.  Cursors are used
 6927 ** by the [xFilter], [xNext], [xEof], [xColumn], and [xRowid] methods
 6928 ** of the module.  Each module implementation will define
 6929 ** the content of a cursor structure to suit its own needs.
 6930 **
 6931 ** This superclass exists in order to define fields of the cursor that
 6932 ** are common to all implementations.
 6933 */
 6934 struct sqlite3_vtab_cursor {
 6935   sqlite3_vtab *pVtab;      /* Virtual table of this cursor */
 6936   /* Virtual table implementations will typically add additional fields */
 6937 };
 6938 
 6939 /*
 6940 ** CAPI3REF: Declare The Schema Of A Virtual Table
 6941 **
 6942 ** ^The [xCreate] and [xConnect] methods of a
 6943 ** [virtual table module] call this interface
 6944 ** to declare the format (the names and datatypes of the columns) of
 6945 ** the virtual tables they implement.
 6946 */
 6947 SQLITE_API int sqlite3_declare_vtab(sqlite3*, const char *zSQL);
 6948 
 6949 /*
 6950 ** CAPI3REF: Overload A Function For A Virtual Table
 6951 ** METHOD: sqlite3
 6952 **
 6953 ** ^(Virtual tables can provide alternative implementations of functions
 6954 ** using the [xFindFunction] method of the [virtual table module].
 6955 ** But global versions of those functions
 6956 ** must exist in order to be overloaded.)^
 6957 **
 6958 ** ^(This API makes sure a global version of a function with a particular
 6959 ** name and number of parameters exists.  If no such function exists
 6960 ** before this API is called, a new function is created.)^  ^The implementation
 6961 ** of the new function always causes an exception to be thrown.  So
 6962 ** the new function is not good for anything by itself.  Its only
 6963 ** purpose is to be a placeholder function that can be overloaded
 6964 ** by a [virtual table].
 6965 */
 6966 SQLITE_API int sqlite3_overload_function(sqlite3*, const char *zFuncName, int nArg);
 6967 
 6968 /*
 6969 ** The interface to the virtual-table mechanism defined above (back up
 6970 ** to a comment remarkably similar to this one) is currently considered
 6971 ** to be experimental.  The interface might change in incompatible ways.
 6972 ** If this is a problem for you, do not use the interface at this time.
 6973 **
 6974 ** When the virtual-table mechanism stabilizes, we will declare the
 6975 ** interface fixed, support it indefinitely, and remove this comment.
 6976 */
 6977 
 6978 /*
 6979 ** CAPI3REF: A Handle To An Open BLOB
 6980 ** KEYWORDS: {BLOB handle} {BLOB handles}
 6981 **
 6982 ** An instance of this object represents an open BLOB on which
 6983 ** [sqlite3_blob_open | incremental BLOB I/O] can be performed.
 6984 ** ^Objects of this type are created by [sqlite3_blob_open()]
 6985 ** and destroyed by [sqlite3_blob_close()].
 6986 ** ^The [sqlite3_blob_read()] and [sqlite3_blob_write()] interfaces
 6987 ** can be used to read or write small subsections of the BLOB.
 6988 ** ^The [sqlite3_blob_bytes()] interface returns the size of the BLOB in bytes.
 6989 */
 6990 typedef struct sqlite3_blob sqlite3_blob;
 6991 
 6992 /*
 6993 ** CAPI3REF: Open A BLOB For Incremental I/O
 6994 ** METHOD: sqlite3
 6995 ** CONSTRUCTOR: sqlite3_blob
 6996 **
 6997 ** ^(This interfaces opens a [BLOB handle | handle] to the BLOB located
 6998 ** in row iRow, column zColumn, table zTable in database zDb;
 6999 ** in other words, the same BLOB that would be selected by:
 7000 **
 7001 ** &lt;pre&gt;
 7002 **     SELECT zColumn FROM zDb.zTable WHERE [rowid] = iRow;
 7003 ** &lt;/pre&gt;)^
 7004 **
 7005 ** ^(Parameter zDb is not the filename that contains the database, but
 7006 ** rather the symbolic name of the database. For attached databases, this is
 7007 ** the name that appears after the AS keyword in the [ATTACH] statement.
 7008 ** For the main database file, the database name is &quot;main&quot;. For TEMP
 7009 ** tables, the database name is &quot;temp&quot;.)^
 7010 **
 7011 ** ^If the flags parameter is non-zero, then the BLOB is opened for read
 7012 ** and write access. ^If the flags parameter is zero, the BLOB is opened for
 7013 ** read-only access.
 7014 **
 7015 ** ^(On success, [SQLITE_OK] is returned and the new [BLOB handle] is stored
 7016 ** in *ppBlob. Otherwise an [error code] is returned and, unless the error
 7017 ** code is SQLITE_MISUSE, *ppBlob is set to NULL.)^ ^This means that, provided
 7018 ** the API is not misused, it is always safe to call [sqlite3_blob_close()]
 7019 ** on *ppBlob after this function it returns.
 7020 **
 7021 ** This function fails with SQLITE_ERROR if any of the following are true:
 7022 ** &lt;ul&gt;
 7023 **   &lt;li&gt; ^(Database zDb does not exist)^,
 7024 **   &lt;li&gt; ^(Table zTable does not exist within database zDb)^,
 7025 **   &lt;li&gt; ^(Table zTable is a WITHOUT ROWID table)^,
 7026 **   &lt;li&gt; ^(Column zColumn does not exist)^,
 7027 **   &lt;li&gt; ^(Row iRow is not present in the table)^,
 7028 **   &lt;li&gt; ^(The specified column of row iRow contains a value that is not
 7029 **         a TEXT or BLOB value)^,
 7030 **   &lt;li&gt; ^(Column zColumn is part of an index, PRIMARY KEY or UNIQUE
 7031 **         constraint and the blob is being opened for read/write access)^,
 7032 **   &lt;li&gt; ^([foreign key constraints | Foreign key constraints] are enabled,
 7033 **         column zColumn is part of a [child key] definition and the blob is
 7034 **         being opened for read/write access)^.
 7035 ** &lt;/ul&gt;
 7036 **
 7037 ** ^Unless it returns SQLITE_MISUSE, this function sets the
 7038 ** [database connection] error code and message accessible via
 7039 ** [sqlite3_errcode()] and [sqlite3_errmsg()] and related functions.
 7040 **
 7041 ** A BLOB referenced by sqlite3_blob_open() may be read using the
 7042 ** [sqlite3_blob_read()] interface and modified by using
 7043 ** [sqlite3_blob_write()].  The [BLOB handle] can be moved to a
 7044 ** different row of the same table using the [sqlite3_blob_reopen()]
 7045 ** interface.  However, the column, table, or database of a [BLOB handle]
 7046 ** cannot be changed after the [BLOB handle] is opened.
 7047 **
 7048 ** ^(If the row that a BLOB handle points to is modified by an
 7049 ** [UPDATE], [DELETE], or by [ON CONFLICT] side-effects
 7050 ** then the BLOB handle is marked as &quot;expired&quot;.
 7051 ** This is true if any column of the row is changed, even a column
 7052 ** other than the one the BLOB handle is open on.)^
 7053 ** ^Calls to [sqlite3_blob_read()] and [sqlite3_blob_write()] for
 7054 ** an expired BLOB handle fail with a return code of [SQLITE_ABORT].
 7055 ** ^(Changes written into a BLOB prior to the BLOB expiring are not
 7056 ** rolled back by the expiration of the BLOB.  Such changes will eventually
 7057 ** commit if the transaction continues to completion.)^
 7058 **
 7059 ** ^Use the [sqlite3_blob_bytes()] interface to determine the size of
 7060 ** the opened blob.  ^The size of a blob may not be changed by this
 7061 ** interface.  Use the [UPDATE] SQL command to change the size of a
 7062 ** blob.
 7063 **
 7064 ** ^The [sqlite3_bind_zeroblob()] and [sqlite3_result_zeroblob()] interfaces
 7065 ** and the built-in [zeroblob] SQL function may be used to create a
 7066 ** zero-filled blob to read or write using the incremental-blob interface.
 7067 **
 7068 ** To avoid a resource leak, every open [BLOB handle] should eventually
 7069 ** be released by a call to [sqlite3_blob_close()].
 7070 **
 7071 ** See also: [sqlite3_blob_close()],
 7072 ** [sqlite3_blob_reopen()], [sqlite3_blob_read()],
 7073 ** [sqlite3_blob_bytes()], [sqlite3_blob_write()].
 7074 */
 7075 SQLITE_API int sqlite3_blob_open(
 7076   sqlite3*,
 7077   const char *zDb,
 7078   const char *zTable,
 7079   const char *zColumn,
 7080   sqlite3_int64 iRow,
 7081   int flags,
 7082   sqlite3_blob **ppBlob
 7083 );
 7084 
 7085 /*
 7086 ** CAPI3REF: Move a BLOB Handle to a New Row
 7087 ** METHOD: sqlite3_blob
 7088 **
 7089 ** ^This function is used to move an existing [BLOB handle] so that it points
 7090 ** to a different row of the same database table. ^The new row is identified
 7091 ** by the rowid value passed as the second argument. Only the row can be
 7092 ** changed. ^The database, table and column on which the blob handle is open
 7093 ** remain the same. Moving an existing [BLOB handle] to a new row is
 7094 ** faster than closing the existing handle and opening a new one.
 7095 **
 7096 ** ^(The new row must meet the same criteria as for [sqlite3_blob_open()] -
 7097 ** it must exist and there must be either a blob or text value stored in
 7098 ** the nominated column.)^ ^If the new row is not present in the table, or if
 7099 ** it does not contain a blob or text value, or if another error occurs, an
 7100 ** SQLite error code is returned and the blob handle is considered aborted.
 7101 ** ^All subsequent calls to [sqlite3_blob_read()], [sqlite3_blob_write()] or
 7102 ** [sqlite3_blob_reopen()] on an aborted blob handle immediately return
 7103 ** SQLITE_ABORT. ^Calling [sqlite3_blob_bytes()] on an aborted blob handle
 7104 ** always returns zero.
 7105 **
 7106 ** ^This function sets the database handle error code and message.
 7107 */
 7108 SQLITE_API int sqlite3_blob_reopen(sqlite3_blob *, sqlite3_int64);
 7109 
 7110 /*
 7111 ** CAPI3REF: Close A BLOB Handle
 7112 ** DESTRUCTOR: sqlite3_blob
 7113 **
 7114 ** ^This function closes an open [BLOB handle]. ^(The BLOB handle is closed
 7115 ** unconditionally.  Even if this routine returns an error code, the
 7116 ** handle is still closed.)^
 7117 **
 7118 ** ^If the blob handle being closed was opened for read-write access, and if
 7119 ** the database is in auto-commit mode and there are no other open read-write
 7120 ** blob handles or active write statements, the current transaction is
 7121 ** committed. ^If an error occurs while committing the transaction, an error
 7122 ** code is returned and the transaction rolled back.
 7123 **
 7124 ** Calling this function with an argument that is not a NULL pointer or an
 7125 ** open blob handle results in undefined behaviour. ^Calling this routine
 7126 ** with a null pointer (such as would be returned by a failed call to
 7127 ** [sqlite3_blob_open()]) is a harmless no-op. ^Otherwise, if this function
 7128 ** is passed a valid open blob handle, the values returned by the
 7129 ** sqlite3_errcode() and sqlite3_errmsg() functions are set before returning.
 7130 */
 7131 SQLITE_API int sqlite3_blob_close(sqlite3_blob *);
 7132 
 7133 /*
 7134 ** CAPI3REF: Return The Size Of An Open BLOB
 7135 ** METHOD: sqlite3_blob
 7136 **
 7137 ** ^Returns the size in bytes of the BLOB accessible via the
 7138 ** successfully opened [BLOB handle] in its only argument.  ^The
 7139 ** incremental blob I/O routines can only read or overwriting existing
 7140 ** blob content; they cannot change the size of a blob.
 7141 **
 7142 ** This routine only works on a [BLOB handle] which has been created
 7143 ** by a prior successful call to [sqlite3_blob_open()] and which has not
 7144 ** been closed by [sqlite3_blob_close()].  Passing any other pointer in
 7145 ** to this routine results in undefined and probably undesirable behavior.
 7146 */
 7147 SQLITE_API int sqlite3_blob_bytes(sqlite3_blob *);
 7148 
 7149 /*
 7150 ** CAPI3REF: Read Data From A BLOB Incrementally
 7151 ** METHOD: sqlite3_blob
 7152 **
 7153 ** ^(This function is used to read data from an open [BLOB handle] into a
 7154 ** caller-supplied buffer. N bytes of data are copied into buffer Z
 7155 ** from the open BLOB, starting at offset iOffset.)^
 7156 **
 7157 ** ^If offset iOffset is less than N bytes from the end of the BLOB,
 7158 ** [SQLITE_ERROR] is returned and no data is read.  ^If N or iOffset is
 7159 ** less than zero, [SQLITE_ERROR] is returned and no data is read.
 7160 ** ^The size of the blob (and hence the maximum value of N+iOffset)
 7161 ** can be determined using the [sqlite3_blob_bytes()] interface.
 7162 **
 7163 ** ^An attempt to read from an expired [BLOB handle] fails with an
 7164 ** error code of [SQLITE_ABORT].
 7165 **
 7166 ** ^(On success, sqlite3_blob_read() returns SQLITE_OK.
 7167 ** Otherwise, an [error code] or an [extended error code] is returned.)^
 7168 **
 7169 ** This routine only works on a [BLOB handle] which has been created
 7170 ** by a prior successful call to [sqlite3_blob_open()] and which has not
 7171 ** been closed by [sqlite3_blob_close()].  Passing any other pointer in
 7172 ** to this routine results in undefined and probably undesirable behavior.
 7173 **
 7174 ** See also: [sqlite3_blob_write()].
 7175 */
 7176 SQLITE_API int sqlite3_blob_read(sqlite3_blob *, void *Z, int N, int iOffset);
 7177 
 7178 /*
 7179 ** CAPI3REF: Write Data Into A BLOB Incrementally
 7180 ** METHOD: sqlite3_blob
 7181 **
 7182 ** ^(This function is used to write data into an open [BLOB handle] from a
 7183 ** caller-supplied buffer. N bytes of data are copied from the buffer Z
 7184 ** into the open BLOB, starting at offset iOffset.)^
 7185 **
 7186 ** ^(On success, sqlite3_blob_write() returns SQLITE_OK.
 7187 ** Otherwise, an  [error code] or an [extended error code] is returned.)^
 7188 ** ^Unless SQLITE_MISUSE is returned, this function sets the
 7189 ** [database connection] error code and message accessible via
 7190 ** [sqlite3_errcode()] and [sqlite3_errmsg()] and related functions.
 7191 **
 7192 ** ^If the [BLOB handle] passed as the first argument was not opened for
 7193 ** writing (the flags parameter to [sqlite3_blob_open()] was zero),
 7194 ** this function returns [SQLITE_READONLY].
 7195 **
 7196 ** This function may only modify the contents of the BLOB; it is
 7197 ** not possible to increase the size of a BLOB using this API.
 7198 ** ^If offset iOffset is less than N bytes from the end of the BLOB,
 7199 ** [SQLITE_ERROR] is returned and no data is written. The size of the
 7200 ** BLOB (and hence the maximum value of N+iOffset) can be determined
 7201 ** using the [sqlite3_blob_bytes()] interface. ^If N or iOffset are less
 7202 ** than zero [SQLITE_ERROR] is returned and no data is written.
 7203 **
 7204 ** ^An attempt to write to an expired [BLOB handle] fails with an
 7205 ** error code of [SQLITE_ABORT].  ^Writes to the BLOB that occurred
 7206 ** before the [BLOB handle] expired are not rolled back by the
 7207 ** expiration of the handle, though of course those changes might
 7208 ** have been overwritten by the statement that expired the BLOB handle
 7209 ** or by other independent statements.
 7210 **
 7211 ** This routine only works on a [BLOB handle] which has been created
 7212 ** by a prior successful call to [sqlite3_blob_open()] and which has not
 7213 ** been closed by [sqlite3_blob_close()].  Passing any other pointer in
 7214 ** to this routine results in undefined and probably undesirable behavior.
 7215 **
 7216 ** See also: [sqlite3_blob_read()].
 7217 */
 7218 SQLITE_API int sqlite3_blob_write(sqlite3_blob *, const void *z, int n, int iOffset);
 7219 
 7220 /*
 7221 ** CAPI3REF: Virtual File System Objects
 7222 **
 7223 ** A virtual filesystem (VFS) is an [sqlite3_vfs] object
 7224 ** that SQLite uses to interact
 7225 ** with the underlying operating system.  Most SQLite builds come with a
 7226 ** single default VFS that is appropriate for the host computer.
 7227 ** New VFSes can be registered and existing VFSes can be unregistered.
 7228 ** The following interfaces are provided.
 7229 **
 7230 ** ^The sqlite3_vfs_find() interface returns a pointer to a VFS given its name.
 7231 ** ^Names are case sensitive.
 7232 ** ^Names are zero-terminated UTF-8 strings.
 7233 ** ^If there is no match, a NULL pointer is returned.
 7234 ** ^If zVfsName is NULL then the default VFS is returned.
 7235 **
 7236 ** ^New VFSes are registered with sqlite3_vfs_register().
 7237 ** ^Each new VFS becomes the default VFS if the makeDflt flag is set.
 7238 ** ^The same VFS can be registered multiple times without injury.
 7239 ** ^To make an existing VFS into the default VFS, register it again
 7240 ** with the makeDflt flag set.  If two different VFSes with the
 7241 ** same name are registered, the behavior is undefined.  If a
 7242 ** VFS is registered with a name that is NULL or an empty string,
 7243 ** then the behavior is undefined.
 7244 **
 7245 ** ^Unregister a VFS with the sqlite3_vfs_unregister() interface.
 7246 ** ^(If the default VFS is unregistered, another VFS is chosen as
 7247 ** the default.  The choice for the new VFS is arbitrary.)^
 7248 */
 7249 SQLITE_API sqlite3_vfs *sqlite3_vfs_find(const char *zVfsName);
 7250 SQLITE_API int sqlite3_vfs_register(sqlite3_vfs*, int makeDflt);
 7251 SQLITE_API int sqlite3_vfs_unregister(sqlite3_vfs*);
 7252 
 7253 /*
 7254 ** CAPI3REF: Mutexes
 7255 **
 7256 ** The SQLite core uses these routines for thread
 7257 ** synchronization. Though they are intended for internal
 7258 ** use by SQLite, code that links against SQLite is
 7259 ** permitted to use any of these routines.
 7260 **
 7261 ** The SQLite source code contains multiple implementations
 7262 ** of these mutex routines.  An appropriate implementation
 7263 ** is selected automatically at compile-time.  The following
 7264 ** implementations are available in the SQLite core:
 7265 **
 7266 ** &lt;ul&gt;
 7267 ** &lt;li&gt;   SQLITE_MUTEX_PTHREADS
 7268 ** &lt;li&gt;   SQLITE_MUTEX_W32
 7269 ** &lt;li&gt;   SQLITE_MUTEX_NOOP
 7270 ** &lt;/ul&gt;
 7271 **
 7272 ** The SQLITE_MUTEX_NOOP implementation is a set of routines
 7273 ** that does no real locking and is appropriate for use in
 7274 ** a single-threaded application.  The SQLITE_MUTEX_PTHREADS and
 7275 ** SQLITE_MUTEX_W32 implementations are appropriate for use on Unix
 7276 ** and Windows.
 7277 **
 7278 ** If SQLite is compiled with the SQLITE_MUTEX_APPDEF preprocessor
 7279 ** macro defined (with &quot;-DSQLITE_MUTEX_APPDEF=1&quot;), then no mutex
 7280 ** implementation is included with the library. In this case the
 7281 ** application must supply a custom mutex implementation using the
 7282 ** [SQLITE_CONFIG_MUTEX] option of the sqlite3_config() function
 7283 ** before calling sqlite3_initialize() or any other public sqlite3_
 7284 ** function that calls sqlite3_initialize().
 7285 **
 7286 ** ^The sqlite3_mutex_alloc() routine allocates a new
 7287 ** mutex and returns a pointer to it. ^The sqlite3_mutex_alloc()
 7288 ** routine returns NULL if it is unable to allocate the requested
 7289 ** mutex.  The argument to sqlite3_mutex_alloc() must one of these
 7290 ** integer constants:
 7291 **
 7292 ** &lt;ul&gt;
 7293 ** &lt;li&gt;  SQLITE_MUTEX_FAST
 7294 ** &lt;li&gt;  SQLITE_MUTEX_RECURSIVE
 7295 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_MASTER
 7296 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_MEM
 7297 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_OPEN
 7298 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_PRNG
 7299 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_LRU
 7300 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_PMEM
 7301 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_APP1
 7302 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_APP2
 7303 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_APP3
 7304 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_VFS1
 7305 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_VFS2
 7306 ** &lt;li&gt;  SQLITE_MUTEX_STATIC_VFS3
 7307 ** &lt;/ul&gt;
 7308 **
 7309 ** ^The first two constants (SQLITE_MUTEX_FAST and SQLITE_MUTEX_RECURSIVE)
 7310 ** cause sqlite3_mutex_alloc() to create
 7311 ** a new mutex.  ^The new mutex is recursive when SQLITE_MUTEX_RECURSIVE
 7312 ** is used but not necessarily so when SQLITE_MUTEX_FAST is used.
 7313 ** The mutex implementation does not need to make a distinction
 7314 ** between SQLITE_MUTEX_RECURSIVE and SQLITE_MUTEX_FAST if it does
 7315 ** not want to.  SQLite will only request a recursive mutex in
 7316 ** cases where it really needs one.  If a faster non-recursive mutex
 7317 ** implementation is available on the host platform, the mutex subsystem
 7318 ** might return such a mutex in response to SQLITE_MUTEX_FAST.
 7319 **
 7320 ** ^The other allowed parameters to sqlite3_mutex_alloc() (anything other
 7321 ** than SQLITE_MUTEX_FAST and SQLITE_MUTEX_RECURSIVE) each return
 7322 ** a pointer to a static preexisting mutex.  ^Nine static mutexes are
 7323 ** used by the current version of SQLite.  Future versions of SQLite
 7324 ** may add additional static mutexes.  Static mutexes are for internal
 7325 ** use by SQLite only.  Applications that use SQLite mutexes should
 7326 ** use only the dynamic mutexes returned by SQLITE_MUTEX_FAST or
 7327 ** SQLITE_MUTEX_RECURSIVE.
 7328 **
 7329 ** ^Note that if one of the dynamic mutex parameters (SQLITE_MUTEX_FAST
 7330 ** or SQLITE_MUTEX_RECURSIVE) is used then sqlite3_mutex_alloc()
 7331 ** returns a different mutex on every call.  ^For the static
 7332 ** mutex types, the same mutex is returned on every call that has
 7333 ** the same type number.
 7334 **
 7335 ** ^The sqlite3_mutex_free() routine deallocates a previously
 7336 ** allocated dynamic mutex.  Attempting to deallocate a static
 7337 ** mutex results in undefined behavior.
 7338 **
 7339 ** ^The sqlite3_mutex_enter() and sqlite3_mutex_try() routines attempt
 7340 ** to enter a mutex.  ^If another thread is already within the mutex,
 7341 ** sqlite3_mutex_enter() will block and sqlite3_mutex_try() will return
 7342 ** SQLITE_BUSY.  ^The sqlite3_mutex_try() interface returns [SQLITE_OK]
 7343 ** upon successful entry.  ^(Mutexes created using
 7344 ** SQLITE_MUTEX_RECURSIVE can be entered multiple times by the same thread.
 7345 ** In such cases, the
 7346 ** mutex must be exited an equal number of times before another thread
 7347 ** can enter.)^  If the same thread tries to enter any mutex other
 7348 ** than an SQLITE_MUTEX_RECURSIVE more than once, the behavior is undefined.
 7349 **
 7350 ** ^(Some systems (for example, Windows 95) do not support the operation
 7351 ** implemented by sqlite3_mutex_try().  On those systems, sqlite3_mutex_try()
 7352 ** will always return SQLITE_BUSY. The SQLite core only ever uses
 7353 ** sqlite3_mutex_try() as an optimization so this is acceptable
 7354 ** behavior.)^
 7355 **
 7356 ** ^The sqlite3_mutex_leave() routine exits a mutex that was
 7357 ** previously entered by the same thread.   The behavior
 7358 ** is undefined if the mutex is not currently entered by the
 7359 ** calling thread or is not currently allocated.
 7360 **
 7361 ** ^If the argument to sqlite3_mutex_enter(), sqlite3_mutex_try(), or
 7362 ** sqlite3_mutex_leave() is a NULL pointer, then all three routines
 7363 ** behave as no-ops.
 7364 **
 7365 ** See also: [sqlite3_mutex_held()] and [sqlite3_mutex_notheld()].
 7366 */
 7367 SQLITE_API sqlite3_mutex *sqlite3_mutex_alloc(int);
 7368 SQLITE_API void sqlite3_mutex_free(sqlite3_mutex*);
 7369 SQLITE_API void sqlite3_mutex_enter(sqlite3_mutex*);
 7370 SQLITE_API int sqlite3_mutex_try(sqlite3_mutex*);
 7371 SQLITE_API void sqlite3_mutex_leave(sqlite3_mutex*);
 7372 
 7373 /*
 7374 ** CAPI3REF: Mutex Methods Object
 7375 **
 7376 ** An instance of this structure defines the low-level routines
 7377 ** used to allocate and use mutexes.
 7378 **
 7379 ** Usually, the default mutex implementations provided by SQLite are
 7380 ** sufficient, however the application has the option of substituting a custom
 7381 ** implementation for specialized deployments or systems for which SQLite
 7382 ** does not provide a suitable implementation. In this case, the application
 7383 ** creates and populates an instance of this structure to pass
 7384 ** to sqlite3_config() along with the [SQLITE_CONFIG_MUTEX] option.
 7385 ** Additionally, an instance of this structure can be used as an
 7386 ** output variable when querying the system for the current mutex
 7387 ** implementation, using the [SQLITE_CONFIG_GETMUTEX] option.
 7388 **
 7389 ** ^The xMutexInit method defined by this structure is invoked as
 7390 ** part of system initialization by the sqlite3_initialize() function.
 7391 ** ^The xMutexInit routine is called by SQLite exactly once for each
 7392 ** effective call to [sqlite3_initialize()].
 7393 **
 7394 ** ^The xMutexEnd method defined by this structure is invoked as
 7395 ** part of system shutdown by the sqlite3_shutdown() function. The
 7396 ** implementation of this method is expected to release all outstanding
 7397 ** resources obtained by the mutex methods implementation, especially
 7398 ** those obtained by the xMutexInit method.  ^The xMutexEnd()
 7399 ** interface is invoked exactly once for each call to [sqlite3_shutdown()].
 7400 **
 7401 ** ^(The remaining seven methods defined by this structure (xMutexAlloc,
 7402 ** xMutexFree, xMutexEnter, xMutexTry, xMutexLeave, xMutexHeld and
 7403 ** xMutexNotheld) implement the following interfaces (respectively):
 7404 **
 7405 ** &lt;ul&gt;
 7406 **   &lt;li&gt;  [sqlite3_mutex_alloc()] &lt;/li&gt;
 7407 **   &lt;li&gt;  [sqlite3_mutex_free()] &lt;/li&gt;
 7408 **   &lt;li&gt;  [sqlite3_mutex_enter()] &lt;/li&gt;
 7409 **   &lt;li&gt;  [sqlite3_mutex_try()] &lt;/li&gt;
 7410 **   &lt;li&gt;  [sqlite3_mutex_leave()] &lt;/li&gt;
 7411 **   &lt;li&gt;  [sqlite3_mutex_held()] &lt;/li&gt;
 7412 **   &lt;li&gt;  [sqlite3_mutex_notheld()] &lt;/li&gt;
 7413 ** &lt;/ul&gt;)^
 7414 **
 7415 ** The only difference is that the public sqlite3_XXX functions enumerated
 7416 ** above silently ignore any invocations that pass a NULL pointer instead
 7417 ** of a valid mutex handle. The implementations of the methods defined
<a name="78" id="anc78"></a><span class="line-modified"> 7418 ** by this structure are not required to handle this case. The results</span>
 7419 ** of passing a NULL pointer instead of a valid mutex handle are undefined
 7420 ** (i.e. it is acceptable to provide an implementation that segfaults if
 7421 ** it is passed a NULL pointer).
 7422 **
 7423 ** The xMutexInit() method must be threadsafe.  It must be harmless to
 7424 ** invoke xMutexInit() multiple times within the same process and without
 7425 ** intervening calls to xMutexEnd().  Second and subsequent calls to
 7426 ** xMutexInit() must be no-ops.
 7427 **
 7428 ** xMutexInit() must not use SQLite memory allocation ([sqlite3_malloc()]
 7429 ** and its associates).  Similarly, xMutexAlloc() must not use SQLite memory
 7430 ** allocation for a static mutex.  ^However xMutexAlloc() may use SQLite
 7431 ** memory allocation for a fast or recursive mutex.
 7432 **
 7433 ** ^SQLite will invoke the xMutexEnd() method when [sqlite3_shutdown()] is
 7434 ** called, but only if the prior call to xMutexInit returned SQLITE_OK.
 7435 ** If xMutexInit fails in any way, it is expected to clean up after itself
 7436 ** prior to returning.
 7437 */
 7438 typedef struct sqlite3_mutex_methods sqlite3_mutex_methods;
 7439 struct sqlite3_mutex_methods {
 7440   int (*xMutexInit)(void);
 7441   int (*xMutexEnd)(void);
 7442   sqlite3_mutex *(*xMutexAlloc)(int);
 7443   void (*xMutexFree)(sqlite3_mutex *);
 7444   void (*xMutexEnter)(sqlite3_mutex *);
 7445   int (*xMutexTry)(sqlite3_mutex *);
 7446   void (*xMutexLeave)(sqlite3_mutex *);
 7447   int (*xMutexHeld)(sqlite3_mutex *);
 7448   int (*xMutexNotheld)(sqlite3_mutex *);
 7449 };
 7450 
 7451 /*
 7452 ** CAPI3REF: Mutex Verification Routines
 7453 **
 7454 ** The sqlite3_mutex_held() and sqlite3_mutex_notheld() routines
 7455 ** are intended for use inside assert() statements.  The SQLite core
 7456 ** never uses these routines except inside an assert() and applications
 7457 ** are advised to follow the lead of the core.  The SQLite core only
 7458 ** provides implementations for these routines when it is compiled
 7459 ** with the SQLITE_DEBUG flag.  External mutex implementations
 7460 ** are only required to provide these routines if SQLITE_DEBUG is
 7461 ** defined and if NDEBUG is not defined.
 7462 **
 7463 ** These routines should return true if the mutex in their argument
 7464 ** is held or not held, respectively, by the calling thread.
 7465 **
 7466 ** The implementation is not required to provide versions of these
 7467 ** routines that actually work. If the implementation does not provide working
 7468 ** versions of these routines, it should at least provide stubs that always
 7469 ** return true so that one does not get spurious assertion failures.
 7470 **
 7471 ** If the argument to sqlite3_mutex_held() is a NULL pointer then
 7472 ** the routine should return 1.   This seems counter-intuitive since
 7473 ** clearly the mutex cannot be held if it does not exist.  But
 7474 ** the reason the mutex does not exist is because the build is not
 7475 ** using mutexes.  And we do not want the assert() containing the
 7476 ** call to sqlite3_mutex_held() to fail, so a non-zero return is
 7477 ** the appropriate thing to do.  The sqlite3_mutex_notheld()
 7478 ** interface should also return 1 when given a NULL pointer.
 7479 */
 7480 #ifndef NDEBUG
 7481 SQLITE_API int sqlite3_mutex_held(sqlite3_mutex*);
 7482 SQLITE_API int sqlite3_mutex_notheld(sqlite3_mutex*);
 7483 #endif
 7484 
 7485 /*
 7486 ** CAPI3REF: Mutex Types
 7487 **
 7488 ** The [sqlite3_mutex_alloc()] interface takes a single argument
 7489 ** which is one of these integer constants.
 7490 **
 7491 ** The set of static mutexes may change from one SQLite release to the
 7492 ** next.  Applications that override the built-in mutex logic must be
 7493 ** prepared to accommodate additional static mutexes.
 7494 */
 7495 #define SQLITE_MUTEX_FAST             0
 7496 #define SQLITE_MUTEX_RECURSIVE        1
 7497 #define SQLITE_MUTEX_STATIC_MASTER    2
 7498 #define SQLITE_MUTEX_STATIC_MEM       3  /* sqlite3_malloc() */
 7499 #define SQLITE_MUTEX_STATIC_MEM2      4  /* NOT USED */
 7500 #define SQLITE_MUTEX_STATIC_OPEN      4  /* sqlite3BtreeOpen() */
 7501 #define SQLITE_MUTEX_STATIC_PRNG      5  /* sqlite3_randomness() */
 7502 #define SQLITE_MUTEX_STATIC_LRU       6  /* lru page list */
 7503 #define SQLITE_MUTEX_STATIC_LRU2      7  /* NOT USED */
 7504 #define SQLITE_MUTEX_STATIC_PMEM      7  /* sqlite3PageMalloc() */
 7505 #define SQLITE_MUTEX_STATIC_APP1      8  /* For use by application */
 7506 #define SQLITE_MUTEX_STATIC_APP2      9  /* For use by application */
 7507 #define SQLITE_MUTEX_STATIC_APP3     10  /* For use by application */
 7508 #define SQLITE_MUTEX_STATIC_VFS1     11  /* For use by built-in VFS */
 7509 #define SQLITE_MUTEX_STATIC_VFS2     12  /* For use by extension VFS */
 7510 #define SQLITE_MUTEX_STATIC_VFS3     13  /* For use by application VFS */
 7511 
 7512 /*
 7513 ** CAPI3REF: Retrieve the mutex for a database connection
 7514 ** METHOD: sqlite3
 7515 **
 7516 ** ^This interface returns a pointer the [sqlite3_mutex] object that
 7517 ** serializes access to the [database connection] given in the argument
 7518 ** when the [threading mode] is Serialized.
 7519 ** ^If the [threading mode] is Single-thread or Multi-thread then this
 7520 ** routine returns a NULL pointer.
 7521 */
 7522 SQLITE_API sqlite3_mutex *sqlite3_db_mutex(sqlite3*);
 7523 
 7524 /*
 7525 ** CAPI3REF: Low-Level Control Of Database Files
 7526 ** METHOD: sqlite3
 7527 ** KEYWORDS: {file control}
 7528 **
 7529 ** ^The [sqlite3_file_control()] interface makes a direct call to the
 7530 ** xFileControl method for the [sqlite3_io_methods] object associated
 7531 ** with a particular database identified by the second argument. ^The
 7532 ** name of the database is &quot;main&quot; for the main database or &quot;temp&quot; for the
 7533 ** TEMP database, or the name that appears after the AS keyword for
 7534 ** databases that are added using the [ATTACH] SQL command.
 7535 ** ^A NULL pointer can be used in place of &quot;main&quot; to refer to the
 7536 ** main database file.
 7537 ** ^The third and fourth parameters to this routine
 7538 ** are passed directly through to the second and third parameters of
 7539 ** the xFileControl method.  ^The return value of the xFileControl
 7540 ** method becomes the return value of this routine.
 7541 **
 7542 ** A few opcodes for [sqlite3_file_control()] are handled directly
 7543 ** by the SQLite core and never invoke the
 7544 ** sqlite3_io_methods.xFileControl method.
 7545 ** ^The [SQLITE_FCNTL_FILE_POINTER] value for the op parameter causes
 7546 ** a pointer to the underlying [sqlite3_file] object to be written into
 7547 ** the space pointed to by the 4th parameter.  The
 7548 ** [SQLITE_FCNTL_JOURNAL_POINTER] works similarly except that it returns
 7549 ** the [sqlite3_file] object associated with the journal file instead of
 7550 ** the main database.  The [SQLITE_FCNTL_VFS_POINTER] opcode returns
 7551 ** a pointer to the underlying [sqlite3_vfs] object for the file.
 7552 ** The [SQLITE_FCNTL_DATA_VERSION] returns the data version counter
 7553 ** from the pager.
 7554 **
 7555 ** ^If the second parameter (zDbName) does not match the name of any
 7556 ** open database file, then SQLITE_ERROR is returned.  ^This error
 7557 ** code is not remembered and will not be recalled by [sqlite3_errcode()]
 7558 ** or [sqlite3_errmsg()].  The underlying xFileControl method might
 7559 ** also return SQLITE_ERROR.  There is no way to distinguish between
 7560 ** an incorrect zDbName and an SQLITE_ERROR return from the underlying
 7561 ** xFileControl method.
 7562 **
 7563 ** See also: [file control opcodes]
 7564 */
 7565 SQLITE_API int sqlite3_file_control(sqlite3*, const char *zDbName, int op, void*);
 7566 
 7567 /*
 7568 ** CAPI3REF: Testing Interface
 7569 **
 7570 ** ^The sqlite3_test_control() interface is used to read out internal
 7571 ** state of SQLite and to inject faults into SQLite for testing
 7572 ** purposes.  ^The first parameter is an operation code that determines
 7573 ** the number, meaning, and operation of all subsequent parameters.
 7574 **
 7575 ** This interface is not for use by applications.  It exists solely
 7576 ** for verifying the correct operation of the SQLite library.  Depending
 7577 ** on how the SQLite library is compiled, this interface might not exist.
 7578 **
 7579 ** The details of the operation codes, their meanings, the parameters
 7580 ** they take, and what they do are all subject to change without notice.
 7581 ** Unlike most of the SQLite API, this function is not guaranteed to
 7582 ** operate consistently from one release to the next.
 7583 */
 7584 SQLITE_API int sqlite3_test_control(int op, ...);
 7585 
 7586 /*
 7587 ** CAPI3REF: Testing Interface Operation Codes
 7588 **
 7589 ** These constants are the valid operation code parameters used
 7590 ** as the first argument to [sqlite3_test_control()].
 7591 **
 7592 ** These parameters and their meanings are subject to change
 7593 ** without notice.  These values are for testing purposes only.
 7594 ** Applications should not use any of these parameters or the
 7595 ** [sqlite3_test_control()] interface.
 7596 */
 7597 #define SQLITE_TESTCTRL_FIRST                    5
 7598 #define SQLITE_TESTCTRL_PRNG_SAVE                5
 7599 #define SQLITE_TESTCTRL_PRNG_RESTORE             6
 7600 #define SQLITE_TESTCTRL_PRNG_RESET               7  /* NOT USED */
 7601 #define SQLITE_TESTCTRL_BITVEC_TEST              8
 7602 #define SQLITE_TESTCTRL_FAULT_INSTALL            9
 7603 #define SQLITE_TESTCTRL_BENIGN_MALLOC_HOOKS     10
 7604 #define SQLITE_TESTCTRL_PENDING_BYTE            11
 7605 #define SQLITE_TESTCTRL_ASSERT                  12
 7606 #define SQLITE_TESTCTRL_ALWAYS                  13
 7607 #define SQLITE_TESTCTRL_RESERVE                 14
 7608 #define SQLITE_TESTCTRL_OPTIMIZATIONS           15
 7609 #define SQLITE_TESTCTRL_ISKEYWORD               16  /* NOT USED */
 7610 #define SQLITE_TESTCTRL_SCRATCHMALLOC           17  /* NOT USED */
 7611 #define SQLITE_TESTCTRL_INTERNAL_FUNCTIONS      17
 7612 #define SQLITE_TESTCTRL_LOCALTIME_FAULT         18
 7613 #define SQLITE_TESTCTRL_EXPLAIN_STMT            19  /* NOT USED */
 7614 #define SQLITE_TESTCTRL_ONCE_RESET_THRESHOLD    19
 7615 #define SQLITE_TESTCTRL_NEVER_CORRUPT           20
 7616 #define SQLITE_TESTCTRL_VDBE_COVERAGE           21
 7617 #define SQLITE_TESTCTRL_BYTEORDER               22
 7618 #define SQLITE_TESTCTRL_ISINIT                  23
 7619 #define SQLITE_TESTCTRL_SORTER_MMAP             24
 7620 #define SQLITE_TESTCTRL_IMPOSTER                25
 7621 #define SQLITE_TESTCTRL_PARSER_COVERAGE         26
 7622 #define SQLITE_TESTCTRL_RESULT_INTREAL          27
 7623 #define SQLITE_TESTCTRL_PRNG_SEED               28
 7624 #define SQLITE_TESTCTRL_EXTRA_SCHEMA_CHECKS     29
 7625 #define SQLITE_TESTCTRL_LAST                    29  /* Largest TESTCTRL */
 7626 
 7627 /*
 7628 ** CAPI3REF: SQL Keyword Checking
 7629 **
 7630 ** These routines provide access to the set of SQL language keywords
 7631 ** recognized by SQLite.  Applications can uses these routines to determine
 7632 ** whether or not a specific identifier needs to be escaped (for example,
 7633 ** by enclosing in double-quotes) so as not to confuse the parser.
 7634 **
 7635 ** The sqlite3_keyword_count() interface returns the number of distinct
 7636 ** keywords understood by SQLite.
 7637 **
 7638 ** The sqlite3_keyword_name(N,Z,L) interface finds the N-th keyword and
 7639 ** makes *Z point to that keyword expressed as UTF8 and writes the number
 7640 ** of bytes in the keyword into *L.  The string that *Z points to is not
 7641 ** zero-terminated.  The sqlite3_keyword_name(N,Z,L) routine returns
 7642 ** SQLITE_OK if N is within bounds and SQLITE_ERROR if not. If either Z
 7643 ** or L are NULL or invalid pointers then calls to
 7644 ** sqlite3_keyword_name(N,Z,L) result in undefined behavior.
 7645 **
 7646 ** The sqlite3_keyword_check(Z,L) interface checks to see whether or not
 7647 ** the L-byte UTF8 identifier that Z points to is a keyword, returning non-zero
 7648 ** if it is and zero if not.
 7649 **
 7650 ** The parser used by SQLite is forgiving.  It is often possible to use
 7651 ** a keyword as an identifier as long as such use does not result in a
 7652 ** parsing ambiguity.  For example, the statement
 7653 ** &quot;CREATE TABLE BEGIN(REPLACE,PRAGMA,END);&quot; is accepted by SQLite, and
 7654 ** creates a new table named &quot;BEGIN&quot; with three columns named
 7655 ** &quot;REPLACE&quot;, &quot;PRAGMA&quot;, and &quot;END&quot;.  Nevertheless, best practice is to avoid
 7656 ** using keywords as identifiers.  Common techniques used to avoid keyword
 7657 ** name collisions include:
 7658 ** &lt;ul&gt;
 7659 ** &lt;li&gt; Put all identifier names inside double-quotes.  This is the official
 7660 **      SQL way to escape identifier names.
 7661 ** &lt;li&gt; Put identifier names inside &amp;#91;...&amp;#93;.  This is not standard SQL,
 7662 **      but it is what SQL Server does and so lots of programmers use this
 7663 **      technique.
 7664 ** &lt;li&gt; Begin every identifier with the letter &quot;Z&quot; as no SQL keywords start
 7665 **      with &quot;Z&quot;.
 7666 ** &lt;li&gt; Include a digit somewhere in every identifier name.
 7667 ** &lt;/ul&gt;
 7668 **
 7669 ** Note that the number of keywords understood by SQLite can depend on
 7670 ** compile-time options.  For example, &quot;VACUUM&quot; is not a keyword if
 7671 ** SQLite is compiled with the [-DSQLITE_OMIT_VACUUM] option.  Also,
 7672 ** new keywords may be added to future releases of SQLite.
 7673 */
 7674 SQLITE_API int sqlite3_keyword_count(void);
 7675 SQLITE_API int sqlite3_keyword_name(int,const char**,int*);
 7676 SQLITE_API int sqlite3_keyword_check(const char*,int);
 7677 
 7678 /*
 7679 ** CAPI3REF: Dynamic String Object
 7680 ** KEYWORDS: {dynamic string}
 7681 **
 7682 ** An instance of the sqlite3_str object contains a dynamically-sized
 7683 ** string under construction.
 7684 **
 7685 ** The lifecycle of an sqlite3_str object is as follows:
 7686 ** &lt;ol&gt;
 7687 ** &lt;li&gt; ^The sqlite3_str object is created using [sqlite3_str_new()].
 7688 ** &lt;li&gt; ^Text is appended to the sqlite3_str object using various
 7689 ** methods, such as [sqlite3_str_appendf()].
 7690 ** &lt;li&gt; ^The sqlite3_str object is destroyed and the string it created
 7691 ** is returned using the [sqlite3_str_finish()] interface.
 7692 ** &lt;/ol&gt;
 7693 */
 7694 typedef struct sqlite3_str sqlite3_str;
 7695 
 7696 /*
 7697 ** CAPI3REF: Create A New Dynamic String Object
 7698 ** CONSTRUCTOR: sqlite3_str
 7699 **
 7700 ** ^The [sqlite3_str_new(D)] interface allocates and initializes
 7701 ** a new [sqlite3_str] object.  To avoid memory leaks, the object returned by
 7702 ** [sqlite3_str_new()] must be freed by a subsequent call to
 7703 ** [sqlite3_str_finish(X)].
 7704 **
 7705 ** ^The [sqlite3_str_new(D)] interface always returns a pointer to a
 7706 ** valid [sqlite3_str] object, though in the event of an out-of-memory
 7707 ** error the returned object might be a special singleton that will
 7708 ** silently reject new text, always return SQLITE_NOMEM from
 7709 ** [sqlite3_str_errcode()], always return 0 for
 7710 ** [sqlite3_str_length()], and always return NULL from
 7711 ** [sqlite3_str_finish(X)].  It is always safe to use the value
 7712 ** returned by [sqlite3_str_new(D)] as the sqlite3_str parameter
 7713 ** to any of the other [sqlite3_str] methods.
 7714 **
 7715 ** The D parameter to [sqlite3_str_new(D)] may be NULL.  If the
 7716 ** D parameter in [sqlite3_str_new(D)] is not NULL, then the maximum
 7717 ** length of the string contained in the [sqlite3_str] object will be
 7718 ** the value set for [sqlite3_limit](D,[SQLITE_LIMIT_LENGTH]) instead
 7719 ** of [SQLITE_MAX_LENGTH].
 7720 */
 7721 SQLITE_API sqlite3_str *sqlite3_str_new(sqlite3*);
 7722 
 7723 /*
 7724 ** CAPI3REF: Finalize A Dynamic String
 7725 ** DESTRUCTOR: sqlite3_str
 7726 **
 7727 ** ^The [sqlite3_str_finish(X)] interface destroys the sqlite3_str object X
 7728 ** and returns a pointer to a memory buffer obtained from [sqlite3_malloc64()]
 7729 ** that contains the constructed string.  The calling application should
 7730 ** pass the returned value to [sqlite3_free()] to avoid a memory leak.
 7731 ** ^The [sqlite3_str_finish(X)] interface may return a NULL pointer if any
 7732 ** errors were encountered during construction of the string.  ^The
 7733 ** [sqlite3_str_finish(X)] interface will also return a NULL pointer if the
 7734 ** string in [sqlite3_str] object X is zero bytes long.
 7735 */
 7736 SQLITE_API char *sqlite3_str_finish(sqlite3_str*);
 7737 
 7738 /*
 7739 ** CAPI3REF: Add Content To A Dynamic String
 7740 ** METHOD: sqlite3_str
 7741 **
 7742 ** These interfaces add content to an sqlite3_str object previously obtained
 7743 ** from [sqlite3_str_new()].
 7744 **
 7745 ** ^The [sqlite3_str_appendf(X,F,...)] and
 7746 ** [sqlite3_str_vappendf(X,F,V)] interfaces uses the [built-in printf]
 7747 ** functionality of SQLite to append formatted text onto the end of
 7748 ** [sqlite3_str] object X.
 7749 **
 7750 ** ^The [sqlite3_str_append(X,S,N)] method appends exactly N bytes from string S
 7751 ** onto the end of the [sqlite3_str] object X.  N must be non-negative.
 7752 ** S must contain at least N non-zero bytes of content.  To append a
 7753 ** zero-terminated string in its entirety, use the [sqlite3_str_appendall()]
 7754 ** method instead.
 7755 **
 7756 ** ^The [sqlite3_str_appendall(X,S)] method appends the complete content of
 7757 ** zero-terminated string S onto the end of [sqlite3_str] object X.
 7758 **
 7759 ** ^The [sqlite3_str_appendchar(X,N,C)] method appends N copies of the
 7760 ** single-byte character C onto the end of [sqlite3_str] object X.
 7761 ** ^This method can be used, for example, to add whitespace indentation.
 7762 **
 7763 ** ^The [sqlite3_str_reset(X)] method resets the string under construction
 7764 ** inside [sqlite3_str] object X back to zero bytes in length.
 7765 **
 7766 ** These methods do not return a result code.  ^If an error occurs, that fact
 7767 ** is recorded in the [sqlite3_str] object and can be recovered by a
 7768 ** subsequent call to [sqlite3_str_errcode(X)].
 7769 */
 7770 SQLITE_API void sqlite3_str_appendf(sqlite3_str*, const char *zFormat, ...);
 7771 SQLITE_API void sqlite3_str_vappendf(sqlite3_str*, const char *zFormat, va_list);
 7772 SQLITE_API void sqlite3_str_append(sqlite3_str*, const char *zIn, int N);
 7773 SQLITE_API void sqlite3_str_appendall(sqlite3_str*, const char *zIn);
 7774 SQLITE_API void sqlite3_str_appendchar(sqlite3_str*, int N, char C);
 7775 SQLITE_API void sqlite3_str_reset(sqlite3_str*);
 7776 
 7777 /*
 7778 ** CAPI3REF: Status Of A Dynamic String
 7779 ** METHOD: sqlite3_str
 7780 **
 7781 ** These interfaces return the current status of an [sqlite3_str] object.
 7782 **
 7783 ** ^If any prior errors have occurred while constructing the dynamic string
 7784 ** in sqlite3_str X, then the [sqlite3_str_errcode(X)] method will return
 7785 ** an appropriate error code.  ^The [sqlite3_str_errcode(X)] method returns
 7786 ** [SQLITE_NOMEM] following any out-of-memory error, or
 7787 ** [SQLITE_TOOBIG] if the size of the dynamic string exceeds
 7788 ** [SQLITE_MAX_LENGTH], or [SQLITE_OK] if there have been no errors.
 7789 **
 7790 ** ^The [sqlite3_str_length(X)] method returns the current length, in bytes,
 7791 ** of the dynamic string under construction in [sqlite3_str] object X.
 7792 ** ^The length returned by [sqlite3_str_length(X)] does not include the
 7793 ** zero-termination byte.
 7794 **
 7795 ** ^The [sqlite3_str_value(X)] method returns a pointer to the current
 7796 ** content of the dynamic string under construction in X.  The value
 7797 ** returned by [sqlite3_str_value(X)] is managed by the sqlite3_str object X
 7798 ** and might be freed or altered by any subsequent method on the same
 7799 ** [sqlite3_str] object.  Applications must not used the pointer returned
 7800 ** [sqlite3_str_value(X)] after any subsequent method call on the same
 7801 ** object.  ^Applications may change the content of the string returned
 7802 ** by [sqlite3_str_value(X)] as long as they do not write into any bytes
 7803 ** outside the range of 0 to [sqlite3_str_length(X)] and do not read or
 7804 ** write any byte after any subsequent sqlite3_str method call.
 7805 */
 7806 SQLITE_API int sqlite3_str_errcode(sqlite3_str*);
 7807 SQLITE_API int sqlite3_str_length(sqlite3_str*);
 7808 SQLITE_API char *sqlite3_str_value(sqlite3_str*);
 7809 
 7810 /*
 7811 ** CAPI3REF: SQLite Runtime Status
 7812 **
 7813 ** ^These interfaces are used to retrieve runtime status information
 7814 ** about the performance of SQLite, and optionally to reset various
 7815 ** highwater marks.  ^The first argument is an integer code for
 7816 ** the specific parameter to measure.  ^(Recognized integer codes
 7817 ** are of the form [status parameters | SQLITE_STATUS_...].)^
 7818 ** ^The current value of the parameter is returned into *pCurrent.
 7819 ** ^The highest recorded value is returned in *pHighwater.  ^If the
 7820 ** resetFlag is true, then the highest record value is reset after
 7821 ** *pHighwater is written.  ^(Some parameters do not record the highest
 7822 ** value.  For those parameters
 7823 ** nothing is written into *pHighwater and the resetFlag is ignored.)^
 7824 ** ^(Other parameters record only the highwater mark and not the current
 7825 ** value.  For these latter parameters nothing is written into *pCurrent.)^
 7826 **
 7827 ** ^The sqlite3_status() and sqlite3_status64() routines return
 7828 ** SQLITE_OK on success and a non-zero [error code] on failure.
 7829 **
 7830 ** If either the current value or the highwater mark is too large to
 7831 ** be represented by a 32-bit integer, then the values returned by
 7832 ** sqlite3_status() are undefined.
 7833 **
 7834 ** See also: [sqlite3_db_status()]
 7835 */
 7836 SQLITE_API int sqlite3_status(int op, int *pCurrent, int *pHighwater, int resetFlag);
 7837 SQLITE_API int sqlite3_status64(
 7838   int op,
 7839   sqlite3_int64 *pCurrent,
 7840   sqlite3_int64 *pHighwater,
 7841   int resetFlag
 7842 );
 7843 
 7844 
 7845 /*
 7846 ** CAPI3REF: Status Parameters
 7847 ** KEYWORDS: {status parameters}
 7848 **
 7849 ** These integer constants designate various run-time status parameters
 7850 ** that can be returned by [sqlite3_status()].
 7851 **
 7852 ** &lt;dl&gt;
 7853 ** [[SQLITE_STATUS_MEMORY_USED]] ^(&lt;dt&gt;SQLITE_STATUS_MEMORY_USED&lt;/dt&gt;
 7854 ** &lt;dd&gt;This parameter is the current amount of memory checked out
 7855 ** using [sqlite3_malloc()], either directly or indirectly.  The
 7856 ** figure includes calls made to [sqlite3_malloc()] by the application
 7857 ** and internal memory usage by the SQLite library.  Auxiliary page-cache
 7858 ** memory controlled by [SQLITE_CONFIG_PAGECACHE] is not included in
 7859 ** this parameter.  The amount returned is the sum of the allocation
 7860 ** sizes as reported by the xSize method in [sqlite3_mem_methods].&lt;/dd&gt;)^
 7861 **
 7862 ** [[SQLITE_STATUS_MALLOC_SIZE]] ^(&lt;dt&gt;SQLITE_STATUS_MALLOC_SIZE&lt;/dt&gt;
 7863 ** &lt;dd&gt;This parameter records the largest memory allocation request
 7864 ** handed to [sqlite3_malloc()] or [sqlite3_realloc()] (or their
 7865 ** internal equivalents).  Only the value returned in the
 7866 ** *pHighwater parameter to [sqlite3_status()] is of interest.
 7867 ** The value written into the *pCurrent parameter is undefined.&lt;/dd&gt;)^
 7868 **
 7869 ** [[SQLITE_STATUS_MALLOC_COUNT]] ^(&lt;dt&gt;SQLITE_STATUS_MALLOC_COUNT&lt;/dt&gt;
 7870 ** &lt;dd&gt;This parameter records the number of separate memory allocations
 7871 ** currently checked out.&lt;/dd&gt;)^
 7872 **
 7873 ** [[SQLITE_STATUS_PAGECACHE_USED]] ^(&lt;dt&gt;SQLITE_STATUS_PAGECACHE_USED&lt;/dt&gt;
 7874 ** &lt;dd&gt;This parameter returns the number of pages used out of the
 7875 ** [pagecache memory allocator] that was configured using
 7876 ** [SQLITE_CONFIG_PAGECACHE].  The
 7877 ** value returned is in pages, not in bytes.&lt;/dd&gt;)^
 7878 **
 7879 ** [[SQLITE_STATUS_PAGECACHE_OVERFLOW]]
 7880 ** ^(&lt;dt&gt;SQLITE_STATUS_PAGECACHE_OVERFLOW&lt;/dt&gt;
 7881 ** &lt;dd&gt;This parameter returns the number of bytes of page cache
 7882 ** allocation which could not be satisfied by the [SQLITE_CONFIG_PAGECACHE]
 7883 ** buffer and where forced to overflow to [sqlite3_malloc()].  The
 7884 ** returned value includes allocations that overflowed because they
 7885 ** where too large (they were larger than the &quot;sz&quot; parameter to
 7886 ** [SQLITE_CONFIG_PAGECACHE]) and allocations that overflowed because
 7887 ** no space was left in the page cache.&lt;/dd&gt;)^
 7888 **
 7889 ** [[SQLITE_STATUS_PAGECACHE_SIZE]] ^(&lt;dt&gt;SQLITE_STATUS_PAGECACHE_SIZE&lt;/dt&gt;
 7890 ** &lt;dd&gt;This parameter records the largest memory allocation request
<a name="79" id="anc79"></a><span class="line-modified"> 7891 ** handed to the [pagecache memory allocator].  Only the value returned in the</span>
 7892 ** *pHighwater parameter to [sqlite3_status()] is of interest.
 7893 ** The value written into the *pCurrent parameter is undefined.&lt;/dd&gt;)^
 7894 **
 7895 ** [[SQLITE_STATUS_SCRATCH_USED]] &lt;dt&gt;SQLITE_STATUS_SCRATCH_USED&lt;/dt&gt;
 7896 ** &lt;dd&gt;No longer used.&lt;/dd&gt;
 7897 **
 7898 ** [[SQLITE_STATUS_SCRATCH_OVERFLOW]] ^(&lt;dt&gt;SQLITE_STATUS_SCRATCH_OVERFLOW&lt;/dt&gt;
 7899 ** &lt;dd&gt;No longer used.&lt;/dd&gt;
 7900 **
 7901 ** [[SQLITE_STATUS_SCRATCH_SIZE]] &lt;dt&gt;SQLITE_STATUS_SCRATCH_SIZE&lt;/dt&gt;
 7902 ** &lt;dd&gt;No longer used.&lt;/dd&gt;
 7903 **
 7904 ** [[SQLITE_STATUS_PARSER_STACK]] ^(&lt;dt&gt;SQLITE_STATUS_PARSER_STACK&lt;/dt&gt;
 7905 ** &lt;dd&gt;The *pHighwater parameter records the deepest parser stack.
 7906 ** The *pCurrent value is undefined.  The *pHighwater value is only
 7907 ** meaningful if SQLite is compiled with [YYTRACKMAXSTACKDEPTH].&lt;/dd&gt;)^
 7908 ** &lt;/dl&gt;
 7909 **
 7910 ** New status parameters may be added from time to time.
 7911 */
 7912 #define SQLITE_STATUS_MEMORY_USED          0
 7913 #define SQLITE_STATUS_PAGECACHE_USED       1
 7914 #define SQLITE_STATUS_PAGECACHE_OVERFLOW   2
 7915 #define SQLITE_STATUS_SCRATCH_USED         3  /* NOT USED */
 7916 #define SQLITE_STATUS_SCRATCH_OVERFLOW     4  /* NOT USED */
 7917 #define SQLITE_STATUS_MALLOC_SIZE          5
 7918 #define SQLITE_STATUS_PARSER_STACK         6
 7919 #define SQLITE_STATUS_PAGECACHE_SIZE       7
 7920 #define SQLITE_STATUS_SCRATCH_SIZE         8  /* NOT USED */
 7921 #define SQLITE_STATUS_MALLOC_COUNT         9
 7922 
 7923 /*
 7924 ** CAPI3REF: Database Connection Status
 7925 ** METHOD: sqlite3
 7926 **
 7927 ** ^This interface is used to retrieve runtime status information
 7928 ** about a single [database connection].  ^The first argument is the
 7929 ** database connection object to be interrogated.  ^The second argument
 7930 ** is an integer constant, taken from the set of
 7931 ** [SQLITE_DBSTATUS options], that
 7932 ** determines the parameter to interrogate.  The set of
 7933 ** [SQLITE_DBSTATUS options] is likely
 7934 ** to grow in future releases of SQLite.
 7935 **
 7936 ** ^The current value of the requested parameter is written into *pCur
 7937 ** and the highest instantaneous value is written into *pHiwtr.  ^If
 7938 ** the resetFlg is true, then the highest instantaneous value is
 7939 ** reset back down to the current value.
 7940 **
 7941 ** ^The sqlite3_db_status() routine returns SQLITE_OK on success and a
 7942 ** non-zero [error code] on failure.
 7943 **
 7944 ** See also: [sqlite3_status()] and [sqlite3_stmt_status()].
 7945 */
 7946 SQLITE_API int sqlite3_db_status(sqlite3*, int op, int *pCur, int *pHiwtr, int resetFlg);
 7947 
 7948 /*
 7949 ** CAPI3REF: Status Parameters for database connections
 7950 ** KEYWORDS: {SQLITE_DBSTATUS options}
 7951 **
 7952 ** These constants are the available integer &quot;verbs&quot; that can be passed as
 7953 ** the second argument to the [sqlite3_db_status()] interface.
 7954 **
 7955 ** New verbs may be added in future releases of SQLite. Existing verbs
 7956 ** might be discontinued. Applications should check the return code from
 7957 ** [sqlite3_db_status()] to make sure that the call worked.
 7958 ** The [sqlite3_db_status()] interface will return a non-zero error code
 7959 ** if a discontinued or unsupported verb is invoked.
 7960 **
 7961 ** &lt;dl&gt;
 7962 ** [[SQLITE_DBSTATUS_LOOKASIDE_USED]] ^(&lt;dt&gt;SQLITE_DBSTATUS_LOOKASIDE_USED&lt;/dt&gt;
 7963 ** &lt;dd&gt;This parameter returns the number of lookaside memory slots currently
 7964 ** checked out.&lt;/dd&gt;)^
 7965 **
 7966 ** [[SQLITE_DBSTATUS_LOOKASIDE_HIT]] ^(&lt;dt&gt;SQLITE_DBSTATUS_LOOKASIDE_HIT&lt;/dt&gt;
<a name="80" id="anc80"></a><span class="line-modified"> 7967 ** &lt;dd&gt;This parameter returns the number of malloc attempts that were</span>
 7968 ** satisfied using lookaside memory. Only the high-water value is meaningful;
 7969 ** the current value is always zero.)^
 7970 **
 7971 ** [[SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE]]
 7972 ** ^(&lt;dt&gt;SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE&lt;/dt&gt;
 7973 ** &lt;dd&gt;This parameter returns the number malloc attempts that might have
 7974 ** been satisfied using lookaside memory but failed due to the amount of
 7975 ** memory requested being larger than the lookaside slot size.
 7976 ** Only the high-water value is meaningful;
 7977 ** the current value is always zero.)^
 7978 **
 7979 ** [[SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL]]
 7980 ** ^(&lt;dt&gt;SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL&lt;/dt&gt;
 7981 ** &lt;dd&gt;This parameter returns the number malloc attempts that might have
 7982 ** been satisfied using lookaside memory but failed due to all lookaside
 7983 ** memory already being in use.
 7984 ** Only the high-water value is meaningful;
 7985 ** the current value is always zero.)^
 7986 **
 7987 ** [[SQLITE_DBSTATUS_CACHE_USED]] ^(&lt;dt&gt;SQLITE_DBSTATUS_CACHE_USED&lt;/dt&gt;
 7988 ** &lt;dd&gt;This parameter returns the approximate number of bytes of heap
 7989 ** memory used by all pager caches associated with the database connection.)^
 7990 ** ^The highwater mark associated with SQLITE_DBSTATUS_CACHE_USED is always 0.
 7991 **
 7992 ** [[SQLITE_DBSTATUS_CACHE_USED_SHARED]]
 7993 ** ^(&lt;dt&gt;SQLITE_DBSTATUS_CACHE_USED_SHARED&lt;/dt&gt;
 7994 ** &lt;dd&gt;This parameter is similar to DBSTATUS_CACHE_USED, except that if a
 7995 ** pager cache is shared between two or more connections the bytes of heap
 7996 ** memory used by that pager cache is divided evenly between the attached
 7997 ** connections.)^  In other words, if none of the pager caches associated
 7998 ** with the database connection are shared, this request returns the same
 7999 ** value as DBSTATUS_CACHE_USED. Or, if one or more or the pager caches are
 8000 ** shared, the value returned by this call will be smaller than that returned
 8001 ** by DBSTATUS_CACHE_USED. ^The highwater mark associated with
 8002 ** SQLITE_DBSTATUS_CACHE_USED_SHARED is always 0.
 8003 **
 8004 ** [[SQLITE_DBSTATUS_SCHEMA_USED]] ^(&lt;dt&gt;SQLITE_DBSTATUS_SCHEMA_USED&lt;/dt&gt;
 8005 ** &lt;dd&gt;This parameter returns the approximate number of bytes of heap
 8006 ** memory used to store the schema for all databases associated
 8007 ** with the connection - main, temp, and any [ATTACH]-ed databases.)^
 8008 ** ^The full amount of memory used by the schemas is reported, even if the
 8009 ** schema memory is shared with other database connections due to
 8010 ** [shared cache mode] being enabled.
 8011 ** ^The highwater mark associated with SQLITE_DBSTATUS_SCHEMA_USED is always 0.
 8012 **
 8013 ** [[SQLITE_DBSTATUS_STMT_USED]] ^(&lt;dt&gt;SQLITE_DBSTATUS_STMT_USED&lt;/dt&gt;
 8014 ** &lt;dd&gt;This parameter returns the approximate number of bytes of heap
 8015 ** and lookaside memory used by all prepared statements associated with
 8016 ** the database connection.)^
 8017 ** ^The highwater mark associated with SQLITE_DBSTATUS_STMT_USED is always 0.
 8018 ** &lt;/dd&gt;
 8019 **
 8020 ** [[SQLITE_DBSTATUS_CACHE_HIT]] ^(&lt;dt&gt;SQLITE_DBSTATUS_CACHE_HIT&lt;/dt&gt;
 8021 ** &lt;dd&gt;This parameter returns the number of pager cache hits that have
 8022 ** occurred.)^ ^The highwater mark associated with SQLITE_DBSTATUS_CACHE_HIT
 8023 ** is always 0.
 8024 ** &lt;/dd&gt;
 8025 **
 8026 ** [[SQLITE_DBSTATUS_CACHE_MISS]] ^(&lt;dt&gt;SQLITE_DBSTATUS_CACHE_MISS&lt;/dt&gt;
 8027 ** &lt;dd&gt;This parameter returns the number of pager cache misses that have
 8028 ** occurred.)^ ^The highwater mark associated with SQLITE_DBSTATUS_CACHE_MISS
 8029 ** is always 0.
 8030 ** &lt;/dd&gt;
 8031 **
 8032 ** [[SQLITE_DBSTATUS_CACHE_WRITE]] ^(&lt;dt&gt;SQLITE_DBSTATUS_CACHE_WRITE&lt;/dt&gt;
 8033 ** &lt;dd&gt;This parameter returns the number of dirty cache entries that have
 8034 ** been written to disk. Specifically, the number of pages written to the
 8035 ** wal file in wal mode databases, or the number of pages written to the
 8036 ** database file in rollback mode databases. Any pages written as part of
 8037 ** transaction rollback or database recovery operations are not included.
 8038 ** If an IO or other error occurs while writing a page to disk, the effect
 8039 ** on subsequent SQLITE_DBSTATUS_CACHE_WRITE requests is undefined.)^ ^The
 8040 ** highwater mark associated with SQLITE_DBSTATUS_CACHE_WRITE is always 0.
 8041 ** &lt;/dd&gt;
 8042 **
 8043 ** [[SQLITE_DBSTATUS_CACHE_SPILL]] ^(&lt;dt&gt;SQLITE_DBSTATUS_CACHE_SPILL&lt;/dt&gt;
 8044 ** &lt;dd&gt;This parameter returns the number of dirty cache entries that have
 8045 ** been written to disk in the middle of a transaction due to the page
 8046 ** cache overflowing. Transactions are more efficient if they are written
 8047 ** to disk all at once. When pages spill mid-transaction, that introduces
 8048 ** additional overhead. This parameter can be used help identify
<a name="81" id="anc81"></a><span class="line-modified"> 8049 ** inefficiencies that can be resolved by increasing the cache size.</span>
 8050 ** &lt;/dd&gt;
 8051 **
 8052 ** [[SQLITE_DBSTATUS_DEFERRED_FKS]] ^(&lt;dt&gt;SQLITE_DBSTATUS_DEFERRED_FKS&lt;/dt&gt;
 8053 ** &lt;dd&gt;This parameter returns zero for the current value if and only if
 8054 ** all foreign key constraints (deferred or immediate) have been
 8055 ** resolved.)^  ^The highwater mark is always 0.
 8056 ** &lt;/dd&gt;
 8057 ** &lt;/dl&gt;
 8058 */
 8059 #define SQLITE_DBSTATUS_LOOKASIDE_USED       0
 8060 #define SQLITE_DBSTATUS_CACHE_USED           1
 8061 #define SQLITE_DBSTATUS_SCHEMA_USED          2
 8062 #define SQLITE_DBSTATUS_STMT_USED            3
 8063 #define SQLITE_DBSTATUS_LOOKASIDE_HIT        4
 8064 #define SQLITE_DBSTATUS_LOOKASIDE_MISS_SIZE  5
 8065 #define SQLITE_DBSTATUS_LOOKASIDE_MISS_FULL  6
 8066 #define SQLITE_DBSTATUS_CACHE_HIT            7
 8067 #define SQLITE_DBSTATUS_CACHE_MISS           8
 8068 #define SQLITE_DBSTATUS_CACHE_WRITE          9
 8069 #define SQLITE_DBSTATUS_DEFERRED_FKS        10
 8070 #define SQLITE_DBSTATUS_CACHE_USED_SHARED   11
 8071 #define SQLITE_DBSTATUS_CACHE_SPILL         12
 8072 #define SQLITE_DBSTATUS_MAX                 12   /* Largest defined DBSTATUS */
 8073 
 8074 
 8075 /*
 8076 ** CAPI3REF: Prepared Statement Status
 8077 ** METHOD: sqlite3_stmt
 8078 **
 8079 ** ^(Each prepared statement maintains various
 8080 ** [SQLITE_STMTSTATUS counters] that measure the number
 8081 ** of times it has performed specific operations.)^  These counters can
 8082 ** be used to monitor the performance characteristics of the prepared
 8083 ** statements.  For example, if the number of table steps greatly exceeds
 8084 ** the number of table searches or result rows, that would tend to indicate
 8085 ** that the prepared statement is using a full table scan rather than
 8086 ** an index.
 8087 **
 8088 ** ^(This interface is used to retrieve and reset counter values from
 8089 ** a [prepared statement].  The first argument is the prepared statement
 8090 ** object to be interrogated.  The second argument
 8091 ** is an integer code for a specific [SQLITE_STMTSTATUS counter]
 8092 ** to be interrogated.)^
 8093 ** ^The current value of the requested counter is returned.
 8094 ** ^If the resetFlg is true, then the counter is reset to zero after this
 8095 ** interface call returns.
 8096 **
 8097 ** See also: [sqlite3_status()] and [sqlite3_db_status()].
 8098 */
 8099 SQLITE_API int sqlite3_stmt_status(sqlite3_stmt*, int op,int resetFlg);
 8100 
 8101 /*
 8102 ** CAPI3REF: Status Parameters for prepared statements
 8103 ** KEYWORDS: {SQLITE_STMTSTATUS counter} {SQLITE_STMTSTATUS counters}
 8104 **
 8105 ** These preprocessor macros define integer codes that name counter
 8106 ** values associated with the [sqlite3_stmt_status()] interface.
 8107 ** The meanings of the various counters are as follows:
 8108 **
 8109 ** &lt;dl&gt;
 8110 ** [[SQLITE_STMTSTATUS_FULLSCAN_STEP]] &lt;dt&gt;SQLITE_STMTSTATUS_FULLSCAN_STEP&lt;/dt&gt;
 8111 ** &lt;dd&gt;^This is the number of times that SQLite has stepped forward in
 8112 ** a table as part of a full table scan.  Large numbers for this counter
 8113 ** may indicate opportunities for performance improvement through
 8114 ** careful use of indices.&lt;/dd&gt;
 8115 **
 8116 ** [[SQLITE_STMTSTATUS_SORT]] &lt;dt&gt;SQLITE_STMTSTATUS_SORT&lt;/dt&gt;
 8117 ** &lt;dd&gt;^This is the number of sort operations that have occurred.
 8118 ** A non-zero value in this counter may indicate an opportunity to
 8119 ** improvement performance through careful use of indices.&lt;/dd&gt;
 8120 **
 8121 ** [[SQLITE_STMTSTATUS_AUTOINDEX]] &lt;dt&gt;SQLITE_STMTSTATUS_AUTOINDEX&lt;/dt&gt;
 8122 ** &lt;dd&gt;^This is the number of rows inserted into transient indices that
 8123 ** were created automatically in order to help joins run faster.
 8124 ** A non-zero value in this counter may indicate an opportunity to
 8125 ** improvement performance by adding permanent indices that do not
 8126 ** need to be reinitialized each time the statement is run.&lt;/dd&gt;
 8127 **
 8128 ** [[SQLITE_STMTSTATUS_VM_STEP]] &lt;dt&gt;SQLITE_STMTSTATUS_VM_STEP&lt;/dt&gt;
 8129 ** &lt;dd&gt;^This is the number of virtual machine operations executed
 8130 ** by the prepared statement if that number is less than or equal
 8131 ** to 2147483647.  The number of virtual machine operations can be
 8132 ** used as a proxy for the total work done by the prepared statement.
 8133 ** If the number of virtual machine operations exceeds 2147483647
 8134 ** then the value returned by this statement status code is undefined.
 8135 **
 8136 ** [[SQLITE_STMTSTATUS_REPREPARE]] &lt;dt&gt;SQLITE_STMTSTATUS_REPREPARE&lt;/dt&gt;
 8137 ** &lt;dd&gt;^This is the number of times that the prepare statement has been
<a name="82" id="anc82"></a><span class="line-modified"> 8138 ** automatically regenerated due to schema changes or changes to</span>
 8139 ** [bound parameters] that might affect the query plan.
 8140 **
 8141 ** [[SQLITE_STMTSTATUS_RUN]] &lt;dt&gt;SQLITE_STMTSTATUS_RUN&lt;/dt&gt;
 8142 ** &lt;dd&gt;^This is the number of times that the prepared statement has
 8143 ** been run.  A single &quot;run&quot; for the purposes of this counter is one
 8144 ** or more calls to [sqlite3_step()] followed by a call to [sqlite3_reset()].
 8145 ** The counter is incremented on the first [sqlite3_step()] call of each
 8146 ** cycle.
 8147 **
 8148 ** [[SQLITE_STMTSTATUS_MEMUSED]] &lt;dt&gt;SQLITE_STMTSTATUS_MEMUSED&lt;/dt&gt;
 8149 ** &lt;dd&gt;^This is the approximate number of bytes of heap memory
 8150 ** used to store the prepared statement.  ^This value is not actually
 8151 ** a counter, and so the resetFlg parameter to sqlite3_stmt_status()
 8152 ** is ignored when the opcode is SQLITE_STMTSTATUS_MEMUSED.
 8153 ** &lt;/dd&gt;
 8154 ** &lt;/dl&gt;
 8155 */
 8156 #define SQLITE_STMTSTATUS_FULLSCAN_STEP     1
 8157 #define SQLITE_STMTSTATUS_SORT              2
 8158 #define SQLITE_STMTSTATUS_AUTOINDEX         3
 8159 #define SQLITE_STMTSTATUS_VM_STEP           4
 8160 #define SQLITE_STMTSTATUS_REPREPARE         5
 8161 #define SQLITE_STMTSTATUS_RUN               6
 8162 #define SQLITE_STMTSTATUS_MEMUSED           99
 8163 
 8164 /*
 8165 ** CAPI3REF: Custom Page Cache Object
 8166 **
 8167 ** The sqlite3_pcache type is opaque.  It is implemented by
 8168 ** the pluggable module.  The SQLite core has no knowledge of
 8169 ** its size or internal structure and never deals with the
 8170 ** sqlite3_pcache object except by holding and passing pointers
 8171 ** to the object.
 8172 **
 8173 ** See [sqlite3_pcache_methods2] for additional information.
 8174 */
 8175 typedef struct sqlite3_pcache sqlite3_pcache;
 8176 
 8177 /*
 8178 ** CAPI3REF: Custom Page Cache Object
 8179 **
 8180 ** The sqlite3_pcache_page object represents a single page in the
 8181 ** page cache.  The page cache will allocate instances of this
 8182 ** object.  Various methods of the page cache use pointers to instances
 8183 ** of this object as parameters or as their return value.
 8184 **
 8185 ** See [sqlite3_pcache_methods2] for additional information.
 8186 */
 8187 typedef struct sqlite3_pcache_page sqlite3_pcache_page;
 8188 struct sqlite3_pcache_page {
 8189   void *pBuf;        /* The content of the page */
 8190   void *pExtra;      /* Extra information associated with the page */
 8191 };
 8192 
 8193 /*
 8194 ** CAPI3REF: Application Defined Page Cache.
 8195 ** KEYWORDS: {page cache}
 8196 **
 8197 ** ^(The [sqlite3_config]([SQLITE_CONFIG_PCACHE2], ...) interface can
 8198 ** register an alternative page cache implementation by passing in an
 8199 ** instance of the sqlite3_pcache_methods2 structure.)^
 8200 ** In many applications, most of the heap memory allocated by
 8201 ** SQLite is used for the page cache.
 8202 ** By implementing a
 8203 ** custom page cache using this API, an application can better control
 8204 ** the amount of memory consumed by SQLite, the way in which
 8205 ** that memory is allocated and released, and the policies used to
 8206 ** determine exactly which parts of a database file are cached and for
 8207 ** how long.
 8208 **
 8209 ** The alternative page cache mechanism is an
 8210 ** extreme measure that is only needed by the most demanding applications.
 8211 ** The built-in page cache is recommended for most uses.
 8212 **
 8213 ** ^(The contents of the sqlite3_pcache_methods2 structure are copied to an
 8214 ** internal buffer by SQLite within the call to [sqlite3_config].  Hence
 8215 ** the application may discard the parameter after the call to
 8216 ** [sqlite3_config()] returns.)^
 8217 **
 8218 ** [[the xInit() page cache method]]
 8219 ** ^(The xInit() method is called once for each effective
 8220 ** call to [sqlite3_initialize()])^
 8221 ** (usually only once during the lifetime of the process). ^(The xInit()
 8222 ** method is passed a copy of the sqlite3_pcache_methods2.pArg value.)^
 8223 ** The intent of the xInit() method is to set up global data structures
 8224 ** required by the custom page cache implementation.
 8225 ** ^(If the xInit() method is NULL, then the
 8226 ** built-in default page cache is used instead of the application defined
 8227 ** page cache.)^
 8228 **
 8229 ** [[the xShutdown() page cache method]]
 8230 ** ^The xShutdown() method is called by [sqlite3_shutdown()].
 8231 ** It can be used to clean up
 8232 ** any outstanding resources before process shutdown, if required.
 8233 ** ^The xShutdown() method may be NULL.
 8234 **
 8235 ** ^SQLite automatically serializes calls to the xInit method,
 8236 ** so the xInit method need not be threadsafe.  ^The
 8237 ** xShutdown method is only called from [sqlite3_shutdown()] so it does
 8238 ** not need to be threadsafe either.  All other methods must be threadsafe
 8239 ** in multithreaded applications.
 8240 **
 8241 ** ^SQLite will never invoke xInit() more than once without an intervening
 8242 ** call to xShutdown().
 8243 **
 8244 ** [[the xCreate() page cache methods]]
 8245 ** ^SQLite invokes the xCreate() method to construct a new cache instance.
 8246 ** SQLite will typically create one cache instance for each open database file,
 8247 ** though this is not guaranteed. ^The
 8248 ** first parameter, szPage, is the size in bytes of the pages that must
 8249 ** be allocated by the cache.  ^szPage will always a power of two.  ^The
 8250 ** second parameter szExtra is a number of bytes of extra storage
 8251 ** associated with each page cache entry.  ^The szExtra parameter will
 8252 ** a number less than 250.  SQLite will use the
 8253 ** extra szExtra bytes on each page to store metadata about the underlying
 8254 ** database page on disk.  The value passed into szExtra depends
 8255 ** on the SQLite version, the target platform, and how SQLite was compiled.
 8256 ** ^The third argument to xCreate(), bPurgeable, is true if the cache being
 8257 ** created will be used to cache database pages of a file stored on disk, or
 8258 ** false if it is used for an in-memory database. The cache implementation
 8259 ** does not have to do anything special based with the value of bPurgeable;
 8260 ** it is purely advisory.  ^On a cache where bPurgeable is false, SQLite will
 8261 ** never invoke xUnpin() except to deliberately delete a page.
 8262 ** ^In other words, calls to xUnpin() on a cache with bPurgeable set to
 8263 ** false will always have the &quot;discard&quot; flag set to true.
 8264 ** ^Hence, a cache created with bPurgeable false will
 8265 ** never contain any unpinned pages.
 8266 **
 8267 ** [[the xCachesize() page cache method]]
 8268 ** ^(The xCachesize() method may be called at any time by SQLite to set the
 8269 ** suggested maximum cache-size (number of pages stored by) the cache
 8270 ** instance passed as the first argument. This is the value configured using
 8271 ** the SQLite &quot;[PRAGMA cache_size]&quot; command.)^  As with the bPurgeable
 8272 ** parameter, the implementation is not required to do anything with this
 8273 ** value; it is advisory only.
 8274 **
 8275 ** [[the xPagecount() page cache methods]]
 8276 ** The xPagecount() method must return the number of pages currently
 8277 ** stored in the cache, both pinned and unpinned.
 8278 **
 8279 ** [[the xFetch() page cache methods]]
 8280 ** The xFetch() method locates a page in the cache and returns a pointer to
 8281 ** an sqlite3_pcache_page object associated with that page, or a NULL pointer.
 8282 ** The pBuf element of the returned sqlite3_pcache_page object will be a
 8283 ** pointer to a buffer of szPage bytes used to store the content of a
 8284 ** single database page.  The pExtra element of sqlite3_pcache_page will be
 8285 ** a pointer to the szExtra bytes of extra storage that SQLite has requested
 8286 ** for each entry in the page cache.
 8287 **
 8288 ** The page to be fetched is determined by the key. ^The minimum key value
 8289 ** is 1.  After it has been retrieved using xFetch, the page is considered
 8290 ** to be &quot;pinned&quot;.
 8291 **
 8292 ** If the requested page is already in the page cache, then the page cache
 8293 ** implementation must return a pointer to the page buffer with its content
 8294 ** intact.  If the requested page is not already in the cache, then the
 8295 ** cache implementation should use the value of the createFlag
 8296 ** parameter to help it determined what action to take:
 8297 **
 8298 ** &lt;table border=1 width=85% align=center&gt;
 8299 ** &lt;tr&gt;&lt;th&gt; createFlag &lt;th&gt; Behavior when page is not already in cache
 8300 ** &lt;tr&gt;&lt;td&gt; 0 &lt;td&gt; Do not allocate a new page.  Return NULL.
 8301 ** &lt;tr&gt;&lt;td&gt; 1 &lt;td&gt; Allocate a new page if it easy and convenient to do so.
 8302 **                 Otherwise return NULL.
 8303 ** &lt;tr&gt;&lt;td&gt; 2 &lt;td&gt; Make every effort to allocate a new page.  Only return
 8304 **                 NULL if allocating a new page is effectively impossible.
 8305 ** &lt;/table&gt;
 8306 **
 8307 ** ^(SQLite will normally invoke xFetch() with a createFlag of 0 or 1.  SQLite
 8308 ** will only use a createFlag of 2 after a prior call with a createFlag of 1
<a name="83" id="anc83"></a><span class="line-modified"> 8309 ** failed.)^  In between the xFetch() calls, SQLite may</span>
 8310 ** attempt to unpin one or more cache pages by spilling the content of
 8311 ** pinned pages to disk and synching the operating system disk cache.
 8312 **
 8313 ** [[the xUnpin() page cache method]]
 8314 ** ^xUnpin() is called by SQLite with a pointer to a currently pinned page
 8315 ** as its second argument.  If the third parameter, discard, is non-zero,
 8316 ** then the page must be evicted from the cache.
 8317 ** ^If the discard parameter is
 8318 ** zero, then the page may be discarded or retained at the discretion of
 8319 ** page cache implementation. ^The page cache implementation
 8320 ** may choose to evict unpinned pages at any time.
 8321 **
 8322 ** The cache must not perform any reference counting. A single
 8323 ** call to xUnpin() unpins the page regardless of the number of prior calls
 8324 ** to xFetch().
 8325 **
 8326 ** [[the xRekey() page cache methods]]
 8327 ** The xRekey() method is used to change the key value associated with the
 8328 ** page passed as the second argument. If the cache
 8329 ** previously contains an entry associated with newKey, it must be
 8330 ** discarded. ^Any prior cache entry associated with newKey is guaranteed not
 8331 ** to be pinned.
 8332 **
 8333 ** When SQLite calls the xTruncate() method, the cache must discard all
 8334 ** existing cache entries with page numbers (keys) greater than or equal
 8335 ** to the value of the iLimit parameter passed to xTruncate(). If any
 8336 ** of these pages are pinned, they are implicitly unpinned, meaning that
 8337 ** they can be safely discarded.
 8338 **
 8339 ** [[the xDestroy() page cache method]]
 8340 ** ^The xDestroy() method is used to delete a cache allocated by xCreate().
 8341 ** All resources associated with the specified cache should be freed. ^After
 8342 ** calling the xDestroy() method, SQLite considers the [sqlite3_pcache*]
 8343 ** handle invalid, and will not use it with any other sqlite3_pcache_methods2
 8344 ** functions.
 8345 **
 8346 ** [[the xShrink() page cache method]]
 8347 ** ^SQLite invokes the xShrink() method when it wants the page cache to
 8348 ** free up as much of heap memory as possible.  The page cache implementation
 8349 ** is not obligated to free any memory, but well-behaved implementations should
 8350 ** do their best.
 8351 */
 8352 typedef struct sqlite3_pcache_methods2 sqlite3_pcache_methods2;
 8353 struct sqlite3_pcache_methods2 {
 8354   int iVersion;
 8355   void *pArg;
 8356   int (*xInit)(void*);
 8357   void (*xShutdown)(void*);
 8358   sqlite3_pcache *(*xCreate)(int szPage, int szExtra, int bPurgeable);
 8359   void (*xCachesize)(sqlite3_pcache*, int nCachesize);
 8360   int (*xPagecount)(sqlite3_pcache*);
 8361   sqlite3_pcache_page *(*xFetch)(sqlite3_pcache*, unsigned key, int createFlag);
 8362   void (*xUnpin)(sqlite3_pcache*, sqlite3_pcache_page*, int discard);
 8363   void (*xRekey)(sqlite3_pcache*, sqlite3_pcache_page*,
 8364       unsigned oldKey, unsigned newKey);
 8365   void (*xTruncate)(sqlite3_pcache*, unsigned iLimit);
 8366   void (*xDestroy)(sqlite3_pcache*);
 8367   void (*xShrink)(sqlite3_pcache*);
 8368 };
 8369 
 8370 /*
 8371 ** This is the obsolete pcache_methods object that has now been replaced
 8372 ** by sqlite3_pcache_methods2.  This object is not used by SQLite.  It is
 8373 ** retained in the header file for backwards compatibility only.
 8374 */
 8375 typedef struct sqlite3_pcache_methods sqlite3_pcache_methods;
 8376 struct sqlite3_pcache_methods {
 8377   void *pArg;
 8378   int (*xInit)(void*);
 8379   void (*xShutdown)(void*);
 8380   sqlite3_pcache *(*xCreate)(int szPage, int bPurgeable);
 8381   void (*xCachesize)(sqlite3_pcache*, int nCachesize);
 8382   int (*xPagecount)(sqlite3_pcache*);
 8383   void *(*xFetch)(sqlite3_pcache*, unsigned key, int createFlag);
 8384   void (*xUnpin)(sqlite3_pcache*, void*, int discard);
 8385   void (*xRekey)(sqlite3_pcache*, void*, unsigned oldKey, unsigned newKey);
 8386   void (*xTruncate)(sqlite3_pcache*, unsigned iLimit);
 8387   void (*xDestroy)(sqlite3_pcache*);
 8388 };
 8389 
 8390 
 8391 /*
 8392 ** CAPI3REF: Online Backup Object
 8393 **
 8394 ** The sqlite3_backup object records state information about an ongoing
 8395 ** online backup operation.  ^The sqlite3_backup object is created by
 8396 ** a call to [sqlite3_backup_init()] and is destroyed by a call to
 8397 ** [sqlite3_backup_finish()].
 8398 **
 8399 ** See Also: [Using the SQLite Online Backup API]
 8400 */
 8401 typedef struct sqlite3_backup sqlite3_backup;
 8402 
 8403 /*
 8404 ** CAPI3REF: Online Backup API.
 8405 **
 8406 ** The backup API copies the content of one database into another.
 8407 ** It is useful either for creating backups of databases or
 8408 ** for copying in-memory databases to or from persistent files.
 8409 **
 8410 ** See Also: [Using the SQLite Online Backup API]
 8411 **
 8412 ** ^SQLite holds a write transaction open on the destination database file
 8413 ** for the duration of the backup operation.
 8414 ** ^The source database is read-locked only while it is being read;
 8415 ** it is not locked continuously for the entire backup operation.
 8416 ** ^Thus, the backup may be performed on a live source database without
 8417 ** preventing other database connections from
 8418 ** reading or writing to the source database while the backup is underway.
 8419 **
 8420 ** ^(To perform a backup operation:
 8421 **   &lt;ol&gt;
 8422 **     &lt;li&gt;&lt;b&gt;sqlite3_backup_init()&lt;/b&gt; is called once to initialize the
 8423 **         backup,
 8424 **     &lt;li&gt;&lt;b&gt;sqlite3_backup_step()&lt;/b&gt; is called one or more times to transfer
 8425 **         the data between the two databases, and finally
 8426 **     &lt;li&gt;&lt;b&gt;sqlite3_backup_finish()&lt;/b&gt; is called to release all resources
 8427 **         associated with the backup operation.
 8428 **   &lt;/ol&gt;)^
 8429 ** There should be exactly one call to sqlite3_backup_finish() for each
 8430 ** successful call to sqlite3_backup_init().
 8431 **
 8432 ** [[sqlite3_backup_init()]] &lt;b&gt;sqlite3_backup_init()&lt;/b&gt;
 8433 **
 8434 ** ^The D and N arguments to sqlite3_backup_init(D,N,S,M) are the
 8435 ** [database connection] associated with the destination database
 8436 ** and the database name, respectively.
 8437 ** ^The database name is &quot;main&quot; for the main database, &quot;temp&quot; for the
 8438 ** temporary database, or the name specified after the AS keyword in
 8439 ** an [ATTACH] statement for an attached database.
 8440 ** ^The S and M arguments passed to
 8441 ** sqlite3_backup_init(D,N,S,M) identify the [database connection]
 8442 ** and database name of the source database, respectively.
 8443 ** ^The source and destination [database connections] (parameters S and D)
 8444 ** must be different or else sqlite3_backup_init(D,N,S,M) will fail with
 8445 ** an error.
 8446 **
 8447 ** ^A call to sqlite3_backup_init() will fail, returning NULL, if
 8448 ** there is already a read or read-write transaction open on the
 8449 ** destination database.
 8450 **
 8451 ** ^If an error occurs within sqlite3_backup_init(D,N,S,M), then NULL is
 8452 ** returned and an error code and error message are stored in the
 8453 ** destination [database connection] D.
 8454 ** ^The error code and message for the failed call to sqlite3_backup_init()
 8455 ** can be retrieved using the [sqlite3_errcode()], [sqlite3_errmsg()], and/or
 8456 ** [sqlite3_errmsg16()] functions.
 8457 ** ^A successful call to sqlite3_backup_init() returns a pointer to an
 8458 ** [sqlite3_backup] object.
 8459 ** ^The [sqlite3_backup] object may be used with the sqlite3_backup_step() and
 8460 ** sqlite3_backup_finish() functions to perform the specified backup
 8461 ** operation.
 8462 **
 8463 ** [[sqlite3_backup_step()]] &lt;b&gt;sqlite3_backup_step()&lt;/b&gt;
 8464 **
 8465 ** ^Function sqlite3_backup_step(B,N) will copy up to N pages between
 8466 ** the source and destination databases specified by [sqlite3_backup] object B.
 8467 ** ^If N is negative, all remaining source pages are copied.
 8468 ** ^If sqlite3_backup_step(B,N) successfully copies N pages and there
 8469 ** are still more pages to be copied, then the function returns [SQLITE_OK].
 8470 ** ^If sqlite3_backup_step(B,N) successfully finishes copying all pages
 8471 ** from source to destination, then it returns [SQLITE_DONE].
 8472 ** ^If an error occurs while running sqlite3_backup_step(B,N),
 8473 ** then an [error code] is returned. ^As well as [SQLITE_OK] and
 8474 ** [SQLITE_DONE], a call to sqlite3_backup_step() may return [SQLITE_READONLY],
 8475 ** [SQLITE_NOMEM], [SQLITE_BUSY], [SQLITE_LOCKED], or an
 8476 ** [SQLITE_IOERR_ACCESS | SQLITE_IOERR_XXX] extended error code.
 8477 **
 8478 ** ^(The sqlite3_backup_step() might return [SQLITE_READONLY] if
 8479 ** &lt;ol&gt;
 8480 ** &lt;li&gt; the destination database was opened read-only, or
 8481 ** &lt;li&gt; the destination database is using write-ahead-log journaling
 8482 ** and the destination and source page sizes differ, or
 8483 ** &lt;li&gt; the destination database is an in-memory database and the
 8484 ** destination and source page sizes differ.
 8485 ** &lt;/ol&gt;)^
 8486 **
 8487 ** ^If sqlite3_backup_step() cannot obtain a required file-system lock, then
 8488 ** the [sqlite3_busy_handler | busy-handler function]
 8489 ** is invoked (if one is specified). ^If the
 8490 ** busy-handler returns non-zero before the lock is available, then
 8491 ** [SQLITE_BUSY] is returned to the caller. ^In this case the call to
 8492 ** sqlite3_backup_step() can be retried later. ^If the source
 8493 ** [database connection]
 8494 ** is being used to write to the source database when sqlite3_backup_step()
 8495 ** is called, then [SQLITE_LOCKED] is returned immediately. ^Again, in this
 8496 ** case the call to sqlite3_backup_step() can be retried later on. ^(If
 8497 ** [SQLITE_IOERR_ACCESS | SQLITE_IOERR_XXX], [SQLITE_NOMEM], or
 8498 ** [SQLITE_READONLY] is returned, then
 8499 ** there is no point in retrying the call to sqlite3_backup_step(). These
 8500 ** errors are considered fatal.)^  The application must accept
 8501 ** that the backup operation has failed and pass the backup operation handle
 8502 ** to the sqlite3_backup_finish() to release associated resources.
 8503 **
 8504 ** ^The first call to sqlite3_backup_step() obtains an exclusive lock
 8505 ** on the destination file. ^The exclusive lock is not released until either
 8506 ** sqlite3_backup_finish() is called or the backup operation is complete
 8507 ** and sqlite3_backup_step() returns [SQLITE_DONE].  ^Every call to
 8508 ** sqlite3_backup_step() obtains a [shared lock] on the source database that
 8509 ** lasts for the duration of the sqlite3_backup_step() call.
 8510 ** ^Because the source database is not locked between calls to
 8511 ** sqlite3_backup_step(), the source database may be modified mid-way
 8512 ** through the backup process.  ^If the source database is modified by an
 8513 ** external process or via a database connection other than the one being
 8514 ** used by the backup operation, then the backup will be automatically
 8515 ** restarted by the next call to sqlite3_backup_step(). ^If the source
 8516 ** database is modified by the using the same database connection as is used
 8517 ** by the backup operation, then the backup database is automatically
 8518 ** updated at the same time.
 8519 **
 8520 ** [[sqlite3_backup_finish()]] &lt;b&gt;sqlite3_backup_finish()&lt;/b&gt;
 8521 **
 8522 ** When sqlite3_backup_step() has returned [SQLITE_DONE], or when the
 8523 ** application wishes to abandon the backup operation, the application
 8524 ** should destroy the [sqlite3_backup] by passing it to sqlite3_backup_finish().
 8525 ** ^The sqlite3_backup_finish() interfaces releases all
 8526 ** resources associated with the [sqlite3_backup] object.
 8527 ** ^If sqlite3_backup_step() has not yet returned [SQLITE_DONE], then any
 8528 ** active write-transaction on the destination database is rolled back.
 8529 ** The [sqlite3_backup] object is invalid
 8530 ** and may not be used following a call to sqlite3_backup_finish().
 8531 **
 8532 ** ^The value returned by sqlite3_backup_finish is [SQLITE_OK] if no
 8533 ** sqlite3_backup_step() errors occurred, regardless or whether or not
 8534 ** sqlite3_backup_step() completed.
 8535 ** ^If an out-of-memory condition or IO error occurred during any prior
 8536 ** sqlite3_backup_step() call on the same [sqlite3_backup] object, then
 8537 ** sqlite3_backup_finish() returns the corresponding [error code].
 8538 **
 8539 ** ^A return of [SQLITE_BUSY] or [SQLITE_LOCKED] from sqlite3_backup_step()
 8540 ** is not a permanent error and does not affect the return value of
 8541 ** sqlite3_backup_finish().
 8542 **
 8543 ** [[sqlite3_backup_remaining()]] [[sqlite3_backup_pagecount()]]
 8544 ** &lt;b&gt;sqlite3_backup_remaining() and sqlite3_backup_pagecount()&lt;/b&gt;
 8545 **
 8546 ** ^The sqlite3_backup_remaining() routine returns the number of pages still
 8547 ** to be backed up at the conclusion of the most recent sqlite3_backup_step().
 8548 ** ^The sqlite3_backup_pagecount() routine returns the total number of pages
 8549 ** in the source database at the conclusion of the most recent
 8550 ** sqlite3_backup_step().
 8551 ** ^(The values returned by these functions are only updated by
 8552 ** sqlite3_backup_step(). If the source database is modified in a way that
 8553 ** changes the size of the source database or the number of pages remaining,
 8554 ** those changes are not reflected in the output of sqlite3_backup_pagecount()
 8555 ** and sqlite3_backup_remaining() until after the next
 8556 ** sqlite3_backup_step().)^
 8557 **
 8558 ** &lt;b&gt;Concurrent Usage of Database Handles&lt;/b&gt;
 8559 **
 8560 ** ^The source [database connection] may be used by the application for other
 8561 ** purposes while a backup operation is underway or being initialized.
 8562 ** ^If SQLite is compiled and configured to support threadsafe database
 8563 ** connections, then the source database connection may be used concurrently
 8564 ** from within other threads.
 8565 **
 8566 ** However, the application must guarantee that the destination
 8567 ** [database connection] is not passed to any other API (by any thread) after
 8568 ** sqlite3_backup_init() is called and before the corresponding call to
 8569 ** sqlite3_backup_finish().  SQLite does not currently check to see
 8570 ** if the application incorrectly accesses the destination [database connection]
 8571 ** and so no error code is reported, but the operations may malfunction
 8572 ** nevertheless.  Use of the destination database connection while a
 8573 ** backup is in progress might also also cause a mutex deadlock.
 8574 **
 8575 ** If running in [shared cache mode], the application must
 8576 ** guarantee that the shared cache used by the destination database
 8577 ** is not accessed while the backup is running. In practice this means
 8578 ** that the application must guarantee that the disk file being
 8579 ** backed up to is not accessed by any connection within the process,
 8580 ** not just the specific connection that was passed to sqlite3_backup_init().
 8581 **
 8582 ** The [sqlite3_backup] object itself is partially threadsafe. Multiple
 8583 ** threads may safely make multiple concurrent calls to sqlite3_backup_step().
 8584 ** However, the sqlite3_backup_remaining() and sqlite3_backup_pagecount()
 8585 ** APIs are not strictly speaking threadsafe. If they are invoked at the
 8586 ** same time as another thread is invoking sqlite3_backup_step() it is
 8587 ** possible that they return invalid values.
 8588 */
 8589 SQLITE_API sqlite3_backup *sqlite3_backup_init(
 8590   sqlite3 *pDest,                        /* Destination database handle */
 8591   const char *zDestName,                 /* Destination database name */
 8592   sqlite3 *pSource,                      /* Source database handle */
 8593   const char *zSourceName                /* Source database name */
 8594 );
 8595 SQLITE_API int sqlite3_backup_step(sqlite3_backup *p, int nPage);
 8596 SQLITE_API int sqlite3_backup_finish(sqlite3_backup *p);
 8597 SQLITE_API int sqlite3_backup_remaining(sqlite3_backup *p);
 8598 SQLITE_API int sqlite3_backup_pagecount(sqlite3_backup *p);
 8599 
 8600 /*
 8601 ** CAPI3REF: Unlock Notification
 8602 ** METHOD: sqlite3
 8603 **
 8604 ** ^When running in shared-cache mode, a database operation may fail with
 8605 ** an [SQLITE_LOCKED] error if the required locks on the shared-cache or
 8606 ** individual tables within the shared-cache cannot be obtained. See
 8607 ** [SQLite Shared-Cache Mode] for a description of shared-cache locking.
 8608 ** ^This API may be used to register a callback that SQLite will invoke
 8609 ** when the connection currently holding the required lock relinquishes it.
 8610 ** ^This API is only available if the library was compiled with the
 8611 ** [SQLITE_ENABLE_UNLOCK_NOTIFY] C-preprocessor symbol defined.
 8612 **
 8613 ** See Also: [Using the SQLite Unlock Notification Feature].
 8614 **
 8615 ** ^Shared-cache locks are released when a database connection concludes
 8616 ** its current transaction, either by committing it or rolling it back.
 8617 **
 8618 ** ^When a connection (known as the blocked connection) fails to obtain a
 8619 ** shared-cache lock and SQLITE_LOCKED is returned to the caller, the
 8620 ** identity of the database connection (the blocking connection) that
 8621 ** has locked the required resource is stored internally. ^After an
 8622 ** application receives an SQLITE_LOCKED error, it may call the
 8623 ** sqlite3_unlock_notify() method with the blocked connection handle as
 8624 ** the first argument to register for a callback that will be invoked
 8625 ** when the blocking connections current transaction is concluded. ^The
 8626 ** callback is invoked from within the [sqlite3_step] or [sqlite3_close]
<a name="84" id="anc84"></a><span class="line-modified"> 8627 ** call that concludes the blocking connection&#39;s transaction.</span>
 8628 **
 8629 ** ^(If sqlite3_unlock_notify() is called in a multi-threaded application,
 8630 ** there is a chance that the blocking connection will have already
 8631 ** concluded its transaction by the time sqlite3_unlock_notify() is invoked.
 8632 ** If this happens, then the specified callback is invoked immediately,
 8633 ** from within the call to sqlite3_unlock_notify().)^
 8634 **
 8635 ** ^If the blocked connection is attempting to obtain a write-lock on a
 8636 ** shared-cache table, and more than one other connection currently holds
 8637 ** a read-lock on the same table, then SQLite arbitrarily selects one of
 8638 ** the other connections to use as the blocking connection.
 8639 **
 8640 ** ^(There may be at most one unlock-notify callback registered by a
 8641 ** blocked connection. If sqlite3_unlock_notify() is called when the
 8642 ** blocked connection already has a registered unlock-notify callback,
 8643 ** then the new callback replaces the old.)^ ^If sqlite3_unlock_notify() is
 8644 ** called with a NULL pointer as its second argument, then any existing
 8645 ** unlock-notify callback is canceled. ^The blocked connections
 8646 ** unlock-notify callback may also be canceled by closing the blocked
 8647 ** connection using [sqlite3_close()].
 8648 **
 8649 ** The unlock-notify callback is not reentrant. If an application invokes
 8650 ** any sqlite3_xxx API functions from within an unlock-notify callback, a
 8651 ** crash or deadlock may be the result.
 8652 **
 8653 ** ^Unless deadlock is detected (see below), sqlite3_unlock_notify() always
 8654 ** returns SQLITE_OK.
 8655 **
 8656 ** &lt;b&gt;Callback Invocation Details&lt;/b&gt;
 8657 **
 8658 ** When an unlock-notify callback is registered, the application provides a
 8659 ** single void* pointer that is passed to the callback when it is invoked.
 8660 ** However, the signature of the callback function allows SQLite to pass
 8661 ** it an array of void* context pointers. The first argument passed to
 8662 ** an unlock-notify callback is a pointer to an array of void* pointers,
 8663 ** and the second is the number of entries in the array.
 8664 **
<a name="85" id="anc85"></a><span class="line-modified"> 8665 ** When a blocking connection&#39;s transaction is concluded, there may be</span>
 8666 ** more than one blocked connection that has registered for an unlock-notify
 8667 ** callback. ^If two or more such blocked connections have specified the
 8668 ** same callback function, then instead of invoking the callback function
 8669 ** multiple times, it is invoked once with the set of void* context pointers
 8670 ** specified by the blocked connections bundled together into an array.
 8671 ** This gives the application an opportunity to prioritize any actions
 8672 ** related to the set of unblocked database connections.
 8673 **
 8674 ** &lt;b&gt;Deadlock Detection&lt;/b&gt;
 8675 **
 8676 ** Assuming that after registering for an unlock-notify callback a
 8677 ** database waits for the callback to be issued before taking any further
 8678 ** action (a reasonable assumption), then using this API may cause the
 8679 ** application to deadlock. For example, if connection X is waiting for
 8680 ** connection Y&#39;s transaction to be concluded, and similarly connection
 8681 ** Y is waiting on connection X&#39;s transaction, then neither connection
 8682 ** will proceed and the system may remain deadlocked indefinitely.
 8683 **
 8684 ** To avoid this scenario, the sqlite3_unlock_notify() performs deadlock
 8685 ** detection. ^If a given call to sqlite3_unlock_notify() would put the
 8686 ** system in a deadlocked state, then SQLITE_LOCKED is returned and no
 8687 ** unlock-notify callback is registered. The system is said to be in
 8688 ** a deadlocked state if connection A has registered for an unlock-notify
 8689 ** callback on the conclusion of connection B&#39;s transaction, and connection
 8690 ** B has itself registered for an unlock-notify callback when connection
 8691 ** A&#39;s transaction is concluded. ^Indirect deadlock is also detected, so
 8692 ** the system is also considered to be deadlocked if connection B has
 8693 ** registered for an unlock-notify callback on the conclusion of connection
 8694 ** C&#39;s transaction, where connection C is waiting on connection A. ^Any
 8695 ** number of levels of indirection are allowed.
 8696 **
 8697 ** &lt;b&gt;The &quot;DROP TABLE&quot; Exception&lt;/b&gt;
 8698 **
 8699 ** When a call to [sqlite3_step()] returns SQLITE_LOCKED, it is almost
 8700 ** always appropriate to call sqlite3_unlock_notify(). There is however,
 8701 ** one exception. When executing a &quot;DROP TABLE&quot; or &quot;DROP INDEX&quot; statement,
 8702 ** SQLite checks if there are any currently executing SELECT statements
 8703 ** that belong to the same connection. If there are, SQLITE_LOCKED is
 8704 ** returned. In this case there is no &quot;blocking connection&quot;, so invoking
 8705 ** sqlite3_unlock_notify() results in the unlock-notify callback being
 8706 ** invoked immediately. If the application then re-attempts the &quot;DROP TABLE&quot;
 8707 ** or &quot;DROP INDEX&quot; query, an infinite loop might be the result.
 8708 **
 8709 ** One way around this problem is to check the extended error code returned
 8710 ** by an sqlite3_step() call. ^(If there is a blocking connection, then the
 8711 ** extended error code is set to SQLITE_LOCKED_SHAREDCACHE. Otherwise, in
 8712 ** the special &quot;DROP TABLE/INDEX&quot; case, the extended error code is just
 8713 ** SQLITE_LOCKED.)^
 8714 */
 8715 SQLITE_API int sqlite3_unlock_notify(
 8716   sqlite3 *pBlocked,                          /* Waiting connection */
 8717   void (*xNotify)(void **apArg, int nArg),    /* Callback function to invoke */
 8718   void *pNotifyArg                            /* Argument to pass to xNotify */
 8719 );
 8720 
 8721 
 8722 /*
 8723 ** CAPI3REF: String Comparison
 8724 **
 8725 ** ^The [sqlite3_stricmp()] and [sqlite3_strnicmp()] APIs allow applications
 8726 ** and extensions to compare the contents of two buffers containing UTF-8
 8727 ** strings in a case-independent fashion, using the same definition of &quot;case
 8728 ** independence&quot; that SQLite uses internally when comparing identifiers.
 8729 */
 8730 SQLITE_API int sqlite3_stricmp(const char *, const char *);
 8731 SQLITE_API int sqlite3_strnicmp(const char *, const char *, int);
 8732 
 8733 /*
 8734 ** CAPI3REF: String Globbing
 8735 *
 8736 ** ^The [sqlite3_strglob(P,X)] interface returns zero if and only if
 8737 ** string X matches the [GLOB] pattern P.
 8738 ** ^The definition of [GLOB] pattern matching used in
 8739 ** [sqlite3_strglob(P,X)] is the same as for the &quot;X GLOB P&quot; operator in the
 8740 ** SQL dialect understood by SQLite.  ^The [sqlite3_strglob(P,X)] function
 8741 ** is case sensitive.
 8742 **
 8743 ** Note that this routine returns zero on a match and non-zero if the strings
 8744 ** do not match, the same as [sqlite3_stricmp()] and [sqlite3_strnicmp()].
 8745 **
 8746 ** See also: [sqlite3_strlike()].
 8747 */
 8748 SQLITE_API int sqlite3_strglob(const char *zGlob, const char *zStr);
 8749 
 8750 /*
 8751 ** CAPI3REF: String LIKE Matching
 8752 *
 8753 ** ^The [sqlite3_strlike(P,X,E)] interface returns zero if and only if
 8754 ** string X matches the [LIKE] pattern P with escape character E.
 8755 ** ^The definition of [LIKE] pattern matching used in
 8756 ** [sqlite3_strlike(P,X,E)] is the same as for the &quot;X LIKE P ESCAPE E&quot;
 8757 ** operator in the SQL dialect understood by SQLite.  ^For &quot;X LIKE P&quot; without
 8758 ** the ESCAPE clause, set the E parameter of [sqlite3_strlike(P,X,E)] to 0.
 8759 ** ^As with the LIKE operator, the [sqlite3_strlike(P,X,E)] function is case
 8760 ** insensitive - equivalent upper and lower case ASCII characters match
 8761 ** one another.
 8762 **
 8763 ** ^The [sqlite3_strlike(P,X,E)] function matches Unicode characters, though
 8764 ** only ASCII characters are case folded.
 8765 **
 8766 ** Note that this routine returns zero on a match and non-zero if the strings
 8767 ** do not match, the same as [sqlite3_stricmp()] and [sqlite3_strnicmp()].
 8768 **
 8769 ** See also: [sqlite3_strglob()].
 8770 */
 8771 SQLITE_API int sqlite3_strlike(const char *zGlob, const char *zStr, unsigned int cEsc);
 8772 
 8773 /*
 8774 ** CAPI3REF: Error Logging Interface
 8775 **
 8776 ** ^The [sqlite3_log()] interface writes a message into the [error log]
 8777 ** established by the [SQLITE_CONFIG_LOG] option to [sqlite3_config()].
 8778 ** ^If logging is enabled, the zFormat string and subsequent arguments are
 8779 ** used with [sqlite3_snprintf()] to generate the final output string.
 8780 **
 8781 ** The sqlite3_log() interface is intended for use by extensions such as
 8782 ** virtual tables, collating functions, and SQL functions.  While there is
 8783 ** nothing to prevent an application from calling sqlite3_log(), doing so
 8784 ** is considered bad form.
 8785 **
 8786 ** The zFormat string must not be NULL.
 8787 **
 8788 ** To avoid deadlocks and other threading problems, the sqlite3_log() routine
 8789 ** will not use dynamically allocated memory.  The log message is stored in
 8790 ** a fixed-length buffer on the stack.  If the log message is longer than
 8791 ** a few hundred characters, it will be truncated to the length of the
 8792 ** buffer.
 8793 */
 8794 SQLITE_API void sqlite3_log(int iErrCode, const char *zFormat, ...);
 8795 
 8796 /*
 8797 ** CAPI3REF: Write-Ahead Log Commit Hook
 8798 ** METHOD: sqlite3
 8799 **
 8800 ** ^The [sqlite3_wal_hook()] function is used to register a callback that
 8801 ** is invoked each time data is committed to a database in wal mode.
 8802 **
 8803 ** ^(The callback is invoked by SQLite after the commit has taken place and
 8804 ** the associated write-lock on the database released)^, so the implementation
 8805 ** may read, write or [checkpoint] the database as required.
 8806 **
 8807 ** ^The first parameter passed to the callback function when it is invoked
 8808 ** is a copy of the third parameter passed to sqlite3_wal_hook() when
 8809 ** registering the callback. ^The second is a copy of the database handle.
 8810 ** ^The third parameter is the name of the database that was written to -
 8811 ** either &quot;main&quot; or the name of an [ATTACH]-ed database. ^The fourth parameter
 8812 ** is the number of pages currently in the write-ahead log file,
 8813 ** including those that were just committed.
 8814 **
 8815 ** The callback function should normally return [SQLITE_OK].  ^If an error
 8816 ** code is returned, that error will propagate back up through the
 8817 ** SQLite code base to cause the statement that provoked the callback
 8818 ** to report an error, though the commit will have still occurred. If the
 8819 ** callback returns [SQLITE_ROW] or [SQLITE_DONE], or if it returns a value
 8820 ** that does not correspond to any valid SQLite error code, the results
 8821 ** are undefined.
 8822 **
 8823 ** A single database handle may have at most a single write-ahead log callback
 8824 ** registered at one time. ^Calling [sqlite3_wal_hook()] replaces any
 8825 ** previously registered write-ahead log callback. ^Note that the
 8826 ** [sqlite3_wal_autocheckpoint()] interface and the
 8827 ** [wal_autocheckpoint pragma] both invoke [sqlite3_wal_hook()] and will
 8828 ** overwrite any prior [sqlite3_wal_hook()] settings.
 8829 */
 8830 SQLITE_API void *sqlite3_wal_hook(
 8831   sqlite3*,
 8832   int(*)(void *,sqlite3*,const char*,int),
 8833   void*
 8834 );
 8835 
 8836 /*
 8837 ** CAPI3REF: Configure an auto-checkpoint
 8838 ** METHOD: sqlite3
 8839 **
 8840 ** ^The [sqlite3_wal_autocheckpoint(D,N)] is a wrapper around
 8841 ** [sqlite3_wal_hook()] that causes any database on [database connection] D
 8842 ** to automatically [checkpoint]
 8843 ** after committing a transaction if there are N or
 8844 ** more frames in the [write-ahead log] file.  ^Passing zero or
 8845 ** a negative value as the nFrame parameter disables automatic
 8846 ** checkpoints entirely.
 8847 **
 8848 ** ^The callback registered by this function replaces any existing callback
 8849 ** registered using [sqlite3_wal_hook()].  ^Likewise, registering a callback
 8850 ** using [sqlite3_wal_hook()] disables the automatic checkpoint mechanism
 8851 ** configured by this function.
 8852 **
 8853 ** ^The [wal_autocheckpoint pragma] can be used to invoke this interface
 8854 ** from SQL.
 8855 **
 8856 ** ^Checkpoints initiated by this mechanism are
 8857 ** [sqlite3_wal_checkpoint_v2|PASSIVE].
 8858 **
 8859 ** ^Every new [database connection] defaults to having the auto-checkpoint
 8860 ** enabled with a threshold of 1000 or [SQLITE_DEFAULT_WAL_AUTOCHECKPOINT]
 8861 ** pages.  The use of this interface
 8862 ** is only necessary if the default setting is found to be suboptimal
 8863 ** for a particular application.
 8864 */
 8865 SQLITE_API int sqlite3_wal_autocheckpoint(sqlite3 *db, int N);
 8866 
 8867 /*
 8868 ** CAPI3REF: Checkpoint a database
 8869 ** METHOD: sqlite3
 8870 **
 8871 ** ^(The sqlite3_wal_checkpoint(D,X) is equivalent to
 8872 ** [sqlite3_wal_checkpoint_v2](D,X,[SQLITE_CHECKPOINT_PASSIVE],0,0).)^
 8873 **
 8874 ** In brief, sqlite3_wal_checkpoint(D,X) causes the content in the
 8875 ** [write-ahead log] for database X on [database connection] D to be
 8876 ** transferred into the database file and for the write-ahead log to
 8877 ** be reset.  See the [checkpointing] documentation for addition
 8878 ** information.
 8879 **
 8880 ** This interface used to be the only way to cause a checkpoint to
 8881 ** occur.  But then the newer and more powerful [sqlite3_wal_checkpoint_v2()]
 8882 ** interface was added.  This interface is retained for backwards
 8883 ** compatibility and as a convenience for applications that need to manually
 8884 ** start a callback but which do not need the full power (and corresponding
 8885 ** complication) of [sqlite3_wal_checkpoint_v2()].
 8886 */
 8887 SQLITE_API int sqlite3_wal_checkpoint(sqlite3 *db, const char *zDb);
 8888 
 8889 /*
 8890 ** CAPI3REF: Checkpoint a database
 8891 ** METHOD: sqlite3
 8892 **
 8893 ** ^(The sqlite3_wal_checkpoint_v2(D,X,M,L,C) interface runs a checkpoint
 8894 ** operation on database X of [database connection] D in mode M.  Status
 8895 ** information is written back into integers pointed to by L and C.)^
 8896 ** ^(The M parameter must be a valid [checkpoint mode]:)^
 8897 **
 8898 ** &lt;dl&gt;
 8899 ** &lt;dt&gt;SQLITE_CHECKPOINT_PASSIVE&lt;dd&gt;
 8900 **   ^Checkpoint as many frames as possible without waiting for any database
 8901 **   readers or writers to finish, then sync the database file if all frames
 8902 **   in the log were checkpointed. ^The [busy-handler callback]
 8903 **   is never invoked in the SQLITE_CHECKPOINT_PASSIVE mode.
 8904 **   ^On the other hand, passive mode might leave the checkpoint unfinished
 8905 **   if there are concurrent readers or writers.
 8906 **
 8907 ** &lt;dt&gt;SQLITE_CHECKPOINT_FULL&lt;dd&gt;
 8908 **   ^This mode blocks (it invokes the
 8909 **   [sqlite3_busy_handler|busy-handler callback]) until there is no
 8910 **   database writer and all readers are reading from the most recent database
 8911 **   snapshot. ^It then checkpoints all frames in the log file and syncs the
 8912 **   database file. ^This mode blocks new database writers while it is pending,
 8913 **   but new database readers are allowed to continue unimpeded.
 8914 **
 8915 ** &lt;dt&gt;SQLITE_CHECKPOINT_RESTART&lt;dd&gt;
 8916 **   ^This mode works the same way as SQLITE_CHECKPOINT_FULL with the addition
 8917 **   that after checkpointing the log file it blocks (calls the
 8918 **   [busy-handler callback])
 8919 **   until all readers are reading from the database file only. ^This ensures
 8920 **   that the next writer will restart the log file from the beginning.
 8921 **   ^Like SQLITE_CHECKPOINT_FULL, this mode blocks new
 8922 **   database writer attempts while it is pending, but does not impede readers.
 8923 **
 8924 ** &lt;dt&gt;SQLITE_CHECKPOINT_TRUNCATE&lt;dd&gt;
 8925 **   ^This mode works the same way as SQLITE_CHECKPOINT_RESTART with the
 8926 **   addition that it also truncates the log file to zero bytes just prior
 8927 **   to a successful return.
 8928 ** &lt;/dl&gt;
 8929 **
 8930 ** ^If pnLog is not NULL, then *pnLog is set to the total number of frames in
 8931 ** the log file or to -1 if the checkpoint could not run because
 8932 ** of an error or because the database is not in [WAL mode]. ^If pnCkpt is not
 8933 ** NULL,then *pnCkpt is set to the total number of checkpointed frames in the
 8934 ** log file (including any that were already checkpointed before the function
 8935 ** was called) or to -1 if the checkpoint could not run due to an error or
 8936 ** because the database is not in WAL mode. ^Note that upon successful
 8937 ** completion of an SQLITE_CHECKPOINT_TRUNCATE, the log file will have been
 8938 ** truncated to zero bytes and so both *pnLog and *pnCkpt will be set to zero.
 8939 **
 8940 ** ^All calls obtain an exclusive &quot;checkpoint&quot; lock on the database file. ^If
 8941 ** any other process is running a checkpoint operation at the same time, the
 8942 ** lock cannot be obtained and SQLITE_BUSY is returned. ^Even if there is a
 8943 ** busy-handler configured, it will not be invoked in this case.
 8944 **
 8945 ** ^The SQLITE_CHECKPOINT_FULL, RESTART and TRUNCATE modes also obtain the
 8946 ** exclusive &quot;writer&quot; lock on the database file. ^If the writer lock cannot be
 8947 ** obtained immediately, and a busy-handler is configured, it is invoked and
 8948 ** the writer lock retried until either the busy-handler returns 0 or the lock
 8949 ** is successfully obtained. ^The busy-handler is also invoked while waiting for
 8950 ** database readers as described above. ^If the busy-handler returns 0 before
 8951 ** the writer lock is obtained or while waiting for database readers, the
 8952 ** checkpoint operation proceeds from that point in the same way as
 8953 ** SQLITE_CHECKPOINT_PASSIVE - checkpointing as many frames as possible
 8954 ** without blocking any further. ^SQLITE_BUSY is returned in this case.
 8955 **
 8956 ** ^If parameter zDb is NULL or points to a zero length string, then the
 8957 ** specified operation is attempted on all WAL databases [attached] to
 8958 ** [database connection] db.  In this case the
 8959 ** values written to output parameters *pnLog and *pnCkpt are undefined. ^If
 8960 ** an SQLITE_BUSY error is encountered when processing one or more of the
 8961 ** attached WAL databases, the operation is still attempted on any remaining
 8962 ** attached databases and SQLITE_BUSY is returned at the end. ^If any other
 8963 ** error occurs while processing an attached database, processing is abandoned
 8964 ** and the error code is returned to the caller immediately. ^If no error
 8965 ** (SQLITE_BUSY or otherwise) is encountered while processing the attached
 8966 ** databases, SQLITE_OK is returned.
 8967 **
 8968 ** ^If database zDb is the name of an attached database that is not in WAL
 8969 ** mode, SQLITE_OK is returned and both *pnLog and *pnCkpt set to -1. ^If
 8970 ** zDb is not NULL (or a zero length string) and is not the name of any
 8971 ** attached database, SQLITE_ERROR is returned to the caller.
 8972 **
 8973 ** ^Unless it returns SQLITE_MISUSE,
 8974 ** the sqlite3_wal_checkpoint_v2() interface
 8975 ** sets the error information that is queried by
 8976 ** [sqlite3_errcode()] and [sqlite3_errmsg()].
 8977 **
 8978 ** ^The [PRAGMA wal_checkpoint] command can be used to invoke this interface
 8979 ** from SQL.
 8980 */
 8981 SQLITE_API int sqlite3_wal_checkpoint_v2(
 8982   sqlite3 *db,                    /* Database handle */
 8983   const char *zDb,                /* Name of attached database (or NULL) */
 8984   int eMode,                      /* SQLITE_CHECKPOINT_* value */
 8985   int *pnLog,                     /* OUT: Size of WAL log in frames */
 8986   int *pnCkpt                     /* OUT: Total number of frames checkpointed */
 8987 );
 8988 
 8989 /*
 8990 ** CAPI3REF: Checkpoint Mode Values
 8991 ** KEYWORDS: {checkpoint mode}
 8992 **
 8993 ** These constants define all valid values for the &quot;checkpoint mode&quot; passed
 8994 ** as the third parameter to the [sqlite3_wal_checkpoint_v2()] interface.
 8995 ** See the [sqlite3_wal_checkpoint_v2()] documentation for details on the
 8996 ** meaning of each of these checkpoint modes.
 8997 */
 8998 #define SQLITE_CHECKPOINT_PASSIVE  0  /* Do as much as possible w/o blocking */
 8999 #define SQLITE_CHECKPOINT_FULL     1  /* Wait for writers, then checkpoint */
 9000 #define SQLITE_CHECKPOINT_RESTART  2  /* Like FULL but wait for for readers */
 9001 #define SQLITE_CHECKPOINT_TRUNCATE 3  /* Like RESTART but also truncate WAL */
 9002 
 9003 /*
 9004 ** CAPI3REF: Virtual Table Interface Configuration
 9005 **
 9006 ** This function may be called by either the [xConnect] or [xCreate] method
 9007 ** of a [virtual table] implementation to configure
 9008 ** various facets of the virtual table interface.
 9009 **
 9010 ** If this interface is invoked outside the context of an xConnect or
 9011 ** xCreate virtual table method then the behavior is undefined.
 9012 **
<a name="86" id="anc86"></a><span class="line-modified"> 9013 ** In the call sqlite3_vtab_config(D,C,...) the D parameter is the</span>
<span class="line-modified"> 9014 ** [database connection] in which the virtual table is being created and</span>
<span class="line-modified"> 9015 ** which is passed in as the first argument to the [xConnect] or [xCreate]</span>
<span class="line-added"> 9016 ** method that is invoking sqlite3_vtab_config().  The C parameter is one</span>
<span class="line-added"> 9017 ** of the [virtual table configuration options].  The presence and meaning</span>
<span class="line-added"> 9018 ** of parameters after C depend on which [virtual table configuration option]</span>
<span class="line-added"> 9019 ** is used.</span>
 9020 */
 9021 SQLITE_API int sqlite3_vtab_config(sqlite3*, int op, ...);
 9022 
 9023 /*
 9024 ** CAPI3REF: Virtual Table Configuration Options
<a name="87" id="anc87"></a><span class="line-added"> 9025 ** KEYWORDS: {virtual table configuration options}</span>
<span class="line-added"> 9026 ** KEYWORDS: {virtual table configuration option}</span>
 9027 **
 9028 ** These macros define the various options to the
 9029 ** [sqlite3_vtab_config()] interface that [virtual table] implementations
 9030 ** can use to customize and optimize their behavior.
 9031 **
 9032 ** &lt;dl&gt;
 9033 ** [[SQLITE_VTAB_CONSTRAINT_SUPPORT]]
<a name="88" id="anc88"></a><span class="line-modified"> 9034 ** &lt;dt&gt;SQLITE_VTAB_CONSTRAINT_SUPPORT&lt;/dt&gt;</span>
 9035 ** &lt;dd&gt;Calls of the form
 9036 ** [sqlite3_vtab_config](db,SQLITE_VTAB_CONSTRAINT_SUPPORT,X) are supported,
 9037 ** where X is an integer.  If X is zero, then the [virtual table] whose
 9038 ** [xCreate] or [xConnect] method invoked [sqlite3_vtab_config()] does not
 9039 ** support constraints.  In this configuration (which is the default) if
 9040 ** a call to the [xUpdate] method returns [SQLITE_CONSTRAINT], then the entire
 9041 ** statement is rolled back as if [ON CONFLICT | OR ABORT] had been
 9042 ** specified as part of the users SQL statement, regardless of the actual
 9043 ** ON CONFLICT mode specified.
 9044 **
 9045 ** If X is non-zero, then the virtual table implementation guarantees
 9046 ** that if [xUpdate] returns [SQLITE_CONSTRAINT], it will do so before
 9047 ** any modifications to internal or persistent data structures have been made.
 9048 ** If the [ON CONFLICT] mode is ABORT, FAIL, IGNORE or ROLLBACK, SQLite
 9049 ** is able to roll back a statement or database transaction, and abandon
 9050 ** or continue processing the current SQL statement as appropriate.
 9051 ** If the ON CONFLICT mode is REPLACE and the [xUpdate] method returns
 9052 ** [SQLITE_CONSTRAINT], SQLite handles this as if the ON CONFLICT mode
 9053 ** had been ABORT.
 9054 **
 9055 ** Virtual table implementations that are required to handle OR REPLACE
 9056 ** must do so within the [xUpdate] method. If a call to the
 9057 ** [sqlite3_vtab_on_conflict()] function indicates that the current ON
 9058 ** CONFLICT policy is REPLACE, the virtual table implementation should
 9059 ** silently replace the appropriate rows within the xUpdate callback and
 9060 ** return SQLITE_OK. Or, if this is not possible, it may return
 9061 ** SQLITE_CONSTRAINT, in which case SQLite falls back to OR ABORT
 9062 ** constraint handling.
<a name="89" id="anc89"></a><span class="line-added"> 9063 ** &lt;/dd&gt;</span>
<span class="line-added"> 9064 **</span>
<span class="line-added"> 9065 ** [[SQLITE_VTAB_DIRECTONLY]]&lt;dt&gt;SQLITE_VTAB_DIRECTONLY&lt;/dt&gt;</span>
<span class="line-added"> 9066 ** &lt;dd&gt;Calls of the form</span>
<span class="line-added"> 9067 ** [sqlite3_vtab_config](db,SQLITE_VTAB_DIRECTONLY) from within the</span>
<span class="line-added"> 9068 ** the [xConnect] or [xCreate] methods of a [virtual table] implmentation</span>
<span class="line-added"> 9069 ** prohibits that virtual table from being used from within triggers and</span>
<span class="line-added"> 9070 ** views.</span>
<span class="line-added"> 9071 ** &lt;/dd&gt;</span>
<span class="line-added"> 9072 **</span>
<span class="line-added"> 9073 ** [[SQLITE_VTAB_INNOCUOUS]]&lt;dt&gt;SQLITE_VTAB_INNOCUOUS&lt;/dt&gt;</span>
<span class="line-added"> 9074 ** &lt;dd&gt;Calls of the form</span>
<span class="line-added"> 9075 ** [sqlite3_vtab_config](db,SQLITE_VTAB_INNOCUOUS) from within the</span>
<span class="line-added"> 9076 ** the [xConnect] or [xCreate] methods of a [virtual table] implmentation</span>
<span class="line-added"> 9077 ** identify that virtual table as being safe to use from within triggers</span>
<span class="line-added"> 9078 ** and views.  Conceptually, the SQLITE_VTAB_INNOCUOUS tag means that the</span>
<span class="line-added"> 9079 ** virtual table can do no serious harm even if it is controlled by a</span>
<span class="line-added"> 9080 ** malicious hacker.  Developers should avoid setting the SQLITE_VTAB_INNOCUOUS</span>
<span class="line-added"> 9081 ** flag unless absolutely necessary.</span>
<span class="line-added"> 9082 ** &lt;/dd&gt;</span>
 9083 ** &lt;/dl&gt;
 9084 */
 9085 #define SQLITE_VTAB_CONSTRAINT_SUPPORT 1
<a name="90" id="anc90"></a><span class="line-added"> 9086 #define SQLITE_VTAB_INNOCUOUS          2</span>
<span class="line-added"> 9087 #define SQLITE_VTAB_DIRECTONLY         3</span>
 9088 
 9089 /*
 9090 ** CAPI3REF: Determine The Virtual Table Conflict Policy
 9091 **
 9092 ** This function may only be called from within a call to the [xUpdate] method
 9093 ** of a [virtual table] implementation for an INSERT or UPDATE operation. ^The
 9094 ** value returned is one of [SQLITE_ROLLBACK], [SQLITE_IGNORE], [SQLITE_FAIL],
 9095 ** [SQLITE_ABORT], or [SQLITE_REPLACE], according to the [ON CONFLICT] mode
 9096 ** of the SQL statement that triggered the call to the [xUpdate] method of the
 9097 ** [virtual table].
 9098 */
 9099 SQLITE_API int sqlite3_vtab_on_conflict(sqlite3 *);
 9100 
 9101 /*
 9102 ** CAPI3REF: Determine If Virtual Table Column Access Is For UPDATE
 9103 **
 9104 ** If the sqlite3_vtab_nochange(X) routine is called within the [xColumn]
 9105 ** method of a [virtual table], then it returns true if and only if the
 9106 ** column is being fetched as part of an UPDATE operation during which the
 9107 ** column value will not change.  Applications might use this to substitute
 9108 ** a return value that is less expensive to compute and that the corresponding
 9109 ** [xUpdate] method understands as a &quot;no-change&quot; value.
 9110 **
 9111 ** If the [xColumn] method calls sqlite3_vtab_nochange() and finds that
 9112 ** the column is not changed by the UPDATE statement, then the xColumn
 9113 ** method can optionally return without setting a result, without calling
 9114 ** any of the [sqlite3_result_int|sqlite3_result_xxxxx() interfaces].
 9115 ** In that case, [sqlite3_value_nochange(X)] will return true for the
 9116 ** same column in the [xUpdate] method.
 9117 */
 9118 SQLITE_API int sqlite3_vtab_nochange(sqlite3_context*);
 9119 
 9120 /*
 9121 ** CAPI3REF: Determine The Collation For a Virtual Table Constraint
 9122 **
 9123 ** This function may only be called from within a call to the [xBestIndex]
 9124 ** method of a [virtual table].
 9125 **
 9126 ** The first argument must be the sqlite3_index_info object that is the
 9127 ** first parameter to the xBestIndex() method. The second argument must be
 9128 ** an index into the aConstraint[] array belonging to the sqlite3_index_info
 9129 ** structure passed to xBestIndex. This function returns a pointer to a buffer
 9130 ** containing the name of the collation sequence for the corresponding
 9131 ** constraint.
 9132 */
 9133 SQLITE_API SQLITE_EXPERIMENTAL const char *sqlite3_vtab_collation(sqlite3_index_info*,int);
 9134 
 9135 /*
 9136 ** CAPI3REF: Conflict resolution modes
 9137 ** KEYWORDS: {conflict resolution mode}
 9138 **
 9139 ** These constants are returned by [sqlite3_vtab_on_conflict()] to
 9140 ** inform a [virtual table] implementation what the [ON CONFLICT] mode
 9141 ** is for the SQL statement being evaluated.
 9142 **
 9143 ** Note that the [SQLITE_IGNORE] constant is also used as a potential
 9144 ** return value from the [sqlite3_set_authorizer()] callback and that
 9145 ** [SQLITE_ABORT] is also a [result code].
 9146 */
 9147 #define SQLITE_ROLLBACK 1
 9148 /* #define SQLITE_IGNORE 2 // Also used by sqlite3_authorizer() callback */
 9149 #define SQLITE_FAIL     3
 9150 /* #define SQLITE_ABORT 4  // Also an error code */
 9151 #define SQLITE_REPLACE  5
 9152 
 9153 /*
 9154 ** CAPI3REF: Prepared Statement Scan Status Opcodes
 9155 ** KEYWORDS: {scanstatus options}
 9156 **
 9157 ** The following constants can be used for the T parameter to the
 9158 ** [sqlite3_stmt_scanstatus(S,X,T,V)] interface.  Each constant designates a
 9159 ** different metric for sqlite3_stmt_scanstatus() to return.
 9160 **
 9161 ** When the value returned to V is a string, space to hold that string is
 9162 ** managed by the prepared statement S and will be automatically freed when
 9163 ** S is finalized.
 9164 **
 9165 ** &lt;dl&gt;
 9166 ** [[SQLITE_SCANSTAT_NLOOP]] &lt;dt&gt;SQLITE_SCANSTAT_NLOOP&lt;/dt&gt;
<a name="91" id="anc91"></a><span class="line-modified"> 9167 ** &lt;dd&gt;^The [sqlite3_int64] variable pointed to by the V parameter will be</span>
 9168 ** set to the total number of times that the X-th loop has run.&lt;/dd&gt;
 9169 **
 9170 ** [[SQLITE_SCANSTAT_NVISIT]] &lt;dt&gt;SQLITE_SCANSTAT_NVISIT&lt;/dt&gt;
<a name="92" id="anc92"></a><span class="line-modified"> 9171 ** &lt;dd&gt;^The [sqlite3_int64] variable pointed to by the V parameter will be set</span>
 9172 ** to the total number of rows examined by all iterations of the X-th loop.&lt;/dd&gt;
 9173 **
 9174 ** [[SQLITE_SCANSTAT_EST]] &lt;dt&gt;SQLITE_SCANSTAT_EST&lt;/dt&gt;
<a name="93" id="anc93"></a><span class="line-modified"> 9175 ** &lt;dd&gt;^The &quot;double&quot; variable pointed to by the V parameter will be set to the</span>
 9176 ** query planner&#39;s estimate for the average number of rows output from each
 9177 ** iteration of the X-th loop.  If the query planner&#39;s estimates was accurate,
 9178 ** then this value will approximate the quotient NVISIT/NLOOP and the
 9179 ** product of this value for all prior loops with the same SELECTID will
 9180 ** be the NLOOP value for the current loop.
 9181 **
 9182 ** [[SQLITE_SCANSTAT_NAME]] &lt;dt&gt;SQLITE_SCANSTAT_NAME&lt;/dt&gt;
<a name="94" id="anc94"></a><span class="line-modified"> 9183 ** &lt;dd&gt;^The &quot;const char *&quot; variable pointed to by the V parameter will be set</span>
 9184 ** to a zero-terminated UTF-8 string containing the name of the index or table
 9185 ** used for the X-th loop.
 9186 **
 9187 ** [[SQLITE_SCANSTAT_EXPLAIN]] &lt;dt&gt;SQLITE_SCANSTAT_EXPLAIN&lt;/dt&gt;
<a name="95" id="anc95"></a><span class="line-modified"> 9188 ** &lt;dd&gt;^The &quot;const char *&quot; variable pointed to by the V parameter will be set</span>
 9189 ** to a zero-terminated UTF-8 string containing the [EXPLAIN QUERY PLAN]
 9190 ** description for the X-th loop.
 9191 **
 9192 ** [[SQLITE_SCANSTAT_SELECTID]] &lt;dt&gt;SQLITE_SCANSTAT_SELECT&lt;/dt&gt;
<a name="96" id="anc96"></a><span class="line-modified"> 9193 ** &lt;dd&gt;^The &quot;int&quot; variable pointed to by the V parameter will be set to the</span>
 9194 ** &quot;select-id&quot; for the X-th loop.  The select-id identifies which query or
 9195 ** subquery the loop is part of.  The main query has a select-id of zero.
 9196 ** The select-id is the same value as is output in the first column
 9197 ** of an [EXPLAIN QUERY PLAN] query.
 9198 ** &lt;/dl&gt;
 9199 */
 9200 #define SQLITE_SCANSTAT_NLOOP    0
 9201 #define SQLITE_SCANSTAT_NVISIT   1
 9202 #define SQLITE_SCANSTAT_EST      2
 9203 #define SQLITE_SCANSTAT_NAME     3
 9204 #define SQLITE_SCANSTAT_EXPLAIN  4
 9205 #define SQLITE_SCANSTAT_SELECTID 5
 9206 
 9207 /*
 9208 ** CAPI3REF: Prepared Statement Scan Status
 9209 ** METHOD: sqlite3_stmt
 9210 **
 9211 ** This interface returns information about the predicted and measured
 9212 ** performance for pStmt.  Advanced applications can use this
 9213 ** interface to compare the predicted and the measured performance and
 9214 ** issue warnings and/or rerun [ANALYZE] if discrepancies are found.
 9215 **
 9216 ** Since this interface is expected to be rarely used, it is only
 9217 ** available if SQLite is compiled using the [SQLITE_ENABLE_STMT_SCANSTATUS]
 9218 ** compile-time option.
 9219 **
 9220 ** The &quot;iScanStatusOp&quot; parameter determines which status information to return.
 9221 ** The &quot;iScanStatusOp&quot; must be one of the [scanstatus options] or the behavior
 9222 ** of this interface is undefined.
 9223 ** ^The requested measurement is written into a variable pointed to by
 9224 ** the &quot;pOut&quot; parameter.
 9225 ** Parameter &quot;idx&quot; identifies the specific loop to retrieve statistics for.
 9226 ** Loops are numbered starting from zero. ^If idx is out of range - less than
 9227 ** zero or greater than or equal to the total number of loops used to implement
 9228 ** the statement - a non-zero value is returned and the variable that pOut
 9229 ** points to is unchanged.
 9230 **
 9231 ** ^Statistics might not be available for all loops in all statements. ^In cases
 9232 ** where there exist loops with no available statistics, this function behaves
 9233 ** as if the loop did not exist - it returns non-zero and leave the variable
 9234 ** that pOut points to unchanged.
 9235 **
 9236 ** See also: [sqlite3_stmt_scanstatus_reset()]
 9237 */
 9238 SQLITE_API int sqlite3_stmt_scanstatus(
 9239   sqlite3_stmt *pStmt,      /* Prepared statement for which info desired */
 9240   int idx,                  /* Index of loop to report on */
 9241   int iScanStatusOp,        /* Information desired.  SQLITE_SCANSTAT_* */
 9242   void *pOut                /* Result written here */
 9243 );
 9244 
 9245 /*
 9246 ** CAPI3REF: Zero Scan-Status Counters
 9247 ** METHOD: sqlite3_stmt
 9248 **
 9249 ** ^Zero all [sqlite3_stmt_scanstatus()] related event counters.
 9250 **
 9251 ** This API is only available if the library is built with pre-processor
 9252 ** symbol [SQLITE_ENABLE_STMT_SCANSTATUS] defined.
 9253 */
 9254 SQLITE_API void sqlite3_stmt_scanstatus_reset(sqlite3_stmt*);
 9255 
 9256 /*
 9257 ** CAPI3REF: Flush caches to disk mid-transaction
 9258 **
 9259 ** ^If a write-transaction is open on [database connection] D when the
 9260 ** [sqlite3_db_cacheflush(D)] interface invoked, any dirty
 9261 ** pages in the pager-cache that are not currently in use are written out
 9262 ** to disk. A dirty page may be in use if a database cursor created by an
 9263 ** active SQL statement is reading from it, or if it is page 1 of a database
 9264 ** file (page 1 is always &quot;in use&quot;).  ^The [sqlite3_db_cacheflush(D)]
 9265 ** interface flushes caches for all schemas - &quot;main&quot;, &quot;temp&quot;, and
 9266 ** any [attached] databases.
 9267 **
 9268 ** ^If this function needs to obtain extra database locks before dirty pages
 9269 ** can be flushed to disk, it does so. ^If those locks cannot be obtained
 9270 ** immediately and there is a busy-handler callback configured, it is invoked
 9271 ** in the usual manner. ^If the required lock still cannot be obtained, then
 9272 ** the database is skipped and an attempt made to flush any dirty pages
 9273 ** belonging to the next (if any) database. ^If any databases are skipped
 9274 ** because locks cannot be obtained, but no other error occurs, this
 9275 ** function returns SQLITE_BUSY.
 9276 **
 9277 ** ^If any other error occurs while flushing dirty pages to disk (for
 9278 ** example an IO error or out-of-memory condition), then processing is
 9279 ** abandoned and an SQLite [error code] is returned to the caller immediately.
 9280 **
 9281 ** ^Otherwise, if no error occurs, [sqlite3_db_cacheflush()] returns SQLITE_OK.
 9282 **
 9283 ** ^This function does not set the database handle error code or message
 9284 ** returned by the [sqlite3_errcode()] and [sqlite3_errmsg()] functions.
 9285 */
 9286 SQLITE_API int sqlite3_db_cacheflush(sqlite3*);
 9287 
 9288 /*
 9289 ** CAPI3REF: The pre-update hook.
 9290 **
 9291 ** ^These interfaces are only available if SQLite is compiled using the
 9292 ** [SQLITE_ENABLE_PREUPDATE_HOOK] compile-time option.
 9293 **
 9294 ** ^The [sqlite3_preupdate_hook()] interface registers a callback function
 9295 ** that is invoked prior to each [INSERT], [UPDATE], and [DELETE] operation
 9296 ** on a database table.
 9297 ** ^At most one preupdate hook may be registered at a time on a single
 9298 ** [database connection]; each call to [sqlite3_preupdate_hook()] overrides
 9299 ** the previous setting.
 9300 ** ^The preupdate hook is disabled by invoking [sqlite3_preupdate_hook()]
 9301 ** with a NULL pointer as the second parameter.
 9302 ** ^The third parameter to [sqlite3_preupdate_hook()] is passed through as
 9303 ** the first parameter to callbacks.
 9304 **
 9305 ** ^The preupdate hook only fires for changes to real database tables; the
 9306 ** preupdate hook is not invoked for changes to [virtual tables] or to
 9307 ** system tables like sqlite_master or sqlite_stat1.
 9308 **
 9309 ** ^The second parameter to the preupdate callback is a pointer to
 9310 ** the [database connection] that registered the preupdate hook.
 9311 ** ^The third parameter to the preupdate callback is one of the constants
 9312 ** [SQLITE_INSERT], [SQLITE_DELETE], or [SQLITE_UPDATE] to identify the
 9313 ** kind of update operation that is about to occur.
 9314 ** ^(The fourth parameter to the preupdate callback is the name of the
 9315 ** database within the database connection that is being modified.  This
 9316 ** will be &quot;main&quot; for the main database or &quot;temp&quot; for TEMP tables or
 9317 ** the name given after the AS keyword in the [ATTACH] statement for attached
 9318 ** databases.)^
 9319 ** ^The fifth parameter to the preupdate callback is the name of the
 9320 ** table that is being modified.
 9321 **
 9322 ** For an UPDATE or DELETE operation on a [rowid table], the sixth
 9323 ** parameter passed to the preupdate callback is the initial [rowid] of the
 9324 ** row being modified or deleted. For an INSERT operation on a rowid table,
 9325 ** or any operation on a WITHOUT ROWID table, the value of the sixth
 9326 ** parameter is undefined. For an INSERT or UPDATE on a rowid table the
 9327 ** seventh parameter is the final rowid value of the row being inserted
 9328 ** or updated. The value of the seventh parameter passed to the callback
 9329 ** function is not defined for operations on WITHOUT ROWID tables, or for
 9330 ** INSERT operations on rowid tables.
 9331 **
 9332 ** The [sqlite3_preupdate_old()], [sqlite3_preupdate_new()],
 9333 ** [sqlite3_preupdate_count()], and [sqlite3_preupdate_depth()] interfaces
 9334 ** provide additional information about a preupdate event. These routines
 9335 ** may only be called from within a preupdate callback.  Invoking any of
 9336 ** these routines from outside of a preupdate callback or with a
 9337 ** [database connection] pointer that is different from the one supplied
 9338 ** to the preupdate callback results in undefined and probably undesirable
 9339 ** behavior.
 9340 **
 9341 ** ^The [sqlite3_preupdate_count(D)] interface returns the number of columns
 9342 ** in the row that is being inserted, updated, or deleted.
 9343 **
 9344 ** ^The [sqlite3_preupdate_old(D,N,P)] interface writes into P a pointer to
 9345 ** a [protected sqlite3_value] that contains the value of the Nth column of
 9346 ** the table row before it is updated.  The N parameter must be between 0
 9347 ** and one less than the number of columns or the behavior will be
 9348 ** undefined. This must only be used within SQLITE_UPDATE and SQLITE_DELETE
 9349 ** preupdate callbacks; if it is used by an SQLITE_INSERT callback then the
 9350 ** behavior is undefined.  The [sqlite3_value] that P points to
 9351 ** will be destroyed when the preupdate callback returns.
 9352 **
 9353 ** ^The [sqlite3_preupdate_new(D,N,P)] interface writes into P a pointer to
 9354 ** a [protected sqlite3_value] that contains the value of the Nth column of
 9355 ** the table row after it is updated.  The N parameter must be between 0
 9356 ** and one less than the number of columns or the behavior will be
 9357 ** undefined. This must only be used within SQLITE_INSERT and SQLITE_UPDATE
 9358 ** preupdate callbacks; if it is used by an SQLITE_DELETE callback then the
 9359 ** behavior is undefined.  The [sqlite3_value] that P points to
 9360 ** will be destroyed when the preupdate callback returns.
 9361 **
 9362 ** ^The [sqlite3_preupdate_depth(D)] interface returns 0 if the preupdate
 9363 ** callback was invoked as a result of a direct insert, update, or delete
 9364 ** operation; or 1 for inserts, updates, or deletes invoked by top-level
 9365 ** triggers; or 2 for changes resulting from triggers called by top-level
 9366 ** triggers; and so forth.
 9367 **
 9368 ** See also:  [sqlite3_update_hook()]
 9369 */
 9370 #if defined(SQLITE_ENABLE_PREUPDATE_HOOK)
 9371 SQLITE_API void *sqlite3_preupdate_hook(
 9372   sqlite3 *db,
 9373   void(*xPreUpdate)(
 9374     void *pCtx,                   /* Copy of third arg to preupdate_hook() */
 9375     sqlite3 *db,                  /* Database handle */
 9376     int op,                       /* SQLITE_UPDATE, DELETE or INSERT */
 9377     char const *zDb,              /* Database name */
 9378     char const *zName,            /* Table name */
 9379     sqlite3_int64 iKey1,          /* Rowid of row about to be deleted/updated */
 9380     sqlite3_int64 iKey2           /* New rowid value (for a rowid UPDATE) */
 9381   ),
 9382   void*
 9383 );
 9384 SQLITE_API int sqlite3_preupdate_old(sqlite3 *, int, sqlite3_value **);
 9385 SQLITE_API int sqlite3_preupdate_count(sqlite3 *);
 9386 SQLITE_API int sqlite3_preupdate_depth(sqlite3 *);
 9387 SQLITE_API int sqlite3_preupdate_new(sqlite3 *, int, sqlite3_value **);
 9388 #endif
 9389 
 9390 /*
 9391 ** CAPI3REF: Low-level system error code
 9392 **
 9393 ** ^Attempt to return the underlying operating system error code or error
 9394 ** number that caused the most recent I/O error or failure to open a file.
 9395 ** The return value is OS-dependent.  For example, on unix systems, after
 9396 ** [sqlite3_open_v2()] returns [SQLITE_CANTOPEN], this interface could be
 9397 ** called to get back the underlying &quot;errno&quot; that caused the problem, such
 9398 ** as ENOSPC, EAUTH, EISDIR, and so forth.
 9399 */
 9400 SQLITE_API int sqlite3_system_errno(sqlite3*);
 9401 
 9402 /*
 9403 ** CAPI3REF: Database Snapshot
 9404 ** KEYWORDS: {snapshot} {sqlite3_snapshot}
 9405 **
 9406 ** An instance of the snapshot object records the state of a [WAL mode]
 9407 ** database for some specific point in history.
 9408 **
 9409 ** In [WAL mode], multiple [database connections] that are open on the
 9410 ** same database file can each be reading a different historical version
 9411 ** of the database file.  When a [database connection] begins a read
 9412 ** transaction, that connection sees an unchanging copy of the database
 9413 ** as it existed for the point in time when the transaction first started.
 9414 ** Subsequent changes to the database from other connections are not seen
 9415 ** by the reader until a new read transaction is started.
 9416 **
 9417 ** The sqlite3_snapshot object records state information about an historical
 9418 ** version of the database file so that it is possible to later open a new read
 9419 ** transaction that sees that historical version of the database rather than
 9420 ** the most recent version.
 9421 */
 9422 typedef struct sqlite3_snapshot {
 9423   unsigned char hidden[48];
 9424 } sqlite3_snapshot;
 9425 
 9426 /*
 9427 ** CAPI3REF: Record A Database Snapshot
 9428 ** CONSTRUCTOR: sqlite3_snapshot
 9429 **
 9430 ** ^The [sqlite3_snapshot_get(D,S,P)] interface attempts to make a
 9431 ** new [sqlite3_snapshot] object that records the current state of
 9432 ** schema S in database connection D.  ^On success, the
 9433 ** [sqlite3_snapshot_get(D,S,P)] interface writes a pointer to the newly
 9434 ** created [sqlite3_snapshot] object into *P and returns SQLITE_OK.
 9435 ** If there is not already a read-transaction open on schema S when
 9436 ** this function is called, one is opened automatically.
 9437 **
 9438 ** The following must be true for this function to succeed. If any of
 9439 ** the following statements are false when sqlite3_snapshot_get() is
 9440 ** called, SQLITE_ERROR is returned. The final value of *P is undefined
 9441 ** in this case.
 9442 **
 9443 ** &lt;ul&gt;
 9444 **   &lt;li&gt; The database handle must not be in [autocommit mode].
 9445 **
 9446 **   &lt;li&gt; Schema S of [database connection] D must be a [WAL mode] database.
 9447 **
 9448 **   &lt;li&gt; There must not be a write transaction open on schema S of database
 9449 **        connection D.
 9450 **
 9451 **   &lt;li&gt; One or more transactions must have been written to the current wal
 9452 **        file since it was created on disk (by any connection). This means
 9453 **        that a snapshot cannot be taken on a wal mode database with no wal
 9454 **        file immediately after it is first opened. At least one transaction
 9455 **        must be written to it first.
 9456 ** &lt;/ul&gt;
 9457 **
 9458 ** This function may also return SQLITE_NOMEM.  If it is called with the
 9459 ** database handle in autocommit mode but fails for some other reason,
 9460 ** whether or not a read transaction is opened on schema S is undefined.
 9461 **
 9462 ** The [sqlite3_snapshot] object returned from a successful call to
 9463 ** [sqlite3_snapshot_get()] must be freed using [sqlite3_snapshot_free()]
 9464 ** to avoid a memory leak.
 9465 **
 9466 ** The [sqlite3_snapshot_get()] interface is only available when the
 9467 ** [SQLITE_ENABLE_SNAPSHOT] compile-time option is used.
 9468 */
 9469 SQLITE_API SQLITE_EXPERIMENTAL int sqlite3_snapshot_get(
 9470   sqlite3 *db,
 9471   const char *zSchema,
 9472   sqlite3_snapshot **ppSnapshot
 9473 );
 9474 
 9475 /*
 9476 ** CAPI3REF: Start a read transaction on an historical snapshot
 9477 ** METHOD: sqlite3_snapshot
 9478 **
 9479 ** ^The [sqlite3_snapshot_open(D,S,P)] interface either starts a new read
 9480 ** transaction or upgrades an existing one for schema S of
 9481 ** [database connection] D such that the read transaction refers to
 9482 ** historical [snapshot] P, rather than the most recent change to the
 9483 ** database. ^The [sqlite3_snapshot_open()] interface returns SQLITE_OK
 9484 ** on success or an appropriate [error code] if it fails.
 9485 **
 9486 ** ^In order to succeed, the database connection must not be in
 9487 ** [autocommit mode] when [sqlite3_snapshot_open(D,S,P)] is called. If there
 9488 ** is already a read transaction open on schema S, then the database handle
 9489 ** must have no active statements (SELECT statements that have been passed
 9490 ** to sqlite3_step() but not sqlite3_reset() or sqlite3_finalize()).
 9491 ** SQLITE_ERROR is returned if either of these conditions is violated, or
 9492 ** if schema S does not exist, or if the snapshot object is invalid.
 9493 **
 9494 ** ^A call to sqlite3_snapshot_open() will fail to open if the specified
 9495 ** snapshot has been overwritten by a [checkpoint]. In this case
 9496 ** SQLITE_ERROR_SNAPSHOT is returned.
 9497 **
 9498 ** If there is already a read transaction open when this function is
 9499 ** invoked, then the same read transaction remains open (on the same
 9500 ** database snapshot) if SQLITE_ERROR, SQLITE_BUSY or SQLITE_ERROR_SNAPSHOT
 9501 ** is returned. If another error code - for example SQLITE_PROTOCOL or an
 9502 ** SQLITE_IOERR error code - is returned, then the final state of the
 9503 ** read transaction is undefined. If SQLITE_OK is returned, then the
 9504 ** read transaction is now open on database snapshot P.
 9505 **
 9506 ** ^(A call to [sqlite3_snapshot_open(D,S,P)] will fail if the
 9507 ** database connection D does not know that the database file for
 9508 ** schema S is in [WAL mode].  A database connection might not know
 9509 ** that the database file is in [WAL mode] if there has been no prior
 9510 ** I/O on that database connection, or if the database entered [WAL mode]
 9511 ** after the most recent I/O on the database connection.)^
 9512 ** (Hint: Run &quot;[PRAGMA application_id]&quot; against a newly opened
 9513 ** database connection in order to make it ready to use snapshots.)
 9514 **
 9515 ** The [sqlite3_snapshot_open()] interface is only available when the
 9516 ** [SQLITE_ENABLE_SNAPSHOT] compile-time option is used.
 9517 */
 9518 SQLITE_API SQLITE_EXPERIMENTAL int sqlite3_snapshot_open(
 9519   sqlite3 *db,
 9520   const char *zSchema,
 9521   sqlite3_snapshot *pSnapshot
 9522 );
 9523 
 9524 /*
 9525 ** CAPI3REF: Destroy a snapshot
 9526 ** DESTRUCTOR: sqlite3_snapshot
 9527 **
 9528 ** ^The [sqlite3_snapshot_free(P)] interface destroys [sqlite3_snapshot] P.
 9529 ** The application must eventually free every [sqlite3_snapshot] object
 9530 ** using this routine to avoid a memory leak.
 9531 **
 9532 ** The [sqlite3_snapshot_free()] interface is only available when the
 9533 ** [SQLITE_ENABLE_SNAPSHOT] compile-time option is used.
 9534 */
 9535 SQLITE_API SQLITE_EXPERIMENTAL void sqlite3_snapshot_free(sqlite3_snapshot*);
 9536 
 9537 /*
 9538 ** CAPI3REF: Compare the ages of two snapshot handles.
 9539 ** METHOD: sqlite3_snapshot
 9540 **
 9541 ** The sqlite3_snapshot_cmp(P1, P2) interface is used to compare the ages
 9542 ** of two valid snapshot handles.
 9543 **
 9544 ** If the two snapshot handles are not associated with the same database
 9545 ** file, the result of the comparison is undefined.
 9546 **
 9547 ** Additionally, the result of the comparison is only valid if both of the
 9548 ** snapshot handles were obtained by calling sqlite3_snapshot_get() since the
 9549 ** last time the wal file was deleted. The wal file is deleted when the
 9550 ** database is changed back to rollback mode or when the number of database
 9551 ** clients drops to zero. If either snapshot handle was obtained before the
 9552 ** wal file was last deleted, the value returned by this function
 9553 ** is undefined.
 9554 **
 9555 ** Otherwise, this API returns a negative value if P1 refers to an older
 9556 ** snapshot than P2, zero if the two handles refer to the same database
 9557 ** snapshot, and a positive value if P1 is a newer snapshot than P2.
 9558 **
 9559 ** This interface is only available if SQLite is compiled with the
 9560 ** [SQLITE_ENABLE_SNAPSHOT] option.
 9561 */
 9562 SQLITE_API SQLITE_EXPERIMENTAL int sqlite3_snapshot_cmp(
 9563   sqlite3_snapshot *p1,
 9564   sqlite3_snapshot *p2
 9565 );
 9566 
 9567 /*
 9568 ** CAPI3REF: Recover snapshots from a wal file
 9569 ** METHOD: sqlite3_snapshot
 9570 **
 9571 ** If a [WAL file] remains on disk after all database connections close
 9572 ** (either through the use of the [SQLITE_FCNTL_PERSIST_WAL] [file control]
 9573 ** or because the last process to have the database opened exited without
 9574 ** calling [sqlite3_close()]) and a new connection is subsequently opened
 9575 ** on that database and [WAL file], the [sqlite3_snapshot_open()] interface
 9576 ** will only be able to open the last transaction added to the WAL file
 9577 ** even though the WAL file contains other valid transactions.
 9578 **
 9579 ** This function attempts to scan the WAL file associated with database zDb
 9580 ** of database handle db and make all valid snapshots available to
 9581 ** sqlite3_snapshot_open(). It is an error if there is already a read
 9582 ** transaction open on the database, or if the database is not a WAL mode
 9583 ** database.
 9584 **
 9585 ** SQLITE_OK is returned if successful, or an SQLite error code otherwise.
 9586 **
 9587 ** This interface is only available if SQLite is compiled with the
 9588 ** [SQLITE_ENABLE_SNAPSHOT] option.
 9589 */
 9590 SQLITE_API SQLITE_EXPERIMENTAL int sqlite3_snapshot_recover(sqlite3 *db, const char *zDb);
 9591 
 9592 /*
 9593 ** CAPI3REF: Serialize a database
 9594 **
 9595 ** The sqlite3_serialize(D,S,P,F) interface returns a pointer to memory
 9596 ** that is a serialization of the S database on [database connection] D.
 9597 ** If P is not a NULL pointer, then the size of the database in bytes
 9598 ** is written into *P.
 9599 **
 9600 ** For an ordinary on-disk database file, the serialization is just a
 9601 ** copy of the disk file.  For an in-memory database or a &quot;TEMP&quot; database,
 9602 ** the serialization is the same sequence of bytes which would be written
 9603 ** to disk if that database where backed up to disk.
 9604 **
 9605 ** The usual case is that sqlite3_serialize() copies the serialization of
 9606 ** the database into memory obtained from [sqlite3_malloc64()] and returns
 9607 ** a pointer to that memory.  The caller is responsible for freeing the
 9608 ** returned value to avoid a memory leak.  However, if the F argument
 9609 ** contains the SQLITE_SERIALIZE_NOCOPY bit, then no memory allocations
 9610 ** are made, and the sqlite3_serialize() function will return a pointer
 9611 ** to the contiguous memory representation of the database that SQLite
 9612 ** is currently using for that database, or NULL if the no such contiguous
 9613 ** memory representation of the database exists.  A contiguous memory
 9614 ** representation of the database will usually only exist if there has
 9615 ** been a prior call to [sqlite3_deserialize(D,S,...)] with the same
 9616 ** values of D and S.
 9617 ** The size of the database is written into *P even if the
 9618 ** SQLITE_SERIALIZE_NOCOPY bit is set but no contiguous copy
 9619 ** of the database exists.
 9620 **
 9621 ** A call to sqlite3_serialize(D,S,P,F) might return NULL even if the
 9622 ** SQLITE_SERIALIZE_NOCOPY bit is omitted from argument F if a memory
 9623 ** allocation error occurs.
 9624 **
 9625 ** This interface is only available if SQLite is compiled with the
 9626 ** [SQLITE_ENABLE_DESERIALIZE] option.
 9627 */
 9628 SQLITE_API unsigned char *sqlite3_serialize(
 9629   sqlite3 *db,           /* The database connection */
 9630   const char *zSchema,   /* Which DB to serialize. ex: &quot;main&quot;, &quot;temp&quot;, ... */
 9631   sqlite3_int64 *piSize, /* Write size of the DB here, if not NULL */
 9632   unsigned int mFlags    /* Zero or more SQLITE_SERIALIZE_* flags */
 9633 );
 9634 
 9635 /*
 9636 ** CAPI3REF: Flags for sqlite3_serialize
 9637 **
 9638 ** Zero or more of the following constants can be OR-ed together for
 9639 ** the F argument to [sqlite3_serialize(D,S,P,F)].
 9640 **
 9641 ** SQLITE_SERIALIZE_NOCOPY means that [sqlite3_serialize()] will return
 9642 ** a pointer to contiguous in-memory database that it is currently using,
 9643 ** without making a copy of the database.  If SQLite is not currently using
 9644 ** a contiguous in-memory database, then this option causes
 9645 ** [sqlite3_serialize()] to return a NULL pointer.  SQLite will only be
 9646 ** using a contiguous in-memory database if it has been initialized by a
 9647 ** prior call to [sqlite3_deserialize()].
 9648 */
 9649 #define SQLITE_SERIALIZE_NOCOPY 0x001   /* Do no memory allocations */
 9650 
 9651 /*
 9652 ** CAPI3REF: Deserialize a database
 9653 **
 9654 ** The sqlite3_deserialize(D,S,P,N,M,F) interface causes the
 9655 ** [database connection] D to disconnect from database S and then
 9656 ** reopen S as an in-memory database based on the serialization contained
 9657 ** in P.  The serialized database P is N bytes in size.  M is the size of
 9658 ** the buffer P, which might be larger than N.  If M is larger than N, and
 9659 ** the SQLITE_DESERIALIZE_READONLY bit is not set in F, then SQLite is
 9660 ** permitted to add content to the in-memory database as long as the total
 9661 ** size does not exceed M bytes.
 9662 **
 9663 ** If the SQLITE_DESERIALIZE_FREEONCLOSE bit is set in F, then SQLite will
 9664 ** invoke sqlite3_free() on the serialization buffer when the database
 9665 ** connection closes.  If the SQLITE_DESERIALIZE_RESIZEABLE bit is set, then
 9666 ** SQLite will try to increase the buffer size using sqlite3_realloc64()
 9667 ** if writes on the database cause it to grow larger than M bytes.
 9668 **
 9669 ** The sqlite3_deserialize() interface will fail with SQLITE_BUSY if the
 9670 ** database is currently in a read transaction or is involved in a backup
 9671 ** operation.
 9672 **
 9673 ** If sqlite3_deserialize(D,S,P,N,M,F) fails for any reason and if the
 9674 ** SQLITE_DESERIALIZE_FREEONCLOSE bit is set in argument F, then
 9675 ** [sqlite3_free()] is invoked on argument P prior to returning.
 9676 **
 9677 ** This interface is only available if SQLite is compiled with the
 9678 ** [SQLITE_ENABLE_DESERIALIZE] option.
 9679 */
 9680 SQLITE_API int sqlite3_deserialize(
 9681   sqlite3 *db,            /* The database connection */
 9682   const char *zSchema,    /* Which DB to reopen with the deserialization */
 9683   unsigned char *pData,   /* The serialized database content */
 9684   sqlite3_int64 szDb,     /* Number bytes in the deserialization */
 9685   sqlite3_int64 szBuf,    /* Total size of buffer pData[] */
 9686   unsigned mFlags         /* Zero or more SQLITE_DESERIALIZE_* flags */
 9687 );
 9688 
 9689 /*
 9690 ** CAPI3REF: Flags for sqlite3_deserialize()
 9691 **
 9692 ** The following are allowed values for 6th argument (the F argument) to
 9693 ** the [sqlite3_deserialize(D,S,P,N,M,F)] interface.
 9694 **
 9695 ** The SQLITE_DESERIALIZE_FREEONCLOSE means that the database serialization
 9696 ** in the P argument is held in memory obtained from [sqlite3_malloc64()]
 9697 ** and that SQLite should take ownership of this memory and automatically
 9698 ** free it when it has finished using it.  Without this flag, the caller
 9699 ** is responsible for freeing any dynamically allocated memory.
 9700 **
 9701 ** The SQLITE_DESERIALIZE_RESIZEABLE flag means that SQLite is allowed to
 9702 ** grow the size of the database using calls to [sqlite3_realloc64()].  This
 9703 ** flag should only be used if SQLITE_DESERIALIZE_FREEONCLOSE is also used.
 9704 ** Without this flag, the deserialized database cannot increase in size beyond
 9705 ** the number of bytes specified by the M parameter.
 9706 **
 9707 ** The SQLITE_DESERIALIZE_READONLY flag means that the deserialized database
 9708 ** should be treated as read-only.
 9709 */
 9710 #define SQLITE_DESERIALIZE_FREEONCLOSE 1 /* Call sqlite3_free() on close */
 9711 #define SQLITE_DESERIALIZE_RESIZEABLE  2 /* Resize using sqlite3_realloc64() */
 9712 #define SQLITE_DESERIALIZE_READONLY    4 /* Database is read-only */
 9713 
 9714 /*
 9715 ** Undo the hack that converts floating point types to integer for
 9716 ** builds on processors without floating point support.
 9717 */
 9718 #ifdef SQLITE_OMIT_FLOATING_POINT
 9719 # undef double
 9720 #endif
 9721 
 9722 #ifdef __cplusplus
 9723 }  /* End of the &#39;extern &quot;C&quot;&#39; block */
 9724 #endif
 9725 #endif /* SQLITE3_H */
 9726 
 9727 /******** Begin file sqlite3rtree.h *********/
 9728 /*
 9729 ** 2010 August 30
 9730 **
 9731 ** The author disclaims copyright to this source code.  In place of
 9732 ** a legal notice, here is a blessing:
 9733 **
 9734 **    May you do good and not evil.
 9735 **    May you find forgiveness for yourself and forgive others.
 9736 **    May you share freely, never taking more than you give.
 9737 **
 9738 *************************************************************************
 9739 */
 9740 
 9741 #ifndef _SQLITE3RTREE_H_
 9742 #define _SQLITE3RTREE_H_
 9743 
 9744 
 9745 #ifdef __cplusplus
 9746 extern &quot;C&quot; {
 9747 #endif
 9748 
 9749 typedef struct sqlite3_rtree_geometry sqlite3_rtree_geometry;
 9750 typedef struct sqlite3_rtree_query_info sqlite3_rtree_query_info;
 9751 
 9752 /* The double-precision datatype used by RTree depends on the
 9753 ** SQLITE_RTREE_INT_ONLY compile-time option.
 9754 */
 9755 #ifdef SQLITE_RTREE_INT_ONLY
 9756   typedef sqlite3_int64 sqlite3_rtree_dbl;
 9757 #else
 9758   typedef double sqlite3_rtree_dbl;
 9759 #endif
 9760 
 9761 /*
 9762 ** Register a geometry callback named zGeom that can be used as part of an
 9763 ** R-Tree geometry query as follows:
 9764 **
 9765 **   SELECT ... FROM &lt;rtree&gt; WHERE &lt;rtree col&gt; MATCH $zGeom(... params ...)
 9766 */
 9767 SQLITE_API int sqlite3_rtree_geometry_callback(
 9768   sqlite3 *db,
 9769   const char *zGeom,
 9770   int (*xGeom)(sqlite3_rtree_geometry*, int, sqlite3_rtree_dbl*,int*),
 9771   void *pContext
 9772 );
 9773 
 9774 
 9775 /*
 9776 ** A pointer to a structure of the following type is passed as the first
 9777 ** argument to callbacks registered using rtree_geometry_callback().
 9778 */
 9779 struct sqlite3_rtree_geometry {
 9780   void *pContext;                 /* Copy of pContext passed to s_r_g_c() */
 9781   int nParam;                     /* Size of array aParam[] */
 9782   sqlite3_rtree_dbl *aParam;      /* Parameters passed to SQL geom function */
 9783   void *pUser;                    /* Callback implementation user data */
 9784   void (*xDelUser)(void *);       /* Called by SQLite to clean up pUser */
 9785 };
 9786 
 9787 /*
 9788 ** Register a 2nd-generation geometry callback named zScore that can be
 9789 ** used as part of an R-Tree geometry query as follows:
 9790 **
 9791 **   SELECT ... FROM &lt;rtree&gt; WHERE &lt;rtree col&gt; MATCH $zQueryFunc(... params ...)
 9792 */
 9793 SQLITE_API int sqlite3_rtree_query_callback(
 9794   sqlite3 *db,
 9795   const char *zQueryFunc,
 9796   int (*xQueryFunc)(sqlite3_rtree_query_info*),
 9797   void *pContext,
 9798   void (*xDestructor)(void*)
 9799 );
 9800 
 9801 
 9802 /*
 9803 ** A pointer to a structure of the following type is passed as the
 9804 ** argument to scored geometry callback registered using
 9805 ** sqlite3_rtree_query_callback().
 9806 **
 9807 ** Note that the first 5 fields of this structure are identical to
 9808 ** sqlite3_rtree_geometry.  This structure is a subclass of
 9809 ** sqlite3_rtree_geometry.
 9810 */
 9811 struct sqlite3_rtree_query_info {
 9812   void *pContext;                   /* pContext from when function registered */
 9813   int nParam;                       /* Number of function parameters */
 9814   sqlite3_rtree_dbl *aParam;        /* value of function parameters */
 9815   void *pUser;                      /* callback can use this, if desired */
 9816   void (*xDelUser)(void*);          /* function to free pUser */
 9817   sqlite3_rtree_dbl *aCoord;        /* Coordinates of node or entry to check */
 9818   unsigned int *anQueue;            /* Number of pending entries in the queue */
 9819   int nCoord;                       /* Number of coordinates */
 9820   int iLevel;                       /* Level of current node or entry */
 9821   int mxLevel;                      /* The largest iLevel value in the tree */
 9822   sqlite3_int64 iRowid;             /* Rowid for current entry */
 9823   sqlite3_rtree_dbl rParentScore;   /* Score of parent node */
 9824   int eParentWithin;                /* Visibility of parent node */
 9825   int eWithin;                      /* OUT: Visibility */
 9826   sqlite3_rtree_dbl rScore;         /* OUT: Write the score here */
 9827   /* The following fields are only available in 3.8.11 and later */
 9828   sqlite3_value **apSqlParam;       /* Original SQL values of parameters */
 9829 };
 9830 
 9831 /*
 9832 ** Allowed values for sqlite3_rtree_query.eWithin and .eParentWithin.
 9833 */
 9834 #define NOT_WITHIN       0   /* Object completely outside of query region */
 9835 #define PARTLY_WITHIN    1   /* Object partially overlaps query region */
 9836 #define FULLY_WITHIN     2   /* Object fully contained within query region */
 9837 
 9838 
 9839 #ifdef __cplusplus
 9840 }  /* end of the &#39;extern &quot;C&quot;&#39; block */
 9841 #endif
 9842 
 9843 #endif  /* ifndef _SQLITE3RTREE_H_ */
 9844 
 9845 /******** End of sqlite3rtree.h *********/
 9846 /******** Begin file sqlite3session.h *********/
 9847 
 9848 #if !defined(__SQLITESESSION_H_) &amp;&amp; defined(SQLITE_ENABLE_SESSION)
 9849 #define __SQLITESESSION_H_ 1
 9850 
 9851 /*
 9852 ** Make sure we can call this stuff from C++.
 9853 */
 9854 #ifdef __cplusplus
 9855 extern &quot;C&quot; {
 9856 #endif
 9857 
 9858 
 9859 /*
 9860 ** CAPI3REF: Session Object Handle
 9861 **
 9862 ** An instance of this object is a [session] that can be used to
 9863 ** record changes to a database.
 9864 */
 9865 typedef struct sqlite3_session sqlite3_session;
 9866 
 9867 /*
 9868 ** CAPI3REF: Changeset Iterator Handle
 9869 **
 9870 ** An instance of this object acts as a cursor for iterating
 9871 ** over the elements of a [changeset] or [patchset].
 9872 */
 9873 typedef struct sqlite3_changeset_iter sqlite3_changeset_iter;
 9874 
 9875 /*
 9876 ** CAPI3REF: Create A New Session Object
 9877 ** CONSTRUCTOR: sqlite3_session
 9878 **
 9879 ** Create a new session object attached to database handle db. If successful,
 9880 ** a pointer to the new object is written to *ppSession and SQLITE_OK is
 9881 ** returned. If an error occurs, *ppSession is set to NULL and an SQLite
 9882 ** error code (e.g. SQLITE_NOMEM) is returned.
 9883 **
 9884 ** It is possible to create multiple session objects attached to a single
 9885 ** database handle.
 9886 **
 9887 ** Session objects created using this function should be deleted using the
 9888 ** [sqlite3session_delete()] function before the database handle that they
 9889 ** are attached to is itself closed. If the database handle is closed before
 9890 ** the session object is deleted, then the results of calling any session
 9891 ** module function, including [sqlite3session_delete()] on the session object
 9892 ** are undefined.
 9893 **
 9894 ** Because the session module uses the [sqlite3_preupdate_hook()] API, it
 9895 ** is not possible for an application to register a pre-update hook on a
 9896 ** database handle that has one or more session objects attached. Nor is
 9897 ** it possible to create a session object attached to a database handle for
 9898 ** which a pre-update hook is already defined. The results of attempting
 9899 ** either of these things are undefined.
 9900 **
 9901 ** The session object will be used to create changesets for tables in
 9902 ** database zDb, where zDb is either &quot;main&quot;, or &quot;temp&quot;, or the name of an
 9903 ** attached database. It is not an error if database zDb is not attached
 9904 ** to the database when the session object is created.
 9905 */
 9906 SQLITE_API int sqlite3session_create(
 9907   sqlite3 *db,                    /* Database handle */
 9908   const char *zDb,                /* Name of db (e.g. &quot;main&quot;) */
 9909   sqlite3_session **ppSession     /* OUT: New session object */
 9910 );
 9911 
 9912 /*
 9913 ** CAPI3REF: Delete A Session Object
 9914 ** DESTRUCTOR: sqlite3_session
 9915 **
 9916 ** Delete a session object previously allocated using
 9917 ** [sqlite3session_create()]. Once a session object has been deleted, the
 9918 ** results of attempting to use pSession with any other session module
 9919 ** function are undefined.
 9920 **
 9921 ** Session objects must be deleted before the database handle to which they
 9922 ** are attached is closed. Refer to the documentation for
 9923 ** [sqlite3session_create()] for details.
 9924 */
 9925 SQLITE_API void sqlite3session_delete(sqlite3_session *pSession);
 9926 
 9927 
 9928 /*
 9929 ** CAPI3REF: Enable Or Disable A Session Object
 9930 ** METHOD: sqlite3_session
 9931 **
 9932 ** Enable or disable the recording of changes by a session object. When
 9933 ** enabled, a session object records changes made to the database. When
 9934 ** disabled - it does not. A newly created session object is enabled.
 9935 ** Refer to the documentation for [sqlite3session_changeset()] for further
 9936 ** details regarding how enabling and disabling a session object affects
 9937 ** the eventual changesets.
 9938 **
 9939 ** Passing zero to this function disables the session. Passing a value
 9940 ** greater than zero enables it. Passing a value less than zero is a
 9941 ** no-op, and may be used to query the current state of the session.
 9942 **
 9943 ** The return value indicates the final state of the session object: 0 if
 9944 ** the session is disabled, or 1 if it is enabled.
 9945 */
 9946 SQLITE_API int sqlite3session_enable(sqlite3_session *pSession, int bEnable);
 9947 
 9948 /*
 9949 ** CAPI3REF: Set Or Clear the Indirect Change Flag
 9950 ** METHOD: sqlite3_session
 9951 **
 9952 ** Each change recorded by a session object is marked as either direct or
 9953 ** indirect. A change is marked as indirect if either:
 9954 **
 9955 ** &lt;ul&gt;
 9956 **   &lt;li&gt; The session object &quot;indirect&quot; flag is set when the change is
 9957 **        made, or
 9958 **   &lt;li&gt; The change is made by an SQL trigger or foreign key action
 9959 **        instead of directly as a result of a users SQL statement.
 9960 ** &lt;/ul&gt;
 9961 **
 9962 ** If a single row is affected by more than one operation within a session,
 9963 ** then the change is considered indirect if all operations meet the criteria
 9964 ** for an indirect change above, or direct otherwise.
 9965 **
 9966 ** This function is used to set, clear or query the session object indirect
 9967 ** flag.  If the second argument passed to this function is zero, then the
 9968 ** indirect flag is cleared. If it is greater than zero, the indirect flag
 9969 ** is set. Passing a value less than zero does not modify the current value
 9970 ** of the indirect flag, and may be used to query the current state of the
 9971 ** indirect flag for the specified session object.
 9972 **
 9973 ** The return value indicates the final state of the indirect flag: 0 if
 9974 ** it is clear, or 1 if it is set.
 9975 */
 9976 SQLITE_API int sqlite3session_indirect(sqlite3_session *pSession, int bIndirect);
 9977 
 9978 /*
 9979 ** CAPI3REF: Attach A Table To A Session Object
 9980 ** METHOD: sqlite3_session
 9981 **
 9982 ** If argument zTab is not NULL, then it is the name of a table to attach
 9983 ** to the session object passed as the first argument. All subsequent changes
 9984 ** made to the table while the session object is enabled will be recorded. See
 9985 ** documentation for [sqlite3session_changeset()] for further details.
 9986 **
 9987 ** Or, if argument zTab is NULL, then changes are recorded for all tables
 9988 ** in the database. If additional tables are added to the database (by
 9989 ** executing &quot;CREATE TABLE&quot; statements) after this call is made, changes for
 9990 ** the new tables are also recorded.
 9991 **
 9992 ** Changes can only be recorded for tables that have a PRIMARY KEY explicitly
 9993 ** defined as part of their CREATE TABLE statement. It does not matter if the
 9994 ** PRIMARY KEY is an &quot;INTEGER PRIMARY KEY&quot; (rowid alias) or not. The PRIMARY
 9995 ** KEY may consist of a single column, or may be a composite key.
 9996 **
 9997 ** It is not an error if the named table does not exist in the database. Nor
 9998 ** is it an error if the named table does not have a PRIMARY KEY. However,
 9999 ** no changes will be recorded in either of these scenarios.
10000 **
10001 ** Changes are not recorded for individual rows that have NULL values stored
10002 ** in one or more of their PRIMARY KEY columns.
10003 **
10004 ** SQLITE_OK is returned if the call completes without error. Or, if an error
10005 ** occurs, an SQLite error code (e.g. SQLITE_NOMEM) is returned.
10006 **
10007 ** &lt;h3&gt;Special sqlite_stat1 Handling&lt;/h3&gt;
10008 **
10009 ** As of SQLite version 3.22.0, the &quot;sqlite_stat1&quot; table is an exception to
10010 ** some of the rules above. In SQLite, the schema of sqlite_stat1 is:
10011 **  &lt;pre&gt;
10012 **  &amp;nbsp;     CREATE TABLE sqlite_stat1(tbl,idx,stat)
10013 **  &lt;/pre&gt;
10014 **
10015 ** Even though sqlite_stat1 does not have a PRIMARY KEY, changes are
10016 ** recorded for it as if the PRIMARY KEY is (tbl,idx). Additionally, changes
10017 ** are recorded for rows for which (idx IS NULL) is true. However, for such
10018 ** rows a zero-length blob (SQL value X&#39;&#39;) is stored in the changeset or
10019 ** patchset instead of a NULL value. This allows such changesets to be
10020 ** manipulated by legacy implementations of sqlite3changeset_invert(),
10021 ** concat() and similar.
10022 **
10023 ** The sqlite3changeset_apply() function automatically converts the
10024 ** zero-length blob back to a NULL value when updating the sqlite_stat1
10025 ** table. However, if the application calls sqlite3changeset_new(),
10026 ** sqlite3changeset_old() or sqlite3changeset_conflict on a changeset
10027 ** iterator directly (including on a changeset iterator passed to a
10028 ** conflict-handler callback) then the X&#39;&#39; value is returned. The application
10029 ** must translate X&#39;&#39; to NULL itself if required.
10030 **
10031 ** Legacy (older than 3.22.0) versions of the sessions module cannot capture
10032 ** changes made to the sqlite_stat1 table. Legacy versions of the
10033 ** sqlite3changeset_apply() function silently ignore any modifications to the
10034 ** sqlite_stat1 table that are part of a changeset or patchset.
10035 */
10036 SQLITE_API int sqlite3session_attach(
10037   sqlite3_session *pSession,      /* Session object */
10038   const char *zTab                /* Table name */
10039 );
10040 
10041 /*
10042 ** CAPI3REF: Set a table filter on a Session Object.
10043 ** METHOD: sqlite3_session
10044 **
10045 ** The second argument (xFilter) is the &quot;filter callback&quot;. For changes to rows
10046 ** in tables that are not attached to the Session object, the filter is called
10047 ** to determine whether changes to the table&#39;s rows should be tracked or not.
<a name="97" id="anc97"></a><span class="line-modified">10048 ** If xFilter returns 0, changes are not tracked. Note that once a table is</span>
10049 ** attached, xFilter will not be called again.
10050 */
10051 SQLITE_API void sqlite3session_table_filter(
10052   sqlite3_session *pSession,      /* Session object */
10053   int(*xFilter)(
10054     void *pCtx,                   /* Copy of third arg to _filter_table() */
10055     const char *zTab              /* Table name */
10056   ),
10057   void *pCtx                      /* First argument passed to xFilter */
10058 );
10059 
10060 /*
10061 ** CAPI3REF: Generate A Changeset From A Session Object
10062 ** METHOD: sqlite3_session
10063 **
10064 ** Obtain a changeset containing changes to the tables attached to the
10065 ** session object passed as the first argument. If successful,
10066 ** set *ppChangeset to point to a buffer containing the changeset
10067 ** and *pnChangeset to the size of the changeset in bytes before returning
10068 ** SQLITE_OK. If an error occurs, set both *ppChangeset and *pnChangeset to
10069 ** zero and return an SQLite error code.
10070 **
10071 ** A changeset consists of zero or more INSERT, UPDATE and/or DELETE changes,
10072 ** each representing a change to a single row of an attached table. An INSERT
10073 ** change contains the values of each field of a new database row. A DELETE
10074 ** contains the original values of each field of a deleted database row. An
10075 ** UPDATE change contains the original values of each field of an updated
10076 ** database row along with the updated values for each updated non-primary-key
10077 ** column. It is not possible for an UPDATE change to represent a change that
10078 ** modifies the values of primary key columns. If such a change is made, it
10079 ** is represented in a changeset as a DELETE followed by an INSERT.
10080 **
10081 ** Changes are not recorded for rows that have NULL values stored in one or
10082 ** more of their PRIMARY KEY columns. If such a row is inserted or deleted,
10083 ** no corresponding change is present in the changesets returned by this
10084 ** function. If an existing row with one or more NULL values stored in
10085 ** PRIMARY KEY columns is updated so that all PRIMARY KEY columns are non-NULL,
10086 ** only an INSERT is appears in the changeset. Similarly, if an existing row
10087 ** with non-NULL PRIMARY KEY values is updated so that one or more of its
10088 ** PRIMARY KEY columns are set to NULL, the resulting changeset contains a
10089 ** DELETE change only.
10090 **
10091 ** The contents of a changeset may be traversed using an iterator created
10092 ** using the [sqlite3changeset_start()] API. A changeset may be applied to
10093 ** a database with a compatible schema using the [sqlite3changeset_apply()]
10094 ** API.
10095 **
10096 ** Within a changeset generated by this function, all changes related to a
10097 ** single table are grouped together. In other words, when iterating through
10098 ** a changeset or when applying a changeset to a database, all changes related
10099 ** to a single table are processed before moving on to the next table. Tables
10100 ** are sorted in the same order in which they were attached (or auto-attached)
10101 ** to the sqlite3_session object. The order in which the changes related to
10102 ** a single table are stored is undefined.
10103 **
10104 ** Following a successful call to this function, it is the responsibility of
10105 ** the caller to eventually free the buffer that *ppChangeset points to using
10106 ** [sqlite3_free()].
10107 **
10108 ** &lt;h3&gt;Changeset Generation&lt;/h3&gt;
10109 **
10110 ** Once a table has been attached to a session object, the session object
10111 ** records the primary key values of all new rows inserted into the table.
10112 ** It also records the original primary key and other column values of any
10113 ** deleted or updated rows. For each unique primary key value, data is only
10114 ** recorded once - the first time a row with said primary key is inserted,
10115 ** updated or deleted in the lifetime of the session.
10116 **
10117 ** There is one exception to the previous paragraph: when a row is inserted,
10118 ** updated or deleted, if one or more of its primary key columns contain a
10119 ** NULL value, no record of the change is made.
10120 **
10121 ** The session object therefore accumulates two types of records - those
10122 ** that consist of primary key values only (created when the user inserts
10123 ** a new record) and those that consist of the primary key values and the
10124 ** original values of other table columns (created when the users deletes
10125 ** or updates a record).
10126 **
10127 ** When this function is called, the requested changeset is created using
10128 ** both the accumulated records and the current contents of the database
10129 ** file. Specifically:
10130 **
10131 ** &lt;ul&gt;
10132 **   &lt;li&gt; For each record generated by an insert, the database is queried
10133 **        for a row with a matching primary key. If one is found, an INSERT
10134 **        change is added to the changeset. If no such row is found, no change
10135 **        is added to the changeset.
10136 **
10137 **   &lt;li&gt; For each record generated by an update or delete, the database is
10138 **        queried for a row with a matching primary key. If such a row is
10139 **        found and one or more of the non-primary key fields have been
10140 **        modified from their original values, an UPDATE change is added to
10141 **        the changeset. Or, if no such row is found in the table, a DELETE
10142 **        change is added to the changeset. If there is a row with a matching
10143 **        primary key in the database, but all fields contain their original
10144 **        values, no change is added to the changeset.
10145 ** &lt;/ul&gt;
10146 **
10147 ** This means, amongst other things, that if a row is inserted and then later
10148 ** deleted while a session object is active, neither the insert nor the delete
10149 ** will be present in the changeset. Or if a row is deleted and then later a
10150 ** row with the same primary key values inserted while a session object is
10151 ** active, the resulting changeset will contain an UPDATE change instead of
10152 ** a DELETE and an INSERT.
10153 **
10154 ** When a session object is disabled (see the [sqlite3session_enable()] API),
10155 ** it does not accumulate records when rows are inserted, updated or deleted.
10156 ** This may appear to have some counter-intuitive effects if a single row
10157 ** is written to more than once during a session. For example, if a row
10158 ** is inserted while a session object is enabled, then later deleted while
10159 ** the same session object is disabled, no INSERT record will appear in the
10160 ** changeset, even though the delete took place while the session was disabled.
10161 ** Or, if one field of a row is updated while a session is disabled, and
10162 ** another field of the same row is updated while the session is enabled, the
10163 ** resulting changeset will contain an UPDATE change that updates both fields.
10164 */
10165 SQLITE_API int sqlite3session_changeset(
10166   sqlite3_session *pSession,      /* Session object */
10167   int *pnChangeset,               /* OUT: Size of buffer at *ppChangeset */
10168   void **ppChangeset              /* OUT: Buffer containing changeset */
10169 );
10170 
10171 /*
10172 ** CAPI3REF: Load The Difference Between Tables Into A Session
10173 ** METHOD: sqlite3_session
10174 **
10175 ** If it is not already attached to the session object passed as the first
10176 ** argument, this function attaches table zTbl in the same manner as the
10177 ** [sqlite3session_attach()] function. If zTbl does not exist, or if it
10178 ** does not have a primary key, this function is a no-op (but does not return
10179 ** an error).
10180 **
10181 ** Argument zFromDb must be the name of a database (&quot;main&quot;, &quot;temp&quot; etc.)
10182 ** attached to the same database handle as the session object that contains
10183 ** a table compatible with the table attached to the session by this function.
10184 ** A table is considered compatible if it:
10185 **
10186 ** &lt;ul&gt;
10187 **   &lt;li&gt; Has the same name,
10188 **   &lt;li&gt; Has the same set of columns declared in the same order, and
10189 **   &lt;li&gt; Has the same PRIMARY KEY definition.
10190 ** &lt;/ul&gt;
10191 **
10192 ** If the tables are not compatible, SQLITE_SCHEMA is returned. If the tables
10193 ** are compatible but do not have any PRIMARY KEY columns, it is not an error
10194 ** but no changes are added to the session object. As with other session
10195 ** APIs, tables without PRIMARY KEYs are simply ignored.
10196 **
10197 ** This function adds a set of changes to the session object that could be
10198 ** used to update the table in database zFrom (call this the &quot;from-table&quot;)
10199 ** so that its content is the same as the table attached to the session
10200 ** object (call this the &quot;to-table&quot;). Specifically:
10201 **
10202 ** &lt;ul&gt;
10203 **   &lt;li&gt; For each row (primary key) that exists in the to-table but not in
10204 **     the from-table, an INSERT record is added to the session object.
10205 **
10206 **   &lt;li&gt; For each row (primary key) that exists in the to-table but not in
10207 **     the from-table, a DELETE record is added to the session object.
10208 **
10209 **   &lt;li&gt; For each row (primary key) that exists in both tables, but features
10210 **     different non-PK values in each, an UPDATE record is added to the
10211 **     session.
10212 ** &lt;/ul&gt;
10213 **
10214 ** To clarify, if this function is called and then a changeset constructed
10215 ** using [sqlite3session_changeset()], then after applying that changeset to
10216 ** database zFrom the contents of the two compatible tables would be
10217 ** identical.
10218 **
10219 ** It an error if database zFrom does not exist or does not contain the
10220 ** required compatible table.
10221 **
<a name="98" id="anc98"></a><span class="line-modified">10222 ** If the operation is successful, SQLITE_OK is returned. Otherwise, an SQLite</span>
10223 ** error code. In this case, if argument pzErrMsg is not NULL, *pzErrMsg
10224 ** may be set to point to a buffer containing an English language error
10225 ** message. It is the responsibility of the caller to free this buffer using
10226 ** sqlite3_free().
10227 */
10228 SQLITE_API int sqlite3session_diff(
10229   sqlite3_session *pSession,
10230   const char *zFromDb,
10231   const char *zTbl,
10232   char **pzErrMsg
10233 );
10234 
10235 
10236 /*
10237 ** CAPI3REF: Generate A Patchset From A Session Object
10238 ** METHOD: sqlite3_session
10239 **
10240 ** The differences between a patchset and a changeset are that:
10241 **
10242 ** &lt;ul&gt;
10243 **   &lt;li&gt; DELETE records consist of the primary key fields only. The
10244 **        original values of other fields are omitted.
10245 **   &lt;li&gt; The original values of any modified fields are omitted from
10246 **        UPDATE records.
10247 ** &lt;/ul&gt;
10248 **
10249 ** A patchset blob may be used with up to date versions of all
10250 ** sqlite3changeset_xxx API functions except for sqlite3changeset_invert(),
10251 ** which returns SQLITE_CORRUPT if it is passed a patchset. Similarly,
10252 ** attempting to use a patchset blob with old versions of the
10253 ** sqlite3changeset_xxx APIs also provokes an SQLITE_CORRUPT error.
10254 **
10255 ** Because the non-primary key &quot;old.*&quot; fields are omitted, no
10256 ** SQLITE_CHANGESET_DATA conflicts can be detected or reported if a patchset
10257 ** is passed to the sqlite3changeset_apply() API. Other conflict types work
10258 ** in the same way as for changesets.
10259 **
10260 ** Changes within a patchset are ordered in the same way as for changesets
10261 ** generated by the sqlite3session_changeset() function (i.e. all changes for
10262 ** a single table are grouped together, tables appear in the order in which
10263 ** they were attached to the session object).
10264 */
10265 SQLITE_API int sqlite3session_patchset(
10266   sqlite3_session *pSession,      /* Session object */
10267   int *pnPatchset,                /* OUT: Size of buffer at *ppPatchset */
10268   void **ppPatchset               /* OUT: Buffer containing patchset */
10269 );
10270 
10271 /*
10272 ** CAPI3REF: Test if a changeset has recorded any changes.
10273 **
10274 ** Return non-zero if no changes to attached tables have been recorded by
10275 ** the session object passed as the first argument. Otherwise, if one or
10276 ** more changes have been recorded, return zero.
10277 **
10278 ** Even if this function returns zero, it is possible that calling
10279 ** [sqlite3session_changeset()] on the session handle may still return a
10280 ** changeset that contains no changes. This can happen when a row in
10281 ** an attached table is modified and then later on the original values
10282 ** are restored. However, if this function returns non-zero, then it is
10283 ** guaranteed that a call to sqlite3session_changeset() will return a
10284 ** changeset containing zero changes.
10285 */
10286 SQLITE_API int sqlite3session_isempty(sqlite3_session *pSession);
10287 
10288 /*
10289 ** CAPI3REF: Create An Iterator To Traverse A Changeset
10290 ** CONSTRUCTOR: sqlite3_changeset_iter
10291 **
10292 ** Create an iterator used to iterate through the contents of a changeset.
10293 ** If successful, *pp is set to point to the iterator handle and SQLITE_OK
10294 ** is returned. Otherwise, if an error occurs, *pp is set to zero and an
10295 ** SQLite error code is returned.
10296 **
10297 ** The following functions can be used to advance and query a changeset
10298 ** iterator created by this function:
10299 **
10300 ** &lt;ul&gt;
10301 **   &lt;li&gt; [sqlite3changeset_next()]
10302 **   &lt;li&gt; [sqlite3changeset_op()]
10303 **   &lt;li&gt; [sqlite3changeset_new()]
10304 **   &lt;li&gt; [sqlite3changeset_old()]
10305 ** &lt;/ul&gt;
10306 **
10307 ** It is the responsibility of the caller to eventually destroy the iterator
10308 ** by passing it to [sqlite3changeset_finalize()]. The buffer containing the
10309 ** changeset (pChangeset) must remain valid until after the iterator is
10310 ** destroyed.
10311 **
10312 ** Assuming the changeset blob was created by one of the
10313 ** [sqlite3session_changeset()], [sqlite3changeset_concat()] or
10314 ** [sqlite3changeset_invert()] functions, all changes within the changeset
10315 ** that apply to a single table are grouped together. This means that when
10316 ** an application iterates through a changeset using an iterator created by
10317 ** this function, all changes that relate to a single table are visited
10318 ** consecutively. There is no chance that the iterator will visit a change
10319 ** the applies to table X, then one for table Y, and then later on visit
10320 ** another change for table X.
10321 **
10322 ** The behavior of sqlite3changeset_start_v2() and its streaming equivalent
10323 ** may be modified by passing a combination of
10324 ** [SQLITE_CHANGESETSTART_INVERT | supported flags] as the 4th parameter.
10325 **
10326 ** Note that the sqlite3changeset_start_v2() API is still &lt;b&gt;experimental&lt;/b&gt;
10327 ** and therefore subject to change.
10328 */
10329 SQLITE_API int sqlite3changeset_start(
10330   sqlite3_changeset_iter **pp,    /* OUT: New changeset iterator handle */
10331   int nChangeset,                 /* Size of changeset blob in bytes */
10332   void *pChangeset                /* Pointer to blob containing changeset */
10333 );
10334 SQLITE_API int sqlite3changeset_start_v2(
10335   sqlite3_changeset_iter **pp,    /* OUT: New changeset iterator handle */
10336   int nChangeset,                 /* Size of changeset blob in bytes */
10337   void *pChangeset,               /* Pointer to blob containing changeset */
10338   int flags                       /* SESSION_CHANGESETSTART_* flags */
10339 );
10340 
10341 /*
10342 ** CAPI3REF: Flags for sqlite3changeset_start_v2
10343 **
10344 ** The following flags may passed via the 4th parameter to
10345 ** [sqlite3changeset_start_v2] and [sqlite3changeset_start_v2_strm]:
10346 **
10347 ** &lt;dt&gt;SQLITE_CHANGESETAPPLY_INVERT &lt;dd&gt;
10348 **   Invert the changeset while iterating through it. This is equivalent to
10349 **   inverting a changeset using sqlite3changeset_invert() before applying it.
10350 **   It is an error to specify this flag with a patchset.
10351 */
10352 #define SQLITE_CHANGESETSTART_INVERT        0x0002
10353 
10354 
10355 /*
10356 ** CAPI3REF: Advance A Changeset Iterator
10357 ** METHOD: sqlite3_changeset_iter
10358 **
<a name="99" id="anc99"></a><span class="line-modified">10359 ** This function may only be used with iterators created by the function</span>
10360 ** [sqlite3changeset_start()]. If it is called on an iterator passed to
10361 ** a conflict-handler callback by [sqlite3changeset_apply()], SQLITE_MISUSE
10362 ** is returned and the call has no effect.
10363 **
10364 ** Immediately after an iterator is created by sqlite3changeset_start(), it
10365 ** does not point to any change in the changeset. Assuming the changeset
10366 ** is not empty, the first call to this function advances the iterator to
10367 ** point to the first change in the changeset. Each subsequent call advances
10368 ** the iterator to point to the next change in the changeset (if any). If
10369 ** no error occurs and the iterator points to a valid change after a call
10370 ** to sqlite3changeset_next() has advanced it, SQLITE_ROW is returned.
10371 ** Otherwise, if all changes in the changeset have already been visited,
10372 ** SQLITE_DONE is returned.
10373 **
10374 ** If an error occurs, an SQLite error code is returned. Possible error
10375 ** codes include SQLITE_CORRUPT (if the changeset buffer is corrupt) or
10376 ** SQLITE_NOMEM.
10377 */
10378 SQLITE_API int sqlite3changeset_next(sqlite3_changeset_iter *pIter);
10379 
10380 /*
10381 ** CAPI3REF: Obtain The Current Operation From A Changeset Iterator
10382 ** METHOD: sqlite3_changeset_iter
10383 **
10384 ** The pIter argument passed to this function may either be an iterator
10385 ** passed to a conflict-handler by [sqlite3changeset_apply()], or an iterator
10386 ** created by [sqlite3changeset_start()]. In the latter case, the most recent
10387 ** call to [sqlite3changeset_next()] must have returned [SQLITE_ROW]. If this
10388 ** is not the case, this function returns [SQLITE_MISUSE].
10389 **
10390 ** If argument pzTab is not NULL, then *pzTab is set to point to a
10391 ** nul-terminated utf-8 encoded string containing the name of the table
10392 ** affected by the current change. The buffer remains valid until either
10393 ** sqlite3changeset_next() is called on the iterator or until the
10394 ** conflict-handler function returns. If pnCol is not NULL, then *pnCol is
10395 ** set to the number of columns in the table affected by the change. If
10396 ** pbIndirect is not NULL, then *pbIndirect is set to true (1) if the change
10397 ** is an indirect change, or false (0) otherwise. See the documentation for
10398 ** [sqlite3session_indirect()] for a description of direct and indirect
10399 ** changes. Finally, if pOp is not NULL, then *pOp is set to one of
10400 ** [SQLITE_INSERT], [SQLITE_DELETE] or [SQLITE_UPDATE], depending on the
10401 ** type of change that the iterator currently points to.
10402 **
10403 ** If no error occurs, SQLITE_OK is returned. If an error does occur, an
10404 ** SQLite error code is returned. The values of the output variables may not
10405 ** be trusted in this case.
10406 */
10407 SQLITE_API int sqlite3changeset_op(
10408   sqlite3_changeset_iter *pIter,  /* Iterator object */
10409   const char **pzTab,             /* OUT: Pointer to table name */
10410   int *pnCol,                     /* OUT: Number of columns in table */
10411   int *pOp,                       /* OUT: SQLITE_INSERT, DELETE or UPDATE */
10412   int *pbIndirect                 /* OUT: True for an &#39;indirect&#39; change */
10413 );
10414 
10415 /*
10416 ** CAPI3REF: Obtain The Primary Key Definition Of A Table
10417 ** METHOD: sqlite3_changeset_iter
10418 **
10419 ** For each modified table, a changeset includes the following:
10420 **
10421 ** &lt;ul&gt;
10422 **   &lt;li&gt; The number of columns in the table, and
10423 **   &lt;li&gt; Which of those columns make up the tables PRIMARY KEY.
10424 ** &lt;/ul&gt;
10425 **
10426 ** This function is used to find which columns comprise the PRIMARY KEY of
10427 ** the table modified by the change that iterator pIter currently points to.
10428 ** If successful, *pabPK is set to point to an array of nCol entries, where
10429 ** nCol is the number of columns in the table. Elements of *pabPK are set to
10430 ** 0x01 if the corresponding column is part of the tables primary key, or
10431 ** 0x00 if it is not.
10432 **
10433 ** If argument pnCol is not NULL, then *pnCol is set to the number of columns
10434 ** in the table.
10435 **
10436 ** If this function is called when the iterator does not point to a valid
10437 ** entry, SQLITE_MISUSE is returned and the output variables zeroed. Otherwise,
10438 ** SQLITE_OK is returned and the output variables populated as described
10439 ** above.
10440 */
10441 SQLITE_API int sqlite3changeset_pk(
10442   sqlite3_changeset_iter *pIter,  /* Iterator object */
10443   unsigned char **pabPK,          /* OUT: Array of boolean - true for PK cols */
10444   int *pnCol                      /* OUT: Number of entries in output array */
10445 );
10446 
10447 /*
10448 ** CAPI3REF: Obtain old.* Values From A Changeset Iterator
10449 ** METHOD: sqlite3_changeset_iter
10450 **
10451 ** The pIter argument passed to this function may either be an iterator
10452 ** passed to a conflict-handler by [sqlite3changeset_apply()], or an iterator
10453 ** created by [sqlite3changeset_start()]. In the latter case, the most recent
10454 ** call to [sqlite3changeset_next()] must have returned SQLITE_ROW.
10455 ** Furthermore, it may only be called if the type of change that the iterator
10456 ** currently points to is either [SQLITE_DELETE] or [SQLITE_UPDATE]. Otherwise,
10457 ** this function returns [SQLITE_MISUSE] and sets *ppValue to NULL.
10458 **
10459 ** Argument iVal must be greater than or equal to 0, and less than the number
10460 ** of columns in the table affected by the current change. Otherwise,
10461 ** [SQLITE_RANGE] is returned and *ppValue is set to NULL.
10462 **
10463 ** If successful, this function sets *ppValue to point to a protected
10464 ** sqlite3_value object containing the iVal&#39;th value from the vector of
10465 ** original row values stored as part of the UPDATE or DELETE change and
10466 ** returns SQLITE_OK. The name of the function comes from the fact that this
10467 ** is similar to the &quot;old.*&quot; columns available to update or delete triggers.
10468 **
10469 ** If some other error occurs (e.g. an OOM condition), an SQLite error code
10470 ** is returned and *ppValue is set to NULL.
10471 */
10472 SQLITE_API int sqlite3changeset_old(
10473   sqlite3_changeset_iter *pIter,  /* Changeset iterator */
10474   int iVal,                       /* Column number */
10475   sqlite3_value **ppValue         /* OUT: Old value (or NULL pointer) */
10476 );
10477 
10478 /*
10479 ** CAPI3REF: Obtain new.* Values From A Changeset Iterator
10480 ** METHOD: sqlite3_changeset_iter
10481 **
10482 ** The pIter argument passed to this function may either be an iterator
10483 ** passed to a conflict-handler by [sqlite3changeset_apply()], or an iterator
10484 ** created by [sqlite3changeset_start()]. In the latter case, the most recent
10485 ** call to [sqlite3changeset_next()] must have returned SQLITE_ROW.
10486 ** Furthermore, it may only be called if the type of change that the iterator
10487 ** currently points to is either [SQLITE_UPDATE] or [SQLITE_INSERT]. Otherwise,
10488 ** this function returns [SQLITE_MISUSE] and sets *ppValue to NULL.
10489 **
10490 ** Argument iVal must be greater than or equal to 0, and less than the number
10491 ** of columns in the table affected by the current change. Otherwise,
10492 ** [SQLITE_RANGE] is returned and *ppValue is set to NULL.
10493 **
10494 ** If successful, this function sets *ppValue to point to a protected
10495 ** sqlite3_value object containing the iVal&#39;th value from the vector of
10496 ** new row values stored as part of the UPDATE or INSERT change and
10497 ** returns SQLITE_OK. If the change is an UPDATE and does not include
10498 ** a new value for the requested column, *ppValue is set to NULL and
10499 ** SQLITE_OK returned. The name of the function comes from the fact that
10500 ** this is similar to the &quot;new.*&quot; columns available to update or delete
10501 ** triggers.
10502 **
10503 ** If some other error occurs (e.g. an OOM condition), an SQLite error code
10504 ** is returned and *ppValue is set to NULL.
10505 */
10506 SQLITE_API int sqlite3changeset_new(
10507   sqlite3_changeset_iter *pIter,  /* Changeset iterator */
10508   int iVal,                       /* Column number */
10509   sqlite3_value **ppValue         /* OUT: New value (or NULL pointer) */
10510 );
10511 
10512 /*
10513 ** CAPI3REF: Obtain Conflicting Row Values From A Changeset Iterator
10514 ** METHOD: sqlite3_changeset_iter
10515 **
10516 ** This function should only be used with iterator objects passed to a
10517 ** conflict-handler callback by [sqlite3changeset_apply()] with either
10518 ** [SQLITE_CHANGESET_DATA] or [SQLITE_CHANGESET_CONFLICT]. If this function
10519 ** is called on any other iterator, [SQLITE_MISUSE] is returned and *ppValue
10520 ** is set to NULL.
10521 **
10522 ** Argument iVal must be greater than or equal to 0, and less than the number
10523 ** of columns in the table affected by the current change. Otherwise,
10524 ** [SQLITE_RANGE] is returned and *ppValue is set to NULL.
10525 **
10526 ** If successful, this function sets *ppValue to point to a protected
10527 ** sqlite3_value object containing the iVal&#39;th value from the
10528 ** &quot;conflicting row&quot; associated with the current conflict-handler callback
10529 ** and returns SQLITE_OK.
10530 **
10531 ** If some other error occurs (e.g. an OOM condition), an SQLite error code
10532 ** is returned and *ppValue is set to NULL.
10533 */
10534 SQLITE_API int sqlite3changeset_conflict(
10535   sqlite3_changeset_iter *pIter,  /* Changeset iterator */
10536   int iVal,                       /* Column number */
10537   sqlite3_value **ppValue         /* OUT: Value from conflicting row */
10538 );
10539 
10540 /*
10541 ** CAPI3REF: Determine The Number Of Foreign Key Constraint Violations
10542 ** METHOD: sqlite3_changeset_iter
10543 **
10544 ** This function may only be called with an iterator passed to an
10545 ** SQLITE_CHANGESET_FOREIGN_KEY conflict handler callback. In this case
10546 ** it sets the output variable to the total number of known foreign key
10547 ** violations in the destination database and returns SQLITE_OK.
10548 **
10549 ** In all other cases this function returns SQLITE_MISUSE.
10550 */
10551 SQLITE_API int sqlite3changeset_fk_conflicts(
10552   sqlite3_changeset_iter *pIter,  /* Changeset iterator */
10553   int *pnOut                      /* OUT: Number of FK violations */
10554 );
10555 
10556 
10557 /*
10558 ** CAPI3REF: Finalize A Changeset Iterator
10559 ** METHOD: sqlite3_changeset_iter
10560 **
10561 ** This function is used to finalize an iterator allocated with
10562 ** [sqlite3changeset_start()].
10563 **
10564 ** This function should only be called on iterators created using the
10565 ** [sqlite3changeset_start()] function. If an application calls this
10566 ** function with an iterator passed to a conflict-handler by
10567 ** [sqlite3changeset_apply()], [SQLITE_MISUSE] is immediately returned and the
10568 ** call has no effect.
10569 **
10570 ** If an error was encountered within a call to an sqlite3changeset_xxx()
10571 ** function (for example an [SQLITE_CORRUPT] in [sqlite3changeset_next()] or an
10572 ** [SQLITE_NOMEM] in [sqlite3changeset_new()]) then an error code corresponding
10573 ** to that error is returned by this function. Otherwise, SQLITE_OK is
10574 ** returned. This is to allow the following pattern (pseudo-code):
10575 **
10576 ** &lt;pre&gt;
10577 **   sqlite3changeset_start();
10578 **   while( SQLITE_ROW==sqlite3changeset_next() ){
10579 **     // Do something with change.
10580 **   }
10581 **   rc = sqlite3changeset_finalize();
10582 **   if( rc!=SQLITE_OK ){
10583 **     // An error has occurred
10584 **   }
10585 ** &lt;/pre&gt;
10586 */
10587 SQLITE_API int sqlite3changeset_finalize(sqlite3_changeset_iter *pIter);
10588 
10589 /*
10590 ** CAPI3REF: Invert A Changeset
10591 **
10592 ** This function is used to &quot;invert&quot; a changeset object. Applying an inverted
10593 ** changeset to a database reverses the effects of applying the uninverted
10594 ** changeset. Specifically:
10595 **
10596 ** &lt;ul&gt;
10597 **   &lt;li&gt; Each DELETE change is changed to an INSERT, and
10598 **   &lt;li&gt; Each INSERT change is changed to a DELETE, and
10599 **   &lt;li&gt; For each UPDATE change, the old.* and new.* values are exchanged.
10600 ** &lt;/ul&gt;
10601 **
10602 ** This function does not change the order in which changes appear within
10603 ** the changeset. It merely reverses the sense of each individual change.
10604 **
10605 ** If successful, a pointer to a buffer containing the inverted changeset
10606 ** is stored in *ppOut, the size of the same buffer is stored in *pnOut, and
10607 ** SQLITE_OK is returned. If an error occurs, both *pnOut and *ppOut are
10608 ** zeroed and an SQLite error code returned.
10609 **
10610 ** It is the responsibility of the caller to eventually call sqlite3_free()
10611 ** on the *ppOut pointer to free the buffer allocation following a successful
10612 ** call to this function.
10613 **
10614 ** WARNING/TODO: This function currently assumes that the input is a valid
10615 ** changeset. If it is not, the results are undefined.
10616 */
10617 SQLITE_API int sqlite3changeset_invert(
10618   int nIn, const void *pIn,       /* Input changeset */
10619   int *pnOut, void **ppOut        /* OUT: Inverse of input */
10620 );
10621 
10622 /*
10623 ** CAPI3REF: Concatenate Two Changeset Objects
10624 **
10625 ** This function is used to concatenate two changesets, A and B, into a
10626 ** single changeset. The result is a changeset equivalent to applying
10627 ** changeset A followed by changeset B.
10628 **
10629 ** This function combines the two input changesets using an
10630 ** sqlite3_changegroup object. Calling it produces similar results as the
10631 ** following code fragment:
10632 **
10633 ** &lt;pre&gt;
10634 **   sqlite3_changegroup *pGrp;
10635 **   rc = sqlite3_changegroup_new(&amp;pGrp);
10636 **   if( rc==SQLITE_OK ) rc = sqlite3changegroup_add(pGrp, nA, pA);
10637 **   if( rc==SQLITE_OK ) rc = sqlite3changegroup_add(pGrp, nB, pB);
10638 **   if( rc==SQLITE_OK ){
10639 **     rc = sqlite3changegroup_output(pGrp, pnOut, ppOut);
10640 **   }else{
10641 **     *ppOut = 0;
10642 **     *pnOut = 0;
10643 **   }
10644 ** &lt;/pre&gt;
10645 **
10646 ** Refer to the sqlite3_changegroup documentation below for details.
10647 */
10648 SQLITE_API int sqlite3changeset_concat(
10649   int nA,                         /* Number of bytes in buffer pA */
10650   void *pA,                       /* Pointer to buffer containing changeset A */
10651   int nB,                         /* Number of bytes in buffer pB */
10652   void *pB,                       /* Pointer to buffer containing changeset B */
10653   int *pnOut,                     /* OUT: Number of bytes in output changeset */
10654   void **ppOut                    /* OUT: Buffer containing output changeset */
10655 );
10656 
10657 
10658 /*
10659 ** CAPI3REF: Changegroup Handle
10660 **
10661 ** A changegroup is an object used to combine two or more
10662 ** [changesets] or [patchsets]
10663 */
10664 typedef struct sqlite3_changegroup sqlite3_changegroup;
10665 
10666 /*
10667 ** CAPI3REF: Create A New Changegroup Object
10668 ** CONSTRUCTOR: sqlite3_changegroup
10669 **
10670 ** An sqlite3_changegroup object is used to combine two or more changesets
10671 ** (or patchsets) into a single changeset (or patchset). A single changegroup
10672 ** object may combine changesets or patchsets, but not both. The output is
10673 ** always in the same format as the input.
10674 **
10675 ** If successful, this function returns SQLITE_OK and populates (*pp) with
10676 ** a pointer to a new sqlite3_changegroup object before returning. The caller
10677 ** should eventually free the returned object using a call to
10678 ** sqlite3changegroup_delete(). If an error occurs, an SQLite error code
10679 ** (i.e. SQLITE_NOMEM) is returned and *pp is set to NULL.
10680 **
10681 ** The usual usage pattern for an sqlite3_changegroup object is as follows:
10682 **
10683 ** &lt;ul&gt;
10684 **   &lt;li&gt; It is created using a call to sqlite3changegroup_new().
10685 **
10686 **   &lt;li&gt; Zero or more changesets (or patchsets) are added to the object
10687 **        by calling sqlite3changegroup_add().
10688 **
10689 **   &lt;li&gt; The result of combining all input changesets together is obtained
10690 **        by the application via a call to sqlite3changegroup_output().
10691 **
10692 **   &lt;li&gt; The object is deleted using a call to sqlite3changegroup_delete().
10693 ** &lt;/ul&gt;
10694 **
10695 ** Any number of calls to add() and output() may be made between the calls to
10696 ** new() and delete(), and in any order.
10697 **
10698 ** As well as the regular sqlite3changegroup_add() and
10699 ** sqlite3changegroup_output() functions, also available are the streaming
10700 ** versions sqlite3changegroup_add_strm() and sqlite3changegroup_output_strm().
10701 */
10702 SQLITE_API int sqlite3changegroup_new(sqlite3_changegroup **pp);
10703 
10704 /*
10705 ** CAPI3REF: Add A Changeset To A Changegroup
10706 ** METHOD: sqlite3_changegroup
10707 **
10708 ** Add all changes within the changeset (or patchset) in buffer pData (size
10709 ** nData bytes) to the changegroup.
10710 **
10711 ** If the buffer contains a patchset, then all prior calls to this function
10712 ** on the same changegroup object must also have specified patchsets. Or, if
10713 ** the buffer contains a changeset, so must have the earlier calls to this
10714 ** function. Otherwise, SQLITE_ERROR is returned and no changes are added
10715 ** to the changegroup.
10716 **
10717 ** Rows within the changeset and changegroup are identified by the values in
10718 ** their PRIMARY KEY columns. A change in the changeset is considered to
10719 ** apply to the same row as a change already present in the changegroup if
10720 ** the two rows have the same primary key.
10721 **
10722 ** Changes to rows that do not already appear in the changegroup are
10723 ** simply copied into it. Or, if both the new changeset and the changegroup
10724 ** contain changes that apply to a single row, the final contents of the
10725 ** changegroup depends on the type of each change, as follows:
10726 **
10727 ** &lt;table border=1 style=&quot;margin-left:8ex;margin-right:8ex&quot;&gt;
10728 **   &lt;tr&gt;&lt;th style=&quot;white-space:pre&quot;&gt;Existing Change  &lt;/th&gt;
10729 **       &lt;th style=&quot;white-space:pre&quot;&gt;New Change       &lt;/th&gt;
10730 **       &lt;th&gt;Output Change
10731 **   &lt;tr&gt;&lt;td&gt;INSERT &lt;td&gt;INSERT &lt;td&gt;
10732 **       The new change is ignored. This case does not occur if the new
10733 **       changeset was recorded immediately after the changesets already
10734 **       added to the changegroup.
10735 **   &lt;tr&gt;&lt;td&gt;INSERT &lt;td&gt;UPDATE &lt;td&gt;
10736 **       The INSERT change remains in the changegroup. The values in the
10737 **       INSERT change are modified as if the row was inserted by the
10738 **       existing change and then updated according to the new change.
10739 **   &lt;tr&gt;&lt;td&gt;INSERT &lt;td&gt;DELETE &lt;td&gt;
10740 **       The existing INSERT is removed from the changegroup. The DELETE is
10741 **       not added.
10742 **   &lt;tr&gt;&lt;td&gt;UPDATE &lt;td&gt;INSERT &lt;td&gt;
10743 **       The new change is ignored. This case does not occur if the new
10744 **       changeset was recorded immediately after the changesets already
10745 **       added to the changegroup.
10746 **   &lt;tr&gt;&lt;td&gt;UPDATE &lt;td&gt;UPDATE &lt;td&gt;
10747 **       The existing UPDATE remains within the changegroup. It is amended
10748 **       so that the accompanying values are as if the row was updated once
10749 **       by the existing change and then again by the new change.
10750 **   &lt;tr&gt;&lt;td&gt;UPDATE &lt;td&gt;DELETE &lt;td&gt;
10751 **       The existing UPDATE is replaced by the new DELETE within the
10752 **       changegroup.
10753 **   &lt;tr&gt;&lt;td&gt;DELETE &lt;td&gt;INSERT &lt;td&gt;
10754 **       If one or more of the column values in the row inserted by the
10755 **       new change differ from those in the row deleted by the existing
10756 **       change, the existing DELETE is replaced by an UPDATE within the
10757 **       changegroup. Otherwise, if the inserted row is exactly the same
10758 **       as the deleted row, the existing DELETE is simply discarded.
10759 **   &lt;tr&gt;&lt;td&gt;DELETE &lt;td&gt;UPDATE &lt;td&gt;
10760 **       The new change is ignored. This case does not occur if the new
10761 **       changeset was recorded immediately after the changesets already
10762 **       added to the changegroup.
10763 **   &lt;tr&gt;&lt;td&gt;DELETE &lt;td&gt;DELETE &lt;td&gt;
10764 **       The new change is ignored. This case does not occur if the new
10765 **       changeset was recorded immediately after the changesets already
10766 **       added to the changegroup.
10767 ** &lt;/table&gt;
10768 **
10769 ** If the new changeset contains changes to a table that is already present
10770 ** in the changegroup, then the number of columns and the position of the
10771 ** primary key columns for the table must be consistent. If this is not the
10772 ** case, this function fails with SQLITE_SCHEMA. If the input changeset
10773 ** appears to be corrupt and the corruption is detected, SQLITE_CORRUPT is
10774 ** returned. Or, if an out-of-memory condition occurs during processing, this
<a name="100" id="anc100"></a><span class="line-modified">10775 ** function returns SQLITE_NOMEM. In all cases, if an error occurs the state</span>
<span class="line-modified">10776 ** of the final contents of the changegroup is undefined.</span>
10777 **
10778 ** If no error occurs, SQLITE_OK is returned.
10779 */
10780 SQLITE_API int sqlite3changegroup_add(sqlite3_changegroup*, int nData, void *pData);
10781 
10782 /*
10783 ** CAPI3REF: Obtain A Composite Changeset From A Changegroup
10784 ** METHOD: sqlite3_changegroup
10785 **
10786 ** Obtain a buffer containing a changeset (or patchset) representing the
10787 ** current contents of the changegroup. If the inputs to the changegroup
10788 ** were themselves changesets, the output is a changeset. Or, if the
10789 ** inputs were patchsets, the output is also a patchset.
10790 **
10791 ** As with the output of the sqlite3session_changeset() and
10792 ** sqlite3session_patchset() functions, all changes related to a single
10793 ** table are grouped together in the output of this function. Tables appear
10794 ** in the same order as for the very first changeset added to the changegroup.
10795 ** If the second or subsequent changesets added to the changegroup contain
10796 ** changes for tables that do not appear in the first changeset, they are
10797 ** appended onto the end of the output changeset, again in the order in
10798 ** which they are first encountered.
10799 **
10800 ** If an error occurs, an SQLite error code is returned and the output
10801 ** variables (*pnData) and (*ppData) are set to 0. Otherwise, SQLITE_OK
10802 ** is returned and the output variables are set to the size of and a
10803 ** pointer to the output buffer, respectively. In this case it is the
10804 ** responsibility of the caller to eventually free the buffer using a
10805 ** call to sqlite3_free().
10806 */
10807 SQLITE_API int sqlite3changegroup_output(
10808   sqlite3_changegroup*,
10809   int *pnData,                    /* OUT: Size of output buffer in bytes */
10810   void **ppData                   /* OUT: Pointer to output buffer */
10811 );
10812 
10813 /*
10814 ** CAPI3REF: Delete A Changegroup Object
10815 ** DESTRUCTOR: sqlite3_changegroup
10816 */
10817 SQLITE_API void sqlite3changegroup_delete(sqlite3_changegroup*);
10818 
10819 /*
10820 ** CAPI3REF: Apply A Changeset To A Database
10821 **
10822 ** Apply a changeset or patchset to a database. These functions attempt to
10823 ** update the &quot;main&quot; database attached to handle db with the changes found in
10824 ** the changeset passed via the second and third arguments.
10825 **
10826 ** The fourth argument (xFilter) passed to these functions is the &quot;filter
10827 ** callback&quot;. If it is not NULL, then for each table affected by at least one
10828 ** change in the changeset, the filter callback is invoked with
10829 ** the table name as the second argument, and a copy of the context pointer
10830 ** passed as the sixth argument as the first. If the &quot;filter callback&quot;
10831 ** returns zero, then no attempt is made to apply any changes to the table.
10832 ** Otherwise, if the return value is non-zero or the xFilter argument to
10833 ** is NULL, all changes related to the table are attempted.
10834 **
10835 ** For each table that is not excluded by the filter callback, this function
10836 ** tests that the target database contains a compatible table. A table is
10837 ** considered compatible if all of the following are true:
10838 **
10839 ** &lt;ul&gt;
10840 **   &lt;li&gt; The table has the same name as the name recorded in the
10841 **        changeset, and
10842 **   &lt;li&gt; The table has at least as many columns as recorded in the
10843 **        changeset, and
10844 **   &lt;li&gt; The table has primary key columns in the same position as
10845 **        recorded in the changeset.
10846 ** &lt;/ul&gt;
10847 **
10848 ** If there is no compatible table, it is not an error, but none of the
10849 ** changes associated with the table are applied. A warning message is issued
10850 ** via the sqlite3_log() mechanism with the error code SQLITE_SCHEMA. At most
10851 ** one such warning is issued for each table in the changeset.
10852 **
10853 ** For each change for which there is a compatible table, an attempt is made
10854 ** to modify the table contents according to the UPDATE, INSERT or DELETE
10855 ** change. If a change cannot be applied cleanly, the conflict handler
10856 ** function passed as the fifth argument to sqlite3changeset_apply() may be
10857 ** invoked. A description of exactly when the conflict handler is invoked for
10858 ** each type of change is below.
10859 **
10860 ** Unlike the xFilter argument, xConflict may not be passed NULL. The results
10861 ** of passing anything other than a valid function pointer as the xConflict
10862 ** argument are undefined.
10863 **
10864 ** Each time the conflict handler function is invoked, it must return one
10865 ** of [SQLITE_CHANGESET_OMIT], [SQLITE_CHANGESET_ABORT] or
10866 ** [SQLITE_CHANGESET_REPLACE]. SQLITE_CHANGESET_REPLACE may only be returned
10867 ** if the second argument passed to the conflict handler is either
10868 ** SQLITE_CHANGESET_DATA or SQLITE_CHANGESET_CONFLICT. If the conflict-handler
10869 ** returns an illegal value, any changes already made are rolled back and
10870 ** the call to sqlite3changeset_apply() returns SQLITE_MISUSE. Different
10871 ** actions are taken by sqlite3changeset_apply() depending on the value
10872 ** returned by each invocation of the conflict-handler function. Refer to
10873 ** the documentation for the three
10874 ** [SQLITE_CHANGESET_OMIT|available return values] for details.
10875 **
10876 ** &lt;dl&gt;
10877 ** &lt;dt&gt;DELETE Changes&lt;dd&gt;
10878 **   For each DELETE change, the function checks if the target database
10879 **   contains a row with the same primary key value (or values) as the
10880 **   original row values stored in the changeset. If it does, and the values
10881 **   stored in all non-primary key columns also match the values stored in
10882 **   the changeset the row is deleted from the target database.
10883 **
10884 **   If a row with matching primary key values is found, but one or more of
10885 **   the non-primary key fields contains a value different from the original
10886 **   row value stored in the changeset, the conflict-handler function is
10887 **   invoked with [SQLITE_CHANGESET_DATA] as the second argument. If the
10888 **   database table has more columns than are recorded in the changeset,
10889 **   only the values of those non-primary key fields are compared against
10890 **   the current database contents - any trailing database table columns
10891 **   are ignored.
10892 **
10893 **   If no row with matching primary key values is found in the database,
10894 **   the conflict-handler function is invoked with [SQLITE_CHANGESET_NOTFOUND]
10895 **   passed as the second argument.
10896 **
10897 **   If the DELETE operation is attempted, but SQLite returns SQLITE_CONSTRAINT
10898 **   (which can only happen if a foreign key constraint is violated), the
10899 **   conflict-handler function is invoked with [SQLITE_CHANGESET_CONSTRAINT]
10900 **   passed as the second argument. This includes the case where the DELETE
10901 **   operation is attempted because an earlier call to the conflict handler
10902 **   function returned [SQLITE_CHANGESET_REPLACE].
10903 **
10904 ** &lt;dt&gt;INSERT Changes&lt;dd&gt;
10905 **   For each INSERT change, an attempt is made to insert the new row into
10906 **   the database. If the changeset row contains fewer fields than the
10907 **   database table, the trailing fields are populated with their default
10908 **   values.
10909 **
10910 **   If the attempt to insert the row fails because the database already
10911 **   contains a row with the same primary key values, the conflict handler
10912 **   function is invoked with the second argument set to
10913 **   [SQLITE_CHANGESET_CONFLICT].
10914 **
10915 **   If the attempt to insert the row fails because of some other constraint
10916 **   violation (e.g. NOT NULL or UNIQUE), the conflict handler function is
10917 **   invoked with the second argument set to [SQLITE_CHANGESET_CONSTRAINT].
10918 **   This includes the case where the INSERT operation is re-attempted because
10919 **   an earlier call to the conflict handler function returned
10920 **   [SQLITE_CHANGESET_REPLACE].
10921 **
10922 ** &lt;dt&gt;UPDATE Changes&lt;dd&gt;
10923 **   For each UPDATE change, the function checks if the target database
10924 **   contains a row with the same primary key value (or values) as the
10925 **   original row values stored in the changeset. If it does, and the values
10926 **   stored in all modified non-primary key columns also match the values
10927 **   stored in the changeset the row is updated within the target database.
10928 **
10929 **   If a row with matching primary key values is found, but one or more of
10930 **   the modified non-primary key fields contains a value different from an
10931 **   original row value stored in the changeset, the conflict-handler function
10932 **   is invoked with [SQLITE_CHANGESET_DATA] as the second argument. Since
10933 **   UPDATE changes only contain values for non-primary key fields that are
10934 **   to be modified, only those fields need to match the original values to
10935 **   avoid the SQLITE_CHANGESET_DATA conflict-handler callback.
10936 **
10937 **   If no row with matching primary key values is found in the database,
10938 **   the conflict-handler function is invoked with [SQLITE_CHANGESET_NOTFOUND]
10939 **   passed as the second argument.
10940 **
10941 **   If the UPDATE operation is attempted, but SQLite returns
10942 **   SQLITE_CONSTRAINT, the conflict-handler function is invoked with
10943 **   [SQLITE_CHANGESET_CONSTRAINT] passed as the second argument.
10944 **   This includes the case where the UPDATE operation is attempted after
10945 **   an earlier call to the conflict handler function returned
10946 **   [SQLITE_CHANGESET_REPLACE].
10947 ** &lt;/dl&gt;
10948 **
10949 ** It is safe to execute SQL statements, including those that write to the
10950 ** table that the callback related to, from within the xConflict callback.
<a name="101" id="anc101"></a><span class="line-modified">10951 ** This can be used to further customize the application&#39;s conflict</span>
10952 ** resolution strategy.
10953 **
10954 ** All changes made by these functions are enclosed in a savepoint transaction.
10955 ** If any other error (aside from a constraint failure when attempting to
10956 ** write to the target database) occurs, then the savepoint transaction is
10957 ** rolled back, restoring the target database to its original state, and an
10958 ** SQLite error code returned.
10959 **
10960 ** If the output parameters (ppRebase) and (pnRebase) are non-NULL and
10961 ** the input is a changeset (not a patchset), then sqlite3changeset_apply_v2()
10962 ** may set (*ppRebase) to point to a &quot;rebase&quot; that may be used with the
10963 ** sqlite3_rebaser APIs buffer before returning. In this case (*pnRebase)
10964 ** is set to the size of the buffer in bytes. It is the responsibility of the
10965 ** caller to eventually free any such buffer using sqlite3_free(). The buffer
10966 ** is only allocated and populated if one or more conflicts were encountered
10967 ** while applying the patchset. See comments surrounding the sqlite3_rebaser
10968 ** APIs for further details.
10969 **
10970 ** The behavior of sqlite3changeset_apply_v2() and its streaming equivalent
10971 ** may be modified by passing a combination of
10972 ** [SQLITE_CHANGESETAPPLY_NOSAVEPOINT | supported flags] as the 9th parameter.
10973 **
10974 ** Note that the sqlite3changeset_apply_v2() API is still &lt;b&gt;experimental&lt;/b&gt;
10975 ** and therefore subject to change.
10976 */
10977 SQLITE_API int sqlite3changeset_apply(
10978   sqlite3 *db,                    /* Apply change to &quot;main&quot; db of this handle */
10979   int nChangeset,                 /* Size of changeset in bytes */
10980   void *pChangeset,               /* Changeset blob */
10981   int(*xFilter)(
10982     void *pCtx,                   /* Copy of sixth arg to _apply() */
10983     const char *zTab              /* Table name */
10984   ),
10985   int(*xConflict)(
10986     void *pCtx,                   /* Copy of sixth arg to _apply() */
10987     int eConflict,                /* DATA, MISSING, CONFLICT, CONSTRAINT */
10988     sqlite3_changeset_iter *p     /* Handle describing change and conflict */
10989   ),
10990   void *pCtx                      /* First argument passed to xConflict */
10991 );
10992 SQLITE_API int sqlite3changeset_apply_v2(
10993   sqlite3 *db,                    /* Apply change to &quot;main&quot; db of this handle */
10994   int nChangeset,                 /* Size of changeset in bytes */
10995   void *pChangeset,               /* Changeset blob */
10996   int(*xFilter)(
10997     void *pCtx,                   /* Copy of sixth arg to _apply() */
10998     const char *zTab              /* Table name */
10999   ),
11000   int(*xConflict)(
11001     void *pCtx,                   /* Copy of sixth arg to _apply() */
11002     int eConflict,                /* DATA, MISSING, CONFLICT, CONSTRAINT */
11003     sqlite3_changeset_iter *p     /* Handle describing change and conflict */
11004   ),
11005   void *pCtx,                     /* First argument passed to xConflict */
11006   void **ppRebase, int *pnRebase, /* OUT: Rebase data */
11007   int flags                       /* SESSION_CHANGESETAPPLY_* flags */
11008 );
11009 
11010 /*
11011 ** CAPI3REF: Flags for sqlite3changeset_apply_v2
11012 **
11013 ** The following flags may passed via the 9th parameter to
11014 ** [sqlite3changeset_apply_v2] and [sqlite3changeset_apply_v2_strm]:
11015 **
11016 ** &lt;dl&gt;
11017 ** &lt;dt&gt;SQLITE_CHANGESETAPPLY_NOSAVEPOINT &lt;dd&gt;
11018 **   Usually, the sessions module encloses all operations performed by
11019 **   a single call to apply_v2() or apply_v2_strm() in a [SAVEPOINT]. The
11020 **   SAVEPOINT is committed if the changeset or patchset is successfully
11021 **   applied, or rolled back if an error occurs. Specifying this flag
11022 **   causes the sessions module to omit this savepoint. In this case, if the
11023 **   caller has an open transaction or savepoint when apply_v2() is called,
11024 **   it may revert the partially applied changeset by rolling it back.
11025 **
11026 ** &lt;dt&gt;SQLITE_CHANGESETAPPLY_INVERT &lt;dd&gt;
11027 **   Invert the changeset before applying it. This is equivalent to inverting
11028 **   a changeset using sqlite3changeset_invert() before applying it. It is
11029 **   an error to specify this flag with a patchset.
11030 */
11031 #define SQLITE_CHANGESETAPPLY_NOSAVEPOINT   0x0001
11032 #define SQLITE_CHANGESETAPPLY_INVERT        0x0002
11033 
11034 /*
11035 ** CAPI3REF: Constants Passed To The Conflict Handler
11036 **
11037 ** Values that may be passed as the second argument to a conflict-handler.
11038 **
11039 ** &lt;dl&gt;
11040 ** &lt;dt&gt;SQLITE_CHANGESET_DATA&lt;dd&gt;
11041 **   The conflict handler is invoked with CHANGESET_DATA as the second argument
11042 **   when processing a DELETE or UPDATE change if a row with the required
11043 **   PRIMARY KEY fields is present in the database, but one or more other
11044 **   (non primary-key) fields modified by the update do not contain the
11045 **   expected &quot;before&quot; values.
11046 **
11047 **   The conflicting row, in this case, is the database row with the matching
11048 **   primary key.
11049 **
11050 ** &lt;dt&gt;SQLITE_CHANGESET_NOTFOUND&lt;dd&gt;
11051 **   The conflict handler is invoked with CHANGESET_NOTFOUND as the second
11052 **   argument when processing a DELETE or UPDATE change if a row with the
11053 **   required PRIMARY KEY fields is not present in the database.
11054 **
11055 **   There is no conflicting row in this case. The results of invoking the
11056 **   sqlite3changeset_conflict() API are undefined.
11057 **
11058 ** &lt;dt&gt;SQLITE_CHANGESET_CONFLICT&lt;dd&gt;
11059 **   CHANGESET_CONFLICT is passed as the second argument to the conflict
11060 **   handler while processing an INSERT change if the operation would result
11061 **   in duplicate primary key values.
11062 **
11063 **   The conflicting row in this case is the database row with the matching
11064 **   primary key.
11065 **
11066 ** &lt;dt&gt;SQLITE_CHANGESET_FOREIGN_KEY&lt;dd&gt;
11067 **   If foreign key handling is enabled, and applying a changeset leaves the
11068 **   database in a state containing foreign key violations, the conflict
11069 **   handler is invoked with CHANGESET_FOREIGN_KEY as the second argument
11070 **   exactly once before the changeset is committed. If the conflict handler
11071 **   returns CHANGESET_OMIT, the changes, including those that caused the
11072 **   foreign key constraint violation, are committed. Or, if it returns
11073 **   CHANGESET_ABORT, the changeset is rolled back.
11074 **
11075 **   No current or conflicting row information is provided. The only function
11076 **   it is possible to call on the supplied sqlite3_changeset_iter handle
11077 **   is sqlite3changeset_fk_conflicts().
11078 **
11079 ** &lt;dt&gt;SQLITE_CHANGESET_CONSTRAINT&lt;dd&gt;
11080 **   If any other constraint violation occurs while applying a change (i.e.
11081 **   a UNIQUE, CHECK or NOT NULL constraint), the conflict handler is
11082 **   invoked with CHANGESET_CONSTRAINT as the second argument.
11083 **
11084 **   There is no conflicting row in this case. The results of invoking the
11085 **   sqlite3changeset_conflict() API are undefined.
11086 **
11087 ** &lt;/dl&gt;
11088 */
11089 #define SQLITE_CHANGESET_DATA        1
11090 #define SQLITE_CHANGESET_NOTFOUND    2
11091 #define SQLITE_CHANGESET_CONFLICT    3
11092 #define SQLITE_CHANGESET_CONSTRAINT  4
11093 #define SQLITE_CHANGESET_FOREIGN_KEY 5
11094 
11095 /*
11096 ** CAPI3REF: Constants Returned By The Conflict Handler
11097 **
11098 ** A conflict handler callback must return one of the following three values.
11099 **
11100 ** &lt;dl&gt;
11101 ** &lt;dt&gt;SQLITE_CHANGESET_OMIT&lt;dd&gt;
11102 **   If a conflict handler returns this value no special action is taken. The
11103 **   change that caused the conflict is not applied. The session module
11104 **   continues to the next change in the changeset.
11105 **
11106 ** &lt;dt&gt;SQLITE_CHANGESET_REPLACE&lt;dd&gt;
11107 **   This value may only be returned if the second argument to the conflict
11108 **   handler was SQLITE_CHANGESET_DATA or SQLITE_CHANGESET_CONFLICT. If this
11109 **   is not the case, any changes applied so far are rolled back and the
11110 **   call to sqlite3changeset_apply() returns SQLITE_MISUSE.
11111 **
11112 **   If CHANGESET_REPLACE is returned by an SQLITE_CHANGESET_DATA conflict
11113 **   handler, then the conflicting row is either updated or deleted, depending
11114 **   on the type of change.
11115 **
11116 **   If CHANGESET_REPLACE is returned by an SQLITE_CHANGESET_CONFLICT conflict
11117 **   handler, then the conflicting row is removed from the database and a
11118 **   second attempt to apply the change is made. If this second attempt fails,
11119 **   the original row is restored to the database before continuing.
11120 **
11121 ** &lt;dt&gt;SQLITE_CHANGESET_ABORT&lt;dd&gt;
11122 **   If this value is returned, any changes applied so far are rolled back
11123 **   and the call to sqlite3changeset_apply() returns SQLITE_ABORT.
11124 ** &lt;/dl&gt;
11125 */
11126 #define SQLITE_CHANGESET_OMIT       0
11127 #define SQLITE_CHANGESET_REPLACE    1
11128 #define SQLITE_CHANGESET_ABORT      2
11129 
11130 /*
11131 ** CAPI3REF: Rebasing changesets
11132 ** EXPERIMENTAL
11133 **
11134 ** Suppose there is a site hosting a database in state S0. And that
11135 ** modifications are made that move that database to state S1 and a
11136 ** changeset recorded (the &quot;local&quot; changeset). Then, a changeset based
11137 ** on S0 is received from another site (the &quot;remote&quot; changeset) and
11138 ** applied to the database. The database is then in state
11139 ** (S1+&quot;remote&quot;), where the exact state depends on any conflict
11140 ** resolution decisions (OMIT or REPLACE) made while applying &quot;remote&quot;.
11141 ** Rebasing a changeset is to update it to take those conflict
11142 ** resolution decisions into account, so that the same conflicts
11143 ** do not have to be resolved elsewhere in the network.
11144 **
11145 ** For example, if both the local and remote changesets contain an
11146 ** INSERT of the same key on &quot;CREATE TABLE t1(a PRIMARY KEY, b)&quot;:
11147 **
11148 **   local:  INSERT INTO t1 VALUES(1, &#39;v1&#39;);
11149 **   remote: INSERT INTO t1 VALUES(1, &#39;v2&#39;);
11150 **
11151 ** and the conflict resolution is REPLACE, then the INSERT change is
11152 ** removed from the local changeset (it was overridden). Or, if the
11153 ** conflict resolution was &quot;OMIT&quot;, then the local changeset is modified
11154 ** to instead contain:
11155 **
11156 **           UPDATE t1 SET b = &#39;v2&#39; WHERE a=1;
11157 **
11158 ** Changes within the local changeset are rebased as follows:
11159 **
11160 ** &lt;dl&gt;
11161 ** &lt;dt&gt;Local INSERT&lt;dd&gt;
11162 **   This may only conflict with a remote INSERT. If the conflict
11163 **   resolution was OMIT, then add an UPDATE change to the rebased
11164 **   changeset. Or, if the conflict resolution was REPLACE, add
11165 **   nothing to the rebased changeset.
11166 **
11167 ** &lt;dt&gt;Local DELETE&lt;dd&gt;
11168 **   This may conflict with a remote UPDATE or DELETE. In both cases the
11169 **   only possible resolution is OMIT. If the remote operation was a
11170 **   DELETE, then add no change to the rebased changeset. If the remote
11171 **   operation was an UPDATE, then the old.* fields of change are updated
11172 **   to reflect the new.* values in the UPDATE.
11173 **
11174 ** &lt;dt&gt;Local UPDATE&lt;dd&gt;
11175 **   This may conflict with a remote UPDATE or DELETE. If it conflicts
11176 **   with a DELETE, and the conflict resolution was OMIT, then the update
11177 **   is changed into an INSERT. Any undefined values in the new.* record
11178 **   from the update change are filled in using the old.* values from
11179 **   the conflicting DELETE. Or, if the conflict resolution was REPLACE,
11180 **   the UPDATE change is simply omitted from the rebased changeset.
11181 **
11182 **   If conflict is with a remote UPDATE and the resolution is OMIT, then
11183 **   the old.* values are rebased using the new.* values in the remote
11184 **   change. Or, if the resolution is REPLACE, then the change is copied
11185 **   into the rebased changeset with updates to columns also updated by
11186 **   the conflicting remote UPDATE removed. If this means no columns would
11187 **   be updated, the change is omitted.
11188 ** &lt;/dl&gt;
11189 **
11190 ** A local change may be rebased against multiple remote changes
11191 ** simultaneously. If a single key is modified by multiple remote
11192 ** changesets, they are combined as follows before the local changeset
11193 ** is rebased:
11194 **
11195 ** &lt;ul&gt;
11196 **    &lt;li&gt; If there has been one or more REPLACE resolutions on a
11197 **         key, it is rebased according to a REPLACE.
11198 **
11199 **    &lt;li&gt; If there have been no REPLACE resolutions on a key, then
11200 **         the local changeset is rebased according to the most recent
11201 **         of the OMIT resolutions.
11202 ** &lt;/ul&gt;
11203 **
11204 ** Note that conflict resolutions from multiple remote changesets are
11205 ** combined on a per-field basis, not per-row. This means that in the
11206 ** case of multiple remote UPDATE operations, some fields of a single
11207 ** local change may be rebased for REPLACE while others are rebased for
11208 ** OMIT.
11209 **
11210 ** In order to rebase a local changeset, the remote changeset must first
11211 ** be applied to the local database using sqlite3changeset_apply_v2() and
11212 ** the buffer of rebase information captured. Then:
11213 **
11214 ** &lt;ol&gt;
11215 **   &lt;li&gt; An sqlite3_rebaser object is created by calling
11216 **        sqlite3rebaser_create().
11217 **   &lt;li&gt; The new object is configured with the rebase buffer obtained from
11218 **        sqlite3changeset_apply_v2() by calling sqlite3rebaser_configure().
11219 **        If the local changeset is to be rebased against multiple remote
11220 **        changesets, then sqlite3rebaser_configure() should be called
11221 **        multiple times, in the same order that the multiple
11222 **        sqlite3changeset_apply_v2() calls were made.
11223 **   &lt;li&gt; Each local changeset is rebased by calling sqlite3rebaser_rebase().
11224 **   &lt;li&gt; The sqlite3_rebaser object is deleted by calling
11225 **        sqlite3rebaser_delete().
11226 ** &lt;/ol&gt;
11227 */
11228 typedef struct sqlite3_rebaser sqlite3_rebaser;
11229 
11230 /*
11231 ** CAPI3REF: Create a changeset rebaser object.
11232 ** EXPERIMENTAL
11233 **
11234 ** Allocate a new changeset rebaser object. If successful, set (*ppNew) to
11235 ** point to the new object and return SQLITE_OK. Otherwise, if an error
11236 ** occurs, return an SQLite error code (e.g. SQLITE_NOMEM) and set (*ppNew)
11237 ** to NULL.
11238 */
11239 SQLITE_API int sqlite3rebaser_create(sqlite3_rebaser **ppNew);
11240 
11241 /*
11242 ** CAPI3REF: Configure a changeset rebaser object.
11243 ** EXPERIMENTAL
11244 **
11245 ** Configure the changeset rebaser object to rebase changesets according
11246 ** to the conflict resolutions described by buffer pRebase (size nRebase
11247 ** bytes), which must have been obtained from a previous call to
11248 ** sqlite3changeset_apply_v2().
11249 */
11250 SQLITE_API int sqlite3rebaser_configure(
11251   sqlite3_rebaser*,
11252   int nRebase, const void *pRebase
11253 );
11254 
11255 /*
11256 ** CAPI3REF: Rebase a changeset
11257 ** EXPERIMENTAL
11258 **
11259 ** Argument pIn must point to a buffer containing a changeset nIn bytes
11260 ** in size. This function allocates and populates a buffer with a copy
<a name="102" id="anc102"></a><span class="line-modified">11261 ** of the changeset rebased according to the configuration of the</span>
11262 ** rebaser object passed as the first argument. If successful, (*ppOut)
11263 ** is set to point to the new buffer containing the rebased changeset and
11264 ** (*pnOut) to its size in bytes and SQLITE_OK returned. It is the
11265 ** responsibility of the caller to eventually free the new buffer using
11266 ** sqlite3_free(). Otherwise, if an error occurs, (*ppOut) and (*pnOut)
11267 ** are set to zero and an SQLite error code returned.
11268 */
11269 SQLITE_API int sqlite3rebaser_rebase(
11270   sqlite3_rebaser*,
11271   int nIn, const void *pIn,
11272   int *pnOut, void **ppOut
11273 );
11274 
11275 /*
11276 ** CAPI3REF: Delete a changeset rebaser object.
11277 ** EXPERIMENTAL
11278 **
11279 ** Delete the changeset rebaser object and all associated resources. There
11280 ** should be one call to this function for each successful invocation
11281 ** of sqlite3rebaser_create().
11282 */
11283 SQLITE_API void sqlite3rebaser_delete(sqlite3_rebaser *p);
11284 
11285 /*
11286 ** CAPI3REF: Streaming Versions of API functions.
11287 **
11288 ** The six streaming API xxx_strm() functions serve similar purposes to the
11289 ** corresponding non-streaming API functions:
11290 **
11291 ** &lt;table border=1 style=&quot;margin-left:8ex;margin-right:8ex&quot;&gt;
11292 **   &lt;tr&gt;&lt;th&gt;Streaming function&lt;th&gt;Non-streaming equivalent&lt;/th&gt;
11293 **   &lt;tr&gt;&lt;td&gt;sqlite3changeset_apply_strm&lt;td&gt;[sqlite3changeset_apply]
11294 **   &lt;tr&gt;&lt;td&gt;sqlite3changeset_apply_strm_v2&lt;td&gt;[sqlite3changeset_apply_v2]
11295 **   &lt;tr&gt;&lt;td&gt;sqlite3changeset_concat_strm&lt;td&gt;[sqlite3changeset_concat]
11296 **   &lt;tr&gt;&lt;td&gt;sqlite3changeset_invert_strm&lt;td&gt;[sqlite3changeset_invert]
11297 **   &lt;tr&gt;&lt;td&gt;sqlite3changeset_start_strm&lt;td&gt;[sqlite3changeset_start]
11298 **   &lt;tr&gt;&lt;td&gt;sqlite3session_changeset_strm&lt;td&gt;[sqlite3session_changeset]
11299 **   &lt;tr&gt;&lt;td&gt;sqlite3session_patchset_strm&lt;td&gt;[sqlite3session_patchset]
11300 ** &lt;/table&gt;
11301 **
11302 ** Non-streaming functions that accept changesets (or patchsets) as input
11303 ** require that the entire changeset be stored in a single buffer in memory.
11304 ** Similarly, those that return a changeset or patchset do so by returning
11305 ** a pointer to a single large buffer allocated using sqlite3_malloc().
11306 ** Normally this is convenient. However, if an application running in a
11307 ** low-memory environment is required to handle very large changesets, the
11308 ** large contiguous memory allocations required can become onerous.
11309 **
11310 ** In order to avoid this problem, instead of a single large buffer, input
11311 ** is passed to a streaming API functions by way of a callback function that
11312 ** the sessions module invokes to incrementally request input data as it is
11313 ** required. In all cases, a pair of API function parameters such as
11314 **
11315 **  &lt;pre&gt;
11316 **  &amp;nbsp;     int nChangeset,
11317 **  &amp;nbsp;     void *pChangeset,
11318 **  &lt;/pre&gt;
11319 **
11320 ** Is replaced by:
11321 **
11322 **  &lt;pre&gt;
11323 **  &amp;nbsp;     int (*xInput)(void *pIn, void *pData, int *pnData),
11324 **  &amp;nbsp;     void *pIn,
11325 **  &lt;/pre&gt;
11326 **
11327 ** Each time the xInput callback is invoked by the sessions module, the first
11328 ** argument passed is a copy of the supplied pIn context pointer. The second
11329 ** argument, pData, points to a buffer (*pnData) bytes in size. Assuming no
11330 ** error occurs the xInput method should copy up to (*pnData) bytes of data
11331 ** into the buffer and set (*pnData) to the actual number of bytes copied
11332 ** before returning SQLITE_OK. If the input is completely exhausted, (*pnData)
11333 ** should be set to zero to indicate this. Or, if an error occurs, an SQLite
11334 ** error code should be returned. In all cases, if an xInput callback returns
11335 ** an error, all processing is abandoned and the streaming API function
11336 ** returns a copy of the error code to the caller.
11337 **
11338 ** In the case of sqlite3changeset_start_strm(), the xInput callback may be
11339 ** invoked by the sessions module at any point during the lifetime of the
11340 ** iterator. If such an xInput callback returns an error, the iterator enters
11341 ** an error state, whereby all subsequent calls to iterator functions
11342 ** immediately fail with the same error code as returned by xInput.
11343 **
11344 ** Similarly, streaming API functions that return changesets (or patchsets)
11345 ** return them in chunks by way of a callback function instead of via a
11346 ** pointer to a single large buffer. In this case, a pair of parameters such
11347 ** as:
11348 **
11349 **  &lt;pre&gt;
11350 **  &amp;nbsp;     int *pnChangeset,
11351 **  &amp;nbsp;     void **ppChangeset,
11352 **  &lt;/pre&gt;
11353 **
11354 ** Is replaced by:
11355 **
11356 **  &lt;pre&gt;
11357 **  &amp;nbsp;     int (*xOutput)(void *pOut, const void *pData, int nData),
11358 **  &amp;nbsp;     void *pOut
11359 **  &lt;/pre&gt;
11360 **
11361 ** The xOutput callback is invoked zero or more times to return data to
11362 ** the application. The first parameter passed to each call is a copy of the
11363 ** pOut pointer supplied by the application. The second parameter, pData,
11364 ** points to a buffer nData bytes in size containing the chunk of output
11365 ** data being returned. If the xOutput callback successfully processes the
11366 ** supplied data, it should return SQLITE_OK to indicate success. Otherwise,
11367 ** it should return some other SQLite error code. In this case processing
11368 ** is immediately abandoned and the streaming API function returns a copy
11369 ** of the xOutput error code to the application.
11370 **
11371 ** The sessions module never invokes an xOutput callback with the third
11372 ** parameter set to a value less than or equal to zero. Other than this,
11373 ** no guarantees are made as to the size of the chunks of data returned.
11374 */
11375 SQLITE_API int sqlite3changeset_apply_strm(
11376   sqlite3 *db,                    /* Apply change to &quot;main&quot; db of this handle */
11377   int (*xInput)(void *pIn, void *pData, int *pnData), /* Input function */
11378   void *pIn,                                          /* First arg for xInput */
11379   int(*xFilter)(
11380     void *pCtx,                   /* Copy of sixth arg to _apply() */
11381     const char *zTab              /* Table name */
11382   ),
11383   int(*xConflict)(
11384     void *pCtx,                   /* Copy of sixth arg to _apply() */
11385     int eConflict,                /* DATA, MISSING, CONFLICT, CONSTRAINT */
11386     sqlite3_changeset_iter *p     /* Handle describing change and conflict */
11387   ),
11388   void *pCtx                      /* First argument passed to xConflict */
11389 );
11390 SQLITE_API int sqlite3changeset_apply_v2_strm(
11391   sqlite3 *db,                    /* Apply change to &quot;main&quot; db of this handle */
11392   int (*xInput)(void *pIn, void *pData, int *pnData), /* Input function */
11393   void *pIn,                                          /* First arg for xInput */
11394   int(*xFilter)(
11395     void *pCtx,                   /* Copy of sixth arg to _apply() */
11396     const char *zTab              /* Table name */
11397   ),
11398   int(*xConflict)(
11399     void *pCtx,                   /* Copy of sixth arg to _apply() */
11400     int eConflict,                /* DATA, MISSING, CONFLICT, CONSTRAINT */
11401     sqlite3_changeset_iter *p     /* Handle describing change and conflict */
11402   ),
11403   void *pCtx,                     /* First argument passed to xConflict */
11404   void **ppRebase, int *pnRebase,
11405   int flags
11406 );
11407 SQLITE_API int sqlite3changeset_concat_strm(
11408   int (*xInputA)(void *pIn, void *pData, int *pnData),
11409   void *pInA,
11410   int (*xInputB)(void *pIn, void *pData, int *pnData),
11411   void *pInB,
11412   int (*xOutput)(void *pOut, const void *pData, int nData),
11413   void *pOut
11414 );
11415 SQLITE_API int sqlite3changeset_invert_strm(
11416   int (*xInput)(void *pIn, void *pData, int *pnData),
11417   void *pIn,
11418   int (*xOutput)(void *pOut, const void *pData, int nData),
11419   void *pOut
11420 );
11421 SQLITE_API int sqlite3changeset_start_strm(
11422   sqlite3_changeset_iter **pp,
11423   int (*xInput)(void *pIn, void *pData, int *pnData),
11424   void *pIn
11425 );
11426 SQLITE_API int sqlite3changeset_start_v2_strm(
11427   sqlite3_changeset_iter **pp,
11428   int (*xInput)(void *pIn, void *pData, int *pnData),
11429   void *pIn,
11430   int flags
11431 );
11432 SQLITE_API int sqlite3session_changeset_strm(
11433   sqlite3_session *pSession,
11434   int (*xOutput)(void *pOut, const void *pData, int nData),
11435   void *pOut
11436 );
11437 SQLITE_API int sqlite3session_patchset_strm(
11438   sqlite3_session *pSession,
11439   int (*xOutput)(void *pOut, const void *pData, int nData),
11440   void *pOut
11441 );
11442 SQLITE_API int sqlite3changegroup_add_strm(sqlite3_changegroup*,
11443     int (*xInput)(void *pIn, void *pData, int *pnData),
11444     void *pIn
11445 );
11446 SQLITE_API int sqlite3changegroup_output_strm(sqlite3_changegroup*,
11447     int (*xOutput)(void *pOut, const void *pData, int nData),
11448     void *pOut
11449 );
11450 SQLITE_API int sqlite3rebaser_rebase_strm(
11451   sqlite3_rebaser *pRebaser,
11452   int (*xInput)(void *pIn, void *pData, int *pnData),
11453   void *pIn,
11454   int (*xOutput)(void *pOut, const void *pData, int nData),
11455   void *pOut
11456 );
11457 
11458 /*
11459 ** CAPI3REF: Configure global parameters
11460 **
11461 ** The sqlite3session_config() interface is used to make global configuration
11462 ** changes to the sessions module in order to tune it to the specific needs
11463 ** of the application.
11464 **
11465 ** The sqlite3session_config() interface is not threadsafe. If it is invoked
11466 ** while any other thread is inside any other sessions method then the
11467 ** results are undefined. Furthermore, if it is invoked after any sessions
11468 ** related objects have been created, the results are also undefined.
11469 **
11470 ** The first argument to the sqlite3session_config() function must be one
11471 ** of the SQLITE_SESSION_CONFIG_XXX constants defined below. The
11472 ** interpretation of the (void*) value passed as the second parameter and
11473 ** the effect of calling this function depends on the value of the first
11474 ** parameter.
11475 **
11476 ** &lt;dl&gt;
11477 ** &lt;dt&gt;SQLITE_SESSION_CONFIG_STRMSIZE&lt;dd&gt;
11478 **    By default, the sessions module streaming interfaces attempt to input
11479 **    and output data in approximately 1 KiB chunks. This operand may be used
11480 **    to set and query the value of this configuration setting. The pointer
11481 **    passed as the second argument must point to a value of type (int).
11482 **    If this value is greater than 0, it is used as the new streaming data
11483 **    chunk size for both input and output. Before returning, the (int) value
11484 **    pointed to by pArg is set to the final value of the streaming interface
11485 **    chunk size.
11486 ** &lt;/dl&gt;
11487 **
11488 ** This function returns SQLITE_OK if successful, or an SQLite error code
11489 ** otherwise.
11490 */
11491 SQLITE_API int sqlite3session_config(int op, void *pArg);
11492 
11493 /*
11494 ** CAPI3REF: Values for sqlite3session_config().
11495 */
11496 #define SQLITE_SESSION_CONFIG_STRMSIZE 1
11497 
11498 /*
11499 ** Make sure we can call this stuff from C++.
11500 */
11501 #ifdef __cplusplus
11502 }
11503 #endif
11504 
11505 #endif  /* !defined(__SQLITESESSION_H_) &amp;&amp; defined(SQLITE_ENABLE_SESSION) */
11506 
11507 /******** End of sqlite3session.h *********/
11508 /******** Begin file fts5.h *********/
11509 /*
11510 ** 2014 May 31
11511 **
11512 ** The author disclaims copyright to this source code.  In place of
11513 ** a legal notice, here is a blessing:
11514 **
11515 **    May you do good and not evil.
11516 **    May you find forgiveness for yourself and forgive others.
11517 **    May you share freely, never taking more than you give.
11518 **
11519 ******************************************************************************
11520 **
11521 ** Interfaces to extend FTS5. Using the interfaces defined in this file,
11522 ** FTS5 may be extended with:
11523 **
11524 **     * custom tokenizers, and
11525 **     * custom auxiliary functions.
11526 */
11527 
11528 
11529 #ifndef _FTS5_H
11530 #define _FTS5_H
11531 
11532 
11533 #ifdef __cplusplus
11534 extern &quot;C&quot; {
11535 #endif
11536 
11537 /*************************************************************************
11538 ** CUSTOM AUXILIARY FUNCTIONS
11539 **
11540 ** Virtual table implementations may overload SQL functions by implementing
11541 ** the sqlite3_module.xFindFunction() method.
11542 */
11543 
11544 typedef struct Fts5ExtensionApi Fts5ExtensionApi;
11545 typedef struct Fts5Context Fts5Context;
11546 typedef struct Fts5PhraseIter Fts5PhraseIter;
11547 
11548 typedef void (*fts5_extension_function)(
11549   const Fts5ExtensionApi *pApi,   /* API offered by current FTS version */
11550   Fts5Context *pFts,              /* First arg to pass to pApi functions */
11551   sqlite3_context *pCtx,          /* Context for returning result/error */
11552   int nVal,                       /* Number of values in apVal[] array */
11553   sqlite3_value **apVal           /* Array of trailing arguments */
11554 );
11555 
11556 struct Fts5PhraseIter {
11557   const unsigned char *a;
11558   const unsigned char *b;
11559 };
11560 
11561 /*
11562 ** EXTENSION API FUNCTIONS
11563 **
11564 ** xUserData(pFts):
11565 **   Return a copy of the context pointer the extension function was
11566 **   registered with.
11567 **
11568 ** xColumnTotalSize(pFts, iCol, pnToken):
11569 **   If parameter iCol is less than zero, set output variable *pnToken
11570 **   to the total number of tokens in the FTS5 table. Or, if iCol is
11571 **   non-negative but less than the number of columns in the table, return
11572 **   the total number of tokens in column iCol, considering all rows in
11573 **   the FTS5 table.
11574 **
11575 **   If parameter iCol is greater than or equal to the number of columns
11576 **   in the table, SQLITE_RANGE is returned. Or, if an error occurs (e.g.
11577 **   an OOM condition or IO error), an appropriate SQLite error code is
11578 **   returned.
11579 **
11580 ** xColumnCount(pFts):
11581 **   Return the number of columns in the table.
11582 **
11583 ** xColumnSize(pFts, iCol, pnToken):
11584 **   If parameter iCol is less than zero, set output variable *pnToken
11585 **   to the total number of tokens in the current row. Or, if iCol is
11586 **   non-negative but less than the number of columns in the table, set
11587 **   *pnToken to the number of tokens in column iCol of the current row.
11588 **
11589 **   If parameter iCol is greater than or equal to the number of columns
11590 **   in the table, SQLITE_RANGE is returned. Or, if an error occurs (e.g.
11591 **   an OOM condition or IO error), an appropriate SQLite error code is
11592 **   returned.
11593 **
11594 **   This function may be quite inefficient if used with an FTS5 table
11595 **   created with the &quot;columnsize=0&quot; option.
11596 **
11597 ** xColumnText:
11598 **   This function attempts to retrieve the text of column iCol of the
11599 **   current document. If successful, (*pz) is set to point to a buffer
11600 **   containing the text in utf-8 encoding, (*pn) is set to the size in bytes
11601 **   (not characters) of the buffer and SQLITE_OK is returned. Otherwise,
11602 **   if an error occurs, an SQLite error code is returned and the final values
11603 **   of (*pz) and (*pn) are undefined.
11604 **
11605 ** xPhraseCount:
11606 **   Returns the number of phrases in the current query expression.
11607 **
11608 ** xPhraseSize:
11609 **   Returns the number of tokens in phrase iPhrase of the query. Phrases
11610 **   are numbered starting from zero.
11611 **
11612 ** xInstCount:
11613 **   Set *pnInst to the total number of occurrences of all phrases within
11614 **   the query within the current row. Return SQLITE_OK if successful, or
11615 **   an error code (i.e. SQLITE_NOMEM) if an error occurs.
11616 **
11617 **   This API can be quite slow if used with an FTS5 table created with the
11618 **   &quot;detail=none&quot; or &quot;detail=column&quot; option. If the FTS5 table is created
11619 **   with either &quot;detail=none&quot; or &quot;detail=column&quot; and &quot;content=&quot; option
11620 **   (i.e. if it is a contentless table), then this API always returns 0.
11621 **
11622 ** xInst:
11623 **   Query for the details of phrase match iIdx within the current row.
11624 **   Phrase matches are numbered starting from zero, so the iIdx argument
11625 **   should be greater than or equal to zero and smaller than the value
11626 **   output by xInstCount().
11627 **
11628 **   Usually, output parameter *piPhrase is set to the phrase number, *piCol
11629 **   to the column in which it occurs and *piOff the token offset of the
11630 **   first token of the phrase. Returns SQLITE_OK if successful, or an error
11631 **   code (i.e. SQLITE_NOMEM) if an error occurs.
11632 **
11633 **   This API can be quite slow if used with an FTS5 table created with the
11634 **   &quot;detail=none&quot; or &quot;detail=column&quot; option.
11635 **
11636 ** xRowid:
11637 **   Returns the rowid of the current row.
11638 **
11639 ** xTokenize:
11640 **   Tokenize text using the tokenizer belonging to the FTS5 table.
11641 **
11642 ** xQueryPhrase(pFts5, iPhrase, pUserData, xCallback):
11643 **   This API function is used to query the FTS table for phrase iPhrase
11644 **   of the current query. Specifically, a query equivalent to:
11645 **
11646 **       ... FROM ftstable WHERE ftstable MATCH $p ORDER BY rowid
11647 **
11648 **   with $p set to a phrase equivalent to the phrase iPhrase of the
11649 **   current query is executed. Any column filter that applies to
11650 **   phrase iPhrase of the current query is included in $p. For each
11651 **   row visited, the callback function passed as the fourth argument
11652 **   is invoked. The context and API objects passed to the callback
11653 **   function may be used to access the properties of each matched row.
11654 **   Invoking Api.xUserData() returns a copy of the pointer passed as
11655 **   the third argument to pUserData.
11656 **
11657 **   If the callback function returns any value other than SQLITE_OK, the
11658 **   query is abandoned and the xQueryPhrase function returns immediately.
11659 **   If the returned value is SQLITE_DONE, xQueryPhrase returns SQLITE_OK.
11660 **   Otherwise, the error code is propagated upwards.
11661 **
11662 **   If the query runs to completion without incident, SQLITE_OK is returned.
11663 **   Or, if some error occurs before the query completes or is aborted by
11664 **   the callback, an SQLite error code is returned.
11665 **
11666 **
11667 ** xSetAuxdata(pFts5, pAux, xDelete)
11668 **
<a name="103" id="anc103"></a><span class="line-modified">11669 **   Save the pointer passed as the second argument as the extension function&#39;s</span>
11670 **   &quot;auxiliary data&quot;. The pointer may then be retrieved by the current or any
11671 **   future invocation of the same fts5 extension function made as part of
11672 **   the same MATCH query using the xGetAuxdata() API.
11673 **
11674 **   Each extension function is allocated a single auxiliary data slot for
11675 **   each FTS query (MATCH expression). If the extension function is invoked
11676 **   more than once for a single FTS query, then all invocations share a
11677 **   single auxiliary data context.
11678 **
11679 **   If there is already an auxiliary data pointer when this function is
11680 **   invoked, then it is replaced by the new pointer. If an xDelete callback
11681 **   was specified along with the original pointer, it is invoked at this
11682 **   point.
11683 **
11684 **   The xDelete callback, if one is specified, is also invoked on the
11685 **   auxiliary data pointer after the FTS5 query has finished.
11686 **
11687 **   If an error (e.g. an OOM condition) occurs within this function,
11688 **   the auxiliary data is set to NULL and an error code returned. If the
11689 **   xDelete parameter was not NULL, it is invoked on the auxiliary data
11690 **   pointer before returning.
11691 **
11692 **
11693 ** xGetAuxdata(pFts5, bClear)
11694 **
11695 **   Returns the current auxiliary data pointer for the fts5 extension
11696 **   function. See the xSetAuxdata() method for details.
11697 **
11698 **   If the bClear argument is non-zero, then the auxiliary data is cleared
11699 **   (set to NULL) before this function returns. In this case the xDelete,
11700 **   if any, is not invoked.
11701 **
11702 **
11703 ** xRowCount(pFts5, pnRow)
11704 **
11705 **   This function is used to retrieve the total number of rows in the table.
11706 **   In other words, the same value that would be returned by:
11707 **
11708 **        SELECT count(*) FROM ftstable;
11709 **
11710 ** xPhraseFirst()
11711 **   This function is used, along with type Fts5PhraseIter and the xPhraseNext
11712 **   method, to iterate through all instances of a single query phrase within
11713 **   the current row. This is the same information as is accessible via the
11714 **   xInstCount/xInst APIs. While the xInstCount/xInst APIs are more convenient
11715 **   to use, this API may be faster under some circumstances. To iterate
11716 **   through instances of phrase iPhrase, use the following code:
11717 **
11718 **       Fts5PhraseIter iter;
11719 **       int iCol, iOff;
11720 **       for(pApi-&gt;xPhraseFirst(pFts, iPhrase, &amp;iter, &amp;iCol, &amp;iOff);
11721 **           iCol&gt;=0;
11722 **           pApi-&gt;xPhraseNext(pFts, &amp;iter, &amp;iCol, &amp;iOff)
11723 **       ){
11724 **         // An instance of phrase iPhrase at offset iOff of column iCol
11725 **       }
11726 **
11727 **   The Fts5PhraseIter structure is defined above. Applications should not
11728 **   modify this structure directly - it should only be used as shown above
11729 **   with the xPhraseFirst() and xPhraseNext() API methods (and by
11730 **   xPhraseFirstColumn() and xPhraseNextColumn() as illustrated below).
11731 **
11732 **   This API can be quite slow if used with an FTS5 table created with the
11733 **   &quot;detail=none&quot; or &quot;detail=column&quot; option. If the FTS5 table is created
11734 **   with either &quot;detail=none&quot; or &quot;detail=column&quot; and &quot;content=&quot; option
11735 **   (i.e. if it is a contentless table), then this API always iterates
11736 **   through an empty set (all calls to xPhraseFirst() set iCol to -1).
11737 **
11738 ** xPhraseNext()
11739 **   See xPhraseFirst above.
11740 **
11741 ** xPhraseFirstColumn()
11742 **   This function and xPhraseNextColumn() are similar to the xPhraseFirst()
11743 **   and xPhraseNext() APIs described above. The difference is that instead
11744 **   of iterating through all instances of a phrase in the current row, these
11745 **   APIs are used to iterate through the set of columns in the current row
11746 **   that contain one or more instances of a specified phrase. For example:
11747 **
11748 **       Fts5PhraseIter iter;
11749 **       int iCol;
11750 **       for(pApi-&gt;xPhraseFirstColumn(pFts, iPhrase, &amp;iter, &amp;iCol);
11751 **           iCol&gt;=0;
11752 **           pApi-&gt;xPhraseNextColumn(pFts, &amp;iter, &amp;iCol)
11753 **       ){
11754 **         // Column iCol contains at least one instance of phrase iPhrase
11755 **       }
11756 **
11757 **   This API can be quite slow if used with an FTS5 table created with the
11758 **   &quot;detail=none&quot; option. If the FTS5 table is created with either
11759 **   &quot;detail=none&quot; &quot;content=&quot; option (i.e. if it is a contentless table),
11760 **   then this API always iterates through an empty set (all calls to
11761 **   xPhraseFirstColumn() set iCol to -1).
11762 **
11763 **   The information accessed using this API and its companion
11764 **   xPhraseFirstColumn() may also be obtained using xPhraseFirst/xPhraseNext
11765 **   (or xInst/xInstCount). The chief advantage of this API is that it is
11766 **   significantly more efficient than those alternatives when used with
11767 **   &quot;detail=column&quot; tables.
11768 **
11769 ** xPhraseNextColumn()
11770 **   See xPhraseFirstColumn above.
11771 */
11772 struct Fts5ExtensionApi {
11773   int iVersion;                   /* Currently always set to 3 */
11774 
11775   void *(*xUserData)(Fts5Context*);
11776 
11777   int (*xColumnCount)(Fts5Context*);
11778   int (*xRowCount)(Fts5Context*, sqlite3_int64 *pnRow);
11779   int (*xColumnTotalSize)(Fts5Context*, int iCol, sqlite3_int64 *pnToken);
11780 
11781   int (*xTokenize)(Fts5Context*,
11782     const char *pText, int nText, /* Text to tokenize */
11783     void *pCtx,                   /* Context passed to xToken() */
11784     int (*xToken)(void*, int, const char*, int, int, int)       /* Callback */
11785   );
11786 
11787   int (*xPhraseCount)(Fts5Context*);
11788   int (*xPhraseSize)(Fts5Context*, int iPhrase);
11789 
11790   int (*xInstCount)(Fts5Context*, int *pnInst);
11791   int (*xInst)(Fts5Context*, int iIdx, int *piPhrase, int *piCol, int *piOff);
11792 
11793   sqlite3_int64 (*xRowid)(Fts5Context*);
11794   int (*xColumnText)(Fts5Context*, int iCol, const char **pz, int *pn);
11795   int (*xColumnSize)(Fts5Context*, int iCol, int *pnToken);
11796 
11797   int (*xQueryPhrase)(Fts5Context*, int iPhrase, void *pUserData,
11798     int(*)(const Fts5ExtensionApi*,Fts5Context*,void*)
11799   );
11800   int (*xSetAuxdata)(Fts5Context*, void *pAux, void(*xDelete)(void*));
11801   void *(*xGetAuxdata)(Fts5Context*, int bClear);
11802 
11803   int (*xPhraseFirst)(Fts5Context*, int iPhrase, Fts5PhraseIter*, int*, int*);
11804   void (*xPhraseNext)(Fts5Context*, Fts5PhraseIter*, int *piCol, int *piOff);
11805 
11806   int (*xPhraseFirstColumn)(Fts5Context*, int iPhrase, Fts5PhraseIter*, int*);
11807   void (*xPhraseNextColumn)(Fts5Context*, Fts5PhraseIter*, int *piCol);
11808 };
11809 
11810 /*
11811 ** CUSTOM AUXILIARY FUNCTIONS
11812 *************************************************************************/
11813 
11814 /*************************************************************************
11815 ** CUSTOM TOKENIZERS
11816 **
11817 ** Applications may also register custom tokenizer types. A tokenizer
11818 ** is registered by providing fts5 with a populated instance of the
11819 ** following structure. All structure methods must be defined, setting
11820 ** any member of the fts5_tokenizer struct to NULL leads to undefined
11821 ** behaviour. The structure methods are expected to function as follows:
11822 **
11823 ** xCreate:
11824 **   This function is used to allocate and initialize a tokenizer instance.
11825 **   A tokenizer instance is required to actually tokenize text.
11826 **
11827 **   The first argument passed to this function is a copy of the (void*)
11828 **   pointer provided by the application when the fts5_tokenizer object
11829 **   was registered with FTS5 (the third argument to xCreateTokenizer()).
11830 **   The second and third arguments are an array of nul-terminated strings
11831 **   containing the tokenizer arguments, if any, specified following the
11832 **   tokenizer name as part of the CREATE VIRTUAL TABLE statement used
11833 **   to create the FTS5 table.
11834 **
11835 **   The final argument is an output variable. If successful, (*ppOut)
11836 **   should be set to point to the new tokenizer handle and SQLITE_OK
11837 **   returned. If an error occurs, some value other than SQLITE_OK should
11838 **   be returned. In this case, fts5 assumes that the final value of *ppOut
11839 **   is undefined.
11840 **
11841 ** xDelete:
11842 **   This function is invoked to delete a tokenizer handle previously
11843 **   allocated using xCreate(). Fts5 guarantees that this function will
11844 **   be invoked exactly once for each successful call to xCreate().
11845 **
11846 ** xTokenize:
11847 **   This function is expected to tokenize the nText byte string indicated
11848 **   by argument pText. pText may or may not be nul-terminated. The first
11849 **   argument passed to this function is a pointer to an Fts5Tokenizer object
11850 **   returned by an earlier call to xCreate().
11851 **
11852 **   The second argument indicates the reason that FTS5 is requesting
11853 **   tokenization of the supplied text. This is always one of the following
11854 **   four values:
11855 **
11856 **   &lt;ul&gt;&lt;li&gt; &lt;b&gt;FTS5_TOKENIZE_DOCUMENT&lt;/b&gt; - A document is being inserted into
11857 **            or removed from the FTS table. The tokenizer is being invoked to
11858 **            determine the set of tokens to add to (or delete from) the
11859 **            FTS index.
11860 **
11861 **       &lt;li&gt; &lt;b&gt;FTS5_TOKENIZE_QUERY&lt;/b&gt; - A MATCH query is being executed
11862 **            against the FTS index. The tokenizer is being called to tokenize
11863 **            a bareword or quoted string specified as part of the query.
11864 **
11865 **       &lt;li&gt; &lt;b&gt;(FTS5_TOKENIZE_QUERY | FTS5_TOKENIZE_PREFIX)&lt;/b&gt; - Same as
11866 **            FTS5_TOKENIZE_QUERY, except that the bareword or quoted string is
11867 **            followed by a &quot;*&quot; character, indicating that the last token
11868 **            returned by the tokenizer will be treated as a token prefix.
11869 **
11870 **       &lt;li&gt; &lt;b&gt;FTS5_TOKENIZE_AUX&lt;/b&gt; - The tokenizer is being invoked to
11871 **            satisfy an fts5_api.xTokenize() request made by an auxiliary
11872 **            function. Or an fts5_api.xColumnSize() request made by the same
11873 **            on a columnsize=0 database.
11874 **   &lt;/ul&gt;
11875 **
11876 **   For each token in the input string, the supplied callback xToken() must
11877 **   be invoked. The first argument to it should be a copy of the pointer
11878 **   passed as the second argument to xTokenize(). The third and fourth
11879 **   arguments are a pointer to a buffer containing the token text, and the
11880 **   size of the token in bytes. The 4th and 5th arguments are the byte offsets
11881 **   of the first byte of and first byte immediately following the text from
11882 **   which the token is derived within the input.
11883 **
11884 **   The second argument passed to the xToken() callback (&quot;tflags&quot;) should
11885 **   normally be set to 0. The exception is if the tokenizer supports
11886 **   synonyms. In this case see the discussion below for details.
11887 **
11888 **   FTS5 assumes the xToken() callback is invoked for each token in the
11889 **   order that they occur within the input text.
11890 **
11891 **   If an xToken() callback returns any value other than SQLITE_OK, then
11892 **   the tokenization should be abandoned and the xTokenize() method should
11893 **   immediately return a copy of the xToken() return value. Or, if the
11894 **   input buffer is exhausted, xTokenize() should return SQLITE_OK. Finally,
11895 **   if an error occurs with the xTokenize() implementation itself, it
11896 **   may abandon the tokenization and return any error code other than
11897 **   SQLITE_OK or SQLITE_DONE.
11898 **
11899 ** SYNONYM SUPPORT
11900 **
11901 **   Custom tokenizers may also support synonyms. Consider a case in which a
11902 **   user wishes to query for a phrase such as &quot;first place&quot;. Using the
11903 **   built-in tokenizers, the FTS5 query &#39;first + place&#39; will match instances
11904 **   of &quot;first place&quot; within the document set, but not alternative forms
11905 **   such as &quot;1st place&quot;. In some applications, it would be better to match
11906 **   all instances of &quot;first place&quot; or &quot;1st place&quot; regardless of which form
11907 **   the user specified in the MATCH query text.
11908 **
11909 **   There are several ways to approach this in FTS5:
11910 **
<a name="104" id="anc104"></a><span class="line-modified">11911 **   &lt;ol&gt;&lt;li&gt; By mapping all synonyms to a single token. In this case, using</span>
<span class="line-modified">11912 **            the above example, this means that the tokenizer returns the</span>
11913 **            same token for inputs &quot;first&quot; and &quot;1st&quot;. Say that token is in
11914 **            fact &quot;first&quot;, so that when the user inserts the document &quot;I won
11915 **            1st place&quot; entries are added to the index for tokens &quot;i&quot;, &quot;won&quot;,
11916 **            &quot;first&quot; and &quot;place&quot;. If the user then queries for &#39;1st + place&#39;,
11917 **            the tokenizer substitutes &quot;first&quot; for &quot;1st&quot; and the query works
11918 **            as expected.
11919 **
11920 **       &lt;li&gt; By querying the index for all synonyms of each query term
11921 **            separately. In this case, when tokenizing query text, the
11922 **            tokenizer may provide multiple synonyms for a single term
11923 **            within the document. FTS5 then queries the index for each
11924 **            synonym individually. For example, faced with the query:
11925 **
11926 **   &lt;codeblock&gt;
11927 **     ... MATCH &#39;first place&#39;&lt;/codeblock&gt;
11928 **
11929 **            the tokenizer offers both &quot;1st&quot; and &quot;first&quot; as synonyms for the
11930 **            first token in the MATCH query and FTS5 effectively runs a query
11931 **            similar to:
11932 **
11933 **   &lt;codeblock&gt;
11934 **     ... MATCH &#39;(first OR 1st) place&#39;&lt;/codeblock&gt;
11935 **
11936 **            except that, for the purposes of auxiliary functions, the query
11937 **            still appears to contain just two phrases - &quot;(first OR 1st)&quot;
11938 **            being treated as a single phrase.
11939 **
11940 **       &lt;li&gt; By adding multiple synonyms for a single term to the FTS index.
11941 **            Using this method, when tokenizing document text, the tokenizer
11942 **            provides multiple synonyms for each token. So that when a
11943 **            document such as &quot;I won first place&quot; is tokenized, entries are
11944 **            added to the FTS index for &quot;i&quot;, &quot;won&quot;, &quot;first&quot;, &quot;1st&quot; and
11945 **            &quot;place&quot;.
11946 **
11947 **            This way, even if the tokenizer does not provide synonyms
11948 **            when tokenizing query text (it should not - to do so would be
11949 **            inefficient), it doesn&#39;t matter if the user queries for
11950 **            &#39;first + place&#39; or &#39;1st + place&#39;, as there are entries in the
11951 **            FTS index corresponding to both forms of the first token.
11952 **   &lt;/ol&gt;
11953 **
11954 **   Whether it is parsing document or query text, any call to xToken that
11955 **   specifies a &lt;i&gt;tflags&lt;/i&gt; argument with the FTS5_TOKEN_COLOCATED bit
11956 **   is considered to supply a synonym for the previous token. For example,
11957 **   when parsing the document &quot;I won first place&quot;, a tokenizer that supports
11958 **   synonyms would call xToken() 5 times, as follows:
11959 **
11960 **   &lt;codeblock&gt;
11961 **       xToken(pCtx, 0, &quot;i&quot;,                      1,  0,  1);
11962 **       xToken(pCtx, 0, &quot;won&quot;,                    3,  2,  5);
11963 **       xToken(pCtx, 0, &quot;first&quot;,                  5,  6, 11);
11964 **       xToken(pCtx, FTS5_TOKEN_COLOCATED, &quot;1st&quot;, 3,  6, 11);
11965 **       xToken(pCtx, 0, &quot;place&quot;,                  5, 12, 17);
11966 **&lt;/codeblock&gt;
11967 **
11968 **   It is an error to specify the FTS5_TOKEN_COLOCATED flag the first time
11969 **   xToken() is called. Multiple synonyms may be specified for a single token
11970 **   by making multiple calls to xToken(FTS5_TOKEN_COLOCATED) in sequence.
11971 **   There is no limit to the number of synonyms that may be provided for a
11972 **   single token.
11973 **
11974 **   In many cases, method (1) above is the best approach. It does not add
11975 **   extra data to the FTS index or require FTS5 to query for multiple terms,
11976 **   so it is efficient in terms of disk space and query speed. However, it
11977 **   does not support prefix queries very well. If, as suggested above, the
11978 **   token &quot;first&quot; is substituted for &quot;1st&quot; by the tokenizer, then the query:
11979 **
11980 **   &lt;codeblock&gt;
11981 **     ... MATCH &#39;1s*&#39;&lt;/codeblock&gt;
11982 **
11983 **   will not match documents that contain the token &quot;1st&quot; (as the tokenizer
11984 **   will probably not map &quot;1s&quot; to any prefix of &quot;first&quot;).
11985 **
11986 **   For full prefix support, method (3) may be preferred. In this case,
11987 **   because the index contains entries for both &quot;first&quot; and &quot;1st&quot;, prefix
11988 **   queries such as &#39;fi*&#39; or &#39;1s*&#39; will match correctly. However, because
11989 **   extra entries are added to the FTS index, this method uses more space
11990 **   within the database.
11991 **
11992 **   Method (2) offers a midpoint between (1) and (3). Using this method,
11993 **   a query such as &#39;1s*&#39; will match documents that contain the literal
11994 **   token &quot;1st&quot;, but not &quot;first&quot; (assuming the tokenizer is not able to
11995 **   provide synonyms for prefixes). However, a non-prefix query like &#39;1st&#39;
11996 **   will match against &quot;1st&quot; and &quot;first&quot;. This method does not require
11997 **   extra disk space, as no extra entries are added to the FTS index.
11998 **   On the other hand, it may require more CPU cycles to run MATCH queries,
11999 **   as separate queries of the FTS index are required for each synonym.
12000 **
12001 **   When using methods (2) or (3), it is important that the tokenizer only
12002 **   provide synonyms when tokenizing document text (method (2)) or query
12003 **   text (method (3)), not both. Doing so will not cause any errors, but is
12004 **   inefficient.
12005 */
12006 typedef struct Fts5Tokenizer Fts5Tokenizer;
12007 typedef struct fts5_tokenizer fts5_tokenizer;
12008 struct fts5_tokenizer {
12009   int (*xCreate)(void*, const char **azArg, int nArg, Fts5Tokenizer **ppOut);
12010   void (*xDelete)(Fts5Tokenizer*);
12011   int (*xTokenize)(Fts5Tokenizer*,
12012       void *pCtx,
12013       int flags,            /* Mask of FTS5_TOKENIZE_* flags */
12014       const char *pText, int nText,
12015       int (*xToken)(
12016         void *pCtx,         /* Copy of 2nd argument to xTokenize() */
12017         int tflags,         /* Mask of FTS5_TOKEN_* flags */
12018         const char *pToken, /* Pointer to buffer containing token */
12019         int nToken,         /* Size of token in bytes */
12020         int iStart,         /* Byte offset of token within input text */
12021         int iEnd            /* Byte offset of end of token within input text */
12022       )
12023   );
12024 };
12025 
12026 /* Flags that may be passed as the third argument to xTokenize() */
12027 #define FTS5_TOKENIZE_QUERY     0x0001
12028 #define FTS5_TOKENIZE_PREFIX    0x0002
12029 #define FTS5_TOKENIZE_DOCUMENT  0x0004
12030 #define FTS5_TOKENIZE_AUX       0x0008
12031 
12032 /* Flags that may be passed by the tokenizer implementation back to FTS5
12033 ** as the third argument to the supplied xToken callback. */
12034 #define FTS5_TOKEN_COLOCATED    0x0001      /* Same position as prev. token */
12035 
12036 /*
12037 ** END OF CUSTOM TOKENIZERS
12038 *************************************************************************/
12039 
12040 /*************************************************************************
12041 ** FTS5 EXTENSION REGISTRATION API
12042 */
12043 typedef struct fts5_api fts5_api;
12044 struct fts5_api {
12045   int iVersion;                   /* Currently always set to 2 */
12046 
12047   /* Create a new tokenizer */
12048   int (*xCreateTokenizer)(
12049     fts5_api *pApi,
12050     const char *zName,
12051     void *pContext,
12052     fts5_tokenizer *pTokenizer,
12053     void (*xDestroy)(void*)
12054   );
12055 
12056   /* Find an existing tokenizer */
12057   int (*xFindTokenizer)(
12058     fts5_api *pApi,
12059     const char *zName,
12060     void **ppContext,
12061     fts5_tokenizer *pTokenizer
12062   );
12063 
12064   /* Create a new auxiliary function */
12065   int (*xCreateFunction)(
12066     fts5_api *pApi,
12067     const char *zName,
12068     void *pContext,
12069     fts5_extension_function xFunction,
12070     void (*xDestroy)(void*)
12071   );
12072 };
12073 
12074 /*
12075 ** END OF REGISTRATION API
12076 *************************************************************************/
12077 
12078 #ifdef __cplusplus
12079 }  /* end of the &#39;extern &quot;C&quot;&#39; block */
12080 #endif
12081 
12082 #endif /* _FTS5_H */
12083 
12084 /******** End of fts5.h *********/
<a name="105" id="anc105"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="105" type="hidden" />
</body>
</html>