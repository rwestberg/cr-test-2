<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames doc/building.md</title>
    <link rel="stylesheet" href="../style.css" />
    <script type="text/javascript" src="../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 % Building the JDK
   2 
   3 ## TL;DR (Instructions for the Impatient)
   4 
   5 If you are eager to try out building the JDK, these simple steps works most of
   6 the time. They assume that you have installed Mercurial (and Cygwin if running
   7 on Windows) and cloned the top-level JDK repository that you want to build.
   8 
   9  1. [Get the complete source code](#getting-the-source-code): \
  10     `hg clone http://hg.openjdk.java.net/jdk/jdk`
  11 
  12  2. [Run configure](#running-configure): \
  13     `bash configure`
  14 
  15     If `configure` fails due to missing dependencies (to either the
  16     [toolchain](#native-compiler-toolchain-requirements), [build tools](
  17     #build-tools-requirements), [external libraries](
  18     #external-library-requirements) or the [boot JDK](#boot-jdk-requirements)),
  19     most of the time it prints a suggestion on how to resolve the situation on
  20     your platform. Follow the instructions, and try running `bash configure`
  21     again.
  22 
  23  3. [Run make](#running-make): \
  24     `make images`
  25 
  26  4. Verify your newly built JDK: \
  27     `./build/*/images/jdk/bin/java -version`
  28 
  29  5. [Run basic tests](##running-tests): \
  30     `make run-test-tier1`
  31 
  32 If any of these steps failed, or if you want to know more about build
  33 requirements or build functionality, please continue reading this document.
  34 
  35 ## Introduction
  36 
  37 The JDK is a complex software project. Building it requires a certain amount of
  38 technical expertise, a fair number of dependencies on external software, and
  39 reasonably powerful hardware.
  40 
  41 If you just want to use the JDK and not build it yourself, this document is not
  42 for you. See for instance [OpenJDK installation](
  43 http://openjdk.java.net/install) for some methods of installing a prebuilt
  44 JDK.
  45 
  46 ## Getting the Source Code
  47 
  48 Make sure you are getting the correct version. As of JDK 10, the source is no
  49 longer split into separate repositories so you only need to clone one single
  50 repository. At the [OpenJDK Mercurial server](http://hg.openjdk.java.net/) you
  51 can see a list of all available repositories. If you want to build an older version,
  52 e.g. JDK 8, it is recommended that you get the `jdk8u` forest, which contains
  53 incremental updates, instead of the `jdk8` forest, which was frozen at JDK 8 GA.
  54 
  55 If you are new to Mercurial, a good place to start is the [Mercurial Beginner&#39;s
  56 Guide](http://www.mercurial-scm.org/guide). The rest of this document assumes a
  57 working knowledge of Mercurial.
  58 
  59 ### Special Considerations
  60 
  61 For a smooth building experience, it is recommended that you follow these rules
  62 on where and how to check out the source code.
  63 
  64   * Do not check out the source code in a path which contains spaces. Chances
  65     are the build will not work. This is most likely to be an issue on Windows
  66     systems.
  67 
  68   * Do not check out the source code in a path which has a very long name or is
  69     nested many levels deep. Chances are you will hit an OS limitation during
  70     the build.
  71 
  72   * Put the source code on a local disk, not a network share. If possible, use
  73     an SSD. The build process is very disk intensive, and having slow disk
  74     access will significantly increase build times. If you need to use a
  75     network share for the source code, see below for suggestions on how to keep
  76     the build artifacts on a local disk.
  77 
  78   * On Windows, if using [Cygwin](#cygwin), extra care must be taken to make sure
  79     the environment is consistent. It is recommended that you follow this
  80     procedure:
  81 
  82       * Create the directory that is going to contain the top directory of the
  83         JDK clone by using the `mkdir` command in the Cygwin bash shell.
  84         That is, do *not* create it using Windows Explorer. This will ensure
  85         that it will have proper Cygwin attributes, and that it&#39;s children will
  86         inherit those attributes.
  87 
  88       * Do not put the JDK clone in a path under your Cygwin home
  89         directory. This is especially important if your user name contains
  90         spaces and/or mixed upper and lower case letters.
  91 
  92       * Clone the JDK repository using the Cygwin command line `hg` client
  93         as instructed in this document. That is, do *not* use another Mercurial
  94         client such as TortoiseHg.
  95 
  96     Failure to follow this procedure might result in hard-to-debug build
  97     problems.
  98 
  99 ## Build Hardware Requirements
 100 
 101 The JDK is a massive project, and require machines ranging from decent to
 102 powerful to be able to build in a reasonable amount of time, or to be able to
 103 complete a build at all.
 104 
 105 We *strongly* recommend usage of an SSD disk for the build, since disk speed is
 106 one of the limiting factors for build performance.
 107 
 108 ### Building on x86
 109 
 110 At a minimum, a machine with 2-4 cores is advisable, as well as 2-4 GB of RAM.
 111 (The more cores to use, the more memory you need.) At least 6 GB of free disk
 112 space is required (8 GB minimum for building on Solaris).
 113 
 114 Even for 32-bit builds, it is recommended to use a 64-bit build machine, and
 115 instead create a 32-bit target using `--with-target-bits=32`.
 116 
 117 ### Building on sparc
 118 
 119 At a minimum, a machine with 4 cores is advisable, as well as 4 GB of RAM. (The
 120 more cores to use, the more memory you need.) At least 8 GB of free disk space
 121 is required.
 122 
 123 Note: The sparc port is deprecated.
 124 
 125 ### Building on aarch64
 126 
 127 At a minimum, a machine with 8 cores is advisable, as well as 8 GB of RAM.
 128 (The more cores to use, the more memory you need.) At least 6 GB of free disk
 129 space is required.
 130 
 131 If you do not have access to sufficiently powerful hardware, it is also
 132 possible to use [cross-compiling](#cross-compiling).
 133 
 134 ### Building on 32-bit arm
 135 
 136 This is not recommended. Instead, see the section on [Cross-compiling](
 137 #cross-compiling).
 138 
 139 ## Operating System Requirements
 140 
 141 The mainline JDK project supports Linux, Solaris, macOS, AIX and Windows.
 142 Support for other operating system, e.g. BSD, exists in separate &quot;port&quot;
 143 projects.
 144 
 145 In general, the JDK can be built on a wide range of versions of these operating
 146 systems, but the further you deviate from what is tested on a daily basis, the
 147 more likely you are to run into problems.
 148 
 149 This table lists the OS versions used by Oracle when building the JDK. Such
 150 information is always subject to change, but this table is up to date at the
 151 time of writing.
 152 
 153  Operating system   Vendor/version used
 154  -----------------  -------------------------------------------------------
 155  Linux              Oracle Enterprise Linux 6.4 / 7.6
 156  Solaris            Solaris 11.3 SRU 20
 157  macOS              Mac OS X 10.13 (High Sierra)
 158  Windows            Windows Server 2012 R2
 159 
 160 The double version numbers for Linux and Solaris are due to the hybrid model
 161 used at Oracle, where header files and external libraries from an older version
 162 are used when building on a more modern version of the OS.
 163 
 164 The Build Group has a wiki page with [Supported Build Platforms](
 165 https://wiki.openjdk.java.net/display/Build/Supported+Build+Platforms). From
 166 time to time, this is updated by contributors to list successes or failures of
 167 building on different platforms.
 168 
 169 ### Windows
 170 
 171 Windows XP is not a supported platform, but all newer Windows should be able to
 172 build the JDK.
 173 
 174 On Windows, it is important that you pay attention to the instructions in the
 175 [Special Considerations](#special-considerations).
 176 
 177 Windows is the only non-POSIX OS supported by the JDK, and as such, requires
 178 some extra care. A POSIX support layer is required to build on Windows.
 179 Currently, the only supported such layers are Cygwin and Windows Subsystem for
 180 Linux (WSL). (Msys is no longer supported due to a too old bash; msys2 would
 181 likely be possible to support in a future version but that would require effort
 182 to implement.)
 183 
 184 Internally in the build system, all paths are represented as Unix-style paths,
 185 e.g. `/cygdrive/c/hg/jdk9/Makefile` rather than `C:\hg\jdk9\Makefile`. This
 186 rule also applies to input to the build system, e.g. in arguments to
 187 `configure`. So, use `--with-msvcr-dll=/cygdrive/c/msvcr100.dll` rather than
 188 `--with-msvcr-dll=c:\msvcr100.dll`. For details on this conversion, see the section
 189 on [Fixpath](#fixpath).
 190 
 191 #### Cygwin
 192 
 193 A functioning [Cygwin](http://www.cygwin.com/) environment is required for
 194 building the JDK on Windows. If you have a 64-bit OS, we strongly recommend
 195 using the 64-bit version of Cygwin.
 196 
 197 **Note:** Cygwin has a model of continuously updating all packages without any
 198 easy way to install or revert to a specific version of a package. This means
 199 that whenever you add or update a package in Cygwin, you might (inadvertently)
 200 update tools that are used by the JDK build process, and that can cause
 201 unexpected build problems.
 202 
 203 The JDK requires GNU Make 4.0 or greater in Cygwin. This is usually not a
 204 problem, since Cygwin currently only distributes GNU Make at a version above
 205 4.0.
 206 
 207 Apart from the basic Cygwin installation, the following packages must also be
 208 installed:
 209 
 210   * `autoconf`
 211   * `make`
 212   * `zip`
 213   * `unzip`
 214 
 215 Often, you can install these packages using the following command line:
 216 ```
 217 &lt;path to Cygwin setup&gt;/setup-x86_64 -q -P autoconf -P make -P unzip -P zip
 218 ```
 219 
 220 Unfortunately, Cygwin can be unreliable in certain circumstances. If you
 221 experience build tool crashes or strange issues when building on Windows,
 222 please check the Cygwin FAQ on the [&quot;BLODA&quot; list](
 223 https://cygwin.com/faq/faq.html#faq.using.bloda) and the section on [fork()
 224 failures](https://cygwin.com/faq/faq.html#faq.using.fixing-fork-failures).
 225 
 226 #### Windows Subsystem for Linux (WSL)
 227 
 228 Windows 10 1809 or newer is supported due to a dependency on the wslpath utility
 229 and support for environment variable sharing through WSLENV. Version 1803 can
 230 work but intermittent build failures have been observed.
 231 
 232 It&#39;s possible to build both Windows and Linux binaries from WSL. To build
 233 Windows binaries, you must use a Windows boot JDK (located in a
 234 Windows-accessible directory). To build Linux binaries, you must use a Linux
 235 boot JDK. The default behavior is to build for Windows. To build for Linux, pass
 236 `--build=x86_64-unknown-linux-gnu --host=x86_64-unknown-linux-gnu` to
 237 `configure`.
 238 
 239 If building Windows binaries, the source code must be located in a Windows-
 240 accessible directory. This is because Windows executables (such as Visual Studio
 241 and the boot JDK) must be able to access the source code. Also, the drive where
 242 the source is stored must be mounted as case-insensitive by changing either
 243 /etc/fstab or /etc/wsl.conf in WSL. Individual directories may be corrected
 244 using the fsutil tool in case the source was cloned before changing the mount
 245 options.
 246 
 247 Note that while it&#39;s possible to build on WSL, testing is still not fully
 248 supported.
 249 
 250 ### Solaris
 251 
 252 See `make/devkit/solaris11.1-package-list.txt` for a list of recommended
 253 packages to install when building on Solaris. The versions specified in this
 254 list is the versions used by the daily builds at Oracle, and is likely to work
 255 properly.
 256 
 257 Older versions of Solaris shipped a broken version of `objcopy`. At least
 258 version 2.21.1 is needed, which is provided by Solaris 11 Update 1. Objcopy is
 259 needed if you want to have external debug symbols. Please make sure you are
 260 using at least version 2.21.1 of objcopy, or that you disable external debug
 261 symbols.
 262 
 263 Note: The Solaris port is deprecated.
 264 
 265 ### macOS
 266 
 267 Apple is using a quite aggressive scheme of pushing OS updates, and coupling
 268 these updates with required updates of Xcode. Unfortunately, this makes it
 269 difficult for a project such as the JDK to keep pace with a continuously updated
 270 machine running macOS. See the section on [Apple Xcode](#apple-xcode) on some
 271 strategies to deal with this.
 272 
 273 It is recommended that you use at least Mac OS X 10.13 (High Sierra). At the time
 274 of writing, the JDK has been successfully compiled on macOS 10.12 (Sierra).
 275 
 276 The standard macOS environment contains the basic tooling needed to build, but
 277 for external libraries a package manager is recommended. The JDK uses
 278 [homebrew](https://brew.sh/) in the examples, but feel free to use whatever
 279 manager you want (or none).
 280 
 281 ### Linux
 282 
 283 It is often not much problem to build the JDK on Linux. The only general advice
 284 is to try to use the compilers, external libraries and header files as provided
 285 by your distribution.
 286 
 287 The basic tooling is provided as part of the core operating system, but you
 288 will most likely need to install developer packages.
 289 
 290 For apt-based distributions (Debian, Ubuntu, etc), try this:
 291 ```
 292 sudo apt-get install build-essential
 293 ```
 294 
 295 For rpm-based distributions (Fedora, Red Hat, etc), try this:
 296 ```
 297 sudo yum groupinstall &quot;Development Tools&quot;
 298 ```
 299 
 300 ### AIX
 301 
 302 Please consult the AIX section of the [Supported Build Platforms](
 303 https://wiki.openjdk.java.net/display/Build/Supported+Build+Platforms) OpenJDK
 304 Build Wiki page for details about which versions of AIX are supported.
 305 
 306 ## Native Compiler (Toolchain) Requirements
 307 
 308 Large portions of the JDK consists of native code, that needs to be compiled to
 309 be able to run on the target platform. In theory, toolchain and operating
 310 system should be independent factors, but in practice there&#39;s more or less a
 311 one-to-one correlation between target operating system and toolchain.
 312 
 313  Operating system   Supported toolchain
 314  ------------------ -------------------------
 315  Linux              gcc, clang
 316  macOS              Apple Xcode (using clang)
 317  Solaris            Oracle Solaris Studio
 318  AIX                IBM XL C/C++
 319  Windows            Microsoft Visual Studio
 320 
 321 Please see the individual sections on the toolchains for version
 322 recommendations. As a reference, these versions of the toolchains are used, at
 323 the time of writing, by Oracle for the daily builds of the JDK. It should be
 324 possible to compile the JDK with both older and newer versions, but the closer
 325 you stay to this list, the more likely you are to compile successfully without
 326 issues.
 327 
 328  Operating system   Toolchain version
 329  ------------------ -------------------------------------------------------
 330  Linux              gcc 8.3.0
 331  macOS              Apple Xcode 10.1 (using clang 10.0.0)
 332  Solaris            Oracle Solaris Studio 12.6 (with compiler version 5.15)
 333  Windows            Microsoft Visual Studio 2017 update 15.9.16
 334 
 335 All compilers are expected to be able to compile to the C99 language standard,
 336 as some C99 features are used in the source code. Microsoft Visual Studio
 337 doesn&#39;t fully support C99 so in practice shared code is limited to using C99
 338 features that it does support.
 339 
 340 ### gcc
 341 
<a name="1" id="anc1"></a><span class="line-modified"> 342 The minimum accepted version of gcc is 4.8. Older versions will generate a warning</span>
 343 by `configure` and are unlikely to work.
 344 
 345 The JDK is currently known to be able to compile with at least version 8.3 of
 346 gcc.
 347 
 348 In general, any version between these two should be usable.
 349 
 350 ### clang
 351 
 352 The minimum accepted version of clang is 3.2. Older versions will not be
 353 accepted by `configure`.
 354 
 355 To use clang instead of gcc on Linux, use `--with-toolchain-type=clang`.
 356 
 357 ### Apple Xcode
 358 
 359 The oldest supported version of Xcode is 8.
 360 
 361 You will need the Xcode command lines developers tools to be able to build
 362 the JDK. (Actually, *only* the command lines tools are needed, not the IDE.)
 363 The simplest way to install these is to run:
 364 ```
 365 xcode-select --install
 366 ```
 367 
 368 It is advisable to keep an older version of Xcode for building the JDK when
 369 updating Xcode. This [blog page](
 370 http://iosdevelopertips.com/xcode/install-multiple-versions-of-xcode.html) has
 371 good suggestions on managing multiple Xcode versions. To use a specific version
 372 of Xcode, use `xcode-select -s` before running `configure`, or use
 373 `--with-toolchain-path` to point to the version of Xcode to use, e.g.
 374 `configure --with-toolchain-path=/Applications/Xcode8.app/Contents/Developer/usr/bin`
 375 
 376 If you have recently (inadvertently) updated your OS and/or Xcode version, and
 377 the JDK can no longer be built, please see the section on [Problems with the
 378 Build Environment](#problems-with-the-build-environment), and [Getting
 379 Help](#getting-help) to find out if there are any recent, non-merged patches
 380 available for this update.
 381 
 382 ### Oracle Solaris Studio
 383 
 384 The minimum accepted version of the Solaris Studio compilers is 5.13
 385 (corresponding to Solaris Studio 12.4). Older versions will not be accepted by
 386 configure.
 387 
 388 The Solaris Studio installation should contain at least these packages:
 389 
 390  Package                                            Version
 391  -------------------------------------------------- -------------
 392  developer/solarisstudio-124/backend                12.4-1.0.6.0
 393  developer/solarisstudio-124/c++                    12.4-1.0.10.0
 394  developer/solarisstudio-124/cc                     12.4-1.0.4.0
 395  developer/solarisstudio-124/library/c++-libs       12.4-1.0.10.0
 396  developer/solarisstudio-124/library/math-libs      12.4-1.0.0.1
 397  developer/solarisstudio-124/library/studio-gccrt   12.4-1.0.0.1
 398  developer/solarisstudio-124/studio-common          12.4-1.0.0.1
 399  developer/solarisstudio-124/studio-ja              12.4-1.0.0.1
 400  developer/solarisstudio-124/studio-legal           12.4-1.0.0.1
 401  developer/solarisstudio-124/studio-zhCN            12.4-1.0.0.1
 402 
 403 Compiling with Solaris Studio can sometimes be finicky. This is the exact
 404 version used by Oracle, which worked correctly at the time of writing:
 405 ```
 406 $ cc -V
 407 cc: Sun C 5.13 SunOS_i386 2014/10/20
 408 $ CC -V
 409 CC: Sun C++ 5.13 SunOS_i386 151846-10 2015/10/30
 410 ```
 411 
 412 ### Microsoft Visual Studio
 413 
 414 The minimum accepted version of Visual Studio is 2010. Older versions will not
 415 be accepted by `configure`. The maximum accepted version of Visual Studio is
 416 2019. Versions older than 2017 are unlikely to continue working for long.
 417 
 418 If you have multiple versions of Visual Studio installed, `configure` will by
 419 default pick the latest. You can request a specific version to be used by
 420 setting `--with-toolchain-version`, e.g. `--with-toolchain-version=2015`.
 421 
 422 If you get `LINK: fatal error LNK1123: failure during conversion to COFF: file
 423 invalid` when building using Visual Studio 2010, you have encountered
 424 [KB2757355](http://support.microsoft.com/kb/2757355), a bug triggered by a
 425 specific installation order. However, the solution suggested by the KB article
 426 does not always resolve the problem. See [this stackoverflow discussion](
 427 https://stackoverflow.com/questions/10888391) for other suggestions.
 428 
 429 ### IBM XL C/C++
 430 
 431 Please consult the AIX section of the [Supported Build Platforms](
 432 https://wiki.openjdk.java.net/display/Build/Supported+Build+Platforms) OpenJDK
 433 Build Wiki page for details about which versions of XLC are supported.
 434 
 435 
 436 ## Boot JDK Requirements
 437 
 438 Paradoxically, building the JDK requires a pre-existing JDK. This is called the
 439 &quot;boot JDK&quot;. The boot JDK does not, however, have to be a JDK built directly from
 440 the source code available in the OpenJDK Community.  If you are porting the JDK
 441 to a new platform, chances are that there already exists another JDK for that
 442 platform that is usable as boot JDK.
 443 
 444 The rule of thumb is that the boot JDK for building JDK major version *N*
 445 should be a JDK of major version *N-1*, so for building JDK 9 a JDK 8 would be
 446 suitable as boot JDK. However, the JDK should be able to &quot;build itself&quot;, so an
 447 up-to-date build of the current JDK source is an acceptable alternative. If
 448 you are following the *N-1* rule, make sure you&#39;ve got the latest update
 449 version, since JDK 8 GA might not be able to build JDK 9 on all platforms.
 450 
 451 Early in the release cycle, version *N-1* may not yet have been released. In
 452 that case, the preferred boot JDK will be version *N-2* until version *N-1*
 453 is available.
 454 
 455 If the boot JDK is not automatically detected, or the wrong JDK is picked, use
 456 `--with-boot-jdk` to point to the JDK to use.
 457 
 458 ### Getting JDK binaries
 459 
 460 JDK binaries for Linux, Windows and macOS can be downloaded from
 461 [jdk.java.net](http://jdk.java.net). An alternative is to download the
 462 [Oracle JDK](http://www.oracle.com/technetwork/java/javase/downloads). Another
 463 is the [Adopt OpenJDK Project](https://adoptopenjdk.net/), which publishes
 464 experimental prebuilt binaries for various platforms.
 465 
 466 On Linux you can also get a JDK from the Linux distribution. On apt-based
 467 distros (like Debian and Ubuntu), `sudo apt-get install openjdk-&lt;VERSION&gt;-jdk`
 468 is typically enough to install a JDK \&lt;VERSION\&gt;. On rpm-based distros (like
 469 Fedora and Red Hat), try `sudo yum install java-&lt;VERSION&gt;-openjdk-devel`.
 470 
 471 ## External Library Requirements
 472 
 473 Different platforms require different external libraries. In general, libraries
 474 are not optional - that is, they are either required or not used.
 475 
 476 If a required library is not detected by `configure`, you need to provide the
 477 path to it. There are two forms of the `configure` arguments to point to an
 478 external library: `--with-&lt;LIB&gt;=&lt;path&gt;` or `--with-&lt;LIB&gt;-include=&lt;path to
 479 include&gt; --with-&lt;LIB&gt;-lib=&lt;path to lib&gt;`. The first variant is more concise,
 480 but require the include files and library files to reside in a default
 481 hierarchy under this directory. In most cases, it works fine.
 482 
 483 As a fallback, the second version allows you to point to the include directory
 484 and the lib directory separately.
 485 
 486 ### FreeType
 487 
 488 FreeType2 from [The FreeType Project](http://www.freetype.org/) is not required
 489 on any platform. The exception is on Unix-based platforms when configuring such
 490 that the build artifacts will reference a system installed library,
 491 rather than bundling the JDK&#39;s own copy.
 492 
 493   * To install on an apt-based Linux, try running `sudo apt-get install
 494     libfreetype6-dev`.
 495   * To install on an rpm-based Linux, try running `sudo yum install
 496     freetype-devel`.
 497   * To install on Solaris, try running `pkg install system/library/freetype-2`.
 498 
 499 Use `--with-freetype-include=&lt;path&gt;` and `--with-freetype-lib=&lt;path&gt;`
 500 if `configure` does not automatically locate the platform FreeType files.
 501 
 502 ### CUPS
 503 
 504 CUPS, [Common UNIX Printing System](http://www.cups.org) header files are
 505 required on all platforms, except Windows. Often these files are provided by
 506 your operating system.
 507 
 508   * To install on an apt-based Linux, try running `sudo apt-get install
 509     libcups2-dev`.
 510   * To install on an rpm-based Linux, try running `sudo yum install
 511     cups-devel`.
 512   * To install on Solaris, try running `pkg install print/cups`.
 513 
 514 Use `--with-cups=&lt;path&gt;` if `configure` does not properly locate your CUPS
 515 files.
 516 
 517 ### X11
 518 
 519 Certain [X11](http://www.x.org/) libraries and include files are required on
 520 Linux and Solaris.
 521 
 522   * To install on an apt-based Linux, try running `sudo apt-get install
 523     libx11-dev libxext-dev libxrender-dev libxrandr-dev libxtst-dev libxt-dev`.
 524   * To install on an rpm-based Linux, try running `sudo yum install
 525     libXtst-devel libXt-devel libXrender-devel libXrandr-devel libXi-devel`.
 526   * To install on Solaris, try running `pkg install x11/header/x11-protocols
 527     x11/library/libice x11/library/libpthread-stubs x11/library/libsm
 528     x11/library/libx11 x11/library/libxau x11/library/libxcb
 529     x11/library/libxdmcp x11/library/libxevie x11/library/libxext
 530     x11/library/libxrender x11/library/libxrandr x11/library/libxscrnsaver
 531     x11/library/libxtst x11/library/toolkit/libxt`.
 532 
 533 Use `--with-x=&lt;path&gt;` if `configure` does not properly locate your X11 files.
 534 
 535 ### ALSA
 536 
 537 ALSA, [Advanced Linux Sound Architecture](https://www.alsa-project.org/) is
 538 required on Linux. At least version 0.9.1 of ALSA is required.
 539 
 540   * To install on an apt-based Linux, try running `sudo apt-get install
 541     libasound2-dev`.
 542   * To install on an rpm-based Linux, try running `sudo yum install
 543     alsa-lib-devel`.
 544 
 545 Use `--with-alsa=&lt;path&gt;` if `configure` does not properly locate your ALSA
 546 files.
 547 
 548 ### libffi
 549 
 550 libffi, the [Portable Foreign Function Interface Library](
 551 http://sourceware.org/libffi) is required when building the Zero version of
 552 Hotspot.
 553 
 554   * To install on an apt-based Linux, try running `sudo apt-get install
 555     libffi-dev`.
 556   * To install on an rpm-based Linux, try running `sudo yum install
 557     libffi-devel`.
 558 
 559 Use `--with-libffi=&lt;path&gt;` if `configure` does not properly locate your libffi
 560 files.
 561 
 562 ## Build Tools Requirements
 563 
 564 ### Autoconf
 565 
 566 The JDK requires [Autoconf](http://www.gnu.org/software/autoconf) on all
 567 platforms. At least version 2.69 is required.
 568 
 569   * To install on an apt-based Linux, try running `sudo apt-get install
 570     autoconf`.
 571   * To install on an rpm-based Linux, try running `sudo yum install
 572     autoconf`.
 573   * To install on macOS, try running `brew install autoconf`.
 574   * To install on Windows, try running `&lt;path to Cygwin setup&gt;/setup-x86_64 -q
 575     -P autoconf`.
 576 
 577 If `configure` has problems locating your installation of autoconf, you can
 578 specify it using the `AUTOCONF` environment variable, like this:
 579 
 580 ```
 581 AUTOCONF=&lt;path to autoconf&gt; configure ...
 582 ```
 583 
 584 ### GNU Make
 585 
 586 The JDK requires [GNU Make](http://www.gnu.org/software/make). No other flavors
 587 of make are supported.
 588 
 589 At least version 3.81 of GNU Make must be used. For distributions supporting
 590 GNU Make 4.0 or above, we strongly recommend it. GNU Make 4.0 contains useful
 591 functionality to handle parallel building (supported by `--with-output-sync`)
 592 and speed and stability improvements.
 593 
 594 Note that `configure` locates and verifies a properly functioning version of
 595 `make` and stores the path to this `make` binary in the configuration. If you
 596 start a build using `make` on the command line, you will be using the version
 597 of make found first in your `PATH`, and not necessarily the one stored in the
 598 configuration. This initial make will be used as &quot;bootstrap make&quot;, and in a
 599 second stage, the make located by `configure` will be called. Normally, this
 600 will present no issues, but if you have a very old `make`, or a non-GNU Make
 601 `make` in your path, this might cause issues.
 602 
 603 If you want to override the default make found by `configure`, use the `MAKE`
 604 configure variable, e.g. `configure MAKE=/opt/gnu/make`.
 605 
 606 On Solaris, it is common to call the GNU version of make by using `gmake`.
 607 
 608 ### GNU Bash
 609 
 610 The JDK requires [GNU Bash](http://www.gnu.org/software/bash). No other shells
 611 are supported.
 612 
 613 At least version 3.2 of GNU Bash must be used.
 614 
 615 ## Running Configure
 616 
 617 To build the JDK, you need a &quot;configuration&quot;, which consists of a directory
 618 where to store the build output, coupled with information about the platform,
 619 the specific build machine, and choices that affect how the JDK is built.
 620 
 621 The configuration is created by the `configure` script. The basic invocation of
 622 the `configure` script looks like this:
 623 
 624 ```
 625 bash configure [options]
 626 ```
 627 
 628 This will create an output directory containing the configuration and setup an
 629 area for the build result. This directory typically looks like
 630 `build/linux-x64-server-release`, but the actual name depends on your specific
 631 configuration. (It can also be set directly, see [Using Multiple
 632 Configurations](#using-multiple-configurations)). This directory is referred to
 633 as `$BUILD` in this documentation.
 634 
 635 `configure` will try to figure out what system you are running on and where all
 636 necessary build components are. If you have all prerequisites for building
 637 installed, it should find everything. If it fails to detect any component
 638 automatically, it will exit and inform you about the problem.
 639 
 640 Some command line examples:
 641 
 642   * Create a 32-bit build for Windows with FreeType2 in `C:\freetype-i586`:
 643     ```
 644     bash configure --with-freetype=/cygdrive/c/freetype-i586 --with-target-bits=32
 645     ```
 646 
 647   * Create a debug build with the `server` JVM and DTrace enabled:
 648     ```
 649     bash configure --enable-debug --with-jvm-variants=server --enable-dtrace
 650     ```
 651 
 652 ### Common Configure Arguments
 653 
 654 Here follows some of the most common and important `configure` argument.
 655 
 656 To get up-to-date information on *all* available `configure` argument, please
 657 run:
 658 ```
 659 bash configure --help
 660 ```
 661 
 662 (Note that this help text also include general autoconf options, like
 663 `--dvidir`, that is not relevant to the JDK. To list only JDK-specific
 664 features, use `bash configure --help=short` instead.)
 665 
 666 #### Configure Arguments for Tailoring the Build
 667 
 668   * `--enable-debug` - Set the debug level to `fastdebug` (this is a shorthand
 669     for `--with-debug-level=fastdebug`)
 670   * `--with-debug-level=&lt;level&gt;` - Set the debug level, which can be `release`,
 671     `fastdebug`, `slowdebug` or `optimized`. Default is `release`. `optimized`
 672     is variant of `release` with additional Hotspot debug code.
 673   * `--with-native-debug-symbols=&lt;method&gt;` - Specify if and how native debug
 674     symbols should be built. Available methods are `none`, `internal`,
 675     `external`, `zipped`. Default behavior depends on platform. See [Native
 676     Debug Symbols](#native-debug-symbols) for more details.
 677   * `--with-version-string=&lt;string&gt;` - Specify the version string this build
 678     will be identified with.
 679   * `--with-version-&lt;part&gt;=&lt;value&gt;` - A group of options, where `&lt;part&gt;` can be
 680     any of `pre`, `opt`, `build`, `major`, `minor`, `security` or `patch`. Use
 681     these options to modify just the corresponding part of the version string
 682     from the default, or the value provided by `--with-version-string`.
 683   * `--with-jvm-variants=&lt;variant&gt;[,&lt;variant&gt;...]` - Build the specified variant
 684     (or variants) of Hotspot. Valid variants are: `server`, `client`,
 685     `minimal`, `core`, `zero`, `custom`. Note that not all
 686     variants are possible to combine in a single build.
 687   * `--with-jvm-features=&lt;feature&gt;[,&lt;feature&gt;...]` - Use the specified JVM
 688     features when building Hotspot. The list of features will be enabled on top
 689     of the default list. For the `custom` JVM variant, this default list is
 690     empty. A complete list of available JVM features can be found using `bash
 691     configure --help`.
 692   * `--with-target-bits=&lt;bits&gt;` - Create a target binary suitable for running
 693     on a `&lt;bits&gt;` platform. Use this to create 32-bit output on a 64-bit build
 694     platform, instead of doing a full cross-compile. (This is known as a
 695     *reduced* build.)
 696 
 697 On Linux, BSD and AIX, it is possible to override where Java by default
 698 searches for runtime/JNI libraries. This can be useful in situations where
 699 there is a special shared directory for system JNI libraries. This setting
 700 can in turn be overriden at runtime by setting the `java.library.path` property.
 701 
 702   * `--with-jni-libpath=&lt;path&gt;` - Use the specified path as a default
 703   when searching for runtime libraries.
 704 
 705 #### Configure Arguments for Native Compilation
 706 
 707   * `--with-devkit=&lt;path&gt;` - Use this devkit for compilers, tools and resources
 708   * `--with-sysroot=&lt;path&gt;` - Use this directory as sysroot
 709   * `--with-extra-path=&lt;path&gt;[;&lt;path&gt;]` - Prepend these directories to the
 710     default path when searching for all kinds of binaries
 711   * `--with-toolchain-path=&lt;path&gt;[;&lt;path&gt;]` - Prepend these directories when
 712     searching for toolchain binaries (compilers etc)
 713   * `--with-extra-cflags=&lt;flags&gt;` - Append these flags when compiling JDK C
 714     files
 715   * `--with-extra-cxxflags=&lt;flags&gt;` - Append these flags when compiling JDK C++
 716     files
 717   * `--with-extra-ldflags=&lt;flags&gt;` - Append these flags when linking JDK
 718     libraries
 719 
 720 #### Configure Arguments for External Dependencies
 721 
 722   * `--with-boot-jdk=&lt;path&gt;` - Set the path to the [Boot JDK](
 723     #boot-jdk-requirements)
 724   * `--with-freetype=&lt;path&gt;` - Set the path to [FreeType](#freetype)
 725   * `--with-cups=&lt;path&gt;` - Set the path to [CUPS](#cups)
 726   * `--with-x=&lt;path&gt;` - Set the path to [X11](#x11)
 727   * `--with-alsa=&lt;path&gt;` - Set the path to [ALSA](#alsa)
 728   * `--with-libffi=&lt;path&gt;` - Set the path to [libffi](#libffi)
 729   * `--with-jtreg=&lt;path&gt;` - Set the path to JTReg. See [Running Tests](
 730     #running-tests)
 731 
 732 Certain third-party libraries used by the JDK (libjpeg, giflib, libpng, lcms
 733 and zlib) are included in the JDK repository. The default behavior of the
 734 JDK build is to use the included (&quot;bundled&quot;) versions of libjpeg, giflib,
 735 libpng and lcms.
 736 For zlib, the system lib (if present) is used except on Windows and AIX.
 737 However the bundled libraries may be replaced by an external version.
 738 To do so, specify `system` as the `&lt;source&gt;` option in these arguments.
 739 (The default is `bundled`).
 740 
 741   * `--with-libjpeg=&lt;source&gt;` - Use the specified source for libjpeg
 742   * `--with-giflib=&lt;source&gt;` - Use the specified source for giflib
 743   * `--with-libpng=&lt;source&gt;` - Use the specified source for libpng
 744   * `--with-lcms=&lt;source&gt;` - Use the specified source for lcms
 745   * `--with-zlib=&lt;source&gt;` - Use the specified source for zlib
 746 
 747 On Linux, it is possible to select either static or dynamic linking of the C++
 748 runtime. The default is static linking, with dynamic linking as fallback if the
 749 static library is not found.
 750 
 751   * `--with-stdc++lib=&lt;method&gt;` - Use the specified method (`static`, `dynamic`
 752     or `default`) for linking the C++ runtime.
 753 
 754 ### Configure Control Variables
 755 
 756 It is possible to control certain aspects of `configure` by overriding the
 757 value of `configure` variables, either on the command line or in the
 758 environment.
 759 
 760 Normally, this is **not recommended**. If used improperly, it can lead to a
 761 broken configuration. Unless you&#39;re well versed in the build system, this is
 762 hard to use properly. Therefore, `configure` will print a warning if this is
 763 detected.
 764 
 765 However, there are a few `configure` variables, known as *control variables*
 766 that are supposed to be overriden on the command line. These are variables that
 767 describe the location of tools needed by the build, like `MAKE` or `GREP`. If
 768 any such variable is specified, `configure` will use that value instead of
 769 trying to autodetect the tool. For instance, `bash configure
 770 MAKE=/opt/gnumake4.0/bin/make`.
 771 
 772 If a configure argument exists, use that instead, e.g. use `--with-jtreg`
 773 instead of setting `JTREGEXE`.
 774 
 775 Also note that, despite what autoconf claims, setting `CFLAGS` will not
 776 accomplish anything. Instead use `--with-extra-cflags` (and similar for
 777 `cxxflags` and `ldflags`).
 778 
 779 ## Running Make
 780 
 781 When you have a proper configuration, all you need to do to build the JDK is to
 782 run `make`. (But see the warning at [GNU Make](#gnu-make) about running the
 783 correct version of make.)
 784 
 785 When running `make` without any arguments, the default target is used, which is
 786 the same as running `make default` or `make jdk`. This will build a minimal (or
 787 roughly minimal) set of compiled output (known as an &quot;exploded image&quot;) needed
 788 for a developer to actually execute the newly built JDK. The idea is that in an
 789 incremental development fashion, when doing a normal make, you should only
 790 spend time recompiling what&#39;s changed (making it purely incremental) and only
 791 do the work that&#39;s needed to actually run and test your code.
 792 
 793 The output of the exploded image resides in `$BUILD/jdk`. You can test the
 794 newly built JDK like this: `$BUILD/jdk/bin/java -version`.
 795 
 796 ### Common Make Targets
 797 
 798 Apart from the default target, here are some common make targets:
 799 
 800   * `hotspot` - Build all of hotspot (but only hotspot)
 801   * `hotspot-&lt;variant&gt;` - Build just the specified jvm variant
 802   * `images` or `product-images` - Build the JDK image
 803   * `docs` or `docs-image` - Build the documentation image
 804   * `test-image` - Build the test image
 805   * `all` or `all-images` - Build all images (product, docs and test)
 806   * `bootcycle-images` - Build images twice, second time with newly built JDK
 807     (good for testing)
 808   * `clean` - Remove all files generated by make, but not those generated by
 809     configure
 810   * `dist-clean` - Remove all files, including configuration
 811 
 812 Run `make help` to get an up-to-date list of important make targets and make
 813 control variables.
 814 
 815 It is possible to build just a single module, a single phase, or a single phase
 816 of a single module, by creating make targets according to these followin
 817 patterns. A phase can be either of `gensrc`, `gendata`, `copy`, `java`,
 818 `launchers`, `libs` or `rmic`. See [Using Fine-Grained Make Targets](
 819 #using-fine-grained-make-targets) for more details about this functionality.
 820 
 821   * `&lt;phase&gt;` - Build the specified phase and everything it depends on
 822   * `&lt;module&gt;` - Build the specified module and everything it depends on
 823   * `&lt;module&gt;-&lt;phase&gt;` - Compile the specified phase for the specified module
 824     and everything it depends on
 825 
 826 Similarly, it is possible to clean just a part of the build by creating make
 827 targets according to these patterns:
 828 
 829   * `clean-&lt;outputdir&gt;` - Remove the subdir in the output dir with the name
 830   * `clean-&lt;phase&gt;` - Remove all build results related to a certain build
 831     phase
 832   * `clean-&lt;module&gt;` - Remove all build results related to a certain module
 833   * `clean-&lt;module&gt;-&lt;phase&gt;` - Remove all build results related to a certain
 834     module and phase
 835 
 836 ### Make Control Variables
 837 
 838 It is possible to control `make` behavior by overriding the value of `make`
 839 variables, either on the command line or in the environment.
 840 
 841 Normally, this is **not recommended**. If used improperly, it can lead to a
 842 broken build. Unless you&#39;re well versed in the build system, this is hard to
 843 use properly. Therefore, `make` will print a warning if this is detected.
 844 
 845 However, there are a few `make` variables, known as *control variables* that
 846 are supposed to be overriden on the command line. These make up the &quot;make time&quot;
 847 configuration, as opposed to the &quot;configure time&quot; configuration.
 848 
 849 #### General Make Control Variables
 850 
 851   * `JOBS` - Specify the number of jobs to build with. See [Build
 852     Performance](#build-performance).
 853   * `LOG` - Specify the logging level and functionality. See [Checking the
 854     Build Log File](#checking-the-build-log-file)
 855   * `CONF` and `CONF_NAME` - Selecting the configuration(s) to use. See [Using
 856     Multiple Configurations](#using-multiple-configurations)
 857 
 858 #### Test Make Control Variables
 859 
 860 These make control variables only make sense when running tests. Please see
 861 [Testing the JDK](testing.html) for details.
 862 
 863   * `TEST`
 864   * `TEST_JOBS`
 865   * `JTREG`
 866   * `GTEST`
 867 
 868 #### Advanced Make Control Variables
 869 
 870 These advanced make control variables can be potentially unsafe. See [Hints and
 871 Suggestions for Advanced Users](#hints-and-suggestions-for-advanced-users) and
 872 [Understanding the Build System](#understanding-the-build-system) for details.
 873 
 874   * `SPEC`
 875   * `CONF_CHECK`
 876   * `COMPARE_BUILD`
 877   * `JDK_FILTER`
 878   * `SPEC_FILTER`
 879 
 880 ## Running Tests
 881 
 882 Most of the JDK tests are using the [JTReg](http://openjdk.java.net/jtreg)
 883 test framework. Make sure that your configuration knows where to find your
 884 installation of JTReg. If this is not picked up automatically, use the
 885 `--with-jtreg=&lt;path to jtreg home&gt;` option to point to the JTReg framework.
 886 Note that this option should point to the JTReg home, i.e. the top directory,
 887 containing `lib/jtreg.jar` etc.
 888 
 889 The [Adoption Group](https://wiki.openjdk.java.net/display/Adoption) provides
 890 recent builds of jtreg [here](
 891 https://adopt-openjdk.ci.cloudbees.com/job/jtreg/lastSuccessfulBuild/artifact).
 892 Download the latest `.tar.gz` file, unpack it, and point `--with-jtreg` to the
 893 `jtreg` directory that you just unpacked.
 894 
 895 To execute the most basic tests (tier 1), use:
 896 ```
 897 make run-test-tier1
 898 ```
 899 
 900 For more details on how to run tests, please see the [Testing
 901 the JDK](testing.html) document.
 902 
 903 ## Cross-compiling
 904 
 905 Cross-compiling means using one platform (the *build* platform) to generate
 906 output that can ran on another platform (the *target* platform).
 907 
 908 The typical reason for cross-compiling is that the build is performed on a more
 909 powerful desktop computer, but the resulting binaries will be able to run on a
 910 different, typically low-performing system. Most of the complications that
 911 arise when building for embedded is due to this separation of *build* and
 912 *target* systems.
 913 
 914 This requires a more complex setup and build procedure. This section assumes
 915 you are familiar with cross-compiling in general, and will only deal with the
 916 particularities of cross-compiling the JDK. If you are new to cross-compiling,
 917 please see the [external links at Wikipedia](
 918 https://en.wikipedia.org/wiki/Cross_compiler#External_links) for a good start
 919 on reading materials.
 920 
 921 Cross-compiling the JDK requires you to be able to build both for the build
 922 platform and for the target platform. The reason for the former is that we need
 923 to build and execute tools during the build process, both native tools and Java
 924 tools.
 925 
 926 If all you want to do is to compile a 32-bit version, for the same OS, on a
 927 64-bit machine, consider using `--with-target-bits=32` instead of doing a
 928 full-blown cross-compilation. (While this surely is possible, it&#39;s a lot more
 929 work and will take much longer to build.)
 930 
 931 ### Cross compiling the easy way with OpenJDK devkits
 932 
 933 The OpenJDK build system provides out-of-the box support for creating and using
 934 so called devkits. A `devkit` is basically a collection of a cross-compiling
 935 toolchain and a sysroot environment which can easily be used together with the
 936 `--with-devkit` configure option to cross compile the OpenJDK. On Linux/x86_64,
 937 the following command:
 938 ```
 939 bash configure --with-devkit=&lt;devkit-path&gt; --openjdk-target=ppc64-linux-gnu &amp;&amp; make
 940 ```
 941 
 942 will configure and build OpenJDK for Linux/ppc64 assuming that `&lt;devkit-path&gt;`
 943 points to a Linux/x86_64 to Linux/ppc64 devkit.
 944 
 945 Devkits can be created from the `make/devkit` directory by executing:
 946 ```
 947 make [ TARGETS=&quot;&lt;TARGET_TRIPLET&gt;+&quot; ] [ BASE_OS=&lt;OS&gt; ] [ BASE_OS_VERSION=&lt;VER&gt; ]
 948 ```
 949 
 950 where `TARGETS` contains one or more `TARGET_TRIPLET`s of the form
 951 described in [section 3.4 of the GNU Autobook](
 952 https://sourceware.org/autobook/autobook/autobook_17.html). If no
 953 targets are given, a native toolchain for the current platform will be
 954 created. Currently, at least the following targets are known to work:
 955 
 956  Supported devkit targets
 957  -------------------------
 958  x86_64-linux-gnu
 959  aarch64-linux-gnu
 960  arm-linux-gnueabihf
 961  ppc64-linux-gnu
 962  ppc64le-linux-gnu
 963  s390x-linux-gnu
 964 
 965 `BASE_OS` must be one of &quot;OEL6&quot; for Oracle Enterprise Linux 6 or
 966 &quot;Fedora&quot; (if not specified &quot;OEL6&quot; will be the default). If the base OS
 967 is &quot;Fedora&quot; the corresponding Fedora release can be specified with the
 968 help of the `BASE_OS_VERSION` option (with &quot;27&quot; as default version).
 969 If the build is successful, the new devkits can be found in the
 970 `build/devkit/result` subdirectory:
 971 ```
 972 cd make/devkit
 973 make TARGETS=&quot;ppc64le-linux-gnu aarch64-linux-gnu&quot; BASE_OS=Fedora BASE_OS_VERSION=21
 974 ls -1 ../../build/devkit/result/
 975 x86_64-linux-gnu-to-aarch64-linux-gnu
 976 x86_64-linux-gnu-to-ppc64le-linux-gnu
 977 ```
 978 
 979 Notice that devkits are not only useful for targeting different build
 980 platforms. Because they contain the full build dependencies for a
 981 system (i.e. compiler and root file system), they can easily be used
 982 to build well-known, reliable and reproducible build environments. You
 983 can for example create and use a devkit with GCC 7.3 and a Fedora 12
 984 sysroot environment (with glibc 2.11) on Ubuntu 14.04 (which doesn&#39;t
 985 have GCC 7.3 by default) to produce OpenJDK binaries which will run on
 986 all Linux systems with runtime libraries newer than the ones from
 987 Fedora 12 (e.g. Ubuntu 16.04, SLES 11 or RHEL 6).
 988 
 989 ### Boot JDK and Build JDK
 990 
 991 When cross-compiling, make sure you use a boot JDK that runs on the *build*
 992 system, and not on the *target* system.
 993 
 994 To be able to build, we need a &quot;Build JDK&quot;, which is a JDK built from the
 995 current sources (that is, the same as the end result of the entire build
 996 process), but able to run on the *build* system, and not the *target* system.
 997 (In contrast, the Boot JDK should be from an older release, e.g. JDK 8 when
 998 building JDK 9.)
 999 
1000 The build process will create a minimal Build JDK for you, as part of building.
1001 To speed up the build, you can use `--with-build-jdk` to `configure` to point
1002 to a pre-built Build JDK. Please note that the build result is unpredictable,
1003 and can possibly break in subtle ways, if the Build JDK does not **exactly**
1004 match the current sources.
1005 
1006 ### Specifying the Target Platform
1007 
1008 You *must* specify the target platform when cross-compiling. Doing so will also
1009 automatically turn the build into a cross-compiling mode. The simplest way to
1010 do this is to use the `--openjdk-target` argument, e.g.
1011 `--openjdk-target=arm-linux-gnueabihf`. or `--openjdk-target=aarch64-oe-linux`.
1012 This will automatically set the `--build`, `--host` and `--target` options for
1013 autoconf, which can otherwise be confusing. (In autoconf terminology, the
1014 &quot;target&quot; is known as &quot;host&quot;, and &quot;target&quot; is used for building a Canadian
1015 cross-compiler.)
1016 
1017 ### Toolchain Considerations
1018 
1019 You will need two copies of your toolchain, one which generates output that can
1020 run on the target system (the normal, or *target*, toolchain), and one that
1021 generates output that can run on the build system (the *build* toolchain). Note
1022 that cross-compiling is only supported for gcc at the time being. The gcc
1023 standard is to prefix cross-compiling toolchains with the target denominator.
1024 If you follow this standard, `configure` is likely to pick up the toolchain
1025 correctly.
1026 
1027 The *build* toolchain will be autodetected just the same way the normal
1028 *build*/*target* toolchain will be autodetected when not cross-compiling. If
1029 this is not what you want, or if the autodetection fails, you can specify a
1030 devkit containing the *build* toolchain using `--with-build-devkit` to
1031 `configure`, or by giving `BUILD_CC` and `BUILD_CXX` arguments.
1032 
1033 It is often helpful to locate the cross-compilation tools, headers and
1034 libraries in a separate directory, outside the normal path, and point out that
1035 directory to `configure`. Do this by setting the sysroot (`--with-sysroot`) and
1036 appending the directory when searching for cross-compilations tools
1037 (`--with-toolchain-path`). As a compact form, you can also use `--with-devkit`
1038 to point to a single directory, if it is correctly setup. (See `basics.m4` for
1039 details.)
1040 
<a name="2" id="anc2"></a><span class="line-removed">1041 If you are unsure what toolchain and versions to use, these have been proved</span>
<span class="line-removed">1042 working at the time of writing:</span>
<span class="line-removed">1043 </span>
<span class="line-removed">1044   * [aarch64](</span>
<span class="line-removed">1045 https://releases.linaro.org/archive/13.11/components/toolchain/binaries/gcc-linaro-aarch64-linux-gnu-4.8-2013.11_linux.tar.xz)</span>
<span class="line-removed">1046   * [arm 32-bit hardware floating  point](</span>
<span class="line-removed">1047 https://launchpad.net/linaro-toolchain-unsupported/trunk/2012.09/+download/gcc-linaro-arm-linux-gnueabihf-raspbian-2012.09-20120921_linux.tar.bz2)</span>
<span class="line-removed">1048 </span>
1049 ### Native Libraries
1050 
1051 You will need copies of external native libraries for the *target* system,
1052 present on the *build* machine while building.
1053 
1054 Take care not to replace the *build* system&#39;s version of these libraries by
1055 mistake, since that can render the *build* machine unusable.
1056 
1057 Make sure that the libraries you point to (ALSA, X11, etc) are for the
1058 *target*, not the *build*, platform.
1059 
1060 #### ALSA
1061 
1062 You will need alsa libraries suitable for your *target* system. For most cases,
1063 using Debian&#39;s pre-built libraries work fine.
1064 
1065 Note that alsa is needed even if you only want to build a headless JDK.
1066 
1067   * Go to [Debian Package Search](https://www.debian.org/distrib/packages) and
1068     search for the `libasound2` and `libasound2-dev` packages for your *target*
1069     system. Download them to /tmp.
1070 
1071   * Install the libraries into the cross-compilation toolchain. For instance:
1072 ```
1073 cd /tools/gcc-linaro-arm-linux-gnueabihf-raspbian-2012.09-20120921_linux/arm-linux-gnueabihf/libc
1074 dpkg-deb -x /tmp/libasound2_1.0.25-4_armhf.deb .
1075 dpkg-deb -x /tmp/libasound2-dev_1.0.25-4_armhf.deb .
1076 ```
1077 
1078   * If alsa is not properly detected by `configure`, you can point it out by
1079     `--with-alsa`.
1080 
1081 #### X11
1082 
1083 You will need X11 libraries suitable for your *target* system. For most cases,
1084 using Debian&#39;s pre-built libraries work fine.
1085 
1086 Note that X11 is needed even if you only want to build a headless JDK.
1087 
1088   * Go to [Debian Package Search](https://www.debian.org/distrib/packages),
1089     search for the following packages for your *target* system, and download them
1090     to /tmp/target-x11:
1091       * libxi
1092       * libxi-dev
1093       * x11proto-core-dev
1094       * x11proto-input-dev
1095       * x11proto-kb-dev
1096       * x11proto-render-dev
1097       * x11proto-xext-dev
1098       * libice-dev
1099       * libxrender
1100       * libxrender-dev
1101       * libxrandr-dev
1102       * libsm-dev
1103       * libxt-dev
1104       * libx11
1105       * libx11-dev
1106       * libxtst
1107       * libxtst-dev
1108       * libxext
1109       * libxext-dev
1110 
1111   * Install the libraries into the cross-compilation toolchain. For instance:
1112     ```
1113     cd /tools/gcc-linaro-arm-linux-gnueabihf-raspbian-2012.09-20120921_linux/arm-linux-gnueabihf/libc/usr
1114     mkdir X11R6
1115     cd X11R6
1116     for deb in /tmp/target-x11/*.deb ; do dpkg-deb -x $deb . ; done
1117     mv usr/* .
1118     cd lib
1119     cp arm-linux-gnueabihf/* .
1120     ```
1121 
1122     You can ignore the following messages. These libraries are not needed to
1123     successfully complete a full JDK build.
1124     ```
1125     cp: cannot stat `arm-linux-gnueabihf/libICE.so&#39;: No such file or directory
1126     cp: cannot stat `arm-linux-gnueabihf/libSM.so&#39;: No such file or directory
1127     cp: cannot stat `arm-linux-gnueabihf/libXt.so&#39;: No such file or directory
1128     ```
1129 
1130   * If the X11 libraries are not properly detected by `configure`, you can
1131     point them out by `--with-x`.
1132 
1133 ### Creating And Using Sysroots With qemu-deboostrap
1134 
1135 Fortunately, you can create sysroots for foreign architectures with tools
1136 provided by your OS. On Debian/Ubuntu systems, one could use `qemu-deboostrap` to
1137 create the *target* system chroot, which would have the native libraries and headers
1138 specific to that *target* system. After that, we can use the cross-compiler on the *build*
1139 system, pointing into chroot to get the build dependencies right. This allows building
1140 for foreign architectures with native compilation speed.
1141 
1142 For example, cross-compiling to AArch64 from x86_64 could be done like this:
1143 
1144   * Install cross-compiler on the *build* system:
1145 ```
1146 apt install g++-aarch64-linux-gnu gcc-aarch64-linux-gnu
1147 ```
1148 
1149   * Create chroot on the *build* system, configuring it for *target* system:
1150 ```
1151 sudo qemu-debootstrap --arch=arm64 --verbose \
1152        --include=fakeroot,build-essential,libx11-dev,libxext-dev,libxrender-dev,libxrandr-dev,libxtst-dev,libxt-dev,libcups2-dev,libfontconfig1-dev,libasound2-dev,libfreetype6-dev,libpng12-dev \
1153        --resolve-deps jessie /chroots/arm64 http://httpredir.debian.org/debian/
1154 ```
1155 
1156   * Configure and build with newly created chroot as sysroot/toolchain-path:
1157 ```
1158 CC=aarch64-linux-gnu-gcc CXX=aarch64-linux-gnu-g++ sh ./configure --openjdk-target=aarch64-linux-gnu --with-sysroot=/chroots/arm64/ --with-toolchain-path=/chroots/arm64/
1159 make images
1160 ls build/linux-aarch64-normal-server-release/
1161 ```
1162 
1163 The build does not create new files in that chroot, so it can be reused for multiple builds
1164 without additional cleanup.
1165 
1166 Architectures that are known to successfully cross-compile like this are:
1167 
1168   Target        `CC`                      `CXX`                       `--arch=...`  `--openjdk-target=...`
1169   ------------  ------------------------- --------------------------- ------------- -----------------------
1170   x86           default                   default                     i386          i386-linux-gnu
1171   armhf         gcc-arm-linux-gnueabihf   g++-arm-linux-gnueabihf     armhf         arm-linux-gnueabihf
1172   aarch64       gcc-aarch64-linux-gnu     g++-aarch64-linux-gnu       arm64         aarch64-linux-gnu
1173   ppc64el       gcc-powerpc64le-linux-gnu g++-powerpc64le-linux-gnu   ppc64el       powerpc64le-linux-gnu
1174   s390x         gcc-s390x-linux-gnu       g++-s390x-linux-gnu         s390x         s390x-linux-gnu
1175 
1176 Additional architectures might be supported by Debian/Ubuntu Ports.
1177 
1178 ### Building for ARM/aarch64
1179 
1180 A common cross-compilation target is the ARM CPU. When building for ARM, it is
1181 useful to set the ABI profile. A number of pre-defined ABI profiles are
1182 available using `--with-abi-profile`: arm-vfp-sflt, arm-vfp-hflt, arm-sflt,
1183 armv5-vfp-sflt, armv6-vfp-hflt. Note that soft-float ABIs are no longer
1184 properly supported by the JDK.
1185 
1186 ### Verifying the Build
1187 
1188 The build will end up in a directory named like
1189 `build/linux-arm-normal-server-release`.
1190 
1191 Inside this build output directory, the `images/jdk` will contain the newly
1192 built JDK, for your *target* system.
1193 
1194 Copy these folders to your *target* system. Then you can run e.g.
1195 `images/jdk/bin/java -version`.
1196 
1197 ## Build Performance
1198 
1199 Building the JDK requires a lot of horsepower. Some of the build tools can be
1200 adjusted to utilize more or less of resources such as parallel threads and
1201 memory. The `configure` script analyzes your system and selects reasonable
1202 values for such options based on your hardware. If you encounter resource
1203 problems, such as out of memory conditions, you can modify the detected values
1204 with:
1205 
1206   * `--with-num-cores` -- number of cores in the build system, e.g.
1207     `--with-num-cores=8`.
1208 
1209   * `--with-memory-size` -- memory (in MB) available in the build system, e.g.
1210     `--with-memory-size=1024`
1211 
1212 You can also specify directly the number of build jobs to use with
1213 `--with-jobs=N` to `configure`, or `JOBS=N` to `make`. Do not use the `-j` flag
1214 to `make`. In most cases it will be ignored by the makefiles, but it can cause
1215 problems for some make targets.
1216 
1217 It might also be necessary to specify the JVM arguments passed to the Boot JDK,
1218 using e.g. `--with-boot-jdk-jvmargs=&quot;-Xmx8G&quot;`. Doing so will override the
1219 default JVM arguments passed to the Boot JDK.
1220 
1221 At the end of a successful execution of `configure`, you will get a performance
1222 summary, indicating how well the build will perform. Here you will also get
1223 performance hints. If you want to build fast, pay attention to those!
1224 
1225 If you want to tweak build performance, run with `make LOG=info` to get a build
1226 time summary at the end of the build process.
1227 
1228 ### Disk Speed
1229 
1230 If you are using network shares, e.g. via NFS, for your source code, make sure
1231 the build directory is situated on local disk (e.g. by `ln -s
1232 /localdisk/jdk-build $JDK-SHARE/build`). The performance penalty is extremely
1233 high for building on a network share; close to unusable.
1234 
1235 Also, make sure that your build tools (including Boot JDK and toolchain) is
1236 located on a local disk and not a network share.
1237 
1238 As has been stressed elsewhere, do use SSD for source code and build directory,
1239 as well as (if possible) the build tools.
1240 
1241 ### Virus Checking
1242 
1243 The use of virus checking software, especially on Windows, can *significantly*
1244 slow down building of the JDK. If possible, turn off such software, or exclude
1245 the directory containing the JDK source code from on-the-fly checking.
1246 
1247 ### Ccache
1248 
1249 The JDK build supports building with ccache when using gcc or clang. Using
1250 ccache can radically speed up compilation of native code if you often rebuild
1251 the same sources. Your milage may vary however, so we recommend evaluating it
1252 for yourself. To enable it, make sure it&#39;s on the path and configure with
1253 `--enable-ccache`.
1254 
1255 ### Precompiled Headers
1256 
1257 By default, the Hotspot build uses preccompiled headers (PCH) on the toolchains
1258 were it is properly supported (clang, gcc, and Visual Studio). Normally, this
1259 speeds up the build process, but in some circumstances, it can actually slow
1260 things down.
1261 
1262 You can experiment by disabling precompiled headers using
1263 `--disable-precompiled-headers`.
1264 
1265 ### Icecc / icecream
1266 
1267 [icecc/icecream](http://github.com/icecc/icecream) is a simple way to setup a
1268 distributed compiler network. If you have multiple machines available for
1269 building the JDK, you can drastically cut individual build times by utilizing
1270 it.
1271 
1272 To use, setup an icecc network, and install icecc on the build machine. Then
1273 run `configure` using `--enable-icecc`.
1274 
1275 ### Using sjavac
1276 
1277 To speed up Java compilation, especially incremental compilations, you can try
1278 the experimental sjavac compiler by using `--enable-sjavac`.
1279 
1280 ### Building the Right Target
1281 
1282 Selecting the proper target to build can have dramatic impact on build time.
1283 For normal usage, `jdk` or the default target is just fine. You only need to
1284 build `images` for shipping, or if your tests require it.
1285 
1286 See also [Using Fine-Grained Make Targets](#using-fine-grained-make-targets) on
1287 how to build an even smaller subset of the product.
1288 
1289 ## Troubleshooting
1290 
1291 If your build fails, it can sometimes be difficult to pinpoint the problem or
1292 find a proper solution.
1293 
1294 ### Locating the Source of the Error
1295 
1296 When a build fails, it can be hard to pinpoint the actual cause of the error.
1297 In a typical build process, different parts of the product build in parallel,
1298 with the output interlaced.
1299 
1300 #### Build Failure Summary
1301 
1302 To help you, the build system will print a failure summary at the end. It looks
1303 like this:
1304 
1305 ```
1306 ERROR: Build failed for target &#39;hotspot&#39; in configuration &#39;linux-x64&#39; (exit code 2)
1307 
1308 === Output from failing command(s) repeated here ===
1309 * For target hotspot_variant-server_libjvm_objs_psMemoryPool.o:
1310 /localhome/hg/jdk9-sandbox/hotspot/src/share/vm/services/psMemoryPool.cpp:1:1: error: &#39;failhere&#39; does not name a type
1311    ... (rest of output omitted)
1312 
1313 * All command lines available in /localhome/hg/jdk9-sandbox/build/linux-x64/make-support/failure-logs.
1314 === End of repeated output ===
1315 
1316 === Make failed targets repeated here ===
1317 lib/CompileJvm.gmk:207: recipe for target &#39;/localhome/hg/jdk9-sandbox/build/linux-x64/hotspot/variant-server/libjvm/objs/psMemoryPool.o&#39; failed
1318 make/Main.gmk:263: recipe for target &#39;hotspot-server-libs&#39; failed
1319 === End of repeated output ===
1320 
1321 Hint: Try searching the build log for the name of the first failed target.
1322 Hint: If caused by a warning, try configure --disable-warnings-as-errors.
1323 ```
1324 
1325 Let&#39;s break it down! First, the selected configuration, and the top-level
1326 target you entered on the command line that caused the failure is printed.
1327 
1328 Then, between the `Output from failing command(s) repeated here` and `End of
1329 repeated output` the first lines of output (stdout and stderr) from the actual
1330 failing command is repeated. In most cases, this is the error message that
1331 caused the build to fail. If multiple commands were failing (this can happen in
1332 a parallel build), output from all failed commands will be printed here.
1333 
1334 The path to the `failure-logs` directory is printed. In this file you will find
1335 a `&lt;target&gt;.log` file that contains the output from this command in its
1336 entirety, and also a `&lt;target&gt;.cmd`, which contain the complete command line
1337 used for running this command. You can re-run the failing command by executing
1338 `. &lt;path to failure-logs&gt;/&lt;target&gt;.cmd` in your shell.
1339 
1340 Another way to trace the failure is to follow the chain of make targets, from
1341 top-level targets to individual file targets. Between `Make failed targets
1342 repeated here` and `End of repeated output` the output from make showing this
1343 chain is repeated. The first failed recipe will typically contain the full path
1344 to the file in question that failed to compile. Following lines will show a
1345 trace of make targets why we ended up trying to compile that file.
1346 
1347 Finally, some hints are given on how to locate the error in the complete log.
1348 In this example, we would try searching the log file for &quot;`psMemoryPool.o`&quot;.
1349 Another way to quickly locate make errors in the log is to search for &quot;`]
1350 Error`&quot; or &quot;`***`&quot;.
1351 
1352 Note that the build failure summary will only help you if the issue was a
1353 compilation failure or similar. If the problem is more esoteric, or is due to
1354 errors in the build machinery, you will likely get empty output logs, and `No
1355 indication of failed target found` instead of the make target chain.
1356 
1357 #### Checking the Build Log File
1358 
1359 The output (stdout and stderr) from the latest build is always stored in
1360 `$BUILD/build.log`. The previous build log is stored as `build.log.old`. This
1361 means that it is not necessary to redirect the build output yourself if you
1362 want to process it.
1363 
1364 You can increase the verbosity of the log file, by the `LOG` control variable
1365 to `make`. If you want to see the command lines used in compilations, use
1366 `LOG=cmdlines`. To increase the general verbosity, use `LOG=info`, `LOG=debug`
1367 or `LOG=trace`. Both of these can be combined with `cmdlines`, e.g.
1368 `LOG=info,cmdlines`. The `debug` log level will show most shell commands
1369 executed by make, and `trace` will show all. Beware that both these log levels
1370 will produce a massive build log!
1371 
1372 ### Fixing Unexpected Build Failures
1373 
1374 Most of the time, the build will fail due to incorrect changes in the source
1375 code.
1376 
1377 Sometimes the build can fail with no apparent changes that have caused the
1378 failure. If this is the first time you are building the JDK on this particular
1379 computer, and the build fails, the problem is likely with your build
1380 environment. But even if you have previously built the JDK with success, and it
1381 now fails, your build environment might have changed (perhaps due to OS
1382 upgrades or similar). But most likely, such failures are due to problems with
1383 the incremental rebuild.
1384 
1385 #### Problems with the Build Environment
1386 
1387 Make sure your configuration is correct. Re-run `configure`, and look for any
1388 warnings. Warnings that appear in the middle of the `configure` output is also
1389 repeated at the end, after the summary. The entire log is stored in
1390 `$BUILD/configure.log`.
1391 
1392 Verify that the summary at the end looks correct. Are you indeed using the Boot
1393 JDK and native toolchain that you expect?
1394 
1395 By default, the JDK has a strict approach where warnings from the compiler is
1396 considered errors which fail the build. For very new or very old compiler
1397 versions, this can trigger new classes of warnings, which thus fails the build.
1398 Run `configure` with `--disable-warnings-as-errors` to turn of this behavior.
1399 (The warnings will still show, but not make the build fail.)
1400 
1401 #### Problems with Incremental Rebuilds
1402 
1403 Incremental rebuilds mean that when you modify part of the product, only the
1404 affected parts get rebuilt. While this works great in most cases, and
1405 significantly speed up the development process, from time to time complex
1406 interdependencies will result in an incorrect build result. This is the most
1407 common cause for unexpected build problems.
1408 
1409 Here are a suggested list of things to try if you are having unexpected build
1410 problems. Each step requires more time than the one before, so try them in
1411 order. Most issues will be solved at step 1 or 2.
1412 
1413  1. Make sure your repository is up-to-date
1414 
1415     Run `hg pull -u` to make sure you have the latest changes.
1416 
1417  2. Clean build results
1418 
1419     The simplest way to fix incremental rebuild issues is to run `make clean`.
1420     This will remove all build results, but not the configuration or any build
1421     system support artifacts. In most cases, this will solve build errors
1422     resulting from incremental build mismatches.
1423 
1424  3. Completely clean the build directory.
1425 
1426     If this does not work, the next step is to run `make dist-clean`, or
1427     removing the build output directory (`$BUILD`). This will clean all
1428     generated output, including your configuration. You will need to re-run
1429     `configure` after this step. A good idea is to run `make
1430     print-configuration` before running `make dist-clean`, as this will print
1431     your current `configure` command line. Here&#39;s a way to do this:
1432 
1433     ```
1434     make print-configuration &gt; current-configuration
1435     make dist-clean
1436     bash configure $(cat current-configuration)
1437     make
1438     ```
1439 
1440  4. Re-clone the Mercurial repository
1441 
1442     Sometimes the Mercurial repository gets in a state that causes the product
1443     to be un-buildable. In such a case, the simplest solution is often the
1444     &quot;sledgehammer approach&quot;: delete the entire repository, and re-clone it.
1445     If you have local changes, save them first to a different location using
1446     `hg export`.
1447 
1448 ### Specific Build Issues
1449 
1450 #### Clock Skew
1451 
1452 If you get an error message like this:
1453 ```
1454 File &#39;xxx&#39; has modification time in the future.
1455 Clock skew detected. Your build may be incomplete.
1456 ```
1457 then the clock on your build machine is out of sync with the timestamps on the
1458 source files. Other errors, apparently unrelated but in fact caused by the
1459 clock skew, can occur along with the clock skew warnings. These secondary
1460 errors may tend to obscure the fact that the true root cause of the problem is
1461 an out-of-sync clock.
1462 
1463 If you see these warnings, reset the clock on the build machine, run `make
1464 clean` and restart the build.
1465 
1466 #### Out of Memory Errors
1467 
1468 On Solaris, you might get an error message like this:
1469 ```
1470 Trouble writing out table to disk
1471 ```
1472 To solve this, increase the amount of swap space on your build machine.
1473 
1474 On Windows, you might get error messages like this:
1475 ```
1476 fatal error - couldn&#39;t allocate heap
1477 cannot create ... Permission denied
1478 spawn failed
1479 ```
1480 This can be a sign of a Cygwin problem. See the information about solving
1481 problems in the [Cygwin](#cygwin) section. Rebooting the computer might help
1482 temporarily.
1483 
1484 ### Getting Help
1485 
1486 If none of the suggestions in this document helps you, or if you find what you
1487 believe is a bug in the build system, please contact the Build Group by sending
1488 a mail to [build-dev@openjdk.java.net](mailto:build-dev@openjdk.java.net).
1489 Please include the relevant parts of the configure and/or build log.
1490 
1491 If you need general help or advice about developing for the JDK, you can also
1492 contact the Adoption Group. See the section on [Contributing to OpenJDK](
1493 #contributing-to-openjdk) for more information.
1494 
1495 ## Hints and Suggestions for Advanced Users
1496 
1497 ### Setting Up a Repository for Pushing Changes (defpath)
1498 
1499 To help you prepare a proper push path for a Mercurial repository, there exists
1500 a useful tool known as [defpath](
1501 http://openjdk.java.net/projects/code-tools/defpath). It will help you setup a
1502 proper push path for pushing changes to the JDK.
1503 
1504 Install the extension by cloning
1505 `http://hg.openjdk.java.net/code-tools/defpath` and updating your `.hgrc` file.
1506 Here&#39;s one way to do this:
1507 
1508 ```
1509 cd ~
1510 mkdir hg-ext
1511 cd hg-ext
1512 hg clone http://hg.openjdk.java.net/code-tools/defpath
1513 cat &lt;&lt; EOT &gt;&gt; ~/.hgrc
1514 [extensions]
1515 defpath=~/hg-ext/defpath/defpath.py
1516 EOT
1517 ```
1518 
1519 You can now setup a proper push path using:
1520 ```
1521 hg defpath -d -u &lt;your OpenJDK username&gt;
1522 ```
1523 
1524 ### Bash Completion
1525 
1526 The `configure` and `make` commands tries to play nice with bash command-line
1527 completion (using `&lt;tab&gt;` or `&lt;tab&gt;&lt;tab&gt;`). To use this functionality, make
1528 sure you enable completion in your `~/.bashrc` (see instructions for bash in
1529 your operating system).
1530 
1531 Make completion will work out of the box, and will complete valid make targets.
1532 For instance, typing `make jdk-i&lt;tab&gt;` will complete to `make jdk-image`.
1533 
1534 The `configure` script can get completion for options, but for this to work you
1535 need to help `bash` on the way. The standard way of running the script, `bash
1536 configure`, will not be understood by bash completion. You need `configure` to
1537 be the command to run. One way to achieve this is to add a simple helper script
1538 to your path:
1539 
1540 ```
1541 cat &lt;&lt; EOT &gt; /tmp/configure
1542 #!/bin/bash
1543 if [ \$(pwd) = \$(cd \$(dirname \$0); pwd) ] ; then
1544   echo &gt;&amp;2 &quot;Abort: Trying to call configure helper recursively&quot;
1545   exit 1
1546 fi
1547 
1548 bash \$PWD/configure &quot;\$@&quot;
1549 EOT
1550 chmod +x /tmp/configure
1551 sudo mv /tmp/configure /usr/local/bin
1552 ```
1553 
1554 Now `configure --en&lt;tab&gt;-dt&lt;tab&gt;` will result in `configure --enable-dtrace`.
1555 
1556 ### Using Multiple Configurations
1557 
1558 You can have multiple configurations for a single source repository. When you
1559 create a new configuration, run `configure --with-conf-name=&lt;name&gt;` to create a
1560 configuration with the name `&lt;name&gt;`. Alternatively, you can create a directory
1561 under `build` and run `configure` from there, e.g. `mkdir build/&lt;name&gt; &amp;&amp; cd
1562 build/&lt;name&gt; &amp;&amp; bash ../../configure`.
1563 
1564 Then you can build that configuration using `make CONF_NAME=&lt;name&gt;` or `make
1565 CONF=&lt;pattern&gt;`, where `&lt;pattern&gt;` is a substring matching one or several
1566 configurations, e.g. `CONF=debug`. The special empty pattern (`CONF=`) will
1567 match *all* available configuration, so `make CONF= hotspot` will build the
1568 `hotspot` target for all configurations. Alternatively, you can execute `make`
1569 in the configuration directory, e.g. `cd build/&lt;name&gt; &amp;&amp; make`.
1570 
1571 ### Handling Reconfigurations
1572 
1573 If you update the repository and part of the configure script has changed, the
1574 build system will force you to re-run `configure`.
1575 
1576 Most of the time, you will be fine by running `configure` again with the same
1577 arguments as the last time, which can easily be performed by `make
1578 reconfigure`. To simplify this, you can use the `CONF_CHECK` make control
1579 variable, either as `make CONF_CHECK=auto`, or by setting an environment
1580 variable. For instance, if you add `export CONF_CHECK=auto` to your `.bashrc`
1581 file, `make` will always run `reconfigure` automatically whenever the configure
1582 script has changed.
1583 
1584 You can also use `CONF_CHECK=ignore` to skip the check for a needed configure
1585 update. This might speed up the build, but comes at the risk of an incorrect
1586 build result. This is only recommended if you know what you&#39;re doing.
1587 
1588 From time to time, you will also need to modify the command line to `configure`
1589 due to changes. Use `make print-configure` to show the command line used for
1590 your current configuration.
1591 
1592 ### Using Fine-Grained Make Targets
1593 
1594 The default behavior for make is to create consistent and correct output, at
1595 the expense of build speed, if necessary.
1596 
1597 If you are prepared to take some risk of an incorrect build, and know enough of
1598 the system to understand how things build and interact, you can speed up the
1599 build process considerably by instructing make to only build a portion of the
1600 product.
1601 
1602 #### Building Individual Modules
1603 
1604 The safe way to use fine-grained make targets is to use the module specific
1605 make targets. All source code in the JDK is organized so it belongs to a
1606 module, e.g. `java.base` or `jdk.jdwp.agent`. You can build only a specific
1607 module, by giving it as make target: `make jdk.jdwp.agent`. If the specified
1608 module depends on other modules (e.g. `java.base`), those modules will be built
1609 first.
1610 
1611 You can also specify a set of modules, just as you can always specify a set of
1612 make targets: `make jdk.crypto.cryptoki jdk.crypto.ec jdk.crypto.mscapi
1613 jdk.crypto.ucrypto`
1614 
1615 #### Building Individual Module Phases
1616 
1617 The build process for each module is divided into separate phases. Not all
1618 modules need all phases. Which are needed depends on what kind of source code
1619 and other artifact the module consists of. The phases are:
1620 
1621   * `gensrc` (Generate source code to compile)
1622   * `gendata` (Generate non-source code artifacts)
1623   * `copy` (Copy resource artifacts)
1624   * `java` (Compile Java code)
1625   * `launchers` (Compile native executables)
1626   * `libs` (Compile native libraries)
1627   * `rmic` (Run the `rmic` tool)
1628 
1629 You can build only a single phase for a module by using the notation
1630 `$MODULE-$PHASE`. For instance, to build the `gensrc` phase for `java.base`,
1631 use `make java.base-gensrc`.
1632 
1633 Note that some phases may depend on others, e.g. `java` depends on `gensrc` (if
1634 present). Make will build all needed prerequisites before building the
1635 requested phase.
1636 
1637 #### Skipping the Dependency Check
1638 
1639 When using an iterative development style with frequent quick rebuilds, the
1640 dependency check made by make can take up a significant portion of the time
1641 spent on the rebuild. In such cases, it can be useful to bypass the dependency
1642 check in make.
1643 
1644 &gt; **Note that if used incorrectly, this can lead to a broken build!**
1645 
1646 To achieve this, append `-only` to the build target. For instance, `make
1647 jdk.jdwp.agent-java-only` will *only* build the `java` phase of the
1648 `jdk.jdwp.agent` module. If the required dependencies are not present, the
1649 build can fail. On the other hand, the execution time measures in milliseconds.
1650 
1651 A useful pattern is to build the first time normally (e.g. `make
1652 jdk.jdwp.agent`) and then on subsequent builds, use the `-only` make target.
1653 
1654 #### Rebuilding Part of java.base (JDK\_FILTER)
1655 
1656 If you are modifying files in `java.base`, which is the by far largest module
1657 in the JDK, then you need to rebuild all those files whenever a single file has
1658 changed. (This inefficiency will hopefully be addressed in JDK 10.)
1659 
1660 As a hack, you can use the make control variable `JDK_FILTER` to specify a
1661 pattern that will be used to limit the set of files being recompiled. For
1662 instance, `make java.base JDK_FILTER=javax/crypto` (or, to combine methods,
1663 `make java.base-java-only JDK_FILTER=javax/crypto`) will limit the compilation
1664 to files in the `javax.crypto` package.
1665 
1666 ### Learn About Mercurial
1667 
1668 To become an efficient JDK developer, it is recommended that you invest in
1669 learning Mercurial properly. Here are some links that can get you started:
1670 
1671   * [Mercurial for git users](http://www.mercurial-scm.org/wiki/GitConcepts)
1672   * [The official Mercurial tutorial](http://www.mercurial-scm.org/wiki/Tutorial)
1673   * [hg init](http://hginit.com/)
1674   * [Mercurial: The Definitive Guide](http://hgbook.red-bean.com/read/)
1675 
1676 ## Understanding the Build System
1677 
1678 This section will give you a more technical description on the details of the
1679 build system.
1680 
1681 ### Configurations
1682 
1683 The build system expects to find one or more configuration. These are
1684 technically defined by the `spec.gmk` in a subdirectory to the `build`
1685 subdirectory. The `spec.gmk` file is generated by `configure`, and contains in
1686 principle the configuration (directly or by files included by `spec.gmk`).
1687 
1688 You can, in fact, select a configuration to build by pointing to the `spec.gmk`
1689 file with the `SPEC` make control variable, e.g. `make SPEC=$BUILD/spec.gmk`.
1690 While this is not the recommended way to call `make` as a user, it is what is
1691 used under the hood by the build system.
1692 
1693 ### Build Output Structure
1694 
1695 The build output for a configuration will end up in `build/&lt;configuration
1696 name&gt;`, which we refer to as `$BUILD` in this document. The `$BUILD` directory
1697 contains the following important directories:
1698 
1699 ```
1700 buildtools/
1701 configure-support/
1702 hotspot/
1703 images/
1704 jdk/
1705 make-support/
1706 support/
1707 test-results/
1708 test-support/
1709 ```
1710 
1711 This is what they are used for:
1712 
1713   * `images`: This is the directory were the output of the `*-image` make
1714     targets end up. For instance, `make jdk-image` ends up in `images/jdk`.
1715 
1716   * `jdk`: This is the &quot;exploded image&quot;. After `make jdk`, you will be able to
1717     launch the newly built JDK by running `$BUILD/jdk/bin/java`.
1718 
1719   * `test-results`: This directory contains the results from running tests.
1720 
1721   * `support`: This is an area for intermediate files needed during the build,
1722     e.g. generated source code, object files and class files. Some noteworthy
1723     directories in `support` is `gensrc`, which contains the generated source
1724     code, and the `modules_*` directories, which contains the files in a
1725     per-module hierarchy that will later be collapsed into the `jdk` directory
1726     of the exploded image.
1727 
1728   * `buildtools`: This is an area for tools compiled for the build platform
1729     that are used during the rest of the build.
1730 
1731   * `hotspot`: This is an area for intermediate files needed when building
1732     hotspot.
1733 
1734   * `configure-support`, `make-support` and `test-support`: These directories
1735     contain files that are needed by the build system for `configure`, `make`
1736     and for running tests.
1737 
1738 ### Fixpath
1739 
1740 Windows path typically look like `C:\User\foo`, while Unix paths look like
1741 `/home/foo`. Tools with roots from Unix often experience issues related to this
1742 mismatch when running on Windows.
1743 
1744 In the JDK build, we always use Unix paths internally, and only just before
1745 calling a tool that does not understand Unix paths do we convert them to
1746 Windows paths.
1747 
1748 This conversion is done by the `fixpath` tool, which is a small wrapper that
1749 modifies unix-style paths to Windows-style paths in command lines. Fixpath is
1750 compiled automatically by `configure`.
1751 
1752 ### Native Debug Symbols
1753 
1754 Native libraries and executables can have debug symbol (and other debug
1755 information) associated with them. How this works is very much platform
1756 dependent, but a common problem is that debug symbol information takes a lot of
1757 disk space, but is rarely needed by the end user.
1758 
1759 The JDK supports different methods on how to handle debug symbols. The
1760 method used is selected by `--with-native-debug-symbols`, and available methods
1761 are `none`, `internal`, `external`, `zipped`.
1762 
1763   * `none` means that no debug symbols will be generated during the build.
1764 
1765   * `internal` means that debug symbols will be generated during the build, and
1766     they will be stored in the generated binary.
1767 
1768   * `external` means that debug symbols will be generated during the build, and
1769     after the compilation, they will be moved into a separate `.debuginfo` file.
1770     (This was previously known as FDS, Full Debug Symbols).
1771 
1772   * `zipped` is like `external`, but the .debuginfo file will also be zipped
1773     into a `.diz` file.
1774 
1775 When building for distribution, `zipped` is a good solution. Binaries built
1776 with `internal` is suitable for use by developers, since they facilitate
1777 debugging, but should be stripped before distributed to end users.
1778 
1779 ### Autoconf Details
1780 
1781 The `configure` script is based on the autoconf framework, but in some details
1782 deviate from a normal autoconf `configure` script.
1783 
1784 The `configure` script in the top level directory of the JDK is just a thin
1785 wrapper that calls `make/autoconf/configure`. This in turn will run `autoconf`
1786 to create the runnable (generated) configure script, as
1787 `.build/generated-configure.sh`. Apart from being responsible for the
1788 generation of the runnable script, the `configure` script also provides
1789 functionality that is not easily expressed in the normal Autoconf framework. As
1790 part of this functionality, the generated script is called.
1791 
1792 The build system will detect if the Autoconf source files have changed, and
1793 will trigger a regeneration of the generated script if needed. You can also
1794 manually request such an update by `bash configure autogen`.
1795 
1796 In previous versions of the JDK, the generated script was checked in at
1797 `make/autoconf/generated-configure.sh`. This is no longer the case.
1798 
1799 ### Developing the Build System Itself
1800 
1801 This section contains a few remarks about how to develop for the build system
1802 itself. It is not relevant if you are only making changes in the product source
1803 code.
1804 
1805 While technically using `make`, the make source files of the JDK does not
1806 resemble most other Makefiles. Instead of listing specific targets and actions
1807 (perhaps using patterns), the basic modus operandi is to call a high-level
1808 function (or properly, macro) from the API in `make/common`. For instance, to
1809 compile all classes in the `jdk.internal.foo` package in the `jdk.foo` module,
1810 a call like this would be made:
1811 
1812 ```
1813 $(eval $(call SetupJavaCompilation, BUILD_FOO_CLASSES, \
1814     SETUP := GENERATE_OLDBYTECODE, \
1815     SRC := $(TOPDIR)/src/jkd.foo/share/classes, \
1816     INCLUDES := jdk/internal/foo, \
1817     BIN := $(SUPPORT_OUTPUTDIR)/foo_classes, \
1818 ))
1819 ```
1820 
1821 By encapsulating and expressing the high-level knowledge of *what* should be
1822 done, rather than *how* it should be done (as is normal in Makefiles), we can
1823 build a much more powerful and flexible build system.
1824 
1825 Correct dependency tracking is paramount. Sloppy dependency tracking will lead
1826 to improper parallelization, or worse, race conditions.
1827 
1828 To test for/debug race conditions, try running `make JOBS=1` and `make
1829 JOBS=100` and see if it makes any difference. (It shouldn&#39;t).
1830 
1831 To compare the output of two different builds and see if, and how, they differ,
1832 run `$BUILD1/compare.sh -o $BUILD2`, where `$BUILD1` and `$BUILD2` are the two
1833 builds you want to compare.
1834 
1835 To automatically build two consecutive versions and compare them, use
1836 `COMPARE_BUILD`. The value of `COMPARE_BUILD` is a set of variable=value
1837 assignments, like this:
1838 ```
1839 make COMPARE_BUILD=CONF=--enable-new-hotspot-feature:MAKE=hotspot
1840 ```
1841 See `make/InitSupport.gmk` for details on how to use `COMPARE_BUILD`.
1842 
1843 To analyze build performance, run with `LOG=trace` and check `$BUILD/build-trace-time.log`.
1844 Use `JOBS=1` to avoid parallelism.
1845 
1846 Please check that you adhere to the [Code Conventions for the Build System](
1847 http://openjdk.java.net/groups/build/doc/code-conventions.html) before
1848 submitting patches.
1849 
1850 ## Contributing to the JDK
1851 
1852 So, now you&#39;ve built your JDK, and made your first patch, and want to
1853 contribute it back to the OpenJDK Community.
1854 
1855 First of all: Thank you! We gladly welcome your contribution.
1856 However, please bear in mind that the JDK is a massive project, and we must ask
1857 you to follow our rules and guidelines to be able to accept your contribution.
1858 
1859 The official place to start is the [&#39;How to contribute&#39; page](
1860 http://openjdk.java.net/contribute/). There is also an official (but somewhat
1861 outdated and skimpy on details) [Developer&#39;s Guide](
1862 http://openjdk.java.net/guide/).
1863 
1864 If this seems overwhelming to you, the Adoption Group is there to help you! A
1865 good place to start is their [&#39;New Contributor&#39; page](
1866 https://wiki.openjdk.java.net/display/Adoption/New+Contributor), or start
1867 reading the comprehensive [Getting Started Kit](
1868 https://adoptopenjdk.gitbooks.io/adoptopenjdk-getting-started-kit/en/). The
1869 Adoption Group will also happily answer any questions you have about
1870 contributing. Contact them by [mail](
1871 http://mail.openjdk.java.net/mailman/listinfo/adoption-discuss) or [IRC](
1872 http://openjdk.java.net/irc/).
1873 
1874 ---
1875 # Override styles from the base CSS file that are not ideal for this document.
1876 header-includes:
1877  - &#39;&lt;style type=&quot;text/css&quot;&gt;pre, code, tt { color: #1d6ae5; }&lt;/style&gt;&#39;
1878 ---
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>