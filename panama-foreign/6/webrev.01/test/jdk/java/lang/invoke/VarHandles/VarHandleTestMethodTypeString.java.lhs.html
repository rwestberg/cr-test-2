<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Frames test/jdk/java/lang/invoke/VarHandles/VarHandleTestMethodTypeString.java</title>
    <link rel="stylesheet" href="../../../../../../style.css" />
    <script type="text/javascript" src="../../../../../../navigation.js"></script>
  </head>
<body onkeypress="keypress(event);">
<a name="0"></a>
<hr />
<pre>   1 /*
<a name="1" id="anc1"></a><span class="line-modified">   2  * Copyright (c) 2015, 2016, Oracle and/or its affiliates. All rights reserved.</span>
   3  * DO NOT ALTER OR REMOVE COPYRIGHT NOTICES OR THIS FILE HEADER.
   4  *
   5  * This code is free software; you can redistribute it and/or modify it
   6  * under the terms of the GNU General Public License version 2 only, as
   7  * published by the Free Software Foundation.
   8  *
   9  * This code is distributed in the hope that it will be useful, but WITHOUT
  10  * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
  11  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License
  12  * version 2 for more details (a copy is included in the LICENSE file that
  13  * accompanied this code).
  14  *
  15  * You should have received a copy of the GNU General Public License version
  16  * 2 along with this work; if not, write to the Free Software Foundation,
  17  * Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA.
  18  *
  19  * Please contact Oracle, 500 Oracle Parkway, Redwood Shores, CA 94065 USA
  20  * or visit www.oracle.com if you need additional information or have any
  21  * questions.
  22  */
  23 
  24 /*
  25  * @test
  26  * @bug 8156486
  27  * @run testng/othervm VarHandleTestMethodTypeString
<a name="2" id="anc2"></a><span class="line-modified">  28  * @run testng/othervm -Djava.lang.invoke.VarHandle.VAR_HANDLE_GUARDS=false VarHandleTestMethodTypeString</span>


  29  */
  30 
  31 import org.testng.annotations.BeforeClass;
  32 import org.testng.annotations.DataProvider;
  33 import org.testng.annotations.Test;
  34 
  35 import java.lang.invoke.MethodHandles;
  36 import java.lang.invoke.VarHandle;
  37 import java.util.ArrayList;
  38 import java.util.Arrays;
  39 import java.util.List;
  40 
  41 import static org.testng.Assert.*;
  42 
  43 import static java.lang.invoke.MethodType.*;
  44 
  45 public class VarHandleTestMethodTypeString extends VarHandleBaseTest {
  46     static final String static_final_v = &quot;foo&quot;;
  47 
  48     static String static_v = &quot;foo&quot;;
  49 
  50     final String final_v = &quot;foo&quot;;
  51 
  52     String v = &quot;foo&quot;;
  53 
  54     VarHandle vhFinalField;
  55 
  56     VarHandle vhField;
  57 
  58     VarHandle vhStaticField;
  59 
  60     VarHandle vhStaticFinalField;
  61 
  62     VarHandle vhArray;
  63 
  64     @BeforeClass
  65     public void setup() throws Exception {
  66         vhFinalField = MethodHandles.lookup().findVarHandle(
  67                 VarHandleTestMethodTypeString.class, &quot;final_v&quot;, String.class);
  68 
  69         vhField = MethodHandles.lookup().findVarHandle(
  70                 VarHandleTestMethodTypeString.class, &quot;v&quot;, String.class);
  71 
  72         vhStaticFinalField = MethodHandles.lookup().findStaticVarHandle(
  73             VarHandleTestMethodTypeString.class, &quot;static_final_v&quot;, String.class);
  74 
  75         vhStaticField = MethodHandles.lookup().findStaticVarHandle(
  76             VarHandleTestMethodTypeString.class, &quot;static_v&quot;, String.class);
  77 
  78         vhArray = MethodHandles.arrayElementVarHandle(String[].class);
  79     }
  80 
  81     @DataProvider
  82     public Object[][] accessTestCaseProvider() throws Exception {
  83         List&lt;AccessTestCase&lt;?&gt;&gt; cases = new ArrayList&lt;&gt;();
  84 
  85         cases.add(new VarHandleAccessTestCase(&quot;Instance field&quot;,
  86                                               vhField, vh -&gt; testInstanceFieldWrongMethodType(this, vh),
  87                                               false));
  88 
  89         cases.add(new VarHandleAccessTestCase(&quot;Static field&quot;,
  90                                               vhStaticField, VarHandleTestMethodTypeString::testStaticFieldWrongMethodType,
  91                                               false));
  92 
  93         cases.add(new VarHandleAccessTestCase(&quot;Array&quot;,
  94                                               vhArray, VarHandleTestMethodTypeString::testArrayWrongMethodType,
  95                                               false));
  96 
  97         for (VarHandleToMethodHandle f : VarHandleToMethodHandle.values()) {
  98             cases.add(new MethodHandleAccessTestCase(&quot;Instance field&quot;,
  99                                                      vhField, f, hs -&gt; testInstanceFieldWrongMethodType(this, hs),
 100                                                      false));
 101 
 102             cases.add(new MethodHandleAccessTestCase(&quot;Static field&quot;,
 103                                                      vhStaticField, f, VarHandleTestMethodTypeString::testStaticFieldWrongMethodType,
 104                                                      false));
 105 
 106             cases.add(new MethodHandleAccessTestCase(&quot;Array&quot;,
 107                                                      vhArray, f, VarHandleTestMethodTypeString::testArrayWrongMethodType,
 108                                                      false));
 109         }
 110         // Work around issue with jtreg summary reporting which truncates
 111         // the String result of Object.toString to 30 characters, hence
 112         // the first dummy argument
 113         return cases.stream().map(tc -&gt; new Object[]{tc.toString(), tc}).toArray(Object[][]::new);
 114     }
 115 
 116     @Test(dataProvider = &quot;accessTestCaseProvider&quot;)
 117     public &lt;T&gt; void testAccess(String desc, AccessTestCase&lt;T&gt; atc) throws Throwable {
 118         T t = atc.get();
 119         int iters = atc.requiresLoop() ? ITERS : 1;
 120         for (int c = 0; c &lt; iters; c++) {
 121             atc.testAccess(t);
 122         }
 123     }
 124 
 125 
 126     static void testInstanceFieldWrongMethodType(VarHandleTestMethodTypeString recv, VarHandle vh) throws Throwable {
 127         // Get
 128         // Incorrect argument types
 129         checkNPE(() -&gt; { // null receiver
 130             String x = (String) vh.get(null);
 131         });
 132         checkCCE(() -&gt; { // receiver reference class
 133             String x = (String) vh.get(Void.class);
 134         });
 135         checkWMTE(() -&gt; { // receiver primitive class
 136             String x = (String) vh.get(0);
 137         });
 138         // Incorrect return type
 139         checkCCE(() -&gt; { // reference class
 140             Void x = (Void) vh.get(recv);
 141         });
 142         checkWMTE(() -&gt; { // primitive class
 143             boolean x = (boolean) vh.get(recv);
 144         });
 145         // Incorrect arity
 146         checkWMTE(() -&gt; { // 0
 147             String x = (String) vh.get();
 148         });
 149         checkWMTE(() -&gt; { // &gt;
 150             String x = (String) vh.get(recv, Void.class);
 151         });
 152 
 153 
 154         // Set
 155         // Incorrect argument types
 156         checkNPE(() -&gt; { // null receiver
 157             vh.set(null, &quot;foo&quot;);
 158         });
 159         checkCCE(() -&gt; { // receiver reference class
 160             vh.set(Void.class, &quot;foo&quot;);
 161         });
 162         checkCCE(() -&gt; { // value reference class
 163             vh.set(recv, Void.class);
 164         });
 165         checkWMTE(() -&gt; { // receiver primitive class
 166             vh.set(0, &quot;foo&quot;);
 167         });
 168         // Incorrect arity
 169         checkWMTE(() -&gt; { // 0
 170             vh.set();
 171         });
 172         checkWMTE(() -&gt; { // &gt;
 173             vh.set(recv, &quot;foo&quot;, Void.class);
 174         });
 175 
 176 
 177         // GetVolatile
 178         // Incorrect argument types
 179         checkNPE(() -&gt; { // null receiver
 180             String x = (String) vh.getVolatile(null);
 181         });
 182         checkCCE(() -&gt; { // receiver reference class
 183             String x = (String) vh.getVolatile(Void.class);
 184         });
 185         checkWMTE(() -&gt; { // receiver primitive class
 186             String x = (String) vh.getVolatile(0);
 187         });
 188         // Incorrect return type
 189         checkCCE(() -&gt; { // reference class
 190             Void x = (Void) vh.getVolatile(recv);
 191         });
 192         checkWMTE(() -&gt; { // primitive class
 193             boolean x = (boolean) vh.getVolatile(recv);
 194         });
 195         // Incorrect arity
 196         checkWMTE(() -&gt; { // 0
 197             String x = (String) vh.getVolatile();
 198         });
 199         checkWMTE(() -&gt; { // &gt;
 200             String x = (String) vh.getVolatile(recv, Void.class);
 201         });
 202 
 203 
 204         // SetVolatile
 205         // Incorrect argument types
 206         checkNPE(() -&gt; { // null receiver
 207             vh.setVolatile(null, &quot;foo&quot;);
 208         });
 209         checkCCE(() -&gt; { // receiver reference class
 210             vh.setVolatile(Void.class, &quot;foo&quot;);
 211         });
 212         checkCCE(() -&gt; { // value reference class
 213             vh.setVolatile(recv, Void.class);
 214         });
 215         checkWMTE(() -&gt; { // receiver primitive class
 216             vh.setVolatile(0, &quot;foo&quot;);
 217         });
 218         // Incorrect arity
 219         checkWMTE(() -&gt; { // 0
 220             vh.setVolatile();
 221         });
 222         checkWMTE(() -&gt; { // &gt;
 223             vh.setVolatile(recv, &quot;foo&quot;, Void.class);
 224         });
 225 
 226 
 227         // GetOpaque
 228         // Incorrect argument types
 229         checkNPE(() -&gt; { // null receiver
 230             String x = (String) vh.getOpaque(null);
 231         });
 232         checkCCE(() -&gt; { // receiver reference class
 233             String x = (String) vh.getOpaque(Void.class);
 234         });
 235         checkWMTE(() -&gt; { // receiver primitive class
 236             String x = (String) vh.getOpaque(0);
 237         });
 238         // Incorrect return type
 239         checkCCE(() -&gt; { // reference class
 240             Void x = (Void) vh.getOpaque(recv);
 241         });
 242         checkWMTE(() -&gt; { // primitive class
 243             boolean x = (boolean) vh.getOpaque(recv);
 244         });
 245         // Incorrect arity
 246         checkWMTE(() -&gt; { // 0
 247             String x = (String) vh.getOpaque();
 248         });
 249         checkWMTE(() -&gt; { // &gt;
 250             String x = (String) vh.getOpaque(recv, Void.class);
 251         });
 252 
 253 
 254         // SetOpaque
 255         // Incorrect argument types
 256         checkNPE(() -&gt; { // null receiver
 257             vh.setOpaque(null, &quot;foo&quot;);
 258         });
 259         checkCCE(() -&gt; { // receiver reference class
 260             vh.setOpaque(Void.class, &quot;foo&quot;);
 261         });
 262         checkCCE(() -&gt; { // value reference class
 263             vh.setOpaque(recv, Void.class);
 264         });
 265         checkWMTE(() -&gt; { // receiver primitive class
 266             vh.setOpaque(0, &quot;foo&quot;);
 267         });
 268         // Incorrect arity
 269         checkWMTE(() -&gt; { // 0
 270             vh.setOpaque();
 271         });
 272         checkWMTE(() -&gt; { // &gt;
 273             vh.setOpaque(recv, &quot;foo&quot;, Void.class);
 274         });
 275 
 276 
 277         // GetAcquire
 278         // Incorrect argument types
 279         checkNPE(() -&gt; { // null receiver
 280             String x = (String) vh.getAcquire(null);
 281         });
 282         checkCCE(() -&gt; { // receiver reference class
 283             String x = (String) vh.getAcquire(Void.class);
 284         });
 285         checkWMTE(() -&gt; { // receiver primitive class
 286             String x = (String) vh.getAcquire(0);
 287         });
 288         // Incorrect return type
 289         checkCCE(() -&gt; { // reference class
 290             Void x = (Void) vh.getAcquire(recv);
 291         });
 292         checkWMTE(() -&gt; { // primitive class
 293             boolean x = (boolean) vh.getAcquire(recv);
 294         });
 295         // Incorrect arity
 296         checkWMTE(() -&gt; { // 0
 297             String x = (String) vh.getAcquire();
 298         });
 299         checkWMTE(() -&gt; { // &gt;
 300             String x = (String) vh.getAcquire(recv, Void.class);
 301         });
 302 
 303 
 304         // SetRelease
 305         // Incorrect argument types
 306         checkNPE(() -&gt; { // null receiver
 307             vh.setRelease(null, &quot;foo&quot;);
 308         });
 309         checkCCE(() -&gt; { // receiver reference class
 310             vh.setRelease(Void.class, &quot;foo&quot;);
 311         });
 312         checkCCE(() -&gt; { // value reference class
 313             vh.setRelease(recv, Void.class);
 314         });
 315         checkWMTE(() -&gt; { // receiver primitive class
 316             vh.setRelease(0, &quot;foo&quot;);
 317         });
 318         // Incorrect arity
 319         checkWMTE(() -&gt; { // 0
 320             vh.setRelease();
 321         });
 322         checkWMTE(() -&gt; { // &gt;
 323             vh.setRelease(recv, &quot;foo&quot;, Void.class);
 324         });
 325 
 326 
 327         // CompareAndSet
 328         // Incorrect argument types
 329         checkNPE(() -&gt; { // null receiver
 330             boolean r = vh.compareAndSet(null, &quot;foo&quot;, &quot;foo&quot;);
 331         });
 332         checkCCE(() -&gt; { // receiver reference class
 333             boolean r = vh.compareAndSet(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 334         });
 335         checkCCE(() -&gt; { // expected reference class
 336             boolean r = vh.compareAndSet(recv, Void.class, &quot;foo&quot;);
 337         });
 338         checkCCE(() -&gt; { // actual reference class
 339             boolean r = vh.compareAndSet(recv, &quot;foo&quot;, Void.class);
 340         });
 341         checkWMTE(() -&gt; { // receiver primitive class
 342             boolean r = vh.compareAndSet(0, &quot;foo&quot;, &quot;foo&quot;);
 343         });
 344         // Incorrect arity
 345         checkWMTE(() -&gt; { // 0
 346             boolean r = vh.compareAndSet();
 347         });
 348         checkWMTE(() -&gt; { // &gt;
 349             boolean r = vh.compareAndSet(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 350         });
 351 
 352 
 353         // WeakCompareAndSet
 354         // Incorrect argument types
 355         checkNPE(() -&gt; { // null receiver
 356             boolean r = vh.weakCompareAndSetPlain(null, &quot;foo&quot;, &quot;foo&quot;);
 357         });
 358         checkCCE(() -&gt; { // receiver reference class
 359             boolean r = vh.weakCompareAndSetPlain(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 360         });
 361         checkCCE(() -&gt; { // expected reference class
 362             boolean r = vh.weakCompareAndSetPlain(recv, Void.class, &quot;foo&quot;);
 363         });
 364         checkCCE(() -&gt; { // actual reference class
 365             boolean r = vh.weakCompareAndSetPlain(recv, &quot;foo&quot;, Void.class);
 366         });
 367         checkWMTE(() -&gt; { // receiver primitive class
 368             boolean r = vh.weakCompareAndSetPlain(0, &quot;foo&quot;, &quot;foo&quot;);
 369         });
 370         // Incorrect arity
 371         checkWMTE(() -&gt; { // 0
 372             boolean r = vh.weakCompareAndSetPlain();
 373         });
 374         checkWMTE(() -&gt; { // &gt;
 375             boolean r = vh.weakCompareAndSetPlain(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 376         });
 377 
 378 
 379         // WeakCompareAndSetVolatile
 380         // Incorrect argument types
 381         checkNPE(() -&gt; { // null receiver
 382             boolean r = vh.weakCompareAndSet(null, &quot;foo&quot;, &quot;foo&quot;);
 383         });
 384         checkCCE(() -&gt; { // receiver reference class
 385             boolean r = vh.weakCompareAndSet(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 386         });
 387         checkCCE(() -&gt; { // expected reference class
 388             boolean r = vh.weakCompareAndSet(recv, Void.class, &quot;foo&quot;);
 389         });
 390         checkCCE(() -&gt; { // actual reference class
 391             boolean r = vh.weakCompareAndSet(recv, &quot;foo&quot;, Void.class);
 392         });
 393         checkWMTE(() -&gt; { // receiver primitive class
 394             boolean r = vh.weakCompareAndSet(0, &quot;foo&quot;, &quot;foo&quot;);
 395         });
 396         // Incorrect arity
 397         checkWMTE(() -&gt; { // 0
 398             boolean r = vh.weakCompareAndSet();
 399         });
 400         checkWMTE(() -&gt; { // &gt;
 401             boolean r = vh.weakCompareAndSet(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 402         });
 403 
 404 
 405         // WeakCompareAndSetAcquire
 406         // Incorrect argument types
 407         checkNPE(() -&gt; { // null receiver
 408             boolean r = vh.weakCompareAndSetAcquire(null, &quot;foo&quot;, &quot;foo&quot;);
 409         });
 410         checkCCE(() -&gt; { // receiver reference class
 411             boolean r = vh.weakCompareAndSetAcquire(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 412         });
 413         checkCCE(() -&gt; { // expected reference class
 414             boolean r = vh.weakCompareAndSetAcquire(recv, Void.class, &quot;foo&quot;);
 415         });
 416         checkCCE(() -&gt; { // actual reference class
 417             boolean r = vh.weakCompareAndSetAcquire(recv, &quot;foo&quot;, Void.class);
 418         });
 419         checkWMTE(() -&gt; { // receiver primitive class
 420             boolean r = vh.weakCompareAndSetAcquire(0, &quot;foo&quot;, &quot;foo&quot;);
 421         });
 422         // Incorrect arity
 423         checkWMTE(() -&gt; { // 0
 424             boolean r = vh.weakCompareAndSetAcquire();
 425         });
 426         checkWMTE(() -&gt; { // &gt;
 427             boolean r = vh.weakCompareAndSetAcquire(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 428         });
 429 
 430 
 431         // WeakCompareAndSetRelease
 432         // Incorrect argument types
 433         checkNPE(() -&gt; { // null receiver
 434             boolean r = vh.weakCompareAndSetRelease(null, &quot;foo&quot;, &quot;foo&quot;);
 435         });
 436         checkCCE(() -&gt; { // receiver reference class
 437             boolean r = vh.weakCompareAndSetRelease(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 438         });
 439         checkCCE(() -&gt; { // expected reference class
 440             boolean r = vh.weakCompareAndSetRelease(recv, Void.class, &quot;foo&quot;);
 441         });
 442         checkCCE(() -&gt; { // actual reference class
 443             boolean r = vh.weakCompareAndSetRelease(recv, &quot;foo&quot;, Void.class);
 444         });
 445         checkWMTE(() -&gt; { // receiver primitive class
 446             boolean r = vh.weakCompareAndSetRelease(0, &quot;foo&quot;, &quot;foo&quot;);
 447         });
 448         // Incorrect arity
 449         checkWMTE(() -&gt; { // 0
 450             boolean r = vh.weakCompareAndSetRelease();
 451         });
 452         checkWMTE(() -&gt; { // &gt;
 453             boolean r = vh.weakCompareAndSetRelease(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 454         });
 455 
 456 
 457         // CompareAndExchange
 458         // Incorrect argument types
 459         checkNPE(() -&gt; { // null receiver
 460             String x = (String) vh.compareAndExchange(null, &quot;foo&quot;, &quot;foo&quot;);
 461         });
 462         checkCCE(() -&gt; { // receiver reference class
 463             String x = (String) vh.compareAndExchange(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 464         });
 465         checkCCE(() -&gt; { // expected reference class
 466             String x = (String) vh.compareAndExchange(recv, Void.class, &quot;foo&quot;);
 467         });
 468         checkCCE(() -&gt; { // actual reference class
 469             String x = (String) vh.compareAndExchange(recv, &quot;foo&quot;, Void.class);
 470         });
 471         checkWMTE(() -&gt; { // reciever primitive class
 472             String x = (String) vh.compareAndExchange(0, &quot;foo&quot;, &quot;foo&quot;);
 473         });
 474         // Incorrect return type
 475         checkCCE(() -&gt; { // reference class
 476             Void r = (Void) vh.compareAndExchange(recv, &quot;foo&quot;, &quot;foo&quot;);
 477         });
 478         checkWMTE(() -&gt; { // primitive class
 479             boolean x = (boolean) vh.compareAndExchange(recv, &quot;foo&quot;, &quot;foo&quot;);
 480         });
 481         // Incorrect arity
 482         checkWMTE(() -&gt; { // 0
 483             String x = (String) vh.compareAndExchange();
 484         });
 485         checkWMTE(() -&gt; { // &gt;
 486             String x = (String) vh.compareAndExchange(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 487         });
 488 
 489 
 490         // CompareAndExchangeAcquire
 491         // Incorrect argument types
 492         checkNPE(() -&gt; { // null receiver
 493             String x = (String) vh.compareAndExchangeAcquire(null, &quot;foo&quot;, &quot;foo&quot;);
 494         });
 495         checkCCE(() -&gt; { // receiver reference class
 496             String x = (String) vh.compareAndExchangeAcquire(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 497         });
 498         checkCCE(() -&gt; { // expected reference class
 499             String x = (String) vh.compareAndExchangeAcquire(recv, Void.class, &quot;foo&quot;);
 500         });
 501         checkCCE(() -&gt; { // actual reference class
 502             String x = (String) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, Void.class);
 503         });
 504         checkWMTE(() -&gt; { // reciever primitive class
 505             String x = (String) vh.compareAndExchangeAcquire(0, &quot;foo&quot;, &quot;foo&quot;);
 506         });
 507         // Incorrect return type
 508         checkCCE(() -&gt; { // reference class
 509             Void r = (Void) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, &quot;foo&quot;);
 510         });
 511         checkWMTE(() -&gt; { // primitive class
 512             boolean x = (boolean) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, &quot;foo&quot;);
 513         });
 514         // Incorrect arity
 515         checkWMTE(() -&gt; { // 0
 516             String x = (String) vh.compareAndExchangeAcquire();
 517         });
 518         checkWMTE(() -&gt; { // &gt;
 519             String x = (String) vh.compareAndExchangeAcquire(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 520         });
 521 
 522 
 523         // CompareAndExchangeRelease
 524         // Incorrect argument types
 525         checkNPE(() -&gt; { // null receiver
 526             String x = (String) vh.compareAndExchangeRelease(null, &quot;foo&quot;, &quot;foo&quot;);
 527         });
 528         checkCCE(() -&gt; { // receiver reference class
 529             String x = (String) vh.compareAndExchangeRelease(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 530         });
 531         checkCCE(() -&gt; { // expected reference class
 532             String x = (String) vh.compareAndExchangeRelease(recv, Void.class, &quot;foo&quot;);
 533         });
 534         checkCCE(() -&gt; { // actual reference class
 535             String x = (String) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, Void.class);
 536         });
 537         checkWMTE(() -&gt; { // reciever primitive class
 538             String x = (String) vh.compareAndExchangeRelease(0, &quot;foo&quot;, &quot;foo&quot;);
 539         });
 540         // Incorrect return type
 541         checkCCE(() -&gt; { // reference class
 542             Void r = (Void) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, &quot;foo&quot;);
 543         });
 544         checkWMTE(() -&gt; { // primitive class
 545             boolean x = (boolean) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, &quot;foo&quot;);
 546         });
 547         // Incorrect arity
 548         checkWMTE(() -&gt; { // 0
 549             String x = (String) vh.compareAndExchangeRelease();
 550         });
 551         checkWMTE(() -&gt; { // &gt;
 552             String x = (String) vh.compareAndExchangeRelease(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 553         });
 554 
 555 
 556         // GetAndSet
 557         // Incorrect argument types
 558         checkNPE(() -&gt; { // null receiver
 559             String x = (String) vh.getAndSet(null, &quot;foo&quot;);
 560         });
 561         checkCCE(() -&gt; { // receiver reference class
 562             String x = (String) vh.getAndSet(Void.class, &quot;foo&quot;);
 563         });
 564         checkCCE(() -&gt; { // value reference class
 565             String x = (String) vh.getAndSet(recv, Void.class);
 566         });
 567         checkWMTE(() -&gt; { // reciever primitive class
 568             String x = (String) vh.getAndSet(0, &quot;foo&quot;);
 569         });
 570         // Incorrect return type
 571         checkCCE(() -&gt; { // reference class
 572             Void r = (Void) vh.getAndSet(recv, &quot;foo&quot;);
 573         });
 574         checkWMTE(() -&gt; { // primitive class
 575             boolean x = (boolean) vh.getAndSet(recv, &quot;foo&quot;);
 576         });
 577         // Incorrect arity
 578         checkWMTE(() -&gt; { // 0
 579             String x = (String) vh.getAndSet();
 580         });
 581         checkWMTE(() -&gt; { // &gt;
 582             String x = (String) vh.getAndSet(recv, &quot;foo&quot;, Void.class);
 583         });
 584 
 585         // GetAndSetAcquire
 586         // Incorrect argument types
 587         checkNPE(() -&gt; { // null receiver
 588             String x = (String) vh.getAndSetAcquire(null, &quot;foo&quot;);
 589         });
 590         checkCCE(() -&gt; { // receiver reference class
 591             String x = (String) vh.getAndSetAcquire(Void.class, &quot;foo&quot;);
 592         });
 593         checkCCE(() -&gt; { // value reference class
 594             String x = (String) vh.getAndSetAcquire(recv, Void.class);
 595         });
 596         checkWMTE(() -&gt; { // reciever primitive class
 597             String x = (String) vh.getAndSetAcquire(0, &quot;foo&quot;);
 598         });
 599         // Incorrect return type
 600         checkCCE(() -&gt; { // reference class
 601             Void r = (Void) vh.getAndSetAcquire(recv, &quot;foo&quot;);
 602         });
 603         checkWMTE(() -&gt; { // primitive class
 604             boolean x = (boolean) vh.getAndSetAcquire(recv, &quot;foo&quot;);
 605         });
 606         // Incorrect arity
 607         checkWMTE(() -&gt; { // 0
 608             String x = (String) vh.getAndSetAcquire();
 609         });
 610         checkWMTE(() -&gt; { // &gt;
 611             String x = (String) vh.getAndSetAcquire(recv, &quot;foo&quot;, Void.class);
 612         });
 613 
 614         // GetAndSetRelease
 615         // Incorrect argument types
 616         checkNPE(() -&gt; { // null receiver
 617             String x = (String) vh.getAndSetRelease(null, &quot;foo&quot;);
 618         });
 619         checkCCE(() -&gt; { // receiver reference class
 620             String x = (String) vh.getAndSetRelease(Void.class, &quot;foo&quot;);
 621         });
 622         checkCCE(() -&gt; { // value reference class
 623             String x = (String) vh.getAndSetRelease(recv, Void.class);
 624         });
 625         checkWMTE(() -&gt; { // reciever primitive class
 626             String x = (String) vh.getAndSetRelease(0, &quot;foo&quot;);
 627         });
 628         // Incorrect return type
 629         checkCCE(() -&gt; { // reference class
 630             Void r = (Void) vh.getAndSetRelease(recv, &quot;foo&quot;);
 631         });
 632         checkWMTE(() -&gt; { // primitive class
 633             boolean x = (boolean) vh.getAndSetRelease(recv, &quot;foo&quot;);
 634         });
 635         // Incorrect arity
 636         checkWMTE(() -&gt; { // 0
 637             String x = (String) vh.getAndSetRelease();
 638         });
 639         checkWMTE(() -&gt; { // &gt;
 640             String x = (String) vh.getAndSetRelease(recv, &quot;foo&quot;, Void.class);
 641         });
 642 
 643 
 644     }
 645 
 646     static void testInstanceFieldWrongMethodType(VarHandleTestMethodTypeString recv, Handles hs) throws Throwable {
 647         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET)) {
 648             // Incorrect argument types
 649             checkNPE(() -&gt; { // null receiver
 650                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class)).
 651                     invokeExact((VarHandleTestMethodTypeString) null);
 652             });
 653             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 654                 String x = (String) hs.get(am, methodType(String.class, Class.class)).
 655                     invokeExact(Void.class);
 656             });
 657             checkWMTE(() -&gt; { // receiver primitive class
 658                 String x = (String) hs.get(am, methodType(String.class, int.class)).
 659                     invokeExact(0);
 660             });
 661             // Incorrect return type
 662             hs.checkWMTEOrCCE(() -&gt; { // reference class
 663                 Void x = (Void) hs.get(am, methodType(Void.class, VarHandleTestMethodTypeString.class)).
 664                     invokeExact(recv);
 665             });
 666             checkWMTE(() -&gt; { // primitive class
 667                 boolean x = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class)).
 668                     invokeExact(recv);
 669             });
 670             // Incorrect arity
 671             checkWMTE(() -&gt; { // 0
 672                 String x = (String) hs.get(am, methodType(String.class)).
 673                     invokeExact();
 674             });
 675             checkWMTE(() -&gt; { // &gt;
 676                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, Class.class)).
 677                     invokeExact(recv, Void.class);
 678             });
 679         }
 680 
 681         for (TestAccessMode am : testAccessModesOfType(TestAccessType.SET)) {
 682             // Incorrect argument types
 683             checkNPE(() -&gt; { // null receiver
 684                 hs.get(am, methodType(void.class, VarHandleTestMethodTypeString.class, String.class)).
 685                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;);
 686             });
 687             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 688                 hs.get(am, methodType(void.class, Class.class, String.class)).
 689                     invokeExact(Void.class, &quot;foo&quot;);
 690             });
 691             hs.checkWMTEOrCCE(() -&gt; { // value reference class
 692                 hs.get(am, methodType(void.class, VarHandleTestMethodTypeString.class, Class.class)).
 693                     invokeExact(recv, Void.class);
 694             });
 695             checkWMTE(() -&gt; { // receiver primitive class
 696                 hs.get(am, methodType(void.class, int.class, String.class)).
 697                     invokeExact(0, &quot;foo&quot;);
 698             });
 699             // Incorrect arity
 700             checkWMTE(() -&gt; { // 0
 701                 hs.get(am, methodType(void.class)).
 702                     invokeExact();
 703             });
 704             checkWMTE(() -&gt; { // &gt;
 705                 hs.get(am, methodType(void.class, VarHandleTestMethodTypeString.class, String.class, Class.class)).
 706                     invokeExact(recv, &quot;foo&quot;, Void.class);
 707             });
 708         }
 709 
 710         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_SET)) {
 711             // Incorrect argument types
 712             checkNPE(() -&gt; { // null receiver
 713                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class, String.class)).
 714                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;, &quot;foo&quot;);
 715             });
 716             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 717                 boolean r = (boolean) hs.get(am, methodType(boolean.class, Class.class, String.class, String.class)).
 718                     invokeExact(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 719             });
 720             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
 721                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, Class.class, String.class)).
 722                     invokeExact(recv, Void.class, &quot;foo&quot;);
 723             });
 724             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
 725                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class, Class.class)).
 726                     invokeExact(recv, &quot;foo&quot;, Void.class);
 727             });
 728             checkWMTE(() -&gt; { // receiver primitive class
 729                 boolean r = (boolean) hs.get(am, methodType(boolean.class, int.class , String.class, String.class)).
 730                     invokeExact(0, &quot;foo&quot;, &quot;foo&quot;);
 731             });
 732             // Incorrect arity
 733             checkWMTE(() -&gt; { // 0
 734                 boolean r = (boolean) hs.get(am, methodType(boolean.class)).
 735                     invokeExact();
 736             });
 737             checkWMTE(() -&gt; { // &gt;
 738                 boolean r = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class, String.class, Class.class)).
 739                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 740             });
 741         }
 742 
 743         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_EXCHANGE)) {
 744             checkNPE(() -&gt; { // null receiver
 745                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class, String.class)).
 746                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;, &quot;foo&quot;);
 747             });
 748             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 749                 String x = (String) hs.get(am, methodType(String.class, Class.class, String.class, String.class)).
 750                     invokeExact(Void.class, &quot;foo&quot;, &quot;foo&quot;);
 751             });
 752             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
 753                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, Class.class, String.class)).
 754                     invokeExact(recv, Void.class, &quot;foo&quot;);
 755             });
 756             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
 757                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class, Class.class)).
 758                     invokeExact(recv, &quot;foo&quot;, Void.class);
 759             });
 760             checkWMTE(() -&gt; { // reciever primitive class
 761                 String x = (String) hs.get(am, methodType(String.class, int.class , String.class, String.class)).
 762                     invokeExact(0, &quot;foo&quot;, &quot;foo&quot;);
 763             });
 764             // Incorrect return type
 765             hs.checkWMTEOrCCE(() -&gt; { // reference class
 766                 Void r = (Void) hs.get(am, methodType(Void.class, VarHandleTestMethodTypeString.class , String.class, String.class)).
 767                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;);
 768             });
 769             checkWMTE(() -&gt; { // primitive class
 770                 boolean x = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class , String.class, String.class)).
 771                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;);
 772             });
 773             // Incorrect arity
 774             checkWMTE(() -&gt; { // 0
 775                 String x = (String) hs.get(am, methodType(String.class)).
 776                     invokeExact();
 777             });
 778             checkWMTE(() -&gt; { // &gt;
 779                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class, String.class, Class.class)).
 780                     invokeExact(recv, &quot;foo&quot;, &quot;foo&quot;, Void.class);
 781             });
 782         }
 783 
 784         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET_AND_SET)) {
 785             checkNPE(() -&gt; { // null receiver
 786                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class)).
 787                     invokeExact((VarHandleTestMethodTypeString) null, &quot;foo&quot;);
 788             });
 789             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
 790                 String x = (String) hs.get(am, methodType(String.class, Class.class, String.class)).
 791                     invokeExact(Void.class, &quot;foo&quot;);
 792             });
 793             hs.checkWMTEOrCCE(() -&gt; { // value reference class
 794                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, Class.class)).
 795                     invokeExact(recv, Void.class);
 796             });
 797             checkWMTE(() -&gt; { // reciever primitive class
 798                 String x = (String) hs.get(am, methodType(String.class, int.class, String.class)).
 799                     invokeExact(0, &quot;foo&quot;);
 800             });
 801             // Incorrect return type
 802             hs.checkWMTEOrCCE(() -&gt; { // reference class
 803                 Void r = (Void) hs.get(am, methodType(Void.class, VarHandleTestMethodTypeString.class, String.class)).
 804                     invokeExact(recv, &quot;foo&quot;);
 805             });
 806             checkWMTE(() -&gt; { // primitive class
 807                 boolean x = (boolean) hs.get(am, methodType(boolean.class, VarHandleTestMethodTypeString.class, String.class)).
 808                     invokeExact(recv, &quot;foo&quot;);
 809             });
 810             // Incorrect arity
 811             checkWMTE(() -&gt; { // 0
 812                 String x = (String) hs.get(am, methodType(String.class)).
 813                     invokeExact();
 814             });
 815             checkWMTE(() -&gt; { // &gt;
 816                 String x = (String) hs.get(am, methodType(String.class, VarHandleTestMethodTypeString.class, String.class)).
 817                     invokeExact(recv, &quot;foo&quot;, Void.class);
 818             });
 819         }
 820 
 821 
 822     }
 823 
 824 
 825     static void testStaticFieldWrongMethodType(VarHandle vh) throws Throwable {
 826         // Get
 827         // Incorrect return type
 828         checkCCE(() -&gt; { // reference class
 829             Void x = (Void) vh.get();
 830         });
 831         checkWMTE(() -&gt; { // primitive class
 832             boolean x = (boolean) vh.get();
 833         });
 834         // Incorrect arity
 835         checkWMTE(() -&gt; { // &gt;
 836             String x = (String) vh.get(Void.class);
 837         });
 838 
 839 
 840         // Set
 841         // Incorrect argument types
 842         checkCCE(() -&gt; { // value reference class
 843             vh.set(Void.class);
 844         });
 845         // Incorrect arity
 846         checkWMTE(() -&gt; { // 0
 847             vh.set();
 848         });
 849         checkWMTE(() -&gt; { // &gt;
 850             vh.set(&quot;foo&quot;, Void.class);
 851         });
 852 
 853 
 854         // GetVolatile
 855         // Incorrect return type
 856         checkCCE(() -&gt; { // reference class
 857             Void x = (Void) vh.getVolatile();
 858         });
 859         checkWMTE(() -&gt; { // primitive class
 860             boolean x = (boolean) vh.getVolatile();
 861         });
 862         checkWMTE(() -&gt; { // &gt;
 863             String x = (String) vh.getVolatile(Void.class);
 864         });
 865 
 866 
 867         // SetVolatile
 868         // Incorrect argument types
 869         checkCCE(() -&gt; { // value reference class
 870             vh.setVolatile(Void.class);
 871         });
 872         // Incorrect arity
 873         checkWMTE(() -&gt; { // 0
 874             vh.setVolatile();
 875         });
 876         checkWMTE(() -&gt; { // &gt;
 877             vh.setVolatile(&quot;foo&quot;, Void.class);
 878         });
 879 
 880 
 881         // GetOpaque
 882         // Incorrect return type
 883         checkCCE(() -&gt; { // reference class
 884             Void x = (Void) vh.getOpaque();
 885         });
 886         checkWMTE(() -&gt; { // primitive class
 887             boolean x = (boolean) vh.getOpaque();
 888         });
 889         checkWMTE(() -&gt; { // &gt;
 890             String x = (String) vh.getOpaque(Void.class);
 891         });
 892 
 893 
 894         // SetOpaque
 895         // Incorrect argument types
 896         checkCCE(() -&gt; { // value reference class
 897             vh.setOpaque(Void.class);
 898         });
 899         // Incorrect arity
 900         checkWMTE(() -&gt; { // 0
 901             vh.setOpaque();
 902         });
 903         checkWMTE(() -&gt; { // &gt;
 904             vh.setOpaque(&quot;foo&quot;, Void.class);
 905         });
 906 
 907 
 908         // GetAcquire
 909         // Incorrect return type
 910         checkCCE(() -&gt; { // reference class
 911             Void x = (Void) vh.getAcquire();
 912         });
 913         checkWMTE(() -&gt; { // primitive class
 914             boolean x = (boolean) vh.getAcquire();
 915         });
 916         checkWMTE(() -&gt; { // &gt;
 917             String x = (String) vh.getAcquire(Void.class);
 918         });
 919 
 920 
 921         // SetRelease
 922         // Incorrect argument types
 923         checkCCE(() -&gt; { // value reference class
 924             vh.setRelease(Void.class);
 925         });
 926         // Incorrect arity
 927         checkWMTE(() -&gt; { // 0
 928             vh.setRelease();
 929         });
 930         checkWMTE(() -&gt; { // &gt;
 931             vh.setRelease(&quot;foo&quot;, Void.class);
 932         });
 933 
 934 
 935         // CompareAndSet
 936         // Incorrect argument types
 937         checkCCE(() -&gt; { // expected reference class
 938             boolean r = vh.compareAndSet(Void.class, &quot;foo&quot;);
 939         });
 940         checkCCE(() -&gt; { // actual reference class
 941             boolean r = vh.compareAndSet(&quot;foo&quot;, Void.class);
 942         });
 943         // Incorrect arity
 944         checkWMTE(() -&gt; { // 0
 945             boolean r = vh.compareAndSet();
 946         });
 947         checkWMTE(() -&gt; { // &gt;
 948             boolean r = vh.compareAndSet(&quot;foo&quot;, &quot;foo&quot;, Void.class);
 949         });
 950 
 951 
 952         // WeakCompareAndSet
 953         // Incorrect argument types
 954         checkCCE(() -&gt; { // expected reference class
 955             boolean r = vh.weakCompareAndSetPlain(Void.class, &quot;foo&quot;);
 956         });
 957         checkCCE(() -&gt; { // actual reference class
 958             boolean r = vh.weakCompareAndSetPlain(&quot;foo&quot;, Void.class);
 959         });
 960         // Incorrect arity
 961         checkWMTE(() -&gt; { // 0
 962             boolean r = vh.weakCompareAndSetPlain();
 963         });
 964         checkWMTE(() -&gt; { // &gt;
 965             boolean r = vh.weakCompareAndSetPlain(&quot;foo&quot;, &quot;foo&quot;, Void.class);
 966         });
 967 
 968 
 969         // WeakCompareAndSetVolatile
 970         // Incorrect argument types
 971         checkCCE(() -&gt; { // expected reference class
 972             boolean r = vh.weakCompareAndSet(Void.class, &quot;foo&quot;);
 973         });
 974         checkCCE(() -&gt; { // actual reference class
 975             boolean r = vh.weakCompareAndSet(&quot;foo&quot;, Void.class);
 976         });
 977         // Incorrect arity
 978         checkWMTE(() -&gt; { // 0
 979             boolean r = vh.weakCompareAndSet();
 980         });
 981         checkWMTE(() -&gt; { // &gt;
 982             boolean r = vh.weakCompareAndSet(&quot;foo&quot;, &quot;foo&quot;, Void.class);
 983         });
 984 
 985 
 986         // WeakCompareAndSetAcquire
 987         // Incorrect argument types
 988         checkCCE(() -&gt; { // expected reference class
 989             boolean r = vh.weakCompareAndSetAcquire(Void.class, &quot;foo&quot;);
 990         });
 991         checkCCE(() -&gt; { // actual reference class
 992             boolean r = vh.weakCompareAndSetAcquire(&quot;foo&quot;, Void.class);
 993         });
 994         // Incorrect arity
 995         checkWMTE(() -&gt; { // 0
 996             boolean r = vh.weakCompareAndSetAcquire();
 997         });
 998         checkWMTE(() -&gt; { // &gt;
 999             boolean r = vh.weakCompareAndSetAcquire(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1000         });
1001 
1002 
1003         // WeakCompareAndSetRelease
1004         // Incorrect argument types
1005         checkCCE(() -&gt; { // expected reference class
1006             boolean r = vh.weakCompareAndSetRelease(Void.class, &quot;foo&quot;);
1007         });
1008         checkCCE(() -&gt; { // actual reference class
1009             boolean r = vh.weakCompareAndSetRelease(&quot;foo&quot;, Void.class);
1010         });
1011         // Incorrect arity
1012         checkWMTE(() -&gt; { // 0
1013             boolean r = vh.weakCompareAndSetRelease();
1014         });
1015         checkWMTE(() -&gt; { // &gt;
1016             boolean r = vh.weakCompareAndSetRelease(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1017         });
1018 
1019 
1020         // CompareAndExchange
1021         // Incorrect argument types
1022         checkCCE(() -&gt; { // expected reference class
1023             String x = (String) vh.compareAndExchange(Void.class, &quot;foo&quot;);
1024         });
1025         checkCCE(() -&gt; { // actual reference class
1026             String x = (String) vh.compareAndExchange(&quot;foo&quot;, Void.class);
1027         });
1028         // Incorrect return type
1029         checkCCE(() -&gt; { // reference class
1030             Void r = (Void) vh.compareAndExchange(&quot;foo&quot;, &quot;foo&quot;);
1031         });
1032         checkWMTE(() -&gt; { // primitive class
1033             boolean x = (boolean) vh.compareAndExchange(&quot;foo&quot;, &quot;foo&quot;);
1034         });
1035         // Incorrect arity
1036         checkWMTE(() -&gt; { // 0
1037             String x = (String) vh.compareAndExchange();
1038         });
1039         checkWMTE(() -&gt; { // &gt;
1040             String x = (String) vh.compareAndExchange(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1041         });
1042 
1043 
1044         // CompareAndExchangeAcquire
1045         // Incorrect argument types
1046         checkCCE(() -&gt; { // expected reference class
1047             String x = (String) vh.compareAndExchangeAcquire(Void.class, &quot;foo&quot;);
1048         });
1049         checkCCE(() -&gt; { // actual reference class
1050             String x = (String) vh.compareAndExchangeAcquire(&quot;foo&quot;, Void.class);
1051         });
1052         // Incorrect return type
1053         checkCCE(() -&gt; { // reference class
1054             Void r = (Void) vh.compareAndExchangeAcquire(&quot;foo&quot;, &quot;foo&quot;);
1055         });
1056         checkWMTE(() -&gt; { // primitive class
1057             boolean x = (boolean) vh.compareAndExchangeAcquire(&quot;foo&quot;, &quot;foo&quot;);
1058         });
1059         // Incorrect arity
1060         checkWMTE(() -&gt; { // 0
1061             String x = (String) vh.compareAndExchangeAcquire();
1062         });
1063         checkWMTE(() -&gt; { // &gt;
1064             String x = (String) vh.compareAndExchangeAcquire(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1065         });
1066 
1067 
1068         // CompareAndExchangeRelease
1069         // Incorrect argument types
1070         checkCCE(() -&gt; { // expected reference class
1071             String x = (String) vh.compareAndExchangeRelease(Void.class, &quot;foo&quot;);
1072         });
1073         checkCCE(() -&gt; { // actual reference class
1074             String x = (String) vh.compareAndExchangeRelease(&quot;foo&quot;, Void.class);
1075         });
1076         // Incorrect return type
1077         checkCCE(() -&gt; { // reference class
1078             Void r = (Void) vh.compareAndExchangeRelease(&quot;foo&quot;, &quot;foo&quot;);
1079         });
1080         checkWMTE(() -&gt; { // primitive class
1081             boolean x = (boolean) vh.compareAndExchangeRelease(&quot;foo&quot;, &quot;foo&quot;);
1082         });
1083         // Incorrect arity
1084         checkWMTE(() -&gt; { // 0
1085             String x = (String) vh.compareAndExchangeRelease();
1086         });
1087         checkWMTE(() -&gt; { // &gt;
1088             String x = (String) vh.compareAndExchangeRelease(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1089         });
1090 
1091 
1092         // GetAndSet
1093         // Incorrect argument types
1094         checkCCE(() -&gt; { // value reference class
1095             String x = (String) vh.getAndSet(Void.class);
1096         });
1097         // Incorrect return type
1098         checkCCE(() -&gt; { // reference class
1099             Void r = (Void) vh.getAndSet(&quot;foo&quot;);
1100         });
1101         checkWMTE(() -&gt; { // primitive class
1102             boolean x = (boolean) vh.getAndSet(&quot;foo&quot;);
1103         });
1104         // Incorrect arity
1105         checkWMTE(() -&gt; { // 0
1106             String x = (String) vh.getAndSet();
1107         });
1108         checkWMTE(() -&gt; { // &gt;
1109             String x = (String) vh.getAndSet(&quot;foo&quot;, Void.class);
1110         });
1111 
1112 
1113         // GetAndSetAcquire
1114         // Incorrect argument types
1115         checkCCE(() -&gt; { // value reference class
1116             String x = (String) vh.getAndSetAcquire(Void.class);
1117         });
1118         // Incorrect return type
1119         checkCCE(() -&gt; { // reference class
1120             Void r = (Void) vh.getAndSetAcquire(&quot;foo&quot;);
1121         });
1122         checkWMTE(() -&gt; { // primitive class
1123             boolean x = (boolean) vh.getAndSetAcquire(&quot;foo&quot;);
1124         });
1125         // Incorrect arity
1126         checkWMTE(() -&gt; { // 0
1127             String x = (String) vh.getAndSetAcquire();
1128         });
1129         checkWMTE(() -&gt; { // &gt;
1130             String x = (String) vh.getAndSetAcquire(&quot;foo&quot;, Void.class);
1131         });
1132 
1133 
1134         // GetAndSetRelease
1135         // Incorrect argument types
1136         checkCCE(() -&gt; { // value reference class
1137             String x = (String) vh.getAndSetRelease(Void.class);
1138         });
1139         // Incorrect return type
1140         checkCCE(() -&gt; { // reference class
1141             Void r = (Void) vh.getAndSetRelease(&quot;foo&quot;);
1142         });
1143         checkWMTE(() -&gt; { // primitive class
1144             boolean x = (boolean) vh.getAndSetRelease(&quot;foo&quot;);
1145         });
1146         // Incorrect arity
1147         checkWMTE(() -&gt; { // 0
1148             String x = (String) vh.getAndSetRelease();
1149         });
1150         checkWMTE(() -&gt; { // &gt;
1151             String x = (String) vh.getAndSetRelease(&quot;foo&quot;, Void.class);
1152         });
1153 
1154 
1155     }
1156 
1157     static void testStaticFieldWrongMethodType(Handles hs) throws Throwable {
1158         int i = 0;
1159 
1160         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET)) {
1161             // Incorrect return type
1162             hs.checkWMTEOrCCE(() -&gt; { // reference class
1163                 Void x = (Void) hs.get(am, methodType(Void.class)).
1164                     invokeExact();
1165             });
1166             checkWMTE(() -&gt; { // primitive class
1167                 boolean x = (boolean) hs.get(am, methodType(boolean.class)).
1168                     invokeExact();
1169             });
1170             // Incorrect arity
1171             checkWMTE(() -&gt; { // &gt;
1172                 String x = (String) hs.get(am, methodType(Class.class)).
1173                     invokeExact(Void.class);
1174             });
1175         }
1176 
1177         for (TestAccessMode am : testAccessModesOfType(TestAccessType.SET)) {
1178             hs.checkWMTEOrCCE(() -&gt; { // value reference class
1179                 hs.get(am, methodType(void.class, Class.class)).
1180                     invokeExact(Void.class);
1181             });
1182             // Incorrect arity
1183             checkWMTE(() -&gt; { // 0
1184                 hs.get(am, methodType(void.class)).
1185                     invokeExact();
1186             });
1187             checkWMTE(() -&gt; { // &gt;
1188                 hs.get(am, methodType(void.class, String.class, Class.class)).
1189                     invokeExact(&quot;foo&quot;, Void.class);
1190             });
1191         }
1192         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_SET)) {
1193             // Incorrect argument types
1194             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1195                 boolean r = (boolean) hs.get(am, methodType(boolean.class, Class.class, String.class)).
1196                     invokeExact(Void.class, &quot;foo&quot;);
1197             });
1198             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1199                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String.class, Class.class)).
1200                     invokeExact(&quot;foo&quot;, Void.class);
1201             });
1202             // Incorrect arity
1203             checkWMTE(() -&gt; { // 0
1204                 boolean r = (boolean) hs.get(am, methodType(boolean.class)).
1205                     invokeExact();
1206             });
1207             checkWMTE(() -&gt; { // &gt;
1208                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String.class, String.class, Class.class)).
1209                     invokeExact(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1210             });
1211         }
1212 
1213         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_EXCHANGE)) {
1214             // Incorrect argument types
1215             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1216                 String x = (String) hs.get(am, methodType(String.class, Class.class, String.class)).
1217                     invokeExact(Void.class, &quot;foo&quot;);
1218             });
1219             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1220                 String x = (String) hs.get(am, methodType(String.class, String.class, Class.class)).
1221                     invokeExact(&quot;foo&quot;, Void.class);
1222             });
1223             // Incorrect return type
1224             hs.checkWMTEOrCCE(() -&gt; { // reference class
1225                 Void r = (Void) hs.get(am, methodType(Void.class, String.class, String.class)).
1226                     invokeExact(&quot;foo&quot;, &quot;foo&quot;);
1227             });
1228             checkWMTE(() -&gt; { // primitive class
1229                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String.class, String.class)).
1230                     invokeExact(&quot;foo&quot;, &quot;foo&quot;);
1231             });
1232             // Incorrect arity
1233             checkWMTE(() -&gt; { // 0
1234                 String x = (String) hs.get(am, methodType(String.class)).
1235                     invokeExact();
1236             });
1237             checkWMTE(() -&gt; { // &gt;
1238                 String x = (String) hs.get(am, methodType(String.class, String.class, String.class, Class.class)).
1239                     invokeExact(&quot;foo&quot;, &quot;foo&quot;, Void.class);
1240             });
1241         }
1242 
1243         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET_AND_SET)) {
1244             // Incorrect argument types
1245             hs.checkWMTEOrCCE(() -&gt; { // value reference class
1246                 String x = (String) hs.get(am, methodType(String.class, Class.class)).
1247                     invokeExact(Void.class);
1248             });
1249             // Incorrect return type
1250             hs.checkWMTEOrCCE(() -&gt; { // reference class
1251                 Void r = (Void) hs.get(am, methodType(Void.class, String.class)).
1252                     invokeExact(&quot;foo&quot;);
1253             });
1254             checkWMTE(() -&gt; { // primitive class
1255                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String.class)).
1256                     invokeExact(&quot;foo&quot;);
1257             });
1258             // Incorrect arity
1259             checkWMTE(() -&gt; { // 0
1260                 String x = (String) hs.get(am, methodType(String.class)).
1261                     invokeExact();
1262             });
1263             checkWMTE(() -&gt; { // &gt;
1264                 String x = (String) hs.get(am, methodType(String.class, String.class, Class.class)).
1265                     invokeExact(&quot;foo&quot;, Void.class);
1266             });
1267         }
1268 
1269 
1270     }
1271 
1272 
1273     static void testArrayWrongMethodType(VarHandle vh) throws Throwable {
1274         String[] array = new String[10];
1275         Arrays.fill(array, &quot;foo&quot;);
1276 
1277         // Get
1278         // Incorrect argument types
1279         checkNPE(() -&gt; { // null array
1280             String x = (String) vh.get(null, 0);
1281         });
1282         checkCCE(() -&gt; { // array reference class
1283             String x = (String) vh.get(Void.class, 0);
1284         });
1285         checkWMTE(() -&gt; { // array primitive class
1286             String x = (String) vh.get(0, 0);
1287         });
1288         checkWMTE(() -&gt; { // index reference class
1289             String x = (String) vh.get(array, Void.class);
1290         });
1291         // Incorrect return type
1292         checkCCE(() -&gt; { // reference class
1293             Void x = (Void) vh.get(array, 0);
1294         });
1295         checkWMTE(() -&gt; { // primitive class
1296             boolean x = (boolean) vh.get(array, 0);
1297         });
1298         // Incorrect arity
1299         checkWMTE(() -&gt; { // 0
1300             String x = (String) vh.get();
1301         });
1302         checkWMTE(() -&gt; { // &gt;
1303             String x = (String) vh.get(array, 0, Void.class);
1304         });
1305 
1306 
1307         // Set
1308         // Incorrect argument types
1309         checkNPE(() -&gt; { // null array
1310             vh.set(null, 0, &quot;foo&quot;);
1311         });
1312         checkCCE(() -&gt; { // array reference class
1313             vh.set(Void.class, 0, &quot;foo&quot;);
1314         });
1315         checkCCE(() -&gt; { // value reference class
1316             vh.set(array, 0, Void.class);
1317         });
1318         checkWMTE(() -&gt; { // receiver primitive class
1319             vh.set(0, 0, &quot;foo&quot;);
1320         });
1321         checkWMTE(() -&gt; { // index reference class
1322             vh.set(array, Void.class, &quot;foo&quot;);
1323         });
1324         // Incorrect arity
1325         checkWMTE(() -&gt; { // 0
1326             vh.set();
1327         });
1328         checkWMTE(() -&gt; { // &gt;
1329             vh.set(array, 0, &quot;foo&quot;, Void.class);
1330         });
1331 
1332 
1333         // GetVolatile
1334         // Incorrect argument types
1335         checkNPE(() -&gt; { // null array
1336             String x = (String) vh.getVolatile(null, 0);
1337         });
1338         checkCCE(() -&gt; { // array reference class
1339             String x = (String) vh.getVolatile(Void.class, 0);
1340         });
1341         checkWMTE(() -&gt; { // array primitive class
1342             String x = (String) vh.getVolatile(0, 0);
1343         });
1344         checkWMTE(() -&gt; { // index reference class
1345             String x = (String) vh.getVolatile(array, Void.class);
1346         });
1347         // Incorrect return type
1348         checkCCE(() -&gt; { // reference class
1349             Void x = (Void) vh.getVolatile(array, 0);
1350         });
1351         checkWMTE(() -&gt; { // primitive class
1352             boolean x = (boolean) vh.getVolatile(array, 0);
1353         });
1354         // Incorrect arity
1355         checkWMTE(() -&gt; { // 0
1356             String x = (String) vh.getVolatile();
1357         });
1358         checkWMTE(() -&gt; { // &gt;
1359             String x = (String) vh.getVolatile(array, 0, Void.class);
1360         });
1361 
1362 
1363         // SetVolatile
1364         // Incorrect argument types
1365         checkNPE(() -&gt; { // null array
1366             vh.setVolatile(null, 0, &quot;foo&quot;);
1367         });
1368         checkCCE(() -&gt; { // array reference class
1369             vh.setVolatile(Void.class, 0, &quot;foo&quot;);
1370         });
1371         checkCCE(() -&gt; { // value reference class
1372             vh.setVolatile(array, 0, Void.class);
1373         });
1374         checkWMTE(() -&gt; { // receiver primitive class
1375             vh.setVolatile(0, 0, &quot;foo&quot;);
1376         });
1377         checkWMTE(() -&gt; { // index reference class
1378             vh.setVolatile(array, Void.class, &quot;foo&quot;);
1379         });
1380         // Incorrect arity
1381         checkWMTE(() -&gt; { // 0
1382             vh.setVolatile();
1383         });
1384         checkWMTE(() -&gt; { // &gt;
1385             vh.setVolatile(array, 0, &quot;foo&quot;, Void.class);
1386         });
1387 
1388 
1389         // GetOpaque
1390         // Incorrect argument types
1391         checkNPE(() -&gt; { // null array
1392             String x = (String) vh.getOpaque(null, 0);
1393         });
1394         checkCCE(() -&gt; { // array reference class
1395             String x = (String) vh.getOpaque(Void.class, 0);
1396         });
1397         checkWMTE(() -&gt; { // array primitive class
1398             String x = (String) vh.getOpaque(0, 0);
1399         });
1400         checkWMTE(() -&gt; { // index reference class
1401             String x = (String) vh.getOpaque(array, Void.class);
1402         });
1403         // Incorrect return type
1404         checkCCE(() -&gt; { // reference class
1405             Void x = (Void) vh.getOpaque(array, 0);
1406         });
1407         checkWMTE(() -&gt; { // primitive class
1408             boolean x = (boolean) vh.getOpaque(array, 0);
1409         });
1410         // Incorrect arity
1411         checkWMTE(() -&gt; { // 0
1412             String x = (String) vh.getOpaque();
1413         });
1414         checkWMTE(() -&gt; { // &gt;
1415             String x = (String) vh.getOpaque(array, 0, Void.class);
1416         });
1417 
1418 
1419         // SetOpaque
1420         // Incorrect argument types
1421         checkNPE(() -&gt; { // null array
1422             vh.setOpaque(null, 0, &quot;foo&quot;);
1423         });
1424         checkCCE(() -&gt; { // array reference class
1425             vh.setOpaque(Void.class, 0, &quot;foo&quot;);
1426         });
1427         checkCCE(() -&gt; { // value reference class
1428             vh.setOpaque(array, 0, Void.class);
1429         });
1430         checkWMTE(() -&gt; { // receiver primitive class
1431             vh.setOpaque(0, 0, &quot;foo&quot;);
1432         });
1433         checkWMTE(() -&gt; { // index reference class
1434             vh.setOpaque(array, Void.class, &quot;foo&quot;);
1435         });
1436         // Incorrect arity
1437         checkWMTE(() -&gt; { // 0
1438             vh.setOpaque();
1439         });
1440         checkWMTE(() -&gt; { // &gt;
1441             vh.setOpaque(array, 0, &quot;foo&quot;, Void.class);
1442         });
1443 
1444 
1445         // GetAcquire
1446         // Incorrect argument types
1447         checkNPE(() -&gt; { // null array
1448             String x = (String) vh.getAcquire(null, 0);
1449         });
1450         checkCCE(() -&gt; { // array reference class
1451             String x = (String) vh.getAcquire(Void.class, 0);
1452         });
1453         checkWMTE(() -&gt; { // array primitive class
1454             String x = (String) vh.getAcquire(0, 0);
1455         });
1456         checkWMTE(() -&gt; { // index reference class
1457             String x = (String) vh.getAcquire(array, Void.class);
1458         });
1459         // Incorrect return type
1460         checkCCE(() -&gt; { // reference class
1461             Void x = (Void) vh.getAcquire(array, 0);
1462         });
1463         checkWMTE(() -&gt; { // primitive class
1464             boolean x = (boolean) vh.getAcquire(array, 0);
1465         });
1466         // Incorrect arity
1467         checkWMTE(() -&gt; { // 0
1468             String x = (String) vh.getAcquire();
1469         });
1470         checkWMTE(() -&gt; { // &gt;
1471             String x = (String) vh.getAcquire(array, 0, Void.class);
1472         });
1473 
1474 
1475         // SetRelease
1476         // Incorrect argument types
1477         checkNPE(() -&gt; { // null array
1478             vh.setRelease(null, 0, &quot;foo&quot;);
1479         });
1480         checkCCE(() -&gt; { // array reference class
1481             vh.setRelease(Void.class, 0, &quot;foo&quot;);
1482         });
1483         checkCCE(() -&gt; { // value reference class
1484             vh.setRelease(array, 0, Void.class);
1485         });
1486         checkWMTE(() -&gt; { // receiver primitive class
1487             vh.setRelease(0, 0, &quot;foo&quot;);
1488         });
1489         checkWMTE(() -&gt; { // index reference class
1490             vh.setRelease(array, Void.class, &quot;foo&quot;);
1491         });
1492         // Incorrect arity
1493         checkWMTE(() -&gt; { // 0
1494             vh.setRelease();
1495         });
1496         checkWMTE(() -&gt; { // &gt;
1497             vh.setRelease(array, 0, &quot;foo&quot;, Void.class);
1498         });
1499 
1500 
1501         // CompareAndSet
1502         // Incorrect argument types
1503         checkNPE(() -&gt; { // null receiver
1504             boolean r = vh.compareAndSet(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1505         });
1506         checkCCE(() -&gt; { // receiver reference class
1507             boolean r = vh.compareAndSet(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1508         });
1509         checkCCE(() -&gt; { // expected reference class
1510             boolean r = vh.compareAndSet(array, 0, Void.class, &quot;foo&quot;);
1511         });
1512         checkCCE(() -&gt; { // actual reference class
1513             boolean r = vh.compareAndSet(array, 0, &quot;foo&quot;, Void.class);
1514         });
1515         checkWMTE(() -&gt; { // receiver primitive class
1516             boolean r = vh.compareAndSet(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1517         });
1518         checkWMTE(() -&gt; { // index reference class
1519             boolean r = vh.compareAndSet(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1520         });
1521         // Incorrect arity
1522         checkWMTE(() -&gt; { // 0
1523             boolean r = vh.compareAndSet();
1524         });
1525         checkWMTE(() -&gt; { // &gt;
1526             boolean r = vh.compareAndSet(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1527         });
1528 
1529 
1530         // WeakCompareAndSet
1531         // Incorrect argument types
1532         checkNPE(() -&gt; { // null receiver
1533             boolean r = vh.weakCompareAndSetPlain(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1534         });
1535         checkCCE(() -&gt; { // receiver reference class
1536             boolean r = vh.weakCompareAndSetPlain(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1537         });
1538         checkCCE(() -&gt; { // expected reference class
1539             boolean r = vh.weakCompareAndSetPlain(array, 0, Void.class, &quot;foo&quot;);
1540         });
1541         checkCCE(() -&gt; { // actual reference class
1542             boolean r = vh.weakCompareAndSetPlain(array, 0, &quot;foo&quot;, Void.class);
1543         });
1544         checkWMTE(() -&gt; { // receiver primitive class
1545             boolean r = vh.weakCompareAndSetPlain(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1546         });
1547         checkWMTE(() -&gt; { // index reference class
1548             boolean r = vh.weakCompareAndSetPlain(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1549         });
1550         // Incorrect arity
1551         checkWMTE(() -&gt; { // 0
1552             boolean r = vh.weakCompareAndSetPlain();
1553         });
1554         checkWMTE(() -&gt; { // &gt;
1555             boolean r = vh.weakCompareAndSetPlain(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1556         });
1557 
1558 
1559         // WeakCompareAndSetVolatile
1560         // Incorrect argument types
1561         checkNPE(() -&gt; { // null receiver
1562             boolean r = vh.weakCompareAndSet(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1563         });
1564         checkCCE(() -&gt; { // receiver reference class
1565             boolean r = vh.weakCompareAndSet(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1566         });
1567         checkCCE(() -&gt; { // expected reference class
1568             boolean r = vh.weakCompareAndSet(array, 0, Void.class, &quot;foo&quot;);
1569         });
1570         checkCCE(() -&gt; { // actual reference class
1571             boolean r = vh.weakCompareAndSet(array, 0, &quot;foo&quot;, Void.class);
1572         });
1573         checkWMTE(() -&gt; { // receiver primitive class
1574             boolean r = vh.weakCompareAndSet(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1575         });
1576         checkWMTE(() -&gt; { // index reference class
1577             boolean r = vh.weakCompareAndSet(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1578         });
1579         // Incorrect arity
1580         checkWMTE(() -&gt; { // 0
1581             boolean r = vh.weakCompareAndSet();
1582         });
1583         checkWMTE(() -&gt; { // &gt;
1584             boolean r = vh.weakCompareAndSet(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1585         });
1586 
1587 
1588         // WeakCompareAndSetAcquire
1589         // Incorrect argument types
1590         checkNPE(() -&gt; { // null receiver
1591             boolean r = vh.weakCompareAndSetAcquire(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1592         });
1593         checkCCE(() -&gt; { // receiver reference class
1594             boolean r = vh.weakCompareAndSetAcquire(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1595         });
1596         checkCCE(() -&gt; { // expected reference class
1597             boolean r = vh.weakCompareAndSetAcquire(array, 0, Void.class, &quot;foo&quot;);
1598         });
1599         checkCCE(() -&gt; { // actual reference class
1600             boolean r = vh.weakCompareAndSetAcquire(array, 0, &quot;foo&quot;, Void.class);
1601         });
1602         checkWMTE(() -&gt; { // receiver primitive class
1603             boolean r = vh.weakCompareAndSetAcquire(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1604         });
1605         checkWMTE(() -&gt; { // index reference class
1606             boolean r = vh.weakCompareAndSetAcquire(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1607         });
1608         // Incorrect arity
1609         checkWMTE(() -&gt; { // 0
1610             boolean r = vh.weakCompareAndSetAcquire();
1611         });
1612         checkWMTE(() -&gt; { // &gt;
1613             boolean r = vh.weakCompareAndSetAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1614         });
1615 
1616 
1617         // WeakCompareAndSetRelease
1618         // Incorrect argument types
1619         checkNPE(() -&gt; { // null receiver
1620             boolean r = vh.weakCompareAndSetRelease(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1621         });
1622         checkCCE(() -&gt; { // receiver reference class
1623             boolean r = vh.weakCompareAndSetRelease(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1624         });
1625         checkCCE(() -&gt; { // expected reference class
1626             boolean r = vh.weakCompareAndSetRelease(array, 0, Void.class, &quot;foo&quot;);
1627         });
1628         checkCCE(() -&gt; { // actual reference class
1629             boolean r = vh.weakCompareAndSetRelease(array, 0, &quot;foo&quot;, Void.class);
1630         });
1631         checkWMTE(() -&gt; { // receiver primitive class
1632             boolean r = vh.weakCompareAndSetRelease(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1633         });
1634         checkWMTE(() -&gt; { // index reference class
1635             boolean r = vh.weakCompareAndSetRelease(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1636         });
1637         // Incorrect arity
1638         checkWMTE(() -&gt; { // 0
1639             boolean r = vh.weakCompareAndSetRelease();
1640         });
1641         checkWMTE(() -&gt; { // &gt;
1642             boolean r = vh.weakCompareAndSetRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1643         });
1644 
1645 
1646         // CompareAndExchange
1647         // Incorrect argument types
1648         checkNPE(() -&gt; { // null receiver
1649             String x = (String) vh.compareAndExchange(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1650         });
1651         checkCCE(() -&gt; { // array reference class
1652             String x = (String) vh.compareAndExchange(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1653         });
1654         checkCCE(() -&gt; { // expected reference class
1655             String x = (String) vh.compareAndExchange(array, 0, Void.class, &quot;foo&quot;);
1656         });
1657         checkCCE(() -&gt; { // actual reference class
1658             String x = (String) vh.compareAndExchange(array, 0, &quot;foo&quot;, Void.class);
1659         });
1660         checkWMTE(() -&gt; { // array primitive class
1661             String x = (String) vh.compareAndExchange(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1662         });
1663         checkWMTE(() -&gt; { // index reference class
1664             String x = (String) vh.compareAndExchange(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1665         });
1666         // Incorrect return type
1667         checkCCE(() -&gt; { // reference class
1668             Void r = (Void) vh.compareAndExchange(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1669         });
1670         checkWMTE(() -&gt; { // primitive class
1671             boolean x = (boolean) vh.compareAndExchange(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1672         });
1673         // Incorrect arity
1674         checkWMTE(() -&gt; { // 0
1675             String x = (String) vh.compareAndExchange();
1676         });
1677         checkWMTE(() -&gt; { // &gt;
1678             String x = (String) vh.compareAndExchange(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1679         });
1680 
1681 
1682         // CompareAndExchangeAcquire
1683         // Incorrect argument types
1684         checkNPE(() -&gt; { // null receiver
1685             String x = (String) vh.compareAndExchangeAcquire(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1686         });
1687         checkCCE(() -&gt; { // array reference class
1688             String x = (String) vh.compareAndExchangeAcquire(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1689         });
1690         checkCCE(() -&gt; { // expected reference class
1691             String x = (String) vh.compareAndExchangeAcquire(array, 0, Void.class, &quot;foo&quot;);
1692         });
1693         checkCCE(() -&gt; { // actual reference class
1694             String x = (String) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, Void.class);
1695         });
1696         checkWMTE(() -&gt; { // array primitive class
1697             String x = (String) vh.compareAndExchangeAcquire(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1698         });
1699         checkWMTE(() -&gt; { // index reference class
1700             String x = (String) vh.compareAndExchangeAcquire(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1701         });
1702         // Incorrect return type
1703         checkCCE(() -&gt; { // reference class
1704             Void r = (Void) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1705         });
1706         checkWMTE(() -&gt; { // primitive class
1707             boolean x = (boolean) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1708         });
1709         // Incorrect arity
1710         checkWMTE(() -&gt; { // 0
1711             String x = (String) vh.compareAndExchangeAcquire();
1712         });
1713         checkWMTE(() -&gt; { // &gt;
1714             String x = (String) vh.compareAndExchangeAcquire(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1715         });
1716 
1717 
1718         // CompareAndExchangeRelease
1719         // Incorrect argument types
1720         checkNPE(() -&gt; { // null receiver
1721             String x = (String) vh.compareAndExchangeRelease(null, 0, &quot;foo&quot;, &quot;foo&quot;);
1722         });
1723         checkCCE(() -&gt; { // array reference class
1724             String x = (String) vh.compareAndExchangeRelease(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1725         });
1726         checkCCE(() -&gt; { // expected reference class
1727             String x = (String) vh.compareAndExchangeRelease(array, 0, Void.class, &quot;foo&quot;);
1728         });
1729         checkCCE(() -&gt; { // actual reference class
1730             String x = (String) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, Void.class);
1731         });
1732         checkWMTE(() -&gt; { // array primitive class
1733             String x = (String) vh.compareAndExchangeRelease(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1734         });
1735         checkWMTE(() -&gt; { // index reference class
1736             String x = (String) vh.compareAndExchangeRelease(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1737         });
1738         // Incorrect return type
1739         checkCCE(() -&gt; { // reference class
1740             Void r = (Void) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1741         });
1742         checkWMTE(() -&gt; { // primitive class
1743             boolean x = (boolean) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1744         });
1745         // Incorrect arity
1746         checkWMTE(() -&gt; { // 0
1747             String x = (String) vh.compareAndExchangeRelease();
1748         });
1749         checkWMTE(() -&gt; { // &gt;
1750             String x = (String) vh.compareAndExchangeRelease(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1751         });
1752 
1753 
1754         // GetAndSet
1755         // Incorrect argument types
1756         checkNPE(() -&gt; { // null array
1757             String x = (String) vh.getAndSet(null, 0, &quot;foo&quot;);
1758         });
1759         checkCCE(() -&gt; { // array reference class
1760             String x = (String) vh.getAndSet(Void.class, 0, &quot;foo&quot;);
1761         });
1762         checkCCE(() -&gt; { // value reference class
1763             String x = (String) vh.getAndSet(array, 0, Void.class);
1764         });
1765         checkWMTE(() -&gt; { // reciarrayever primitive class
1766             String x = (String) vh.getAndSet(0, 0, &quot;foo&quot;);
1767         });
1768         checkWMTE(() -&gt; { // index reference class
1769             String x = (String) vh.getAndSet(array, Void.class, &quot;foo&quot;);
1770         });
1771         // Incorrect return type
1772         checkCCE(() -&gt; { // reference class
1773             Void r = (Void) vh.getAndSet(array, 0, &quot;foo&quot;);
1774         });
1775         checkWMTE(() -&gt; { // primitive class
1776             boolean x = (boolean) vh.getAndSet(array, 0, &quot;foo&quot;);
1777         });
1778         // Incorrect arity
1779         checkWMTE(() -&gt; { // 0
1780             String x = (String) vh.getAndSet();
1781         });
1782         checkWMTE(() -&gt; { // &gt;
1783             String x = (String) vh.getAndSet(array, 0, &quot;foo&quot;, Void.class);
1784         });
1785 
1786 
1787         // GetAndSetAcquire
1788         // Incorrect argument types
1789         checkNPE(() -&gt; { // null array
1790             String x = (String) vh.getAndSetAcquire(null, 0, &quot;foo&quot;);
1791         });
1792         checkCCE(() -&gt; { // array reference class
1793             String x = (String) vh.getAndSetAcquire(Void.class, 0, &quot;foo&quot;);
1794         });
1795         checkCCE(() -&gt; { // value reference class
1796             String x = (String) vh.getAndSetAcquire(array, 0, Void.class);
1797         });
1798         checkWMTE(() -&gt; { // reciarrayever primitive class
1799             String x = (String) vh.getAndSetAcquire(0, 0, &quot;foo&quot;);
1800         });
1801         checkWMTE(() -&gt; { // index reference class
1802             String x = (String) vh.getAndSetAcquire(array, Void.class, &quot;foo&quot;);
1803         });
1804         // Incorrect return type
1805         checkCCE(() -&gt; { // reference class
1806             Void r = (Void) vh.getAndSetAcquire(array, 0, &quot;foo&quot;);
1807         });
1808         checkWMTE(() -&gt; { // primitive class
1809             boolean x = (boolean) vh.getAndSetAcquire(array, 0, &quot;foo&quot;);
1810         });
1811         // Incorrect arity
1812         checkWMTE(() -&gt; { // 0
1813             String x = (String) vh.getAndSetAcquire();
1814         });
1815         checkWMTE(() -&gt; { // &gt;
1816             String x = (String) vh.getAndSetAcquire(array, 0, &quot;foo&quot;, Void.class);
1817         });
1818 
1819 
1820         // GetAndSetRelease
1821         // Incorrect argument types
1822         checkNPE(() -&gt; { // null array
1823             String x = (String) vh.getAndSetRelease(null, 0, &quot;foo&quot;);
1824         });
1825         checkCCE(() -&gt; { // array reference class
1826             String x = (String) vh.getAndSetRelease(Void.class, 0, &quot;foo&quot;);
1827         });
1828         checkCCE(() -&gt; { // value reference class
1829             String x = (String) vh.getAndSetRelease(array, 0, Void.class);
1830         });
1831         checkWMTE(() -&gt; { // reciarrayever primitive class
1832             String x = (String) vh.getAndSetRelease(0, 0, &quot;foo&quot;);
1833         });
1834         checkWMTE(() -&gt; { // index reference class
1835             String x = (String) vh.getAndSetRelease(array, Void.class, &quot;foo&quot;);
1836         });
1837         // Incorrect return type
1838         checkCCE(() -&gt; { // reference class
1839             Void r = (Void) vh.getAndSetRelease(array, 0, &quot;foo&quot;);
1840         });
1841         checkWMTE(() -&gt; { // primitive class
1842             boolean x = (boolean) vh.getAndSetRelease(array, 0, &quot;foo&quot;);
1843         });
1844         // Incorrect arity
1845         checkWMTE(() -&gt; { // 0
1846             String x = (String) vh.getAndSetRelease();
1847         });
1848         checkWMTE(() -&gt; { // &gt;
1849             String x = (String) vh.getAndSetRelease(array, 0, &quot;foo&quot;, Void.class);
1850         });
1851 
1852 
1853     }
1854 
1855     static void testArrayWrongMethodType(Handles hs) throws Throwable {
1856         String[] array = new String[10];
1857         Arrays.fill(array, &quot;foo&quot;);
1858 
1859         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET)) {
1860             // Incorrect argument types
1861             checkNPE(() -&gt; { // null array
1862                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class)).
1863                     invokeExact((String[]) null, 0);
1864             });
1865             hs.checkWMTEOrCCE(() -&gt; { // array reference class
1866                 String x = (String) hs.get(am, methodType(String.class, Class.class, int.class)).
1867                     invokeExact(Void.class, 0);
1868             });
1869             checkWMTE(() -&gt; { // array primitive class
1870                 String x = (String) hs.get(am, methodType(String.class, int.class, int.class)).
1871                     invokeExact(0, 0);
1872             });
1873             checkWMTE(() -&gt; { // index reference class
1874                 String x = (String) hs.get(am, methodType(String.class, String[].class, Class.class)).
1875                     invokeExact(array, Void.class);
1876             });
1877             // Incorrect return type
1878             hs.checkWMTEOrCCE(() -&gt; { // reference class
1879                 Void x = (Void) hs.get(am, methodType(Void.class, String[].class, int.class)).
1880                     invokeExact(array, 0);
1881             });
1882             checkWMTE(() -&gt; { // primitive class
1883                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class)).
1884                     invokeExact(array, 0);
1885             });
1886             // Incorrect arity
1887             checkWMTE(() -&gt; { // 0
1888                 String x = (String) hs.get(am, methodType(String.class)).
1889                     invokeExact();
1890             });
1891             checkWMTE(() -&gt; { // &gt;
1892                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, Class.class)).
1893                     invokeExact(array, 0, Void.class);
1894             });
1895         }
1896 
1897         for (TestAccessMode am : testAccessModesOfType(TestAccessType.SET)) {
1898             // Incorrect argument types
1899             checkNPE(() -&gt; { // null array
1900                 hs.get(am, methodType(void.class, String[].class, int.class, String.class)).
1901                     invokeExact((String[]) null, 0, &quot;foo&quot;);
1902             });
1903             hs.checkWMTEOrCCE(() -&gt; { // array reference class
1904                 hs.get(am, methodType(void.class, Class.class, int.class, String.class)).
1905                     invokeExact(Void.class, 0, &quot;foo&quot;);
1906             });
1907             hs.checkWMTEOrCCE(() -&gt; { // value reference class
1908                 hs.get(am, methodType(void.class, String[].class, int.class, Class.class)).
1909                     invokeExact(array, 0, Void.class);
1910             });
1911             checkWMTE(() -&gt; { // receiver primitive class
1912                 hs.get(am, methodType(void.class, int.class, int.class, String.class)).
1913                     invokeExact(0, 0, &quot;foo&quot;);
1914             });
1915             checkWMTE(() -&gt; { // index reference class
1916                 hs.get(am, methodType(void.class, String[].class, Class.class, String.class)).
1917                     invokeExact(array, Void.class, &quot;foo&quot;);
1918             });
1919             // Incorrect arity
1920             checkWMTE(() -&gt; { // 0
1921                 hs.get(am, methodType(void.class)).
1922                     invokeExact();
1923             });
1924             checkWMTE(() -&gt; { // &gt;
1925                 hs.get(am, methodType(void.class, String[].class, int.class, Class.class)).
1926                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
1927             });
1928         }
1929         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_SET)) {
1930             // Incorrect argument types
1931             checkNPE(() -&gt; { // null receiver
1932                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, String.class)).
1933                     invokeExact((String[]) null, 0, &quot;foo&quot;, &quot;foo&quot;);
1934             });
1935             hs.checkWMTEOrCCE(() -&gt; { // receiver reference class
1936                 boolean r = (boolean) hs.get(am, methodType(boolean.class, Class.class, int.class, String.class, String.class)).
1937                     invokeExact(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1938             });
1939             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1940                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, Class.class, String.class)).
1941                     invokeExact(array, 0, Void.class, &quot;foo&quot;);
1942             });
1943             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1944                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, Class.class)).
1945                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
1946             });
1947             checkWMTE(() -&gt; { // receiver primitive class
1948                 boolean r = (boolean) hs.get(am, methodType(boolean.class, int.class, int.class, String.class, String.class)).
1949                     invokeExact(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1950             });
1951             checkWMTE(() -&gt; { // index reference class
1952                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, Class.class, String.class, String.class)).
1953                     invokeExact(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1954             });
1955             // Incorrect arity
1956             checkWMTE(() -&gt; { // 0
1957                 boolean r = (boolean) hs.get(am, methodType(boolean.class)).
1958                     invokeExact();
1959             });
1960             checkWMTE(() -&gt; { // &gt;
1961                 boolean r = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, String.class, Class.class)).
1962                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
1963             });
1964         }
1965 
1966         for (TestAccessMode am : testAccessModesOfType(TestAccessType.COMPARE_AND_EXCHANGE)) {
1967             // Incorrect argument types
1968             checkNPE(() -&gt; { // null receiver
1969                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, String.class)).
1970                     invokeExact((String[]) null, 0, &quot;foo&quot;, &quot;foo&quot;);
1971             });
1972             hs.checkWMTEOrCCE(() -&gt; { // array reference class
1973                 String x = (String) hs.get(am, methodType(String.class, Class.class, int.class, String.class, String.class)).
1974                     invokeExact(Void.class, 0, &quot;foo&quot;, &quot;foo&quot;);
1975             });
1976             hs.checkWMTEOrCCE(() -&gt; { // expected reference class
1977                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, Class.class, String.class)).
1978                     invokeExact(array, 0, Void.class, &quot;foo&quot;);
1979             });
1980             hs.checkWMTEOrCCE(() -&gt; { // actual reference class
1981                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, Class.class)).
1982                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
1983             });
1984             checkWMTE(() -&gt; { // array primitive class
1985                 String x = (String) hs.get(am, methodType(String.class, int.class, int.class, String.class, String.class)).
1986                     invokeExact(0, 0, &quot;foo&quot;, &quot;foo&quot;);
1987             });
1988             checkWMTE(() -&gt; { // index reference class
1989                 String x = (String) hs.get(am, methodType(String.class, String[].class, Class.class, String.class, String.class)).
1990                     invokeExact(array, Void.class, &quot;foo&quot;, &quot;foo&quot;);
1991             });
1992             // Incorrect return type
1993             hs.checkWMTEOrCCE(() -&gt; { // reference class
1994                 Void r = (Void) hs.get(am, methodType(Void.class, String[].class, int.class, String.class, String.class)).
1995                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;);
1996             });
1997             checkWMTE(() -&gt; { // primitive class
1998                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class, String.class)).
1999                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;);
2000             });
2001             // Incorrect arity
2002             checkWMTE(() -&gt; { // 0
2003                 String x = (String) hs.get(am, methodType(String.class)).
2004                     invokeExact();
2005             });
2006             checkWMTE(() -&gt; { // &gt;
2007                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, String.class, Class.class)).
2008                     invokeExact(array, 0, &quot;foo&quot;, &quot;foo&quot;, Void.class);
2009             });
2010         }
2011 
2012         for (TestAccessMode am : testAccessModesOfType(TestAccessType.GET_AND_SET)) {
2013             // Incorrect argument types
2014             checkNPE(() -&gt; { // null array
2015                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class)).
2016                     invokeExact((String[]) null, 0, &quot;foo&quot;);
2017             });
2018             hs.checkWMTEOrCCE(() -&gt; { // array reference class
2019                 String x = (String) hs.get(am, methodType(String.class, Class.class, int.class, String.class)).
2020                     invokeExact(Void.class, 0, &quot;foo&quot;);
2021             });
2022             hs.checkWMTEOrCCE(() -&gt; { // value reference class
2023                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, Class.class)).
2024                     invokeExact(array, 0, Void.class);
2025             });
2026             checkWMTE(() -&gt; { // array primitive class
2027                 String x = (String) hs.get(am, methodType(String.class, int.class, int.class, String.class)).
2028                     invokeExact(0, 0, &quot;foo&quot;);
2029             });
2030             checkWMTE(() -&gt; { // index reference class
2031                 String x = (String) hs.get(am, methodType(String.class, String[].class, Class.class, String.class)).
2032                     invokeExact(array, Void.class, &quot;foo&quot;);
2033             });
2034             // Incorrect return type
2035             hs.checkWMTEOrCCE(() -&gt; { // reference class
2036                 Void r = (Void) hs.get(am, methodType(Void.class, String[].class, int.class, String.class)).
2037                     invokeExact(array, 0, &quot;foo&quot;);
2038             });
2039             checkWMTE(() -&gt; { // primitive class
2040                 boolean x = (boolean) hs.get(am, methodType(boolean.class, String[].class, int.class, String.class)).
2041                     invokeExact(array, 0, &quot;foo&quot;);
2042             });
2043             // Incorrect arity
2044             checkWMTE(() -&gt; { // 0
2045                 String x = (String) hs.get(am, methodType(String.class)).
2046                     invokeExact();
2047             });
2048             checkWMTE(() -&gt; { // &gt;
2049                 String x = (String) hs.get(am, methodType(String.class, String[].class, int.class, String.class, Class.class)).
2050                     invokeExact(array, 0, &quot;foo&quot;, Void.class);
2051             });
2052         }
2053 
2054 
2055     }
2056 }
<a name="3" id="anc3"></a><b style="font-size: large; color: red">--- EOF ---</b>
















































































</pre>
<input id="eof" value="3" type="hidden" />
</body>
</html>