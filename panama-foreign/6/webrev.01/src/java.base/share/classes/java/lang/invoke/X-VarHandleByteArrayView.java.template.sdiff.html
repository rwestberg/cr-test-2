<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Sdiff src/java.base/share/classes/java/lang/invoke/X-VarHandleByteArrayView.java.template</title>
    <link rel="stylesheet" href="../../../../../../../style.css" />
  </head>
<body>
<center><a href="X-VarHandle.java.template.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X-VarHandleMemoryAddressView.java.template.sdiff.html" target="_top">next &gt;</a></center>    <h2>src/java.base/share/classes/java/lang/invoke/X-VarHandleByteArrayView.java.template</h2>
     <a class="print" href="javascript:print()">Print this page</a>
<table>
<tr valign="top">
<td>
<hr />
<pre>
  81 
  82         @Override
  83         final MethodType accessModeTypeUncached(AccessMode accessMode) {
  84             return accessMode.at.accessModeType(byte[].class, $type$.class, int.class);
  85         }
  86 
  87         @ForceInline
  88         static int index(byte[] ba, int index) {
  89             return Preconditions.checkIndex(index, ba.length - ALIGN, null);
  90         }
  91 
  92         @ForceInline
  93         static long address(byte[] ba, int index) {
  94             long address = ((long) index) + Unsafe.ARRAY_BYTE_BASE_OFFSET;
  95             if ((address &amp; ALIGN) != 0)
  96                 throw newIllegalStateExceptionForMisalignedAccess(index);
  97             return address;
  98         }
  99 
 100         @ForceInline
<span class="line-modified"> 101         static $type$ get(ArrayHandle handle, Object oba, int index) {</span>

 102             byte[] ba = (byte[]) oba;
 103 #if[floatingPoint]
 104             $rawType$ rawValue = UNSAFE.get$RawType$Unaligned(
 105                     ba,
 106                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 107                     handle.be);
 108             return $Type$.$rawType$BitsTo$Type$(rawValue);
 109 #else[floatingPoint]
 110             return UNSAFE.get$Type$Unaligned(
 111                     ba,
 112                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 113                     handle.be);
 114 #end[floatingPoint]
 115         }
 116 
 117         @ForceInline
<span class="line-modified"> 118         static void set(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 119             byte[] ba = (byte[]) oba;
 120 #if[floatingPoint]
 121             UNSAFE.put$RawType$Unaligned(
 122                     ba,
 123                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 124                     $Type$.$type$ToRaw$RawType$Bits(value),
 125                     handle.be);
 126 #else[floatingPoint]
 127             UNSAFE.put$RawType$Unaligned(
 128                     ba,
 129                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 130                     value,
 131                     handle.be);
 132 #end[floatingPoint]
 133         }
 134 
 135         @ForceInline
<span class="line-modified"> 136         static $type$ getVolatile(ArrayHandle handle, Object oba, int index) {</span>

 137             byte[] ba = (byte[]) oba;
 138             return convEndian(handle.be,
 139                               UNSAFE.get$RawType$Volatile(
 140                                       ba,
 141                                       address(ba, index(ba, index))));
 142         }
 143 
 144         @ForceInline
<span class="line-modified"> 145         static void setVolatile(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 146             byte[] ba = (byte[]) oba;
 147             UNSAFE.put$RawType$Volatile(
 148                     ba,
 149                     address(ba, index(ba, index)),
 150                     convEndian(handle.be, value));
 151         }
 152 
 153         @ForceInline
<span class="line-modified"> 154         static $type$ getAcquire(ArrayHandle handle, Object oba, int index) {</span>

 155             byte[] ba = (byte[]) oba;
 156             return convEndian(handle.be,
 157                               UNSAFE.get$RawType$Acquire(
 158                                       ba,
 159                                       address(ba, index(ba, index))));
 160         }
 161 
 162         @ForceInline
<span class="line-modified"> 163         static void setRelease(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 164             byte[] ba = (byte[]) oba;
 165             UNSAFE.put$RawType$Release(
 166                     ba,
 167                     address(ba, index(ba, index)),
 168                     convEndian(handle.be, value));
 169         }
 170 
 171         @ForceInline
<span class="line-modified"> 172         static $type$ getOpaque(ArrayHandle handle, Object oba, int index) {</span>

 173             byte[] ba = (byte[]) oba;
 174             return convEndian(handle.be,
 175                               UNSAFE.get$RawType$Opaque(
 176                                       ba,
 177                                       address(ba, index(ba, index))));
 178         }
 179 
 180         @ForceInline
<span class="line-modified"> 181         static void setOpaque(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 182             byte[] ba = (byte[]) oba;
 183             UNSAFE.put$RawType$Opaque(
 184                     ba,
 185                     address(ba, index(ba, index)),
 186                     convEndian(handle.be, value));
 187         }
 188 #if[CAS]
 189 
 190         @ForceInline
<span class="line-modified"> 191         static boolean compareAndSet(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 192             byte[] ba = (byte[]) oba;
 193 #if[Object]
 194             return UNSAFE.compareAndSetReference(
 195                     ba,
 196                     address(ba, index(ba, index)),
 197                     convEndian(handle.be, expected), convEndian(handle.be, value));
 198 #else[Object]
 199             return UNSAFE.compareAndSet$RawType$(
 200                     ba,
 201                     address(ba, index(ba, index)),
 202                     convEndian(handle.be, expected), convEndian(handle.be, value));
 203 #end[Object]
 204         }
 205 
 206         @ForceInline
<span class="line-modified"> 207         static $type$ compareAndExchange(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 208             byte[] ba = (byte[]) oba;
 209             return convEndian(handle.be,
 210                               UNSAFE.compareAndExchange$RawType$(
 211                                       ba,
 212                                       address(ba, index(ba, index)),
 213                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 214         }
 215 
 216         @ForceInline
<span class="line-modified"> 217         static $type$ compareAndExchangeAcquire(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 218             byte[] ba = (byte[]) oba;
 219             return convEndian(handle.be,
 220                               UNSAFE.compareAndExchange$RawType$Acquire(
 221                                       ba,
 222                                       address(ba, index(ba, index)),
 223                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 224         }
 225 
 226         @ForceInline
<span class="line-modified"> 227         static $type$ compareAndExchangeRelease(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 228             byte[] ba = (byte[]) oba;
 229             return convEndian(handle.be,
 230                               UNSAFE.compareAndExchange$RawType$Release(
 231                                       ba,
 232                                       address(ba, index(ba, index)),
 233                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 234         }
 235 
 236         @ForceInline
<span class="line-modified"> 237         static boolean weakCompareAndSetPlain(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 238             byte[] ba = (byte[]) oba;
 239             return UNSAFE.weakCompareAndSet$RawType$Plain(
 240                     ba,
 241                     address(ba, index(ba, index)),
 242                     convEndian(handle.be, expected), convEndian(handle.be, value));
 243         }
 244 
 245         @ForceInline
<span class="line-modified"> 246         static boolean weakCompareAndSet(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 247             byte[] ba = (byte[]) oba;
 248             return UNSAFE.weakCompareAndSet$RawType$(
 249                     ba,
 250                     address(ba, index(ba, index)),
 251                     convEndian(handle.be, expected), convEndian(handle.be, value));
 252         }
 253 
 254         @ForceInline
<span class="line-modified"> 255         static boolean weakCompareAndSetAcquire(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 256             byte[] ba = (byte[]) oba;
 257             return UNSAFE.weakCompareAndSet$RawType$Acquire(
 258                     ba,
 259                     address(ba, index(ba, index)),
 260                     convEndian(handle.be, expected), convEndian(handle.be, value));
 261         }
 262 
 263         @ForceInline
<span class="line-modified"> 264         static boolean weakCompareAndSetRelease(ArrayHandle handle, Object oba, int index, $type$ expected, $type$ value) {</span>

 265             byte[] ba = (byte[]) oba;
 266             return UNSAFE.weakCompareAndSet$RawType$Release(
 267                     ba,
 268                     address(ba, index(ba, index)),
 269                     convEndian(handle.be, expected), convEndian(handle.be, value));
 270         }
 271 
 272         @ForceInline
<span class="line-modified"> 273         static $type$ getAndSet(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 274             byte[] ba = (byte[]) oba;
 275 #if[Object]
 276             return convEndian(handle.be,
 277                               UNSAFE.getAndSetReference(
 278                                       ba,
 279                                       address(ba, index(ba, index)),
 280                                       convEndian(handle.be, value)));
 281 #else[Object]
 282             return convEndian(handle.be,
 283                               UNSAFE.getAndSet$RawType$(
 284                                       ba,
 285                                       address(ba, index(ba, index)),
 286                                       convEndian(handle.be, value)));
 287 #end[Object]
 288         }
 289 
 290         @ForceInline
<span class="line-modified"> 291         static $type$ getAndSetAcquire(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 292             byte[] ba = (byte[]) oba;
 293             return convEndian(handle.be,
 294                               UNSAFE.getAndSet$RawType$Acquire(
 295                                       ba,
 296                                       address(ba, index(ba, index)),
 297                                       convEndian(handle.be, value)));
 298         }
 299 
 300         @ForceInline
<span class="line-modified"> 301         static $type$ getAndSetRelease(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 302             byte[] ba = (byte[]) oba;
 303             return convEndian(handle.be,
 304                               UNSAFE.getAndSet$RawType$Release(
 305                                       ba,
 306                                       address(ba, index(ba, index)),
 307                                       convEndian(handle.be, value)));
 308         }
 309 #end[CAS]
 310 #if[AtomicAdd]
 311 
 312         @ForceInline
<span class="line-modified"> 313         static $type$ getAndAdd(ArrayHandle handle, Object oba, int index, $type$ delta) {</span>

 314             byte[] ba = (byte[]) oba;
 315             if (handle.be == BE) {
 316                 return UNSAFE.getAndAdd$RawType$(
 317                         ba,
 318                         address(ba, index(ba, index)),
 319                         delta);
 320             } else {
 321                 return getAndAddConvEndianWithCAS(ba, index, delta);
 322             }
 323         }
 324 
 325         @ForceInline
<span class="line-modified"> 326         static $type$ getAndAddAcquire(ArrayHandle handle, Object oba, int index, $type$ delta) {</span>

 327             byte[] ba = (byte[]) oba;
 328             if (handle.be == BE) {
 329                 return UNSAFE.getAndAdd$RawType$Acquire(
 330                         ba,
 331                         address(ba, index(ba, index)),
 332                         delta);
 333             } else {
 334                 return getAndAddConvEndianWithCAS(ba, index, delta);
 335             }
 336         }
 337 
 338         @ForceInline
<span class="line-modified"> 339         static $type$ getAndAddRelease(ArrayHandle handle, Object oba, int index, $type$ delta) {</span>

 340             byte[] ba = (byte[]) oba;
 341             if (handle.be == BE) {
 342                 return UNSAFE.getAndAdd$RawType$Release(
 343                         ba,
 344                         address(ba, index(ba, index)),
 345                         delta);
 346             } else {
 347                 return getAndAddConvEndianWithCAS(ba, index, delta);
 348             }
 349         }
 350 
 351         @ForceInline
 352         static $type$ getAndAddConvEndianWithCAS(byte[] ba, int index, $type$ delta) {
 353             $type$ nativeExpectedValue, expectedValue;
 354             long offset = address(ba, index(ba, index));
 355             do {
 356                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 357                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 358             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 359                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue + delta)));
 360             return expectedValue;
 361         }
 362 #end[AtomicAdd]
 363 #if[Bitwise]
 364 
 365         @ForceInline
<span class="line-modified"> 366         static $type$ getAndBitwiseOr(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 367             byte[] ba = (byte[]) oba;
 368             if (handle.be == BE) {
 369                 return UNSAFE.getAndBitwiseOr$RawType$(
 370                         ba,
 371                         address(ba, index(ba, index)),
 372                         value);
 373             } else {
 374                 return getAndBitwiseOrConvEndianWithCAS(ba, index, value);
 375             }
 376         }
 377 
 378         @ForceInline
<span class="line-modified"> 379         static $type$ getAndBitwiseOrRelease(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 380             byte[] ba = (byte[]) oba;
 381             if (handle.be == BE) {
 382                 return UNSAFE.getAndBitwiseOr$RawType$Release(
 383                         ba,
 384                         address(ba, index(ba, index)),
 385                         value);
 386             } else {
 387                 return getAndBitwiseOrConvEndianWithCAS(ba, index, value);
 388             }
 389         }
 390 
 391         @ForceInline
<span class="line-modified"> 392         static $type$ getAndBitwiseOrAcquire(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 393             byte[] ba = (byte[]) oba;
 394             if (handle.be == BE) {
 395                 return UNSAFE.getAndBitwiseOr$RawType$Acquire(
 396                         ba,
 397                         address(ba, index(ba, index)),
 398                         value);
 399             } else {
 400                 return getAndBitwiseOrConvEndianWithCAS(ba, index, value);
 401             }
 402         }
 403 
 404         @ForceInline
 405         static $type$ getAndBitwiseOrConvEndianWithCAS(byte[] ba, int index, $type$ value) {
 406             $type$ nativeExpectedValue, expectedValue;
 407             long offset = address(ba, index(ba, index));
 408             do {
 409                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 410                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 411             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 412                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue | value)));
 413             return expectedValue;
 414         }
 415 
 416         @ForceInline
<span class="line-modified"> 417         static $type$ getAndBitwiseAnd(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 418             byte[] ba = (byte[]) oba;
 419             if (handle.be == BE) {
 420                 return UNSAFE.getAndBitwiseAnd$RawType$(
 421                         ba,
 422                         address(ba, index(ba, index)),
 423                         value);
 424             } else {
 425                 return getAndBitwiseAndConvEndianWithCAS(ba, index, value);
 426             }
 427         }
 428 
 429         @ForceInline
<span class="line-modified"> 430         static $type$ getAndBitwiseAndRelease(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 431             byte[] ba = (byte[]) oba;
 432             if (handle.be == BE) {
 433                 return UNSAFE.getAndBitwiseAnd$RawType$Release(
 434                         ba,
 435                         address(ba, index(ba, index)),
 436                         value);
 437             } else {
 438                 return getAndBitwiseAndConvEndianWithCAS(ba, index, value);
 439             }
 440         }
 441 
 442         @ForceInline
<span class="line-modified"> 443         static $type$ getAndBitwiseAndAcquire(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 444             byte[] ba = (byte[]) oba;
 445             if (handle.be == BE) {
 446                 return UNSAFE.getAndBitwiseAnd$RawType$Acquire(
 447                         ba,
 448                         address(ba, index(ba, index)),
 449                         value);
 450             } else {
 451                 return getAndBitwiseAndConvEndianWithCAS(ba, index, value);
 452             }
 453         }
 454 
 455         @ForceInline
 456         static $type$ getAndBitwiseAndConvEndianWithCAS(byte[] ba, int index, $type$ value) {
 457             $type$ nativeExpectedValue, expectedValue;
 458             long offset = address(ba, index(ba, index));
 459             do {
 460                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 461                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 462             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 463                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue &amp; value)));
 464             return expectedValue;
 465         }
 466 
 467         @ForceInline
<span class="line-modified"> 468         static $type$ getAndBitwiseXor(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 469             byte[] ba = (byte[]) oba;
 470             if (handle.be == BE) {
 471                 return UNSAFE.getAndBitwiseXor$RawType$(
 472                         ba,
 473                         address(ba, index(ba, index)),
 474                         value);
 475             } else {
 476                 return getAndBitwiseXorConvEndianWithCAS(ba, index, value);
 477             }
 478         }
 479 
 480         @ForceInline
<span class="line-modified"> 481         static $type$ getAndBitwiseXorRelease(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 482             byte[] ba = (byte[]) oba;
 483             if (handle.be == BE) {
 484                 return UNSAFE.getAndBitwiseXor$RawType$Release(
 485                         ba,
 486                         address(ba, index(ba, index)),
 487                         value);
 488             } else {
 489                 return getAndBitwiseXorConvEndianWithCAS(ba, index, value);
 490             }
 491         }
 492 
 493         @ForceInline
<span class="line-modified"> 494         static $type$ getAndBitwiseXorAcquire(ArrayHandle handle, Object oba, int index, $type$ value) {</span>

 495             byte[] ba = (byte[]) oba;
 496             if (handle.be == BE) {
 497                 return UNSAFE.getAndBitwiseXor$RawType$Acquire(
 498                         ba,
 499                         address(ba, index(ba, index)),
 500                         value);
 501             } else {
 502                 return getAndBitwiseXorConvEndianWithCAS(ba, index, value);
 503             }
 504         }
 505 
 506         @ForceInline
 507         static $type$ getAndBitwiseXorConvEndianWithCAS(byte[] ba, int index, $type$ value) {
 508             $type$ nativeExpectedValue, expectedValue;
 509             long offset = address(ba, index(ba, index));
 510             do {
 511                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 512                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 513             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 514                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue ^ value)));
</pre>
<hr />
<pre>
 536             nioAccess.checkSegment(bb);
 537             return Preconditions.checkIndex(index, UNSAFE.getInt(bb, BUFFER_LIMIT) - ALIGN, null);
 538         }
 539 
 540         @ForceInline
 541         static int indexRO(ByteBuffer bb, int index) {
 542             if (UNSAFE.getBoolean(bb, BYTE_BUFFER_IS_READ_ONLY))
 543                 throw new ReadOnlyBufferException();
 544             return index(bb, index);
 545         }
 546 
 547         @ForceInline
 548         static long address(ByteBuffer bb, int index) {
 549             long address = ((long) index) + UNSAFE.getLong(bb, BUFFER_ADDRESS);
 550             if ((address &amp; ALIGN) != 0)
 551                 throw newIllegalStateExceptionForMisalignedAccess(index);
 552             return address;
 553         }
 554 
 555         @ForceInline
<span class="line-modified"> 556         static $type$ get(ByteBufferHandle handle, Object obb, int index) {</span>

 557             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 558 #if[floatingPoint]
 559             $rawType$ rawValue = UNSAFE.get$RawType$Unaligned(
 560                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 561                     ((long) index(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 562                     handle.be);
 563             return $Type$.$rawType$BitsTo$Type$(rawValue);
 564 #else[floatingPoint]
 565             return UNSAFE.get$Type$Unaligned(
 566                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 567                     ((long) index(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 568                     handle.be);
 569 #end[floatingPoint]
 570         }
 571 
 572         @ForceInline
<span class="line-modified"> 573         static void set(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 574             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 575 #if[floatingPoint]
 576             UNSAFE.put$RawType$Unaligned(
 577                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 578                     ((long) indexRO(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 579                     $Type$.$type$ToRaw$RawType$Bits(value),
 580                     handle.be);
 581 #else[floatingPoint]
 582             UNSAFE.put$Type$Unaligned(
 583                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 584                     ((long) indexRO(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 585                     value,
 586                     handle.be);
 587 #end[floatingPoint]
 588         }
 589 
 590         @ForceInline
<span class="line-modified"> 591         static $type$ getVolatile(ByteBufferHandle handle, Object obb, int index) {</span>

 592             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 593             return convEndian(handle.be,
 594                               UNSAFE.get$RawType$Volatile(
 595                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 596                                       address(bb, index(bb, index))));
 597         }
 598 
 599         @ForceInline
<span class="line-modified"> 600         static void setVolatile(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 601             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 602             UNSAFE.put$RawType$Volatile(
 603                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 604                     address(bb, indexRO(bb, index)),
 605                     convEndian(handle.be, value));
 606         }
 607 
 608         @ForceInline
<span class="line-modified"> 609         static $type$ getAcquire(ByteBufferHandle handle, Object obb, int index) {</span>

 610             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 611             return convEndian(handle.be,
 612                               UNSAFE.get$RawType$Acquire(
 613                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 614                                       address(bb, index(bb, index))));
 615         }
 616 
 617         @ForceInline
<span class="line-modified"> 618         static void setRelease(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 619             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 620             UNSAFE.put$RawType$Release(
 621                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 622                     address(bb, indexRO(bb, index)),
 623                     convEndian(handle.be, value));
 624         }
 625 
 626         @ForceInline
<span class="line-modified"> 627         static $type$ getOpaque(ByteBufferHandle handle, Object obb, int index) {</span>

 628             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 629             return convEndian(handle.be,
 630                               UNSAFE.get$RawType$Opaque(
 631                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 632                                       address(bb, index(bb, index))));
 633         }
 634 
 635         @ForceInline
<span class="line-modified"> 636         static void setOpaque(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 637             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 638             UNSAFE.put$RawType$Opaque(
 639                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 640                     address(bb, indexRO(bb, index)),
 641                     convEndian(handle.be, value));
 642         }
 643 #if[CAS]
 644 
 645         @ForceInline
<span class="line-modified"> 646         static boolean compareAndSet(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 647             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 648 #if[Object]
 649             return UNSAFE.compareAndSetReference(
 650                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 651                     address(bb, indexRO(bb, index)),
 652                     convEndian(handle.be, expected), convEndian(handle.be, value));
 653 #else[Object]
 654             return UNSAFE.compareAndSet$RawType$(
 655                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 656                     address(bb, indexRO(bb, index)),
 657                     convEndian(handle.be, expected), convEndian(handle.be, value));
 658 #end[Object]
 659         }
 660 
 661         @ForceInline
<span class="line-modified"> 662         static $type$ compareAndExchange(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 663             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 664             return convEndian(handle.be,
 665                               UNSAFE.compareAndExchange$RawType$(
 666                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 667                                       address(bb, indexRO(bb, index)),
 668                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 669         }
 670 
 671         @ForceInline
<span class="line-modified"> 672         static $type$ compareAndExchangeAcquire(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 673             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 674             return convEndian(handle.be,
 675                               UNSAFE.compareAndExchange$RawType$Acquire(
 676                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 677                                       address(bb, indexRO(bb, index)),
 678                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 679         }
 680 
 681         @ForceInline
<span class="line-modified"> 682         static $type$ compareAndExchangeRelease(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 683             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 684             return convEndian(handle.be,
 685                               UNSAFE.compareAndExchange$RawType$Release(
 686                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 687                                       address(bb, indexRO(bb, index)),
 688                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 689         }
 690 
 691         @ForceInline
<span class="line-modified"> 692         static boolean weakCompareAndSetPlain(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 693             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 694             return UNSAFE.weakCompareAndSet$RawType$Plain(
 695                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 696                     address(bb, indexRO(bb, index)),
 697                     convEndian(handle.be, expected), convEndian(handle.be, value));
 698         }
 699 
 700         @ForceInline
<span class="line-modified"> 701         static boolean weakCompareAndSet(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 702             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 703             return UNSAFE.weakCompareAndSet$RawType$(
 704                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 705                     address(bb, indexRO(bb, index)),
 706                     convEndian(handle.be, expected), convEndian(handle.be, value));
 707         }
 708 
 709         @ForceInline
<span class="line-modified"> 710         static boolean weakCompareAndSetAcquire(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 711             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 712             return UNSAFE.weakCompareAndSet$RawType$Acquire(
 713                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 714                     address(bb, indexRO(bb, index)),
 715                     convEndian(handle.be, expected), convEndian(handle.be, value));
 716         }
 717 
 718         @ForceInline
<span class="line-modified"> 719         static boolean weakCompareAndSetRelease(ByteBufferHandle handle, Object obb, int index, $type$ expected, $type$ value) {</span>

 720             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 721             return UNSAFE.weakCompareAndSet$RawType$Release(
 722                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 723                     address(bb, indexRO(bb, index)),
 724                     convEndian(handle.be, expected), convEndian(handle.be, value));
 725         }
 726 
 727         @ForceInline
<span class="line-modified"> 728         static $type$ getAndSet(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 729             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 730 #if[Object]
 731             return convEndian(handle.be,
 732                               UNSAFE.getAndSetReference(
 733                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 734                                       address(bb, indexRO(bb, index)),
 735                                       convEndian(handle.be, value)));
 736 #else[Object]
 737             return convEndian(handle.be,
 738                               UNSAFE.getAndSet$RawType$(
 739                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 740                                       address(bb, indexRO(bb, index)),
 741                                       convEndian(handle.be, value)));
 742 #end[Object]
 743         }
 744 
 745         @ForceInline
<span class="line-modified"> 746         static $type$ getAndSetAcquire(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 747             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 748             return convEndian(handle.be,
 749                               UNSAFE.getAndSet$RawType$Acquire(
 750                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 751                                       address(bb, indexRO(bb, index)),
 752                                       convEndian(handle.be, value)));
 753         }
 754 
 755         @ForceInline
<span class="line-modified"> 756         static $type$ getAndSetRelease(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 757             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 758             return convEndian(handle.be,
 759                               UNSAFE.getAndSet$RawType$Release(
 760                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 761                                       address(bb, indexRO(bb, index)),
 762                                       convEndian(handle.be, value)));
 763         }
 764 #end[CAS]
 765 #if[AtomicAdd]
 766 
 767         @ForceInline
<span class="line-modified"> 768         static $type$ getAndAdd(ByteBufferHandle handle, Object obb, int index, $type$ delta) {</span>

 769             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 770             if (handle.be == BE) {
 771                 return UNSAFE.getAndAdd$RawType$(
 772                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 773                         address(bb, indexRO(bb, index)),
 774                         delta);
 775             } else {
 776                 return getAndAddConvEndianWithCAS(bb, index, delta);
 777             }
 778         }
 779 
 780         @ForceInline
<span class="line-modified"> 781         static $type$ getAndAddAcquire(ByteBufferHandle handle, Object obb, int index, $type$ delta) {</span>

 782             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 783             if (handle.be == BE) {
 784                 return UNSAFE.getAndAdd$RawType$Acquire(
 785                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 786                         address(bb, indexRO(bb, index)),
 787                         delta);
 788             } else {
 789                 return getAndAddConvEndianWithCAS(bb, index, delta);
 790             }
 791         }
 792 
 793         @ForceInline
<span class="line-modified"> 794         static $type$ getAndAddRelease(ByteBufferHandle handle, Object obb, int index, $type$ delta) {</span>

 795             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 796             if (handle.be == BE) {
 797                 return UNSAFE.getAndAdd$RawType$Release(
 798                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 799                         address(bb, indexRO(bb, index)),
 800                         delta);
 801             } else {
 802                 return getAndAddConvEndianWithCAS(bb, index, delta);
 803             }
 804         }
 805 
 806         @ForceInline
 807         static $type$ getAndAddConvEndianWithCAS(ByteBuffer bb, int index, $type$ delta) {
 808             $type$ nativeExpectedValue, expectedValue;
 809             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 810             long offset = address(bb, indexRO(bb, index));
 811             do {
 812                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 813                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 814             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
 815                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue + delta)));
 816             return expectedValue;
 817         }
 818 #end[AtomicAdd]
 819 #if[Bitwise]
 820 
 821         @ForceInline
<span class="line-modified"> 822         static $type$ getAndBitwiseOr(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 823             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 824             if (handle.be == BE) {
 825                 return UNSAFE.getAndBitwiseOr$RawType$(
 826                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 827                         address(bb, indexRO(bb, index)),
 828                         value);
 829             } else {
 830                 return getAndBitwiseOrConvEndianWithCAS(bb, index, value);
 831             }
 832         }
 833 
 834         @ForceInline
<span class="line-modified"> 835         static $type$ getAndBitwiseOrRelease(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 836             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 837             if (handle.be == BE) {
 838                 return UNSAFE.getAndBitwiseOr$RawType$Release(
 839                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 840                         address(bb, indexRO(bb, index)),
 841                         value);
 842             } else {
 843                 return getAndBitwiseOrConvEndianWithCAS(bb, index, value);
 844             }
 845         }
 846 
 847         @ForceInline
<span class="line-modified"> 848         static $type$ getAndBitwiseOrAcquire(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 849             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 850             if (handle.be == BE) {
 851                 return UNSAFE.getAndBitwiseOr$RawType$Acquire(
 852                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 853                         address(bb, indexRO(bb, index)),
 854                         value);
 855             } else {
 856                 return getAndBitwiseOrConvEndianWithCAS(bb, index, value);
 857             }
 858         }
 859 
 860         @ForceInline
 861         static $type$ getAndBitwiseOrConvEndianWithCAS(ByteBuffer bb, int index, $type$ value) {
 862             $type$ nativeExpectedValue, expectedValue;
 863             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 864             long offset = address(bb, indexRO(bb, index));
 865             do {
 866                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 867                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 868             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
 869                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue | value)));
 870             return expectedValue;
 871         }
 872 
 873         @ForceInline
<span class="line-modified"> 874         static $type$ getAndBitwiseAnd(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 875             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 876             if (handle.be == BE) {
 877                 return UNSAFE.getAndBitwiseAnd$RawType$(
 878                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 879                         address(bb, indexRO(bb, index)),
 880                         value);
 881             } else {
 882                 return getAndBitwiseAndConvEndianWithCAS(bb, index, value);
 883             }
 884         }
 885 
 886         @ForceInline
<span class="line-modified"> 887         static $type$ getAndBitwiseAndRelease(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 888             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 889             if (handle.be == BE) {
 890                 return UNSAFE.getAndBitwiseAnd$RawType$Release(
 891                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 892                         address(bb, indexRO(bb, index)),
 893                         value);
 894             } else {
 895                 return getAndBitwiseAndConvEndianWithCAS(bb, index, value);
 896             }
 897         }
 898 
 899         @ForceInline
<span class="line-modified"> 900         static $type$ getAndBitwiseAndAcquire(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 901             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 902             if (handle.be == BE) {
 903                 return UNSAFE.getAndBitwiseAnd$RawType$Acquire(
 904                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 905                         address(bb, indexRO(bb, index)),
 906                         value);
 907             } else {
 908                 return getAndBitwiseAndConvEndianWithCAS(bb, index, value);
 909             }
 910         }
 911 
 912         @ForceInline
 913         static $type$ getAndBitwiseAndConvEndianWithCAS(ByteBuffer bb, int index, $type$ value) {
 914             $type$ nativeExpectedValue, expectedValue;
 915             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 916             long offset = address(bb, indexRO(bb, index));
 917             do {
 918                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 919                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 920             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
 921                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue &amp; value)));
 922             return expectedValue;
 923         }
 924 
 925 
 926         @ForceInline
<span class="line-modified"> 927         static $type$ getAndBitwiseXor(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 928             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 929             if (handle.be == BE) {
 930                 return UNSAFE.getAndBitwiseXor$RawType$(
 931                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 932                         address(bb, indexRO(bb, index)),
 933                         value);
 934             } else {
 935                 return getAndBitwiseXorConvEndianWithCAS(bb, index, value);
 936             }
 937         }
 938 
 939         @ForceInline
<span class="line-modified"> 940         static $type$ getAndBitwiseXorRelease(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 941             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 942             if (handle.be == BE) {
 943                 return UNSAFE.getAndBitwiseXor$RawType$Release(
 944                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 945                         address(bb, indexRO(bb, index)),
 946                         value);
 947             } else {
 948                 return getAndBitwiseXorConvEndianWithCAS(bb, index, value);
 949             }
 950         }
 951 
 952         @ForceInline
<span class="line-modified"> 953         static $type$ getAndBitwiseXorAcquire(ByteBufferHandle handle, Object obb, int index, $type$ value) {</span>

 954             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 955             if (handle.be == BE) {
 956                 return UNSAFE.getAndBitwiseXor$RawType$Acquire(
 957                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 958                         address(bb, indexRO(bb, index)),
 959                         value);
 960             } else {
 961                 return getAndBitwiseXorConvEndianWithCAS(bb, index, value);
 962             }
 963         }
 964 
 965         @ForceInline
 966         static $type$ getAndBitwiseXorConvEndianWithCAS(ByteBuffer bb, int index, $type$ value) {
 967             $type$ nativeExpectedValue, expectedValue;
 968             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 969             long offset = address(bb, indexRO(bb, index));
 970             do {
 971                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 972                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 973             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
</pre>
</td>
<td>
<hr />
<pre>
  81 
  82         @Override
  83         final MethodType accessModeTypeUncached(AccessMode accessMode) {
  84             return accessMode.at.accessModeType(byte[].class, $type$.class, int.class);
  85         }
  86 
  87         @ForceInline
  88         static int index(byte[] ba, int index) {
  89             return Preconditions.checkIndex(index, ba.length - ALIGN, null);
  90         }
  91 
  92         @ForceInline
  93         static long address(byte[] ba, int index) {
  94             long address = ((long) index) + Unsafe.ARRAY_BYTE_BASE_OFFSET;
  95             if ((address &amp; ALIGN) != 0)
  96                 throw newIllegalStateExceptionForMisalignedAccess(index);
  97             return address;
  98         }
  99 
 100         @ForceInline
<span class="line-modified"> 101         static $type$ get(VarHandle ob, Object oba, int index) {</span>
<span class="line-added"> 102             ArrayHandle handle = (ArrayHandle)ob;</span>
 103             byte[] ba = (byte[]) oba;
 104 #if[floatingPoint]
 105             $rawType$ rawValue = UNSAFE.get$RawType$Unaligned(
 106                     ba,
 107                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 108                     handle.be);
 109             return $Type$.$rawType$BitsTo$Type$(rawValue);
 110 #else[floatingPoint]
 111             return UNSAFE.get$Type$Unaligned(
 112                     ba,
 113                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 114                     handle.be);
 115 #end[floatingPoint]
 116         }
 117 
 118         @ForceInline
<span class="line-modified"> 119         static void set(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 120             ArrayHandle handle = (ArrayHandle)ob;</span>
 121             byte[] ba = (byte[]) oba;
 122 #if[floatingPoint]
 123             UNSAFE.put$RawType$Unaligned(
 124                     ba,
 125                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 126                     $Type$.$type$ToRaw$RawType$Bits(value),
 127                     handle.be);
 128 #else[floatingPoint]
 129             UNSAFE.put$RawType$Unaligned(
 130                     ba,
 131                     ((long) index(ba, index)) + Unsafe.ARRAY_BYTE_BASE_OFFSET,
 132                     value,
 133                     handle.be);
 134 #end[floatingPoint]
 135         }
 136 
 137         @ForceInline
<span class="line-modified"> 138         static $type$ getVolatile(VarHandle ob, Object oba, int index) {</span>
<span class="line-added"> 139             ArrayHandle handle = (ArrayHandle)ob;</span>
 140             byte[] ba = (byte[]) oba;
 141             return convEndian(handle.be,
 142                               UNSAFE.get$RawType$Volatile(
 143                                       ba,
 144                                       address(ba, index(ba, index))));
 145         }
 146 
 147         @ForceInline
<span class="line-modified"> 148         static void setVolatile(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 149             ArrayHandle handle = (ArrayHandle)ob;</span>
 150             byte[] ba = (byte[]) oba;
 151             UNSAFE.put$RawType$Volatile(
 152                     ba,
 153                     address(ba, index(ba, index)),
 154                     convEndian(handle.be, value));
 155         }
 156 
 157         @ForceInline
<span class="line-modified"> 158         static $type$ getAcquire(VarHandle ob, Object oba, int index) {</span>
<span class="line-added"> 159             ArrayHandle handle = (ArrayHandle)ob;</span>
 160             byte[] ba = (byte[]) oba;
 161             return convEndian(handle.be,
 162                               UNSAFE.get$RawType$Acquire(
 163                                       ba,
 164                                       address(ba, index(ba, index))));
 165         }
 166 
 167         @ForceInline
<span class="line-modified"> 168         static void setRelease(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 169             ArrayHandle handle = (ArrayHandle)ob;</span>
 170             byte[] ba = (byte[]) oba;
 171             UNSAFE.put$RawType$Release(
 172                     ba,
 173                     address(ba, index(ba, index)),
 174                     convEndian(handle.be, value));
 175         }
 176 
 177         @ForceInline
<span class="line-modified"> 178         static $type$ getOpaque(VarHandle ob, Object oba, int index) {</span>
<span class="line-added"> 179             ArrayHandle handle = (ArrayHandle)ob;</span>
 180             byte[] ba = (byte[]) oba;
 181             return convEndian(handle.be,
 182                               UNSAFE.get$RawType$Opaque(
 183                                       ba,
 184                                       address(ba, index(ba, index))));
 185         }
 186 
 187         @ForceInline
<span class="line-modified"> 188         static void setOpaque(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 189             ArrayHandle handle = (ArrayHandle)ob;</span>
 190             byte[] ba = (byte[]) oba;
 191             UNSAFE.put$RawType$Opaque(
 192                     ba,
 193                     address(ba, index(ba, index)),
 194                     convEndian(handle.be, value));
 195         }
 196 #if[CAS]
 197 
 198         @ForceInline
<span class="line-modified"> 199         static boolean compareAndSet(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 200             ArrayHandle handle = (ArrayHandle)ob;</span>
 201             byte[] ba = (byte[]) oba;
 202 #if[Object]
 203             return UNSAFE.compareAndSetReference(
 204                     ba,
 205                     address(ba, index(ba, index)),
 206                     convEndian(handle.be, expected), convEndian(handle.be, value));
 207 #else[Object]
 208             return UNSAFE.compareAndSet$RawType$(
 209                     ba,
 210                     address(ba, index(ba, index)),
 211                     convEndian(handle.be, expected), convEndian(handle.be, value));
 212 #end[Object]
 213         }
 214 
 215         @ForceInline
<span class="line-modified"> 216         static $type$ compareAndExchange(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 217             ArrayHandle handle = (ArrayHandle)ob;</span>
 218             byte[] ba = (byte[]) oba;
 219             return convEndian(handle.be,
 220                               UNSAFE.compareAndExchange$RawType$(
 221                                       ba,
 222                                       address(ba, index(ba, index)),
 223                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 224         }
 225 
 226         @ForceInline
<span class="line-modified"> 227         static $type$ compareAndExchangeAcquire(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 228             ArrayHandle handle = (ArrayHandle)ob;</span>
 229             byte[] ba = (byte[]) oba;
 230             return convEndian(handle.be,
 231                               UNSAFE.compareAndExchange$RawType$Acquire(
 232                                       ba,
 233                                       address(ba, index(ba, index)),
 234                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 235         }
 236 
 237         @ForceInline
<span class="line-modified"> 238         static $type$ compareAndExchangeRelease(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 239             ArrayHandle handle = (ArrayHandle)ob;</span>
 240             byte[] ba = (byte[]) oba;
 241             return convEndian(handle.be,
 242                               UNSAFE.compareAndExchange$RawType$Release(
 243                                       ba,
 244                                       address(ba, index(ba, index)),
 245                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 246         }
 247 
 248         @ForceInline
<span class="line-modified"> 249         static boolean weakCompareAndSetPlain(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 250             ArrayHandle handle = (ArrayHandle)ob;</span>
 251             byte[] ba = (byte[]) oba;
 252             return UNSAFE.weakCompareAndSet$RawType$Plain(
 253                     ba,
 254                     address(ba, index(ba, index)),
 255                     convEndian(handle.be, expected), convEndian(handle.be, value));
 256         }
 257 
 258         @ForceInline
<span class="line-modified"> 259         static boolean weakCompareAndSet(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 260             ArrayHandle handle = (ArrayHandle)ob;</span>
 261             byte[] ba = (byte[]) oba;
 262             return UNSAFE.weakCompareAndSet$RawType$(
 263                     ba,
 264                     address(ba, index(ba, index)),
 265                     convEndian(handle.be, expected), convEndian(handle.be, value));
 266         }
 267 
 268         @ForceInline
<span class="line-modified"> 269         static boolean weakCompareAndSetAcquire(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 270             ArrayHandle handle = (ArrayHandle)ob;</span>
 271             byte[] ba = (byte[]) oba;
 272             return UNSAFE.weakCompareAndSet$RawType$Acquire(
 273                     ba,
 274                     address(ba, index(ba, index)),
 275                     convEndian(handle.be, expected), convEndian(handle.be, value));
 276         }
 277 
 278         @ForceInline
<span class="line-modified"> 279         static boolean weakCompareAndSetRelease(VarHandle ob, Object oba, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 280             ArrayHandle handle = (ArrayHandle)ob;</span>
 281             byte[] ba = (byte[]) oba;
 282             return UNSAFE.weakCompareAndSet$RawType$Release(
 283                     ba,
 284                     address(ba, index(ba, index)),
 285                     convEndian(handle.be, expected), convEndian(handle.be, value));
 286         }
 287 
 288         @ForceInline
<span class="line-modified"> 289         static $type$ getAndSet(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 290             ArrayHandle handle = (ArrayHandle)ob;</span>
 291             byte[] ba = (byte[]) oba;
 292 #if[Object]
 293             return convEndian(handle.be,
 294                               UNSAFE.getAndSetReference(
 295                                       ba,
 296                                       address(ba, index(ba, index)),
 297                                       convEndian(handle.be, value)));
 298 #else[Object]
 299             return convEndian(handle.be,
 300                               UNSAFE.getAndSet$RawType$(
 301                                       ba,
 302                                       address(ba, index(ba, index)),
 303                                       convEndian(handle.be, value)));
 304 #end[Object]
 305         }
 306 
 307         @ForceInline
<span class="line-modified"> 308         static $type$ getAndSetAcquire(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 309             ArrayHandle handle = (ArrayHandle)ob;</span>
 310             byte[] ba = (byte[]) oba;
 311             return convEndian(handle.be,
 312                               UNSAFE.getAndSet$RawType$Acquire(
 313                                       ba,
 314                                       address(ba, index(ba, index)),
 315                                       convEndian(handle.be, value)));
 316         }
 317 
 318         @ForceInline
<span class="line-modified"> 319         static $type$ getAndSetRelease(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 320             ArrayHandle handle = (ArrayHandle)ob;</span>
 321             byte[] ba = (byte[]) oba;
 322             return convEndian(handle.be,
 323                               UNSAFE.getAndSet$RawType$Release(
 324                                       ba,
 325                                       address(ba, index(ba, index)),
 326                                       convEndian(handle.be, value)));
 327         }
 328 #end[CAS]
 329 #if[AtomicAdd]
 330 
 331         @ForceInline
<span class="line-modified"> 332         static $type$ getAndAdd(VarHandle ob, Object oba, int index, $type$ delta) {</span>
<span class="line-added"> 333             ArrayHandle handle = (ArrayHandle)ob;</span>
 334             byte[] ba = (byte[]) oba;
 335             if (handle.be == BE) {
 336                 return UNSAFE.getAndAdd$RawType$(
 337                         ba,
 338                         address(ba, index(ba, index)),
 339                         delta);
 340             } else {
 341                 return getAndAddConvEndianWithCAS(ba, index, delta);
 342             }
 343         }
 344 
 345         @ForceInline
<span class="line-modified"> 346         static $type$ getAndAddAcquire(VarHandle ob, Object oba, int index, $type$ delta) {</span>
<span class="line-added"> 347             ArrayHandle handle = (ArrayHandle)ob;</span>
 348             byte[] ba = (byte[]) oba;
 349             if (handle.be == BE) {
 350                 return UNSAFE.getAndAdd$RawType$Acquire(
 351                         ba,
 352                         address(ba, index(ba, index)),
 353                         delta);
 354             } else {
 355                 return getAndAddConvEndianWithCAS(ba, index, delta);
 356             }
 357         }
 358 
 359         @ForceInline
<span class="line-modified"> 360         static $type$ getAndAddRelease(VarHandle ob, Object oba, int index, $type$ delta) {</span>
<span class="line-added"> 361             ArrayHandle handle = (ArrayHandle)ob;</span>
 362             byte[] ba = (byte[]) oba;
 363             if (handle.be == BE) {
 364                 return UNSAFE.getAndAdd$RawType$Release(
 365                         ba,
 366                         address(ba, index(ba, index)),
 367                         delta);
 368             } else {
 369                 return getAndAddConvEndianWithCAS(ba, index, delta);
 370             }
 371         }
 372 
 373         @ForceInline
 374         static $type$ getAndAddConvEndianWithCAS(byte[] ba, int index, $type$ delta) {
 375             $type$ nativeExpectedValue, expectedValue;
 376             long offset = address(ba, index(ba, index));
 377             do {
 378                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 379                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 380             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 381                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue + delta)));
 382             return expectedValue;
 383         }
 384 #end[AtomicAdd]
 385 #if[Bitwise]
 386 
 387         @ForceInline
<span class="line-modified"> 388         static $type$ getAndBitwiseOr(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 389             ArrayHandle handle = (ArrayHandle)ob;</span>
 390             byte[] ba = (byte[]) oba;
 391             if (handle.be == BE) {
 392                 return UNSAFE.getAndBitwiseOr$RawType$(
 393                         ba,
 394                         address(ba, index(ba, index)),
 395                         value);
 396             } else {
 397                 return getAndBitwiseOrConvEndianWithCAS(ba, index, value);
 398             }
 399         }
 400 
 401         @ForceInline
<span class="line-modified"> 402         static $type$ getAndBitwiseOrRelease(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 403             ArrayHandle handle = (ArrayHandle)ob;</span>
 404             byte[] ba = (byte[]) oba;
 405             if (handle.be == BE) {
 406                 return UNSAFE.getAndBitwiseOr$RawType$Release(
 407                         ba,
 408                         address(ba, index(ba, index)),
 409                         value);
 410             } else {
 411                 return getAndBitwiseOrConvEndianWithCAS(ba, index, value);
 412             }
 413         }
 414 
 415         @ForceInline
<span class="line-modified"> 416         static $type$ getAndBitwiseOrAcquire(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 417             ArrayHandle handle = (ArrayHandle)ob;</span>
 418             byte[] ba = (byte[]) oba;
 419             if (handle.be == BE) {
 420                 return UNSAFE.getAndBitwiseOr$RawType$Acquire(
 421                         ba,
 422                         address(ba, index(ba, index)),
 423                         value);
 424             } else {
 425                 return getAndBitwiseOrConvEndianWithCAS(ba, index, value);
 426             }
 427         }
 428 
 429         @ForceInline
 430         static $type$ getAndBitwiseOrConvEndianWithCAS(byte[] ba, int index, $type$ value) {
 431             $type$ nativeExpectedValue, expectedValue;
 432             long offset = address(ba, index(ba, index));
 433             do {
 434                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 435                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 436             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 437                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue | value)));
 438             return expectedValue;
 439         }
 440 
 441         @ForceInline
<span class="line-modified"> 442         static $type$ getAndBitwiseAnd(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 443             ArrayHandle handle = (ArrayHandle)ob;</span>
 444             byte[] ba = (byte[]) oba;
 445             if (handle.be == BE) {
 446                 return UNSAFE.getAndBitwiseAnd$RawType$(
 447                         ba,
 448                         address(ba, index(ba, index)),
 449                         value);
 450             } else {
 451                 return getAndBitwiseAndConvEndianWithCAS(ba, index, value);
 452             }
 453         }
 454 
 455         @ForceInline
<span class="line-modified"> 456         static $type$ getAndBitwiseAndRelease(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 457             ArrayHandle handle = (ArrayHandle)ob;</span>
 458             byte[] ba = (byte[]) oba;
 459             if (handle.be == BE) {
 460                 return UNSAFE.getAndBitwiseAnd$RawType$Release(
 461                         ba,
 462                         address(ba, index(ba, index)),
 463                         value);
 464             } else {
 465                 return getAndBitwiseAndConvEndianWithCAS(ba, index, value);
 466             }
 467         }
 468 
 469         @ForceInline
<span class="line-modified"> 470         static $type$ getAndBitwiseAndAcquire(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 471             ArrayHandle handle = (ArrayHandle)ob;</span>
 472             byte[] ba = (byte[]) oba;
 473             if (handle.be == BE) {
 474                 return UNSAFE.getAndBitwiseAnd$RawType$Acquire(
 475                         ba,
 476                         address(ba, index(ba, index)),
 477                         value);
 478             } else {
 479                 return getAndBitwiseAndConvEndianWithCAS(ba, index, value);
 480             }
 481         }
 482 
 483         @ForceInline
 484         static $type$ getAndBitwiseAndConvEndianWithCAS(byte[] ba, int index, $type$ value) {
 485             $type$ nativeExpectedValue, expectedValue;
 486             long offset = address(ba, index(ba, index));
 487             do {
 488                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 489                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 490             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 491                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue &amp; value)));
 492             return expectedValue;
 493         }
 494 
 495         @ForceInline
<span class="line-modified"> 496         static $type$ getAndBitwiseXor(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 497             ArrayHandle handle = (ArrayHandle)ob;</span>
 498             byte[] ba = (byte[]) oba;
 499             if (handle.be == BE) {
 500                 return UNSAFE.getAndBitwiseXor$RawType$(
 501                         ba,
 502                         address(ba, index(ba, index)),
 503                         value);
 504             } else {
 505                 return getAndBitwiseXorConvEndianWithCAS(ba, index, value);
 506             }
 507         }
 508 
 509         @ForceInline
<span class="line-modified"> 510         static $type$ getAndBitwiseXorRelease(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 511             ArrayHandle handle = (ArrayHandle)ob;</span>
 512             byte[] ba = (byte[]) oba;
 513             if (handle.be == BE) {
 514                 return UNSAFE.getAndBitwiseXor$RawType$Release(
 515                         ba,
 516                         address(ba, index(ba, index)),
 517                         value);
 518             } else {
 519                 return getAndBitwiseXorConvEndianWithCAS(ba, index, value);
 520             }
 521         }
 522 
 523         @ForceInline
<span class="line-modified"> 524         static $type$ getAndBitwiseXorAcquire(VarHandle ob, Object oba, int index, $type$ value) {</span>
<span class="line-added"> 525             ArrayHandle handle = (ArrayHandle)ob;</span>
 526             byte[] ba = (byte[]) oba;
 527             if (handle.be == BE) {
 528                 return UNSAFE.getAndBitwiseXor$RawType$Acquire(
 529                         ba,
 530                         address(ba, index(ba, index)),
 531                         value);
 532             } else {
 533                 return getAndBitwiseXorConvEndianWithCAS(ba, index, value);
 534             }
 535         }
 536 
 537         @ForceInline
 538         static $type$ getAndBitwiseXorConvEndianWithCAS(byte[] ba, int index, $type$ value) {
 539             $type$ nativeExpectedValue, expectedValue;
 540             long offset = address(ba, index(ba, index));
 541             do {
 542                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(ba, offset);
 543                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 544             } while (!UNSAFE.weakCompareAndSet$RawType$(ba, offset,
 545                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue ^ value)));
</pre>
<hr />
<pre>
 567             nioAccess.checkSegment(bb);
 568             return Preconditions.checkIndex(index, UNSAFE.getInt(bb, BUFFER_LIMIT) - ALIGN, null);
 569         }
 570 
 571         @ForceInline
 572         static int indexRO(ByteBuffer bb, int index) {
 573             if (UNSAFE.getBoolean(bb, BYTE_BUFFER_IS_READ_ONLY))
 574                 throw new ReadOnlyBufferException();
 575             return index(bb, index);
 576         }
 577 
 578         @ForceInline
 579         static long address(ByteBuffer bb, int index) {
 580             long address = ((long) index) + UNSAFE.getLong(bb, BUFFER_ADDRESS);
 581             if ((address &amp; ALIGN) != 0)
 582                 throw newIllegalStateExceptionForMisalignedAccess(index);
 583             return address;
 584         }
 585 
 586         @ForceInline
<span class="line-modified"> 587         static $type$ get(VarHandle ob, Object obb, int index) {</span>
<span class="line-added"> 588             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 589             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 590 #if[floatingPoint]
 591             $rawType$ rawValue = UNSAFE.get$RawType$Unaligned(
 592                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 593                     ((long) index(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 594                     handle.be);
 595             return $Type$.$rawType$BitsTo$Type$(rawValue);
 596 #else[floatingPoint]
 597             return UNSAFE.get$Type$Unaligned(
 598                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 599                     ((long) index(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 600                     handle.be);
 601 #end[floatingPoint]
 602         }
 603 
 604         @ForceInline
<span class="line-modified"> 605         static void set(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 606             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 607             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 608 #if[floatingPoint]
 609             UNSAFE.put$RawType$Unaligned(
 610                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 611                     ((long) indexRO(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 612                     $Type$.$type$ToRaw$RawType$Bits(value),
 613                     handle.be);
 614 #else[floatingPoint]
 615             UNSAFE.put$Type$Unaligned(
 616                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 617                     ((long) indexRO(bb, index)) + UNSAFE.getLong(bb, BUFFER_ADDRESS),
 618                     value,
 619                     handle.be);
 620 #end[floatingPoint]
 621         }
 622 
 623         @ForceInline
<span class="line-modified"> 624         static $type$ getVolatile(VarHandle ob, Object obb, int index) {</span>
<span class="line-added"> 625             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 626             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 627             return convEndian(handle.be,
 628                               UNSAFE.get$RawType$Volatile(
 629                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 630                                       address(bb, index(bb, index))));
 631         }
 632 
 633         @ForceInline
<span class="line-modified"> 634         static void setVolatile(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 635             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 636             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 637             UNSAFE.put$RawType$Volatile(
 638                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 639                     address(bb, indexRO(bb, index)),
 640                     convEndian(handle.be, value));
 641         }
 642 
 643         @ForceInline
<span class="line-modified"> 644         static $type$ getAcquire(VarHandle ob, Object obb, int index) {</span>
<span class="line-added"> 645             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 646             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 647             return convEndian(handle.be,
 648                               UNSAFE.get$RawType$Acquire(
 649                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 650                                       address(bb, index(bb, index))));
 651         }
 652 
 653         @ForceInline
<span class="line-modified"> 654         static void setRelease(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 655             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 656             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 657             UNSAFE.put$RawType$Release(
 658                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 659                     address(bb, indexRO(bb, index)),
 660                     convEndian(handle.be, value));
 661         }
 662 
 663         @ForceInline
<span class="line-modified"> 664         static $type$ getOpaque(VarHandle ob, Object obb, int index) {</span>
<span class="line-added"> 665             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 666             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 667             return convEndian(handle.be,
 668                               UNSAFE.get$RawType$Opaque(
 669                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 670                                       address(bb, index(bb, index))));
 671         }
 672 
 673         @ForceInline
<span class="line-modified"> 674         static void setOpaque(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 675             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 676             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 677             UNSAFE.put$RawType$Opaque(
 678                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 679                     address(bb, indexRO(bb, index)),
 680                     convEndian(handle.be, value));
 681         }
 682 #if[CAS]
 683 
 684         @ForceInline
<span class="line-modified"> 685         static boolean compareAndSet(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 686             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 687             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 688 #if[Object]
 689             return UNSAFE.compareAndSetReference(
 690                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 691                     address(bb, indexRO(bb, index)),
 692                     convEndian(handle.be, expected), convEndian(handle.be, value));
 693 #else[Object]
 694             return UNSAFE.compareAndSet$RawType$(
 695                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 696                     address(bb, indexRO(bb, index)),
 697                     convEndian(handle.be, expected), convEndian(handle.be, value));
 698 #end[Object]
 699         }
 700 
 701         @ForceInline
<span class="line-modified"> 702         static $type$ compareAndExchange(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 703             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 704             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 705             return convEndian(handle.be,
 706                               UNSAFE.compareAndExchange$RawType$(
 707                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 708                                       address(bb, indexRO(bb, index)),
 709                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 710         }
 711 
 712         @ForceInline
<span class="line-modified"> 713         static $type$ compareAndExchangeAcquire(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 714             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 715             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 716             return convEndian(handle.be,
 717                               UNSAFE.compareAndExchange$RawType$Acquire(
 718                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 719                                       address(bb, indexRO(bb, index)),
 720                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 721         }
 722 
 723         @ForceInline
<span class="line-modified"> 724         static $type$ compareAndExchangeRelease(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 725             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 726             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 727             return convEndian(handle.be,
 728                               UNSAFE.compareAndExchange$RawType$Release(
 729                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 730                                       address(bb, indexRO(bb, index)),
 731                                       convEndian(handle.be, expected), convEndian(handle.be, value)));
 732         }
 733 
 734         @ForceInline
<span class="line-modified"> 735         static boolean weakCompareAndSetPlain(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 736             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 737             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 738             return UNSAFE.weakCompareAndSet$RawType$Plain(
 739                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 740                     address(bb, indexRO(bb, index)),
 741                     convEndian(handle.be, expected), convEndian(handle.be, value));
 742         }
 743 
 744         @ForceInline
<span class="line-modified"> 745         static boolean weakCompareAndSet(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 746             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 747             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 748             return UNSAFE.weakCompareAndSet$RawType$(
 749                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 750                     address(bb, indexRO(bb, index)),
 751                     convEndian(handle.be, expected), convEndian(handle.be, value));
 752         }
 753 
 754         @ForceInline
<span class="line-modified"> 755         static boolean weakCompareAndSetAcquire(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 756             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 757             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 758             return UNSAFE.weakCompareAndSet$RawType$Acquire(
 759                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 760                     address(bb, indexRO(bb, index)),
 761                     convEndian(handle.be, expected), convEndian(handle.be, value));
 762         }
 763 
 764         @ForceInline
<span class="line-modified"> 765         static boolean weakCompareAndSetRelease(VarHandle ob, Object obb, int index, $type$ expected, $type$ value) {</span>
<span class="line-added"> 766             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 767             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 768             return UNSAFE.weakCompareAndSet$RawType$Release(
 769                     UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 770                     address(bb, indexRO(bb, index)),
 771                     convEndian(handle.be, expected), convEndian(handle.be, value));
 772         }
 773 
 774         @ForceInline
<span class="line-modified"> 775         static $type$ getAndSet(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 776             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 777             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 778 #if[Object]
 779             return convEndian(handle.be,
 780                               UNSAFE.getAndSetReference(
 781                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 782                                       address(bb, indexRO(bb, index)),
 783                                       convEndian(handle.be, value)));
 784 #else[Object]
 785             return convEndian(handle.be,
 786                               UNSAFE.getAndSet$RawType$(
 787                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 788                                       address(bb, indexRO(bb, index)),
 789                                       convEndian(handle.be, value)));
 790 #end[Object]
 791         }
 792 
 793         @ForceInline
<span class="line-modified"> 794         static $type$ getAndSetAcquire(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 795             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 796             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 797             return convEndian(handle.be,
 798                               UNSAFE.getAndSet$RawType$Acquire(
 799                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 800                                       address(bb, indexRO(bb, index)),
 801                                       convEndian(handle.be, value)));
 802         }
 803 
 804         @ForceInline
<span class="line-modified"> 805         static $type$ getAndSetRelease(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 806             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 807             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 808             return convEndian(handle.be,
 809                               UNSAFE.getAndSet$RawType$Release(
 810                                       UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 811                                       address(bb, indexRO(bb, index)),
 812                                       convEndian(handle.be, value)));
 813         }
 814 #end[CAS]
 815 #if[AtomicAdd]
 816 
 817         @ForceInline
<span class="line-modified"> 818         static $type$ getAndAdd(VarHandle ob, Object obb, int index, $type$ delta) {</span>
<span class="line-added"> 819             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 820             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 821             if (handle.be == BE) {
 822                 return UNSAFE.getAndAdd$RawType$(
 823                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 824                         address(bb, indexRO(bb, index)),
 825                         delta);
 826             } else {
 827                 return getAndAddConvEndianWithCAS(bb, index, delta);
 828             }
 829         }
 830 
 831         @ForceInline
<span class="line-modified"> 832         static $type$ getAndAddAcquire(VarHandle ob, Object obb, int index, $type$ delta) {</span>
<span class="line-added"> 833             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 834             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 835             if (handle.be == BE) {
 836                 return UNSAFE.getAndAdd$RawType$Acquire(
 837                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 838                         address(bb, indexRO(bb, index)),
 839                         delta);
 840             } else {
 841                 return getAndAddConvEndianWithCAS(bb, index, delta);
 842             }
 843         }
 844 
 845         @ForceInline
<span class="line-modified"> 846         static $type$ getAndAddRelease(VarHandle ob, Object obb, int index, $type$ delta) {</span>
<span class="line-added"> 847             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 848             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 849             if (handle.be == BE) {
 850                 return UNSAFE.getAndAdd$RawType$Release(
 851                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 852                         address(bb, indexRO(bb, index)),
 853                         delta);
 854             } else {
 855                 return getAndAddConvEndianWithCAS(bb, index, delta);
 856             }
 857         }
 858 
 859         @ForceInline
 860         static $type$ getAndAddConvEndianWithCAS(ByteBuffer bb, int index, $type$ delta) {
 861             $type$ nativeExpectedValue, expectedValue;
 862             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 863             long offset = address(bb, indexRO(bb, index));
 864             do {
 865                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 866                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 867             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
 868                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue + delta)));
 869             return expectedValue;
 870         }
 871 #end[AtomicAdd]
 872 #if[Bitwise]
 873 
 874         @ForceInline
<span class="line-modified"> 875         static $type$ getAndBitwiseOr(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 876             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 877             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 878             if (handle.be == BE) {
 879                 return UNSAFE.getAndBitwiseOr$RawType$(
 880                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 881                         address(bb, indexRO(bb, index)),
 882                         value);
 883             } else {
 884                 return getAndBitwiseOrConvEndianWithCAS(bb, index, value);
 885             }
 886         }
 887 
 888         @ForceInline
<span class="line-modified"> 889         static $type$ getAndBitwiseOrRelease(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 890             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 891             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 892             if (handle.be == BE) {
 893                 return UNSAFE.getAndBitwiseOr$RawType$Release(
 894                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 895                         address(bb, indexRO(bb, index)),
 896                         value);
 897             } else {
 898                 return getAndBitwiseOrConvEndianWithCAS(bb, index, value);
 899             }
 900         }
 901 
 902         @ForceInline
<span class="line-modified"> 903         static $type$ getAndBitwiseOrAcquire(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 904             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 905             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 906             if (handle.be == BE) {
 907                 return UNSAFE.getAndBitwiseOr$RawType$Acquire(
 908                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 909                         address(bb, indexRO(bb, index)),
 910                         value);
 911             } else {
 912                 return getAndBitwiseOrConvEndianWithCAS(bb, index, value);
 913             }
 914         }
 915 
 916         @ForceInline
 917         static $type$ getAndBitwiseOrConvEndianWithCAS(ByteBuffer bb, int index, $type$ value) {
 918             $type$ nativeExpectedValue, expectedValue;
 919             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 920             long offset = address(bb, indexRO(bb, index));
 921             do {
 922                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 923                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 924             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
 925                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue | value)));
 926             return expectedValue;
 927         }
 928 
 929         @ForceInline
<span class="line-modified"> 930         static $type$ getAndBitwiseAnd(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 931             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 932             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 933             if (handle.be == BE) {
 934                 return UNSAFE.getAndBitwiseAnd$RawType$(
 935                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 936                         address(bb, indexRO(bb, index)),
 937                         value);
 938             } else {
 939                 return getAndBitwiseAndConvEndianWithCAS(bb, index, value);
 940             }
 941         }
 942 
 943         @ForceInline
<span class="line-modified"> 944         static $type$ getAndBitwiseAndRelease(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 945             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 946             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 947             if (handle.be == BE) {
 948                 return UNSAFE.getAndBitwiseAnd$RawType$Release(
 949                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 950                         address(bb, indexRO(bb, index)),
 951                         value);
 952             } else {
 953                 return getAndBitwiseAndConvEndianWithCAS(bb, index, value);
 954             }
 955         }
 956 
 957         @ForceInline
<span class="line-modified"> 958         static $type$ getAndBitwiseAndAcquire(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 959             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 960             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 961             if (handle.be == BE) {
 962                 return UNSAFE.getAndBitwiseAnd$RawType$Acquire(
 963                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 964                         address(bb, indexRO(bb, index)),
 965                         value);
 966             } else {
 967                 return getAndBitwiseAndConvEndianWithCAS(bb, index, value);
 968             }
 969         }
 970 
 971         @ForceInline
 972         static $type$ getAndBitwiseAndConvEndianWithCAS(ByteBuffer bb, int index, $type$ value) {
 973             $type$ nativeExpectedValue, expectedValue;
 974             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
 975             long offset = address(bb, indexRO(bb, index));
 976             do {
 977                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
 978                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
 979             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
 980                     nativeExpectedValue, $RawBoxType$.reverseBytes(expectedValue &amp; value)));
 981             return expectedValue;
 982         }
 983 
 984 
 985         @ForceInline
<span class="line-modified"> 986         static $type$ getAndBitwiseXor(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added"> 987             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
 988             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
 989             if (handle.be == BE) {
 990                 return UNSAFE.getAndBitwiseXor$RawType$(
 991                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
 992                         address(bb, indexRO(bb, index)),
 993                         value);
 994             } else {
 995                 return getAndBitwiseXorConvEndianWithCAS(bb, index, value);
 996             }
 997         }
 998 
 999         @ForceInline
<span class="line-modified">1000         static $type$ getAndBitwiseXorRelease(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added">1001             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
1002             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
1003             if (handle.be == BE) {
1004                 return UNSAFE.getAndBitwiseXor$RawType$Release(
1005                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
1006                         address(bb, indexRO(bb, index)),
1007                         value);
1008             } else {
1009                 return getAndBitwiseXorConvEndianWithCAS(bb, index, value);
1010             }
1011         }
1012 
1013         @ForceInline
<span class="line-modified">1014         static $type$ getAndBitwiseXorAcquire(VarHandle ob, Object obb, int index, $type$ value) {</span>
<span class="line-added">1015             ByteBufferHandle handle = (ByteBufferHandle)ob;</span>
1016             ByteBuffer bb = (ByteBuffer) Objects.requireNonNull(obb);
1017             if (handle.be == BE) {
1018                 return UNSAFE.getAndBitwiseXor$RawType$Acquire(
1019                         UNSAFE.getReference(bb, BYTE_BUFFER_HB),
1020                         address(bb, indexRO(bb, index)),
1021                         value);
1022             } else {
1023                 return getAndBitwiseXorConvEndianWithCAS(bb, index, value);
1024             }
1025         }
1026 
1027         @ForceInline
1028         static $type$ getAndBitwiseXorConvEndianWithCAS(ByteBuffer bb, int index, $type$ value) {
1029             $type$ nativeExpectedValue, expectedValue;
1030             Object base = UNSAFE.getReference(bb, BYTE_BUFFER_HB);
1031             long offset = address(bb, indexRO(bb, index));
1032             do {
1033                 nativeExpectedValue = UNSAFE.get$RawType$Volatile(base, offset);
1034                 expectedValue = $RawBoxType$.reverseBytes(nativeExpectedValue);
1035             } while (!UNSAFE.weakCompareAndSet$RawType$(base, offset,
</pre>
</td>
</tr>
</table>
<center><a href="X-VarHandle.java.template.sdiff.html" target="_top">&lt; prev</a> <a href="../../../../../../../index.html" target="_top">index</a> <a href="X-VarHandleMemoryAddressView.java.template.sdiff.html" target="_top">next &gt;</a></center>  </body>
</html>